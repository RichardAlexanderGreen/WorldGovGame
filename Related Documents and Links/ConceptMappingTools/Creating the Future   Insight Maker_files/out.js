var requirejs,require,define;
(function(a){function b(a){return"[object Function]"===E.call(a)}function c(a){return"[object Array]"===E.call(a)}function d(a,b){if(a){var c;for(c=0;c<a.length&&(!a[c]||!b(a[c],c,a));c+=1);}}function e(a,b){if(a){var c;for(c=a.length-1;-1<c&&(!a[c]||!b(a[c],c,a));c-=1);}}function f(a,b){return M.call(a,b)}function g(a,b){return f(a,b)&&a[b]}function h(a,b){for(var c in a)if(f(a,c)&&b(a[c],c))break}function k(a,b,c,d){b&&h(b,function(b,e){if(c||!f(a,e))d&&"string"!==typeof b?(a[e]||(a[e]={}),k(a[e],
b,c,d)):a[e]=b});return a}function l(a,b){return function(){return b.apply(a,arguments)}}function m(a){throw a;}function n(b){if(!b)return b;var c=a;d(b.split("."),function(a){c=c[a]});return c}function o(a,b,c,d){b=Error(b+"\nhttp://requirejs.org/docs/errors.html#"+a);b.requireType=a;b.requireModules=d;c&&(b.originalError=c);return b}function q(e){function q(a,b,c){var d,e,f,h,k,l,m,n=b&&b.split("/"),o=W.map,p=o&&o["*"];if(a&&"."===a.charAt(0))if(b){d=g(W.pkgs,b)?n=[b]:n.slice(0,n.length-1);b=a=
d.concat(a.split("/"));for(d=0;b[d];d+=1)if(e=b[d],"."===e)b.splice(d,1),d-=1;else if(".."===e)if(1===d&&(".."===b[2]||".."===b[0]))break;else 0<d&&(b.splice(d-1,2),d-=2);d=g(W.pkgs,b=a[0]);a=a.join("/");d&&a===b+"/"+d.main&&(a=b)}else 0===a.indexOf("./")&&(a=a.substring(2));if(c&&o&&(n||p)){b=a.split("/");for(d=b.length;0<d;d-=1){f=b.slice(0,d).join("/");if(n)for(e=n.length;0<e;e-=1)if(c=g(o,n.slice(0,e).join("/")))if(c=g(c,f)){h=c;k=d;break}if(h)break;!l&&p&&g(p,f)&&(l=g(p,f),m=d)}!h&&l&&(h=l,k=
m);h&&(b.splice(0,k,h),a=b.join("/"))}return a}function y(a){K&&d(document.getElementsByTagName("script"),function(b){if(b.getAttribute("data-requiremodule")===a&&b.getAttribute("data-requirecontext")===V.contextName)return b.parentNode.removeChild(b),!0})}function x(a){var b=g(W.paths,a);if(b&&c(b)&&1<b.length)return y(a),b.shift(),V.require.undef(a),V.require([a]),!0}function A(a){var b,c=a?a.indexOf("!"):-1;-1<c&&(b=a.substring(0,c),a=a.substring(c+1,a.length));return[b,a]}function w(a,b,c,d){var e,
f,h=null,k=b?b.name:null,l=a,m=!0,n="";a||(m=!1,a="_@r"+(Ea+=1));a=A(a);h=a[0];a=a[1];h&&(h=q(h,k,d),f=g(ga,h));a&&(h?n=f&&f.normalize?f.normalize(a,function(a){return q(a,k,d)}):q(a,k,d):(n=q(a,k,d),a=A(n),h=a[0],n=a[1],c=!0,e=V.nameToUrl(n)));c=h&&!f&&!c?"_unnormalized"+(Fa+=1):"";return{prefix:h,name:n,parentMap:b,unnormalized:!!c,url:e,originalName:l,isDefine:m,id:(h?h+"!"+n:n)+c}}function v(a){var b=a.id,c=g(ca,b);c||(c=ca[b]=new V.Module(a));return c}function u(a,b,c){var d=a.id,e=g(ca,d);if(f(ga,
d)&&(!e||e.defineEmitComplete))"defined"===b&&c(ga[d]);else if(e=v(a),e.error&&"error"===b)c(e.error);else e.on(b,c)}function p(a,b){var c=a.requireModules,e=!1;if(b)b(a);else if(d(c,function(b){if(b=g(ca,b))b.error=a,b.events.error&&(e=!0,b.emit("error",a))}),!e)r.onError(a)}function F(){ba.length&&(L.apply(wa,[wa.length-1,0].concat(ba)),ba=[])}function z(a){delete ca[a];delete xa[a]}function E(a,b,c){var e=a.map.id;a.error?a.emit("error",a.error):(b[e]=!0,d(a.depMaps,function(d,e){var f=d.id,h=
g(ca,f);h&&!a.depMatched[e]&&!c[f]&&(g(b,f)?(a.defineDep(e,ga[f]),a.check()):E(h,b,c))}),c[e]=!0)}function M(){var a,b,c,e,f=(c=1E3*W.waitSeconds)&&V.startTime+c<(new Date).getTime(),g=[],k=[],l=!1,m=!0;if(!R){R=!0;h(xa,function(c){a=c.map;b=a.id;if(c.enabled&&(a.isDefine||k.push(c),!c.error))if(!c.inited&&f)x(b)?l=e=!0:(g.push(b),y(b));else if(!c.inited&&c.fetched&&a.isDefine&&(l=!0,!a.prefix))return m=!1});if(f&&g.length)return c=o("timeout","Load timeout for modules: "+g,null,g),c.contextName=
V.contextName,p(c);m&&d(k,function(a){E(a,{},{})});if((!f||e)&&l)if((K||O)&&!Ga)Ga=setTimeout(function(){Ga=0;M()},50);R=!1}}function H(a){f(ga,a[0])||v(w(a[0],null,!0)).init(a[1],a[2])}function C(a){var a=a.currentTarget||a.srcElement,b=V.onScriptLoad;a.detachEvent&&!T?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=V.onScriptError;(!a.detachEvent||T)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function G(){var a;for(F();wa.length;){a=
wa.shift();if(null===a[0])return p(o("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));H(a)}}var R,Aa,V,ya,Ga,W={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},ca={},xa={},Ha={},wa=[],ga={},oa={},Ea=1,Fa=1;ya={require:function(a){return a.require?a.require:a.require=V.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=ga[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,
config:function(){var b=g(W.pkgs,a.map.id);return(b?g(W.config,a.map.id+"/"+b.main):g(W.config,a.map.id))||{}},exports:ga[a.map.id]}}};Aa=function(a){this.events=g(Ha,a.id)||{};this.map=a;this.shim=g(W.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};Aa.prototype={init:function(a,b,c,d){d=d||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=l(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);
this.errback=c;this.inited=!0;this.ignore=d.ignore;d.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;V.startTime=(new Date).getTime();var a=this.map;if(this.shim)V.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],l(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},
load:function(){var a=this.map.url;oa[a]||(oa[a]=!0,V.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,c,d=this.map.id;c=this.depExports;var e=this.exports,f=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(b(f)){if(this.events.error&&this.map.isDefine||r.onError!==m)try{e=V.execCb(d,f,c,e)}catch(g){a=g}else e=V.execCb(d,f,c,e);this.map.isDefine&&((c=this.module)&&void 0!==
c.exports&&c.exports!==this.exports?e=c.exports:void 0===e&&this.usingExports&&(e=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",p(this.error=a)}else e=f;this.exports=e;if(this.map.isDefine&&!this.ignore&&(ga[d]=e,r.onResourceLoad))r.onResourceLoad(V,this.map,this.depMaps);z(d);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),
this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,c=w(a.prefix);this.depMaps.push(c);u(c,"defined",l(this,function(c){var d,e;e=this.map.name;var k=this.map.parentMap?this.map.parentMap.name:null,m=V.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(c.normalize&&(e=c.normalize(e,function(a){return q(a,k,!0)})||""),c=w(a.prefix+"!"+e,this.map.parentMap),u(c,"defined",l(this,function(a){this.init([],function(){return a},null,{enabled:!0,
ignore:!0})})),e=g(ca,c.id)){this.depMaps.push(c);if(this.events.error)e.on("error",l(this,function(a){this.emit("error",a)}));e.enable()}}else d=l(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),d.error=l(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];h(ca,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&z(a.map.id)});p(a)}),d.fromText=l(this,function(c,e){var g=a.name,h=w(g),k=Z;e&&(c=e);k&&(Z=!1);v(h);f(W.config,b)&&(W.config[g]=W.config[b]);try{r.exec(c)}catch(l){return p(o("fromtexteval",
"fromText eval for "+b+" failed: "+l,l,[b]))}k&&(Z=!0);this.depMaps.push(h);V.completeLoad(g);m([g],d)}),c.load(a.name,m,d,W)}));V.enable(c,this);this.pluginMaps[c.id]=c},enable:function(){xa[this.map.id]=this;this.enabling=this.enabled=!0;d(this.depMaps,l(this,function(a,b){var c,d;if("string"===typeof a){a=w(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=g(ya,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;u(a,"defined",l(this,function(a){this.defineDep(b,
a);this.check()}));this.errback&&u(a,"error",l(this,this.errback))}c=a.id;d=ca[c];!f(ya,c)&&d&&!d.enabled&&V.enable(a,this)}));h(this.pluginMaps,l(this,function(a){var b=g(ca,a.id);b&&!b.enabled&&V.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){d(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};V={config:W,contextName:e,registry:ca,defined:ga,urlFetched:oa,defQueue:wa,Module:Aa,makeModuleMap:w,
nextTick:r.nextTick,onError:p,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=W.pkgs,e=W.shim,f={paths:!0,config:!0,map:!0};h(a,function(a,b){f[b]?"map"===b?(W.map||(W.map={}),k(W[b],a,!0,!0)):k(W[b],a,!0):W[b]=a});a.shim&&(h(a.shim,function(a,b){c(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=V.makeShimExports(a);e[b]=a}),W.shim=e);a.packages&&(d(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,
location:a.location||a.name,main:(a.main||"main").replace(I,"").replace(B,"")}}),W.pkgs=b);h(ca,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=w(b))});if(a.deps||a.callback)V.require(a.deps||[],a.callback)},makeShimExports:function(b){return function(){var c;b.init&&(c=b.init.apply(a,arguments));return c||b.exports&&n(b.exports)}},makeRequire:function(a,c){function d(g,h,k){var l,m;c.enableBuildCallback&&h&&b(h)&&(h.__requireJsBuild=!0);if("string"===typeof g){if(b(h))return p(o("requireargs",
"Invalid require call"),k);if(a&&f(ya,g))return ya[g](ca[a.id]);if(r.get)return r.get(V,g,a,d);l=w(g,a,!1,!0);l=l.id;return!f(ga,l)?p(o("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(a?"":". Use require([])"))):ga[l]}G();V.nextTick(function(){G();m=v(w(null,a));m.skipMap=c.skipMap;m.init(g,h,k,{enabled:!0});M()});return d}c=c||{};k(d,{isBrowser:K,toUrl:function(b){var c,d=b.lastIndexOf("."),e=b.split("/")[0];if(-1!==d&&(!("."===e||".."===e)||1<d))c=b.substring(d,b.length),
b=b.substring(0,d);return V.nameToUrl(q(b,a&&a.id,!0),c,!0)},defined:function(b){return f(ga,w(b,a,!1,!0).id)},specified:function(b){b=w(b,a,!1,!0).id;return f(ga,b)||f(ca,b)}});a||(d.undef=function(b){F();var c=w(b,a,!0),d=g(ca,b);delete ga[b];delete oa[c.url];delete Ha[b];d&&(d.events.defined&&(Ha[b]=d.events),z(b))});return d},enable:function(a){g(ca,a.id)&&v(a).enable()},completeLoad:function(a){var b,c,d=g(W.shim,a)||{},e=d.exports;for(F();wa.length;){c=wa.shift();if(null===c[0]){c[0]=a;if(b)break;
b=!0}else c[0]===a&&(b=!0);H(c)}c=g(ca,a);if(!b&&!f(ga,a)&&c&&!c.inited){if(W.enforceDefine&&(!e||!n(e)))return x(a)?void 0:p(o("nodefine","No define call for "+a,null,[a]));H([a,d.deps||[],d.exportsFn])}M()},nameToUrl:function(a,b,d){var e,f,h,k,l,m;if(r.jsExtRegExp.test(a))k=a+(b||"");else{e=W.paths;f=W.pkgs;k=a.split("/");for(l=k.length;0<l;l-=1)if(m=k.slice(0,l).join("/"),h=g(f,m),m=g(e,m)){c(m)&&(m=m[0]);k.splice(0,l,m);break}else if(h){a=a===h.name?h.location+"/"+h.main:h.location;k.splice(0,
l,a);break}k=k.join("/");k+=b||(/\?/.test(k)||d?"":".js");k=("/"===k.charAt(0)||k.match(/^[\w\+\.\-]+:/)?"":W.baseUrl)+k}return W.urlArgs?k+((-1===k.indexOf("?")?"?":"&")+W.urlArgs):k},load:function(a,b){r.load(V,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||Q.test((a.currentTarget||a.srcElement).readyState))D=null,a=C(a),V.completeLoad(a.id)},onScriptError:function(a){var b=C(a);if(!x(b.id))return p(o("scripterror","Script error for: "+b.id,a,[b.id]))}};
V.require=V.makeRequire();return V}var r,u,w,v,x,z,D,H,C,A,y=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,F=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,B=/\.js$/,I=/^\.\//;u=Object.prototype;var E=u.toString,M=u.hasOwnProperty,L=Array.prototype.splice,K=!!("undefined"!==typeof window&&navigator&&window.document),O=!K&&"undefined"!==typeof importScripts,Q=K&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,T="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),
R={},G={},ba=[],Z=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(b(requirejs))return;G=requirejs;requirejs=void 0}"undefined"!==typeof require&&!b(require)&&(G=require,require=void 0);r=requirejs=function(a,b,d,e){var f,h="_";!c(a)&&"string"!==typeof a&&(f=a,c(b)?(a=b,b=d,d=e):a=[]);f&&f.context&&(h=f.context);(e=g(R,h))||(e=R[h]=r.s.newContext(h));f&&e.configure(f);return e.require(a,b,d)};r.config=function(a){return r(a)};r.nextTick="undefined"!==typeof setTimeout?function(a){setTimeout(a,
4)}:function(a){a()};require||(require=r);r.version="2.1.8";r.jsExtRegExp=/^\/|:|\?|\.js$/;r.isBrowser=K;u=r.s={contexts:R,newContext:q};r({});d(["toUrl","undef","defined","specified"],function(a){r[a]=function(){var b=R._;return b.require[a].apply(b,arguments)}});if(K&&(w=u.head=document.getElementsByTagName("head")[0],v=document.getElementsByTagName("base")[0]))w=u.head=v.parentNode;r.onError=m;r.createNode=function(a){var b=a.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):
document.createElement("script");b.type=a.scriptType||"text/javascript";b.charset="utf-8";b.async=!0;return b};r.load=function(a,b,c){var d=a&&a.config||{};if(K)return d=r.createNode(d,b,c),d.setAttribute("data-requirecontext",a.contextName),d.setAttribute("data-requiremodule",b),d.attachEvent&&!(d.attachEvent.toString&&0>d.attachEvent.toString().indexOf("[native code"))&&!T?(Z=!0,d.attachEvent("onreadystatechange",a.onScriptLoad)):(d.addEventListener("load",a.onScriptLoad,!1),d.addEventListener("error",
a.onScriptError,!1)),d.src=c,H=d,v?w.insertBefore(d,v):w.appendChild(d),H=null,d;if(O)try{importScripts(c),a.completeLoad(b)}catch(e){a.onError(o("importscripts","importScripts failed for "+b+" at "+c,e,[b]))}};K&&e(document.getElementsByTagName("script"),function(a){w||(w=a.parentNode);if(x=a.getAttribute("data-main"))return C=x,G.baseUrl||(z=C.split("/"),C=z.pop(),A=z.length?z.join("/")+"/":"./",G.baseUrl=A),C=C.replace(B,""),r.jsExtRegExp.test(C)&&(C=x),G.deps=G.deps?G.deps.concat(C):[C],!0});
define=function(a,d,f){var g,h;"string"!==typeof a&&(f=d,d=a,a=null);c(d)||(f=d,d=null);!d&&b(f)&&(d=[],f.length&&(f.toString().replace(y,"").replace(F,function(a,b){d.push(b)}),d=(1===f.length?["require"]:["require","exports","module"]).concat(d)));if(Z){if(!(g=H))D&&"interactive"===D.readyState||e(document.getElementsByTagName("script"),function(a){if("interactive"===a.readyState)return D=a}),g=D;g&&(a||(a=g.getAttribute("data-requiremodule")),h=R[g.getAttribute("data-requirecontext")])}(h?h.defQueue:
ba).push([a,d,f])};define.amd={jQuery:!0};r.exec=function(a){return eval(a)};r(G)}})(this);var translations={};function getText(a){translations[a]&&(a=translations[a]);for(var b=1;b<arguments.length;b++)a=a.replace("%s",arguments[b]);return a};var viewConfig={showTopLinks:!0,sideBarWidth:300,referenceBarWidth:200,enableContextMenu:!0,focusDiagram:!0,allowEdits:is_editor&&!is_embed,saveEnabled:!0,buttonGroups:!0,showLogo:!0,primitiveGroup:!0,connectionsGroup:!0,actionsGroup:!0,styleGroup:!0,toolsGroup:!0,exploreGroup:!1,fullScreenResults:!1,showResultsEdit:!0};
is_ebook&&(viewConfig.showTopLinks=!1,viewConfig.sideBarWidth=210,viewConfig.referenceBarWidth=150,viewConfig.focusDiagram=!1,viewConfig.saveEnabled=!1,viewConfig.showLogo=!1,viewConfig.primitiveGroup=!1,viewConfig.actionsGroup=!0,viewConfig.styleGroup=!1,viewConfig.runFlush=!0,viewConfig.fullScreenResults=!0,viewConfig.showResultsEdit=!1);
is_embed&&(viewConfig.sideBarWidth=210,viewConfig.enableContextMenu=!1,viewConfig.referenceBarWidth=150,viewConfig.focusDiagram=!1,viewConfig.saveEnabled=!1,viewConfig.buttonGroups=!1,viewConfig.primitiveGroup=!1,viewConfig.connectionsGroup=!1,viewConfig.actionsGroup=!1,viewConfig.styleGroup=!1,viewConfig.toolsGroup=!1,viewConfig.fullScreenResults=!0,viewConfig.showResultsEdit=!1);
is_editor||(viewConfig.enableConextMenu=!1,viewConfig.saveEnabled=!1,viewConfig.primitiveGroup=!1,viewConfig.connectionsGroup=!1,viewConfig.actionsGroup=!1,viewConfig.styleGroup=!1,viewConfig.toolsGroup=!1,is_embed||(viewConfig.exploreGroup=!0),viewConfig.showResultsEdit=!1);
Ext.onReady(function(){setTimeout(function(){setTimeout(function(){try{Ext.get("model-overview").fadeOut({duration:1E3,remove:!0})}catch(a){}},250);Ext.get("loading-indicator").remove();Ext.get("loading-mask").fadeOut({remove:!0})},250)});function replace_html(a,b){if(a){var c="string"===typeof a?document.getElementById(a):a,d=document.createElement(c.nodeName);d.id=c.id;d.className=c.className;d.innerHTML=b;c.parentNode?c.parentNode.replaceChild(d,c):c.innerHTML=b;return d}}
function setTopLinks(){if(viewConfig.showTopLinks){var a="",b="&uarr;";ribbonPanel.getDockedItems()[0].isVisible()||(b="&darr;");-1==drupal_node_ID?a='<div style="float:right;padding:0.2em;"><nobr><a href="'+base_path+'/help" target="_blank" >'+getText("Help")+'</a> | <a href="'+base_path+'/browse" target="_blank">'+getText("Find More Insights")+'</a> | <a href="javascript:toggleTopBar()"  id="toolbarToggle">'+b+"</a></nobr></div>":(is_editor?(a='<div style="float:left;padding:0.2em;"><a href="'+
base_path+"/discussion/"+drupal_node_ID+'" target="_blank" id="commentBut">'+getText("Insight Discussion")+"</a>",a=a+' | <a href="'+base_path+"/node/"+drupal_node_ID+'/access" target="_blank" id="editBut">'+getText("Insight Properties")+"</a>",a=a+' | <a href="'+base_path+"/node/"+drupal_node_ID+'/delete" id="deleteBut">'+getText("Delete Insight")+"</a>",a+="</div></div>"):a=a+'<div style="float:left;padding:0.2em;"><a href="'+base_path+"/discussion/"+drupal_node_ID+'" target="_blank" id="commentBut">'+
getText("Insight Discussion")+"</a></div>",a+='<div style="float:right;padding:0.2em;"><nobr>',is_embed?a=a+'<a target="_blank" href="'+base_path+"/insight/"+drupal_node_ID+'">'+getText("Full Screen Insight")+"</a> | ":(a=a+'<a target="_blank" href="'+base_path+'/insight/">'+getText("Make New Insight")+"</a> | ",a=a+'<a target="_blank" href="'+base_path+"/node/"+drupal_node_ID+'/clone">'+getText("Clone Insight")+"</a> | "),a=a+'<a href="'+base_path+'/help" target="_blank">'+getText("Help")+'</a> | <a href="'+
base_path+'/browse" target="_blank">'+getText("Find More Insights")+'</a> | <a href="javascript:toggleTopBar()" id="toolbarToggle">'+b+"</a></nobr></div>");replace_html(document.getElementById("toplinks-holder"),a);$.fn.frameWarp&&($("#commentBut").frameWarp({url:base_path+"/discussion/"+drupal_node_ID}),$("#editBut").frameWarp({url:base_path+"/node/"+drupal_node_ID+"/access"}))}};Ext.ns("Ext.ux.util");
Ext.ux.util.MD5=function(a){function b(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function c(a,c,d,e,f,n){a=b(b(c,a),b(e,n));return b(a<<f|a>>>32-f,d)}function d(a,b,d,e,f,n,o){return c(b&d|~b&e,a,b,f,n,o)}function e(a,b,d,e,f,n,o){return c(b&e|d&~e,a,b,f,n,o)}function f(a,b,d,e,f,n,o){return c(d^(b|~e),a,b,f,n,o)}return function(a){for(var b="",c=0;c<4*a.length;c++)b+="0123456789abcdef".charAt(a[c>>2]>>8*(c%4)+4&15)+"0123456789abcdef".charAt(a[c>>2]>>8*(c%4)&15);return b}(function(a,
h){a[h>>5]|=128<<h%32;a[(h+64>>>9<<4)+14]=h;for(var k=1732584193,l=-271733879,m=-1732584194,n=271733878,o=0;o<a.length;o+=16)var q=k,r=l,u=m,w=n,k=d(k,l,m,n,a[o+0],7,-680876936),n=d(n,k,l,m,a[o+1],12,-389564586),m=d(m,n,k,l,a[o+2],17,606105819),l=d(l,m,n,k,a[o+3],22,-1044525330),k=d(k,l,m,n,a[o+4],7,-176418897),n=d(n,k,l,m,a[o+5],12,1200080426),m=d(m,n,k,l,a[o+6],17,-1473231341),l=d(l,m,n,k,a[o+7],22,-45705983),k=d(k,l,m,n,a[o+8],7,1770035416),n=d(n,k,l,m,a[o+9],12,-1958414417),m=d(m,n,k,l,a[o+10],
17,-42063),l=d(l,m,n,k,a[o+11],22,-1990404162),k=d(k,l,m,n,a[o+12],7,1804603682),n=d(n,k,l,m,a[o+13],12,-40341101),m=d(m,n,k,l,a[o+14],17,-1502002290),l=d(l,m,n,k,a[o+15],22,1236535329),k=e(k,l,m,n,a[o+1],5,-165796510),n=e(n,k,l,m,a[o+6],9,-1069501632),m=e(m,n,k,l,a[o+11],14,643717713),l=e(l,m,n,k,a[o+0],20,-373897302),k=e(k,l,m,n,a[o+5],5,-701558691),n=e(n,k,l,m,a[o+10],9,38016083),m=e(m,n,k,l,a[o+15],14,-660478335),l=e(l,m,n,k,a[o+4],20,-405537848),k=e(k,l,m,n,a[o+9],5,568446438),n=e(n,k,l,m,a[o+
14],9,-1019803690),m=e(m,n,k,l,a[o+3],14,-187363961),l=e(l,m,n,k,a[o+8],20,1163531501),k=e(k,l,m,n,a[o+13],5,-1444681467),n=e(n,k,l,m,a[o+2],9,-51403784),m=e(m,n,k,l,a[o+7],14,1735328473),l=e(l,m,n,k,a[o+12],20,-1926607734),k=c(l^m^n,k,l,a[o+5],4,-378558),n=c(k^l^m,n,k,a[o+8],11,-2022574463),m=c(n^k^l,m,n,a[o+11],16,1839030562),l=c(m^n^k,l,m,a[o+14],23,-35309556),k=c(l^m^n,k,l,a[o+1],4,-1530992060),n=c(k^l^m,n,k,a[o+4],11,1272893353),m=c(n^k^l,m,n,a[o+7],16,-155497632),l=c(m^n^k,l,m,a[o+10],23,-1094730640),
k=c(l^m^n,k,l,a[o+13],4,681279174),n=c(k^l^m,n,k,a[o+0],11,-358537222),m=c(n^k^l,m,n,a[o+3],16,-722521979),l=c(m^n^k,l,m,a[o+6],23,76029189),k=c(l^m^n,k,l,a[o+9],4,-640364487),n=c(k^l^m,n,k,a[o+12],11,-421815835),m=c(n^k^l,m,n,a[o+15],16,530742520),l=c(m^n^k,l,m,a[o+2],23,-995338651),k=f(k,l,m,n,a[o+0],6,-198630844),n=f(n,k,l,m,a[o+7],10,1126891415),m=f(m,n,k,l,a[o+14],15,-1416354905),l=f(l,m,n,k,a[o+5],21,-57434055),k=f(k,l,m,n,a[o+12],6,1700485571),n=f(n,k,l,m,a[o+3],10,-1894986606),m=f(m,n,k,l,
a[o+10],15,-1051523),l=f(l,m,n,k,a[o+1],21,-2054922799),k=f(k,l,m,n,a[o+8],6,1873313359),n=f(n,k,l,m,a[o+15],10,-30611744),m=f(m,n,k,l,a[o+6],15,-1560198380),l=f(l,m,n,k,a[o+13],21,1309151649),k=f(k,l,m,n,a[o+4],6,-145523070),n=f(n,k,l,m,a[o+11],10,-1120210379),m=f(m,n,k,l,a[o+2],15,718787259),l=f(l,m,n,k,a[o+9],21,-343485551),k=b(k,q),l=b(l,r),m=b(m,u),n=b(n,w);return[k,l,m,n]}(function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(a.charCodeAt(c/8)&255)<<c%32;return b}(a),8*a.length))};
Ext.ux.util.clone=function(a){if(!a||"object"!==typeof a)return a;if("function"===typeof a.clone)return a.clone();var b="[object Array]"===Object.prototype.toString.call(a)?[]:{},c,d;for(c in a)a.hasOwnProperty(c)&&(d=a[c],b[c]=d&&"object"===typeof d?Ext.ux.util.clone(d):d);return b};Ext.ux.util.applyMatching=function(a,b){var b=b||this,c;for(c in a)a.hasOwnProperty(c)&&void 0!==b[c]&&(a[c]=b[c]);return a};Ext.chart.series.Line.prototype.drawSeries=function(){var a=this.chart,b=a.axes,c=a.getChartStore(),d=c.data.items,e,f=c.getCount(),g=this.chart.surface,h={},k=this.group,l=this.showMarkers,m=this.markerGroup,n=a.shadow,o=this.shadowGroups,q=this.shadowAttributes,r=this.smooth,u=o.length,w=["M"],v=["M"],x=["M"],x=["M"],z=a.markerIndex;[].concat(this.axis);var D,H=[],C={},A=[],y=!1,F=[],B=Ext.apply({},this.markerStyle),I=this.seriesStyle,E=this.colorArrayStyle,M=E&&E.length||0,L=Ext.isNumber,K=this.getAxesForXAndYFields(),
O=K.xAxis,Q=K.yAxis,T=O?b.get(O).type:"",R=Q?b.get(Q).type:"",G,ba,Z,P,U,J,S,ra,ea,ua,va,p,ma,La,na;if(!1!==this.fireEvent("beforedraw",this))if(!f||this.seriesIsHidden){this.hide();this.items=[];if(this.line){this.line.hide(!0);if(this.line.shadows){b=this.line.shadows;for(d=0,u=b.length;d<u;d++)C=b[d],C.hide(!0)}this.fillPath&&this.fillPath.hide(!0)}this.fillPath=this.line=null}else{B=Ext.apply(B||{},this.markerConfig,{fill:this.seriesStyle.fill||E[this.themeIdx%E.length]});La=B.type;delete B.type;
I["stroke-width"]||(I["stroke-width"]=0.5);na="opacity"in I?I.opacity:1;K="opacity"in I?I.opacity:0.3;na="lineOpacity"in I?I.lineOpacity:na;K="fillOpacity"in I?I.fillOpacity:K;if(z&&m&&m.getCount())for(J=0;J<z;J++)S=m.getAt(J),m.remove(S),m.add(S),ra=m.getAt(m.getCount()-2),S.setAttributes({x:0,y:0,translate:{x:ra.attr.translation.x,y:ra.attr.translation.y}},!0);this.unHighlightItem();this.cleanHighlights();this.setBBox();h=this.bbox;this.clipRect=[h.x,h.y,h.width,h.height];if(J=b.get(O))J=J.applyData(),
p=J.from,ea=J.to;if(J=b.get(Q))J=J.applyData(),ma=J.from,e=J.to;this.xField&&!Ext.isNumber(p)&&(J=this.getMinMaxXValues(),p=J[0],ea=J[1]);this.yField&&!Ext.isNumber(ma)&&(J=this.getMinMaxYValues(),ma=J[0],e=J[1]);isNaN(p)?(p=0,ua=h.width/(f-1||1)):ua=h.width/(ea-p||f-1||1);isNaN(ma)?(ma=0,va=h.height/(f-1||1)):va=h.height/(e-ma||f-1||1);for(J=0,f=d.length;J<f;J++){e=d[J];ea=e.get(this.xField);"Time"==T&&"string"==typeof ea&&(ea=Date.parse(ea));if("string"==typeof ea||"object"==typeof ea&&!Ext.isDate(ea)||
O&&b.get(O)&&"Category"==b.get(O).type)ea=ea in C?C[ea]:C[ea]=J;e=e.get(this.yField);"Time"==R&&"string"==typeof e&&(e=Date.parse(e));if("undefined"==typeof e||"string"==typeof e&&!e)Ext.isDefined(Ext.global.console);else{if("string"==typeof e||"object"==typeof e&&!Ext.isDate(e)||Q&&b.get(Q)&&"Category"==b.get(Q).type)e=J;F.push(J);H.push(ea);A.push(e)}}f=H.length;f>h.width&&(J=this.shrink(H,A,h.width),H=J.x,A=J.y);this.items=[];a.scaleX=function(a){return(h.x+(a-p)*ua).toFixed(2)};a.scaleY=function(a){return(h.y+
h.height-(a-ma)*va).toFixed(2)};a.revX=function(a){return(a-h.x)/ua+p};a.revY=function(a){return-(a-(h.y+h.height))/va+ma};O=0;f=H.length;for(J=0;J<f;J++)if(ea=H[J],e=A[J],!1===e)1==v.length&&(v=[]),y=!0,this.items.push(!1);else{Z=(h.x+(ea-p)*ua).toFixed(2);Q=(h.y+h.height-(e-ma)*va).toFixed(2);y&&(y=!1,v.push("M"));v=v.concat([Z,Q]);"undefined"==typeof U&&"undefined"!=typeof Q&&(U=Q,P=Z);if(!this.line||a.resizing)w=w.concat([Z,h.y+h.height/2]);if(a.animate&&a.resizing&&this.line&&(this.line.setAttributes({path:w,
opacity:na},!0),this.fillPath&&this.fillPath.setAttributes({path:w,opacity:K},!0),this.line.shadows)){b=this.line.shadows;for(d=0,u=b.length;d<u;d++)C=b[d],C.setAttributes({path:w},!0)}l&&((S=m.getAt(O++))?S.setAttributes({value:'"'+ea+", "+e+'"',x:0,y:0,hidden:!1},!0):S=Ext.chart.Shape[La](g,Ext.apply({group:[k,m],x:0,y:0,translate:{x:+(G||Z),y:D||h.y+h.height/2},value:'"'+ea+", "+e+'"',zIndex:4E3},B)),S._to={translate:{x:+Z,y:+Q}});this.items.push({series:this,value:[ea,e],point:[Z,Q],sprite:S,
storeItem:c.getAt(F[J])});G=Z;D=Q}if(!(1>=v.length)){this.smooth&&(x=Ext.draw.Draw.smooth(v,L(r)?r:this.defaultSmoothness));x=r?x:v;a.markerIndex&&this.previousPath?(G=this.previousPath,r||Ext.Array.erase(G,1,2)):G=v;if(!this.line&&(this.line=g.add(Ext.apply({type:"path",group:k,path:w,stroke:I.stroke||I.fill},I||{})),this.line.setAttributes({opacity:na},!0),n&&this.line.setAttributes(Ext.apply({},this.shadowOptions),!0),this.line.setAttributes({fill:"none",zIndex:3E3}),!I.stroke&&M&&this.line.setAttributes({stroke:E[this.themeIdx%
M]},!0),n)){b=this.line.shadows=[];for(r=0;r<u;r++)D=q[r],D=Ext.apply({},D,{path:w}),C=g.add(Ext.apply({},{type:"path",group:o[r]},D)),b.push(C)}this.fill&&(ba=x.concat([["L",Z,h.y+h.height],["L",P,h.y+h.height],["L",P,U]]),this.fillPath||(this.fillPath=g.add({group:k,type:"path",fill:I.fill||E[this.themeIdx%M],path:w})));g=l&&m.getCount();if(a.animate){o=this.fill;q=this.line;k=this.renderer(q,!1,{path:x},J,c);Ext.apply(k,I||{},{stroke:I.stroke||I.fill});delete k.fill;q.show(!0);this.animation=a.markerIndex&&
this.previousPath?this.onAnimate(q,{to:k,from:{path:G}}):this.onAnimate(q,{to:k});if(n){b=q.shadows;for(d=0;d<u;d++)if(b[d].show(!0),a.markerIndex&&this.previousPath)this.onAnimate(b[d],{to:{path:x},from:{path:G}});else this.onAnimate(b[d],{to:{path:x}})}o&&(this.fillPath.show(!0),this.onAnimate(this.fillPath,{to:Ext.apply({},{path:ba,fill:I.fill||E[this.themeIdx%M],"stroke-width":0,opacity:K},I||{})}));if(l){for(J=O=0;J<f;J++)if(this.items[J]&&(l=m.getAt(O++)))k=this.renderer(l,c.getAt(J),l._to,
J,c),this.onAnimate(l,{to:Ext.applyIf(k,B||{})}),l.show(!0);for(;O<g;O++)l=m.getAt(O),l.hide(!0)}}else{k=this.renderer(this.line,!1,{path:x,hidden:!1},J,c);Ext.apply(k,I||{},{stroke:I.stroke||I.fill});delete k.fill;this.line.setAttributes(k,!0);this.line.setAttributes({opacity:na},!0);if(n){b=this.line.shadows;for(d=0;d<u;d++)b[d].setAttributes({path:x,hidden:!1},!0)}this.fill&&this.fillPath.setAttributes({path:ba,hidden:!1,opacity:K},!0);if(l){for(J=O=0;J<f;J++)if(this.items[J]&&(l=m.getAt(O++)))k=
this.renderer(l,c.getAt(J),l._to,J,c),l.setAttributes(Ext.apply(B||{},k||{}),!0),l.attr.hidden||l.show(!0);for(;O<g;O++)l=m.getAt(O),l.hide(!0)}}a.markerIndex&&(this.smooth?Ext.Array.erase(v,1,2):Ext.Array.splice(v,1,0,v[1],v[2]),this.previousPath=v);this.renderLabels();this.renderCallouts();this.fireEvent("draw",this)}}};
Ext.chart.Chart.prototype.redraw=function(a){var b=this.series.items,c=b.length,d=this.axes.items,e=d.length,f=0,g,h;g=this.chartBBox={x:0,y:0,height:this.curHeight,width:this.curWidth};var k=this.legend,l;this.surface.setSize(g.width,g.height);for(g=0;g<c;g++)h=b[g],l=h.initialized?h:this.initializeSeries(h,g,f),l.onRedraw(),Ext.isArray(h.yField)?f+=h.yField.length:++f;for(g=0;g<e;g++)h=d[g],h.initialized||this.initializeAxis(h);for(g=0;g<e;g++)d[g].processView();for(g=0;g<e;g++)d[g].drawAxis(!0);
!1!==k&&k.visible&&(k.update||!k.created)&&k.create();this.alignAxes();!1!==k&&k.visible&&k.updatePosition();this.getMaxGutters();this.resizing=!!a;for(g=0;g<e;g++)d[g].drawAxis();for(g=0;g<c;g++)this.drawCharts(b[g]);if(this.oldLinks){for(g=0;g<this.oldLinks.length;g++)this.oldLinks[g].remove();this.oldLinks=[]}if(this.links){this.oldLinks=[];for(var m in this.links)drawLink(this,this.links[m][0],this.links[m][1])}this.resizing=!1};
function drawLink(a,b,c){b=[[a.scaleX(b.items[0]),a.scaleY(b.items[1])],[a.scaleX(c.items[0]),a.scaleY(c.items[1])]];drawPath(a,b,"#aaaaaa",0.5,"#aaaaaa",1)}
function drawPath(a,b,c,d,e,f,g){if("undefined"==typeof g||""==g)g=null;if(""==e||""==f||"undefined"==typeof e||"undefined"==typeof f)f=e=null;var h=h+"M"+b[0][0]+" "+b[0][1]+" ";for(i=1;i<b.length;i++)h=h+"L"+b[i][0]+" "+b[i][1]+" ";this.currFill=b=a.surface.add({type:"path",opacity:d,fill:c,path:h+"Z",stroke:e,"stroke-width":f,listeners:g}).show(!0);a.oldLinks.push(b)}
var unfilteredRange=function(){var a=this.chart,b=a.getChartStore().queryBy(function(){return!0}).items,c=a.series.items,d=this.position,e,f=Ext.chart.series,a=[],g=Infinity,h=-Infinity,k="left"===this.position||"right"===this.position||"radial"===this.position,l,m,n,o,q=b.length,r={},u={},w=!0,v;e=this.fields;for(o=0,m=e.length;o<m;o++)u[e[o]]=!0;for(l=0,m=c.length;l<m;l++)if(!c[l].seriesIsHidden&&c[l].getAxesForXAndYFields&&(e=c[l].getAxesForXAndYFields(),!e.xAxis||!(e.xAxis!==d&&e.yAxis&&e.yAxis!==
d))){e=f.Bar&&c[l]instanceof f.Bar&&!c[l].column?k?Ext.Array.from(c[l].xField):Ext.Array.from(c[l].yField):k?Ext.Array.from(c[l].yField):Ext.Array.from(c[l].xField);if(this.fields.length){for(o=0,n=e.length;o<n&&!u[e[o]];o++);if(o==n)continue}if(o=c[l].stacked)f.Bar&&c[l]instanceof f.Bar?c[l].column!=k&&(w=o=!1):k||(w=o=!1);if(o){n={};for(o=0;o<e.length;o++)if(!w||!c[l].__excludes||!c[l].__excludes[o])u[e[o]]||Ext.Logger.warn("Field `"+e[o]+"` is not included in the "+d+" axis config."),u[e[o]]=n[e[o]]=
!0;a.push({fields:n,positiveValue:0,negativeValue:0})}else{if(!e||0==e.length)e=this.fields;for(o=0;o<e.length;o++)if(!w||!c[l].__excludes||!c[l].__excludes[o])u[e[o]]=r[e[o]]=!0}}for(l=0;l<q;l++){d=b[l];for(c=0;c<a.length;c++)a[c].positiveValue=0,a[c].negativeValue=0;for(v in u)if(f=d.get(v),"Time"==this.type&&"string"==typeof f&&(f=Date.parse(f)),!isNaN(f)){f=void 0===f?0:Number(f);r[v]&&(g>f&&(g=f),h<f&&(h=f));for(c=0;c<a.length;c++)a[c].fields[v]&&(0<=f?(a[c].positiveValue+=f,h<a[c].positiveValue&&
(h=a[c].positiveValue),0<g&&(g=0)):(a[c].negativeValue+=f,g>a[c].negativeValue&&(g=a[c].negativeValue),0>h&&(h=0)))}}isFinite(h)||(h=this.prevMax||0);isFinite(g)||(g=this.prevMin||0);"number"===typeof g&&(g=Ext.Number.correctFloat(g));"number"===typeof h&&(h=Ext.Number.correctFloat(h));if(g!=h&&(h!=Math.floor(h)||g!=Math.floor(g)))g=Math.floor(g),h=Math.floor(h)+1;isNaN(this.minimum)||(g=this.minimum);isNaN(this.maximum)||(h=this.maximum);g>=h&&(g=Math.floor(g),h=g+1);return{min:g,max:h}};var Graph=function(){this.nodeSet={};this.nodes=[];this.edges=[];this.adjacency={};this.nextEdgeId=this.nextNodeId=0;this.eventListeners=[]},Node=function(a,b){this.id=a;this.data="undefined"!==typeof b?b:{}},Edge=function(a,b,c,d){this.id=a;this.source=b;this.target=c;this.data="undefined"!==typeof d?d:{}};Graph.prototype.addNode=function(a){"undefined"===typeof this.nodeSet[a.id]&&this.nodes.push(a);this.nodeSet[a.id]=a;this.notify();return a};
Graph.prototype.addEdge=function(a){var b=!1;this.edges.forEach(function(c){a.id===c.id&&(b=!0)});b||this.edges.push(a);"undefined"===typeof this.adjacency[a.source.id]&&(this.adjacency[a.source.id]={});"undefined"===typeof this.adjacency[a.source.id][a.target.id]&&(this.adjacency[a.source.id][a.target.id]=[]);b=!1;this.adjacency[a.source.id][a.target.id].forEach(function(c){a.id===c.id&&(b=!0)});b||this.adjacency[a.source.id][a.target.id].push(a);this.notify();return a};
Graph.prototype.newNode=function(a){a=new Node(this.nextNodeId++,a);this.addNode(a);return a};Graph.prototype.newEdge=function(a,b,c){a=new Edge(this.nextEdgeId++,a,b,c);this.addEdge(a);return a};Graph.prototype.getEdges=function(a,b){return"undefined"!==typeof this.adjacency[a.id]&&"undefined"!==typeof this.adjacency[a.id][b.id]?this.adjacency[a.id][b.id]:[]};
Graph.prototype.removeNode=function(a){"undefined"!==typeof this.nodeSet[a.id]&&delete this.nodeSet[a.id];for(var b=this.nodes.length-1;0<=b;b--)this.nodes[b].id===a.id&&this.nodes.splice(b,1);this.detachNode(a)};Graph.prototype.detachNode=function(a){this.edges.slice().forEach(function(b){(b.source.id===a.id||b.target.id===a.id)&&this.removeEdge(b)},this);this.notify()};
Graph.prototype.removeEdge=function(a){for(var b=this.edges.length-1;0<=b;b--)this.edges[b].id===a.id&&this.edges.splice(b,1);for(var c in this.adjacency)for(var d in this.adjacency[c])for(b=this.adjacency[c][d].length-1;0<=b;b--)this.adjacency[c][d][b].id===a.id&&this.adjacency[c][d].splice(b,1);this.notify()};
Graph.prototype.merge=function(a){var b=[];a.nodes.forEach(function(a){b.push(this.addNode(new Node(a.id,a.data)))},this);a.edges.forEach(function(a){var d=b[a.from],e=b[a.to],f=a.directed?f=a.type+"-"+d.id+"-"+e.id:d.id<e.id?a.type+"-"+d.id+"-"+e.id:a.type+"-"+e.id+"-"+d.id;this.addEdge(new Edge(f,d,e,a.data)).data.type=a.type},this)};Graph.prototype.filterNodes=function(a){this.nodes.slice().forEach(function(b){a(b)||this.removeNode(b)},this)};
Graph.prototype.filterEdges=function(a){this.edges.slice().forEach(function(b){a(b)||this.removeEdge(b)},this)};Graph.prototype.addGraphListener=function(a){this.eventListeners.push(a)};Graph.prototype.notify=function(){this.eventListeners.forEach(function(a){a.graphChanged()})};var Layout={ForceDirected:function(a,b,c,d){this.graph=a;this.stiffness=b;this.repulsion=c;this.damping=d;this.nodePoints={};this.edgeSprings={}}};
Layout.ForceDirected.prototype.point=function(a){if("undefined"===typeof this.nodePoints[a.id]){var b="undefined"!==typeof a.data.mass?a.data.mass:1;this.nodePoints[a.id]=new Layout.ForceDirected.Point(gVector.random(),b)}return this.nodePoints[a.id]};
Layout.ForceDirected.prototype.spring=function(a){if("undefined"===typeof this.edgeSprings[a.id]){var b="undefined"!==typeof a.data.length?a.data.length:1,c=!1,d=this.graph.getEdges(a.source,a.target);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point1,c.point2,0,0);this.graph.getEdges(a.target,a.source);d.forEach(function(a){!1===c&&"undefined"!==typeof this.edgeSprings[a.id]&&(c=this.edgeSprings[a.id])},
this);if(!1!==c)return new Layout.ForceDirected.Spring(c.point2,c.point1,0,0);this.edgeSprings[a.id]=new Layout.ForceDirected.Spring(this.point(a.source),this.point(a.target),b,this.stiffness)}return this.edgeSprings[a.id]};Layout.ForceDirected.prototype.eachNode=function(a){var b=this;this.graph.nodes.forEach(function(c){a.call(b,c,b.point(c))})};Layout.ForceDirected.prototype.eachEdge=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,c,b.spring(c))})};
Layout.ForceDirected.prototype.eachSpring=function(a){var b=this;this.graph.edges.forEach(function(c){a.call(b,b.spring(c))})};Layout.ForceDirected.prototype.applyCoulombsLaw=function(){this.eachNode(function(a,b){this.eachNode(function(a,d){if(b!==d){var e=b.p.subtract(d.p),f=e.magnitude()+0.1,e=e.normalise();b.applyForce(e.multiply(this.repulsion).divide(0.5*f*f));d.applyForce(e.multiply(this.repulsion).divide(-0.5*f*f))}})})};
Layout.ForceDirected.prototype.applyHookesLaw=function(){this.eachSpring(function(a){var b=a.point2.p.subtract(a.point1.p),c=a.length-b.magnitude(),b=b.normalise();a.point1.applyForce(b.multiply(-0.5*a.k*c));a.point2.applyForce(b.multiply(0.5*a.k*c))})};Layout.ForceDirected.prototype.attractToCentre=function(){this.eachNode(function(a,b){var c=b.p.multiply(-1);b.applyForce(c.multiply(this.repulsion/50))})};
Layout.ForceDirected.prototype.updateVelocity=function(a){this.eachNode(function(b,c){c.v=c.v.add(c.a.multiply(a)).multiply(this.damping);c.a=new gVector(0,0)})};Layout.ForceDirected.prototype.updatePosition=function(a){this.eachNode(function(b,c){c.p=c.p.add(c.v.multiply(a))})};Layout.ForceDirected.prototype.totalEnergy=function(){var a=0;this.eachNode(function(b,c){var d=c.v.magnitude();a+=0.5*c.m*d*d});return a};var __bind=function(a,b){return function(){return a.apply(b,arguments)}};
Layout.requestAnimationFrame=__bind(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,10)},window);
Layout.ForceDirected.prototype.start=function(a,b,c){var d=this;this._started||(this._started=!0,Layout.requestAnimationFrame(function f(){d.applyCoulombsLaw();d.applyHookesLaw();d.attractToCentre();d.updateVelocity(0.03);d.updatePosition(0.03);"undefined"!==typeof b&&b();0.01>d.totalEnergy()?(d._started=!1,"undefined"!==typeof c&&c()):Layout.requestAnimationFrame(f)}))};
Layout.ForceDirected.prototype.nearest=function(a){var b={node:null,point:null,distance:null},c=this;this.graph.nodes.forEach(function(d){var e=c.point(d),f=e.p.subtract(a).magnitude();if(null===b.distance||f<b.distance)b={node:d,point:e,distance:f}});return b};
Layout.ForceDirected.prototype.getBoundingBox=function(){var a=new gVector(-2,-2),b=new gVector(2,2);this.eachNode(function(c,e){e.p.x<a.x&&(a.x=e.p.x);e.p.y<a.y&&(a.y=e.p.y);e.p.x>b.x&&(b.x=e.p.x);e.p.y>b.y&&(b.y=e.p.y)});var c=b.subtract(a).multiply(0.07);return{bottomleft:a.subtract(c),topright:b.add(c)}};gVector=function(a,b){this.x=a;this.y=b};gVector.random=function(){return new gVector(10*(Math.random()-0.5),10*(Math.random()-0.5))};
gVector.prototype.add=function(a){return new gVector(this.x+a.x,this.y+a.y)};gVector.prototype.subtract=function(a){return new gVector(this.x-a.x,this.y-a.y)};gVector.prototype.multiply=function(a){return new gVector(this.x*a,this.y*a)};gVector.prototype.divide=function(a){return new gVector(this.x/a||0,this.y/a||0)};gVector.prototype.magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};gVector.prototype.normal=function(){return new gVector(-this.y,this.x)};
gVector.prototype.normalise=function(){return this.divide(this.magnitude())};Layout.ForceDirected.Point=function(a,b){this.p=a;this.m=b;this.v=new gVector(0,0);this.a=new gVector(0,0)};Layout.ForceDirected.Point.prototype.applyForce=function(a){this.a=this.a.add(a.divide(this.m))};Layout.ForceDirected.Spring=function(a,b,c,d){this.point1=a;this.point2=b;this.length=c;this.k=d};
function Renderer(a,b,c,d,e){this.interval=a;this.layout=b;this.clear=c;this.drawEdge=d;this.drawNode=e;this.layout.graph.addGraphListener(this)}Renderer.prototype.graphChanged=function(){this.start()};Renderer.prototype.start=function(){var a=this;this.layout.start(50,function(){a.clear();a.layout.eachEdge(function(b,c){a.drawEdge(b,c.point1.p,c.point2.p)});a.layout.eachNode(function(b,c){a.drawNode(b,c.p)})})};var mxClient={VERSION:"2.2.0.1",IS_IE:0<=navigator.userAgent.indexOf("MSIE"),IS_IE6:0<=navigator.userAgent.indexOf("MSIE 6"),IS_QUIRKS:0<=navigator.userAgent.indexOf("MSIE")&&(null==document.documentMode||5==document.documentMode),VML_PREFIX:"v",OFFICE_PREFIX:"o",IS_NS:0<=navigator.userAgent.indexOf("Mozilla/")&&0>navigator.userAgent.indexOf("MSIE"),IS_OP:0<=navigator.userAgent.indexOf("Opera/"),IS_OT:0>navigator.userAgent.indexOf("Presto/2.4.")&&0>navigator.userAgent.indexOf("Presto/2.3.")&&0>navigator.userAgent.indexOf("Presto/2.2.")&&
0>navigator.userAgent.indexOf("Presto/2.1.")&&0>navigator.userAgent.indexOf("Presto/2.0.")&&0>navigator.userAgent.indexOf("Presto/1."),IS_SF:0<=navigator.userAgent.indexOf("AppleWebKit/")&&0>navigator.userAgent.indexOf("Chrome/"),IS_IOS:navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,IS_GC:0<=navigator.userAgent.indexOf("Chrome/"),IS_FF:0<=navigator.userAgent.indexOf("Firefox/"),IS_MT:0<=navigator.userAgent.indexOf("Firefox/")&&0>navigator.userAgent.indexOf("Firefox/1.")&&0>navigator.userAgent.indexOf("Firefox/2.")||
0<=navigator.userAgent.indexOf("Iceweasel/")&&0>navigator.userAgent.indexOf("Iceweasel/1.")&&0>navigator.userAgent.indexOf("Iceweasel/2.")||0<=navigator.userAgent.indexOf("SeaMonkey/")&&0>navigator.userAgent.indexOf("SeaMonkey/1.")||0<=navigator.userAgent.indexOf("Iceape/")&&0>navigator.userAgent.indexOf("Iceape/1."),IS_SVG:0<=navigator.userAgent.indexOf("Firefox/")||0<=navigator.userAgent.indexOf("Iceweasel/")||0<=navigator.userAgent.indexOf("Seamonkey/")||0<=navigator.userAgent.indexOf("Iceape/")||
0<=navigator.userAgent.indexOf("Galeon/")||0<=navigator.userAgent.indexOf("Epiphany/")||0<=navigator.userAgent.indexOf("AppleWebKit/")||0<=navigator.userAgent.indexOf("Gecko/")||0<=navigator.userAgent.indexOf("Opera/")||null!=document.documentMode&&9<=document.documentMode,NO_FO:!document.createElementNS||"[object SVGForeignObjectElement]"!=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")||0<=navigator.userAgent.indexOf("Opera/"),IS_VML:"MICROSOFT INTERNET EXPLORER"==navigator.appName.toUpperCase(),
IS_MAC:0<navigator.userAgent.toUpperCase().indexOf("MACINTOSH"),IS_TOUCH:"ontouchstart"in document.documentElement,IS_POINTER:null!=window.navigator.msPointerEnabled?window.navigator.msPointerEnabled:!1,IS_LOCAL:0>document.location.href.indexOf("http://")&&0>document.location.href.indexOf("https://"),isBrowserSupported:function(){return mxClient.IS_VML||mxClient.IS_SVG},link:function(a,b,c){c=c||document;if(mxClient.IS_IE6)c.write('<link rel="'+a+'" href="'+b+'" charset="ISO-8859-1" type="text/css"/>');
else{var d=c.createElement("link");d.setAttribute("rel",a);d.setAttribute("href",b);d.setAttribute("charset","ISO-8859-1");d.setAttribute("type","text/css");c.getElementsByTagName("head")[0].appendChild(d)}},include:function(a){document.write('<script src="'+a+'"><\/script>')},dispose:function(){for(var a=0;a<mxEvent.objects.length;a++)null!=mxEvent.objects[a].mxListenerList&&mxEvent.removeAllListeners(mxEvent.objects[a])}};"undefined"==typeof mxLoadResources&&(mxLoadResources=!0);
"undefined"==typeof mxResourceExtension&&(mxResourceExtension=".txt");"undefined"==typeof mxLoadStylesheets&&(mxLoadStylesheets=!0);"undefined"!=typeof mxBasePath&&0<mxBasePath.length?("/"==mxBasePath.substring(mxBasePath.length-1)&&(mxBasePath=mxBasePath.substring(0,mxBasePath.length-1)),mxClient.basePath=mxBasePath):mxClient.basePath=".";
"undefined"!=typeof mxImageBasePath&&0<mxImageBasePath.length?("/"==mxImageBasePath.substring(mxImageBasePath.length-1)&&(mxImageBasePath=mxImageBasePath.substring(0,mxImageBasePath.length-1)),mxClient.imageBasePath=mxImageBasePath):mxClient.imageBasePath=mxClient.basePath+"/images";mxClient.language="undefined"!=typeof mxLanguage&&null!=mxLanguage?mxLanguage:mxClient.IS_IE?navigator.userLanguage:navigator.language;
mxClient.defaultLanguage="undefined"!=typeof mxDefaultLanguage&&null!=mxDefaultLanguage?mxDefaultLanguage:"en";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/common.css");"undefined"!=typeof mxLanguages&&null!=mxLanguages&&(mxClient.languages=mxLanguages);
if(mxClient.IS_VML)if(mxClient.IS_SVG)mxClient.IS_VML=!1;else{8==document.documentMode?(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml","#default#VML"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office","#default#VML")):(document.namespaces.add(mxClient.VML_PREFIX,"urn:schemas-microsoft-com:vml"),document.namespaces.add(mxClient.OFFICE_PREFIX,"urn:schemas-microsoft-com:office:office"));var ss=document.createStyleSheet();ss.cssText=
mxClient.VML_PREFIX+"\\:*{behavior:url(#default#VML)}"+mxClient.OFFICE_PREFIX+"\\:*{behavior:url(#default#VML)}";mxLoadStylesheets&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css");window.attachEvent("onunload",mxClient.dispose)}
var mxLog={consoleName:"Console",TRACE:!1,DEBUG:!0,WARN:!0,buffer:"",init:function(){if(null==mxLog.window&&null!=document.body){var a=mxLog.consoleName+" - mxGraph "+mxClient.VERSION,b=document.createElement("table");b.setAttribute("width","100%");b.setAttribute("height","100%");var c=document.createElement("tbody"),d=document.createElement("tr"),e=document.createElement("td");e.style.verticalAlign="top";mxLog.textarea=document.createElement("textarea");mxLog.textarea.setAttribute("readOnly","true");
mxLog.textarea.style.height="100%";mxLog.textarea.style.resize="none";mxLog.textarea.value=mxLog.buffer;mxLog.textarea.style.width=mxClient.IS_NS&&"BackCompat"!=document.compatMode?"99%":"100%";e.appendChild(mxLog.textarea);d.appendChild(e);c.appendChild(d);d=document.createElement("tr");mxLog.td=document.createElement("td");mxLog.td.style.verticalAlign="top";mxLog.td.setAttribute("height","30px");d.appendChild(mxLog.td);c.appendChild(d);b.appendChild(c);mxLog.addButton("Info",function(){mxLog.info()});
mxLog.addButton("DOM",function(a){a=mxUtils.getInnerHtml(document.body);mxLog.debug(a)});mxLog.addButton("Trace",function(){mxLog.TRACE=!mxLog.TRACE;mxLog.TRACE?mxLog.debug("Tracing enabled"):mxLog.debug("Tracing disabled")});mxLog.addButton("Copy",function(){try{mxUtils.copy(mxLog.textarea.value)}catch(a){mxUtils.alert(a)}});mxLog.addButton("Show",function(){try{mxUtils.popup(mxLog.textarea.value)}catch(a){mxUtils.alert(a)}});mxLog.addButton("Clear",function(){mxLog.textarea.value=""});d=c=0;"number"===
typeof window.innerWidth?(c=window.innerHeight,d=window.innerWidth):(c=document.documentElement.clientHeight||document.body.clientHeight,d=document.body.clientWidth);mxLog.window=new mxWindow(a,b,Math.max(0,d-320),Math.max(0,c-210),300,160);mxLog.window.setMaximizable(!0);mxLog.window.setScrollable(!1);mxLog.window.setResizable(!0);mxLog.window.setClosable(!0);mxLog.window.destroyOnClose=!1;if((mxClient.IS_NS||mxClient.IS_IE)&&!mxClient.IS_GC&&!mxClient.IS_SF&&"BackCompat"!=document.compatMode){var f=
mxLog.window.getElement(),a=function(){mxLog.textarea.style.height=Math.max(0,f.offsetHeight-70)+"px"};mxLog.window.addListener(mxEvent.RESIZE_END,a);mxLog.window.addListener(mxEvent.MAXIMIZE,a);mxLog.window.addListener(mxEvent.NORMALIZE,a);mxLog.textarea.style.height="92px"}}},info:function(){mxLog.writeln(mxUtils.toString(navigator))},addButton:function(a,b){var c=document.createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",b);mxLog.td.appendChild(c)},isVisible:function(){return null!=
mxLog.window?mxLog.window.isVisible():!1},show:function(){mxLog.setVisible(!0)},setVisible:function(a){null==mxLog.window&&mxLog.init();null!=mxLog.window&&mxLog.window.setVisible(a)},enter:function(a){if(mxLog.TRACE)return mxLog.writeln("Entering "+a),(new Date).getTime()},leave:function(a,b){if(mxLog.TRACE){var c=0!=b?" ("+((new Date).getTime()-b)+" ms)":"";mxLog.writeln("Leaving "+a+c)}},debug:function(){mxLog.DEBUG&&mxLog.writeln.apply(this,arguments)},warn:function(){mxLog.WARN&&mxLog.writeln.apply(this,
arguments)},write:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");null!=mxLog.textarea?(mxLog.textarea.value+=a,0<=navigator.userAgent.indexOf("Presto/2.5")&&(mxLog.textarea.style.visibility="hidden",mxLog.textarea.style.visibility="visible"),mxLog.textarea.scrollTop=mxLog.textarea.scrollHeight):mxLog.buffer+=a},writeln:function(){for(var a="",b=0;b<arguments.length;b++)a+=arguments[b],b<arguments.length-1&&(a+=" ");mxLog.write(a+"\n")}},mxObjectIdentity=
{FIELD_NAME:"mxObjectId",counter:0,get:function(a){if("object"==typeof a&&null==a[mxObjectIdentity.FIELD_NAME]){var b=mxUtils.getFunctionName(a.constructor);a[mxObjectIdentity.FIELD_NAME]=b+"#"+mxObjectIdentity.counter++}return a[mxObjectIdentity.FIELD_NAME]},clear:function(a){"object"==typeof a&&delete a[mxObjectIdentity.FIELD_NAME]}};function mxDictionary(){this.clear()}mxDictionary.prototype.map=null;mxDictionary.prototype.clear=function(){this.map={}};
mxDictionary.prototype.get=function(a){a=mxObjectIdentity.get(a);return this.map[a]};mxDictionary.prototype.put=function(a,b){var c=mxObjectIdentity.get(a),d=this.map[c];this.map[c]=b;return d};mxDictionary.prototype.remove=function(a){var a=mxObjectIdentity.get(a),b=this.map[a];delete this.map[a];return b};mxDictionary.prototype.getKeys=function(){var a=[],b;for(b in this.map)a.push(b);return a};mxDictionary.prototype.getValues=function(){var a=[],b;for(b in this.map)a.push(this.map[b]);return a};
mxDictionary.prototype.visit=function(a){for(var b in this.map)a(b,this.map[b])};
var mxResources={resources:[],extension:mxResourceExtension,resourcesEncoded:!1,loadDefaultBundle:!0,loadSpecialBundle:!0,isLanguageSupported:function(a){return null!=mxClient.languages?0<=mxUtils.indexOf(mxClient.languages,a):!0},getDefaultBundle:function(a,b){return mxResources.loadDefaultBundle||!mxResources.isLanguageSupported(b)?a+mxResources.extension:null},getSpecialBundle:function(a,b){if(null==mxClient.languages||!this.isLanguageSupported(b)){var c=b.indexOf("-");0<c&&(b=b.substring(0,c))}return mxResources.loadSpecialBundle&&
mxResources.isLanguageSupported(b)&&b!=mxClient.defaultLanguage?a+"_"+b+mxResources.extension:null},add:function(a,b){b=null!=b?b:mxClient.language.toLowerCase();if(b!=mxConstants.NONE){var c=mxResources.getDefaultBundle(a,b);if(null!=c)try{var d=mxUtils.load(c);d.isReady()&&mxResources.parse(d.getText())}catch(e){}c=mxResources.getSpecialBundle(a,b);if(null!=c)try{d=mxUtils.load(c),d.isReady()&&mxResources.parse(d.getText())}catch(f){}}},parse:function(a){if(null!=a)for(var a=a.split("\n"),b=0;b<
a.length;b++)if("#"!=a[b].charAt(0)){var c=a[b].indexOf("=");if(0<c){var d=a[b].substring(0,c),e=a[b].length;13==a[b].charCodeAt(e-1)&&e--;c=a[b].substring(c+1,e);this.resourcesEncoded?(c=c.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),mxResources.resources[d]=unescape(c)):mxResources.resources[d]=c}}},get:function(a,b,c){a=mxResources.resources[a];null==a&&(a=c);if(null!=a&&null!=b){for(var c=[],d=null,e=0;e<a.length;e++){var f=a.charAt(e);"{"==f?d="":null!=d&&"}"==f?(d=parseInt(d)-1,0<=d&&d<b.length&&c.push(b[d]),
d=null):null!=d?d+=f:c.push(f)}a=c.join("")}return a}};function mxPoint(a,b){this.x=null!=a?a:0;this.y=null!=b?b:0}mxPoint.prototype.x=null;mxPoint.prototype.y=null;mxPoint.prototype.equals=function(a){return a.x==this.x&&a.y==this.y};mxPoint.prototype.clone=function(){return mxUtils.clone(this)};function mxRectangle(a,b,c,d){mxPoint.call(this,a,b);this.width=null!=c?c:0;this.height=null!=d?d:0}mxRectangle.prototype=new mxPoint;mxRectangle.prototype.constructor=mxRectangle;
mxRectangle.prototype.width=null;mxRectangle.prototype.height=null;mxRectangle.prototype.setRect=function(a,b,c,d){this.x=a;this.y=b;this.width=c;this.height=d};mxRectangle.prototype.getCenterX=function(){return this.x+this.width/2};mxRectangle.prototype.getCenterY=function(){return this.y+this.height/2};
mxRectangle.prototype.add=function(a){if(null!=a){var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),a=Math.max(this.y+this.height,a.y+a.height);this.x=b;this.y=c;this.width=d-b;this.height=a-c}};mxRectangle.prototype.grow=function(a){this.x-=a;this.y-=a;this.width+=2*a;this.height+=2*a};mxRectangle.prototype.getPoint=function(){return new mxPoint(this.x,this.y)};
mxRectangle.prototype.equals=function(a){return a.x==this.x&&a.y==this.y&&a.width==this.width&&a.height==this.height};
var mxEffects={animateChanges:function(a,b,c){var d=0,e=function(){for(var g=!1,h=0;h<b.length;h++){var k=b[h];if(k instanceof mxGeometryChange||k instanceof mxTerminalChange||k instanceof mxValueChange||k instanceof mxChildChange||k instanceof mxStyleChange){var l=a.getView().getState(k.cell||k.child,!1);if(null!=l)if(g=!0,k.constructor!=mxGeometryChange||a.model.isEdge(k.cell))mxUtils.setOpacity(l.shape.node,100*d/10);else{var m=a.getView().scale,n=(k.geometry.x-k.previous.x)*m,o=(k.geometry.y-
k.previous.y)*m,q=(k.geometry.width-k.previous.width)*m,m=(k.geometry.height-k.previous.height)*m;0==d?(l.x-=n,l.y-=o,l.width-=q,l.height-=m):(l.x+=n/10,l.y+=o/10,l.width+=q/10,l.height+=m/10);a.cellRenderer.redraw(l);mxEffects.cascadeOpacity(a,k.cell,100*d/10)}}}10>d&&g?(d++,window.setTimeout(e,f)):null!=c&&c()},f=30;e()},cascadeOpacity:function(a,b,c){for(var d=a.model.getChildCount(b),e=0;e<d;e++){var f=a.model.getChildAt(b,e),g=a.getView().getState(f);null!=g&&(mxUtils.setOpacity(g.shape.node,
c),mxEffects.cascadeOpacity(a,f,c))}b=a.model.getEdges(b);if(null!=b)for(e=0;e<b.length;e++)d=a.getView().getState(b[e]),null!=d&&mxUtils.setOpacity(d.shape.node,c)},fadeOut:function(a,b,c,d,e,f){var d=d||40,e=e||30,g=b||100;mxUtils.setOpacity(a,g);if(f||null==f){var h=function(){g=Math.max(g-d,0);mxUtils.setOpacity(a,g);0<g?window.setTimeout(h,e):(a.style.visibility="hidden",c&&a.parentNode&&a.parentNode.removeChild(a))};window.setTimeout(h,e)}else a.style.visibility="hidden",c&&a.parentNode&&a.parentNode.removeChild(a)}},
mxUtils={errorResource:"none"!=mxClient.language?"error":"",closeResource:"none"!=mxClient.language?"close":"",errorImage:mxClient.imageBasePath+"/error.gif",removeCursors:function(a){null!=a.style&&(a.style.cursor="");a=a.childNodes;if(null!=a)for(var b=a.length,c=0;c<b;c+=1)mxUtils.removeCursors(a[c])},getCurrentStyle:function(){return mxClient.IS_IE?function(a){return null!=a?a.currentStyle:null}:function(a){return null!=a?window.getComputedStyle(a,""):null}}(),setPrefixedStyle:function(){var a=
null;mxClient.IS_OP&&mxClient.IS_OT?a="O":mxClient.IS_SF||mxClient.IS_GC?a="Webkit":mxClient.IS_MT?a="Moz":mxClient.IS_IE&&9<=document.documentMode&&10>document.documentMode&&(a="ms");return function(b,c,d){b[c]=d;null!=a&&0<c.length&&(c=a+c.substring(0,1).toUpperCase()+c.substring(1),b[c]=d)}}(),hasScrollbars:function(a){a=mxUtils.getCurrentStyle(a);return null!=a&&("scroll"==a.overflow||"auto"==a.overflow)},bind:function(a,b){return function(){return b.apply(a,arguments)}},eval:function(a){var b=
null;if(0<=a.indexOf("function"))try{eval("var _mxJavaScriptExpression="+a),b=_mxJavaScriptExpression,_mxJavaScriptExpression=null}catch(c){mxLog.warn(c.message+" while evaluating "+a)}else try{b=eval(a)}catch(d){mxLog.warn(d.message+" while evaluating "+a)}return b},findNode:function(a,b,c){var d=a.getAttribute(b);if(null!=d&&d==c)return a;for(a=a.firstChild;null!=a;){d=mxUtils.findNode(a,b,c);if(null!=d)return d;a=a.nextSibling}return null},findNodeByAttribute:function(){return 9<=document.documentMode?
function(a,b,c){var d=null;if(null!=a)if(a.nodeType==mxConstants.NODETYPE_ELEMENT&&a.getAttribute(b)==c)d=a;else for(a=a.firstChild;null!=a&&null==d;)d=mxUtils.findNodeByAttribute(a,b,c),a=a.nextSibling;return d}:mxClient.IS_IE?function(a,b,c){return null==a?null:a.ownerDocument.selectSingleNode("//*[@"+b+"='"+c+"']")}:function(a,b,c){return null==a?null:a.ownerDocument.evaluate("//*[@"+b+"='"+c+"']",a.ownerDocument,null,XPathResult.ANY_TYPE,null).iterateNext()}}(),getFunctionName:function(a){var b=
null;if(null!=a)if(null!=a.name)b=a.name;else{a=a.toString();for(b=9;" "==a.charAt(b);)b++;var c=a.indexOf("(",b),b=a.substring(b,c)}return b},indexOf:function(a,b){if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1},remove:function(a,b){var c=null;if("object"==typeof b)for(var d=mxUtils.indexOf(b,a);0<=d;)b.splice(d,1),c=a,d=mxUtils.indexOf(b,a);for(var e in b)b[e]==a&&(delete b[e],c=a);return c},isNode:function(a,b,c,d){return null!=a&&!isNaN(a.nodeType)&&(null==b||a.nodeName.toLowerCase()==
b.toLowerCase())?null==c||a.getAttribute(c)==d:!1},getChildNodes:function(a,b){for(var b=b||mxConstants.NODETYPE_ELEMENT,c=[],d=a.firstChild;null!=d;)d.nodeType==b&&c.push(d),d=d.nextSibling;return c},createXmlDocument:function(){var a=null;document.implementation&&document.implementation.createDocument?a=document.implementation.createDocument("","",null):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLDOM"));return a},parseXml:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||
9>document.documentMode)?function(a){var b=mxUtils.createXmlDocument();b.async="false";b.loadXML(a);return b}:function(a){return(new DOMParser).parseFromString(a,"text/xml")}}(),clearSelection:function(){if(document.selection)return function(){document.selection.empty()};if(window.getSelection)return function(){window.getSelection().removeAllRanges()}}(),getPrettyXml:function(a,b,c){var d=[];if(null!=a)if(b=b||"  ",c=c||"",a.nodeType==mxConstants.NODETYPE_TEXT)d.push(a.nodeValue);else{d.push(c+"<"+
a.nodeName);var e=a.attributes;if(null!=e)for(var f=0;f<e.length;f++){var g=mxUtils.htmlEntities(e[f].nodeValue);d.push(" "+e[f].nodeName+'="'+g+'"')}e=a.firstChild;if(null!=e){for(d.push(">\n");null!=e;)d.push(mxUtils.getPrettyXml(e,b,c+b)),e=e.nextSibling;d.push(c+"</"+a.nodeName+">\n")}else d.push("/>\n")}return d.join("")},removeWhitespace:function(a,b){for(var c=b?a.previousSibling:a.nextSibling;null!=c&&c.nodeType==mxConstants.NODETYPE_TEXT;){var d=b?c.previousSibling:c.nextSibling,e=mxUtils.getTextContent(c);
0==mxUtils.trim(e).length&&c.parentNode.removeChild(c);c=d}},htmlEntities:function(a,b){a=(a||"").replace(/&/g,"&amp;");a=a.replace(/"/g,"&quot;");a=a.replace(/\'/g,"&#39;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");if(null==b||b)a=a.replace(/\n/g,"&#xa;");return a},isVml:function(a){return null!=a&&"urn:schemas-microsoft-com:vml"==a.tagUrn},getXml:function(a,b){var c="";null!=window.XMLSerializer?c=(new XMLSerializer).serializeToString(a):null!=a.xml&&(c=a.xml.replace(/\r\n\t[\t]*/g,"").replace(/>\r\n/g,
">").replace(/\r\n/g,"\n"));return c.replace(/\n/g,b||"&#xa;")},getTextContent:function(a){var b="";null!=a&&(null!=a.firstChild&&(a=a.firstChild),b=a.nodeValue||"");return b},getInnerHtml:function(){return mxClient.IS_IE?function(a){return null!=a?a.innerHTML:""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),getOuterHtml:function(){return mxClient.IS_IE?function(a){if(null!=a){if(null!=a.outerHTML)return a.outerHTML;var b=[];b.push("<"+a.nodeName);var c=a.attributes;
if(null!=c)for(var d=0;d<c.length;d++){var e=c[d].nodeValue;null!=e&&0<e.length&&(b.push(" "),b.push(c[d].nodeName),b.push('="'),b.push(e),b.push('"'))}0==a.innerHTML.length?b.push("/>"):(b.push(">"),b.push(a.innerHTML),b.push("</"+a.nodeName+">"));return b.join("")}return""}:function(a){return null!=a?(new XMLSerializer).serializeToString(a):""}}(),write:function(a,b){var c=a.ownerDocument.createTextNode(b);null!=a&&a.appendChild(c);return c},writeln:function(a,b){var c=a.ownerDocument.createTextNode(b);
null!=a&&(a.appendChild(c),a.appendChild(document.createElement("br")));return c},br:function(a,b){for(var b=b||1,c=null,d=0;d<b;d++)null!=a&&(c=a.ownerDocument.createElement("br"),a.appendChild(c));return c},button:function(a,b,c){c=(null!=c?c:document).createElement("button");mxUtils.write(c,a);mxEvent.addListener(c,"click",function(a){b(a)});return c},para:function(a,b){var c=document.createElement("p");mxUtils.write(c,b);null!=a&&a.appendChild(c);return c},addTransparentBackgroundFilter:function(a){a.style.filter+=
"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+mxClient.imageBasePath+"/transparent.gif', sizingMethod='scale')"},linkAction:function(a,b,c,d,e){return mxUtils.link(a,b,function(){c.execute(d)},e)},linkInvoke:function(a,b,c,d,e,f){return mxUtils.link(a,b,function(){c[d](e)},f)},link:function(a,b,c,d){var e=document.createElement("span");e.style.color="blue";e.style.textDecoration="underline";e.style.cursor="pointer";null!=d&&(e.style.paddingLeft=d+"px");mxEvent.addListener(e,"click",c);
mxUtils.write(e,b);null!=a&&a.appendChild(e);return e},fit:function(a){var b=parseInt(a.offsetLeft),c=parseInt(a.offsetWidth),d=document.body,e=document.documentElement,f=(d.scrollLeft||e.scrollLeft)+(d.clientWidth||e.clientWidth);b+c>f&&(a.style.left=Math.max(d.scrollLeft||e.scrollLeft,f-c)+"px");b=parseInt(a.offsetTop);c=parseInt(a.offsetHeight);f=(d.scrollTop||e.scrollTop)+Math.max(d.clientHeight||0,e.clientHeight);b+c>f&&(a.style.top=Math.max(d.scrollTop||e.scrollTop,f-c)+"px")},open:function(a){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(b){return mxUtils.alert("Permission to read file denied."),
""}var c=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);c.initWithPath(a);if(!c.exists())return mxUtils.alert("File not found."),"";a=Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);a.init(c,1,4,null);c=Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);c.init(a);return c.read(c.available())}c=(new ActiveXObject("Scripting.FileSystemObject")).OpenTextFile(a,
1);a=c.readAll();c.close();return a},save:function(a,b){if(mxClient.IS_NS){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(c){mxUtils.alert("Permission to write file denied.");return}var d=Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);d.initWithPath(a);d.exists()||d.create(0,420);var e=Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);e.init(d,
34,4,null);e.write(b,b.length);e.flush();e.close()}else d=(new ActiveXObject("Scripting.FileSystemObject")).CreateTextFile(a,!0),d.Write(b),d.Close()},saveAs:function(a){var b=document.createElement("iframe");b.setAttribute("src","");b.style.visibility="hidden";document.body.appendChild(b);try{if(mxClient.IS_NS){var c=b.contentDocument;c.open();c.write(a);c.close();try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),b.focus(),saveDocument(c)}catch(d){mxUtils.alert("Permission to save document denied.")}}else c=
b.contentWindow.document,c.write(a),c.execCommand("SaveAs",!1,document.location)}finally{document.body.removeChild(b)}},copy:function(a){if(window.clipboardData)window.clipboardData.setData("Text",a);else{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var b=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(b){var c=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);
if(c){c.addDataFlavor("text/unicode");var d=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);d.data=a;c.setTransferData("text/unicode",d,2*a.length);b.setData(c,null,Components.interfaces.nsIClipboard.kGlobalClipboard)}}}},load:function(a){a=new mxXmlRequest(a,null,"GET",!1);a.send();return a},get:function(a,b,c){return(new mxXmlRequest(a,null,"GET")).send(b,c)},post:function(a,b,c,d){return(new mxXmlRequest(a,b)).send(c,d)},submit:function(a,
b,c,d){return(new mxXmlRequest(a,b)).simulate(c,d)},loadInto:function(a,b,c){mxClient.IS_IE?b.onreadystatechange=function(){4==b.readyState&&c()}:b.addEventListener("load",c,!1);b.load(a)},getValue:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c);return a},getNumber:function(a,b,c){a=null!=a?a[b]:null;null==a&&(a=c||0);return Number(a)},getColor:function(a,b,c){a=null!=a?a[b]:null;null==a?a=c:a==mxConstants.NONE&&(a=null);return a},clone:function(a,b,c){var c=null!=c?c:!1,d=null;if(null!=a&&"function"==
typeof a.constructor){var d=new a.constructor,e;for(e in a)if(e!=mxObjectIdentity.FIELD_NAME&&(null==b||0>mxUtils.indexOf(b,e)))d[e]=!c&&"object"==typeof a[e]?mxUtils.clone(a[e]):a[e]}return d},equalPoints:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c=0;c<a.length;c++)if(a[c]==b[c]||null!=a[c]&&!a[c].equals(b[c]))return!1;return!0},equalEntries:function(a,b){if(null==a&&null!=b||null!=a&&null==b||null!=a&&null!=b&&
a.length!=b.length)return!1;if(null!=a&&null!=b)for(var c in a)if(a[c]!=b[c])return!1;return!0},extend:function(a,b){var c=function(){};c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a},toString:function(a){var b="",c;for(c in a)try{if(null==a[c])b+=c+" = [null]\n";else if("function"==typeof a[c])b+=c+" => [Function]\n";else if("object"==typeof a[c])var d=mxUtils.getFunctionName(a[c].constructor),b=b+(c+" => ["+d+"]\n");else b+=c+" = "+a[c]+"\n"}catch(e){b+=c+"="+e.message}return b},
toRadians:function(a){return Math.PI*a/180},arcToCurves:function(a,b,c,d,e,f,g,h,k){h-=a;k-=b;if(0===c||0===d)return o;var c=Math.abs(c),d=Math.abs(d),l=-h/2,m=-k/2,n=Math.cos(e*Math.PI/180),o=Math.sin(e*Math.PI/180),e=n*l+o*m,l=-1*o*l+n*m,m=e*e,q=l*l,r=c*c,u=d*d,w=m/r+q/u;1<w?(c*=Math.sqrt(w),d*=Math.sqrt(w),f=0):(w=1,f===g&&(w=-1),f=w*Math.sqrt((r*u-r*q-u*m)/(r*q+u*m)));m=f*c*l/d;q=-1*f*d*e/c;h=n*m-o*q+h/2;k=o*m+n*q+k/2;r=Math.atan2((l-q)/d,(e-m)/c)-Math.atan2(0,1);f=0<=r?r:2*Math.PI+r;r=Math.atan2((-l-
q)/d,(-e-m)/c)-Math.atan2((l-q)/d,(e-m)/c);e=0<=r?r:2*Math.PI+r;0==g&&0<e?e-=2*Math.PI:0!=g&&0>e&&(e+=2*Math.PI);for(var g=2*e/Math.PI,g=Math.ceil(0>g?-1*g:g),e=e/g,l=8/3*Math.sin(e/4)*Math.sin(e/4)/Math.sin(e/2),m=n*c,n=n*d,c=c*o,d=d*o,v=Math.cos(f),x=Math.sin(f),q=-l*(m*x+d*v),r=-l*(c*x-n*v),o=[],z=0;z<g;++z){var f=f+e,v=Math.cos(f),x=Math.sin(f),u=m*v-d*x+h,w=c*v+n*x+k,D=-l*(m*x+d*v),v=-l*(c*x-n*v),x=6*z;o[x]=Number(q+a);o[x+1]=Number(r+b);o[x+2]=Number(u-D+a);o[x+3]=Number(w-v+b);o[x+4]=Number(u+
a);o[x+5]=Number(w+b);q=u+D;r=w+v}return o},getBoundingBox:function(a,b){var c=null;if(null!=a&&null!=b&&0!=b){var d=mxUtils.toRadians(b),c=Math.cos(d),e=Math.sin(d),f=new mxPoint(a.x+a.width/2,a.y+a.height/2),g=new mxPoint(a.x,a.y),d=new mxPoint(a.x+a.width,a.y),h=new mxPoint(d.x,a.y+a.height),k=new mxPoint(a.x,h.y),g=mxUtils.getRotatedPoint(g,c,e,f),d=mxUtils.getRotatedPoint(d,c,e,f),h=mxUtils.getRotatedPoint(h,c,e,f),k=mxUtils.getRotatedPoint(k,c,e,f),c=new mxRectangle(g.x,g.y,0,0);c.add(new mxRectangle(d.x,
d.y,0,0));c.add(new mxRectangle(h.x,h.y,0,0));c.add(new mxRectangle(k.x,k.y,0,0))}return c},getRotatedPoint:function(a,b,c,d){var d=null!=d?d:new mxPoint,e=a.x-d.x,a=a.y-d.y;return new mxPoint(e*b-a*c+d.x,a*b+e*c+d.y)},getPortConstraints:function(a,b,c,d){a=mxUtils.getValue(a.style,mxConstants.STYLE_PORT_CONSTRAINT,null);if(null==a)return d;d=a.toString();a=mxConstants.DIRECTION_MASK_NONE;0<=d.indexOf(mxConstants.DIRECTION_NORTH)&&(a|=mxConstants.DIRECTION_MASK_NORTH);0<=d.indexOf(mxConstants.DIRECTION_WEST)&&
(a|=mxConstants.DIRECTION_MASK_WEST);0<=d.indexOf(mxConstants.DIRECTION_SOUTH)&&(a|=mxConstants.DIRECTION_MASK_SOUTH);0<=d.indexOf(mxConstants.DIRECTION_EAST)&&(a|=mxConstants.DIRECTION_MASK_EAST);return a},reversePortConstraints:function(a){var b=0,b=(a&mxConstants.DIRECTION_MASK_WEST)<<3,b=b|(a&mxConstants.DIRECTION_MASK_NORTH)<<1,b=b|(a&mxConstants.DIRECTION_MASK_SOUTH)>>1;return b|(a&mxConstants.DIRECTION_MASK_EAST)>>3},findNearestSegment:function(a,b,c){var d=-1;if(0<a.absolutePoints.length)for(var e=
a.absolutePoints[0],f=null,g=1;g<a.absolutePoints.length;g++){var h=a.absolutePoints[g],e=mxUtils.ptSegDistSq(e.x,e.y,h.x,h.y,b,c);if(null==f||e<f)f=e,d=g-1;e=h}return d},rectangleIntersectsSegment:function(a,b,c){var d=a.y,e=a.x,f=d+a.height,g=e+a.width,a=b.x,h=c.x;b.x>c.x&&(a=c.x,h=b.x);h>g&&(h=g);a<e&&(a=e);if(a>h)return!1;var e=b.y,g=c.y,k=c.x-b.x;1.0E-7<Math.abs(k)&&(c=(c.y-b.y)/k,b=b.y-c*b.x,e=c*a+b,g=c*h+b);e>g&&(b=g,g=e,e=b);g>f&&(g=f);e<d&&(e=d);return e>g?!1:!0},contains:function(a,b,c){return a.x<=
b&&a.x+a.width>=b&&a.y<=c&&a.y+a.height>=c},intersects:function(a,b){var c=a.width,d=a.height,e=b.width,f=b.height;if(0>=e||0>=f||0>=c||0>=d)return!1;var g=a.x,h=a.y,k=b.x,l=b.y,e=e+k,f=f+l,c=c+g,d=d+h;return(e<k||e>g)&&(f<l||f>h)&&(c<g||c>k)&&(d<h||d>l)},intersectsHotspot:function(a,b,c,d,e,f){d=null!=d?d:1;e=null!=e?e:0;f=null!=f?f:0;if(0<d){var g=a.getCenterX(),h=a.getCenterY(),k=a.width,l=a.height,m=mxUtils.getValue(a.style,mxConstants.STYLE_STARTSIZE)*a.view.scale;0<m&&(mxUtils.getValue(a.style,
mxConstants.STYLE_HORIZONTAL,!0)?(h=a.y+m/2,l=m):(g=a.x+m/2,k=m));k=Math.max(e,k*d);l=Math.max(e,l*d);0<f&&(k=Math.min(k,f),l=Math.min(l,f));d=new mxRectangle(g-k/2,h-l/2,k,l);g=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0);0!=g&&(e=Math.cos(-g),f=Math.sin(-g),g=new mxPoint(a.getCenterX(),a.getCenterY()),a=mxUtils.getRotatedPoint(new mxPoint(b,c),e,f,g),b=a.x,c=a.y);return mxUtils.contains(d,b,c)}return!0},getOffset:function(a,b){var c=0,d=0;if(null!=b&&b)var e=document.body,
f=document.documentElement,c=c+(e.scrollLeft||f.scrollLeft),d=d+(e.scrollTop||f.scrollTop);for(;a.offsetParent;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent;return new mxPoint(c,d)},getScrollOrigin:function(a){for(var b=document.body,c=document.documentElement,d=new mxPoint(b.scrollLeft||c.scrollLeft,b.scrollTop||c.scrollTop);null!=a&&a!=b&&a!=c;)!isNaN(a.scrollLeft)&&!isNaN(a.scrollTop)&&(d.x+=a.scrollLeft,d.y+=a.scrollTop),a=a.parentNode;return d},convertPoint:function(a,b,c){var d=mxUtils.getScrollOrigin(a),
a=mxUtils.getOffset(a);a.x-=d.x;a.y-=d.y;return new mxPoint(b-a.x,c-a.y)},ltrim:function(a,b){return a.replace(RegExp("^["+(b||"\\s")+"]+","g"),"")},rtrim:function(a,b){return a.replace(RegExp("["+(b||"\\s")+"]+$","g"),"")},trim:function(a,b){return mxUtils.ltrim(mxUtils.rtrim(a,b),b)},isNumeric:function(a){return null!=a&&(null==a.length||0<a.length&&0>a.indexOf("0x")&&0>a.indexOf("0X"))&&!isNaN(a)},mod:function(a,b){return(a%b+b)%b},intersection:function(a,b,c,d,e,f,g,h){var k=(h-f)*(c-a)-(g-e)*
(d-b),g=((g-e)*(b-f)-(h-f)*(a-e))/k,e=((c-a)*(b-f)-(d-b)*(a-e))/k;return 0<=g&&1>=g&&0<=e&&1>=e?new mxPoint(a+g*(c-a),b+g*(d-b)):null},ptSegDistSq:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;0>=e*c+f*d?c=0:(e=c-e,f=d-f,a=e*c+f*d,c=0>=a?0:a*a/(c*c+d*d));e=e*e+f*f-c;0>e&&(e=0);return e},relativeCcw:function(a,b,c,d,e,f){c-=a;d-=b;e-=a;f-=b;a=e*d-f*c;0==a&&(a=e*c+f*d,0<a&&(a=(e-c)*c+(f-d)*d,0>a&&(a=0)));return 0>a?-1:0<a?1:0},animateChanges:function(a,b){mxEffects.animateChanges.apply(this,arguments)},
cascadeOpacity:function(a,b,c){mxEffects.cascadeOpacity.apply(this,arguments)},fadeOut:function(a,b,c,d,e,f){mxEffects.fadeOut.apply(this,arguments)},setOpacity:function(a,b){mxUtils.isVml(a)?a.style.filter=100<=b?null:"alpha(opacity="+b/5+")":mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?a.style.filter=100<=b?null:"alpha(opacity="+b+")":a.style.opacity=b/100},createImage:function(a){var b=null;mxClient.IS_IE6&&"CSS1Compat"!=document.compatMode?(b=document.createElement(mxClient.VML_PREFIX+
":image"),b.setAttribute("src",a),b.style.borderStyle="none"):(b=document.createElement("img"),b.setAttribute("src",a),b.setAttribute("border","0"));return b},sortCells:function(a,b){var b=null!=b?b:!0,c=new mxDictionary;a.sort(function(a,e){var f=c.get(a);null==f&&(f=mxCellPath.create(a).split(mxCellPath.PATH_SEPARATOR),c.put(a,f));var g=c.get(e);null==g&&(g=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR),c.put(e,g));f=mxCellPath.compare(f,g);return 0==f?0:0<f==b?1:-1});return a},getStylename:function(a){return null!=
a&&(a=a.split(";")[0],0>a.indexOf("="))?a:""},getStylenames:function(a){var b=[];if(null!=a)for(var a=a.split(";"),c=0;c<a.length;c++)0>a[c].indexOf("=")&&b.push(a[c]);return b},indexOfStylename:function(a,b){if(null!=a&&null!=b)for(var c=a.split(";"),d=0,e=0;e<c.length;e++){if(c[e]==b)return d;d+=c[e].length+1}return-1},addStylename:function(a,b){0>mxUtils.indexOfStylename(a,b)&&(null==a?a="":0<a.length&&";"!=a.charAt(a.length-1)&&(a+=";"),a+=b);return a},removeStylename:function(a,b){var c=[];if(null!=
a)for(var d=a.split(";"),e=0;e<d.length;e++)d[e]!=b&&c.push(d[e]);return c.join(";")},removeAllStylenames:function(a){var b=[];if(null!=a)for(var a=a.split(";"),c=0;c<a.length;c++)0<=a[c].indexOf("=")&&b.push(a[c]);return b.join(";")},setCellStyles:function(a,b,c,d){if(null!=b&&0<b.length){a.beginUpdate();try{for(var e=0;e<b.length;e++)if(null!=b[e]){var f=mxUtils.setStyle(a.getStyle(b[e]),c,d);a.setStyle(b[e],f)}}finally{a.endUpdate()}}},setStyle:function(a,b,c){var d=null!=c&&("undefined"==typeof c.length||
0<c.length);if(null==a||0==a.length)d&&(a=b+"="+c);else{var e=a.indexOf(b+"=");0>e?d&&(d=";"==a.charAt(a.length-1)?"":";",a=a+d+b+"="+c):(b=d?b+"="+c:"",c=a.indexOf(";",e),d||c++,a=a.substring(0,e)+b+(c>e?a.substring(c):""))}return a},setCellStyleFlags:function(a,b,c,d,e){if(null!=b&&0<b.length){a.beginUpdate();try{for(var f=0;f<b.length;f++)if(null!=b[f]){var g=mxUtils.setStyleFlag(a.getStyle(b[f]),c,d,e);a.setStyle(b[f],g)}}finally{a.endUpdate()}}},setStyleFlag:function(a,b,c,d){if(null==a||0==
a.length)a=d||null==d?b+"="+c:b+"=0";else{var e=a.indexOf(b+"=");if(0>e)e=";"==a.charAt(a.length-1)?"":";",a=d||null==d?a+e+b+"="+c:a+e+b+"=0";else var f=a.indexOf(";",e),g="",g=0>f?a.substring(e+b.length+1):a.substring(e+b.length+1,f),g=null==d?parseInt(g)^c:d?parseInt(g)|c:parseInt(g)&~c,a=a.substring(0,e)+b+"="+g+(0<=f?a.substring(f):"")}return a},getAlignmentAsPoint:function(a,b){var c=0,d=0;a==mxConstants.ALIGN_CENTER?c=-0.5:a==mxConstants.ALIGN_RIGHT&&(c=-1);b==mxConstants.ALIGN_MIDDLE?d=-0.5:
b==mxConstants.ALIGN_BOTTOM&&(d=-1);return new mxPoint(c,d)},getSizeForString:function(a,b,c,d){var b=null!=b?b:mxConstants.DEFAULT_FONTSIZE,c=null!=c?c:mxConstants.DEFAULT_FONTFAMILY,e=document.createElement("div");e.style.fontFamily=c;e.style.fontSize=Math.round(b)+"px";e.style.lineHeight=Math.round(b*mxConstants.LINE_HEIGHT)+"px";e.style.position="absolute";e.style.visibility="hidden";e.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";e.style.zoom="1";null!=d?(e.style.width=d+"px",e.style.whiteSpace=
"normal"):e.style.whiteSpace="nowrap";e.innerHTML=a;document.body.appendChild(e);a=new mxRectangle(0,0,e.offsetWidth,e.offsetHeight);document.body.removeChild(e);return a},getViewXml:function(a,b,c,d,e){d=null!=d?d:0;e=null!=e?e:0;b=null!=b?b:1;null==c&&(c=[a.getModel().getRoot()]);var f=a.getView(),g=null,h=f.isEventsEnabled();f.setEventsEnabled(!1);var k=f.drawPane,l=f.overlayPane;a.dialect==mxConstants.DIALECT_SVG?(f.drawPane=document.createElementNS(mxConstants.NS_SVG,"g"),f.canvas.appendChild(f.drawPane),
f.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g")):(f.drawPane=f.drawPane.cloneNode(!1),f.canvas.appendChild(f.drawPane),f.overlayPane=f.overlayPane.cloneNode(!1));f.canvas.appendChild(f.overlayPane);var m=f.getTranslate();f.translate=new mxPoint(d,e);b=new mxTemporaryCellStates(a.getView(),b,c);try{g=(new mxCodec).encode(a.getView())}finally{b.destroy(),f.translate=m,f.canvas.removeChild(f.drawPane),f.canvas.removeChild(f.overlayPane),f.drawPane=k,f.overlayPane=l,f.setEventsEnabled(h)}return g},
getScaleForPageCount:function(a,b,c,d){if(1>a)return 1;var c=null!=c?c:mxConstants.PAGE_FORMAT_A4_PORTRAIT,d=null!=d?d:0,e=c.width-2*d,c=c.height-2*d,d=b.getGraphBounds().clone(),b=b.getView().getScale();d.width/=b;d.height/=b;var b=d.width,c=b/d.height/(e/c),d=Math.sqrt(a),f=Math.sqrt(c),c=d*f,d=d/f;if(1>c&&d>a)var g=d/a,d=a,c=c/g;1>d&&c>a&&(g=c/a,c=a,d/=g);g=Math.ceil(c)*Math.ceil(d);for(f=0;g>a;){var g=Math.floor(c)/c,h=Math.floor(d)/d;1==g&&(g=Math.floor(c-1)/c);1==h&&(h=Math.floor(d-1)/d);g=
g>h?g:h;c*=g;d*=g;g=Math.ceil(c)*Math.ceil(d);f++;if(10<f)break}return 0.99999*(e*c/b)},show:function(a,b,c,d){c=null!=c?c:0;d=null!=d?d:0;null==b?b=window.open().document:b.open();var e=a.getGraphBounds(),c=-e.x+c,d=-e.y+d;if(mxClient.IS_IE){for(var e="<html><head>",f=document.getElementsByTagName("base"),g=0;g<f.length;g++)e+=f[g].outerHTML;e+="<style>";for(g=0;g<document.styleSheets.length;g++)try{e+=document.styleSheets(g).cssText}catch(h){}e=e+"</style></head><body>"+a.container.innerHTML;b.writeln(e+
"</body><html>");b.close();a=b.body.getElementsByTagName("DIV")[0];null!=a&&(a.style.position="absolute",a.style.left=c+"px",a.style.top=d+"px")}else{b.writeln("<html");b.writeln("<head>");f=document.getElementsByTagName("base");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));f=document.getElementsByTagName("link");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));f=document.getElementsByTagName("style");for(g=0;g<f.length;g++)b.writeln(mxUtils.getOuterHtml(f[g]));b.writeln("</head>");
b.writeln("</html>");b.close();null==b.body&&b.documentElement.appendChild(b.createElement("body"));b.body.style.overflow="auto";for(a=a.container.firstChild;null!=a;)g=a.cloneNode(!0),b.body.appendChild(g),a=a.nextSibling;a=b.getElementsByTagName("g")[0];null!=a&&(a.setAttribute("transform","translate("+c+","+d+")"),c=a.ownerSVGElement,c.setAttribute("width",e.width+Math.max(e.x,0)+3),c.setAttribute("height",e.height+Math.max(e.y,0)+3))}mxUtils.removeCursors(b.body);return b},printScreen:function(a){var b=
window.open();mxUtils.show(a,b.document);a=function(){b.focus();b.print();b.close()};mxClient.IS_GC?b.setTimeout(a,500):a()},popup:function(a,b){if(b){var c=document.createElement("div");c.style.overflow="scroll";c.style.width="636px";c.style.height="460px";var d=document.createElement("pre");d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");c.appendChild(d);c=new mxWindow("Popup Window",c,document.body.clientWidth/2-320,(document.body.clientHeight||document.documentElement.clientHeight)/
2-240,640,480,!1,!0);c.setClosable(!0);c.setVisible(!0)}else mxClient.IS_NS?(c=window.open(),c.document.writeln("<pre>"+mxUtils.htmlEntities(a)+"</pre"),c.document.close()):(c=window.open(),d=c.document.createElement("pre"),d.innerHTML=mxUtils.htmlEntities(a,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),c.document.body.appendChild(d))},alert:function(a){alert(a)},prompt:function(a,b){return prompt(a,null!=b?b:"")},confirm:function(a){return confirm(a)},error:function(a,b,c,d){var e=document.createElement("div");
e.style.padding="20px";var f=document.createElement("img");f.setAttribute("src",d||mxUtils.errorImage);f.setAttribute("valign","bottom");f.style.verticalAlign="middle";e.appendChild(f);e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));e.appendChild(document.createTextNode("\u00a0"));mxUtils.write(e,a);var a=document.body.clientWidth,d=document.body.clientHeight||document.documentElement.clientHeight,g=new mxWindow(mxResources.get(mxUtils.errorResource)||
mxUtils.errorResource,e,(a-b)/2,d/4,b,null,!1,!0);c&&(mxUtils.br(e),b=document.createElement("p"),c=document.createElement("button"),mxClient.IS_IE?c.style.cssText="float:right":c.setAttribute("style","float:right"),mxEvent.addListener(c,"click",function(){g.destroy()}),mxUtils.write(c,mxResources.get(mxUtils.closeResource)||mxUtils.closeResource),b.appendChild(c),e.appendChild(b),mxUtils.br(e),g.setClosable(!0));g.setVisible(!0);return g},makeDraggable:function(a,b,c,d,e,f,g,h,k,l){a=new mxDragSource(a,
c);a.dragOffset=new mxPoint(null!=e?e:0,null!=f?f:mxConstants.TOOLTIP_VERTICAL_OFFSET);a.autoscroll=g;a.setGuidesEnabled(!1);null!=k&&(a.highlightDropTargets=k);null!=l&&(a.getDropTarget=l);a.getGraphForEvent=function(a){return"function"==typeof b?b(a):b};null!=d&&(a.createDragElement=function(){return d.cloneNode(!0)},h&&(a.createPreviewElement=function(a){var b=d.cloneNode(!0),c=parseInt(b.style.width),e=parseInt(b.style.height);b.style.width=Math.round(c*a.view.scale)+"px";b.style.height=Math.round(e*
a.view.scale)+"px";return b}));return a}},mxConstants={DEFAULT_HOTSPOT:0.3,MIN_HOTSPOT_SIZE:8,MAX_HOTSPOT_SIZE:0,RENDERING_HINT_EXACT:"exact",RENDERING_HINT_FASTER:"faster",RENDERING_HINT_FASTEST:"fastest",DIALECT_SVG:"svg",DIALECT_VML:"vml",DIALECT_MIXEDHTML:"mixedHtml",DIALECT_PREFERHTML:"preferHtml",DIALECT_STRICTHTML:"strictHtml",NS_SVG:"http://www.w3.org/2000/svg",NS_XHTML:"http://www.w3.org/1999/xhtml",NS_XLINK:"http://www.w3.org/1999/xlink",SHADOWCOLOR:"gray",SHADOW_OFFSET_X:2,SHADOW_OFFSET_Y:3,
SHADOW_OPACITY:1,NODETYPE_ELEMENT:1,NODETYPE_ATTRIBUTE:2,NODETYPE_TEXT:3,NODETYPE_CDATA:4,NODETYPE_ENTITY_REFERENCE:5,NODETYPE_ENTITY:6,NODETYPE_PROCESSING_INSTRUCTION:7,NODETYPE_COMMENT:8,NODETYPE_DOCUMENT:9,NODETYPE_DOCUMENTTYPE:10,NODETYPE_DOCUMENT_FRAGMENT:11,NODETYPE_NOTATION:12,TOOLTIP_VERTICAL_OFFSET:16,DEFAULT_VALID_COLOR:"#00FF00",DEFAULT_INVALID_COLOR:"#FF0000",HIGHLIGHT_STROKEWIDTH:3,CURSOR_MOVABLE_VERTEX:"move",CURSOR_MOVABLE_EDGE:"move",CURSOR_LABEL_HANDLE:"default",CURSOR_BEND_HANDLE:"pointer",
CURSOR_CONNECT:"pointer",HIGHLIGHT_COLOR:"#00FF00",CONNECT_TARGET_COLOR:"#0000FF",INVALID_CONNECT_TARGET_COLOR:"#FF0000",DROP_TARGET_COLOR:"#0000FF",VALID_COLOR:"#00FF00",INVALID_COLOR:"#FF0000",EDGE_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_COLOR:"#00FF00",VERTEX_SELECTION_STROKEWIDTH:1,EDGE_SELECTION_STROKEWIDTH:1,VERTEX_SELECTION_DASHED:!0,EDGE_SELECTION_DASHED:!0,GUIDE_COLOR:"#FF0000",GUIDE_STROKEWIDTH:1,OUTLINE_COLOR:"#0099FF",OUTLINE_STROKEWIDTH:mxClient.IS_IE?2:3,HANDLE_SIZE:7,LABEL_HANDLE_SIZE:4,
HANDLE_FILLCOLOR:"#00FF00",HANDLE_STROKECOLOR:"black",LABEL_HANDLE_FILLCOLOR:"yellow",CONNECT_HANDLE_FILLCOLOR:"#0000FF",LOCKED_HANDLE_FILLCOLOR:"#FF0000",OUTLINE_HANDLE_FILLCOLOR:"#00FFFF",OUTLINE_HANDLE_STROKECOLOR:"#0033FF",DEFAULT_FONTFAMILY:"Arial,Helvetica",DEFAULT_FONTSIZE:11,LINE_HEIGHT:1.2,DEFAULT_FONTSTYLE:0,DEFAULT_STARTSIZE:40,DEFAULT_MARKERSIZE:6,DEFAULT_IMAGESIZE:24,ENTITY_SEGMENT:30,RECTANGLE_ROUNDING_FACTOR:0.15,LINE_ARCSIZE:20,ARROW_SPACING:10,ARROW_WIDTH:30,ARROW_SIZE:30,PAGE_FORMAT_A4_PORTRAIT:new mxRectangle(0,
0,826,1169),PAGE_FORMAT_A4_LANDSCAPE:new mxRectangle(0,0,1169,826),PAGE_FORMAT_LETTER_PORTRAIT:new mxRectangle(0,0,850,1100),PAGE_FORMAT_LETTER_LANDSCAPE:new mxRectangle(0,0,1100,850),NONE:"none",STYLE_PERIMETER:"perimeter",STYLE_SOURCE_PORT:"sourcePort",STYLE_TARGET_PORT:"targetPort",STYLE_PORT_CONSTRAINT:"portConstraint",STYLE_OPACITY:"opacity",STYLE_TEXT_OPACITY:"textOpacity",STYLE_OVERFLOW:"overflow",STYLE_ORTHOGONAL:"orthogonal",STYLE_EXIT_X:"exitX",STYLE_EXIT_Y:"exitY",STYLE_EXIT_PERIMETER:"exitPerimeter",
STYLE_ENTRY_X:"entryX",STYLE_ENTRY_Y:"entryY",STYLE_ENTRY_PERIMETER:"entryPerimeter",STYLE_WHITE_SPACE:"whiteSpace",STYLE_ROTATION:"rotation",STYLE_FILLCOLOR:"fillColor",STYLE_SWIMLANE_FILLCOLOR:"swimlaneFillColor",STYLE_GRADIENTCOLOR:"gradientColor",STYLE_GRADIENT_DIRECTION:"gradientDirection",STYLE_STROKECOLOR:"strokeColor",STYLE_SEPARATORCOLOR:"separatorColor",STYLE_STROKEWIDTH:"strokeWidth",STYLE_ALIGN:"align",STYLE_VERTICAL_ALIGN:"verticalAlign",STYLE_LABEL_POSITION:"labelPosition",STYLE_VERTICAL_LABEL_POSITION:"verticalLabelPosition",
STYLE_IMAGE_ASPECT:"imageAspect",STYLE_IMAGE_ALIGN:"imageAlign",STYLE_IMAGE_VERTICAL_ALIGN:"imageVerticalAlign",STYLE_GLASS:"glass",STYLE_IMAGE:"image",STYLE_IMAGE_WIDTH:"imageWidth",STYLE_IMAGE_HEIGHT:"imageHeight",STYLE_IMAGE_BACKGROUND:"imageBackground",STYLE_IMAGE_BORDER:"imageBorder",STYLE_FLIPH:"flipH",STYLE_FLIPV:"flipV",STYLE_NOLABEL:"noLabel",STYLE_NOEDGESTYLE:"noEdgeStyle",STYLE_LABEL_BACKGROUNDCOLOR:"labelBackgroundColor",STYLE_LABEL_BORDERCOLOR:"labelBorderColor",STYLE_LABEL_PADDING:"labelPadding",
STYLE_INDICATOR_SHAPE:"indicatorShape",STYLE_INDICATOR_IMAGE:"indicatorImage",STYLE_INDICATOR_COLOR:"indicatorColor",STYLE_INDICATOR_STROKECOLOR:"indicatorStrokeColor",STYLE_INDICATOR_GRADIENTCOLOR:"indicatorGradientColor",STYLE_INDICATOR_SPACING:"indicatorSpacing",STYLE_INDICATOR_WIDTH:"indicatorWidth",STYLE_INDICATOR_HEIGHT:"indicatorHeight",STYLE_INDICATOR_DIRECTION:"indicatorDirection",STYLE_SHADOW:"shadow",STYLE_SEGMENT:"segment",STYLE_ENDARROW:"endArrow",STYLE_STARTARROW:"startArrow",STYLE_ENDSIZE:"endSize",
STYLE_STARTSIZE:"startSize",STYLE_SWIMLANE_LINE:"swimlaneLine",STYLE_ENDFILL:"endFill",STYLE_STARTFILL:"startFill",STYLE_DASHED:"dashed",STYLE_DASH_PATTERN:"dashPattern",STYLE_ROUNDED:"rounded",STYLE_CURVED:"curved",STYLE_ARCSIZE:"arcSize",STYLE_SMOOTH:"smooth",STYLE_SOURCE_PERIMETER_SPACING:"sourcePerimeterSpacing",STYLE_TARGET_PERIMETER_SPACING:"targetPerimeterSpacing",STYLE_PERIMETER_SPACING:"perimeterSpacing",STYLE_SPACING:"spacing",STYLE_SPACING_TOP:"spacingTop",STYLE_SPACING_LEFT:"spacingLeft",
STYLE_SPACING_BOTTOM:"spacingBottom",STYLE_SPACING_RIGHT:"spacingRight",STYLE_HORIZONTAL:"horizontal",STYLE_DIRECTION:"direction",STYLE_ELBOW:"elbow",STYLE_FONTCOLOR:"fontColor",STYLE_FONTFAMILY:"fontFamily",STYLE_FONTSIZE:"fontSize",STYLE_FONTSTYLE:"fontStyle",STYLE_AUTOSIZE:"autosize",STYLE_FOLDABLE:"foldable",STYLE_EDITABLE:"editable",STYLE_BENDABLE:"bendable",STYLE_MOVABLE:"movable",STYLE_RESIZABLE:"resizable",STYLE_ROTATABLE:"rotatable",STYLE_CLONEABLE:"cloneable",STYLE_DELETABLE:"deletable",
STYLE_SHAPE:"shape",STYLE_EDGE:"edgeStyle",STYLE_LOOP:"loopStyle",STYLE_ROUTING_CENTER_X:"routingCenterX",STYLE_ROUTING_CENTER_Y:"routingCenterY",FONT_BOLD:1,FONT_ITALIC:2,FONT_UNDERLINE:4,FONT_SHADOW:8,SHAPE_RECTANGLE:"rectangle",SHAPE_ELLIPSE:"ellipse",SHAPE_DOUBLE_ELLIPSE:"doubleEllipse",SHAPE_RHOMBUS:"rhombus",SHAPE_LINE:"line",SHAPE_IMAGE:"image",SHAPE_ARROW:"arrow",SHAPE_LABEL:"label",SHAPE_CYLINDER:"cylinder",SHAPE_SWIMLANE:"swimlane",SHAPE_CONNECTOR:"connector",SHAPE_ACTOR:"actor",SHAPE_CLOUD:"cloud",
SHAPE_TRIANGLE:"triangle",SHAPE_HEXAGON:"hexagon",ARROW_CLASSIC:"classic",ARROW_BLOCK:"block",ARROW_OPEN:"open",ARROW_OVAL:"oval",ARROW_DIAMOND:"diamond",ARROW_DIAMOND_THIN:"diamondThin",ALIGN_LEFT:"left",ALIGN_CENTER:"center",ALIGN_RIGHT:"right",ALIGN_TOP:"top",ALIGN_MIDDLE:"middle",ALIGN_BOTTOM:"bottom",DIRECTION_NORTH:"north",DIRECTION_SOUTH:"south",DIRECTION_EAST:"east",DIRECTION_WEST:"west",DIRECTION_MASK_NONE:0,DIRECTION_MASK_WEST:1,DIRECTION_MASK_NORTH:2,DIRECTION_MASK_SOUTH:4,DIRECTION_MASK_EAST:8,
DIRECTION_MASK_ALL:15,ELBOW_VERTICAL:"vertical",ELBOW_HORIZONTAL:"horizontal",EDGESTYLE_ELBOW:"elbowEdgeStyle",EDGESTYLE_ENTITY_RELATION:"entityRelationEdgeStyle",EDGESTYLE_LOOP:"loopEdgeStyle",EDGESTYLE_SIDETOSIDE:"sideToSideEdgeStyle",EDGESTYLE_TOPTOBOTTOM:"topToBottomEdgeStyle",EDGESTYLE_ORTHOGONAL:"orthogonalEdgeStyle",EDGESTYLE_SEGMENT:"segmentEdgeStyle",PERIMETER_ELLIPSE:"ellipsePerimeter",PERIMETER_RECTANGLE:"rectanglePerimeter",PERIMETER_RHOMBUS:"rhombusPerimeter",PERIMETER_TRIANGLE:"trianglePerimeter"};
function mxEventObject(a){this.name=a;this.properties=[];for(var b=1;b<arguments.length;b+=2)null!=arguments[b+1]&&(this.properties[arguments[b]]=arguments[b+1])}mxEventObject.prototype.name=null;mxEventObject.prototype.properties=null;mxEventObject.prototype.consumed=!1;mxEventObject.prototype.getName=function(){return this.name};mxEventObject.prototype.getProperties=function(){return this.properties};mxEventObject.prototype.getProperty=function(a){return this.properties[a]};
mxEventObject.prototype.isConsumed=function(){return this.consumed};mxEventObject.prototype.consume=function(){this.consumed=!0};function mxMouseEvent(a,b){this.evt=a;this.state=b}mxMouseEvent.prototype.consumed=!1;mxMouseEvent.prototype.evt=null;mxMouseEvent.prototype.graphX=null;mxMouseEvent.prototype.graphY=null;mxMouseEvent.prototype.state=null;mxMouseEvent.prototype.getEvent=function(){return this.evt};mxMouseEvent.prototype.getSource=function(){return mxEvent.getSource(this.evt)};
mxMouseEvent.prototype.isSource=function(a){if(null!=a)for(var b=this.getSource();null!=b;){if(b==a.node)return!0;b=b.parentNode}return!1};mxMouseEvent.prototype.getX=function(){return mxEvent.getClientX(this.getEvent())};mxMouseEvent.prototype.getY=function(){return mxEvent.getClientY(this.getEvent())};mxMouseEvent.prototype.getGraphX=function(){return this.graphX};mxMouseEvent.prototype.getGraphY=function(){return this.graphY};mxMouseEvent.prototype.getState=function(){return this.state};
mxMouseEvent.prototype.getCell=function(){var a=this.getState();return null!=a?a.cell:null};mxMouseEvent.prototype.isPopupTrigger=function(){return mxEvent.isPopupTrigger(this.getEvent())};mxMouseEvent.prototype.isConsumed=function(){return this.consumed};mxMouseEvent.prototype.consume=function(a){(null!=a?a:1)&&this.evt.preventDefault&&this.evt.preventDefault();this.evt.returnValue=!1;this.consumed=!0};function mxEventSource(a){this.setEventSource(a)}mxEventSource.prototype.eventListeners=null;
mxEventSource.prototype.eventsEnabled=!0;mxEventSource.prototype.eventSource=null;mxEventSource.prototype.isEventsEnabled=function(){return this.eventsEnabled};mxEventSource.prototype.setEventsEnabled=function(a){this.eventsEnabled=a};mxEventSource.prototype.getEventSource=function(){return this.eventSource};mxEventSource.prototype.setEventSource=function(a){this.eventSource=a};
mxEventSource.prototype.addListener=function(a,b){null==this.eventListeners&&(this.eventListeners=[]);this.eventListeners.push(a);this.eventListeners.push(b)};mxEventSource.prototype.removeListener=function(a){if(null!=this.eventListeners)for(var b=0;b<this.eventListeners.length;)this.eventListeners[b+1]==a?this.eventListeners.splice(b,2):b+=2};
mxEventSource.prototype.fireEvent=function(a,b){if(null!=this.eventListeners&&this.isEventsEnabled()){null==a&&(a=new mxEventObject);null==b&&(b=this.getEventSource());null==b&&(b=this);for(var c=[b,a],d=0;d<this.eventListeners.length;d+=2){var e=this.eventListeners[d];(null==e||e==a.getName())&&this.eventListeners[d+1].apply(this,c)}}};
var mxEvent={objects:[],addListener:function(){var a=function(a,c,d){null==a.mxListenerList&&(a.mxListenerList=[],mxEvent.objects.push(a));a.mxListenerList.push({name:c,f:d})};return window.addEventListener?function(b,c,d){b.addEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.attachEvent("on"+c,d);a(b,c,d)}}(),removeListener:function(){var a=function(a,c,d){if(null!=a.mxListenerList){for(var c=a.mxListenerList.length,e=0;e<c;e++)if(a.mxListenerList[e].f==d){a.mxListenerList.splice(e,1);break}0==
a.mxListenerList.length&&(a.mxListenerList=null,a=mxUtils.indexOf(mxEvent.objects,a),0<=a&&mxEvent.objects.splice(a,1))}};return window.removeEventListener?function(b,c,d){b.removeEventListener(c,d,!1);a(b,c,d)}:function(b,c,d){b.detachEvent("on"+c,d);a(b,c,d)}}(),removeAllListeners:function(a){var b=a.mxListenerList;if(null!=b)for(;0<b.length;){var c=b[0];mxEvent.removeListener(a,c.name,c.f)}},addGestureListeners:function(a,b,c,d){null!=b&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerDown":
"mousedown",b);null!=c&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerMove":"mousemove",c);null!=d&&mxEvent.addListener(a,mxClient.IS_POINTER?"MSPointerUp":"mouseup",d);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=b&&mxEvent.addListener(a,"touchstart",b),null!=c&&mxEvent.addListener(a,"touchmove",c),null!=d&&mxEvent.addListener(a,"touchend",d))},removeGestureListeners:function(a,b,c,d){null!=b&&mxEvent.removeListener(a,mxClient.IS_POINTER?"MSPointerDown":"mousedown",b);null!=c&&mxEvent.removeListener(a,
mxClient.IS_POINTER?"MSPointerMove":"mousemove",c);null!=d&&mxEvent.removeListener(a,mxClient.IS_POINTER?"MSPointerUp":"mouseup",d);!mxClient.IS_POINTER&&mxClient.IS_TOUCH&&(null!=b&&mxEvent.removeListener(a,"touchstart",b),null!=c&&mxEvent.removeListener(a,"touchmove",c),null!=d&&mxEvent.removeListener(a,"touchend",d))},redirectMouseEvents:function(a,b,c,d,e,f,g){var h=function(a){return"function"==typeof c?c(a):c};mxEvent.addGestureListeners(a,function(a){null!=d?d(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_DOWN,
new mxMouseEvent(a,h(a)))},function(a){null!=e?e(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,h(a)))},function(a){null!=f?f(a):mxEvent.isConsumed(a)||b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,h(a)))});mxEvent.addListener(a,"dblclick",function(a){if(null!=g)g(a);else if(!mxEvent.isConsumed(a)){var c=h(a);b.dblClick(a,null!=c?c.cell:null)}})},release:function(a){if(null!=a&&(mxEvent.removeAllListeners(a),a=a.childNodes,null!=a))for(var b=a.length,c=0;c<
b;c+=1)mxEvent.release(a[c])},addMouseWheelListener:function(a){if(null!=a){var b=function(b){null==b&&(b=window.event);var d=0,d=mxClient.IS_FF?-b.detail/2:b.wheelDelta/120;0!=d&&a(b,0<d)};mxClient.IS_NS?mxEvent.addListener(window,mxClient.IS_SF||mxClient.IS_GC?"mousewheel":"DOMMouseScroll",b):mxEvent.addListener(document,"mousewheel",b)}},disableContextMenu:function(){return mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?function(a){mxEvent.addListener(a,"contextmenu",
function(){return!1})}:function(a){a.setAttribute("oncontextmenu","return false;")}}(),getSource:function(a){return null!=a.srcElement?a.srcElement:a.target},isConsumed:function(a){return null!=a.isConsumed&&a.isConsumed},isTouchEvent:function(a){return null!=a.pointerType?a.pointerType===a.MSPOINTER_TYPE_TOUCH:0==a.type.indexOf("touch")},isMouseEvent:function(a){return null!=a.pointerType?a.pointerType===a.MSPOINTER_TYPE_MOUSE:0==a.type.indexOf("mouse")},isLeftMouseButton:function(a){return a.button==
(mxClient.IS_IE&&("undefined"===typeof document.documentMode||9>document.documentMode)?1:0)},isRightMouseButton:function(a){return 2==a.button},isPopupTrigger:function(a){return mxEvent.isRightMouseButton(a)||mxEvent.isShiftDown(a)&&!mxEvent.isControlDown(a)},isShiftDown:function(a){return null!=a?a.shiftKey:!1},isAltDown:function(a){return null!=a?a.altKey:!1},isControlDown:function(a){return null!=a?a.ctrlKey:!1},isMetaDown:function(a){return null!=a?a.metaKey:!1},getMainEvent:function(a){("touchstart"==
a.type||"touchmove"==a.type)&&null!=a.touches&&null!=a.touches[0]?a=a.touches[0]:"touchend"==a.type&&null!=a.changedTouches&&null!=a.changedTouches[0]&&(a=a.changedTouches[0]);return a},getClientX:function(a){return mxEvent.getMainEvent(a).clientX},getClientY:function(a){return mxEvent.getMainEvent(a).clientY},consume:function(a,b,c){c=null!=c?c:!0;if(null!=b?b:1)a.preventDefault?(c&&a.stopPropagation(),a.preventDefault()):c&&(a.cancelBubble=!0);a.isConsumed=!0;a.returnValue=!1},LABEL_HANDLE:-1,ROTATION_HANDLE:-2,
MOUSE_DOWN:"mouseDown",MOUSE_MOVE:"mouseMove",MOUSE_UP:"mouseUp",ACTIVATE:"activate",RESIZE_START:"resizeStart",RESIZE:"resize",RESIZE_END:"resizeEnd",MOVE_START:"moveStart",MOVE:"move",MOVE_END:"moveEnd",PAN_START:"panStart",PAN:"pan",PAN_END:"panEnd",MINIMIZE:"minimize",NORMALIZE:"normalize",MAXIMIZE:"maximize",HIDE:"hide",SHOW:"show",CLOSE:"close",DESTROY:"destroy",REFRESH:"refresh",SIZE:"size",SELECT:"select",FIRED:"fired",FIRE_MOUSE_EVENT:"fireMouseEvent",GESTURE:"gesture",TAP_AND_HOLD:"tapAndHold",
GET:"get",RECEIVE:"receive",CONNECT:"connect",DISCONNECT:"disconnect",SUSPEND:"suspend",RESUME:"resume",MARK:"mark",SESSION:"session",ROOT:"root",POST:"post",OPEN:"open",SAVE:"save",BEFORE_ADD_VERTEX:"beforeAddVertex",ADD_VERTEX:"addVertex",AFTER_ADD_VERTEX:"afterAddVertex",DONE:"done",EXECUTE:"execute",EXECUTED:"executed",BEGIN_UPDATE:"beginUpdate",START_EDIT:"startEdit",END_UPDATE:"endUpdate",END_EDIT:"endEdit",BEFORE_UNDO:"beforeUndo",UNDO:"undo",REDO:"redo",CHANGE:"change",NOTIFY:"notify",LAYOUT_CELLS:"layoutCells",
CLICK:"click",SCALE:"scale",TRANSLATE:"translate",SCALE_AND_TRANSLATE:"scaleAndTranslate",UP:"up",DOWN:"down",ADD:"add",REMOVE:"remove",CLEAR:"clear",ADD_CELLS:"addCells",CELLS_ADDED:"cellsAdded",MOVE_CELLS:"moveCells",CELLS_MOVED:"cellsMoved",RESIZE_CELLS:"resizeCells",CELLS_RESIZED:"cellsResized",TOGGLE_CELLS:"toggleCells",CELLS_TOGGLED:"cellsToggled",ORDER_CELLS:"orderCells",CELLS_ORDERED:"cellsOrdered",REMOVE_CELLS:"removeCells",CELLS_REMOVED:"cellsRemoved",GROUP_CELLS:"groupCells",UNGROUP_CELLS:"ungroupCells",
REMOVE_CELLS_FROM_PARENT:"removeCellsFromParent",FOLD_CELLS:"foldCells",CELLS_FOLDED:"cellsFolded",ALIGN_CELLS:"alignCells",LABEL_CHANGED:"labelChanged",CONNECT_CELL:"connectCell",CELL_CONNECTED:"cellConnected",SPLIT_EDGE:"splitEdge",FLIP_EDGE:"flipEdge",START_EDITING:"startEditing",ADD_OVERLAY:"addOverlay",REMOVE_OVERLAY:"removeOverlay",UPDATE_CELL_SIZE:"updateCellSize",ESCAPE:"escape",CLICK:"click",DOUBLE_CLICK:"doubleClick",START:"start",RESET:"reset"};
function mxXmlRequest(a,b,c,d,e,f){this.url=a;this.params=b;this.method=c||"POST";this.async=null!=d?d:!0;this.username=e;this.password=f}mxXmlRequest.prototype.url=null;mxXmlRequest.prototype.params=null;mxXmlRequest.prototype.method=null;mxXmlRequest.prototype.async=null;mxXmlRequest.prototype.binary=!1;mxXmlRequest.prototype.username=null;mxXmlRequest.prototype.password=null;mxXmlRequest.prototype.request=null;mxXmlRequest.prototype.isBinary=function(){return this.binary};
mxXmlRequest.prototype.setBinary=function(a){this.binary=a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.isReady=function(){return 4==this.request.readyState};mxXmlRequest.prototype.getDocumentElement=function(){var a=this.getXml();return null!=a?a.documentElement:null};
mxXmlRequest.prototype.getXml=function(){var a=this.request.responseXML;if(9<=document.documentMode||null==a||null==a.documentElement)a=mxUtils.parseXml(this.request.responseText);return a};mxXmlRequest.prototype.getText=function(){return this.request.responseText};mxXmlRequest.prototype.getStatus=function(){return this.request.status};
mxXmlRequest.prototype.create=function(){if(window.XMLHttpRequest)return function(){var a=new XMLHttpRequest;this.isBinary()&&a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined");return a};if("undefined"!=typeof ActiveXObject)return function(){return new ActiveXObject("Microsoft.XMLHTTP")}}();
mxXmlRequest.prototype.send=function(a){this.request=this.create();null!=this.request&&(null!=a&&(this.request.onreadystatechange=mxUtils.bind(this,function(){this.isReady()&&(a(this),this.onreadystatechaange=null)})),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),this.request.send(this.params))};mxXmlRequest.prototype.setRequestHeaders=function(a,b){null!=b&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")};
mxXmlRequest.prototype.simulate=function(a,b){var a=a||document,c=null;a==document&&(c=window.onbeforeunload,window.onbeforeunload=null);var d=a.createElement("form");d.setAttribute("method",this.method);d.setAttribute("action",this.url);null!=b&&d.setAttribute("target",b);d.style.display="none";d.style.visibility="hidden";for(var e=0<this.params.indexOf("&")?this.params.split("&"):this.params.split(),f=0;f<e.length;f++){var g=e[f].indexOf("=");if(0<g){var h=e[f].substring(0,g),k=e[f].substring(g+
1),g=a.createElement("textarea");g.setAttribute("name",h);k=k.replace(/\n/g,"&#xa;");h=a.createTextNode(k);g.appendChild(h);d.appendChild(g)}}a.body.appendChild(d);d.submit();a.body.removeChild(d);null!=c&&(window.onbeforeunload=c)};
var mxClipboard={STEPSIZE:10,insertCount:1,cells:null,setCells:function(a){mxClipboard.cells=a},getCells:function(){return mxClipboard.cells},isEmpty:function(){return null==mxClipboard.getCells()},cut:function(a,b){b=mxClipboard.copy(a,b);mxClipboard.insertCount=0;mxClipboard.removeCells(a,b);return b},removeCells:function(a,b){a.removeCells(b)},copy:function(a,b){var b=b||a.getSelectionCells(),c=a.getExportableCells(b);mxClipboard.insertCount=1;mxClipboard.setCells(a.cloneCells(c));return c},paste:function(a){if(!mxClipboard.isEmpty()){var b=
a.getImportableCells(mxClipboard.getCells()),c=mxClipboard.insertCount*mxClipboard.STEPSIZE,d=a.getDefaultParent(),b=a.importCells(b,c,c,d);mxClipboard.insertCount++;a.setSelectionCells(b)}}};
function mxWindow(a,b,c,d,e,f,g,h,k,l){null!=b&&(g=null!=g?g:!0,this.content=b,this.init(c,d,e,f,l),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(g),this.setTitle(a),(null==h||h)&&this.installMoveHandler(),null!=k&&null!=k.parentNode?k.parentNode.replaceChild(this.div,k):document.body.appendChild(this.div))}mxWindow.prototype=new mxEventSource;mxWindow.prototype.constructor=mxWindow;mxWindow.prototype.closeImage=mxClient.imageBasePath+"/close.gif";
mxWindow.prototype.minimizeImage=mxClient.imageBasePath+"/minimize.gif";mxWindow.prototype.normalizeImage=mxClient.imageBasePath+"/normalize.gif";mxWindow.prototype.maximizeImage=mxClient.imageBasePath+"/maximize.gif";mxWindow.prototype.resizeImage=mxClient.imageBasePath+"/resize.gif";mxWindow.prototype.visible=!1;mxWindow.prototype.minimumSize=new mxRectangle(0,0,50,40);mxWindow.prototype.destroyOnClose=!0;
mxWindow.prototype.contentHeightCorrection=8==document.documentMode||7==document.documentMode?6:2;mxWindow.prototype.title=null;mxWindow.prototype.content=null;
mxWindow.prototype.init=function(a,b,c,d,e){e=null!=e?e:"mxWindow";this.div=document.createElement("div");this.div.className=e;this.div.style.left=a+"px";this.div.style.top=b+"px";this.table=document.createElement("table");this.table.className=e;mxClient.IS_POINTER&&(this.div.style.msTouchAction="none");null!=c&&(mxClient.IS_QUIRKS||(this.div.style.width=c+"px"),this.table.style.width=c+"px");null!=d&&(mxClient.IS_QUIRKS||(this.div.style.height=d+"px"),this.table.style.height=d+"px");a=document.createElement("tbody");
b=document.createElement("tr");this.title=document.createElement("td");this.title.className=e+"Title";b.appendChild(this.title);a.appendChild(b);b=document.createElement("tr");this.td=document.createElement("td");this.td.className=e+"Pane";7==document.documentMode&&(this.td.style.height="100%");this.contentWrapper=document.createElement("div");this.contentWrapper.className=e+"Pane";this.contentWrapper.style.width="100%";this.contentWrapper.appendChild(this.content);if(mxClient.IS_QUIRKS||"DIV"!=this.content.nodeName.toUpperCase())this.contentWrapper.style.height=
"100%";this.td.appendChild(this.contentWrapper);b.appendChild(this.td);a.appendChild(b);this.table.appendChild(a);this.div.appendChild(this.table);e=mxUtils.bind(this,function(){this.activate()});mxEvent.addGestureListeners(this.title,e);mxEvent.addGestureListeners(this.table,e);this.hide()};mxWindow.prototype.setTitle=function(a){for(var b=this.title.firstChild;null!=b;){var c=b.nextSibling;b.nodeType==mxConstants.NODETYPE_TEXT&&b.parentNode.removeChild(b);b=c}mxUtils.write(this.title,a||"")};
mxWindow.prototype.setScrollable=function(a){0>navigator.userAgent.indexOf("Presto/2.5")&&(this.contentWrapper.style.overflow=a?"auto":"hidden")};
mxWindow.prototype.activate=function(){if(mxWindow.activeWindow!=this){var a=mxUtils.getCurrentStyle(this.getElement()),a=null!=a?a.zIndex:3;if(mxWindow.activeWindow){var b=mxWindow.activeWindow.getElement();null!=b&&null!=b.style&&(b.style.zIndex=a)}b=mxWindow.activeWindow;this.getElement().style.zIndex=parseInt(a)+1;mxWindow.activeWindow=this;this.fireEvent(new mxEventObject(mxEvent.ACTIVATE,"previousWindow",b))}};mxWindow.prototype.getElement=function(){return this.div};
mxWindow.prototype.fit=function(){mxUtils.fit(this.div)};mxWindow.prototype.isResizable=function(){return null!=this.resize?"none"!=this.resize.style.display:!1};
mxWindow.prototype.setResizable=function(a){if(a)if(null==this.resize){this.resize=document.createElement("img");this.resize.style.position="absolute";this.resize.style.bottom="2px";this.resize.style.right="2px";this.resize.setAttribute("src",mxClient.imageBasePath+"/resize.gif");this.resize.style.cursor="nw-resize";var b=null,c=null,d=null,e=null,a=mxUtils.bind(this,function(a){this.activate();b=mxEvent.getClientX(a);c=mxEvent.getClientY(a);d=this.div.offsetWidth;e=this.div.offsetHeight;mxEvent.addGestureListeners(document,
null,f,g);this.fireEvent(new mxEventObject(mxEvent.RESIZE_START,"event",a));mxEvent.consume(a)}),f=mxUtils.bind(this,function(a){if(null!=b&&null!=c){var f=mxEvent.getClientX(a)-b,g=mxEvent.getClientY(a)-c;this.setSize(d+f,e+g);this.fireEvent(new mxEventObject(mxEvent.RESIZE,"event",a));mxEvent.consume(a)}}),g=mxUtils.bind(this,function(a){null!=b&&null!=c&&(c=b=null,mxEvent.removeGestureListeners(document,null,f,g),this.fireEvent(new mxEventObject(mxEvent.RESIZE_END,"event",a)),mxEvent.consume(a))});
mxEvent.addGestureListeners(this.resize,a,f,g);this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")};
mxWindow.prototype.setSize=function(a,b){a=Math.max(this.minimumSize.width,a);b=Math.max(this.minimumSize.height,b);mxClient.IS_QUIRKS||(this.div.style.width=a+"px",this.div.style.height=b+"px");this.table.style.width=a+"px";this.table.style.height=b+"px";mxClient.IS_QUIRKS||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px")};mxWindow.prototype.setMinimizable=function(a){this.minimize.style.display=a?"":"none"};
mxWindow.prototype.getMinimumSize=function(){return new mxRectangle(0,0,0,this.title.offsetHeight)};
mxWindow.prototype.installMinimizeHandler=function(){this.minimize=document.createElement("img");this.minimize.setAttribute("src",this.minimizeImage);this.minimize.setAttribute("align","right");this.minimize.setAttribute("title","Minimize");this.minimize.style.cursor="pointer";this.minimize.style.marginRight="1px";this.minimize.style.display="none";this.title.appendChild(this.minimize);var a=!1,b=null,c=null,d=mxUtils.bind(this,function(d){this.activate();if(a)a=!1,this.minimize.setAttribute("src",
this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",this.maximize.style.display=b,mxClient.IS_QUIRKS||(this.div.style.height=c),this.table.style.height=c,null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",d));else{a=!0;this.minimize.setAttribute("src",this.normalizeImage);this.minimize.setAttribute("title","Normalize");this.contentWrapper.style.display="none";b=this.maximize.style.display;
this.maximize.style.display="none";c=this.table.style.height;var f=this.getMinimumSize();0<f.height&&(mxClient.IS_QUIRKS||(this.div.style.height=f.height+"px"),this.table.style.height=f.height+"px");0<f.width&&(mxClient.IS_QUIRKS||(this.div.style.width=f.width+"px"),this.table.style.width=f.width+"px");null!=this.resize&&(this.resize.style.visibility="hidden");this.fireEvent(new mxEventObject(mxEvent.MINIMIZE,"event",d))}mxEvent.consume(d)});mxEvent.addGestureListeners(this.minimize,d)};
mxWindow.prototype.setMaximizable=function(a){this.maximize.style.display=a?"":"none"};
mxWindow.prototype.installMaximizeHandler=function(){this.maximize=document.createElement("img");this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("align","right");this.maximize.setAttribute("title","Maximize");this.maximize.style.cursor="default";this.maximize.style.marginLeft="1px";this.maximize.style.cursor="pointer";this.maximize.style.display="none";this.title.appendChild(this.maximize);var a=!1,b=null,c=null,d=null,e=null,f=mxUtils.bind(this,function(f){this.activate();
if("none"!=this.maximize.style.display){if(a){a=!1;this.maximize.setAttribute("src",this.maximizeImage);this.maximize.setAttribute("title","Maximize");this.contentWrapper.style.display="";this.minimize.style.visibility="";this.div.style.left=b+"px";this.div.style.top=c+"px";if(!mxClient.IS_QUIRKS&&(this.div.style.height=d,this.div.style.width=e,h=mxUtils.getCurrentStyle(this.contentWrapper),"auto"==h.overflow||null!=this.resize))this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-
this.contentHeightCorrection+"px";this.table.style.height=d;this.table.style.width=e;null!=this.resize&&(this.resize.style.visibility="");this.fireEvent(new mxEventObject(mxEvent.NORMALIZE,"event",f))}else{a=!0;this.maximize.setAttribute("src",this.normalizeImage);this.maximize.setAttribute("title","Normalize");this.contentWrapper.style.display="";this.minimize.style.visibility="hidden";b=parseInt(this.div.style.left);c=parseInt(this.div.style.top);d=this.table.style.height;e=this.table.style.width;
this.div.style.left="0px";this.div.style.top="0px";h=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);mxClient.IS_QUIRKS||(this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=h-2+"px");this.table.style.width=document.body.clientWidth-2+"px";this.table.style.height=h-2+"px";null!=this.resize&&(this.resize.style.visibility="hidden");if(!mxClient.IS_QUIRKS){var h=mxUtils.getCurrentStyle(this.contentWrapper);if("auto"==h.overflow||null!=this.resize)this.contentWrapper.style.height=
this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px"}this.fireEvent(new mxEventObject(mxEvent.MAXIMIZE,"event",f))}mxEvent.consume(f)}});mxEvent.addGestureListeners(this.maximize,f);mxEvent.addListener(this.title,"dblclick",f)};
mxWindow.prototype.installMoveHandler=function(){this.title.style.cursor="move";mxEvent.addGestureListeners(this.title,mxUtils.bind(this,function(a){var b=mxEvent.getClientX(a),c=mxEvent.getClientY(a),d=this.getX(),e=this.getY(),f=mxUtils.bind(this,function(a){var f=mxEvent.getClientX(a)-b,g=mxEvent.getClientY(a)-c;this.setLocation(d+f,e+g);this.fireEvent(new mxEventObject(mxEvent.MOVE,"event",a));mxEvent.consume(a)}),g=mxUtils.bind(this,function(a){mxEvent.removeGestureListeners(document,null,f,
g);this.fireEvent(new mxEventObject(mxEvent.MOVE_END,"event",a));mxEvent.consume(a)});mxEvent.addGestureListeners(document,null,f,g);this.fireEvent(new mxEventObject(mxEvent.MOVE_START,"event",a));mxEvent.consume(a)}));mxClient.IS_POINTER&&(this.title.style.msTouchAction="none")};mxWindow.prototype.setLocation=function(a,b){this.div.style.left=a+"px";this.div.style.top=b+"px"};mxWindow.prototype.getX=function(){return parseInt(this.div.style.left)};mxWindow.prototype.getY=function(){return parseInt(this.div.style.top)};
mxWindow.prototype.installCloseHandler=function(){this.closeImg=document.createElement("img");this.closeImg.setAttribute("src",this.closeImage);this.closeImg.setAttribute("align","right");this.closeImg.setAttribute("title","Close");this.closeImg.style.marginLeft="2px";this.closeImg.style.cursor="pointer";this.closeImg.style.display="none";this.title.insertBefore(this.closeImg,this.title.firstChild);mxEvent.addGestureListeners(this.closeImg,mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.CLOSE,
"event",a));this.destroyOnClose?this.destroy():this.setVisible(!1);mxEvent.consume(a)}))};mxWindow.prototype.setImage=function(a){this.image=document.createElement("img");this.image.setAttribute("src",a);this.image.setAttribute("align","left");this.image.style.marginRight="4px";this.image.style.marginLeft="0px";this.image.style.marginTop="-2px";this.title.insertBefore(this.image,this.title.firstChild)};mxWindow.prototype.setClosable=function(a){this.closeImg.style.display=a?"":"none"};
mxWindow.prototype.isVisible=function(){return null!=this.div?"hidden"!=this.div.style.visibility:!1};mxWindow.prototype.setVisible=function(a){null!=this.div&&this.isVisible()!=a&&(a?this.show():this.hide())};
mxWindow.prototype.show=function(){this.div.style.visibility="";this.activate();var a=mxUtils.getCurrentStyle(this.contentWrapper);if(!mxClient.IS_QUIRKS&&("auto"==a.overflow||null!=this.resize))this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight-this.contentHeightCorrection+"px";this.fireEvent(new mxEventObject(mxEvent.SHOW))};mxWindow.prototype.hide=function(){this.div.style.visibility="hidden";this.fireEvent(new mxEventObject(mxEvent.HIDE))};
mxWindow.prototype.destroy=function(){this.fireEvent(new mxEventObject(mxEvent.DESTROY));null!=this.div&&(mxEvent.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null);this.contentWrapper=this.content=this.title=null};function mxForm(a){this.table=document.createElement("table");this.table.className=a;this.body=document.createElement("tbody");this.table.appendChild(this.body)}mxForm.prototype.table=null;mxForm.prototype.body=!1;mxForm.prototype.getTable=function(){return this.table};
mxForm.prototype.addButtons=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");c.appendChild(d);var d=document.createElement("td"),e=document.createElement("button");mxUtils.write(e,mxResources.get("ok")||"OK");d.appendChild(e);mxEvent.addListener(e,"click",function(){a()});e=document.createElement("button");mxUtils.write(e,mxResources.get("cancel")||"Cancel");d.appendChild(e);mxEvent.addListener(e,"click",function(){b()});c.appendChild(d);this.body.appendChild(c)};
mxForm.prototype.addText=function(a,b){var c=document.createElement("input");c.setAttribute("type","text");c.value=b;return this.addField(a,c)};mxForm.prototype.addCheckbox=function(a,b){var c=document.createElement("input");c.setAttribute("type","checkbox");this.addField(a,c);b&&(c.checked=!0);return c};mxForm.prototype.addTextarea=function(a,b,c){var d=document.createElement("textarea");mxClient.IS_NS&&c--;d.setAttribute("rows",c||2);d.value=b;return this.addField(a,d)};
mxForm.prototype.addCombo=function(a,b,c){var d=document.createElement("select");null!=c&&d.setAttribute("size",c);b&&d.setAttribute("multiple","true");return this.addField(a,d)};mxForm.prototype.addOption=function(a,b,c,d){var e=document.createElement("option");mxUtils.writeln(e,b);e.setAttribute("value",c);d&&e.setAttribute("selected",d);a.appendChild(e)};
mxForm.prototype.addField=function(a,b){var c=document.createElement("tr"),d=document.createElement("td");mxUtils.write(d,a);c.appendChild(d);d=document.createElement("td");d.appendChild(b);c.appendChild(d);this.body.appendChild(c);return b};function mxImage(a,b,c){this.src=a;this.width=b;this.height=c}mxImage.prototype.src=null;mxImage.prototype.width=null;mxImage.prototype.height=null;
function mxDivResizer(a,b){if("div"==a.nodeName.toLowerCase()){null==b&&(b=window);this.div=a;var c=mxUtils.getCurrentStyle(a);null!=c&&(this.resizeWidth="auto"==c.width,this.resizeHeight="auto"==c.height);mxEvent.addListener(b,"resize",mxUtils.bind(this,function(){this.handlingResize||(this.handlingResize=!0,this.resize(),this.handlingResize=!1)}));this.resize()}}mxDivResizer.prototype.resizeWidth=!0;mxDivResizer.prototype.resizeHeight=!0;mxDivResizer.prototype.handlingResize=!1;
mxDivResizer.prototype.resize=function(){var a=this.getDocumentWidth(),b=this.getDocumentHeight(),c=parseInt(this.div.style.left),d=parseInt(this.div.style.right),e=parseInt(this.div.style.top),f=parseInt(this.div.style.bottom);this.resizeWidth&&!isNaN(c)&&!isNaN(d)&&0<=c&&0<=d&&0<a-d-c&&(this.div.style.width=a-d-c+"px");this.resizeHeight&&!isNaN(e)&&!isNaN(f)&&0<=e&&0<=f&&0<b-e-f&&(this.div.style.height=b-e-f+"px")};mxDivResizer.prototype.getDocumentWidth=function(){return document.body.clientWidth};
mxDivResizer.prototype.getDocumentHeight=function(){return document.body.clientHeight};function mxDragSource(a,b){this.element=a;this.dropHandler=b;mxEvent.addGestureListeners(a,mxUtils.bind(this,function(a){this.mouseDown(a)}))}mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=!0;mxDragSource.prototype.currentGraph=null;
mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=!0;mxDragSource.prototype.guidesEnabled=!0;mxDragSource.prototype.gridEnabled=!0;mxDragSource.prototype.highlightDropTargets=!0;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};
mxDragSource.prototype.setEnabled=function(a){this.enabled=a};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(a){this.guidesEnabled=a};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxDragSource.prototype.getGraphForEvent=function(){return null};mxDragSource.prototype.getDropTarget=function(a,b,c){return a.getCellAt(b,c)};
mxDragSource.prototype.createDragElement=function(){return this.element.cloneNode(!0)};mxDragSource.prototype.createPreviewElement=function(){return null};
mxDragSource.prototype.mouseDown=function(a){this.enabled&&!mxEvent.isConsumed(a)&&null==this.mouseMoveHandler&&(this.startDrag(a),this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove),this.mouseUpHandler=mxUtils.bind(this,this.mouseUp),mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(a)&&(this.eventSource=mxEvent.getSource(a),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)),
mxEvent.consume(a,!0,!1))};mxDragSource.prototype.startDrag=function(a){this.dragElement=this.createDragElement(a);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(){null!=this.dragElement&&(null!=this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)};
mxDragSource.prototype.graphContainsEvent=function(a,b){var c=mxEvent.getClientX(b),d=mxEvent.getClientY(b),e=mxUtils.getOffset(a.container),f=mxUtils.getScrollOrigin();return c>=e.x-f.x&&d>=e.y-f.y&&c<=e.x-f.x+a.container.offsetWidth&&d<=e.y-f.y+a.container.offsetHeight};
mxDragSource.prototype.mouseMove=function(a){var b=this.getGraphForEvent(a);null!=b&&!this.graphContainsEvent(b,a)&&(b=null);b!=this.currentGraph&&(null!=this.currentGraph&&this.dragExit(this.currentGraph,a),this.currentGraph=b,null!=this.currentGraph&&this.dragEnter(this.currentGraph,a));null!=this.currentGraph&&this.dragOver(this.currentGraph,a);if(null!=this.dragElement&&(null==this.previewElement||"visible"!=this.previewElement.style.visibility)){var b=mxEvent.getClientX(a),c=mxEvent.getClientY(a);
null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement);this.dragElement.style.visibility="visible";null!=this.dragOffset&&(b+=this.dragOffset.x,c+=this.dragOffset.y);b+=document.body.scrollLeft||document.documentElement.scrollLeft;c+=document.body.scrollTop||document.documentElement.scrollTop;this.dragElement.style.left=b+"px";this.dragElement.style.top=c+"px"}else null!=this.dragElement&&(this.dragElement.style.visibility="hidden");mxEvent.consume(a)};
mxDragSource.prototype.mouseUp=function(a){if(null!=this.currentGraph){if(null!=this.currentPoint&&(null==this.previewElement||"hidden"!=this.previewElement.style.visibility)){var b=this.currentGraph.view.scale,c=this.currentGraph.view.translate;this.drop(this.currentGraph,a,this.currentDropTarget,this.currentPoint.x/b-c.x,this.currentPoint.y/b-c.y)}this.dragExit(this.currentGraph)}this.stopDrag(a);null!=this.eventSource&&(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,
this.mouseUpHandler),this.eventSource=null);mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);this.currentGraph=this.mouseUpHandler=this.mouseMoveHandler=null;mxEvent.consume(a)};
mxDragSource.prototype.dragEnter=function(a,b){a.isMouseDown=!0;a.isMouseTrigger=mxEvent.isMouseEvent(b);this.previewElement=this.createPreviewElement(a);this.isGuidesEnabled()&&null!=this.previewElement&&(this.currentGuide=new mxGuide(a,a.graphHandler.getGuideStates()));this.highlightDropTargets&&(this.currentHighlight=new mxCellHighlight(a,mxConstants.DROP_TARGET_COLOR))};
mxDragSource.prototype.dragExit=function(a){this.currentPoint=this.currentDropTarget=null;a.isMouseDown=!1;null!=this.previewElement&&(null!=this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null);null!=this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null);null!=this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)};
mxDragSource.prototype.dragOver=function(a,b){var c=mxUtils.getOffset(a.container),d=mxUtils.getScrollOrigin(a.container),e=mxEvent.getClientX(b)-c.x+d.x,c=mxEvent.getClientY(b)-c.y+d.y;a.autoScroll&&(null==this.autoscroll||this.autoscroll)&&a.scrollPointToVisible(e,c,a.autoExtend);null!=this.currentHighlight&&a.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(a,e,c),d=a.getView().getState(this.currentDropTarget),this.currentHighlight.highlight(d));if(null!=this.previewElement){null==this.previewElement.parentNode&&
(a.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");var d=this.isGridEnabled()&&a.isGridEnabledEvent(b),f=!0;if(null!=this.currentGuide&&this.currentGuide.isEnabledForEvent(b))var f=parseInt(this.previewElement.style.width),g=parseInt(this.previewElement.style.height),f=new mxRectangle(0,0,f,g),c=new mxPoint(e,c),c=this.currentGuide.move(f,c,d),f=!1,e=c.x,c=c.y;else if(d)var d=a.view.scale,g=a.view.translate,h=a.gridSize/
2,e=(a.snap(e/d-g.x-h)+g.x)*d,c=(a.snap(c/d-g.y-h)+g.y)*d;null!=this.currentGuide&&f&&this.currentGuide.hide();null!=this.previewOffset&&(e+=this.previewOffset.x,c+=this.previewOffset.y);this.previewElement.style.left=Math.round(e)+"px";this.previewElement.style.top=Math.round(c)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(e,c)};mxDragSource.prototype.drop=function(a,b,c,d,e){this.dropHandler(a,b,c,d,e);a.container.focus()};
function mxToolbar(a){this.container=a}mxToolbar.prototype=new mxEventSource;mxToolbar.prototype.constructor=mxToolbar;mxToolbar.prototype.container=null;mxToolbar.prototype.enabled=!0;mxToolbar.prototype.noReset=!1;mxToolbar.prototype.updateDefaultMode=!0;
mxToolbar.prototype.addItem=function(a,b,c,d,e,f){var g=document.createElement(null!=b?"img":"button"),h=e||(null!=f?"mxToolbarMode":"mxToolbarItem");g.className=h;g.setAttribute("src",b);null!=a&&(null!=b?g.setAttribute("title",a):mxUtils.write(g,a));this.container.appendChild(g);null!=c&&(mxEvent.addListener(g,"click",c),mxClient.IS_TOUCH&&mxEvent.addListener(g,"touchend",c));a=mxUtils.bind(this,function(){null!=d?g.setAttribute("src",b):g.style.backgroundColor=""});mxEvent.addGestureListeners(g,
mxUtils.bind(this,function(a){null!=d?g.setAttribute("src",d):g.style.backgroundColor="gray";if(null!=f){null==this.menu&&(this.menu=new mxPopupMenu,this.menu.init());var b=this.currentImg;this.menu.isMenuShowing()&&this.menu.hideMenu();b!=g&&(this.currentImg=g,this.menu.factoryMethod=f,b=new mxPoint(g.offsetLeft,g.offsetTop+g.offsetHeight),this.menu.popup(b.x,b.y,null,a),this.menu.isMenuShowing()&&(g.className=h+"Selected",this.menu.hideMenu=function(){mxPopupMenu.prototype.hideMenu.apply(this);
g.className=h;this.currentImg=null}))}}),null,a);mxEvent.addListener(g,"mouseout",a);return g};mxToolbar.prototype.addCombo=function(a){var b=document.createElement("div");b.style.display="inline";b.className="mxToolbarComboContainer";var c=document.createElement("select");c.className=a||"mxToolbarCombo";b.appendChild(c);this.container.appendChild(b);return c};
mxToolbar.prototype.addActionCombo=function(a,b){var c=document.createElement("select");c.className=b||"mxToolbarCombo";this.addOption(c,a,null);mxEvent.addListener(c,"change",function(a){var b=c.options[c.selectedIndex];c.selectedIndex=0;null!=b.funct&&b.funct(a)});this.container.appendChild(c);return c};mxToolbar.prototype.addOption=function(a,b,c){var d=document.createElement("option");mxUtils.writeln(d,b);"function"==typeof c?d.funct=c:d.setAttribute("value",c);a.appendChild(d);return d};
mxToolbar.prototype.addSwitchMode=function(a,b,c,d,e){var f=document.createElement("img");f.initialClassName=e||"mxToolbarMode";f.className=f.initialClassName;f.setAttribute("src",b);f.altIcon=d;null!=a&&f.setAttribute("title",a);mxEvent.addListener(f,"click",mxUtils.bind(this,function(a){a=this.selectedMode.altIcon;null!=a?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",a)):this.selectedMode.className=this.selectedMode.initialClassName;this.updateDefaultMode&&
(this.defaultMode=f);this.selectedMode=f;a=f.altIcon;null!=a?(f.altIcon=f.getAttribute("src"),f.setAttribute("src",a)):f.className=f.initialClassName+"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT));c()}));this.container.appendChild(f);null==this.defaultMode&&(this.defaultMode=f,this.selectMode(f),c());return f};
mxToolbar.prototype.addMode=function(a,b,c,d,e,f){var f=null!=f?f:!0,g=document.createElement(null!=b?"img":"button");g.initialClassName=e||"mxToolbarMode";g.className=g.initialClassName;g.setAttribute("src",b);g.altIcon=d;null!=a&&g.setAttribute("title",a);this.enabled&&f&&(mxEvent.addListener(g,"click",mxUtils.bind(this,function(){this.selectMode(g,c);this.noReset=!1})),mxEvent.addListener(g,"dblclick",mxUtils.bind(this,function(){this.selectMode(g,c);this.noReset=!0})),null==this.defaultMode&&
(this.defaultMode=g,this.defaultFunction=c,this.selectMode(g,c)));this.container.appendChild(g);return g};
mxToolbar.prototype.selectMode=function(a,b){if(this.selectedMode!=a){if(null!=this.selectedMode){var c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=a;c=this.selectedMode.altIcon;null!=c?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",c)):this.selectedMode.className=this.selectedMode.initialClassName+
"Selected";this.fireEvent(new mxEventObject(mxEvent.SELECT,"function",b))}};mxToolbar.prototype.resetMode=function(a){(a||!this.noReset)&&this.selectedMode!=this.defaultMode&&this.selectMode(this.defaultMode,this.defaultFunction)};mxToolbar.prototype.addSeparator=function(a){return this.addItem(null,a,null)};mxToolbar.prototype.addBreak=function(){mxUtils.br(this.container)};
mxToolbar.prototype.addLine=function(){var a=document.createElement("hr");a.style.marginRight="6px";a.setAttribute("size","1");this.container.appendChild(a)};mxToolbar.prototype.destroy=function(){mxEvent.release(this.container);this.selectedMode=this.defaultFunction=this.defaultMode=this.container=null;null!=this.menu&&this.menu.destroy()};
function mxSession(a,b,c,d){this.model=a;this.urlInit=b;this.urlPoll=c;this.urlNotify=d;null!=a&&(this.codec=new mxCodec,this.codec.lookup=function(b){return a.getCell(b)});a.addListener(mxEvent.NOTIFY,mxUtils.bind(this,function(a,b){var c=b.getProperty("edit");(null!=c&&this.debug||this.connected&&!this.suspended)&&this.notify("<edit>"+this.encodeChanges(c.changes,c.undone)+"</edit>")}))}mxSession.prototype=new mxEventSource;mxSession.prototype.constructor=mxSession;mxSession.prototype.model=null;
mxSession.prototype.urlInit=null;mxSession.prototype.urlPoll=null;mxSession.prototype.urlNotify=null;mxSession.prototype.codec=null;mxSession.prototype.linefeed="&#xa;";mxSession.prototype.escapePostData=!0;mxSession.prototype.significantRemoteChanges=!0;mxSession.prototype.sent=0;mxSession.prototype.received=0;mxSession.prototype.debug=!1;mxSession.prototype.connected=!1;mxSession.prototype.suspended=!1;mxSession.prototype.polling=!1;
mxSession.prototype.start=function(){this.debug?(this.connected=!0,this.fireEvent(new mxEventObject(mxEvent.CONNECT))):this.connected||this.get(this.urlInit,mxUtils.bind(this,function(){this.connected=!0;this.fireEvent(new mxEventObject(mxEvent.CONNECT));this.poll()}))};mxSession.prototype.suspend=function(){this.connected&&!this.suspended&&(this.suspended=!0,this.fireEvent(new mxEventObject(mxEvent.SUSPEND)))};
mxSession.prototype.resume=function(){this.connected&&this.suspended&&(this.suspended=!1,this.fireEvent(new mxEventObject(mxEvent.RESUME)),this.polling||this.poll())};mxSession.prototype.stop=function(a){this.connected&&(this.connected=!1);this.fireEvent(new mxEventObject(mxEvent.DISCONNECT,"reason",a))};mxSession.prototype.poll=function(){this.connected&&!this.suspended&&null!=this.urlPoll?(this.polling=!0,this.get(this.urlPoll,mxUtils.bind(this,function(){this.poll()}))):this.polling=!1};
mxSession.prototype.notify=function(a,b,c){null!=a&&0<a.length&&(null!=this.urlNotify&&(this.debug?(mxLog.show(),mxLog.debug("mxSession.notify: "+this.urlNotify+" xml="+a)):(a="<message><delta>"+a+"</delta></message>",this.escapePostData&&(a=encodeURIComponent(a)),mxUtils.post(this.urlNotify,"xml="+a,b,c))),this.sent+=a.length,this.fireEvent(new mxEventObject(mxEvent.NOTIFY,"url",this.urlNotify,"xml",a)))};
mxSession.prototype.get=function(a,b,c){if("undefined"!=typeof mxUtils){var d=mxUtils.bind(this,function(a){null!=c?c(a):this.stop(a)});mxUtils.get(a,mxUtils.bind(this,function(c){if("undefined"!=typeof mxUtils)if(c.isReady()&&404!=c.getStatus()){if(this.received+=c.getText().length,this.fireEvent(new mxEventObject(mxEvent.GET,"url",a,"request",c)),this.isValidResponse(c)){if(0<c.getText().length){var f=c.getDocumentElement();null==f?d("Invalid response: "+c.getText()):this.receive(f)}null!=b&&b(c)}}else d("Response not ready")}),
function(){d("Transmission error")})}};mxSession.prototype.isValidResponse=function(a){return 0>a.getText().indexOf("<?php")};mxSession.prototype.encodeChanges=function(a,b){for(var c="",d=b?-1:1,e=b?a.length-1:0;0<=e&&e<a.length;e+=d)var f=this.codec.encode(a[e]),c=c+mxUtils.getXml(f,this.linefeed);return c};
mxSession.prototype.receive=function(a){if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){var b=a.getAttribute("namespace");null!=b&&(this.model.prefix=b+"-");for(b=a.firstChild;null!=b;){var c=b.nodeName.toLowerCase();"state"==c?this.processState(b):"delta"==c&&this.processDelta(b);b=b.nextSibling}this.fireEvent(new mxEventObject(mxEvent.RECEIVE,"node",a))}};mxSession.prototype.processState=function(a){(new mxCodec(a.ownerDocument)).decode(a.firstChild,this.model)};
mxSession.prototype.processDelta=function(a){for(a=a.firstChild;null!=a;)"edit"==a.nodeName&&this.processEdit(a),a=a.nextSibling};mxSession.prototype.processEdit=function(a){a=this.decodeChanges(a);if(0<a.length){var b=this.createUndoableEdit(a);this.model.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",b,"changes",a));this.model.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",b));this.fireEvent(new mxEventObject(mxEvent.FIRED,"edit",b))}};
mxSession.prototype.createUndoableEdit=function(a){var b=new mxUndoableEdit(this.model,this.significantRemoteChanges);b.changes=a;b.notify=function(){b.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",b,"changes",b.changes));b.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",b,"changes",b.changes))};return b};mxSession.prototype.decodeChanges=function(a){this.codec.document=a.ownerDocument;for(var b=[],a=a.firstChild;null!=a;){var c=this.decodeChange(a);null!=c&&b.push(c);a=a.nextSibling}return b};
mxSession.prototype.decodeChange=function(a){var b=null;a.nodeType==mxConstants.NODETYPE_ELEMENT&&(b="mxRootChange"==a.nodeName?(new mxCodec(a.ownerDocument)).decode(a):this.codec.decode(a),null!=b&&(b.model=this.model,b.execute(),"mxChildChange"==a.nodeName&&null==b.parent&&this.cellRemoved(b.child)));return b};mxSession.prototype.cellRemoved=function(a){this.codec.putObject(a.getId(),a);for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.cellRemoved(this.model.getChildAt(a,c))};
function mxUndoableEdit(a,b){this.source=a;this.changes=[];this.significant=null!=b?b:!0}mxUndoableEdit.prototype.source=null;mxUndoableEdit.prototype.changes=null;mxUndoableEdit.prototype.significant=null;mxUndoableEdit.prototype.undone=!1;mxUndoableEdit.prototype.redone=!1;mxUndoableEdit.prototype.isEmpty=function(){return 0==this.changes.length};mxUndoableEdit.prototype.isSignificant=function(){return this.significant};mxUndoableEdit.prototype.add=function(a){this.changes.push(a)};
mxUndoableEdit.prototype.notify=function(){};mxUndoableEdit.prototype.die=function(){};mxUndoableEdit.prototype.undo=function(){if(!this.undone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length-1;0<=a;a--){var b=this.changes[a];null!=b.execute?b.execute():null!=b.undo&&b.undo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",b))}this.undone=!0;this.redone=!1;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};
mxUndoableEdit.prototype.redo=function(){if(!this.redone){this.source.fireEvent(new mxEventObject(mxEvent.START_EDIT));for(var a=this.changes.length,b=0;b<a;b++){var c=this.changes[b];null!=c.execute?c.execute():null!=c.redo&&c.redo();this.source.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",c))}this.undone=!1;this.redone=!0;this.source.fireEvent(new mxEventObject(mxEvent.END_EDIT))}this.notify()};function mxUndoManager(a){this.size=null!=a?a:100;this.clear()}mxUndoManager.prototype=new mxEventSource;
mxUndoManager.prototype.constructor=mxUndoManager;mxUndoManager.prototype.size=null;mxUndoManager.prototype.history=null;mxUndoManager.prototype.indexOfNextAdd=0;mxUndoManager.prototype.isEmpty=function(){return 0==this.history.length};mxUndoManager.prototype.clear=function(){this.history=[];this.indexOfNextAdd=0;this.fireEvent(new mxEventObject(mxEvent.CLEAR))};mxUndoManager.prototype.canUndo=function(){return 0<this.indexOfNextAdd};
mxUndoManager.prototype.undo=function(){for(;0<this.indexOfNextAdd;){var a=this.history[--this.indexOfNextAdd];a.undo();if(a.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",a));break}}};mxUndoManager.prototype.canRedo=function(){return this.indexOfNextAdd<this.history.length};
mxUndoManager.prototype.redo=function(){for(var a=this.history.length;this.indexOfNextAdd<a;){var b=this.history[this.indexOfNextAdd++];b.redo();if(b.isSignificant()){this.fireEvent(new mxEventObject(mxEvent.REDO,"edit",b));break}}};mxUndoManager.prototype.undoableEditHappened=function(a){this.trim();0<this.size&&this.size==this.history.length&&this.history.shift();this.history.push(a);this.indexOfNextAdd=this.history.length;this.fireEvent(new mxEventObject(mxEvent.ADD,"edit",a))};
mxUndoManager.prototype.trim=function(){if(this.history.length>this.indexOfNextAdd)for(var a=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd),b=0;b<a.length;b++)a[b].die()};
var mxUrlConverter=function(){var a=!0,b=null,c=null;return{isEnabled:function(){return a},setEnabled:function(b){a=b},getBaseUrl:function(){return b},setBaseUrl:function(a){b=a},getBaseDomain:function(){return b},setBaseDomain:function(a){b=a},isRelativeUrl:function(a){return"//"!=a.substring(0,2)&&"http://"!=a.substring(0,7)&&"https://"!=a.substring(0,8)&&"data:image"!=a.substring(0,10)},convert:function(d){if(a&&this.isRelativeUrl(d)){if(null==b){c=location.protocol+"//"+location.host;b=c+location.pathname;
var e=b.lastIndexOf("/");0<e&&(b=b.substring(0,e+1))}d="/"==d.charAt(0)?c+d:b+d}return d}}};
function mxPanningManager(a){this.thread=null;this.active=!1;this.dy=this.dx=this.t0y=this.t0x=this.tdy=this.tdx=0;this.scrollbars=!1;this.scrollTop=this.scrollLeft=0;this.mouseListener={mouseDown:function(){},mouseMove:function(){},mouseUp:mxUtils.bind(this,function(){this.active&&this.stop()})};a.addMouseListener(this.mouseListener);mxEvent.addListener(document,"mouseup",mxUtils.bind(this,function(){this.active&&this.stop()}));var b=mxUtils.bind(this,function(){this.scrollbars=mxUtils.hasScrollbars(a.container);
this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop;return window.setInterval(mxUtils.bind(this,function(){this.tdx-=this.dx;this.tdy-=this.dy;if(this.scrollbars){var b=-a.container.scrollLeft-Math.ceil(this.dx),d=-a.container.scrollTop-Math.ceil(this.dy);a.panGraph(b,d);a.panDx=this.scrollLeft-a.container.scrollLeft;a.panDy=this.scrollTop-a.container.scrollTop;a.fireEvent(new mxEventObject(mxEvent.PAN))}else a.panGraph(this.getDx(),this.getDy())}),this.delay)});this.isActive=
function(){return active};this.getDx=function(){return Math.round(this.tdx)};this.getDy=function(){return Math.round(this.tdy)};this.start=function(){this.t0x=a.view.translate.x;this.t0y=a.view.translate.y;this.active=!0};this.panTo=function(c,d,e,f){this.active||this.start();this.scrollLeft=a.container.scrollLeft;this.scrollTop=a.container.scrollTop;var f=null!=f?f:0,g=a.container;this.dx=c+(null!=e?e:0)-g.scrollLeft-g.clientWidth;0>this.dx&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:
this.dx=this.handleMouseOut?Math.max(this.dx,0):0;0==this.dx&&(this.dx=c-g.scrollLeft,this.dx=0<this.dx&&this.dx<this.border?this.dx-this.border:this.handleMouseOut?Math.min(0,this.dx):0);this.dy=d+f-g.scrollTop-g.clientHeight;0>this.dy&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.dy=this.handleMouseOut?Math.max(this.dy,0):0;0==this.dy&&(this.dy=d-g.scrollTop,this.dy=0<this.dy&&this.dy<this.border?this.dy-this.border:this.handleMouseOut?Math.min(0,this.dy):0);0!=this.dx||0!=this.dy?
(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=b())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)};this.stop=function(){if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdy=this.tdx=0,this.scrollbars)a.panDx=0,a.panDy=0,a.fireEvent(new mxEventObject(mxEvent.PAN));else{var b=a.panDx,d=a.panDy;if(0!=b||0!=d)a.panGraph(0,0),a.view.setTranslate(this.t0x+b/a.view.scale,this.t0y+d/a.view.scale)}};
this.destroy=function(){a.removeMouseListener(this.mouseListener)}}mxPanningManager.prototype.damper=1/6;mxPanningManager.prototype.delay=10;mxPanningManager.prototype.handleMouseOut=!0;mxPanningManager.prototype.border=0;function mxPopupMenu(a){this.factoryMethod=a;null!=a&&this.init()}mxPopupMenu.prototype=new mxEventSource;mxPopupMenu.prototype.constructor=mxPopupMenu;mxPopupMenu.prototype.submenuImage=mxClient.imageBasePath+"/submenu.gif";mxPopupMenu.prototype.zIndex=10006;
mxPopupMenu.prototype.factoryMethod=null;mxPopupMenu.prototype.useLeftButtonForPopup=!1;mxPopupMenu.prototype.enabled=!0;mxPopupMenu.prototype.itemCount=0;mxPopupMenu.prototype.autoExpand=!1;mxPopupMenu.prototype.smartSeparators=!1;mxPopupMenu.prototype.labels=!0;
mxPopupMenu.prototype.init=function(){this.table=document.createElement("table");this.table.className="mxPopupMenu";this.tbody=document.createElement("tbody");this.table.appendChild(this.tbody);this.div=document.createElement("div");this.div.className="mxPopupMenu";this.div.style.display="inline";this.div.style.zIndex=this.zIndex;this.div.appendChild(this.table);mxEvent.disableContextMenu(this.div)};mxPopupMenu.prototype.isEnabled=function(){return this.enabled};
mxPopupMenu.prototype.setEnabled=function(a){this.enabled=a};mxPopupMenu.prototype.isPopupTrigger=function(a){return a.isPopupTrigger()||this.useLeftButtonForPopup&&mxEvent.isLeftMouseButton(a.getEvent())};
mxPopupMenu.prototype.addItem=function(a,b,c,d,e,f){d=d||this;this.itemCount++;d.willAddSeparator&&(d.containsItems&&this.addSeparator(d,!0),d.willAddSeparator=!1);d.containsItems=!0;var g=document.createElement("tr");g.className="mxPopupMenuItem";var h=document.createElement("td");h.className="mxPopupMenuIcon";null!=b?(e=document.createElement("img"),e.src=b,h.appendChild(e)):null!=e&&(b=document.createElement("div"),b.className=e,h.appendChild(b));g.appendChild(h);this.labels&&(h=document.createElement("td"),
h.className="mxPopupMenuItem"+(null!=f&&!f?" disabled":""),mxUtils.write(h,a),h.align="left",g.appendChild(h),a=document.createElement("td"),a.className="mxPopupMenuItem"+(null!=f&&!f?" disabled":""),a.style.paddingRight="6px",a.style.textAlign="right",g.appendChild(a),null==d.div&&this.createSubmenu(d));d.tbody.appendChild(g);if(null==f||f)mxEvent.addGestureListeners(g,mxUtils.bind(this,function(a){this.eventReceiver=g;d.activeRow!=g&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&
this.hideSubmenu(d),null!=g.div&&(this.showSubmenu(d,g),d.activeRow=g));mxEvent.consume(a)}),mxUtils.bind(this,function(){d.activeRow!=g&&d.activeRow!=d&&(null!=d.activeRow&&null!=d.activeRow.div.parentNode&&this.hideSubmenu(d),this.autoExpand&&null!=g.div&&(this.showSubmenu(d,g),d.activeRow=g));g.className="mxPopupMenuItemHover"}),mxUtils.bind(this,function(a){this.eventReceiver==g&&(d.activeRow!=g&&this.hideMenu(),null!=c&&c(a));this.eventReceiver=null;mxEvent.consume(a)})),mxEvent.addListener(g,
"mouseout",mxUtils.bind(this,function(){g.className="mxPopupMenuItem"}));return g};
mxPopupMenu.prototype.createSubmenu=function(a){a.table=document.createElement("table");a.table.className="mxPopupMenu";a.tbody=document.createElement("tbody");a.table.appendChild(a.tbody);a.div=document.createElement("div");a.div.className="mxPopupMenu";a.div.style.position="absolute";a.div.style.display="inline";a.div.style.zIndex=this.zIndex;a.div.appendChild(a.table);var b=document.createElement("img");b.setAttribute("src",this.submenuImage);td=a.firstChild.nextSibling.nextSibling;td.appendChild(b)};
mxPopupMenu.prototype.showSubmenu=function(a,b){if(null!=b.div){b.div.style.left=a.div.offsetLeft+b.offsetLeft+b.offsetWidth-1+"px";b.div.style.top=a.div.offsetTop+b.offsetTop+"px";document.body.appendChild(b.div);var c=parseInt(b.div.offsetLeft),d=parseInt(b.div.offsetWidth),e=document.body,f=document.documentElement;if(c+d>(e.scrollLeft||f.scrollLeft)+(e.clientWidth||f.clientWidth))b.div.style.left=a.div.offsetLeft-d+(mxClient.IS_IE?6:-6)+"px";mxUtils.fit(b.div)}};
mxPopupMenu.prototype.addSeparator=function(a,b){a=a||this;if(this.smartSeparators&&!b)a.willAddSeparator=!0;else if(null!=a.tbody){a.willAddSeparator=!1;var c=document.createElement("tr"),d=document.createElement("td");d.className="mxPopupMenuIcon";d.style.padding="0 0 0 0px";c.appendChild(d);d=document.createElement("td");d.style.padding="0 0 0 0px";d.setAttribute("colSpan","2");var e=document.createElement("hr");e.setAttribute("size","1");d.appendChild(e);c.appendChild(d);a.tbody.appendChild(c)}};
mxPopupMenu.prototype.popup=function(a,b,c,d){if(null!=this.div&&null!=this.tbody&&null!=this.factoryMethod){this.div.style.left=a+"px";for(this.div.style.top=b+"px";null!=this.tbody.firstChild;)mxEvent.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0;this.factoryMethod(this,c,d);0<this.itemCount&&(this.showMenu(),this.fireEvent(new mxEventObject(mxEvent.SHOW)))}};
mxPopupMenu.prototype.isMenuShowing=function(){return null!=this.div&&this.div.parentNode==document.body};mxPopupMenu.prototype.showMenu=function(){9<=document.documentMode&&(this.div.style.filter="none");document.body.appendChild(this.div);mxUtils.fit(this.div)};mxPopupMenu.prototype.hideMenu=function(){null!=this.div&&(null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1)};
mxPopupMenu.prototype.hideSubmenu=function(a){null!=a.activeRow&&(this.hideSubmenu(a.activeRow),null!=a.activeRow.div.parentNode&&a.activeRow.div.parentNode.removeChild(a.activeRow.div),a.activeRow=null)};mxPopupMenu.prototype.destroy=function(){null!=this.div&&(mxEvent.release(this.div),null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.div=null)};
function mxAutoSaveManager(a){this.changeHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.graphModelChanged(c.getProperty("edit").changes)});this.setGraph(a)}mxAutoSaveManager.prototype=new mxEventSource;mxAutoSaveManager.prototype.constructor=mxAutoSaveManager;mxAutoSaveManager.prototype.graph=null;mxAutoSaveManager.prototype.autoSaveDelay=10;mxAutoSaveManager.prototype.autoSaveThrottle=2;mxAutoSaveManager.prototype.autoSaveThreshold=5;mxAutoSaveManager.prototype.ignoredChanges=0;
mxAutoSaveManager.prototype.lastSnapshot=0;mxAutoSaveManager.prototype.enabled=!0;mxAutoSaveManager.prototype.changeHandler=null;mxAutoSaveManager.prototype.isEnabled=function(){return this.enabled};mxAutoSaveManager.prototype.setEnabled=function(a){this.enabled=a};mxAutoSaveManager.prototype.setGraph=function(a){null!=this.graph&&this.graph.getModel().removeListener(this.changeHandler);this.graph=a;null!=this.graph&&this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)};
mxAutoSaveManager.prototype.save=function(){};mxAutoSaveManager.prototype.graphModelChanged=function(a){a=((new Date).getTime()-this.lastSnapshot)/1E3;a>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&a>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++};mxAutoSaveManager.prototype.reset=function(){this.lastSnapshot=(new Date).getTime();this.ignoredChanges=0};mxAutoSaveManager.prototype.destroy=function(){this.setGraph(null)};
function mxAnimation(a){this.delay=null!=a?a:20}mxAnimation.prototype=new mxEventSource;mxAnimation.prototype.constructor=mxAnimation;mxAnimation.prototype.delay=null;mxAnimation.prototype.thread=null;mxAnimation.prototype.startAnimation=function(){null==this.thread&&(this.thread=window.setInterval(mxUtils.bind(this,this.updateAnimation),this.delay))};mxAnimation.prototype.updateAnimation=function(){this.fireEvent(new mxEventObject(mxEvent.EXECUTE))};
mxAnimation.prototype.stopAnimation=function(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new mxEventObject(mxEvent.DONE)))};function mxMorphing(a,b,c,d){mxAnimation.call(this,d);this.graph=a;this.steps=null!=b?b:6;this.ease=null!=c?c:1.5}mxMorphing.prototype=new mxAnimation;mxMorphing.prototype.constructor=mxMorphing;mxMorphing.prototype.graph=null;mxMorphing.prototype.steps=null;mxMorphing.prototype.step=0;mxMorphing.prototype.ease=null;
mxMorphing.prototype.cells=null;mxMorphing.prototype.updateAnimation=function(){var a=new mxCellStatePreview(this.graph);if(null!=this.cells)for(var b=0;b<this.cells.length;b++)this.animateCell(cells[b],a,!1);else this.animateCell(this.graph.getModel().getRoot(),a,!0);this.show(a);(a.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()};mxMorphing.prototype.show=function(a){a.show()};
mxMorphing.prototype.animateCell=function(a,b,c){var d=this.graph.getView().getState(a),e=null;if(null!=d&&(e=this.getDelta(d),this.graph.getModel().isVertex(a)&&(0!=e.x||0!=e.y))){var f=this.graph.view.getTranslate(),g=this.graph.view.getScale();e.x+=f.x*g;e.y+=f.y*g;b.moveState(d,-e.x/this.ease,-e.y/this.ease)}if(c&&!this.stopRecursion(d,e)){d=this.graph.getModel().getChildCount(a);for(e=0;e<d;e++)this.animateCell(this.graph.getModel().getChildAt(a,e),b,c)}};
mxMorphing.prototype.stopRecursion=function(a,b){return null!=b&&(0!=b.x||0!=b.y)};mxMorphing.prototype.getDelta=function(a){var b=this.getOriginForCell(a.cell),c=this.graph.getView().getTranslate(),d=this.graph.getView().getScale(),a=new mxPoint(a.x/d-c.x,a.y/d-c.y);return new mxPoint((b.x-a.x)*d,(b.y-a.y)*d)};
mxMorphing.prototype.getOriginForCell=function(a){var b=null;null!=a&&(b=this.getOriginForCell(this.graph.getModel().getParent(a)),a=this.graph.getCellGeometry(a),null!=a&&(b.x+=a.x,b.y+=a.y));null==b&&(b=this.graph.view.getTranslate(),b=new mxPoint(-b.x,-b.y));return b};function mxImageBundle(a){this.images=[];this.alt=null!=a?a:!1}mxImageBundle.prototype.images=null;mxImageBundle.prototype.images=null;mxImageBundle.prototype.putImage=function(a,b,c){this.images[a]={value:b,fallback:c}};
mxImageBundle.prototype.getImage=function(a){var b=null;null!=a&&(a=this.images[a],null!=a&&(b=this.alt?a.fallback:a.value));return b};function mxImageExport(){}mxImageExport.prototype.includeOverlays=!1;mxImageExport.prototype.drawState=function(a,b){null!=a&&(this.visitStatesRecursive(a,b,this.drawCellState),this.includeOverlays&&this.visitStatesRecursive(a,b,this.drawOverlays))};
mxImageExport.prototype.visitStatesRecursive=function(a,b,c){if(null!=a){c(a,b);for(var d=a.view.graph,e=d.model.getChildCount(a.cell),f=0;f<e;f++)this.visitStatesRecursive(d.view.getState(d.model.getChildAt(a.cell,f)),b,c)}};mxImageExport.prototype.drawCellState=function(a,b){a.shape instanceof mxShape&&(b.save(),a.shape.paint(b),b.restore());null!=a.text&&(b.save(),a.text.paint(b),b.restore())};
mxImageExport.prototype.drawOverlays=function(a,b){null!=a.overlays&&a.overlays.visit(function(a,d){d instanceof mxShape&&d.paint(b)})};function mxAbstractCanvas2D(){this.converter=this.createUrlConverter();this.reset()}mxAbstractCanvas2D.prototype.state=null;mxAbstractCanvas2D.prototype.states=null;mxAbstractCanvas2D.prototype.path=null;mxAbstractCanvas2D.prototype.rotateHtml=!0;mxAbstractCanvas2D.prototype.lastX=0;mxAbstractCanvas2D.prototype.lastY=0;mxAbstractCanvas2D.prototype.moveOp="M";
mxAbstractCanvas2D.prototype.lineOp="L";mxAbstractCanvas2D.prototype.quadOp="Q";mxAbstractCanvas2D.prototype.curveOp="C";mxAbstractCanvas2D.prototype.closeOp="Z";mxAbstractCanvas2D.prototype.pointerEvents=!1;mxAbstractCanvas2D.prototype.createUrlConverter=function(){return new mxUrlConverter};mxAbstractCanvas2D.prototype.reset=function(){this.state=this.createState();this.states=[]};
mxAbstractCanvas2D.prototype.createState=function(){return{dx:0,dy:0,scale:1,alpha:1,fillColor:null,fillAlpha:1,gradientColor:null,gradientAlpha:1,gradientDirection:null,strokeColor:null,strokeWidth:1,dashed:!1,dashPattern:"3 3",lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:null,fontBorderColor:null,fontSize:mxConstants.DEFAULT_FONTSIZE,fontFamily:mxConstants.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:mxConstants.SHADOWCOLOR,shadowAlpha:mxConstants.SHADOW_OPACITY,
shadowDx:mxConstants.SHADOW_OFFSET_X,shadowDy:mxConstants.SHADOW_OFFSET_Y,rotation:0,rotationCx:0,rotationCy:0}};mxAbstractCanvas2D.prototype.format=function(a){return Math.round(parseFloat(a))};
mxAbstractCanvas2D.prototype.addOp=function(){if(null!=this.path&&(this.path.push(arguments[0]),2<arguments.length))for(var a=this.state,b=2;b<arguments.length;b+=2)this.lastX=arguments[b-1],this.lastY=arguments[b],this.path.push(this.format((this.lastX+a.dx)*a.scale)),this.path.push(this.format((this.lastY+a.dy)*a.scale))};mxAbstractCanvas2D.prototype.rotatePoint=function(a,b,c,d,e){c*=Math.PI/180;return mxUtils.getRotatedPoint(new mxPoint(a,b),Math.cos(c),Math.sin(c),new mxPoint(d,e))};
mxAbstractCanvas2D.prototype.save=function(){this.states.push(this.state);this.state=mxUtils.clone(this.state)};mxAbstractCanvas2D.prototype.restore=function(){this.state=this.states.pop()};mxAbstractCanvas2D.prototype.scale=function(a){this.state.scale*=a;this.state.strokeWidth*=a};mxAbstractCanvas2D.prototype.translate=function(a,b){this.state.dx+=a;this.state.dy+=b};mxAbstractCanvas2D.prototype.setAlpha=function(a){this.state.alpha=a};
mxAbstractCanvas2D.prototype.setFillColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fillColor=a;this.state.gradientColor=null};mxAbstractCanvas2D.prototype.setGradient=function(a,b,c,d,e,f,g,h,k){c=this.state;c.fillColor=a;c.fillAlpha=null!=h?h:1;c.gradientColor=b;c.gradientAlpha=null!=k?k:1;c.gradientDirection=g};mxAbstractCanvas2D.prototype.setStrokeColor=function(a){a==mxConstants.NONE&&(a=null);this.state.strokeColor=a};
mxAbstractCanvas2D.prototype.setStrokeWidth=function(a){this.state.strokeWidth=a};mxAbstractCanvas2D.prototype.setDashed=function(a){this.state.dashed=a};mxAbstractCanvas2D.prototype.setDashPattern=function(a){this.state.dashPattern=a};mxAbstractCanvas2D.prototype.setLineCap=function(a){this.state.lineCap=a};mxAbstractCanvas2D.prototype.setLineJoin=function(a){this.state.lineJoin=a};mxAbstractCanvas2D.prototype.setMiterLimit=function(a){this.state.miterLimit=a};
mxAbstractCanvas2D.prototype.setFontColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontColor=a};mxAbstractCanvas2D.prototype.setFontBackgroundColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontBackgroundColor=a};mxAbstractCanvas2D.prototype.setFontBorderColor=function(a){a==mxConstants.NONE&&(a=null);this.state.fontBorderColor=a};mxAbstractCanvas2D.prototype.setFontSize=function(a){this.state.fontSize=a};
mxAbstractCanvas2D.prototype.setFontFamily=function(a){this.state.fontFamily=a};mxAbstractCanvas2D.prototype.setFontStyle=function(a){null==a&&(a=0);this.state.fontStyle=a};mxAbstractCanvas2D.prototype.setShadow=function(a){this.state.shadow=a};mxAbstractCanvas2D.prototype.setShadowColor=function(a){a==mxConstants.NONE&&(a=null);this.state.shadowColor=a};mxAbstractCanvas2D.prototype.setShadowAlpha=function(a){this.state.shadowAlpha=a};
mxAbstractCanvas2D.prototype.setShadowOffset=function(a,b){this.state.shadowDx=a;this.state.shadowDy=b};mxAbstractCanvas2D.prototype.begin=function(){this.lastY=this.lastX=0;this.path=[]};mxAbstractCanvas2D.prototype.moveTo=function(a,b){this.addOp(this.moveOp,a,b)};mxAbstractCanvas2D.prototype.lineTo=function(a,b){this.addOp(this.lineOp,a,b)};mxAbstractCanvas2D.prototype.quadTo=function(a,b,c,d){this.addOp(this.quadOp,a,b,c,d)};
mxAbstractCanvas2D.prototype.curveTo=function(a,b,c,d,e,f){this.addOp(this.curveOp,a,b,c,d,e,f)};mxAbstractCanvas2D.prototype.arcTo=function(a,b,c,d,e,f,g){a=mxUtils.arcToCurves(this.lastX,this.lastY,a,b,c,d,e,f,g);if(null!=a)for(b=0;b<a.length;b+=6)this.curveTo(a[b],a[b+1],a[b+2],a[b+3],a[b+4],a[b+5])};mxAbstractCanvas2D.prototype.close=function(){this.addOp(this.closeOp)};mxAbstractCanvas2D.prototype.end=function(){};
function mxXmlCanvas2D(a){mxAbstractCanvas2D.call(this);this.root=a;this.writeDefaults()}mxUtils.extend(mxXmlCanvas2D,mxAbstractCanvas2D);mxXmlCanvas2D.prototype.textEnabled=!0;mxXmlCanvas2D.prototype.compressed=!0;
mxXmlCanvas2D.prototype.writeDefaults=function(){var a;a=this.createElement("fontfamily");a.setAttribute("family",mxConstants.DEFAULT_FONTFAMILY);this.root.appendChild(a);a=this.createElement("fontsize");a.setAttribute("size",mxConstants.DEFAULT_FONTSIZE);this.root.appendChild(a);a=this.createElement("shadowcolor");a.setAttribute("color",mxConstants.SHADOWCOLOR);this.root.appendChild(a);a=this.createElement("shadowalpha");a.setAttribute("alpha",mxConstants.SHADOW_OPACITY);this.root.appendChild(a);
a=this.createElement("shadowoffset");a.setAttribute("dx",mxConstants.SHADOW_OFFSET_X);a.setAttribute("dy",mxConstants.SHADOW_OFFSET_Y);this.root.appendChild(a)};mxXmlCanvas2D.prototype.format=function(a){return parseFloat(parseFloat(a).toFixed(2))};mxXmlCanvas2D.prototype.createElement=function(a){return this.root.ownerDocument.createElement(a)};mxXmlCanvas2D.prototype.save=function(){this.compressed&&mxAbstractCanvas2D.prototype.save.apply(this,arguments);this.root.appendChild(this.createElement("save"))};
mxXmlCanvas2D.prototype.restore=function(){this.compressed&&mxAbstractCanvas2D.prototype.restore.apply(this,arguments);this.root.appendChild(this.createElement("restore"))};mxXmlCanvas2D.prototype.scale=function(a){if(this.compressed){if(this.state.scale==a)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var b=this.createElement("scale");b.setAttribute("scale",a);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.translate=function(a,b){var c=this.createElement("translate");c.setAttribute("dx",this.format(a));c.setAttribute("dy",this.format(b));this.root.appendChild(c)};mxXmlCanvas2D.prototype.rotate=function(a,b,c,d,e){var f=this.createElement("rotate");if(0!=a||b||c)f.setAttribute("theta",this.format(a)),f.setAttribute("flipH",b?"1":"0"),f.setAttribute("flipV",c?"1":"0"),f.setAttribute("cx",this.format(d)),f.setAttribute("cy",this.format(e)),this.root.appendChild(f)};
mxXmlCanvas2D.prototype.setAlpha=function(a){if(this.compressed){if(this.state.alpha==a)return;mxAbstractCanvas2D.prototype.setAlpha.apply(this,arguments)}var b=this.createElement("alpha");b.setAttribute("alpha",this.format(a));this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setFillColor=function(a){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fillColor==a)return;mxAbstractCanvas2D.prototype.setFillColor.apply(this,arguments)}var b=this.createElement("fillcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setGradient=function(a,b,c,d,e,f,g,h,k){if(null!=a&&null!=b){mxAbstractCanvas2D.prototype.setGradient.apply(this,arguments);var l=this.createElement("gradient");l.setAttribute("c1",a);l.setAttribute("c2",b);l.setAttribute("x",this.format(c));l.setAttribute("y",this.format(d));l.setAttribute("w",this.format(e));l.setAttribute("h",this.format(f));null!=g&&l.setAttribute("direction",g);null!=h&&l.setAttribute("alpha1",h);null!=k&&l.setAttribute("alpha2",k);this.root.appendChild(l)}};
mxXmlCanvas2D.prototype.setStrokeColor=function(a){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.strokeColor==a)return;mxAbstractCanvas2D.prototype.setStrokeColor.apply(this,arguments)}var b=this.createElement("strokecolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setStrokeWidth=function(a){if(this.compressed){if(this.state.strokeWidth==a)return;mxAbstractCanvas2D.prototype.setStrokeWidth.apply(this,arguments)}var b=this.createElement("strokewidth");b.setAttribute("width",this.format(a));this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setDashed=function(a){if(this.compressed){if(this.state.dashed==a)return;mxAbstractCanvas2D.prototype.setDashed.apply(this,arguments)}var b=this.createElement("dashed");b.setAttribute("dashed",a?"1":"0");this.root.appendChild(b)};mxXmlCanvas2D.prototype.setDashPattern=function(a){if(this.compressed){if(this.state.dashPattern==a)return;mxAbstractCanvas2D.prototype.setDashPattern.apply(this,arguments)}var b=this.createElement("dashpattern");b.setAttribute("pattern",a);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setLineCap=function(a){if(this.compressed){if(this.state.lineCap==a)return;mxAbstractCanvas2D.prototype.setLineCap.apply(this,arguments)}var b=this.createElement("linecap");b.setAttribute("cap",a);this.root.appendChild(b)};mxXmlCanvas2D.prototype.setLineJoin=function(a){if(this.compressed){if(this.state.lineJoin==a)return;mxAbstractCanvas2D.prototype.setLineJoin.apply(this,arguments)}var b=this.createElement("linejoin");b.setAttribute("join",a);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setMiterLimit=function(a){if(this.compressed){if(this.state.miterLimit==a)return;mxAbstractCanvas2D.prototype.setMiterLimit.apply(this,arguments)}var b=this.createElement("miterlimit");b.setAttribute("limit",a);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setFontColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontColor==a)return;mxAbstractCanvas2D.prototype.setFontColor.apply(this,arguments)}var b=this.createElement("fontcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setFontBackgroundColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontBackgroundColor==a)return;mxAbstractCanvas2D.prototype.setFontBackgroundColor.apply(this,arguments)}var b=this.createElement("fontbackgroundcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setFontBorderColor=function(a){if(this.textEnabled){a==mxConstants.NONE&&(a=null);if(this.compressed){if(this.state.fontBorderColor==a)return;mxAbstractCanvas2D.prototype.setFontBorderColor.apply(this,arguments)}var b=this.createElement("fontbordercolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setFontSize=function(a){if(this.textEnabled){if(this.compressed){if(this.state.fontSize==a)return;mxAbstractCanvas2D.prototype.setFontSize.apply(this,arguments)}var b=this.createElement("fontsize");b.setAttribute("size",a);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setFontFamily=function(a){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily==a)return;mxAbstractCanvas2D.prototype.setFontFamily.apply(this,arguments)}var b=this.createElement("fontfamily");b.setAttribute("family",a);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setFontStyle=function(a){if(this.textEnabled){null==a&&(a=0);if(this.compressed){if(this.state.fontStyle==a)return;mxAbstractCanvas2D.prototype.setFontStyle.apply(this,arguments)}var b=this.createElement("fontstyle");b.setAttribute("style",a);this.root.appendChild(b)}};
mxXmlCanvas2D.prototype.setShadow=function(a){if(this.compressed){if(this.state.shadow==a)return;mxAbstractCanvas2D.prototype.setShadow.apply(this,arguments)}var b=this.createElement("shadow");b.setAttribute("enabled",a?"1":"0");this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setShadowColor=function(a){if(this.compressed){a==mxConstants.NONE&&(a=null);if(this.state.shadowColor==a)return;mxAbstractCanvas2D.prototype.setShadowColor.apply(this,arguments)}var b=this.createElement("shadowcolor");b.setAttribute("color",null!=a?a:mxConstants.NONE);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setShadowAlpha=function(a){if(this.compressed){if(this.state.shadowAlpha==a)return;mxAbstractCanvas2D.prototype.setShadowAlpha.apply(this,arguments)}var b=this.createElement("shadowalpha");b.setAttribute("alpha",a);this.root.appendChild(b)};
mxXmlCanvas2D.prototype.setShadowOffset=function(a,b){if(this.compressed){if(this.state.shadowDx==a&&this.state.shadowDy==b)return;mxAbstractCanvas2D.prototype.setShadowOffset.apply(this,arguments)}var c=this.createElement("shadowoffset");c.setAttribute("dx",a);c.setAttribute("dy",b);this.root.appendChild(c)};
mxXmlCanvas2D.prototype.rect=function(a,b,c,d){var e=this.createElement("rect");e.setAttribute("x",this.format(a));e.setAttribute("y",this.format(b));e.setAttribute("w",this.format(c));e.setAttribute("h",this.format(d));this.root.appendChild(e)};
mxXmlCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){var g=this.createElement("roundrect");g.setAttribute("x",this.format(a));g.setAttribute("y",this.format(b));g.setAttribute("w",this.format(c));g.setAttribute("h",this.format(d));g.setAttribute("dx",this.format(e));g.setAttribute("dy",this.format(f));this.root.appendChild(g)};
mxXmlCanvas2D.prototype.ellipse=function(a,b,c,d){var e=this.createElement("ellipse");e.setAttribute("x",this.format(a));e.setAttribute("y",this.format(b));e.setAttribute("w",this.format(c));e.setAttribute("h",this.format(d));this.root.appendChild(e)};
mxXmlCanvas2D.prototype.image=function(a,b,c,d,e,f,g,h){var e=this.converter.convert(e),k=this.createElement("image");k.setAttribute("x",this.format(a));k.setAttribute("y",this.format(b));k.setAttribute("w",this.format(c));k.setAttribute("h",this.format(d));k.setAttribute("src",e);k.setAttribute("aspect",f?"1":"0");k.setAttribute("flipH",g?"1":"0");k.setAttribute("flipV",h?"1":"0");this.root.appendChild(k)};
mxXmlCanvas2D.prototype.begin=function(){this.root.appendChild(this.createElement("begin"));this.lastY=this.lastX=0};mxXmlCanvas2D.prototype.moveTo=function(a,b){var c=this.createElement("move");c.setAttribute("x",this.format(a));c.setAttribute("y",this.format(b));this.root.appendChild(c);this.lastX=a;this.lastY=b};
mxXmlCanvas2D.prototype.lineTo=function(a,b){var c=this.createElement("line");c.setAttribute("x",this.format(a));c.setAttribute("y",this.format(b));this.root.appendChild(c);this.lastX=a;this.lastY=b};mxXmlCanvas2D.prototype.quadTo=function(a,b,c,d){var e=this.createElement("quad");e.setAttribute("x1",this.format(a));e.setAttribute("y1",this.format(b));e.setAttribute("x2",this.format(c));e.setAttribute("y2",this.format(d));this.root.appendChild(e);this.lastX=c;this.lastY=d};
mxXmlCanvas2D.prototype.curveTo=function(a,b,c,d,e,f){var g=this.createElement("curve");g.setAttribute("x1",this.format(a));g.setAttribute("y1",this.format(b));g.setAttribute("x2",this.format(c));g.setAttribute("y2",this.format(d));g.setAttribute("x3",this.format(e));g.setAttribute("y3",this.format(f));this.root.appendChild(g);this.lastX=e;this.lastY=f};mxXmlCanvas2D.prototype.close=function(){this.root.appendChild(this.createElement("close"))};
mxXmlCanvas2D.prototype.text=function(a,b,c,d,e,f,g,h,k,l,m,n){if(this.textEnabled&&null!=e){mxUtils.isNode(e)&&(e=mxUtils.getOuterHtml(e));var o=this.createElement("text");o.setAttribute("x",this.format(a));o.setAttribute("y",this.format(b));o.setAttribute("w",this.format(c));o.setAttribute("h",this.format(d));o.setAttribute("str",e);null!=f&&o.setAttribute("align",f);null!=g&&o.setAttribute("valign",g);o.setAttribute("wrap",h?"1":"0");null==k&&(k="");o.setAttribute("format",k);null!=l&&o.setAttribute("overflow",
l);null!=m&&o.setAttribute("clip",m?"1":"0");null!=n&&o.setAttribute("rotation",n);this.root.appendChild(o)}};mxXmlCanvas2D.prototype.stroke=function(){this.root.appendChild(this.createElement("stroke"))};mxXmlCanvas2D.prototype.fill=function(){this.root.appendChild(this.createElement("fill"))};mxXmlCanvas2D.prototype.fillAndStroke=function(){this.root.appendChild(this.createElement("fillstroke"))};
function mxSvgCanvas2D(a,b){mxAbstractCanvas2D.call(this);this.root=a;this.gradients=[];this.defs=null;this.styleEnabled=null!=b?b:!1;var c=null;if(a.ownerDocument!=document)for(c=a;null!=c&&"svg"!=c.nodeName;)c=c.parentNode;null!=c&&(0<c.getElementsByTagName("defs").length&&(this.defs=c.getElementsByTagName("defs")[0]),null==this.defs&&(this.defs=this.createElement("defs"),null!=c.firstChild?c.insertBefore(this.defs,c.firstChild):c.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}
mxUtils.extend(mxSvgCanvas2D,mxAbstractCanvas2D);mxSvgCanvas2D.prototype.node=null;mxSvgCanvas2D.prototype.matchHtmlAlignment=!0;mxSvgCanvas2D.prototype.textEnabled=!0;mxSvgCanvas2D.prototype.foEnabled=!0;mxSvgCanvas2D.prototype.foAltText="[Object]";mxSvgCanvas2D.prototype.strokeTolerance=0;mxSvgCanvas2D.prototype.refCount=0;mxSvgCanvas2D.prototype.blockImagePointerEvents=!1;mxSvgCanvas2D.prototype.reset=function(){mxAbstractCanvas2D.prototype.reset.apply(this,arguments);this.gradients=[]};
mxSvgCanvas2D.prototype.createStyle=function(a){a=this.createElement("style");a.setAttribute("type","text/css");mxUtils.write(a,"svg{font-family:"+mxConstants.DEFAULT_FONTFAMILY+";font-size:"+mxConstants.DEFAULT_FONTSIZE+";fill:none;stroke-miterlimit:10}");return a};
mxSvgCanvas2D.prototype.createElement=function(a,b){if(null!=this.root.ownerDocument.createElementNS)return this.root.ownerDocument.createElementNS(b||mxConstants.NS_SVG,a);var c=this.root.ownerDocument.createElement(a);null!=b&&c.setAttribute("xmlns",b);return c};
mxSvgCanvas2D.prototype.createAlternateContent=function(a,b,c,d,e){return null!=this.foAltText?(a=this.state,b=this.createElement("text"),b.setAttribute("x",Math.round(d/2)),b.setAttribute("y",Math.round((e+a.fontSize)/2)),b.setAttribute("fill",a.fontColor||"black"),b.setAttribute("text-anchor","middle"),b.setAttribute("font-size",Math.round(a.fontSize)+"px"),b.setAttribute("font-family",a.fontFamily),(a.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&b.setAttribute("font-weight","bold"),
(a.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&b.setAttribute("font-style","italic"),(a.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&b.setAttribute("text-decoration","underline"),mxUtils.write(b,this.foAltText),b):null};
mxSvgCanvas2D.prototype.createGradientId=function(a,b,c,d,e){"#"==a.charAt(0)&&(a=a.substring(1));"#"==b.charAt(0)&&(b=b.substring(1));a=a.toLowerCase()+"-"+c;b=b.toLowerCase()+"-"+d;c=null;null==e||e==mxConstants.DIRECTION_SOUTH?c="s":e==mxConstants.DIRECTION_EAST?c="e":(d=a,a=b,b=d,e==mxConstants.DIRECTION_NORTH?c="s":e==mxConstants.DIRECTION_WEST&&(c="e"));return"mx-gradient-"+a+"-"+b+"-"+c};
mxSvgCanvas2D.prototype.getSvgGradient=function(a,b,c,d,e){var f=this.createGradientId(a,b,c,d,e),g=this.gradients[f];if(null==g){var h=this.root.ownerSVGElement,k=0,l=f+"-"+k;if(null!=h)for(g=h.ownerDocument.getElementById(l);null!=g&&g.ownerSVGElement!=h;)l=f+"-"+k++,g=h.ownerDocument.getElementById(l);else l="id"+ ++this.refCount;null==g&&(g=this.createSvgGradient(a,b,c,d,e),g.setAttribute("id",l),null!=this.defs?this.defs.appendChild(g):h.appendChild(g));this.gradients[f]=g}return g.getAttribute("id")};
mxSvgCanvas2D.prototype.createSvgGradient=function(a,b,c,d,e){var f=this.createElement("linearGradient");f.setAttribute("x1","0%");f.setAttribute("y1","0%");f.setAttribute("x2","0%");f.setAttribute("y2","0%");null==e||e==mxConstants.DIRECTION_SOUTH?f.setAttribute("y2","100%"):e==mxConstants.DIRECTION_EAST?f.setAttribute("x2","100%"):e==mxConstants.DIRECTION_NORTH?f.setAttribute("y1","100%"):e==mxConstants.DIRECTION_WEST&&f.setAttribute("x1","100%");c=1>c?";stop-opacity:"+c:"";e=this.createElement("stop");
e.setAttribute("offset","0%");e.setAttribute("style","stop-color:"+a+c);f.appendChild(e);c=1>d?";stop-opacity:"+d:"";e=this.createElement("stop");e.setAttribute("offset","100%");e.setAttribute("style","stop-color:"+b+c);f.appendChild(e);return f};
mxSvgCanvas2D.prototype.addNode=function(a,b){var c=this.node,d=this.state;if(null!=c){if("path"==c.nodeName)if(null!=this.path&&0<this.path.length)c.setAttribute("d",this.path.join(" "));else return;a&&null!=d.fillColor?this.updateFill():this.styleEnabled||("ellipse"==c.nodeName&&mxClient.IS_FF?c.setAttribute("fill","transparent"):c.setAttribute("fill","none"),a=!1);b&&null!=d.strokeColor?this.updateStroke():this.styleEnabled||c.setAttribute("stroke","none");null!=d.transform&&0<d.transform.length&&
c.setAttribute("transform",d.transform);d.shadow&&this.root.appendChild(this.createShadow(c));0<this.strokeTolerance&&!a&&this.root.appendChild(this.createTolerance(c));this.pointerEvents&&("path"!=c.nodeName||this.path[this.path.length-1]==this.closeOp)?c.setAttribute("pointer-events","all"):this.pointerEvents||c.setAttribute("pointer-events","none");this.root.appendChild(c)}};
mxSvgCanvas2D.prototype.updateFill=function(){var a=this.state;1>a.alpha&&this.node.setAttribute("fill-opacity",a.alpha);null!=a.fillColor&&(null!=a.gradientColor?(a=this.getSvgGradient(a.fillColor,a.gradientColor,a.fillAlpha,a.gradientAlpha,a.gradientDirection),this.node.setAttribute("fill","url(#"+a+")")):this.node.setAttribute("fill",a.fillColor.toLowerCase()))};
mxSvgCanvas2D.prototype.updateStroke=function(){var a=this.state;this.node.setAttribute("stroke",a.strokeColor.toLowerCase());1>a.alpha&&this.node.setAttribute("stroke-opacity",a.alpha);var b=Math.max(1,this.format(a.strokeWidth*a.scale));1!=b&&this.node.setAttribute("stroke-width",b);"path"==this.node.nodeName&&this.updateStrokeAttributes();a.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern(a.strokeWidth*a.scale))};
mxSvgCanvas2D.prototype.updateStrokeAttributes=function(){var a=this.state;null!=a.lineJoin&&"miter"!=a.lineJoin&&this.node.setAttribute("stroke-linejoin",a.lineJoin);if(null!=a.lineCap){var b=a.lineCap;"flat"==b&&(b="butt");"butt"!=b&&this.node.setAttribute("stroke-linecap",b)}null!=a.miterLimit&&(!this.styleEnabled||10!=a.miterLimit)&&this.node.setAttribute("stroke-miterlimit",a.miterLimit)};
mxSvgCanvas2D.prototype.createDashPattern=function(a){var b=this.state.dashPattern.split(" "),c=[];if(0<b.length)for(var d=0;d<b.length;d++)c[d]=Number(b[d])*a;return c.join(" ")};
mxSvgCanvas2D.prototype.createTolerance=function(a){var a=a.cloneNode(!0),b=parseFloat(a.getAttribute("stroke-width")||1)+this.strokeTolerance;a.setAttribute("pointer-events","stroke");a.setAttribute("visibility","hidden");a.removeAttribute("stroke-dasharray");a.setAttribute("stroke-width",b);a.setAttribute("fill","none");a.setAttribute("stroke",mxClient.IS_OP?"none":"white");return a};
mxSvgCanvas2D.prototype.createShadow=function(a){var a=a.cloneNode(!0),b=this.state;"none"!=a.getAttribute("fill")&&a.setAttribute("fill",b.shadowColor);"none"!=a.getAttribute("stroke")&&a.setAttribute("stroke",b.shadowColor);a.setAttribute("transform","translate("+this.format(b.shadowDx*b.scale)+","+this.format(b.shadowDy*b.scale)+")"+(b.transform||""));a.setAttribute("opacity",b.shadowAlpha);return a};
mxSvgCanvas2D.prototype.rotate=function(a,b,c,d,e){if(0!=a||b||c){var f=this.state,d=d+f.dx,e=e+f.dy,d=d*f.scale,e=e*f.scale;f.transform=f.transform||"";if(b&&c)a+=180;else if(b^c){var g=b?d:0,h=b?-1:1,k=c?e:0,l=c?-1:1;f.transform+="translate("+this.format(g)+","+this.format(k)+")scale("+this.format(h)+","+this.format(l)+")translate("+this.format(-g)+","+this.format(-k)+")"}if(b?!c:c)a*=-1;0!=a&&(f.transform+="rotate("+this.format(a)+","+this.format(d)+","+this.format(e)+")");f.rotation+=a;f.rotationCx=
d;f.rotationCy=e}};mxSvgCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createElement("path")};mxSvgCanvas2D.prototype.rect=function(a,b,c,d){var e=this.state,f=this.createElement("rect");f.setAttribute("x",this.format((a+e.dx)*e.scale));f.setAttribute("y",this.format((b+e.dy)*e.scale));f.setAttribute("width",this.format(c*e.scale));f.setAttribute("height",this.format(d*e.scale));this.node=f};
mxSvgCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){this.rect(a,b,c,d);0<e&&this.node.setAttribute("rx",this.format(e*this.state.scale));0<f&&this.node.setAttribute("ry",this.format(f*this.state.scale))};mxSvgCanvas2D.prototype.ellipse=function(a,b,c,d){var e=this.state,f=this.createElement("ellipse");f.setAttribute("cx",Math.round((a+c/2+e.dx)*e.scale));f.setAttribute("cy",Math.round((b+d/2+e.dy)*e.scale));f.setAttribute("rx",c/2*e.scale);f.setAttribute("ry",d/2*e.scale);this.node=f};
mxSvgCanvas2D.prototype.image=function(a,b,c,d,e,f,g,h){var e=this.converter.convert(e),f=null!=f?f:!0,g=null!=g?g:!1,h=null!=h?h:!1,k=this.state,a=a+k.dx,b=b+k.dy,l=this.createElement("image");l.setAttribute("x",this.format(a*k.scale));l.setAttribute("y",this.format(b*k.scale));l.setAttribute("width",this.format(c*k.scale));l.setAttribute("height",this.format(d*k.scale));null==l.setAttributeNS||this.root.ownerDocument!=document?l.setAttribute("xlink:href",e):l.setAttributeNS(mxConstants.NS_XLINK,
"href",e);f||l.setAttribute("preserveAspectRatio","none");1>k.alpha&&l.setAttribute("opacity",k.alpha);e=this.state.transform||"";if(g||h){var m=f=1,n=0,o=0;g&&(f=-1,n=-c-2*a);h&&(m=-1,o=-d-2*b);e+="scale("+f+","+m+")translate("+n+","+o+")"}0<e.length&&l.setAttribute("transform",e);this.pointerEvents||l.setAttribute("pointer-events","none");this.root.appendChild(l);this.blockImagePointerEvents&&(l.setAttribute("style","pointer-events:none"),l=this.createElement("rect"),l.setAttribute("visibility",
"hidden"),l.setAttribute("pointer-events","fill"),l.setAttribute("x",this.format(a*k.scale)),l.setAttribute("y",this.format(b*k.scale)),l.setAttribute("width",this.format(c*k.scale)),l.setAttribute("height",this.format(d*k.scale)),this.root.appendChild(l))};
mxSvgCanvas2D.prototype.createDiv=function(a,b,c,d,e){c=this.state;d="display:inline-block;font-size:"+Math.round(c.fontSize)+"px;font-family:"+c.fontFamily+";color:"+c.fontColor+";line-height:"+Math.round(c.fontSize*mxConstants.LINE_HEIGHT)+"px;"+d;(c.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(d+="font-weight:bold;");(c.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(d+="font-style:italic;");(c.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(d+="text-decoration:underline;");
b==mxConstants.ALIGN_CENTER?d+="text-align:center;":b==mxConstants.ALIGN_RIGHT&&(d+="text-align:right;");b="";null!=c.fontBackgroundColor&&(b+="background-color:"+c.fontBackgroundColor+";");null!=c.fontBorderColor&&(b+="border:1px solid "+c.fontBorderColor+";");mxUtils.isNode(a)||(c=document.createElement("textarea"),c.innerHTML=a.replace(/&lt;/g,"&amp;lt;").replace(/&gt;/g,"&amp;gt;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),a=c.value,"fill"!=e&&"width"!=e?0<b.length&&(a='<div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;'+
b+'">'+a+"</div>"):d+=b);if(!mxClient.IS_IE&&document.createElementNS)return e=document.createElementNS("http://www.w3.org/1999/xhtml","div"),e.setAttribute("style",d),mxUtils.isNode(a)?this.root.ownerDocument!=document?e.appendChild(a.cloneNode(!0)):e.appendChild(a):e.innerHTML=a,e;mxUtils.isNode(a)&&this.root.ownerDocument!=document&&(a=a.outerHTML);a=a.replace(/<br>/g,"<br />").replace(/<hr>/g,"<hr />");return mxUtils.parseXml('<div xmlns="http://www.w3.org/1999/xhtml" style="'+d+'">'+a+"</div>").documentElement};
mxSvgCanvas2D.prototype.text=function(a,b,c,d,e,f,g,h,k,l,m,n){if(this.textEnabled&&null!=e){var n=null!=n?n:0,o=this.state,a=a+o.dx,b=b+o.dy;if(this.foEnabled&&"html"==k){var q="vertical-align:top;";m?(q+="overflow:hidden;",0<d&&(q+="max-height:"+Math.round(d)+"px;"),0<c&&(q+="width:"+Math.round(c)+"px;")):"fill"==l?(q+="width:"+Math.round(c)+"px;",q+="height:"+Math.round(d)+"px;"):"width"==l&&(q+="width:"+Math.round(c)+"px;",0<d&&(q+="max-height:"+Math.round(d)+"px;"));h&&0<c?(m||(q+="width:"+Math.round(c)+
"px;"),q+="white-space:normal;"):q+="white-space:nowrap;";var r=this.createElement("g");1>o.alpha&&r.setAttribute("opacity",o.alpha);var u=this.createElement("foreignObject");u.setAttribute("pointer-events","all");q=this.createDiv(e,f,g,q,l);if(null!=q){r.appendChild(u);this.root.appendChild(r);var w=0,v=0;if(mxClient.IS_IE&&!mxClient.IS_SVG){var x=document.createElement("div");x.style.cssText=q.getAttribute("style");x.style.display=mxClient.IS_QUIRKS?"inline":"inline-block";x.style.visibility="hidden";
x.innerHTML=mxUtils.isNode(e)?e.outerHTML:e;document.body.appendChild(x);w=x.offsetWidth;v=mxClient.IS_QUIRKS&&0<d&&m?Math.min(d,x.offsetHeight+2):x.offsetHeight;x.parentNode.removeChild(x);u.appendChild(q)}else this.root.ownerDocument!=document||0<=navigator.userAgent.indexOf("Firefox/3.")?(q.style.visibility="hidden",document.body.appendChild(q),w=q.offsetWidth,v=q.offsetHeight,u.appendChild(q),q.style.visibility=""):(u.appendChild(q),w=q.offsetWidth,v=q.offsetHeight);!m&&h&&q.scrollWidth>w&&(w=
Math.max(w,q.scrollWidth),q.style.width=w+"px");"fill"==l?(c=Math.max(c,w),d=Math.max(d,v)):(c="width"==l?Math.max(c,w):w,d=v);1>o.alpha&&r.setAttribute("opacity",o.alpha);w=q=0;f==mxConstants.ALIGN_CENTER?q-=c/2:f==mxConstants.ALIGN_RIGHT&&(q-=c);a+=q;g==mxConstants.ALIGN_MIDDLE?w-=d/2:g==mxConstants.ALIGN_BOTTOM&&(w-=d);b+=w;v=1!=o.scale?"scale("+o.scale+")":"";0!=o.rotation&&this.rotateHtml?(v+="rotate("+o.rotation+","+c/2+","+d/2+")",b=this.rotatePoint((a+c/2)*o.scale,(b+d/2)*o.scale,o.rotation,
o.rotationCx,o.rotationCy),a=b.x-c*o.scale/2,b=b.y-d*o.scale/2):(a*=o.scale,b*=o.scale);0!=n&&(v+="rotate("+n+","+-q+","+-w+")");r.setAttribute("transform","translate("+Math.round(a)+","+Math.round(b)+")"+v);u.setAttribute("width",Math.round(Math.max(1,c)));u.setAttribute("height",Math.round(Math.max(1,d)));this.root.ownerDocument!=document&&(a=this.createAlternateContent(u,a,b,c,d,e,f,g,h,k,l,m,n),null!=a&&(u.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility"),c=this.createElement("switch"),
c.appendChild(u),c.appendChild(a),r.appendChild(c)))}}else this.plainText(a,b,c,d,e,f,g,h,l,m,n)}};
mxSvgCanvas2D.prototype.createClip=function(a,b,c,d){for(var a=Math.round(a),b=Math.round(b),c=Math.round(c),d=Math.round(d),e="mx-clip-"+a+"-"+b+"-"+c+"-"+d,f=0,g=e+"-"+f;null!=document.getElementById(g);)g=e+"-"+ ++f;clip=this.createElement("clipPath");clip.setAttribute("id",g);e=this.createElement("rect");e.setAttribute("x",a);e.setAttribute("y",b);e.setAttribute("width",c);e.setAttribute("height",d);clip.appendChild(e);return clip};
mxSvgCanvas2D.prototype.plainText=function(a,b,c,d,e,f,g,h,k,l,m){var m=null!=m?m:0,h=this.state,n=Math.round(h.fontSize),o=this.createElement("g"),q=h.transform||"";0!=m&&(q+="rotate("+m+","+this.format(a*h.scale)+","+this.format(b*h.scale)+")");if(l&&0<c&&0<d){var r=a,m=b;f==mxConstants.ALIGN_CENTER?r-=c/2:f==mxConstants.ALIGN_RIGHT&&(r-=c);"fill"!=k&&(g==mxConstants.ALIGN_MIDDLE?m-=d/2:g==mxConstants.ALIGN_BOTTOM&&(m-=d));m=this.createClip(r*h.scale-2,m*h.scale-2,c*h.scale+4,d*h.scale+4);null!=
this.defs?this.defs.appendChild(m):this.root.appendChild(m);o.setAttribute("clip-path","url(#"+m.getAttribute("id")+")")}m=f==mxConstants.ALIGN_RIGHT?"end":f==mxConstants.ALIGN_CENTER?"middle":"start";"start"!=m&&o.setAttribute("text-anchor",m);(!this.styleEnabled||n!=mxConstants.DEFAULT_FONTSIZE)&&o.setAttribute("font-size",Math.round(n*h.scale)+"px");0<q.length&&o.setAttribute("transform",q);1>h.alpha&&o.setAttribute("opacity",h.alpha);var q=e.split("\n"),r=Math.round(n*mxConstants.LINE_HEIGHT),
u=n+(q.length-1)*r,m=b+n-1;g==mxConstants.ALIGN_MIDDLE?"fill"==k?m-=d/2:(l=(this.matchHtmlAlignment&&l&&0<d?Math.min(u,d):u)/2,m-=l+1):g==mxConstants.ALIGN_BOTTOM&&("fill"==k?m-=d:(l=this.matchHtmlAlignment&&l&&0<d?Math.min(u,d):u,m-=l+2));for(l=0;l<q.length;l++)0<q[l].length&&0<mxUtils.trim(q[l]).length&&(n=this.createElement("text"),n.setAttribute("x",this.format(a*h.scale)),n.setAttribute("y",this.format(m*h.scale)),this.updateFont(n),mxUtils.write(n,q[l]),o.appendChild(n)),m+=r;this.root.appendChild(o);
this.addTextBackground(o,e,a,b,c,"fill"==k?d:u,f,g,k)};
mxSvgCanvas2D.prototype.updateFont=function(a){var b=this.state;a.setAttribute("fill",b.fontColor);(!this.styleEnabled||b.fontFamily!=mxConstants.DEFAULT_FONTFAMILY)&&a.setAttribute("font-family",b.fontFamily);(b.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&a.setAttribute("font-weight","bold");(b.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&a.setAttribute("font-style","italic");(b.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&a.setAttribute("text-decoration",
"underline")};
mxSvgCanvas2D.prototype.addTextBackground=function(a,b,c,d,e,f,g,h,k){var l=this.state;if(null!=l.fontBackgroundColor||null!=l.fontBorderColor){var m=null;"fill"==k||"width"==k?(g==mxConstants.ALIGN_CENTER?c-=e/2:g==mxConstants.ALIGN_RIGHT&&(c-=e),h==mxConstants.ALIGN_MIDDLE?d-=f/2:h==mxConstants.ALIGN_BOTTOM&&(d-=f),m=new mxRectangle((c+1)*l.scale,d*l.scale,(e-2)*l.scale,(f+2)*l.scale)):null!=a.getBBox&&this.root.ownerDocument==document?(m=a.getBBox(),b=mxClient.IS_IE&&mxClient.IS_SVG,m=new mxRectangle(m.x,
m.y+(b?0:1),m.width,m.height+(b?1:0))):(m=document.createElement("div"),m.style.lineHeight=Math.round(l.fontSize*mxConstants.LINE_HEIGHT)+"px",m.style.fontSize=Math.round(l.fontSize)+"px",m.style.fontFamily=l.fontFamily,m.style.whiteSpace="nowrap",m.style.position="absolute",m.style.visibility="hidden",m.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",m.style.zoom="1",(l.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(m.style.fontWeight="bold"),(l.fontStyle&mxConstants.FONT_ITALIC)==
mxConstants.FONT_ITALIC&&(m.style.fontStyle="italic"),b=mxUtils.htmlEntities(b,!1),m.innerHTML=b.replace(/\n/g,"<br/>"),document.body.appendChild(m),e=m.offsetWidth,f=m.offsetHeight,m.parentNode.removeChild(m),g==mxConstants.ALIGN_CENTER?c-=e/2:g==mxConstants.ALIGN_RIGHT&&(c-=e),h==mxConstants.ALIGN_MIDDLE?d-=f/2:h==mxConstants.ALIGN_BOTTOM&&(d-=f),m=new mxRectangle((c+1)*l.scale,(d+2)*l.scale,e*l.scale,(f+1)*l.scale));null!=m&&(b=this.createElement("rect"),b.setAttribute("fill",l.fontBackgroundColor||
"none"),b.setAttribute("stroke",l.fontBorderColor||"none"),b.setAttribute("x",Math.floor(m.x-1)),b.setAttribute("y",Math.floor(m.y-1)),b.setAttribute("width",Math.ceil(m.width+2)),b.setAttribute("height",Math.ceil(m.height)),l=null!=l.fontBorderColor?Math.max(1,this.format(l.scale)):0,b.setAttribute("stroke-width",l),this.root.ownerDocument==document&&1==mxUtils.mod(l,2)&&b.setAttribute("transform","translate(0.5, 0.5)"),a.insertBefore(b,a.firstChild))}};
mxSvgCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxSvgCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};mxSvgCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};var mxVmlCanvas2D=function(a){mxAbstractCanvas2D.call(this);this.root=a};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D);mxVmlCanvas2D.prototype.node=null;mxVmlCanvas2D.prototype.textEnabled=!0;mxVmlCanvas2D.prototype.moveOp="m";mxVmlCanvas2D.prototype.lineOp="l";mxVmlCanvas2D.prototype.curveOp="c";
mxVmlCanvas2D.prototype.closeOp="x";mxVmlCanvas2D.prototype.rotatedHtmlBackground="";mxVmlCanvas2D.prototype.vmlScale=1;
mxVmlCanvas2D.prototype.addNode=function(a,b){var c=this.node,d=this.state;if(null!=c){if("shape"==c.nodeName)if(null!=this.path&&0<this.path.length)c.path=this.path.join(" ")+" e",c.style.width=this.root.style.width,c.style.height=this.root.style.height,c.coordsize=parseInt(c.style.width)+" "+parseInt(c.style.height);else return;c.strokeweight=this.format(Math.max(1,d.strokeWidth*d.scale/this.vmlScale))+"px";d.shadow&&this.root.appendChild(this.createShadow(c,a&&null!=d.fillColor,b&&null!=d.strokeColor));
b&&null!=d.strokeColor?(c.stroked="true",c.strokecolor=d.strokeColor):c.stroked="false";c.appendChild(this.createStroke());a&&null!=d.fillColor?c.appendChild(this.createFill()):this.pointerEvents&&("shape"!=c.nodeName||this.path[this.path.length-1]==this.closeOp)?c.appendChild(this.createTransparentFill()):c.filled="false";this.root.appendChild(c)}};
mxVmlCanvas2D.prototype.createTransparentFill=function(){var a=document.createElement(mxClient.VML_PREFIX+":fill");a.src=mxClient.imageBasePath+"/transparent.gif";a.type="tile";return a};
mxVmlCanvas2D.prototype.createFill=function(){var a=this.state,b=document.createElement(mxClient.VML_PREFIX+":fill");b.color=a.fillColor;if(null!=a.gradientColor){b.type="gradient";b.method="none";b.color2=a.gradientColor;var c=180-a.rotation,c=a.gradientDirection==mxConstants.DIRECTION_WEST?c-(90+("x"==this.root.style.flip?180:0)):a.gradientDirection==mxConstants.DIRECTION_EAST?c+(90+("x"==this.root.style.flip?180:0)):a.gradientDirection==mxConstants.DIRECTION_NORTH?c-(180+("y"==this.root.style.flip?
-180:0)):c+("y"==this.root.style.flip?-180:0);if("x"==this.root.style.flip||"y"==this.root.style.flip)c*=-1;b.angle=mxUtils.mod(c,360);b.opacity=100*a.alpha*a.fillAlpha+"%";b.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",100*a.alpha*a.gradientAlpha+"%")}else 1>a.alpha&&(b.opacity=100*a.alpha+"%");return b};
mxVmlCanvas2D.prototype.createStroke=function(){var a=this.state,b=document.createElement(mxClient.VML_PREFIX+":stroke");b.endcap=a.lineCap||"flat";b.joinstyle=a.lineJoin||"miter";b.miterlimit=a.miterLimit||"10";1>a.alpha&&(b.opacity=100*a.alpha+"%");a.dashed&&(b.dashstyle=this.getVmlDashStyle());return b};mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var a="dash";if(null!=this.state.dashPattern){var b=this.state.dashPattern.split(" ");0<b.length&&1==b[0]&&(a="0 2")}return a};
mxVmlCanvas2D.prototype.createShadow=function(a,b,c){var d=this.state,e=-d.rotation*(Math.PI/180),f=Math.cos(e),e=Math.sin(e),g=d.shadowDx*d.scale,h=d.shadowDy*d.scale;"x"==this.root.style.flip?g*=-1:"y"==this.root.style.flip&&(h*=-1);var k=a.cloneNode(!0);k.style.marginLeft=Math.round(g*f-h*e)+"px";k.style.marginTop=Math.round(g*e+h*f)+"px";8==document.documentMode&&(k.strokeweight=a.strokeweight,"shape"==a.nodeName&&(k.path=this.path.join(" ")+" e",k.style.width=this.root.style.width,k.style.height=
this.root.style.height,k.coordsize=parseInt(a.style.width)+" "+parseInt(a.style.height)));c?(k.strokecolor=d.shadowColor,k.appendChild(this.createShadowStroke())):k.stroked="false";b?k.appendChild(this.createShadowFill()):k.filled="false";return k};mxVmlCanvas2D.prototype.createShadowFill=function(){var a=document.createElement(mxClient.VML_PREFIX+":fill");a.color=this.state.shadowColor;a.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return a};
mxVmlCanvas2D.prototype.createShadowStroke=function(){var a=this.createStroke();a.opacity=100*this.state.alpha*this.state.shadowAlpha+"%";return a};mxVmlCanvas2D.prototype.rotate=function(a,b,c,d,e){b&&c?a+=180:b?this.root.style.flip="x":c&&(this.root.style.flip="y");if(b?!c:c)a*=-1;this.root.style.rotation=a;this.state.rotation+=a;this.state.rotationCx=d;this.state.rotationCy=e};
mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=document.createElement(mxClient.VML_PREFIX+":shape");this.node.style.position="absolute"};
mxVmlCanvas2D.prototype.quadTo=function(a,b,c,d){var e=this.state,f=(this.lastX+e.dx)*e.scale,g=(this.lastY+e.dy)*e.scale,a=(a+e.dx)*e.scale,b=(b+e.dy)*e.scale,c=(c+e.dx)*e.scale,d=(d+e.dy)*e.scale,g=g+2/3*(b-g),h=c+2/3*(a-c),b=d+2/3*(b-d);this.path.push("c "+this.format(f+2/3*(a-f))+" "+this.format(g)+" "+this.format(h)+" "+this.format(b)+" "+this.format(c)+" "+this.format(d));this.lastX=c/e.scale-e.dx;this.lastY=d/e.scale-e.dy};
mxVmlCanvas2D.prototype.createRect=function(a,b,c,d,e){var f=this.state,a=document.createElement(a);a.style.position="absolute";a.style.left=this.format((b+f.dx)*f.scale)+"px";a.style.top=this.format((c+f.dy)*f.scale)+"px";a.style.width=this.format(d*f.scale)+"px";a.style.height=this.format(e*f.scale)+"px";return a};mxVmlCanvas2D.prototype.rect=function(a,b,c,d){this.node=this.createRect(mxClient.VML_PREFIX+":rect",a,b,c,d)};
mxVmlCanvas2D.prototype.roundrect=function(a,b,c,d,e,f){this.node=this.createRect(mxClient.VML_PREFIX+":roundrect",a,b,c,d);this.node.setAttribute("arcsize",Math.max(100*e/c,100*f/d)+"%")};mxVmlCanvas2D.prototype.ellipse=function(a,b,c,d){this.node=this.createRect(mxClient.VML_PREFIX+":oval",a,b,c,d)};
mxVmlCanvas2D.prototype.image=function(a,b,c,d,e,f,g,h){var k=null;f?(k=this.createRect(mxClient.VML_PREFIX+":rect",a,b,c,d),k.stroked="false",a=document.createElement(mxClient.VML_PREFIX+":fill"),a.aspect=f?"atmost":"ignore",a.rotate="true",a.type="frame",a.src=e,k.appendChild(a)):(k=this.createRect(mxClient.VML_PREFIX+":image",a,b,c,d),k.src=e);g&&h?k.style.rotation="180":g?k.style.flip="x":h&&(k.style.flip="y");1>this.state.alpha&&(k.style.filter+="alpha(opacity="+100*this.state.alpha+")");this.root.appendChild(k)};
mxVmlCanvas2D.prototype.createDiv=function(a,b,c,d){var c=document.createElement("div"),e=this.state,f="";null!=e.fontBackgroundColor&&(f+="background-color:"+e.fontBackgroundColor+";");null!=e.fontBorderColor&&(f+="border:1px solid "+e.fontBorderColor+";");mxUtils.isNode(a)?c.appendChild(a):0<f.length&&"fill"!=d&&"width"!=d?(d=document.createElement("div"),d.style.cssText=f,d.style.display=mxClient.IS_QUIRKS?"inline":"inline-block",d.style.zoom="1",d.innerHTML=a,c.appendChild(d)):(c.style.cssText=
f,c.innerHTML=a);a=c.style;a.fontSize=Math.round(e.fontSize/this.vmlScale)+"px";a.fontFamily=e.fontFamily;a.color=e.fontColor;a.verticalAlign="top";a.textAlign=b||"left";a.lineHeight=Math.round(e.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale)+"px";(e.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(a.fontWeight="bold");(e.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(a.fontStyle="italic");(e.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&(a.textDecoration=
"underline");return c};
mxVmlCanvas2D.prototype.text=function(a,b,c,d,e,f,g,h,k,l,m,n){if(this.textEnabled&&null!=e){var o=this.state;if("html"==k){null!=o.rotation&&(b=this.rotatePoint(a,b,o.rotation,o.rotationCx,o.rotationCy),a=b.x,b=b.y);8==document.documentMode?(a+=o.dx,b+=o.dy):(a*=o.scale,b*=o.scale);k=8==document.documentMode?document.createElement(mxClient.VML_PREFIX+":group"):document.createElement("div");k.style.position="absolute";k.style.display="inline";k.style.left=this.format(a)+"px";k.style.top=this.format(b)+
"px";k.style.zoom=o.scale;var q=document.createElement("div");q.style.position="relative";q.style.display="inline";var r=mxUtils.getAlignmentAsPoint(f,g),u=r.x,r=r.y,e=this.createDiv(e,f,g,l),f=document.createElement("div");h&&0<c?(m||(e.style.width=Math.round(c)+"px"),e.style.whiteSpace="normal"):e.style.whiteSpace="nowrap";n=o.rotation+(n||0);this.rotateHtml&&0!=n?(f.style.display="inline",f.style.zoom="1",f.appendChild(e),8==document.documentMode&&"DIV"!=this.root.nodeName?(q.appendChild(f),k.appendChild(q)):
k.appendChild(f)):8==document.documentMode?(q.appendChild(e),k.appendChild(q)):(e.style.display="inline",k.appendChild(e));"DIV"!=this.root.nodeName?(g=document.createElement(mxClient.VML_PREFIX+":rect"),g.stroked="false",g.filled="false",g.appendChild(k),this.root.appendChild(g)):this.root.appendChild(k);m?(e.style.overflow="hidden",0<c&&(e.style.width=Math.round(c)+"px"),0<d&&8==document.documentMode&&(e.style.maxHeight=Math.round(d)+"px")):"fill"==l?(e.style.width=c+"px",e.style.height=d+"px"):
"width"==l&&(e.style.width=c+"px",0<d&&(e.style.maxHeight=Math.round(d)+"px"));if(this.rotateHtml&&0!=n){c=n*(Math.PI/180);n=parseFloat(parseFloat(Math.cos(c)).toFixed(8));g=parseFloat(parseFloat(Math.sin(-c)).toFixed(8));c%=2*Math.PI;0>c&&(c+=2*Math.PI);c%=Math.PI;c>Math.PI/2&&(c=Math.PI-c);var w=Math.cos(c),v=Math.sin(c);8==document.documentMode&&(e.style.display="inline-block",f.style.display="inline-block",q.style.display="inline-block");e.style.visibility="hidden";document.body.appendChild(e);
c=e.offsetWidth;q=e.offsetHeight;!m&&h&&(c=Math.max(c,e.scrollWidth),e.style.width=c+"px");if(mxClient.IS_QUIRKS&&(m||"width"==l)&&q>d)q=d,e.style.height=q+"px";d=q;m=(d-d*w+c*-v)/2-g*c*(u+0.5)+n*d*(r+0.5);h=(c-c*w+d*-v)/2+n*c*(u+0.5)+g*d*(r+0.5);"group"==k.nodeName&&"DIV"==this.root.nodeName?(l=document.createElement("div"),l.style.display="inline-block",l.style.position="absolute",l.style.left=this.format(a+(h-c/2)*o.scale)+"px",l.style.top=this.format(b+(m-d/2)*o.scale)+"px",k.parentNode.appendChild(l),
l.appendChild(k)):(o=8==document.documentMode?1:o.scale,k.style.left=this.format(a+(h-c/2)*o)+"px",k.style.top=this.format(b+(m-d/2)*o)+"px");f.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+n+", M12="+g+", M21="+-g+", M22="+n+", sizingMethod='auto expand')";f.style.backgroundColor=this.rotatedHtmlBackground;1>this.state.alpha&&(f.style.filter+="alpha(opacity="+100*this.state.alpha+")");e.style.visibility="";f.appendChild(e)}else 8!=document.documentMode?(e.style.verticalAlign="top",
1>this.state.alpha&&(k.style.filter="alpha(opacity="+100*this.state.alpha+")"),o=e.parentNode,e.style.visibility="hidden",document.body.appendChild(e),c=e.offsetWidth,q=e.offsetHeight,mxClient.IS_QUIRKS&&m&&q>d&&(q=d,e.style.height=q+"px"),d=q,e.style.visibility="",o.appendChild(e),k.style.left=this.format(a+c*u*this.state.scale)+"px",k.style.top=this.format(b+d*r*this.state.scale)+"px"):(1>this.state.alpha&&(e.style.filter="alpha(opacity="+100*this.state.alpha+")"),q.style.left=100*u+"%",q.style.top=
100*r+"%")}else this.plainText(a,b,c,d,mxUtils.htmlEntities(e,!1),f,g,h,k,l,m,n)}};
mxVmlCanvas2D.prototype.plainText=function(a,b,c,d,e,f,g,h,k,l,m,n){h=this.state;a=(a+h.dx)*h.scale;b=(b+h.dy)*h.scale;c=document.createElement(mxClient.VML_PREFIX+":shape");c.style.width="1px";c.style.height="1px";c.stroked="false";d=document.createElement(mxClient.VML_PREFIX+":fill");d.color=h.fontColor;d.opacity=100*h.alpha+"%";c.appendChild(d);d=document.createElement(mxClient.VML_PREFIX+":path");d.textpathok="true";d.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0);
c.appendChild(d);d=document.createElement(mxClient.VML_PREFIX+":textpath");d.style.cssText="v-text-align:"+f;d.style.align=f;d.style.fontFamily=h.fontFamily;d.string=e;d.on="true";f=Math.round(h.fontSize*h.scale/this.vmlScale);d.style.fontSize=f+"px";(h.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD&&(d.style.fontWeight="bold");(h.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC&&(d.style.fontStyle="italic");(h.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE&&
(d.style.textDecoration="underline");e=e.split("\n");h=f+(e.length-1)*f*mxConstants.LINE_HEIGHT;f=e=0;g==mxConstants.ALIGN_BOTTOM?f=-h/2:g!=mxConstants.ALIGN_MIDDLE&&(f=h/2);null!=n&&(c.style.rotation=n,g=n*(Math.PI/180),e=Math.sin(g)*f,f*=Math.cos(g));c.appendChild(d);c.style.left=this.format(a-e)+"px";c.style.top=this.format(b+f)+"px";this.root.appendChild(c)};mxVmlCanvas2D.prototype.stroke=function(){this.addNode(!1,!0)};mxVmlCanvas2D.prototype.fill=function(){this.addNode(!0,!1)};
mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(!0,!0)};function mxGuide(a,b){this.graph=a;this.setStates(b)}mxGuide.prototype.graph=null;mxGuide.prototype.states=null;mxGuide.prototype.horizontal=!0;mxGuide.prototype.vertical=!0;mxGuide.prototype.guideX=null;mxGuide.prototype.guideY=null;mxGuide.prototype.setStates=function(a){this.states=a};mxGuide.prototype.isEnabledForEvent=function(){return!0};
mxGuide.prototype.getGuideTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};mxGuide.prototype.createGuideShape=function(a){a=new mxPolyline([],mxConstants.GUIDE_COLOR,mxConstants.GUIDE_STROKEWIDTH);a.isDashed=!0;return a};
mxGuide.prototype.move=function(a,b,c){if(null!=this.states&&(this.horizontal||this.vertical)&&null!=a&&null!=b){var d=this.graph.getView().translate,e=this.graph.getView().scale,f=b.x,g=b.y,h=!1,k=!1,l=this.getGuideTolerance(),m=l,n=l,l=a.clone();l.x+=b.x;l.y+=b.y;for(var o=l.x,q=l.x+l.width,r=l.getCenterX(),u=l.y,w=l.y+l.height,v=l.getCenterY(),b=function(b){var b=b+this.graph.panDx,c=!1;Math.abs(b-r)<m?(f=b-a.getCenterX(),m=Math.abs(b-r),c=!0):Math.abs(b-o)<m?(f=b-a.x,m=Math.abs(b-o),c=!0):Math.abs(b-
q)<m&&(f=b-a.x-a.width,m=Math.abs(b-q),c=!0);if(c){null==this.guideX&&(this.guideX=this.createGuideShape(!0),this.guideX.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()));var d=this.graph.container,b=b-this.graph.panDx;this.guideX.points=[new mxPoint(b,-this.graph.panDy),new mxPoint(b,d.scrollHeight-3-this.graph.panDy)]}h=h||c},l=function(b){var b=b+this.graph.panDy,
c=!1;Math.abs(b-v)<n?(g=b-a.getCenterY(),n=Math.abs(b-v),c=!0):Math.abs(b-u)<n?(g=b-a.y,n=Math.abs(b-u),c=!0):Math.abs(b-w)<n&&(g=b-a.y-a.height,n=Math.abs(b-w),c=!0);if(c){null==this.guideY&&(this.guideY=this.createGuideShape(!1),this.guideY.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()));var d=this.graph.container,b=b-this.graph.panDy;this.guideY.points=[new mxPoint(-this.graph.panDx,
b),new mxPoint(d.scrollWidth-3-this.graph.panDx,b)]}k=k||c},x=0;x<this.states.length;x++){var z=this.states[x];null!=z&&(this.horizontal&&(b.call(this,z.getCenterX()),b.call(this,z.x),b.call(this,z.x+z.width)),this.vertical&&(l.call(this,z.getCenterY()),l.call(this,z.y),l.call(this,z.y+z.height)))}!h&&null!=this.guideX?this.guideX.node.style.visibility="hidden":null!=this.guideX&&(this.guideX.node.style.visibility="visible",this.guideX.redraw());!k&&null!=this.guideY?this.guideY.node.style.visibility=
"hidden":null!=this.guideY&&(this.guideY.node.style.visibility="visible",this.guideY.redraw());c&&(h||(c=a.x-(this.graph.snap(a.x/e-d.x)+d.x)*e,f=this.graph.snap(f/e)*e-c),k||(d=a.y-(this.graph.snap(a.y/e-d.y)+d.y)*e,g=this.graph.snap(g/e)*e-d));b=new mxPoint(f,g)}return b};mxGuide.prototype.hide=function(){null!=this.guideX&&(this.guideX.node.style.visibility="hidden");null!=this.guideY&&(this.guideY.node.style.visibility="hidden")};
mxGuide.prototype.destroy=function(){null!=this.guideX&&(this.guideX.destroy(),this.guideX=null);null!=this.guideY&&(this.guideY.destroy(),this.guideY=null)};function mxStencil(a){this.desc=a;this.parseDescription();this.parseConstraints()}mxStencil.defaultLocalized=!1;mxStencil.prototype.desc=null;mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;
mxStencil.prototype.strokewidth=null;mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);var a=this.desc.getAttribute("aspect");this.aspect=null!=a?a:"variable";a=this.desc.getAttribute("strokewidth");this.strokewidth=null!=a?a:"1"};
mxStencil.prototype.parseConstraints=function(){var a=this.desc.getElementsByTagName("connections")[0];if(null!=a&&(a=mxUtils.getChildNodes(a),null!=a&&0<a.length)){this.constraints=[];for(var b=0;b<a.length;b++)this.constraints.push(this.parseConstraint(a[b]))}};mxStencil.prototype.parseConstraint=function(a){var b=Number(a.getAttribute("x")),c=Number(a.getAttribute("y")),a="1"==a.getAttribute("perimeter");return new mxConnectionConstraint(new mxPoint(b,c),a)};
mxStencil.prototype.evaluateTextAttribute=function(a,b,c){b=this.evaluateAttribute(a,b,c);a=a.getAttribute("localized");if(mxStencil.defaultLocalized&&null==a||"1"==a)b=mxResources.get(b);return b};mxStencil.prototype.evaluateAttribute=function(a,b,c){b=a.getAttribute(b);null==b&&(a=mxUtils.getTextContent(a),null!=a&&(a=mxUtils.eval(a),"function"==typeof a&&(b=a(c))));return b};
mxStencil.prototype.drawShape=function(a,b,c,d,e,f){this.drawChildren(a,b,c,d,e,f,this.bgNode,!1);this.drawChildren(a,b,c,d,e,f,this.fgNode,!0)};
mxStencil.prototype.drawChildren=function(a,b,c,d,e,f,g,h){if(null!=g&&0<e&&0<f){var k=mxUtils.getValue(b.style,mxConstants.STYLE_DIRECTION,null),c=this.computeAspect(b.style,c,d,e,f,k),d=Math.min(c.width,c.height),d="inherit"==this.strokewidth?Number(mxUtils.getNumber(b.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*d;a.setStrokeWidth(d);for(g=g.firstChild;null!=g;)g.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,g,c,h),g=g.nextSibling}};
mxStencil.prototype.computeAspect=function(a,b,c,d,e,f){var a=b,b=d/this.w0,g=e/this.h0;if(f=f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH)var g=d/this.h0,b=e/this.w0,h=(d-e)/2,a=a+h,c=c-h;"fixed"==this.aspect&&(b=g=Math.min(b,g),f?(a+=(e-this.w0*b)/2,c+=(d-this.h0*g)/2):(a+=(d-this.w0*b)/2,c+=(e-this.h0*g)/2));return new mxRectangle(a,c,b,g)};
mxStencil.prototype.drawNode=function(a,b,c,d,e){var f=c.nodeName,g=d.x,h=d.y,k=d.width,l=d.height,m=Math.min(k,l);if("save"==f)a.save();else if("restore"==f)a.restore();else if("path"==f){a.begin();for(c=c.firstChild;null!=c;)c.nodeType==mxConstants.NODETYPE_ELEMENT&&this.drawNode(a,b,c,d,e),c=c.nextSibling}else if("close"==f)a.close();else if("move"==f)a.moveTo(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l);else if("line"==f)a.lineTo(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*
l);else if("quad"==f)a.quadTo(g+Number(c.getAttribute("x1"))*k,h+Number(c.getAttribute("y1"))*l,g+Number(c.getAttribute("x2"))*k,h+Number(c.getAttribute("y2"))*l);else if("curve"==f)a.curveTo(g+Number(c.getAttribute("x1"))*k,h+Number(c.getAttribute("y1"))*l,g+Number(c.getAttribute("x2"))*k,h+Number(c.getAttribute("y2"))*l,g+Number(c.getAttribute("x3"))*k,h+Number(c.getAttribute("y3"))*l);else if("arc"==f)a.arcTo(Number(c.getAttribute("rx"))*k,Number(c.getAttribute("ry"))*l,Number(c.getAttribute("x-axis-rotation")),
Number(c.getAttribute("large-arc-flag")),Number(c.getAttribute("sweep-flag")),g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l);else if("rect"==f)a.rect(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l,Number(c.getAttribute("w"))*k,Number(c.getAttribute("h"))*l);else if("roundrect"==f)b=Number(c.getAttribute("arcsize")),0==b&&(b=100*mxConstants.RECTANGLE_ROUNDING_FACTOR),m=Number(c.getAttribute("w"))*k,d=Number(c.getAttribute("h"))*l,b=Number(b)/100,b=Math.min(m*b,d*
b),a.roundrect(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l,m,d,b,b);else if("ellipse"==f)a.ellipse(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l,Number(c.getAttribute("w"))*k,Number(c.getAttribute("h"))*l);else if("image"==f)b=this.evaluateAttribute(c,"src",b),a.image(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l,Number(c.getAttribute("w"))*k,Number(c.getAttribute("h"))*l,b,!1,"1"==c.getAttribute("flipH"),"1"==c.getAttribute("flipV"));else if("text"==
f){m=this.evaluateTextAttribute(c,"str",b);d="1"==c.getAttribute("vertical")?-90:0;if("0"==c.getAttribute("align-shape"))var n=b.rotation,o=1==mxUtils.getValue(b.style,mxConstants.STYLE_FLIPH,0),b=1==mxUtils.getValue(b.style,mxConstants.STYLE_FLIPV,0),d=o&&b?d-n:o||b?d+n:d-n;d-=c.getAttribute("rotation");a.text(g+Number(c.getAttribute("x"))*k,h+Number(c.getAttribute("y"))*l,0,0,m,c.getAttribute("align")||"left",c.getAttribute("valign")||"top",!1,"",null,!1,d)}else if("include-shape"==f)n=mxStencilRegistry.getStencil(c.getAttribute("name")),
null!=n&&(g+=Number(c.getAttribute("x"))*k,h+=Number(c.getAttribute("y"))*l,m=Number(c.getAttribute("w"))*k,d=Number(c.getAttribute("h"))*l,n.drawShape(a,b,g,h,m,d));else if("fillstroke"==f)a.fillAndStroke();else if("fill"==f)a.fill();else if("stroke"==f)a.stroke();else if("strokewidth"==f)k="1"==c.getAttribute("fixed")?1:m,a.setStrokeWidth(Number(c.getAttribute("width"))*k);else if("dashed"==f)a.setDashed("1"==c.getAttribute("dashed"));else if("dashpattern"==f){if(c=c.getAttribute("pattern"),null!=
c){c=c.split(" ");k=[];for(l=0;l<c.length;l++)0<c[l].length&&k.push(Number(c[l])*m);c=k.join(" ");a.setDashPattern(c)}}else"strokecolor"==f?a.setStrokeColor(c.getAttribute("color")):"linecap"==f?a.setLineCap(c.getAttribute("cap")):"linejoin"==f?a.setLineJoin(c.getAttribute("join")):"miterlimit"==f?a.setMiterLimit(Number(c.getAttribute("limit"))):"fillcolor"==f?a.setFillColor(c.getAttribute("color")):"alpha"==f?a.setAlpha(c.getAttribute("alpha")):"fontcolor"==f?a.setFontColor(c.getAttribute("color")):
"fontstyle"==f?a.setFontStyle(c.getAttribute("style")):"fontfamily"==f?a.setFontFamily(c.getAttribute("family")):"fontsize"==f&&a.setFontSize(Number(c.getAttribute("size"))*m);e&&("fillstroke"==f||"fill"==f||"stroke"==f)&&a.setShadow(!1)};function mxShape(a){this.stencil=a;this.strokewidth=1;this.rotation=0;this.opacity=100;this.flipV=this.flipH=!1}mxShape.prototype.dialect=null;mxShape.prototype.scale=1;mxShape.prototype.bounds=null;mxShape.prototype.points=null;mxShape.prototype.node=null;
mxShape.prototype.state=null;mxShape.prototype.style=null;mxShape.prototype.boundingBox=null;mxShape.prototype.stencil=null;mxShape.prototype.svgStrokeTolerance=6;mxShape.prototype.pointerEvents=!0;mxShape.prototype.stencilPointerEvents=!1;mxShape.prototype.vmlScale=1;mxShape.prototype.init=function(a){null==this.node&&(this.node=this.create(a),null!=a&&a.appendChild(this.node))};mxShape.prototype.isParseVml=function(){return!0};mxShape.prototype.isHtmlAllowed=function(){return!1};
mxShape.prototype.getSvgScreenOffset=function(){return 1==mxUtils.mod(Math.max(1,Math.round((this.stencil&&"inherit"!=this.stencil.strokewidth?Number(this.stencil.strokewidth):this.strokewidth)*this.scale)),2)?0.5:0};mxShape.prototype.create=function(a){return null!=a.ownerSVGElement?this.createSvg(a):8==document.documentMode||this.dialect==mxConstants.DIALECT_SVG||this.dialect!=mxConstants.DIALECT_VML&&this.isHtmlAllowed()?this.createHtml(a):this.createVml(a)};
mxShape.prototype.createSvg=function(){return document.createElementNS(mxConstants.NS_SVG,"g")};mxShape.prototype.createVml=function(){var a=document.createElement(mxClient.VML_PREFIX+":group");a.style.position="absolute";return a};mxShape.prototype.createHtml=function(){var a=document.createElement("div");a.style.position="absolute";return a};mxShape.prototype.reconfigure=function(){this.redraw()};
mxShape.prototype.redraw=function(){this.updateBoundsFromPoints();this.checkBounds()?(this.node.style.visibility="","DIV"==this.node.nodeName&&this.isHtmlAllowed()?this.redrawHtmlShape():this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)};
mxShape.prototype.updateBoundsFromPoints=function(){var a=this.points;if(null!=a&&0<a.length&&null!=a[0]){this.bounds=new mxRectangle(Number(a[0].x),Number(a[0].y),1,1);for(var b=1;b<this.points.length;b++)null!=a[b]&&this.bounds.add(new mxRectangle(Number(a[b].x),Number(a[b].y),1,1))}};mxShape.prototype.getLabelBounds=function(a){return a};
mxShape.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)&&0<this.bounds.width&&0<this.bounds.height};mxShape.prototype.createVmlGroup=function(){var a=document.createElement(mxClient.VML_PREFIX+":group");a.style.position="absolute";a.style.width=this.node.style.width;a.style.height=this.node.style.height;return a};
mxShape.prototype.redrawShape=function(){var a=this.createCanvas();for(a.pointerEvents=this.pointerEvents;this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);this.paint(a);this.node!=a.root&&this.node.insertAdjacentHTML("beforeend",a.root.outerHTML);"DIV"==this.node.nodeName&&8==document.documentMode&&(this.node.style.filter="",(null==this.stencil||null!=this.stencil&&!this.stencilPointerEvents)&&mxUtils.addTransparentBackgroundFilter(this.node));this.destroyCanvas(a)};
mxShape.prototype.createCanvas=function(){var a=null;null!=this.node.ownerSVGElement?a=this.createSvgCanvas():(this.updateVmlContainer(),a=this.createVmlCanvas(null));return a};
mxShape.prototype.createSvgCanvas=function(){var a=new mxSvgCanvas2D(this.node,!1);a.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0;a.blockImagePointerEvents=mxClient.IS_FF;var b=this.getSvgScreenOffset();0!=b?this.node.setAttribute("transform","translate("+b+","+b+")"):this.node.removeAttribute("transform");return a};
mxShape.prototype.createVmlCanvas=function(){var a=8==document.documentMode&&this.isParseVml()?this.createVmlGroup():this.node,b=new mxVmlCanvas2D(a,!1);if(""!=a.tagUrn){var c=Math.max(1,Math.round(this.bounds.width)),d=Math.max(1,Math.round(this.bounds.height));a.coordsize=c*this.vmlScale+","+d*this.vmlScale;b.scale(this.vmlScale);b.vmlScale=this.vmlScale}a=this.scale;b.translate(-Math.round(this.bounds.x/a),-Math.round(this.bounds.y/a));return b};
mxShape.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";var a=Math.max(1,Math.round(this.bounds.width)),b=Math.max(1,Math.round(this.bounds.height));this.node.style.width=a+"px";this.node.style.height=b+"px";this.node.style.overflow="visible"};
mxShape.prototype.destroyCanvas=function(a){if(a instanceof mxSvgCanvas2D){for(var b in a.gradients){var c=a.gradients[b];c.mxRefCount=(c.mxRefCount||0)+1}this.releaseSvgGradients(this.oldGradients);this.oldGradients=a.gradients}};
mxShape.prototype.paint=function(a){var b=this.scale,c=this.bounds.x/b,d=this.bounds.y/b,e=this.bounds.width/b,f=this.bounds.height/b;if(this.isPaintBoundsInverted())var g=(e-f)/2,c=c+g,d=d-g,g=e,e=f,f=g;this.updateTransform(a,c,d,e,f);this.configureCanvas(a,c,d,e,f);if(null!=this.stencil)this.paintStencilShape(a,c,d,e,f);else if(a.setStrokeWidth(this.strokewidth),null!=this.points){c=[];for(d=0;d<this.points.length;d++)c.push(new mxPoint(this.points[d].x/b,this.points[d].y/b));this.paintEdgeShape(a,
c)}else this.paintVertexShape(a,c,d,e,f)};mxShape.prototype.configureCanvas=function(a,b,c,d,e){var f=null;null!=this.style&&(f=this.style.dashPattern);a.setAlpha(this.opacity/100);null!=this.isShadow&&a.setShadow(this.isShadow);null!=this.isDashed&&a.setDashed(this.isDashed);null!=f&&a.setDashPattern(f);null!=this.gradient?(b=this.getGradientBounds(a,b,c,d,e),a.setGradient(this.fill,this.gradient,b.x,b.y,b.width,b.height,this.gradientDirection)):a.setFillColor(this.fill);a.setStrokeColor(this.stroke)};
mxShape.prototype.getGradientBounds=function(a,b,c,d,e){return new mxRectangle(b,c,d,e)};mxShape.prototype.updateTransform=function(a,b,c,d,e){a.scale(this.scale);a.rotate(this.getShapeRotation(),this.flipH,this.flipV,b+d/2,c+e/2)};
mxShape.prototype.paintStencilShape=function(a,b,c,d,e){this.stencilPointerEvents&&(this.dialect==mxConstants.DIALECT_SVG?this.addTransparentBackgroundRectangle(this.node,b,c,d,e):8!=document.documentMode&&this.setTransparentBackgroundImage(this.node));this.stencil.drawShape(a,this,b,c,d,e)};mxShape.prototype.paintVertexShape=function(a,b,c,d,e){this.paintBackground(a,b,c,d,e);a.setShadow(!1);this.paintForeground(a,b,c,d,e)};mxShape.prototype.paintBackground=function(){};
mxShape.prototype.paintForeground=function(){};mxShape.prototype.paintEdgeShape=function(){};mxShape.prototype.getArcSize=function(a,b){var c=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return Math.min(a*c,b*c)};
mxShape.prototype.paintGlassEffect=function(a,b,c,d,e,f){var g=Math.ceil(this.strokewidth/2);a.setGradient("#ffffff","#ffffff",b,c,d,0.6*e,"south",0.9,0.1);a.begin();f+=2*g;this.isRounded?(a.moveTo(b-g+f,c-g),a.quadTo(b-g,c-g,b-g,c-g+f),a.lineTo(b-g,c+0.4*e),a.quadTo(b+0.5*d,c+0.7*e,b+d+g,c+0.4*e),a.lineTo(b+d+g,c-g+f),a.quadTo(b+d+g,c-g,b+d+g-f,c-g)):(a.moveTo(b-g,c-g),a.lineTo(b-g,c+0.4*e),a.quadTo(b+0.5*d,c+0.7*e,b+d+g,c+0.4*e),a.lineTo(b+d+g,c-g));a.close();a.fill()};
mxShape.prototype.apply=function(a){this.state=a;this.style=a.style;if(null!=this.style){this.fill=mxUtils.getValue(this.style,mxConstants.STYLE_FILLCOLOR,this.fill);this.gradient=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENTCOLOR,this.gradient);this.gradientDirection=mxUtils.getValue(this.style,mxConstants.STYLE_GRADIENT_DIRECTION,this.gradientDirection);this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_OPACITY,this.opacity);this.stroke=mxUtils.getValue(this.style,mxConstants.STYLE_STROKECOLOR,
this.stroke);this.strokewidth=mxUtils.getNumber(this.style,mxConstants.STYLE_STROKEWIDTH,this.strokewidth);this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing);this.startSize=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,this.startSize);this.endSize=mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,this.endSize);this.startArrow=mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,this.startArrow);this.endArrow=mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,
this.endArrow);this.rotation=mxUtils.getValue(this.style,mxConstants.STYLE_ROTATION,this.rotation);this.direction=mxUtils.getValue(this.style,mxConstants.STYLE_DIRECTION,this.direction);this.flipH=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPH,0);this.flipV=1==mxUtils.getValue(this.style,mxConstants.STYLE_FLIPV,0);null!=this.stencil&&(this.flipH=1==mxUtils.getValue(this.style,"stencilFlipH",0)||this.flipH,this.flipV=1==mxUtils.getValue(this.style,"stencilFlipV",0)||this.flipV);if(this.direction==
mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)a=this.flipH,this.flipH=this.flipV,this.flipV=a;this.isShadow=1==mxUtils.getValue(this.style,mxConstants.STYLE_SHADOW,this.isShadow);this.isDashed=1==mxUtils.getValue(this.style,mxConstants.STYLE_DASHED,this.isDashed);this.isRounded=1==mxUtils.getValue(this.style,mxConstants.STYLE_ROUNDED,this.isRounded);this.glass=1==mxUtils.getValue(this.style,mxConstants.STYLE_GLASS,this.glass);"none"==this.fill&&(this.fill=null);"none"==
this.gradient&&(this.gradient=null);"none"==this.stroke&&(this.stroke=null)}};mxShape.prototype.setCursor=function(a){null==a&&(a="");this.cursor=a;null!=this.node&&(this.node.style.cursor=a)};mxShape.prototype.getCursor=function(){return this.cursor};
mxShape.prototype.updateBoundingBox=function(){if(null!=this.bounds){var a=this.createBoundingBox();if(null!=a){this.augmentBoundingBox(a);var b=this.getShapeRotation();0!=b&&(a=mxUtils.getBoundingBox(a,b));a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.width=Math.ceil(a.width);a.height=Math.ceil(a.height)}this.boundingBox=a}};
mxShape.prototype.createBoundingBox=function(){var a=this.bounds.clone();if(null!=this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)||this.isPaintBoundsInverted()){var b=(a.width-a.height)/2;a.x+=b;a.y-=b;b=a.width;a.width=a.height;a.height=b}return a};
mxShape.prototype.augmentBoundingBox=function(a){this.isShadow&&(a.width+=Math.ceil(mxConstants.SHADOW_OFFSET_X*this.scale),a.height+=Math.ceil(mxConstants.SHADOW_OFFSET_Y*this.scale));var b=Math.ceil(this.strokewidth*this.scale);a.grow(Math.ceil(b/2))};mxShape.prototype.isPaintBoundsInverted=function(){return null==this.stencil&&(this.direction==mxConstants.DIRECTION_NORTH||this.direction==mxConstants.DIRECTION_SOUTH)};
mxShape.prototype.getRotation=function(){return null!=this.rotation?this.rotation:0};mxShape.prototype.getTextRotation=function(){var a=this.getRotation();1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(a+=mxText.prototype.verticalTextRotation);return a};
mxShape.prototype.getShapeRotation=function(){var a=this.getRotation();null!=this.direction&&(this.direction==mxConstants.DIRECTION_NORTH?a+=270:this.direction==mxConstants.DIRECTION_WEST?a+=180:this.direction==mxConstants.DIRECTION_SOUTH&&(a+=90));return a};
mxShape.prototype.addTransparentBackgroundRectangle=function(a,b,c,d,e){a=document.createElementNS(mxConstants.NS_SVG,"rect");a.setAttribute("x",b);a.setAttribute("y",c);a.setAttribute("width",d);a.setAttribute("height",e);a.setAttribute("fill","none");a.setAttribute("stroke","none");a.setAttribute("pointer-events","all");this.node.appendChild(a)};mxShape.prototype.setTransparentBackgroundImage=function(a){a.style.backgroundImage="url('"+mxClient.imageBasePath+"/transparent.gif')"};
mxShape.prototype.releaseSvgGradients=function(a){if(null!=a)for(var b in a){var c=a[b];c.mxRefCount=(c.mxRefCount||0)-1;0==c.mxRefCount&&null!=c.parentNode&&c.parentNode.removeChild(c)}};mxShape.prototype.destroy=function(){null!=this.node&&(mxEvent.release(this.node),null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node=null);this.releaseSvgGradients(this.oldGradients);this.oldGradients=null};
var mxStencilRegistry={stencils:[],addStencil:function(a,b){mxStencilRegistry.stencils[a]=b},getStencil:function(a){return mxStencilRegistry.stencils[a]}},mxMarker={markers:[],addMarker:function(a,b){mxMarker.markers[a]=b},createMarker:function(a,b,c,d,e,f,g,h,k,l){var m=mxMarker.markers[c];return null!=m?m(a,b,c,d,e,f,g,h,k,l):null}};
(function(){function a(a,b,e,f,g,h,k,l,m,n){var b=1.118*g*m,l=1.118*h*m,g=g*(k+m),h=h*(k+m),o=f.clone();o.x-=b;o.y-=l;k=e!=mxConstants.ARROW_CLASSIC?1:0.75;f.x+=-g*k-b;f.y+=-h*k-l;return function(){a.begin();a.moveTo(o.x,o.y);a.lineTo(o.x-g-h/2,o.y-h+g/2);e==mxConstants.ARROW_CLASSIC&&a.lineTo(o.x-3*g/4,o.y-3*h/4);a.lineTo(o.x+h/2-g,o.y-h-g/2);a.close();n?a.fillAndStroke():a.stroke()}}function b(a,b,e,f,g,h,k,l,m,n){var l=e==mxConstants.ARROW_DIAMOND?0.7071:0.9862,b=g*m*l,l=l*h*m,g=g*(k+m),h=h*(k+
m),o=f.clone();o.x-=b;o.y-=l;f.x+=-g-b;f.y+=-h-l;var q=e==mxConstants.ARROW_DIAMOND?2:3.4;return function(){a.begin();a.moveTo(o.x,o.y);a.lineTo(o.x-g/2-h/q,o.y+g/q-h/2);a.lineTo(o.x-g,o.y-h);a.lineTo(o.x-g/2+h/q,o.y-h/2-g/q);a.close();n?a.fillAndStroke():a.stroke()}}mxMarker.addMarker("classic",a);mxMarker.addMarker("block",a);mxMarker.addMarker("open",function(a,b,e,f,g,h,k,l,m){var b=1.118*g*m,e=1.118*h*m,g=g*(k+m),h=h*(k+m),n=f.clone();n.x-=b;n.y-=e;f.x+=2*-b;f.y+=2*-e;return function(){a.begin();
a.moveTo(n.x-g-h/2,n.y-h+g/2);a.lineTo(n.x,n.y);a.lineTo(n.x+h/2-g,n.y-h-g/2);a.stroke()}});mxMarker.addMarker("oval",function(a,b,e,f,g,h,k,l,m,n){var o=k/2,q=f.clone();f.x-=g*o;f.y-=h*o;return function(){a.ellipse(q.x-o,q.y-o,k,k);n?a.fillAndStroke():a.stroke()}});mxMarker.addMarker("diamond",b);mxMarker.addMarker("diamondThin",b)})();function mxActor(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxActor,mxShape);
mxActor.prototype.paintVertexShape=function(a,b,c,d,e){a.translate(b,c);a.begin();this.redrawPath(a,b,c,d,e);a.fillAndStroke()};mxActor.prototype.redrawPath=function(a,b,c,d,e){b=d/3;a.moveTo(0,e);a.curveTo(0,3*e/5,0,2*e/5,d/2,2*e/5);a.curveTo(d/2-b,2*e/5,d/2-b,0,d/2,0);a.curveTo(d/2+b,0,d/2+b,2*e/5,d/2,2*e/5);a.curveTo(d,2*e/5,d,3*e/5,d,e);a.close()};function mxCloud(a,b,c,d){mxActor.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxCloud,mxActor);
mxCloud.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0.25*d,0.25*e);a.curveTo(0.05*d,0.25*e,0,0.5*e,0.16*d,0.55*e);a.curveTo(0,0.66*e,0.18*d,0.9*e,0.31*d,0.8*e);a.curveTo(0.4*d,e,0.7*d,e,0.8*d,0.8*e);a.curveTo(d,0.8*e,d,0.6*e,0.875*d,0.5*e);a.curveTo(d,0.3*e,0.8*d,0.1*e,0.625*d,0.2*e);a.curveTo(0.5*d,0.05*e,0.3*d,0.05*e,0.25*d,0.25*e);a.close()};function mxRectangleShape(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}
mxUtils.extend(mxRectangleShape,mxShape);mxRectangleShape.prototype.isHtmlAllowed=function(){return!this.isRounded&&!this.glass&&0==this.rotation};mxRectangleShape.prototype.paintBackground=function(a,b,c,d,e){if(this.isRounded){var f=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100,f=Math.min(d*f,e*f);a.roundrect(b,c,d,e,f,f)}else a.rect(b,c,d,e);a.fillAndStroke()};
mxRectangleShape.prototype.paintForeground=function(a,b,c,d,e){this.glass&&this.paintGlassEffect(a,b,c,d,e,this.getArcSize(d+this.strokewidth,e+this.strokewidth))};mxRectangleShape.prototype.redrawHtmlShape=function(){this.updateHtmlBounds(this.node);this.updateHtmlFilters(this.node);this.updateHtmlColors(this.node)};
mxRectangleShape.prototype.updateHtmlBounds=function(a){var b=9<=document.documentMode?0:Math.ceil(this.strokewidth*this.scale);a.style.borderWidth=Math.max(1,b)+"px";a.style.overflow="hidden";a.style.left=Math.round(this.bounds.x-b/2)+"px";a.style.top=Math.round(this.bounds.y-b/2)+"px";"CSS1Compat"==document.compatMode&&(b=-b);a.style.width=Math.round(Math.max(0,this.bounds.width+b))+"px";a.style.height=Math.round(Math.max(0,this.bounds.height+b))+"px"};
mxRectangleShape.prototype.updateHtmlColors=function(a){var b=this.stroke;null!=b&&b!=mxConstants.NONE?(a.style.borderColor=b,this.isDashed?a.style.borderStyle="dashed":0<this.strokewidth&&(a.style.borderStyle="solid"),a.style.borderWidth=Math.max(1,Math.ceil(this.strokewidth*this.scale))+"px"):a.style.borderWidth="0px";b=this.fill;null!=b&&b!=mxConstants.NONE?(a.style.backgroundColor=b,a.style.backgroundImage="none"):this.pointerEvents?a.style.backgroundColor="transparent":8==document.documentMode?
mxUtils.addTransparentBackgroundFilter(a):this.setTransparentBackgroundImage(a)};
mxRectangleShape.prototype.updateHtmlFilters=function(a){var b="";100>this.opacity&&(b+="alpha(opacity="+this.opacity+")");this.isShadow&&(b+="progid:DXImageTransform.Microsoft.dropShadow (OffX='"+Math.round(mxConstants.SHADOW_OFFSET_X*this.scale)+"', OffY='"+Math.round(mxConstants.SHADOW_OFFSET_Y*this.scale)+"', Color='"+mxConstants.SHADOWCOLOR+"')");if(this.gradient){var c=this.fill,d=this.gradient,e="0",f={east:0,south:1,west:2,north:3},g=null!=this.direction?f[this.direction]:0;null!=this.gradientDirection&&
(g=mxUtils.mod(g+f[this.gradientDirection]-1,4));1==g?(e="1",f=c,c=d,d=f):2==g?(f=c,c=d,d=f):3==g&&(e="1");b+="progid:DXImageTransform.Microsoft.gradient(startColorStr='"+c+"', endColorStr='"+d+"', gradientType='"+e+"')"}a.style.filter=b};function mxEllipse(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxEllipse,mxShape);mxEllipse.prototype.paintVertexShape=function(a,b,c,d,e){a.ellipse(b,c,d,e);a.fillAndStroke()};
function mxDoubleEllipse(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxDoubleEllipse,mxShape);mxDoubleEllipse.prototype.vmlScale=10;mxDoubleEllipse.prototype.paintBackground=function(a,b,c,d,e){a.ellipse(b,c,d,e);a.fillAndStroke()};mxDoubleEllipse.prototype.paintForeground=function(a,b,c,d,e){var f=Math.min(4,Math.min(d/5,e/5)),d=d-2*f,e=e-2*f;0<d&&0<e&&a.ellipse(b+f,c+f,d,e);a.stroke()};
function mxRhombus(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxRhombus,mxShape);mxRhombus.prototype.paintVertexShape=function(a,b,c,d,e){var f=d/2,g=e/2;a.begin();a.moveTo(b+f,c);a.lineTo(b+d,c+g);a.lineTo(b+f,c+e);a.lineTo(b,c+g);a.close();a.fillAndStroke()};function mxPolyline(a,b,c){mxShape.call(this);this.points=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxUtils.extend(mxPolyline,mxShape);
mxPolyline.prototype.getRotation=function(){return 0};mxPolyline.prototype.getShapeRotation=function(){return 0};mxPolyline.prototype.isPaintBoundsInverted=function(){return!1};mxPolyline.prototype.paintEdgeShape=function(a,b){this.paintLine(a,b,this.isRounded)};
mxPolyline.prototype.paintLine=function(a,b,c){var d=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,mxConstants.LINE_ARCSIZE)/2,e=b[0],f=b[b.length-1];a.begin();a.moveTo(e.x,e.y);for(var g=1;g<b.length-1;g++){var h=b[g],k=e.x-h.x,e=e.y-h.y;if(c&&g<b.length-1&&(0!=k||0!=e)){var l=Math.sqrt(k*k+e*e),k=k*Math.min(d,l/2)/l,e=e*Math.min(d,l/2)/l;a.lineTo(h.x+k,h.y+e);for(e=b[g+1];g<b.length-2&&0==Math.round(e.x-h.x)&&0==Math.round(e.y-h.y);)e=b[g+2],g++;k=e.x-h.x;e=e.y-h.y;l=Math.max(1,Math.sqrt(k*
k+e*e));k=k*Math.min(d,l/2)/l;e=e*Math.min(d,l/2)/l;k=h.x+k;e=h.y+e;a.quadTo(h.x,h.y,k,e);h=new mxPoint(k,e)}else a.lineTo(h.x,h.y);e=h}a.lineTo(f.x,f.y);a.stroke()};function mxArrow(a,b,c,d,e,f,g){mxShape.call(this);this.points=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1;this.arrowWidth=null!=e?e:mxConstants.ARROW_WIDTH;this.spacing=null!=f?f:mxConstants.ARROW_SPACING;this.endSize=null!=g?g:mxConstants.ARROW_SIZE}mxUtils.extend(mxArrow,mxShape);
mxArrow.prototype.paintEdgeShape=function(a,b){var c=mxConstants.ARROW_SPACING,d=mxConstants.ARROW_WIDTH,e=mxConstants.ARROW_SIZE,f=b[0],g=b[b.length-1],h=g.x-f.x,k=g.y-f.y,l=Math.sqrt(h*h+k*k),m=l-2*c-e,h=h/l,k=k/l,l=d*k/3,d=-d*h/3,e=f.x-l/2+c*h,f=f.y-d/2+c*k,n=e+l,o=f+d,q=n+m*h,m=o+m*k,r=q+l,u=m+d,w=r-3*l,v=u-3*d;a.begin();a.moveTo(e,f);a.lineTo(n,o);a.lineTo(q,m);a.lineTo(r,u);a.lineTo(g.x-c*h,g.y-c*k);a.lineTo(w,v);a.lineTo(w+l,v+d);a.close();a.fillAndStroke()};
function mxText(a,b,c,d,e,f,g,h,k,l,m,n,o,q,r,u,w,v,x,z){mxShape.call(this);this.value=a;this.bounds=b;this.color=null!=e?e:"black";this.align=null!=c?c:"";this.valign=null!=d?d:"";this.family=null!=f?f:mxConstants.DEFAULT_FONTFAMILY;this.size=null!=g?g:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=null!=h?h:mxConstants.DEFAULT_FONTSTYLE;this.spacing=parseInt(k||2);this.spacingTop=this.spacing+parseInt(l||0);this.spacingRight=this.spacing+parseInt(m||0);this.spacingBottom=this.spacing+parseInt(n||0);
this.spacingLeft=this.spacing+parseInt(o||0);this.horizontal=null!=q?q:!0;this.background=r;this.border=u;this.wrap=null!=w?w:!1;this.clipped=null!=v?v:!1;this.overflow=null!=x?x:"visible";this.labelPadding=null!=z?z:0;this.rotation=0;this.updateMargin()}mxUtils.extend(mxText,mxShape);mxText.prototype.baseSpacingTop=0;mxText.prototype.baseSpacingBottom=0;mxText.prototype.baseSpacingLeft=0;mxText.prototype.baseSpacingRight=0;mxText.prototype.replaceLinefeeds=!0;
mxText.prototype.verticalTextRotation=-90;mxText.prototype.ignoreClippedStringSize=!0;mxText.prototype.ignoreStringSize=!1;mxText.prototype.isParseVml=function(){return!1};mxText.prototype.isHtmlAllowed=function(){return 8!=document.documentMode};mxText.prototype.getSvgScreenOffset=function(){return 0};mxText.prototype.checkBounds=function(){return null!=this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)};
mxText.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);null!=this.style&&(this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle),this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family),this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size),this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color),this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align),this.valign=
mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign),this.spacingTop=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop),this.spacingRight=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight),this.spacingBottom=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom),this.spacingLeft=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft),this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,
this.horizontal),this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background),this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border),this.updateMargin())};
mxText.prototype.updateBoundingBox=function(){var a=this.node;8==document.documentMode&&null!=a.firstChild&&(a=a.firstChild,null!=a.firstChild&&(a=a.firstChild));this.boundingBox=this.bounds.clone();var b=this.getTextRotation();if(!this.ignoreStringSize&&null!=a&&"fill"!=this.overflow&&(!this.clipped||!this.ignoreClippedStringSize)){var c=null,d=null;if(null!=a.ownerSVGElement)if(null!=a.firstChild&&null!=a.firstChild.firstChild&&"foreignObject"==a.firstChild.firstChild.nodeName)a=a.firstChild.firstChild,
c=this.wrap?this.bounds.width:parseInt(a.getAttribute("width"))*this.scale,d=parseInt(a.getAttribute("height"))*this.scale;else{b=a.getBBox();if(0==b.width&&0==b.height)return;this.boundingBox=new mxRectangle(b.x,b.y,b.width,b.height);b=0}else d=null!=this.state?this.state.view.textDiv:null,null!=this.offsetWidth&&null!=this.offsetHeight?(c=this.wrap?this.bounds.width:this.offsetWidth*this.scale,d=this.offsetHeight*this.scale):null!=d?(this.updateFont(d),this.updateSize(d),mxUtils.isNode(this.value)?
d.innerHTML=this.value.outerHTML:(c=this.replaceLinefeeds?this.value.replace(/\n/g,"<br/>"):this.value,d.innerHTML=c),c=this.wrap?this.bounds.width:d.offsetWidth*this.scale,d=d.offsetHeight*this.scale):(c=this.wrap?this.bounds.width:a.offsetWidth*this.scale,d=a.offsetHeight*this.scale);null!=c&&null!=d&&(this.boundingBox=new mxRectangle(this.bounds.x+this.margin.x*c,this.bounds.y+this.margin.y*d,c,d))}else this.boundingBox.x+=this.margin.x*this.boundingBox.width,this.boundingBox.y+=this.margin.y*
this.boundingBox.height;null!=this.boundingBox&&(0!=b&&(b=mxUtils.getBoundingBox(this.boundingBox,b),this.boundingBox.x=b.x,this.boundingBox.y=b.y,mxClient.IS_QUIRKS||(this.boundingBox.width=b.width,this.boundingBox.height=b.height)),this.boundingBox.x=Math.floor(this.boundingBox.x),this.boundingBox.y=Math.floor(this.boundingBox.y),this.boundingBox.width=Math.ceil(this.boundingBox.width),this.boundingBox.height=Math.ceil(this.boundingBox.height))};mxText.prototype.getShapeRotation=function(){return 0};
mxText.prototype.getTextRotation=function(){return null!=this.state&&null!=this.state.shape?this.state.shape.getTextRotation():0};mxText.prototype.isPaintBoundsInverted=function(){return!this.horizontal&&null!=this.state&&this.state.view.graph.model.isVertex(this.state.cell)};
mxText.prototype.configureCanvas=function(a,b,c,d,e){mxShape.prototype.configureCanvas.apply(this,arguments);a.setFontColor(this.color);a.setFontBackgroundColor(this.background);a.setFontBorderColor(this.border);a.setFontFamily(this.family);a.setFontSize(this.size);a.setFontStyle(this.fontStyle)};
mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width="1px";this.node.style.height="1px";this.node.style.overflow="visible"};
mxText.prototype.paint=function(a){var b=this.scale,c=this.bounds.x/b,d=this.bounds.y/b,e=this.bounds.width/b,b=this.bounds.height/b;this.updateTransform(a,c,d,e,b);this.configureCanvas(a,c,d,e,b);var f=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML,g=f||a instanceof mxVmlCanvas2D?"html":"",h=this.value;!f&&"html"==g&&(h=mxUtils.htmlEntities(h,!1));h=!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&"html"==g?h.replace(/\n/g,"<br/>"):h;a.text(c,d,e,b,h,this.align,this.valign,
this.wrap,g,this.overflow,this.clipped,this.getTextRotation())};mxText.prototype.redrawHtmlShape=function(){var a=this.node.style;a.opacity=1>this.opacity?this.opacity:"";a.whiteSpace="normal";a.overflow="";a.width="";a.height="";this.updateValue();this.updateFont(this.node);this.updateSize(this.node);this.offsetHeight=this.offsetWidth=null;mxClient.IS_IE&&(null==document.documentMode||8>=document.documentMode)?this.updateHtmlFilter():this.updateHtmlTransform()};
mxText.prototype.updateHtmlTransform=function(){var a=this.getTextRotation(),b=this.node.style,c=this.margin.x,d=this.margin.y;0!=a?(mxUtils.setPrefixedStyle(b,"transformOrigin",100*-c+"% "+100*-d+"%"),mxUtils.setPrefixedStyle(b,"transform","translate("+100*c+"%,"+100*d+"%)scale("+this.scale+") rotate("+a+"deg)")):(mxUtils.setPrefixedStyle(b,"transformOrigin","0% 0%"),mxUtils.setPrefixedStyle(b,"transform","scale("+this.scale+")translate("+100*c+"%,"+100*d+"%)"));b.left=Math.round(this.bounds.x)+
"px";b.top=Math.round(this.bounds.y)+"px"};
mxText.prototype.updateHtmlFilter=function(){var a=this.node.style,b=this.margin.x,c=this.margin.y,d=this.scale;a.filter="";var e=0,f=0,g=null!=this.state?this.state.view.textDiv:null;if(null!=g){g.style.overflow="";g.style.height="";g.style.width="";this.updateFont(g);this.updateSize(g);if(mxUtils.isNode(this.value))g.innerHTML=this.value.outerHTML;else{var h=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(h=mxUtils.htmlEntities(h,!1));h=this.replaceLinefeeds?h.replace(/\n/g,"<br/>"):h;
g.innerHTML=h}e=g.offsetWidth+2;f=g.offsetHeight+2}else e=this.node.offsetWidth,f=this.node.offsetHeight+1;this.offsetWidth=e;this.offsetHeight=f;g=this.bounds.width/d;h=this.bounds.height/d;mxClient.IS_QUIRKS&&(this.clipped||"width"==this.overflow)&&0<h?(h=Math.min(h,f),a.height=Math.round(h)+"px"):h=f;"fill"!=this.overflow&&"width"!=this.overflow&&(mxClient.IS_QUIRKS&&this.clipped&&0<g?(g=Math.min(g,e),a.width=Math.round(g)+"px"):(g=e,this.wrap&&!this.clipped&&(a.width=Math.round(g)+"px")));var h=
h*d,g=g*d,e=this.getTextRotation()*(Math.PI/180),f=parseFloat(parseFloat(Math.cos(e)).toFixed(8)),k=parseFloat(parseFloat(Math.sin(-e)).toFixed(8)),e=e%(2*Math.PI);0>e&&(e+=2*Math.PI);e%=Math.PI;e>Math.PI/2&&(e=Math.PI-e);var l=Math.cos(e),m=Math.sin(-e),b=g*-(b+0.5),c=h*-(c+0.5),n=(h-h*l+g*m)/2+k*b-f*c;0!=e&&(a.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+f+", M12="+k+", M21="+-k+", M22="+f+", sizingMethod='auto expand')");a.zoom=d;a.left=Math.round(this.bounds.x+((g-g*l+h*m)/2-f*b-k*c)-
g/2)+"px";a.top=Math.round(this.bounds.y+n-h/2)+"px"};
mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value))this.node.innerHTML="",this.node.appendChild(this.value);else{var a=this.value;this.dialect!=mxConstants.DIALECT_STRICTHTML&&(a=mxUtils.htmlEntities(a,!1));var a=this.replaceLinefeeds?a.replace(/\n/g,"<br/>"):a,b=null!=this.background&&this.background!=mxConstants.NONE?this.background:null,c=null!=this.border&&this.border!=mxConstants.NONE?this.border:null;if(null!=b||null!=c)if("fill"==this.overflow||"width"==this.overflow)null!=
b&&(this.node.style.backgroundColor=b),null!=c&&(this.node.style.border="1px solid "+c);else{var d="";null!=b&&(d+="background-color:"+b+";");null!=c&&(d+="border:1px solid "+c+";");a='<div style="zoom:1;'+d+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+this.node.style.lineHeight+'">'+a+"</div>";this.node.style.lineHeight=""}this.node.innerHTML=a}};
mxText.prototype.updateFont=function(a){a=a.style;a.lineHeight=Math.round(this.size*mxConstants.LINE_HEIGHT)+"px";a.fontSize=Math.round(this.size)+"px";a.fontFamily=this.family;a.verticalAlign="top";a.color=this.color;a.fontWeight=(this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD?"bold":"";a.fontStyle=(this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC?"italic":"";a.textDecoration=(this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE?"underline":"";a.textAlign=
this.align==mxConstants.ALIGN_CENTER?"center":this.align==mxConstants.ALIGN_RIGHT?"right":"left"};
mxText.prototype.updateSize=function(a){var b=Math.round(this.bounds.width/this.scale),c=Math.round(this.bounds.height/this.scale),d=a.style;this.clipped?(d.overflow="hidden",0<c&&(d.maxHeight=c+"px"),0<b&&(d.width=b+"px")):"fill"==this.overflow?(d.width=b+"px",d.height=c+"px"):"width"==this.overflow&&(d.width=b+"px",0<c&&(d.maxHeight=c+"px"));this.wrap&&0<b?(this.clipped||(d.width=b+"px",d.width=Math.max(b,a.scrollWidth+(mxClient.IS_QUIRKS?2:0))+"px"),d.whiteSpace="normal"):d.whiteSpace="nowrap"};
mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)};
mxText.prototype.getSpacing=function(){var a=0,b=0,a=this.align==mxConstants.ALIGN_CENTER?(this.spacingLeft-this.spacingRight)/2:this.align==mxConstants.ALIGN_RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,b=this.valign==mxConstants.ALIGN_MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign==mxConstants.ALIGN_BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop;return new mxPoint(a,b)};
function mxTriangle(){mxActor.call(this)}mxUtils.extend(mxTriangle,mxActor);mxTriangle.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0,0);a.lineTo(d,0.5*e);a.lineTo(0,e);a.close()};function mxHexagon(){mxActor.call(this)}mxUtils.extend(mxHexagon,mxActor);mxHexagon.prototype.redrawPath=function(a,b,c,d,e){a.moveTo(0.25*d,0);a.lineTo(0.75*d,0);a.lineTo(d,0.5*e);a.lineTo(0.75*d,e);a.lineTo(0.25*d,e);a.lineTo(0,0.5*e);a.close()};
function mxLine(a,b,c){mxShape.call(this);this.bounds=a;this.stroke=b;this.strokewidth=null!=c?c:1}mxUtils.extend(mxLine,mxShape);mxLine.prototype.paintVertexShape=function(a,b,c,d,e){c+=e/2;a.begin();a.moveTo(b,c);a.lineTo(b+d,c);a.stroke()};function mxImageShape(a,b,c,d,e){mxShape.call(this);this.bounds=a;this.image=b;this.fill=c;this.stroke=d;this.strokewidth=null!=e?e:1;this.shadow=!1}mxUtils.extend(mxImageShape,mxRectangleShape);mxImageShape.prototype.preserveImageAspect=!0;
mxImageShape.prototype.getSvgScreenOffset=function(){return!mxClient.IS_IE?0.5:0};mxImageShape.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);this.gradient=this.stroke=this.fill=null;null!=this.style&&(this.preserveImageAspect=1==mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_ASPECT,1),this.flipH=this.flipH||1==mxUtils.getValue(this.style,"imageFlipH",0),this.flipV=this.flipV||1==mxUtils.getValue(this.style,"imageFlipV",0))};mxImageShape.prototype.isHtmlAllowed=function(){return!this.preserveImageAspect};
mxImageShape.prototype.createHtml=function(){var a=document.createElement("div");a.style.position="absolute";return a};
mxImageShape.prototype.paintVertexShape=function(a,b,c,d,e){if(null!=this.image){var f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,null),g=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,null);if(null!=f||null!=g)a.setFillColor(f),a.setStrokeColor(g),a.rect(b,c,d,e),a.fillAndStroke();a.image(b,c,d,e,this.image,this.preserveImageAspect,!1,!1)}else mxRectangleShape.prototype.paintBackground.apply(this,arguments)};
mxImageShape.prototype.redrawHtmlShape=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width=Math.max(0,Math.round(this.bounds.width))+"px";this.node.style.height=Math.max(0,Math.round(this.bounds.height))+"px";this.node.innerHTML="";if(null!=this.image){var a=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BACKGROUND,""),b=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_BORDER,"");this.node.style.backgroundColor=
a;this.node.style.borderColor=b;a=document.createElement(mxClient.IS_IE6||(null==document.documentMode||8>=document.documentMode)&&0!=this.rotation?mxClient.VML_PREFIX+":image":"img");a.style.position="absolute";a.src=this.image;b=100>this.opacity?"alpha(opacity="+this.opacity+")":"";this.node.style.filter=b;this.flipH&&this.flipV?b+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2)":this.flipH?b+="progid:DXImageTransform.Microsoft.BasicImage(mirror=1)":this.flipV&&(b+="progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)");
a.style.filter!=b&&(a.style.filter=b);"image"==a.nodeName?a.style.rotation=this.rotation:0!=this.rotation?mxUtils.setPrefixedStyle(a.style,"transform","rotate("+this.rotation+"deg)"):mxUtils.setPrefixedStyle(a.style,"transform","");a.style.width=this.node.style.width;a.style.height=this.node.style.height;this.node.style.backgroundImage="";this.node.appendChild(a)}else this.setTransparentBackgroundImage(this.node)};function mxLabel(a,b,c,d){mxRectangleShape.call(this,a,b,c,d)}
mxUtils.extend(mxLabel,mxRectangleShape);mxLabel.prototype.imageSize=mxConstants.DEFAULT_IMAGESIZE;mxLabel.prototype.spacing=2;mxLabel.prototype.indicatorSize=10;mxLabel.prototype.indicatorSpacing=2;
mxLabel.prototype.init=function(a){mxShape.prototype.init.apply(this,arguments);null!=this.indicatorColor&&null!=this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.bounds=this.bounds,this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.init(this.node))};
mxLabel.prototype.redraw=function(){null!=this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection);mxShape.prototype.redraw.apply(this,arguments)};mxLabel.prototype.isHtmlAllowed=function(){return mxRectangleShape.prototype.isHtmlAllowed.apply(this,arguments)&&null==this.indicatorColor&&null==this.indicatorShape};
mxLabel.prototype.paintForeground=function(a,b,c,d,e){this.paintImage(a,b,c,d,e);this.paintIndicator(a,b,c,d,e);mxRectangleShape.prototype.paintForeground.apply(this,arguments)};mxLabel.prototype.paintImage=function(a,b,c,d,e){null!=this.image&&(b=this.getImageBounds(b,c,d,e),a.image(b.x,b.y,b.width,b.height,this.image,!1,!1,!1))};
mxLabel.prototype.getImageBounds=function(a,b,c,d){var e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),g=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_WIDTH,mxConstants.DEFAULT_IMAGESIZE),h=mxUtils.getNumber(this.style,mxConstants.STYLE_IMAGE_HEIGHT,mxConstants.DEFAULT_IMAGESIZE),k=mxUtils.getNumber(this.style,mxConstants.STYLE_SPACING,this.spacing)+5,a=e==mxConstants.ALIGN_CENTER?
a+(c-g)/2:e==mxConstants.ALIGN_RIGHT?a+(c-g-k):a+k,b=f==mxConstants.ALIGN_TOP?b+k:f==mxConstants.ALIGN_BOTTOM?b+(d-h-k):b+(d-h)/2;return new mxRectangle(a,b,g,h)};mxLabel.prototype.paintIndicator=function(a,b,c,d,e){null!=this.indicator?(this.indicator.bounds=this.getIndicatorBounds(b,c,d,e),this.indicator.paint(a)):null!=this.indicatorImage&&(b=this.getIndicatorBounds(b,c,d,e),a.image(b.x,b.y,b.width,b.height,this.indicatorImage,!1,!1,!1))};
mxLabel.prototype.getIndicatorBounds=function(a,b,c,d){var e=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_ALIGN,mxConstants.ALIGN_LEFT),f=mxUtils.getValue(this.style,mxConstants.STYLE_IMAGE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),g=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_WIDTH,this.indicatorSize),h=mxUtils.getNumber(this.style,mxConstants.STYLE_INDICATOR_HEIGHT,this.indicatorSize),k=this.spacing+5,a=e==mxConstants.ALIGN_RIGHT?a+(c-g-k):e==mxConstants.ALIGN_CENTER?a+(c-g)/
2:a+k,b=f==mxConstants.ALIGN_BOTTOM?b+(d-h-k):f==mxConstants.ALIGN_TOP?b+k:b+(d-h)/2;return new mxRectangle(a,b,g,h)};
mxLabel.prototype.redrawHtmlShape=function(){for(mxRectangleShape.prototype.redrawHtmlShape.apply(this,arguments);this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(null!=this.image){var a=document.createElement("img");a.style.position="relative";a.setAttribute("border","0");var b=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);b.x-=this.bounds.x;b.y-=this.bounds.y;a.style.left=Math.round(b.x)+"px";a.style.top=Math.round(b.y)+"px";a.style.width=
Math.round(b.width)+"px";a.style.height=Math.round(b.height)+"px";a.src=this.image;this.node.appendChild(a)}};function mxCylinder(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxCylinder,mxShape);mxCylinder.prototype.maxHeight=40;mxCylinder.prototype.svgStrokeTolerance=0;
mxCylinder.prototype.paintVertexShape=function(a,b,c,d,e){a.translate(b,c);a.begin();this.redrawPath(a,b,c,d,e,!1);a.fillAndStroke();a.setShadow(!1);a.begin();this.redrawPath(a,b,c,d,e,!0);a.stroke()};
mxCylinder.prototype.redrawPath=function(a,b,c,d,e,f){b=Math.min(this.maxHeight,Math.round(e/5));if(f&&null!=this.fill||!f&&null==this.fill)a.moveTo(0,b),a.curveTo(0,2*b,d,2*b,d,b),f||(a.stroke(),a.begin());f||(a.moveTo(0,b),a.curveTo(0,-b/3,d,-b/3,d,b),a.lineTo(d,e-b),a.curveTo(d,e+b/3,0,e+b/3,0,e-b),a.close())};function mxConnector(a,b,c){mxPolyline.call(this,a,b,c)}mxUtils.extend(mxConnector,mxPolyline);
mxConnector.prototype.paintEdgeShape=function(a,b){var c=this.createMarker(a,b,!0),d=this.createMarker(a,b,!1);null==this.style||1!=this.style[mxConstants.STYLE_CURVED]?this.paintLine(a,b,this.isRounded):this.paintCurvedLine(a,b);a.setFillColor(this.stroke);a.setShadow(!1);a.setDashed(!1);null!=c&&c();null!=d&&d()};
mxConnector.prototype.paintCurvedLine=function(a,b){a.begin();var c=b[0],d=b.length;a.moveTo(c.x,c.y);for(c=1;c<d-2;c++){var e=b[c],f=b[c+1];a.quadTo(e.x,e.y,(e.x+f.x)/2,(e.y+f.y)/2)}e=b[d-2];f=b[d-1];a.quadTo(e.x,e.y,f.x,f.y);a.stroke()};
mxConnector.prototype.createMarker=function(a,b,c){for(var d=b.length,e=c?b[1]:b[d-2],f=c?b[0]:b[d-1],g=1;g<d-1&&0==Math.round(e.x-f.x)&&0==Math.round(e.y-f.y);)e=c?b[1+g]:b[d-2-g],g++;b=f.x-e.x;d=f.y-e.y;g=Math.max(1,Math.sqrt(b*b+d*d));e=b/g;b=d/g;d=mxUtils.getNumber(this.style,c?mxConstants.STYLE_STARTSIZE:mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE);g=mxUtils.getValue(this.style,c?mxConstants.STYLE_STARTARROW:mxConstants.STYLE_ENDARROW);return mxMarker.createMarker(a,this,g,f,e,b,
d,c,this.strokewidth,0!=this.style[c?mxConstants.STYLE_STARTFILL:mxConstants.STYLE_ENDFILL])};
mxConnector.prototype.augmentBoundingBox=function(a){mxShape.prototype.augmentBoundingBox.apply(this,arguments);var b=0;mxUtils.getValue(this.style,mxConstants.STYLE_STARTARROW,mxConstants.NONE)!=mxConstants.NONE&&(b=mxUtils.getNumber(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_MARKERSIZE)+1);mxUtils.getValue(this.style,mxConstants.STYLE_ENDARROW,mxConstants.NONE)!=mxConstants.NONE&&(b=Math.max(b,mxUtils.getNumber(this.style,mxConstants.STYLE_ENDSIZE,mxConstants.DEFAULT_MARKERSIZE))+
1);a.grow(Math.ceil(b*this.scale))};function mxSwimlane(a,b,c,d){mxShape.call(this);this.bounds=a;this.fill=b;this.stroke=c;this.strokewidth=null!=d?d:1}mxUtils.extend(mxSwimlane,mxShape);mxSwimlane.prototype.imageSize=16;mxSwimlane.prototype.getGradientBounds=function(a,b,c,d,e){a=Math.min(e,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE));return new mxRectangle(b,c,d,a)};
mxSwimlane.prototype.getRotation=function(){var a=mxShape.prototype.getRotation.apply(this,arguments);1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)&&(a+=mxText.prototype.verticalTextRotation);return a};mxSwimlane.prototype.getTextRotation=function(){return this.getRotation()};mxSwimlane.prototype.isPaintBoundsInverted=function(){return mxShape.prototype.isPaintBoundsInverted.apply(this,arguments)||1!=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,1)};
mxSwimlane.prototype.getArcSize=function(a,b,c){a=mxUtils.getValue(this.style,mxConstants.STYLE_ARCSIZE,100*mxConstants.RECTANGLE_ROUNDING_FACTOR)/100;return 3*c*a};
mxSwimlane.prototype.paintVertexShape=function(a,b,c,d,e){var f=Math.min(e,mxUtils.getValue(this.style,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),g=mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_FILLCOLOR,mxConstants.NONE),h=1==mxUtils.getValue(this.style,mxConstants.STYLE_SWIMLANE_LINE,1),k=0;a.translate(b,c);this.isRounded?(k=this.getArcSize(d,e,f),this.paintRoundedSwimlane(a,b,c,d,e,f,k,g,h)):this.paintSwimlane(a,b,c,d,e,f,g,h);g=mxUtils.getValue(this.style,mxConstants.STYLE_SEPARATORCOLOR,
mxConstants.NONE);this.paintSeparator(a,d,f,e,g);null!=this.image&&(e=this.getImageBounds(b,c,d,e),a.image(e.x-b,e.y-c,e.width,e.height,this.image,!1,!1,!1));this.glass&&(a.setShadow(!1),this.paintGlassEffect(a,0,0,d,f,k))};
mxSwimlane.prototype.paintSwimlane=function(a,b,c,d,e,f,g,h){g!=mxConstants.NONE&&(a.save(),a.setFillColor(g),a.rect(0,0,d,e),a.fillAndStroke(),a.restore(),a.setShadow(!1));a.begin();a.moveTo(0,f);a.lineTo(0,0);a.lineTo(d,0);a.lineTo(d,f);h&&a.close();a.fillAndStroke();f<e&&g==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(0,f),a.lineTo(0,e),a.lineTo(d,e),a.lineTo(d,f),a.stroke())};
mxSwimlane.prototype.paintRoundedSwimlane=function(a,b,c,d,e,f,g,h,k){h!=mxConstants.NONE&&(a.save(),a.setFillColor(h),a.roundrect(0,0,d,e,g,g),a.fillAndStroke(),a.restore(),a.setShadow(!1));a.begin();a.moveTo(d,f);a.lineTo(d,g);a.quadTo(d,0,d-Math.min(d/2,g),0);a.lineTo(Math.min(d/2,g),0);a.quadTo(0,0,0,g);a.lineTo(0,f);k&&a.close();a.fillAndStroke();f<e&&h==mxConstants.NONE&&(a.pointerEvents=!1,a.begin(),a.moveTo(0,f),a.lineTo(0,e-g),a.quadTo(0,e,Math.min(d/2,g),e),a.lineTo(d-Math.min(d/2,g),e),
a.quadTo(d,e,d,e-g),a.lineTo(d,f),a.stroke())};mxSwimlane.prototype.paintSeparator=function(a,b,c,d,e){e!=mxConstants.NONE&&(a.setStrokeColor(e),a.setDashed(!0),a.begin(),a.moveTo(b,c),a.lineTo(b,d),a.stroke(),a.setDashed(!1))};mxSwimlane.prototype.getImageBounds=function(a,b,c){return new mxRectangle(a+c-this.imageSize,b,this.imageSize,this.imageSize)};function mxGraphLayout(a){this.graph=a}mxGraphLayout.prototype.graph=null;mxGraphLayout.prototype.useBoundingBox=!0;
mxGraphLayout.prototype.parent=null;mxGraphLayout.prototype.moveCell=function(){};mxGraphLayout.prototype.execute=function(){};mxGraphLayout.prototype.getGraph=function(){return this.graph};mxGraphLayout.prototype.getConstraint=function(a,b,c){c=this.graph.view.getState(b);b=null!=c?c.style:this.graph.getCellStyle(b);return null!=b?b[a]:null};
mxGraphLayout.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){var b=null!=b?b:!0,e=e||[],f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d))if(d=this.graph.model.getEdgeCount(a),0<d)for(f=0;f<d;f++){var g=this.graph.model.getEdgeAt(a,f),h=this.graph.model.getTerminal(g,!0)==a;if(!b||h)h=this.graph.view.getVisibleTerminal(g,!h),this.traverse(h,b,c,g,e)}}};mxGraphLayout.prototype.isVertexMovable=function(a){return this.graph.isCellMovable(a)};
mxGraphLayout.prototype.isVertexIgnored=function(a){return!this.graph.getModel().isVertex(a)||!this.graph.isCellVisible(a)};mxGraphLayout.prototype.isEdgeIgnored=function(a){var b=this.graph.getModel();return!b.isEdge(a)||!this.graph.isCellVisible(a)||null==b.getTerminal(a,!0)||null==b.getTerminal(a,!1)};mxGraphLayout.prototype.setEdgeStyleEnabled=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_NOEDGESTYLE,b?"0":"1",[a])};
mxGraphLayout.prototype.setOrthogonalEdge=function(a,b){this.graph.setCellStyles(mxConstants.STYLE_ORTHOGONAL,b?"1":"0",[a])};mxGraphLayout.prototype.getParentOffset=function(a){var b=new mxPoint;if(null!=a&&a!=this.parent){var c=this.graph.getModel();if(c.isAncestor(this.parent,a))for(var d=c.getGeometry(a);a!=this.parent;)b.x+=d.x,b.y+=d.y,a=c.getParent(a),d=c.getGeometry(a)}return b};
mxGraphLayout.prototype.setEdgePoints=function(a,b){if(null!=a){var c=this.graph.model,d=c.getGeometry(a);null==d?(d=new mxGeometry,d.setRelative(!0)):d=d.clone();if(null!=this.parent&&null!=b)for(var e=c.getParent(a),e=this.getParentOffset(e),f=0;f<b.length;f++)b[f].x-=e.x,b[f].y-=e.y;d.points=b;c.setGeometry(a,d)}};
mxGraphLayout.prototype.setVertexLocation=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a),f=null;if(null!=e){f=new mxRectangle(b,c,e.width,e.height);if(this.useBoundingBox){var g=this.graph.getView().getState(a);if(null!=g&&null!=g.text&&null!=g.text.boundingBox){var h=this.graph.getView().scale,k=g.text.boundingBox;g.text.boundingBox.x<g.x&&(b+=(g.x-k.x)/h,f.width=k.width);g.text.boundingBox.y<g.y&&(c+=(g.y-k.y)/h,f.height=k.height)}}null!=this.parent&&(g=d.getParent(a),null!=g&&g!=
this.parent&&(g=this.getParentOffset(g),b-=g.x,c-=g.y));if(e.x!=b||e.y!=c)e=e.clone(),e.x=b,e.y=c,d.setGeometry(a,e)}return f};
mxGraphLayout.prototype.getVertexBounds=function(a){var b=this.graph.getModel().getGeometry(a);if(this.useBoundingBox){var c=this.graph.getView().getState(a);if(null!=c&&null!=c.text&&null!=c.text.boundingBox)var d=this.graph.getView().scale,e=c.text.boundingBox,f=Math.max(c.x-e.x,0)/d,g=Math.max(c.y-e.y,0)/d,h=Math.max(e.x+e.width-(c.x+c.width),0)/d,c=Math.max(e.y+e.height-(c.y+c.height),0)/d,b=new mxRectangle(b.x-f,b.y-g,b.width+f+h,b.height+g+c)}null!=this.parent&&(a=this.graph.getModel().getParent(a),
b=b.clone(),null!=a&&a!=this.parent&&(a=this.getParentOffset(a),b.x+=a.x,b.y+=a.y));return new mxRectangle(b.x,b.y,b.width,b.height)};
mxGraphLayout.prototype.arrangeGroups=function(a,b){this.graph.getModel().beginUpdate();try{for(var c=a.length-1;0<=c;c--){var d=a[c],e=this.graph.getChildVertices(d),f=this.graph.getBoundingBoxFromGeometry(e),g=this.graph.getCellGeometry(d),h=0,k=0;if(this.graph.isSwimlane(d))var l=this.graph.getStartSize(d),h=l.width,k=l.height;null!=f&&null!=g&&(g=g.clone(),g.x=g.x+f.x-b-h,g.y=g.y+f.y-b-k,g.width=f.width+2*b+h,g.height=f.height+2*b+k,this.graph.getModel().setGeometry(d,g),this.graph.moveCells(e,
b+h-f.x,b+k-f.y))}}finally{this.graph.getModel().endUpdate()}};function mxStackLayout(a,b,c,d,e,f){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=null!=c?c:0;this.x0=null!=d?d:0;this.y0=null!=e?e:0;this.border=null!=f?f:0}mxStackLayout.prototype=new mxGraphLayout;mxStackLayout.prototype.constructor=mxStackLayout;mxStackLayout.prototype.horizontal=null;mxStackLayout.prototype.spacing=null;mxStackLayout.prototype.x0=null;mxStackLayout.prototype.y0=null;
mxStackLayout.prototype.border=0;mxStackLayout.prototype.keepFirstLocation=!1;mxStackLayout.prototype.fill=!1;mxStackLayout.prototype.resizeParent=!1;mxStackLayout.prototype.resizeLast=!1;mxStackLayout.prototype.wrap=null;mxStackLayout.prototype.isHorizontal=function(){return this.horizontal};
mxStackLayout.prototype.moveCell=function(a,b,c){var d=this.graph.getModel(),e=d.getParent(a),f=this.isHorizontal();if(null!=a&&null!=e){var g=0,h=0,k=d.getChildCount(e),b=f?b:c,g=this.graph.getView().getState(e);null!=g&&(b-=f?g.x:g.y);for(g=0;g<k;g++)if(c=d.getChildAt(e,g),c!=a&&(c=d.getGeometry(c),null!=c)){c=f?c.x+c.width/2:c.y+c.height/2;if(h<b&&c>b)break;h=c}f=e.getIndex(a);f=Math.max(0,g-(g>f?1:0));d.add(e,a,f)}};
mxStackLayout.prototype.getParentSize=function(a){var b=this.graph.getModel(),c=b.getGeometry(a);if(null!=this.graph.container&&(null==c&&b.isLayer(a)||a==this.graph.getView().currentRoot))c=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1);return c};
mxStackLayout.prototype.execute=function(a){if(null!=a){var b=this.isHorizontal(),c=this.graph.getModel(),d=this.getParentSize(a),e=null;null!=d&&(e=b?d.height:d.width);var e=e-(2*this.spacing+2*this.border),f=this.x0+this.border,g=this.y0+this.border;if(this.graph.isSwimlane(a)){var h=this.graph.getCellStyle(a),k=mxUtils.getNumber(h,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE),h=1==mxUtils.getValue(h,mxConstants.STYLE_HORIZONTAL,!0);null!=d&&(k=h?Math.min(k,d.height):Math.min(k,d.width));
b==h&&(e-=k);h?g+=k:f+=k}c.beginUpdate();try{for(var k=0,h=null,l=c.getChildCount(a),m=0;m<l;m++){var n=c.getChildAt(a,m);if(!this.isVertexIgnored(n)&&this.isVertexMovable(n)){var o=c.getGeometry(n);if(null!=o){o=o.clone();if(null!=this.wrap&&null!=h&&(b&&h.x+h.width+o.width+2*this.spacing>this.wrap||!b&&h.y+h.height+o.height+2*this.spacing>this.wrap))h=null,b?g+=k+this.spacing:f+=k+this.spacing,k=0;k=Math.max(k,b?o.height:o.width);null!=h?b?o.x=h.x+h.width+this.spacing:o.y=h.y+h.height+this.spacing:
this.keepFirstLocation||(b?o.x=f:o.y=g);b?o.y=g:o.x=f;this.fill&&null!=e&&(b?o.height=e:o.width=e);c.setGeometry(n,o);h=o}}}this.resizeParent&&null!=d&&null!=h&&!this.graph.isCellCollapsed(a)?(d=d.clone(),b?d.width=h.x+h.width+this.spacing:d.height=h.y+h.height+this.spacing,c.setGeometry(a,d)):this.resizeLast&&null!=d&&null!=h&&(b?h.width=d.width-h.x-this.spacing:h.height=d.height-h.y-this.spacing)}finally{c.endUpdate()}}};
function mxPartitionLayout(a,b,c,d){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.spacing=c||0;this.border=d||0}mxPartitionLayout.prototype=new mxGraphLayout;mxPartitionLayout.prototype.constructor=mxPartitionLayout;mxPartitionLayout.prototype.horizontal=null;mxPartitionLayout.prototype.spacing=null;mxPartitionLayout.prototype.border=null;mxPartitionLayout.prototype.resizeVertices=!0;mxPartitionLayout.prototype.isHorizontal=function(){return this.horizontal};
mxPartitionLayout.prototype.moveCell=function(a,b,c){var c=this.graph.getModel(),d=c.getParent(a);if(null!=a&&null!=d){for(var e=0,f=0,g=c.getChildCount(d),e=0;e<g;e++){var h=c.getChildAt(d,e),h=this.getVertexBounds(h);if(null!=h){h=h.x+h.width/2;if(f<b&&h>b)break;f=h}}b=d.getIndex(a);b=Math.max(0,e-(e>b?1:0));c.add(d,a,b)}};
mxPartitionLayout.prototype.execute=function(a){var b=this.isHorizontal(),c=this.graph.getModel(),d=c.getGeometry(a);if(null!=this.graph.container&&(null==d&&c.isLayer(a)||a==this.graph.getView().currentRoot))d=new mxRectangle(0,0,this.graph.container.offsetWidth-1,this.graph.container.offsetHeight-1);if(null!=d){for(var e=[],f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g);!this.isVertexIgnored(h)&&this.isVertexMovable(h)&&e.push(h)}f=e.length;if(0<f){var k=this.border,l=this.border,m=b?
d.height:d.width,m=m-2*this.border,a=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle,m=m-(b?a.height:a.width),k=k+a.width,l=l+a.height,a=this.border+(f-1)*this.spacing,d=b?(d.width-k-a)/f:(d.height-l-a)/f;if(0<d){c.beginUpdate();try{for(g=0;g<f;g++){var h=e[g],n=c.getGeometry(h);null!=n&&(n=n.clone(),n.x=k,n.y=l,b?(this.resizeVertices&&(n.width=d,n.height=m),k+=d+this.spacing):(this.resizeVertices&&(n.height=d,n.width=m),l+=d+this.spacing),c.setGeometry(h,n))}}finally{c.endUpdate()}}}}};
function mxCompactTreeLayout(a,b,c){mxGraphLayout.call(this,a);this.horizontal=null!=b?b:!0;this.invert=null!=c?c:!1}mxCompactTreeLayout.prototype=new mxGraphLayout;mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=!0;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=!1;
mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=!0;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=!0;mxCompactTreeLayout.prototype.sortEdges=!1;mxCompactTreeLayout.prototype.alignRanks=!1;mxCompactTreeLayout.prototype.maxRankHeight=null;
mxCompactTreeLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};
mxCompactTreeLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.getModel();if(null==b)if(0<this.graph.getEdges(a,c.getParent(a),this.invert,!this.invert,!1).length)b=a;else{var d=this.graph.findTreeRoots(a,!0,this.invert);if(0<d.length)for(var e=0;e<d.length;e++)if(!this.isVertexIgnored(d[e])&&0<this.graph.getEdges(d[e],null,this.invert,!this.invert,!1).length){b=d[e];break}}if(null!=b){this.parentsChanged=this.resizeParent?{}:null;c.beginUpdate();try{var f=this.dfs(b,a);this.alignRanks&&
(this.maxRankHeight=[],this.findRankHeights(f,0),this.setCellHeights(f,0));if(null!=f){this.layout(f);var g=this.graph.gridSize,d=g;if(!this.moveTree){var h=this.getVertexBounds(b);null!=h&&(g=h.x,d=h.y)}h=null;h=this.isHorizontal()?this.horizontalLayout(f,g,d):this.verticalLayout(f,null,g,d);if(null!=h){var k=e=0;0>h.x&&(e=Math.abs(g-h.x));0>h.y&&(k=Math.abs(d-h.y));(0!=e||0!=k)&&this.moveNode(f,e,k);this.resizeParent&&this.adjustParents();this.edgeRouting&&this.localEdgeProcessing(f)}}}finally{c.endUpdate()}}};
mxCompactTreeLayout.prototype.moveNode=function(a,b,c){a.x+=b;a.y+=c;this.apply(a);for(a=a.child;null!=a;)this.moveNode(a,b,c),a=a.next};
mxCompactTreeLayout.prototype.sortOutgoingEdges=function(a,b){var c=new mxDictionary;b.sort(function(b,e){var f=b.getTerminal(b.getTerminal(!1)==a),g=c.get(f);null==g&&(g=mxCellPath.create(f).split(mxCellPath.PATH_SEPARATOR),c.put(f,g));var f=e.getTerminal(e.getTerminal(!1)==a),h=c.get(f);null==h&&(h=mxCellPath.create(f).split(mxCellPath.PATH_SEPARATOR),c.put(f,h));return mxCellPath.compare(g,h)})};
mxCompactTreeLayout.prototype.findRankHeights=function(a,b){if(null==this.maxRankHeight[b]||this.maxRankHeight[b]<a.height)this.maxRankHeight[b]=a.height;for(var c=a.child;null!=c;)this.findRankHeights(c,b+1),c=c.next};mxCompactTreeLayout.prototype.setCellHeights=function(a,b){null!=this.maxRankHeight[b]&&this.maxRankHeight[b]>a.height&&(a.height=this.maxRankHeight[b]);for(var c=a.child;null!=c;)this.setCellHeights(c,b+1),c=c.next};
mxCompactTreeLayout.prototype.dfs=function(a,b,c){var c=null!=c?c:[],d=mxCellPath.create(a),e=null;if(null!=a&&null==c[d]&&!this.isVertexIgnored(a)){c[d]=a;var e=this.createNode(a),d=this.graph.getModel(),f=null,g=this.graph.getEdges(a,b,this.invert,!this.invert,!1,!0),h=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(a,g);for(a=0;a<g.length;a++){var k=g[a];if(!this.isEdgeIgnored(k)){this.resetEdges&&this.setEdgePoints(k,null);this.edgeRouting&&(this.setEdgeStyleEnabled(k,!1),this.setEdgePoints(k,
null));var l=h.getState(k),k=null!=l?l.getVisibleTerminal(this.invert):h.getVisibleTerminal(k,this.invert),l=this.dfs(k,b,c);null!=l&&null!=d.getGeometry(k)&&(null==f?e.child=l:f.next=l,f=l)}}}return e};mxCompactTreeLayout.prototype.layout=function(a){if(null!=a){for(var b=a.child;null!=b;)this.layout(b),b=b.next;null!=a.child?this.attachParent(a,this.join(a)):this.layoutLeaf(a)}};
mxCompactTreeLayout.prototype.horizontalLayout=function(a,b,c,d){a.x+=b+a.offsetX;a.y+=c+a.offsetY;d=this.apply(a,d);b=a.child;if(null!=b)for(var d=this.horizontalLayout(b,a.x,a.y,d),c=a.y+b.offsetY,e=b.next;null!=e;)d=this.horizontalLayout(e,a.x+b.offsetX,c,d),c+=e.offsetY,e=e.next;return d};
mxCompactTreeLayout.prototype.verticalLayout=function(a,b,c,d,e){a.x+=c+a.offsetY;a.y+=d+a.offsetX;e=this.apply(a,e);b=a.child;if(null!=b){e=this.verticalLayout(b,a,a.x,a.y,e);c=a.x+b.offsetY;for(d=b.next;null!=d;)e=this.verticalLayout(d,a,c,a.y+b.offsetX,e),c+=d.offsetY,d=d.next}return e};
mxCompactTreeLayout.prototype.attachParent=function(a,b){var c=this.nodeDistance+this.levelDistance,d=(b-a.width)/2-this.nodeDistance,e=d+a.width+2*this.nodeDistance-b;a.child.offsetX=c+a.height;a.child.offsetY=e;a.contour.upperHead=this.createLine(a.height,0,this.createLine(c,e,a.contour.upperHead));a.contour.lowerHead=this.createLine(a.height,0,this.createLine(c,d,a.contour.lowerHead))};
mxCompactTreeLayout.prototype.layoutLeaf=function(a){var b=2*this.nodeDistance;a.contour.upperTail=this.createLine(a.height+b,0);a.contour.upperHead=a.contour.upperTail;a.contour.lowerTail=this.createLine(0,-a.width-b);a.contour.lowerHead=this.createLine(a.height+b,0,a.contour.lowerTail)};
mxCompactTreeLayout.prototype.join=function(a){var b=2*this.nodeDistance,c=a.child;a.contour=c.contour;for(var d=c.width+b,e=d,c=c.next;null!=c;){var f=this.merge(a.contour,c.contour);c.offsetY=f+d;c.offsetX=0;d=c.width+b;e+=f+d;c=c.next}return e};
mxCompactTreeLayout.prototype.merge=function(a,b){for(var c=0,d=0,e=0,f=a.lowerHead,g=b.upperHead;null!=g&&null!=f;){var h=this.offset(c,d,g.dx,g.dy,f.dx,f.dy),d=d+h,e=e+h;c+g.dx<=f.dx?(c+=g.dx,d+=g.dy,g=g.next):(c-=f.dx,d-=f.dy,f=f.next)}null!=g?(c=this.bridge(a.upperTail,0,0,g,c,d),a.upperTail=null!=c.next?b.upperTail:c,a.lowerTail=b.lowerTail):(c=this.bridge(b.lowerTail,c,d,f,0,0),null==c.next&&(a.lowerTail=c));a.lowerHead=b.lowerHead;return e};
mxCompactTreeLayout.prototype.offset=function(a,b,c,d,e,f){var g=0;if(e<=a||0>=a+c)return 0;g=0<e*d-c*f?0>a?a*d/c-b:0<a?a*f/e-b:-b:e<a+c?f-(b+(e-a)*d/c):e>a+c?(c+a)*f/e-(b+d):f-(b+d);return 0<g?g:0};mxCompactTreeLayout.prototype.bridge=function(a,b,c,d,e,f){b=e+d.dx-b;e=e=0;0==d.dx?e=d.dy:(e=b*d.dy,e/=d.dx);b=this.createLine(b,e,d.next);a.next=this.createLine(0,f+d.dy-e-c,b);return b};
mxCompactTreeLayout.prototype.createNode=function(a){var b={};b.cell=a;b.x=0;b.y=0;b.width=0;b.height=0;a=this.getVertexBounds(a);null!=a&&(this.isHorizontal()?(b.width=a.height,b.height=a.width):(b.width=a.width,b.height=a.height));b.offsetX=0;b.offsetY=0;b.contour={};return b};
mxCompactTreeLayout.prototype.apply=function(a,b){var c=this.graph.getModel(),d=a.cell,e=c.getGeometry(d);null!=d&&null!=e&&(this.isVertexMovable(d)&&(e=this.setVertexLocation(d,a.x,a.y),this.resizeParent&&(c=c.getParent(d),d=mxCellPath.create(c),null==this.parentsChanged[d]&&(this.parentsChanged[d]=c))),b=null==b?new mxRectangle(e.x,e.y,e.width,e.height):new mxRectangle(Math.min(b.x,e.x),Math.min(b.y,e.y),Math.max(b.x+b.width,e.x+e.width),Math.max(b.y+b.height,e.y+e.height)));return b};
mxCompactTreeLayout.prototype.createLine=function(a,b,c){var d={};d.dx=a;d.dy=b;d.next=c;return d};mxCompactTreeLayout.prototype.adjustParents=function(){var a=[],b;for(b in this.parentsChanged)a.push(this.parentsChanged[b]);this.arrangeGroups(mxUtils.sortCells(a,!0),this.groupPadding)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(a){this.processNodeOutgoing(a);for(a=a.child;null!=a;)this.localEdgeProcessing(a),a=a.next};
mxCompactTreeLayout.prototype.processNodeOutgoing=function(a){for(var b=a.child,c=a.cell,d=0,e=[];null!=b;){d++;var f=b.x;this.horizontal&&(f=b.y);e.push(new WeightedCellSorter(b,f));b=b.next}e.sort(WeightedCellSorter.prototype.compare);var f=a.width,g=(d+1)*this.prefHozEdgeSep;f>g+2*this.prefHozEdgeSep&&(f-=2*this.prefHozEdgeSep);a=f/d;b=a/2;f>g+2*this.prefHozEdgeSep&&(b+=this.prefHozEdgeSep);for(var f=this.minEdgeJetty-this.prefVertEdgeOff,g=0,h=this.getVertexBounds(c),k=0;k<e.length;k++){for(var l=
e[k].cell.cell,m=this.getVertexBounds(l),l=this.graph.getEdgesBetween(c,l,!1),n=[],o=0,q=0,r=0;r<l.length;r++)this.horizontal?(o=h.x+h.width,q=h.y+b,n.push(new mxPoint(o,q)),o=h.x+h.width+f,n.push(new mxPoint(o,q)),q=m.y+m.height/2):(o=h.x+b,q=h.y+h.height,n.push(new mxPoint(o,q)),q=h.y+h.height+f,n.push(new mxPoint(o,q)),o=m.x+m.width/2),n.push(new mxPoint(o,q)),this.setEdgePoints(l[r],n);k<d/2?f+=this.prefVertEdgeOff:k>d/2&&(f-=this.prefVertEdgeOff);b+=a;g=Math.max(g,f)}};
function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?1:b.weightedValue<a.weightedValue?-1:b.nudge?1:-1:0};function mxFastOrganicLayout(a){mxGraphLayout.call(this,a)}
mxFastOrganicLayout.prototype=new mxGraphLayout;mxFastOrganicLayout.prototype.constructor=mxFastOrganicLayout;mxFastOrganicLayout.prototype.useInputOrigin=!0;mxFastOrganicLayout.prototype.resetEdges=!0;mxFastOrganicLayout.prototype.disableEdgeStyle=!0;mxFastOrganicLayout.prototype.forceConstant=50;mxFastOrganicLayout.prototype.forceConstantSquared=0;mxFastOrganicLayout.prototype.minDistanceLimit=2;mxFastOrganicLayout.prototype.maxDistanceLimit=500;
mxFastOrganicLayout.prototype.minDistanceLimitSquared=4;mxFastOrganicLayout.prototype.initialTemp=200;mxFastOrganicLayout.prototype.temperature=0;mxFastOrganicLayout.prototype.maxIterations=0;mxFastOrganicLayout.prototype.iteration=0;mxFastOrganicLayout.prototype.allowedToRun=!0;mxFastOrganicLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||0==this.graph.getConnections(a).length};
mxFastOrganicLayout.prototype.execute=function(a){var b=this.graph.getModel();this.vertexArray=[];for(var c=this.graph.getChildVertices(a),d=0;d<c.length;d++)this.isVertexIgnored(c[d])||this.vertexArray.push(c[d]);var e=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,f=this.vertexArray.length;this.indices=[];this.dispX=[];this.dispY=[];this.cellLocation=[];this.isMoveable=[];this.neighbours=[];this.radius=[];this.radiusSquared=[];0.0010>this.forceConstant&&(this.forceConstant=
0.0010);this.forceConstantSquared=this.forceConstant*this.forceConstant;for(d=0;d<this.vertexArray.length;d++){var g=this.vertexArray[d];this.cellLocation[d]=[];var h=mxCellPath.create(g);this.indices[h]=d;var k=this.getVertexBounds(g),l=k.width,m=k.height,n=k.x,o=k.y;this.cellLocation[d][0]=n+l/2;this.cellLocation[d][1]=o+m/2;this.radius[d]=Math.min(l,m);this.radiusSquared[d]=this.radius[d]*this.radius[d]}b.beginUpdate();try{for(d=0;d<f;d++){this.dispX[d]=0;this.dispY[d]=0;this.isMoveable[d]=this.isVertexMovable(this.vertexArray[d]);
var q=this.graph.getConnections(this.vertexArray[d],a),c=this.graph.getOpposites(q,this.vertexArray[d]);this.neighbours[d]=[];for(l=0;l<c.length;l++){this.resetEdges&&this.graph.resetEdge(q[l]);this.disableEdgeStyle&&this.setEdgeStyleEnabled(q[l],!1);var h=mxCellPath.create(c[l]),r=this.indices[h];this.neighbours[d][l]=null!=r?r:d}}this.temperature=this.initialTemp;0==this.maxIterations&&(this.maxIterations=20*Math.sqrt(f));for(this.iteration=0;this.iteration<this.maxIterations;this.iteration++){if(!this.allowedToRun)return;
this.calcRepulsion();this.calcAttraction();this.calcPositions();this.reduceTemperature()}a=c=null;for(d=0;d<this.vertexArray.length;d++)g=this.vertexArray[d],this.isVertexMovable(g)&&(k=this.getVertexBounds(g),null!=k&&(this.cellLocation[d][0]-=k.width/2,this.cellLocation[d][1]-=k.height/2,n=this.graph.snap(this.cellLocation[d][0]),o=this.graph.snap(this.cellLocation[d][1]),this.setVertexLocation(g,n,o),c=null==c?n:Math.min(c,n),a=null==a?o:Math.min(a,o)));d=-(c||0)+1;g=-(a||0)+1;null!=e&&(d+=e.x,
g+=e.y);this.graph.moveCells(this.vertexArray,d,g)}finally{b.endUpdate()}};mxFastOrganicLayout.prototype.calcPositions=function(){for(var a=0;a<this.vertexArray.length;a++)if(this.isMoveable[a]){var b=Math.sqrt(this.dispX[a]*this.dispX[a]+this.dispY[a]*this.dispY[a]);0.0010>b&&(b=0.0010);var c=this.dispX[a]/b*Math.min(b,this.temperature),b=this.dispY[a]/b*Math.min(b,this.temperature);this.dispX[a]=0;this.dispY[a]=0;this.cellLocation[a][0]+=c;this.cellLocation[a][1]+=b}};
mxFastOrganicLayout.prototype.calcAttraction=function(){for(var a=0;a<this.vertexArray.length;a++)for(var b=0;b<this.neighbours[a].length;b++){var c=this.neighbours[a][b];if(a!=c&&this.isMoveable[a]&&this.isMoveable[c]){var d=this.cellLocation[a][0]-this.cellLocation[c][0],e=this.cellLocation[a][1]-this.cellLocation[c][1],f=d*d+e*e-this.radiusSquared[a]-this.radiusSquared[c];f<this.minDistanceLimitSquared&&(f=this.minDistanceLimitSquared);var g=Math.sqrt(f),f=f/this.forceConstant,d=d/g*f,e=e/g*f;
this.dispX[a]-=d;this.dispY[a]-=e;this.dispX[c]+=d;this.dispY[c]+=e}}};
mxFastOrganicLayout.prototype.calcRepulsion=function(){for(var a=this.vertexArray.length,b=0;b<a;b++)for(var c=b;c<a;c++){if(!this.allowedToRun)return;if(c!=b&&this.isMoveable[b]&&this.isMoveable[c]){var d=this.cellLocation[b][0]-this.cellLocation[c][0],e=this.cellLocation[b][1]-this.cellLocation[c][1];0==d&&(d=0.01+Math.random());0==e&&(e=0.01+Math.random());var f=Math.sqrt(d*d+e*e),g=f-this.radius[b]-this.radius[c];g>this.maxDistanceLimit||(g<this.minDistanceLimit&&(g=this.minDistanceLimit),g=this.forceConstantSquared/
g,d=d/f*g,e=e/f*g,this.dispX[b]+=d,this.dispY[b]+=e,this.dispX[c]-=d,this.dispY[c]-=e)}}};mxFastOrganicLayout.prototype.reduceTemperature=function(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)};function mxCircleLayout(a,b){mxGraphLayout.call(this,a);this.radius=null!=b?b:100}mxCircleLayout.prototype=new mxGraphLayout;mxCircleLayout.prototype.constructor=mxCircleLayout;mxCircleLayout.prototype.radius=null;mxCircleLayout.prototype.moveCircle=!1;
mxCircleLayout.prototype.x0=0;mxCircleLayout.prototype.y0=0;mxCircleLayout.prototype.resetEdges=!0;mxCircleLayout.prototype.disableEdgeStyle=!0;
mxCircleLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0,d=null,e=null,f=[],g=b.getChildCount(a),h=0;h<g;h++){var k=b.getChildAt(a,h);if(this.isVertexIgnored(k))this.isEdgeIgnored(k)||(this.resetEdges&&this.graph.resetEdge(k),this.disableEdgeStyle&&this.setEdgeStyleEnabled(k,!1));else{f.push(k);var l=this.getVertexBounds(k),d=null==d?l.y:Math.min(d,l.y),e=null==e?l.x:Math.min(e,l.x),c=Math.max(c,Math.max(l.width,l.height))}}var m=this.getRadius(f.length,
c);this.moveCircle&&(e=this.x0,d=this.y0);this.circle(f,m,e,d)}finally{b.endUpdate()}};mxCircleLayout.prototype.getRadius=function(a,b){return Math.max(a*b/Math.PI,this.radius)};mxCircleLayout.prototype.circle=function(a,b,c,d){for(var e=a.length,f=2*Math.PI/e,g=0;g<e;g++)this.isVertexMovable(a[g])&&this.setVertexLocation(a[g],c+b+b*Math.sin(g*f),d+b+b*Math.cos(g*f))};function mxParallelEdgeLayout(a){mxGraphLayout.call(this,a)}mxParallelEdgeLayout.prototype=new mxGraphLayout;
mxParallelEdgeLayout.prototype.constructor=mxParallelEdgeLayout;mxParallelEdgeLayout.prototype.spacing=20;mxParallelEdgeLayout.prototype.execute=function(a){a=this.findParallels(a);this.graph.model.beginUpdate();try{for(var b in a){var c=a[b];1<c.length&&this.layout(c)}}finally{this.graph.model.endUpdate()}};
mxParallelEdgeLayout.prototype.findParallels=function(a){for(var b=this.graph.getModel(),c=[],d=b.getChildCount(a),e=0;e<d;e++){var f=b.getChildAt(a,e);if(!this.isEdgeIgnored(f)){var g=this.getEdgeId(f);null!=g&&(null==c[g]&&(c[g]=[]),c[g].push(f))}}return c};mxParallelEdgeLayout.prototype.getEdgeId=function(a){var b=this.graph.getView(),c=b.getVisibleTerminal(a,!0),a=b.getVisibleTerminal(a,!1);return null!=c&&null!=a?(c=mxCellPath.create(c),a=mxCellPath.create(a),c>a?a+"-"+c:c+"-"+a):null};
mxParallelEdgeLayout.prototype.layout=function(a){var b=a[0],c=this.graph.getView(),d=this.graph.getModel(),e=d.getGeometry(c.getVisibleTerminal(b,!0)),d=d.getGeometry(c.getVisibleTerminal(b,!1));if(e==d)for(var b=e.x+e.width+this.spacing,c=e.y+e.height/2,f=0;f<a.length;f++)this.route(a[f],b,c),b+=this.spacing;else if(null!=e&&null!=d){var b=e.x+e.width/2,c=e.y+e.height/2,f=d.x+d.width/2-b,g=d.y+d.height/2-c,d=Math.sqrt(f*f+g*g);if(0<d){e=g*this.spacing/d;d=f*this.spacing/d;b=b+f/2+e*(a.length-1)/
2;c=c+g/2-d*(a.length-1)/2;for(f=0;f<a.length;f++)this.route(a[f],b,c),b-=e,c+=d}}};mxParallelEdgeLayout.prototype.route=function(a,b,c){this.graph.isCellMovable(a)&&this.setEdgePoints(a,[new mxPoint(b,c)])};function mxCompositeLayout(a,b,c){mxGraphLayout.call(this,a);this.layouts=b;this.master=c}mxCompositeLayout.prototype=new mxGraphLayout;mxCompositeLayout.prototype.constructor=mxCompositeLayout;mxCompositeLayout.prototype.layouts=null;mxCompositeLayout.prototype.master=null;
mxCompositeLayout.prototype.moveCell=function(a,b,c){null!=this.master?this.master.move.apply(this.master,arguments):this.layouts[0].move.apply(this.layouts[0],arguments)};mxCompositeLayout.prototype.execute=function(a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0;c<this.layouts.length;c++)this.layouts[c].execute.apply(this.layouts[c],arguments)}finally{b.endUpdate()}};function mxEdgeLabelLayout(a){mxGraphLayout.call(this,a)}mxEdgeLabelLayout.prototype=new mxGraphLayout;
mxEdgeLabelLayout.prototype.constructor=mxEdgeLabelLayout;mxEdgeLabelLayout.prototype.execute=function(a){for(var b=this.graph.view,c=this.graph.getModel(),d=[],e=[],f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g),k=b.getState(h);null!=k&&(this.isVertexIgnored(h)?this.isEdgeIgnored(h)||d.push(k):e.push(k))}this.placeLabels(e,d)};
mxEdgeLabelLayout.prototype.placeLabels=function(a,b){var c=this.graph.getModel();c.beginUpdate();try{for(var d=0;d<b.length;d++){var e=b[d];if(null!=e&&null!=e.text&&null!=e.text.boundingBox)for(var f=0;f<a.length;f++){var g=a[f];null!=g&&this.avoid(e,g)}}}finally{c.endUpdate()}};
mxEdgeLabelLayout.prototype.avoid=function(a,b){var c=this.graph.getModel(),d=a.text.boundingBox;if(mxUtils.intersects(d,b)){var e=-d.y-d.height+b.y,f=-d.y+b.y+b.height,e=Math.abs(e)<Math.abs(f)?e:f,f=-d.x-d.width+b.x,d=-d.x+b.x+b.width,d=Math.abs(f)<Math.abs(d)?f:d;Math.abs(d)<Math.abs(e)?e=0:d=0;f=c.getGeometry(a.cell);null!=f&&(f=f.clone(),null!=f.offset?(f.offset.x+=d,f.offset.y+=e):f.offset=new mxPoint(d,e),c.setGeometry(a.cell,f))}};
function mxGraphAbstractHierarchyCell(){this.x=[];this.y=[];this.temp=[]}mxGraphAbstractHierarchyCell.prototype.maxRank=-1;mxGraphAbstractHierarchyCell.prototype.minRank=-1;mxGraphAbstractHierarchyCell.prototype.x=null;mxGraphAbstractHierarchyCell.prototype.y=null;mxGraphAbstractHierarchyCell.prototype.width=0;mxGraphAbstractHierarchyCell.prototype.height=0;mxGraphAbstractHierarchyCell.prototype.nextLayerConnectedCells=null;mxGraphAbstractHierarchyCell.prototype.previousLayerConnectedCells=null;
mxGraphAbstractHierarchyCell.prototype.temp=null;mxGraphAbstractHierarchyCell.prototype.getNextLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.getPreviousLayerConnectedCells=function(){return null};mxGraphAbstractHierarchyCell.prototype.isEdge=function(){return!1};mxGraphAbstractHierarchyCell.prototype.isVertex=function(){return!1};mxGraphAbstractHierarchyCell.prototype.getGeneralPurposeVariable=function(){return null};
mxGraphAbstractHierarchyCell.prototype.setGeneralPurposeVariable=function(){return null};mxGraphAbstractHierarchyCell.prototype.setX=function(a,b){this.isVertex()?this.x[0]=b:this.isEdge()&&(this.x[a-this.minRank-1]=b)};mxGraphAbstractHierarchyCell.prototype.getX=function(a){return this.isVertex()?this.x[0]:this.isEdge()?this.x[a-this.minRank-1]:0};mxGraphAbstractHierarchyCell.prototype.setY=function(a,b){this.isVertex()?this.y[0]=b:this.isEdge()&&(this.y[a-this.minRank-1]=b)};
function mxGraphHierarchyNode(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.cell=a;this.connectsAsTarget=[];this.connectsAsSource=[]}mxGraphHierarchyNode.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyNode.prototype.constructor=mxGraphHierarchyNode;mxGraphHierarchyNode.prototype.cell=null;mxGraphHierarchyNode.prototype.connectsAsTarget=null;mxGraphHierarchyNode.prototype.connectsAsSource=null;mxGraphHierarchyNode.prototype.hashCode=!1;
mxGraphHierarchyNode.prototype.getRankValue=function(){return this.maxRank};mxGraphHierarchyNode.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];this.nextLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsTarget.length;b++){var c=this.connectsAsTarget[b];-1==c.maxRank||c.maxRank==a+1?this.nextLayerConnectedCells[0].push(c.source):this.nextLayerConnectedCells[0].push(c)}}return this.nextLayerConnectedCells[0]};
mxGraphHierarchyNode.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];this.previousLayerConnectedCells[0]=[];for(var b=0;b<this.connectsAsSource.length;b++){var c=this.connectsAsSource[b];-1==c.minRank||c.minRank==a-1?this.previousLayerConnectedCells[0].push(c.target):this.previousLayerConnectedCells[0].push(c)}}return this.previousLayerConnectedCells[0]};mxGraphHierarchyNode.prototype.isVertex=function(){return!0};
mxGraphHierarchyNode.prototype.getGeneralPurposeVariable=function(){return this.temp[0]};mxGraphHierarchyNode.prototype.setGeneralPurposeVariable=function(a,b){this.temp[0]=b};mxGraphHierarchyNode.prototype.isAncestor=function(a){if(null!=a&&null!=this.hashCode&&null!=a.hashCode&&this.hashCode.length<a.hashCode.length){if(this.hashCode==a.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(var b=0;b<this.hashCode.length;b++)if(this.hashCode[b]!=a.hashCode[b])return!1;return!0}return!1};
mxGraphHierarchyNode.prototype.getCoreCell=function(){return this.cell};function mxGraphHierarchyEdge(a){mxGraphAbstractHierarchyCell.apply(this,arguments);this.edges=a}mxGraphHierarchyEdge.prototype=new mxGraphAbstractHierarchyCell;mxGraphHierarchyEdge.prototype.constructor=mxGraphHierarchyEdge;mxGraphHierarchyEdge.prototype.edges=null;mxGraphHierarchyEdge.prototype.source=null;mxGraphHierarchyEdge.prototype.target=null;mxGraphHierarchyEdge.prototype.isReversed=!1;
mxGraphHierarchyEdge.prototype.invert=function(a){a=this.source;this.source=this.target;this.target=a;this.isReversed=!this.isReversed};
mxGraphHierarchyEdge.prototype.getNextLayerConnectedCells=function(a){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.nextLayerConnectedCells[b]=[],b==this.temp.length-1?this.nextLayerConnectedCells[b].push(this.source):this.nextLayerConnectedCells[b].push(this)}return this.nextLayerConnectedCells[a-this.minRank-1]};
mxGraphHierarchyEdge.prototype.getPreviousLayerConnectedCells=function(a){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(var b=0;b<this.temp.length;b++)this.previousLayerConnectedCells[b]=[],0==b?this.previousLayerConnectedCells[b].push(this.target):this.previousLayerConnectedCells[b].push(this)}return this.previousLayerConnectedCells[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.isEdge=function(){return!0};
mxGraphHierarchyEdge.prototype.getGeneralPurposeVariable=function(a){return this.temp[a-this.minRank-1]};mxGraphHierarchyEdge.prototype.setGeneralPurposeVariable=function(a,b){this.temp[a-this.minRank-1]=b};mxGraphHierarchyEdge.prototype.getCoreCell=function(){return null!=this.edges&&0<this.edges.length?this.edges[0]:null};
function mxGraphHierarchyModel(a,b,c,d,e){a.getGraph();this.tightenToSource=e;this.roots=c;this.parent=d;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;c=[];null==b&&(b=this.graph.getChildVertices(d));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(a,b,c);for(d=0;d<b.length;d++){for(var e=c[d].connectsAsSource,f=0;f<e.length;f++){var g=e[f],h=g.edges;if(null!=h&&0<h.length){var h=h[0],k=a.getVisibleTerminal(h,!1),k=mxCellPath.create(k),k=this.vertexMapper[k];c[d]==k&&(k=a.getVisibleTerminal(h,
!0),k=mxCellPath.create(k),k=this.vertexMapper[k]);null!=k&&c[d]!=k&&(g.target=k,0==k.connectsAsTarget.length&&(k.connectsAsTarget=[]),0>mxUtils.indexOf(k.connectsAsTarget,g)&&k.connectsAsTarget.push(g))}}c[d].temp[0]=1}}mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;
mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=1E8;mxGraphHierarchyModel.prototype.tightenToSource=!1;
mxGraphHierarchyModel.prototype.createInternalCells=function(a,b,c){for(var d=a.getGraph(),e=0;e<b.length;e++){c[e]=new mxGraphHierarchyNode(b[e]);var f=mxCellPath.create(b[e]);this.vertexMapper[f]=c[e];f=a.getEdges(b[e]);c[e].connectsAsSource=[];for(var g=0;g<f.length;g++){var h=a.getVisibleTerminal(f[g],!1);if(h!=b[e]&&a.graph.model.isVertex(h)&&!a.isVertexIgnored(h)){var k=a.getEdgesBetween(b[e],h,!1),l=a.getEdgesBetween(b[e],h,!0),h=mxCellPath.create(k[0]);if(null!=k&&0<k.length&&null==this.edgeMapper[h]&&
2*l.length>=k.length){for(var l=new mxGraphHierarchyEdge(k),m=0;m<k.length;m++){var n=k[m],h=mxCellPath.create(n);this.edgeMapper[h]=l;d.resetEdge(n);a.disableEdgeStyle&&(a.setEdgeStyleEnabled(n,!1),a.setOrthogonalEdge(n,!0))}l.source=c[e];0>mxUtils.indexOf(c[e].connectsAsSource,l)&&c[e].connectsAsSource.push(l)}}}c[e].temp[0]=0}};
mxGraphHierarchyModel.prototype.initialRank=function(){var a=[];if(null!=this.roots)for(var b=0;b<this.roots.length;b++){var c=mxCellPath.create(this.roots[b]),c=this.vertexMapper[c];null!=c&&a.push(c)}for(var d in this.vertexMapper)c=this.vertexMapper[d],c.temp[0]=-1;for(var e=a.slice();0<a.length;){var c=a[0],f,g;f=c.connectsAsTarget;g=c.connectsAsSource;for(var h=!0,k=this.SOURCESCANSTARTRANK,b=0;b<f.length;b++){var l=f[b];if(5270620==l.temp[0])l=l.source,k=Math.min(k,l.temp[0]-1);else{h=!1;break}}if(h){c.temp[0]=
k;this.maxRank=Math.min(this.maxRank,k);if(null!=g)for(b=0;b<g.length;b++)l=g[b],l.temp[0]=5270620,l=l.target,-1==l.temp[0]&&(a.push(l),l.temp[0]=-2);a.shift()}else if(b=a.shift(),a.push(c),b==c&&1==a.length)break}for(d in this.vertexMapper)c=this.vertexMapper[d],c.temp[0]-=this.maxRank;for(b=0;b<e.length;b++){c=e[b];a=0;f=c.connectsAsSource;for(d=0;d<f.length;d++)l=f[d],l=l.target,c.temp[0]=Math.max(a,l.temp[0]+1),a=c.temp[0]}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};
mxGraphHierarchyModel.prototype.fixRanks=function(){var a=[];this.ranks=[];for(var b=0;b<this.maxRank+1;b++)a[b]=[],this.ranks[b]=a[b];var c=null;if(null!=this.roots)for(var d=this.roots,c=[],b=0;b<d.length;b++){var e=mxCellPath.create(d[b]);c[b]=this.vertexMapper[e]}this.visit(function(b,c,d,e,l){0==l&&0>c.maxRank&&0>c.minRank&&(a[c.temp[0]].push(c),c.maxRank=c.temp[0],c.minRank=c.temp[0],c.temp[0]=a[c.maxRank].length-1);if(null!=b&&null!=d&&1<b.maxRank-c.maxRank){d.maxRank=b.maxRank;d.minRank=c.maxRank;
d.temp=[];d.x=[];d.y=[];for(b=d.minRank+1;b<d.maxRank;b++)a[b].push(d),d.setGeneralPurposeVariable(b,a[b].length-1)}},c,!1,null)};mxGraphHierarchyModel.prototype.visit=function(a,b,c,d){if(null!=b){for(var e=0;e<b.length;e++){var f=b[e];null!=f&&(null==d&&(d={}),c?(f.hashCode=[],f.hashCode[0]=this.dfsCount,f.hashCode[1]=e,this.extendedDfs(null,f,null,a,d,f.hashCode,e,0)):this.dfs(null,f,null,a,d,0))}this.dfsCount++}};
mxGraphHierarchyModel.prototype.dfs=function(a,b,c,d,e,f){if(null!=b){var g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,f,0);a=b.connectsAsSource.slice();for(c=0;c<a.length;c++)g=a[c],this.dfs(b,g.target,g,d,e,f+1)}else d(a,b,c,f,1)}};
mxGraphHierarchyModel.prototype.extendedDfs=function(a,b,c,d,e,f,g,h){if(null!=b){if(null!=a&&(null==b.hashCode||b.hashCode[0]!=a.hashCode[0]))f=a.hashCode.length+1,b.hashCode=a.hashCode.slice(),b.hashCode[f-1]=g;g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,h,0);a=b.connectsAsSource.slice();for(c=0;c<a.length;c++)g=a[c],this.extendedDfs(b,g.target,g,d,e,b.hashCode,c,h+1)}else d(a,b,c,h,1)}};
function mxSwimlaneModel(a,b,c,d,e){a.getGraph();this.tightenToSource=e;this.roots=c;this.parent=d;this.vertexMapper={};this.edgeMapper={};this.maxRank=0;c=[];null==b&&(b=this.graph.getChildVertices(d));this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(a,b,c);for(d=0;d<b.length;d++){for(var e=c[d].connectsAsSource,f=0;f<e.length;f++){var g=e[f],h=g.edges;if(null!=h&&0<h.length){var h=h[0],k=a.getVisibleTerminal(h,!1),k=mxCellPath.create(k),k=this.vertexMapper[k];c[d]==k&&(k=a.getVisibleTerminal(h,
!0),k=mxCellPath.create(k),k=this.vertexMapper[k]);null!=k&&c[d]!=k&&(g.target=k,0==k.connectsAsTarget.length&&(k.connectsAsTarget=[]),0>mxUtils.indexOf(k.connectsAsTarget,g)&&k.connectsAsTarget.push(g))}}c[d].temp[0]=1}}mxSwimlaneModel.prototype.maxRank=null;mxSwimlaneModel.prototype.vertexMapper=null;mxSwimlaneModel.prototype.edgeMapper=null;mxSwimlaneModel.prototype.ranks=null;mxSwimlaneModel.prototype.roots=null;mxSwimlaneModel.prototype.parent=null;mxSwimlaneModel.prototype.dfsCount=0;
mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=1E8;mxSwimlaneModel.prototype.ranksPerGroup=null;
mxSwimlaneModel.prototype.createInternalCells=function(a,b,c){for(var d=a.getGraph(),e=a.swimlanes,f=0;f<b.length;f++){c[f]=new mxGraphHierarchyNode(b[f]);var g=mxCellPath.create(b[f]);this.vertexMapper[g]=c[f];c[f].swimlaneIndex=-1;for(g=0;g<e.length;g++)if(d.model.getParent(b[f])==e[g]){c[f].swimlaneIndex=g;break}g=a.getEdges(b[f]);c[f].connectsAsSource=[];for(var h=0;h<g.length;h++){var k=a.getVisibleTerminal(g[h],!1);if(k!=b[f]&&a.graph.model.isVertex(k)&&!a.isVertexIgnored(k)){var l=a.getEdgesBetween(b[f],
k,!1),m=a.getEdgesBetween(b[f],k,!0),k=mxCellPath.create(l[0]);if(null!=l&&0<l.length&&null==this.edgeMapper[k]&&2*m.length>=l.length){for(var m=new mxGraphHierarchyEdge(l),n=0;n<l.length;n++){var o=l[n],k=mxCellPath.create(o);this.edgeMapper[k]=m;d.resetEdge(o);a.disableEdgeStyle&&(a.setEdgeStyleEnabled(o,!1),a.setOrthogonalEdge(o,!0))}m.source=c[f];0>mxUtils.indexOf(c[f].connectsAsSource,m)&&c[f].connectsAsSource.push(m)}}}c[f].temp[0]=0}};
mxSwimlaneModel.prototype.initialRank=function(){this.ranksPerGroup=[];var a=[],b={};if(null!=this.roots)for(var c=0;c<this.roots.length;c++){var d=mxCellPath.create(this.roots[c]),d=this.vertexMapper[d];this.maxChainDfs(null,d,null,b,0);null!=d&&a.push(d)}d=[];b=[];for(c=this.ranksPerGroup.length-1;0<=c;c--)d[c]=c==this.ranksPerGroup.length-1?0:b[c+1]+1,b[c]=d[c]+this.ranksPerGroup[c];this.maxRank=b[0];for(var e in this.vertexMapper)d=this.vertexMapper[e],d.temp[0]=-1;for(a.slice();0<a.length;){var d=
a[0],f;e=d.connectsAsTarget;f=d.connectsAsSource;for(var g=!0,h=b[0],c=0;c<e.length;c++){var k=e[c];if(5270620==k.temp[0])k=k.source,h=Math.min(h,k.temp[0]-1);else{g=!1;break}}if(g){h>b[d.swimlaneIndex]&&(h=b[d.swimlaneIndex]);d.temp[0]=h;if(null!=f)for(c=0;c<f.length;c++)k=f[c],k.temp[0]=5270620,k=k.target,-1==k.temp[0]&&(a.push(k),k.temp[0]=-2);a.shift()}else if(c=a.shift(),a.push(d),c==d&&1==a.length)break}};
mxSwimlaneModel.prototype.maxChainDfs=function(a,b,c,d,e){if(null!=b&&(a=mxCellPath.create(b.cell),null==d[a])){d[a]=b;a=b.swimlaneIndex;if(null==this.ranksPerGroup[a]||this.ranksPerGroup[a]<e)this.ranksPerGroup[a]=e;a=b.connectsAsSource.slice();for(c=0;c<a.length;c++){var f=a[c],g=f.target;b.swimlaneIndex<g.swimlaneIndex?this.maxChainDfs(b,g,f,mxUtils.clone(d,null,!0),0):b.swimlaneIndex==g.swimlaneIndex&&this.maxChainDfs(b,g,f,mxUtils.clone(d,null,!0),e+1)}}};
mxSwimlaneModel.prototype.fixRanks=function(){var a=[];this.ranks=[];for(var b=0;b<this.maxRank+1;b++)a[b]=[],this.ranks[b]=a[b];var c=null;if(null!=this.roots)for(var d=this.roots,c=[],b=0;b<d.length;b++){var e=mxCellPath.create(d[b]);c[b]=this.vertexMapper[e]}this.visit(function(b,c,d,e,l){0==l&&0>c.maxRank&&0>c.minRank&&(null==a[c.temp[0]]&&mxLog.show(),a[c.temp[0]].push(c),c.maxRank=c.temp[0],c.minRank=c.temp[0],c.temp[0]=a[c.maxRank].length-1);if(null!=b&&null!=d&&1<b.maxRank-c.maxRank){d.maxRank=
b.maxRank;d.minRank=c.maxRank;d.temp=[];d.x=[];d.y=[];for(b=d.minRank+1;b<d.maxRank;b++)a[b].push(d),d.setGeneralPurposeVariable(b,a[b].length-1)}},c,!1,null)};mxSwimlaneModel.prototype.visit=function(a,b,c,d){if(null!=b){for(var e=0;e<b.length;e++){var f=b[e];null!=f&&(null==d&&(d={}),c?(f.hashCode=[],f.hashCode[0]=this.dfsCount,f.hashCode[1]=e,this.extendedDfs(null,f,null,a,d,f.hashCode,e,0)):this.dfs(null,f,null,a,d,0))}this.dfsCount++}};
mxSwimlaneModel.prototype.dfs=function(a,b,c,d,e,f){if(null!=b){var g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,f,0);a=b.connectsAsSource.slice();for(c=0;c<a.length;c++)g=a[c],this.dfs(b,g.target,g,d,e,f+1)}else d(a,b,c,f,1)}};
mxSwimlaneModel.prototype.extendedDfs=function(a,b,c,d,e,f,g,h){if(null!=b){if(null!=a&&(null==b.hashCode||b.hashCode[0]!=a.hashCode[0]))f=a.hashCode.length+1,b.hashCode=a.hashCode.slice(),b.hashCode[f-1]=g;g=mxCellPath.create(b.cell);if(null==e[g]){e[g]=b;d(a,b,c,h,0);a=b.connectsAsSource.slice();c=b.connectsAsTarget.slice();for(g=0;g<a.length;g++){var f=a[g],k=f.target;null==k&&mxLog.show();b.swimlaneIndex<=k.swimlaneIndex&&this.extendedDfs(b,k,f,d,e,b.hashCode,g,h+1)}for(g=0;g<c.length;g++)f=c[g],
k=f.source,b.swimlaneIndex<k.swimlaneIndex&&this.extendedDfs(b,k,f,d,e,b.hashCode,g,h+1)}else d(a,b,c,h,1)}};function mxHierarchicalLayoutStage(){}mxHierarchicalLayoutStage.prototype.execute=function(){};function mxMedianHybridCrossingReduction(a){this.layout=a}mxMedianHybridCrossingReduction.prototype=new mxHierarchicalLayoutStage;mxMedianHybridCrossingReduction.prototype.constructor=mxMedianHybridCrossingReduction;mxMedianHybridCrossingReduction.prototype.layout=null;
mxMedianHybridCrossingReduction.prototype.maxIterations=24;mxMedianHybridCrossingReduction.prototype.nestedBestRanks=null;mxMedianHybridCrossingReduction.prototype.currentBestCrossings=0;mxMedianHybridCrossingReduction.prototype.iterationsWithoutImprovement=0;mxMedianHybridCrossingReduction.prototype.maxNoImprovementIterations=2;
mxMedianHybridCrossingReduction.prototype.execute=function(a){a=this.layout.getModel();this.nestedBestRanks=[];for(var b=0;b<a.ranks.length;b++)this.nestedBestRanks[b]=a.ranks[b].slice();for(var c=0,d=this.calculateCrossings(a),b=0;b<this.maxIterations&&c<this.maxNoImprovementIterations;b++){this.weightedMedian(b,a);this.transpose(b,a);var e=this.calculateCrossings(a);if(e<d){d=e;for(e=c=0;e<this.nestedBestRanks.length;e++)for(var f=a.ranks[e],g=0;g<f.length;g++){var h=f[g];this.nestedBestRanks[e][h.getGeneralPurposeVariable(e)]=
h}}else{c++;for(e=0;e<this.nestedBestRanks.length;e++){f=a.ranks[e];for(g=0;g<f.length;g++)h=f[g],h.setGeneralPurposeVariable(e,g)}}if(0==d)break}c=[];d=[];for(b=0;b<a.maxRank+1;b++)d[b]=[],c[b]=d[b];for(b=0;b<this.nestedBestRanks.length;b++)for(e=0;e<this.nestedBestRanks[b].length;e++)d[b].push(this.nestedBestRanks[b][e]);a.ranks=c};mxMedianHybridCrossingReduction.prototype.calculateCrossings=function(a){for(var b=a.ranks.length,c=0,d=1;d<b;d++)c+=this.calculateRankCrossing(d,a);return c};
mxMedianHybridCrossingReduction.prototype.calculateRankCrossing=function(a,b){for(var c=0,d=b.ranks[a],e=d.length,f=b.ranks[a-1].length,g=[],h=0;h<e;h++)g[h]=[];for(h=0;h<d.length;h++)for(var k=d[h],l=k.getGeneralPurposeVariable(a),m=k.getPreviousLayerConnectedCells(a),k=0;k<m.length;k++){var n=m[k].getGeneralPurposeVariable(a-1);g[l][n]=201207}for(h=0;h<e;h++)for(k=0;k<f;k++)if(201207==g[h][k]){for(d=h+1;d<e;d++)for(l=0;l<k;l++)201207==g[d][l]&&c++;for(d=0;d<h;d++)for(l=k+1;l<f;l++)201207==g[d][l]&&
c++}return c/2};
mxMedianHybridCrossingReduction.prototype.transpose=function(a,b){for(var c=!0,d=0;c&&10>d++;)for(var e=1==a%2&&1==d%2,c=!1,f=0;f<b.ranks.length;f++){for(var g=b.ranks[f],h=[],k=0;k<g.length;k++){var l=g[k],m=l.getGeneralPurposeVariable(f);0>m&&(m=k);h[m]=l}for(var n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=null,k=0;k<g.length-1;k++){if(0==k){for(var v=h[k],l=v.getNextLayerConnectedCells(f),m=v.getPreviousLayerConnectedCells(f),q=[],r=[],z=0;z<l.length;z++)q[z]=l[z].getGeneralPurposeVariable(f+1);
for(z=0;z<m.length;z++)r[z]=m[z].getGeneralPurposeVariable(f-1)}else l=n,m=o,q=u,r=w,v=x;x=h[k+1];n=x.getNextLayerConnectedCells(f);o=x.getPreviousLayerConnectedCells(f);u=[];w=[];for(z=0;z<n.length;z++)u[z]=n[z].getGeneralPurposeVariable(f+1);for(z=0;z<o.length;z++)w[z]=o[z].getGeneralPurposeVariable(f-1);for(var D=0,H=0,z=0;z<q.length;z++)for(var C=0;C<u.length;C++)q[z]>u[C]&&D++,q[z]<u[C]&&H++;for(z=0;z<r.length;z++)for(C=0;C<w.length;C++)r[z]>w[C]&&D++,r[z]<w[C]&&H++;if(H<D||H==D&&e)n=v.getGeneralPurposeVariable(f),
v.setGeneralPurposeVariable(f,x.getGeneralPurposeVariable(f)),x.setGeneralPurposeVariable(f,n),n=l,o=m,u=q,w=r,x=v,e||(c=!0)}}};mxMedianHybridCrossingReduction.prototype.weightedMedian=function(a,b){var c=0==a%2;if(c)for(var d=b.maxRank-1;0<=d;d--)this.medianRank(d,c);else for(d=1;d<b.maxRank;d++)this.medianRank(d,c)};
mxMedianHybridCrossingReduction.prototype.medianRank=function(a,b){for(var c=this.nestedBestRanks[a].length,d=[],e=[],f=0;f<c;f++){var g=this.nestedBestRanks[a][f],h=new MedianCellSorter;h.cell=g;var k;k=b?g.getNextLayerConnectedCells(a):g.getPreviousLayerConnectedCells(a);var l;l=b?a+1:a-1;null!=k&&0!=k.length?(h.medianValue=this.medianValue(k,l),d.push(h)):e[g.getGeneralPurposeVariable(a)]=!0}d.sort(MedianCellSorter.prototype.compare);for(f=0;f<c;f++)null==e[f]&&(g=d.shift().cell,g.setGeneralPurposeVariable(a,
f))};mxMedianHybridCrossingReduction.prototype.medianValue=function(a,b){for(var c=[],d=0,e=0;e<a.length;e++){var f=a[e];c[d++]=f.getGeneralPurposeVariable(b)}c.sort(function(a,b){return a-b});if(1==d%2)return c[Math.floor(d/2)];if(2==d)return(c[0]+c[1])/2;e=d/2;f=c[e-1]-c[0];d=c[d-1]-c[e];return(c[e-1]*d+c[e]*f)/(f+d)};function MedianCellSorter(){}MedianCellSorter.prototype.medianValue=0;MedianCellSorter.prototype.cell=!1;
MedianCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.medianValue>a.medianValue?-1:b.medianValue<a.medianValue?1:0:0};function mxMinimumCycleRemover(a){this.layout=a}mxMinimumCycleRemover.prototype=new mxHierarchicalLayoutStage;mxMinimumCycleRemover.prototype.constructor=mxMinimumCycleRemover;mxMinimumCycleRemover.prototype.layout=null;
mxMinimumCycleRemover.prototype.execute=function(a){var b=this.layout.getModel(),c={},d=mxUtils.clone(b.vertexMapper,null,!0),e=null;if(null!=b.roots)for(var f=b.roots,e=[],a=0;a<f.length;a++){var g=mxCellPath.create(f[a]);e[a]=b.vertexMapper[g]}b.visit(function(a,b,e){b.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),a.connectsAsTarget.push(e),mxUtils.remove(e,b.connectsAsTarget),b.connectsAsSource.push(e));a=mxCellPath.create(b.cell);c[a]=b;delete d[a]},e,!0,null);e=null;0<d.lenth&&
(e=mxUtils.clone(d,null,!0));a=mxUtils.clone(c,null,!0);b.visit(function(a,b,e){b.isAncestor(a)&&(e.invert(),mxUtils.remove(e,a.connectsAsSource),b.connectsAsSource.push(e),a.connectsAsTarget.push(e),mxUtils.remove(e,b.connectsAsTarget));a=mxCellPath.create(b.cell);c[a]=b;delete d[a]},d,!0,a);f=this.layout.getGraph();if(null!=e&&0<e.length){b=b.roots;for(a=0;a<e.length;a++)g=e[a].cell,0==f.getIncomingEdges(g).length&&b.push(g)}};
function mxCoordinateAssignment(a,b,c,d,e,f){this.layout=a;this.intraCellSpacing=b;this.interRankCellSpacing=c;this.orientation=d;this.initialX=e;this.parallelEdgeSpacing=f}var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxCoordinateAssignment.prototype=new mxHierarchicalLayoutStage;mxCoordinateAssignment.prototype.constructor=mxCoordinateAssignment;mxCoordinateAssignment.prototype.layout=null;mxCoordinateAssignment.prototype.intraCellSpacing=30;
mxCoordinateAssignment.prototype.interRankCellSpacing=100;mxCoordinateAssignment.prototype.parallelEdgeSpacing=10;mxCoordinateAssignment.prototype.maxIterations=8;mxCoordinateAssignment.prototype.prefHozEdgeSep=5;mxCoordinateAssignment.prototype.prefVertEdgeOff=2;mxCoordinateAssignment.prototype.minEdgeJetty=12;mxCoordinateAssignment.prototype.channelBuffer=4;mxCoordinateAssignment.prototype.jettyPositions=null;mxCoordinateAssignment.prototype.orientation=mxConstants.DIRECTION_NORTH;
mxCoordinateAssignment.prototype.initialX=null;mxCoordinateAssignment.prototype.limitX=null;mxCoordinateAssignment.prototype.currentXDelta=null;mxCoordinateAssignment.prototype.widestRank=null;mxCoordinateAssignment.prototype.rankTopY=null;mxCoordinateAssignment.prototype.rankBottomY=null;mxCoordinateAssignment.prototype.widestRankValue=null;mxCoordinateAssignment.prototype.rankWidths=null;mxCoordinateAssignment.prototype.rankY=null;mxCoordinateAssignment.prototype.fineTuning=!0;
mxCoordinateAssignment.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxCoordinateAssignment.prototype.nextLayerConnectedCache=null;mxCoordinateAssignment.prototype.previousLayerConnectedCache=null;mxCoordinateAssignment.prototype.groupPadding=10;
mxCoordinateAssignment.prototype.printStatus=function(){var a=this.layout.getModel();mxLog.show();mxLog.writeln("======Coord assignment debug=======");for(var b=0;b<a.ranks.length;b++){mxLog.write("Rank ",b," : ");for(var c=a.ranks[b],d=0;d<c.length;d++)mxLog.write(c[d].getGeneralPurposeVariable(b),"  ");mxLog.writeln()}mxLog.writeln("====================================")};
mxCoordinateAssignment.prototype.execute=function(a){this.jettyPositions=[];a=this.layout.getModel();this.currentXDelta=0;this.initialCoords(this.layout.getGraph(),a);this.fineTuning&&this.minNode(a);var b=1E8;if(this.fineTuning)for(var c=0;c<this.maxIterations;c++){0!=c&&(this.medianPos(c,a),this.minNode(a));if(this.currentXDelta<b){for(var d=0;d<a.ranks.length;d++)for(var e=a.ranks[d],f=0;f<e.length;f++){var g=e[f];g.setX(d,g.getGeneralPurposeVariable(d))}b=this.currentXDelta}else for(d=0;d<a.ranks.length;d++){e=
a.ranks[d];for(f=0;f<e.length;f++)g=e[f],g.setGeneralPurposeVariable(d,g.getX(d))}this.minPath(this.layout.getGraph(),a);this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),a)};
mxCoordinateAssignment.prototype.minNode=function(a){for(var b=[],c=[],d=[],e=0;e<=a.maxRank;e++){d[e]=a.ranks[e];for(var f=0;f<d[e].length;f++){var g=d[e][f],h=new WeightedCellSorter(g,e);h.rankIndex=f;h.visited=!0;b.push(h);g=mxCellPath.create(g.getCoreCell());c[g]=h}}a=10*b.length;for(f=0;0<b.length&&f<=a;){var h=b.shift(),e=h.cell,k=h.weightedValue,l=parseInt(h.rankIndex),g=e.getNextLayerConnectedCells(k),m=e.getPreviousLayerConnectedCells(k),n=g.length,o=m.length,q=this.medianXValue(g,k+1),r=
this.medianXValue(m,k-1),u=n+o,w=e.getGeneralPurposeVariable(k),v=w;0<u&&(v=(q*n+r*o)/u);n=!1;v<w-1?0==l?(e.setGeneralPurposeVariable(k,v),n=!0):(l=d[k][l-1],w=l.getGeneralPurposeVariable(k),w=w+l.width/2+this.intraCellSpacing+e.width/2,w<v?(e.setGeneralPurposeVariable(k,v),n=!0):w<e.getGeneralPurposeVariable(k)-1&&(e.setGeneralPurposeVariable(k,w),n=!0)):v>w+1&&(l==d[k].length-1?(e.setGeneralPurposeVariable(k,v),n=!0):(l=d[k][l+1],w=l.getGeneralPurposeVariable(k),w=w-l.width/2-this.intraCellSpacing-
e.width/2,w>v?(e.setGeneralPurposeVariable(k,v),n=!0):w>e.getGeneralPurposeVariable(k)+1&&(e.setGeneralPurposeVariable(k,w),n=!0)));if(n){for(e=0;e<g.length;e++)k=g[e],k=mxCellPath.create(k.getCoreCell()),k=c[k],null!=k&&!1==k.visited&&(k.visited=!0,b.push(k));for(e=0;e<m.length;e++)k=m[e],k=mxCellPath.create(k.getCoreCell()),k=c[k],null!=k&&!1==k.visited&&(k.visited=!0,b.push(k))}h.visited=!1;f++}};
mxCoordinateAssignment.prototype.medianPos=function(a,b){if(0==a%2)for(var c=b.maxRank;0<c;c--)this.rankMedianPosition(c-1,b,c);else for(c=0;c<b.maxRank-1;c++)this.rankMedianPosition(c+1,b,c)};
mxCoordinateAssignment.prototype.rankMedianPosition=function(a,b,c){for(var b=b.ranks[a],d=[],e=[],f=0;f<b.length;f++){var g=b[f];d[f]=new WeightedCellSorter;d[f].cell=g;d[f].rankIndex=f;var h=mxCellPath.create(g.getCoreCell());e[h]=d[f];var k=null,k=c<a?g.getPreviousLayerConnectedCells(a):g.getNextLayerConnectedCells(a);d[f].weightedValue=this.calculatedWeightedValue(g,k)}d.sort(WeightedCellSorter.prototype.compare);for(f=0;f<d.length;f++){g=d[f].cell;h=0;k=c<a?g.getPreviousLayerConnectedCells(a).slice():
g.getNextLayerConnectedCells(a).slice();null!=k&&(h=k.length,h=0<h?this.medianXValue(k,c):g.getGeneralPurposeVariable(a));for(var l=0,k=-1E8,m=d[f].rankIndex-1;0<=m;){var n=mxCellPath.create(b[m].getCoreCell()),n=e[n];if(null!=n){var o=n.cell;n.visited?(k=o.getGeneralPurposeVariable(a)+o.width/2+this.intraCellSpacing+l+g.width/2,m=-1):(l+=o.width+this.intraCellSpacing,m--)}}l=0;o=1E8;for(m=d[f].rankIndex+1;m<d.length;)if(n=mxCellPath.create(b[m].getCoreCell()),n=e[n],null!=n){var q=n.cell;n.visited?
(o=q.getGeneralPurposeVariable(a)-q.width/2-this.intraCellSpacing-l-g.width/2,m=d.length):(l+=q.width+this.intraCellSpacing,m++)}h>=k&&h<=o?g.setGeneralPurposeVariable(a,h):h<k?(g.setGeneralPurposeVariable(a,k),this.currentXDelta+=k-h):h>o&&(g.setGeneralPurposeVariable(a,o),this.currentXDelta+=h-o);d[f].visited=!0}};mxCoordinateAssignment.prototype.calculatedWeightedValue=function(a,b){for(var c=0,d=0;d<b.length;d++){var e=b[d];a.isVertex()&&e.isVertex()?c++:c=a.isEdge()&&e.isEdge()?c+8:c+2}return c};
mxCoordinateAssignment.prototype.medianXValue=function(a,b){if(0==a.length)return 0;for(var c=[],d=0;d<a.length;d++)c[d]=a[d].getGeneralPurposeVariable(b);c.sort(function(a,b){return a-b});if(1==a.length%2)return c[Math.floor(a.length/2)];d=a.length/2;return(c[d-1]+c[d])/2};
mxCoordinateAssignment.prototype.initialCoords=function(a,b){this.calculateWidestRank(a,b);for(var c=this.widestRank;0<=c;c--)c<b.maxRank&&this.rankCoordinates(c,a,b);for(c=this.widestRank+1;c<=b.maxRank;c++)0<c&&this.rankCoordinates(c,a,b)};
mxCoordinateAssignment.prototype.rankCoordinates=function(a,b,c){for(var b=c.ranks[a],c=0,d=this.initialX+(this.widestRankValue-this.rankWidths[a])/2,e=!1,f=0;f<b.length;f++){var g=b[f];if(g.isVertex()){var h=this.layout.getVertexBounds(g.cell);null!=h?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(g.width=h.width,g.height=h.height):(g.width=h.height,g.height=h.width):e=!0;c=Math.max(c,g.height)}else g.isEdge()&&(h=1,null!=g.edges?h=g.edges.length:mxLog.warn("edge.edges is null"),
g.width=(h-1)*this.parallelEdgeSpacing);d+=g.width/2;g.setX(a,d);g.setGeneralPurposeVariable(a,d);d+=g.width/2;d+=this.intraCellSpacing}!0==e&&mxLog.warn("At least one cell has no bounds")};
mxCoordinateAssignment.prototype.calculateWidestRank=function(a,b){var c=-this.interRankCellSpacing,d=0;this.rankWidths=[];this.rankY=[];for(var e=b.maxRank;0<=e;e--){for(var f=0,g=b.ranks[e],h=this.initialX,k=!1,l=0;l<g.length;l++){var m=g[l];if(m.isVertex()){var n=this.layout.getVertexBounds(m.cell);null!=n?this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(m.width=n.width,m.height=n.height):(m.width=n.height,m.height=n.width):k=!0;f=Math.max(f,m.height)}else m.isEdge()&&
(n=1,null!=m.edges?n=m.edges.length:mxLog.warn("edge.edges is null"),m.width=(n-1)*this.parallelEdgeSpacing);h+=m.width/2;m.setX(e,h);m.setGeneralPurposeVariable(e,h);h+=m.width/2;h+=this.intraCellSpacing;h>this.widestRankValue&&(this.widestRankValue=h,this.widestRank=e);this.rankWidths[e]=h}!0==k&&mxLog.warn("At least one cell has no bounds");this.rankY[e]=c;h=f/2+d/2+this.interRankCellSpacing;d=f;c=this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_WEST?c+h:c-
h;for(l=0;l<g.length;l++)g[l].setY(e,c)}};
mxCoordinateAssignment.prototype.minPath=function(a,b){var c=b.edgeMapper,d;for(d in c){var e=c[d];if(!(1>e.maxRank-e.minRank-1)){for(var f=e.getGeneralPurposeVariable(e.minRank+1),g=!0,h=0,k=e.minRank+2;k<e.maxRank;k++){var l=e.getGeneralPurposeVariable(k);f!=l?(g=!1,f=l):h++}if(!g){for(var g=f=0,l=[],m=[],n=e.getGeneralPurposeVariable(e.minRank+1),k=e.minRank+1;k<e.maxRank-1;k++){var o=e.getX(k+1);n==o?(l[k-e.minRank-1]=n,f++):this.repositionValid(b,e,k+1,n)?(l[k-e.minRank-1]=n,f++):n=l[k-e.minRank-
1]=o}n=e.getX(k);for(k=e.maxRank-1;k>e.minRank+1;k--)o=e.getX(k-1),n==o?(m[k-e.minRank-2]=n,g++):this.repositionValid(b,e,k-1,n)?(m[k-e.minRank-2]=n,g++):(m[k-e.minRank-2]=e.getX(k-1),n=o);if(g>h||f>h)if(g>=f)for(k=e.maxRank-2;k>e.minRank;k--)e.setX(k,m[k-e.minRank-1]);else if(f>g)for(k=e.minRank+2;k<e.maxRank;k++)e.setX(k,l[k-e.minRank-2])}}}};
mxCoordinateAssignment.prototype.repositionValid=function(a,b,c,d){for(var a=a.ranks[c],e=-1,f=0;f<a.length;f++)if(b==a[f]){e=f;break}if(0>e)return!1;f=b.getGeneralPurposeVariable(c);if(d<f){if(0==e)return!0;a=a[e-1];c=a.getGeneralPurposeVariable(c);c=c+a.width/2+this.intraCellSpacing+b.width/2;if(!(c<=d))return!1}else if(d>f){if(e==a.length-1)return!0;a=a[e+1];c=a.getGeneralPurposeVariable(c);c=c-a.width/2-this.intraCellSpacing-b.width/2;if(!(c>=d))return!1}return!0};
mxCoordinateAssignment.prototype.setCellLocations=function(a,b){this.rankTopY=[];this.rankBottomY=[];for(var c=0;c<b.ranks.length;c++)this.rankTopY[c]=Number.MAX_VALUE,this.rankBottomY[c]=0;c=null;this.layout.resizeParent&&(c={});var d=b.edgeMapper,e=b.vertexMapper,f;for(f in e){var g=e[f];this.setVertexLocation(g);if(this.layout.resizeParent){var g=a.model.getParent(g.cell),h=mxCellPath.create(g);null==c[h]&&(c[h]=g)}}this.layout.resizeParent&&null!=c&&this.adjustParents(c);(this.edgeStyle==mxHierarchicalEdgeStyle.ORTHOGONAL||
this.edgeStyle==mxHierarchicalEdgeStyle.POLYLINE||this.edgeStyle==mxHierarchicalEdgeStyle.CURVE)&&this.localEdgeProcessing(b);for(f in d)this.setEdgePosition(d[f])};mxCoordinateAssignment.prototype.adjustParents=function(a){var b=[],c;for(c in a)b.push(a[c]);this.layout.arrangeGroups(mxUtils.sortCells(b,!0),this.groupPadding)};
mxCoordinateAssignment.prototype.localEdgeProcessing=function(a){for(var b=0;b<a.ranks.length;b++)for(var c=a.ranks[b],d=0;d<c.length;d++){var e=c[d];if(e.isVertex())for(var f=e.getPreviousLayerConnectedCells(b),g=b-1,h=0;2>h;h++){if(-1<g&&g<a.ranks.length&&null!=f&&0<f.length){for(var k=[],l=0;l<f.length;l++){var m=new WeightedCellSorter(f[l],f[l].getX(g));k.push(m)}k.sort(WeightedCellSorter.prototype.compare);for(var m=e.x[0]-e.width/2,n=m+e.width,o=f=0,g=[],l=0;l<k.length;l++){var q=k[l].cell,
r;if(q.isVertex()){r=0==h?e.connectsAsSource:e.connectsAsTarget;for(var u=0;u<r.length;u++)if(r[u].source==q||r[u].target==q)f+=r[u].edges.length,o++,g.push(r[u])}else f+=q.edges.length,o++,g.push(q)}e.width>(f+1)*this.prefHozEdgeSep+2*this.prefHozEdgeSep&&(m+=this.prefHozEdgeSep,n-=this.prefHozEdgeSep);k=(n-m)/f;m+=k/2;n=this.minEdgeJetty-this.prefVertEdgeOff;for(l=o=0;l<g.length;l++){q=g[l].edges.length;u=mxCellPath.create(g[l].edges[0]);r=this.jettyPositions[u];null==r&&(r=[],this.jettyPositions[u]=
r);l<f/2?n+=this.prefVertEdgeOff:l>f/2&&(n-=this.prefVertEdgeOff);for(u=0;u<q;u++)r[4*u+2*h]=m,m+=k,r[4*u+2*h+1]=n;o=Math.max(o,n)}}f=e.getNextLayerConnectedCells(b);g=b+1}}};
mxCoordinateAssignment.prototype.setEdgePosition=function(a){var b=0;if(101207!=a.temp[0]){var c=a.maxRank,d=a.minRank;c==d&&(c=a.source.maxRank,d=a.target.minRank);for(var e=0,f=mxCellPath.create(a.edges[0]),f=this.jettyPositions[f],g=a.isReversed?a.target.cell:a.source.cell,h=this.layout.graph,k=0;k<a.edges.length;k++){var l=a.edges[k],m=this.layout.getVisibleTerminal(l,!0),n=h.model.getTerminal(l,!0),o=[],q=a.isReversed;m!=g&&(q=!q);if(null!=f){var r=q?2:0,u=q?this.rankTopY[d]:this.rankBottomY[c],
w=f[4*e+1+r];q&&(w=-w);u+=w;r=f[4*e+r];n=h.model.getTerminal(l,!0);this.layout.isPort(n)&&h.model.getParent(n)==m&&(r=h.view.getState(n),r=null!=r?r.x:m.geometry.x+a.source.width*n.geometry.x);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(o.push(new mxPoint(r,u)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&o.push(new mxPoint(r,u+w))):(o.push(new mxPoint(u,r)),this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&o.push(new mxPoint(u+w,r)))}r=a.x.length-
1;u=w=-1;m=a.maxRank-1;for(q&&(r=0,w=a.x.length,u=1,m=a.minRank+1);a.maxRank!=a.minRank&&r!=w;r+=u){var n=a.x[r]+b,v=(this.rankTopY[m]+this.rankBottomY[m+1])/2,x=(this.rankTopY[m-1]+this.rankBottomY[m])/2;if(q)var z=v,v=x,x=z;this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(o.push(new mxPoint(n,v)),o.push(new mxPoint(n,x))):(o.push(new mxPoint(v,n)),o.push(new mxPoint(x,n)));this.limitX=Math.max(this.limitX,n);m+=u}null!=f&&(r=q?2:0,u=q?this.rankBottomY[c]:
this.rankTopY[d],w=f[4*e+3-r],q&&(w=-w),u-=w,r=f[4*e+2-r],q=h.model.getTerminal(l,!1),m=this.layout.getVisibleTerminal(l,!1),this.layout.isPort(q)&&h.model.getParent(q)==m&&(r=h.view.getState(q),r=null!=r?r.x:m.geometry.x+a.target.width*q.geometry.x),this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&o.push(new mxPoint(r,u-w)),o.push(new mxPoint(r,u))):(this.edgeStyle==mxHierarchicalEdgeStyle.CURVE&&o.push(new mxPoint(u-
w,r)),o.push(new mxPoint(u,r))));a.isReversed&&this.processReversedEdge(a,l);this.layout.setEdgePoints(l,o);b=0==b?this.parallelEdgeSpacing:0<b?-b:-b+this.parallelEdgeSpacing;e++}a.temp[0]=101207}};
mxCoordinateAssignment.prototype.setVertexLocation=function(a){var b=a.cell,c=a.x[0]-a.width/2,d=a.y[0]-a.height/2;this.rankTopY[a.minRank]=Math.min(this.rankTopY[a.minRank],d);this.rankBottomY[a.minRank]=Math.max(this.rankBottomY[a.minRank],d+a.height);this.orientation==mxConstants.DIRECTION_NORTH||this.orientation==mxConstants.DIRECTION_SOUTH?this.layout.setVertexLocation(b,c,d):this.layout.setVertexLocation(b,d,c);this.limitX=Math.max(this.limitX,c+a.width)};
mxCoordinateAssignment.prototype.processReversedEdge=function(){};function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=!1;WeightedCellSorter.prototype.visited=!1;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(a,b){return null!=a&&null!=b?b.weightedValue>a.weightedValue?-1:b.weightedValue<a.weightedValue?1:b.nudge?-1:1:0};
function mxSwimlaneOrdering(a){this.layout=a}mxSwimlaneOrdering.prototype=new mxHierarchicalLayoutStage;mxSwimlaneOrdering.prototype.constructor=mxSwimlaneOrdering;mxSwimlaneOrdering.prototype.layout=null;
mxSwimlaneOrdering.prototype.execute=function(a){var a=this.layout.getModel(),b=mxUtils.clone(a.vertexMapper,null,!0),c=null;if(null!=a.roots)for(var d=a.roots,c=[],e=0;e<d.length;e++){var f=mxCellPath.create(d[e]);c[e]=a.vertexMapper[f]}a.visit(function(a,c,d,e,f){e=null!=a&&a.swimlaneIndex==c.swimlaneIndex&&c.isAncestor(a);f=null!=a&&null!=d&&a.swimlaneIndex<c.swimlaneIndex&&d.source==c;e?(d.invert(),mxUtils.remove(d,a.connectsAsSource),c.connectsAsSource.push(d),a.connectsAsTarget.push(d),mxUtils.remove(d,
c.connectsAsTarget)):f&&(d.invert(),mxUtils.remove(d,a.connectsAsTarget),c.connectsAsTarget.push(d),a.connectsAsSource.push(d),mxUtils.remove(d,c.connectsAsSource));a=mxCellPath.create(c.cell);delete b[a]},c,!0,null)};function mxHierarchicalLayout(a,b,c){mxGraphLayout.call(this,a);this.orientation=null!=b?b:mxConstants.DIRECTION_NORTH;this.deterministic=null!=c?c:!0}mxHierarchicalLayout.prototype=new mxGraphLayout;mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;
mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=!1;mxHierarchicalLayout.prototype.moveParent=!1;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;
mxHierarchicalLayout.prototype.fineTuning=!0;mxHierarchicalLayout.prototype.tightenToSource=!0;mxHierarchicalLayout.prototype.disableEdgeStyle=!0;mxHierarchicalLayout.prototype.traverseAncestors=!0;mxHierarchicalLayout.prototype.model=null;mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.getModel=function(){return this.model};
mxHierarchicalLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.model;this.edgesCache={};null!=b&&!(b instanceof Array)&&(b=[b]);if(!(null==b&&null==a)){if(null!=b&&null!=a){for(var d=[],e=0;e<b.length;e++)c.isAncestor(a,b[e])&&d.push(b[e]);this.roots=d}else this.roots=b;c.beginUpdate();try{this.run(a),this.resizeParent&&!this.graph.isCellCollapsed(a)&&this.graph.updateGroupBounds([a],this.parentBorder,this.moveParent)}finally{c.endUpdate()}}};
mxHierarchicalLayout.prototype.findRoots=function(a,b){var c=[];if(null!=a&&null!=b){var d=this.graph.model,e=null,f=-1E5,g;for(g in b){var h=b[g];if(d.isVertex(h)&&this.graph.isCellVisible(h)){for(var k=this.getEdges(h),l=0,m=0,n=0;n<k.length;n++)this.getVisibleTerminal(k[n],!0)==h?l++:m++;0==m&&0<l&&c.push(h);k=l-m;k>f&&(f=k,e=h)}}0==c.length&&null!=e&&c.push(e)}return c};
mxHierarchicalLayout.prototype.getEdges=function(a){var b=mxCellPath.create(a);if(null!=this.edgesCache[b])return this.edgesCache[b];for(var c=this.graph.model,d=[],e=this.graph.isCellCollapsed(a),f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g);if(this.isPort(h))d=d.concat(c.getEdges(h,!0,!0));else if(e||!this.graph.isCellVisible(h))d=d.concat(c.getEdges(h,!0,!0))}d=d.concat(c.getEdges(a,!0,!0));c=[];for(g=0;g<d.length;g++)e=this.getVisibleTerminal(d[g],!0),f=this.getVisibleTerminal(d[g],
!1),(e==f||e!=f&&(f==a&&(null==this.parent||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))||e==a&&(null==this.parent||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))))&&c.push(d[g]);return this.edgesCache[b]=c};mxHierarchicalLayout.prototype.getVisibleTerminal=function(a,b){var c=this.graph.view.getState(a),c=null!=c?c.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b);this.isPort(c)&&(c=this.graph.model.getParent(c));return c};
mxHierarchicalLayout.prototype.run=function(a){var b=[],c=[];if(null==this.roots&&null!=a){var d={};this.filterDescendants(a,d);this.roots=[];var e=!0,f;for(f in d)if(null!=d[f]){e=!1;break}for(;!e;){for(var g=this.findRoots(a,d),e=0;e<g.length;e++){var h={};b.push(h);this.traverse(g[e],!0,null,c,h,b,d)}for(e=0;e<g.length;e++)this.roots.push(g[e]);e=!0;for(f in d)if(null!=d[f]){e=!1;break}}}else for(e=0;e<this.roots.length;e++)h={},b.push(h),this.traverse(this.roots[e],!0,null,c,h,b,null);for(e=c=
0;e<b.length;e++){h=b[e];d=[];for(f in h)d.push(h[f]);this.model=new mxGraphHierarchyModel(this,d,this.roots,a,this.tightenToSource);this.cycleStage(a);this.layeringStage();this.crossingStage(a);c=this.placementStage(c,a)}};
mxHierarchicalLayout.prototype.filterDescendants=function(a,b){var c=this.graph.model;c.isVertex(a)&&a!=this.parent&&this.graph.isCellVisible(a)&&(b[mxCellPath.create(a)]=a);if(this.traverseAncestors||a==this.parent&&this.graph.isCellVisible(a))for(var d=c.getChildCount(a),e=0;e<d;e++){var f=c.getChildAt(a,e);this.isPort(f)||this.filterDescendants(f,b)}};mxHierarchicalLayout.prototype.isPort=function(a){return a.geometry.relative?!0:!1};
mxHierarchicalLayout.prototype.getEdgesBetween=function(a,b,c){for(var c=null!=c?c:!1,d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.getVisibleTerminal(d[f],!0),h=this.getVisibleTerminal(d[f],!1);(g==a&&h==b||!c&&g==b&&h==a)&&e.push(d[f])}return e};
mxHierarchicalLayout.prototype.traverse=function(a,b,c,d,e,f,g){if(null!=a&&null!=d){var h=mxCellPath.create(a);if(null==d[h]&&(null==g||null!=g[h])){null==e[h]&&(e[h]=a);null==d[h]&&(d[h]=a);null!==g&&delete g[h];for(var k=this.getEdges(a),c=0;c<k.length;c++)if(h=this.getVisibleTerminal(k[c],!0)==a,!b||h)h=this.getVisibleTerminal(k[c],!h),e=this.traverse(h,b,k[c],d,e,f,g)}else if(null==e[h])for(c=0;c<f.length;c++)if(a=f[c],null!=a[h]){for(k in e)a[k]=e[k];f.pop();return a}}return e};
mxHierarchicalLayout.prototype.cycleStage=function(a){(new mxMinimumCycleRemover(this)).execute(a)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(a){(new mxMedianHybridCrossingReduction(this)).execute(a)};
mxHierarchicalLayout.prototype.placementStage=function(a,b){var c=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);c.fineTuning=this.fineTuning;c.execute(b);return c.limitX+this.interHierarchySpacing};function mxSwimlaneLayout(a,b,c){mxGraphLayout.call(this,a);this.orientation=null!=b?b:mxConstants.DIRECTION_NORTH;this.deterministic=null!=c?c:!0}mxSwimlaneLayout.prototype=new mxGraphLayout;
mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout;mxSwimlaneLayout.prototype.roots=null;mxSwimlaneLayout.prototype.swimlanes=null;mxSwimlaneLayout.prototype.dummyVertices=null;mxSwimlaneLayout.prototype.dummyVertexWidth=50;mxSwimlaneLayout.prototype.resizeParent=!1;mxSwimlaneLayout.prototype.moveParent=!1;mxSwimlaneLayout.prototype.parentBorder=30;mxSwimlaneLayout.prototype.intraCellSpacing=30;mxSwimlaneLayout.prototype.interRankCellSpacing=100;
mxSwimlaneLayout.prototype.interHierarchySpacing=60;mxSwimlaneLayout.prototype.parallelEdgeSpacing=10;mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxSwimlaneLayout.prototype.fineTuning=!0;mxSwimlaneLayout.prototype.tightenToSource=!0;mxSwimlaneLayout.prototype.disableEdgeStyle=!0;mxSwimlaneLayout.prototype.traverseAncestors=!0;mxSwimlaneLayout.prototype.model=null;mxSwimlaneLayout.prototype.edgesCache=null;mxSwimlaneLayout.prototype.getModel=function(){return this.model};
mxSwimlaneLayout.prototype.execute=function(a,b){this.parent=a;var c=this.graph.model;this.edgesCache={};if(!(null==b||1>b.length)){null==a&&(a=c.getParent(b[0]));this.swimlanes=b;this.dummyVertices=[];for(var d=0;d<b.length;d++){var e=this.graph.getChildCells(b[d]);if(null==e||0==e.length)e=this.graph.insertVertex(b[d],null,null,0,0,this.dummyVertexWidth,0),this.dummyVertices.push(e)}c.beginUpdate();try{this.run(a),this.resizeParent&&!this.graph.isCellCollapsed(a)&&this.updateGroupBounds(),this.graph.removeCells(this.dummyVertices)}finally{c.endUpdate()}}};
mxSwimlaneLayout.prototype.updateGroupBounds=function(){var a=[],b=this.model,c;for(c in b.edgeMapper)for(var d=b.edgeMapper[c],e=0;e<d.edges.length;e++)a.push(d.edges[e]);a=this.graph.getBoundingBoxFromGeometry(a,!0);b=[];for(e=0;e<this.swimlanes.length;e++){var f=this.swimlanes[e];c=this.graph.getCellGeometry(f);if(null!=c){var g=this.graph.getChildCells(f),d=this.graph.isSwimlane(f)?this.graph.getStartSize(f):new mxRectangle,f=this.graph.getBoundingBoxFromGeometry(g);b[e]=f;d=f.y+c.y-d.height-
this.parentBorder;c=f.y+c.y+f.height;null==a?a=new mxRectangle(0,d,0,c-d):(a.y=Math.min(a.y,d),c=Math.max(a.y+a.height,c),a.height=c-a.y)}}for(e=0;e<this.swimlanes.length;e++)if(f=this.swimlanes[e],c=this.graph.getCellGeometry(f),null!=c){var g=this.graph.getChildCells(f),d=this.graph.isSwimlane(f)?this.graph.getStartSize(f):new mxRectangle,h=c.clone(),k=0==e?this.parentBorder:this.interRankCellSpacing/2;h.x+=b[e].x-d.width-k;h.y=h.y+a.y-c.y-this.parentBorder;h.width=b[e].width+d.width+this.interRankCellSpacing/
2+k;h.height=a.height+d.height+2*this.parentBorder;this.graph.model.setGeometry(f,h);this.graph.moveCells(g,-b[e].x+d.width+k,c.y-a.y+this.parentBorder)}};
mxSwimlaneLayout.prototype.findRoots=function(a,b){var c=[];if(null!=a&&null!=b){var d=this.graph.model,e=null,f=-1E5,g;for(g in b){var h=b[g];if(null!=h&&d.isVertex(h)&&this.graph.isCellVisible(h)&&d.isAncestor(a,h)){for(var k=this.getEdges(h),l=0,m=0,n=0;n<k.length;n++){var o=this.getVisibleTerminal(k[n],!0);o==h?(o=this.getVisibleTerminal(k[n],!1),d.isAncestor(a,o)&&l++):d.isAncestor(a,o)&&m++}0==m&&0<l&&c.push(h);k=l-m;k>f&&(f=k,e=h)}}0==c.length&&null!=e&&c.push(e)}return c};
mxSwimlaneLayout.prototype.getEdges=function(a){var b=mxCellPath.create(a);if(null!=this.edgesCache[b])return this.edgesCache[b];for(var c=this.graph.model,d=[],e=this.graph.isCellCollapsed(a),f=c.getChildCount(a),g=0;g<f;g++){var h=c.getChildAt(a,g);if(this.isPort(h))d=d.concat(c.getEdges(h,!0,!0));else if(e||!this.graph.isCellVisible(h))d=d.concat(c.getEdges(h,!0,!0))}d=d.concat(c.getEdges(a,!0,!0));c=[];for(g=0;g<d.length;g++)e=this.getVisibleTerminal(d[g],!0),f=this.getVisibleTerminal(d[g],!1),
(e==f||e!=f&&(f==a&&(null==this.parent||this.graph.isValidAncestor(e,this.parent,this.traverseAncestors))||e==a&&(null==this.parent||this.graph.isValidAncestor(f,this.parent,this.traverseAncestors))))&&c.push(d[g]);return this.edgesCache[b]=c};mxSwimlaneLayout.prototype.getVisibleTerminal=function(a,b){var c=this.graph.view.getState(a),c=null!=c?c.getVisibleTerminal(b):this.graph.view.getVisibleTerminal(a,b);this.isPort(c)&&(c=this.graph.model.getParent(c));return c};
mxSwimlaneLayout.prototype.run=function(a){var b=[],c=[];if(null!=this.swimlanes&&0<this.swimlanes.length&&null!=a){for(var d={},e=0;e<this.swimlanes.length;e++)this.filterDescendants(this.swimlanes[e],d);this.roots=[];var e=!0,f;for(f in d)if(null!=d[f]){e=!1;break}for(var g=0;!e&&g<this.swimlanes.length;){var h=this.findRoots(this.swimlanes[g],d);if(0==h.length)g++;else{for(e=0;e<h.length;e++){var k={};b.push(k);this.traverse(h[e],!0,null,c,k,b,d,g)}for(e=0;e<h.length;e++)this.roots.push(h[e]);
e=!0;for(f in d)if(null!=d[f]){e=!1;break}}}}else for(e=0;e<this.roots.length;e++)k={},b.push(k),this.traverse(this.roots[e],!0,null,c,k,b,null);b=[];for(f in c)b.push(c[f]);this.model=new mxSwimlaneModel(this,b,this.roots,a,this.tightenToSource);this.cycleStage(a);this.layeringStage();this.crossingStage(a);initialX=this.placementStage(0,a)};
mxSwimlaneLayout.prototype.filterDescendants=function(a,b){var c=this.graph.model;c.isVertex(a)&&a!=this.parent&&c.getParent(a)!=this.parent&&this.graph.isCellVisible(a)&&(b[mxCellPath.create(a)]=a);if(this.traverseAncestors||a==this.parent&&this.graph.isCellVisible(a))for(var d=c.getChildCount(a),e=0;e<d;e++){var f=c.getChildAt(a,e);this.isPort(f)||this.filterDescendants(f,b)}};mxSwimlaneLayout.prototype.isPort=function(a){return a.geometry.relative?!0:!1};
mxSwimlaneLayout.prototype.getEdgesBetween=function(a,b,c){for(var c=null!=c?c:!1,d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.getVisibleTerminal(d[f],!0),h=this.getVisibleTerminal(d[f],!1);(g==a&&h==b||!c&&g==b&&h==a)&&e.push(d[f])}return e};
mxSwimlaneLayout.prototype.traverse=function(a,b,c,d,e,f,g,h){if(null!=a&&null!=d){var k=mxCellPath.create(a);if(null==d[k]&&(null==g||null!=g[k])){null==e[k]&&(e[k]=a);null==d[k]&&(d[k]=a);null!==g&&delete g[k];for(var l=this.getEdges(a),k=this.graph.model,c=0;c<l.length;c++){var m=this.getVisibleTerminal(l[c],!0),n=m==a;n&&(m=this.getVisibleTerminal(l[c],!1));for(var o=0,o=0;o<this.swimlanes.length&&!k.isAncestor(this.swimlanes[o],m);o++);if(!(o>=this.swimlanes.length)&&(o>h||(!b||n)&&o==h))e=this.traverse(m,
b,l[c],d,e,f,g,o)}}else if(null==e[k])for(c=0;c<f.length;c++)if(a=f[c],null!=a[k]){for(l in e)a[l]=e[l];f.pop();return a}}return e};mxSwimlaneLayout.prototype.cycleStage=function(a){(new mxSwimlaneOrdering(this)).execute(a)};mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxSwimlaneLayout.prototype.crossingStage=function(a){(new mxMedianHybridCrossingReduction(this)).execute(a)};
mxSwimlaneLayout.prototype.placementStage=function(a,b){var c=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);c.fineTuning=this.fineTuning;c.execute(b);return c.limitX+this.interHierarchySpacing};function mxGraphModel(a){this.currentEdit=this.createUndoableEdit();null!=a?this.setRoot(a):this.clear()}mxGraphModel.prototype=new mxEventSource;mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;
mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=!0;mxGraphModel.prototype.createIds=!0;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=!1;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};
mxGraphModel.prototype.setCreateIds=function(a){this.createIds=a};mxGraphModel.prototype.createRoot=function(){var a=new mxCell;a.insert(new mxCell);return a};mxGraphModel.prototype.getCell=function(a){return null!=this.cells?this.cells[a]:null};mxGraphModel.prototype.filterCells=function(a,b){var c=null;if(null!=a)for(var c=[],d=0;d<a.length;d++)b(a[d])&&c.push(a[d]);return c};mxGraphModel.prototype.getDescendants=function(a){return this.filterDescendants(null,a)};
mxGraphModel.prototype.filterDescendants=function(a,b){var c=[],b=b||this.getRoot();(null==a||a(b))&&c.push(b);for(var d=this.getChildCount(b),e=0;e<d;e++)var f=this.getChildAt(b,e),c=c.concat(this.filterDescendants(a,f));return c};mxGraphModel.prototype.getRoot=function(a){var b=a||this.root;if(null!=a)for(;null!=a;)b=a,a=this.getParent(a);return b};mxGraphModel.prototype.setRoot=function(a){this.execute(new mxRootChange(this,a));return a};
mxGraphModel.prototype.rootChanged=function(a){var b=this.root;this.root=a;this.nextId=0;this.cells=null;this.cellAdded(a);return b};mxGraphModel.prototype.isRoot=function(a){return null!=a&&this.root==a};mxGraphModel.prototype.isLayer=function(a){return this.isRoot(this.getParent(a))};mxGraphModel.prototype.isAncestor=function(a,b){for(;null!=b&&b!=a;)b=this.getParent(b);return b==a};mxGraphModel.prototype.contains=function(a){return this.isAncestor(this.root,a)};
mxGraphModel.prototype.getParent=function(a){return null!=a?a.getParent():null};mxGraphModel.prototype.add=function(a,b,c){if(b!=a&&null!=a&&null!=b){null==c&&(c=this.getChildCount(a));var d=a!=this.getParent(b);this.execute(new mxChildChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParents(b)}return b};
mxGraphModel.prototype.cellAdded=function(a){if(null!=a){null==a.getId()&&this.createIds&&a.setId(this.createId(a));if(null!=a.getId()){var b=this.getCell(a.getId());if(b!=a){for(;null!=b;)a.setId(this.createId(a)),b=this.getCell(a.getId());null==this.cells&&(this.cells={});this.cells[a.getId()]=a}}mxUtils.isNumeric(a.getId())&&(this.nextId=Math.max(this.nextId,a.getId()));for(var b=this.getChildCount(a),c=0;c<b;c++)this.cellAdded(this.getChildAt(a,c))}};
mxGraphModel.prototype.createId=function(a){a=this.nextId;this.nextId++;return this.prefix+a+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(a,b){for(var b=b||this.getRoot(a),c=this.getChildCount(a),d=0;d<c;d++){var e=this.getChildAt(a,d);this.updateEdgeParents(e,b)}e=this.getEdgeCount(a);c=[];for(d=0;d<e;d++)c.push(this.getEdgeAt(a,d));for(d=0;d<c.length;d++)e=c[d],this.isAncestor(b,e)&&this.updateEdgeParent(e,b)};
mxGraphModel.prototype.updateEdgeParent=function(a,b){for(var c=this.getTerminal(a,!0),d=this.getTerminal(a,!1),e=null;null!=c&&!this.isEdge(c)&&null!=c.geometry&&c.geometry.relative;)c=this.getParent(c);for(;null!=d&&!this.isEdge(d)&&null!=d.geometry&&d.geometry.relative;)d=this.getParent(d);if(this.isAncestor(b,c)&&this.isAncestor(b,d)&&(e=c==d?this.getParent(c):this.getNearestCommonAncestor(c,d),null!=e&&(this.getParent(e)!=this.root||this.isAncestor(e,a))&&this.getParent(a)!=e)){c=this.getGeometry(a);
if(null!=c){var f=this.getOrigin(this.getParent(a)),g=this.getOrigin(e),d=g.x-f.x,f=g.y-f.y,c=c.clone();c.translate(-d,-f);this.setGeometry(a,c)}this.add(e,a,this.getChildCount(e))}};mxGraphModel.prototype.getOrigin=function(a){var b=null;null!=a?(b=this.getOrigin(this.getParent(a)),this.isEdge(a)||(a=this.getGeometry(a),null!=a&&(b.x+=a.x,b.y+=a.y))):b=new mxPoint;return b};
mxGraphModel.prototype.getNearestCommonAncestor=function(a,b){if(null!=a&&null!=b){var c=mxCellPath.create(b);if(null!=c&&0<c.length){var d=a,e=mxCellPath.create(d);if(c.length<e.length)var d=b,f=e,e=c,c=f;for(;null!=d;){f=this.getParent(d);if(0==c.indexOf(e+mxCellPath.PATH_SEPARATOR)&&null!=f)return d;e=mxCellPath.getParentPath(e);d=f}}}return null};mxGraphModel.prototype.remove=function(a){a==this.root?this.setRoot(null):null!=this.getParent(a)&&this.execute(new mxChildChange(this,null,a));return a};
mxGraphModel.prototype.cellRemoved=function(a){if(null!=a&&null!=this.cells){for(var b=this.getChildCount(a)-1;0<=b;b--)this.cellRemoved(this.getChildAt(a,b));null!=this.cells&&null!=a.getId()&&delete this.cells[a.getId()]}};mxGraphModel.prototype.parentForCellChanged=function(a,b,c){var d=this.getParent(a);null!=b?(b!=d||d.getIndex(a)!=c)&&b.insert(a,c):null!=d&&(c=d.getIndex(a),d.remove(c));!this.contains(d)&&null!=b?this.cellAdded(a):null==b&&this.cellRemoved(a);return d};
mxGraphModel.prototype.getChildCount=function(a){return null!=a?a.getChildCount():0};mxGraphModel.prototype.getChildAt=function(a,b){return null!=a?a.getChildAt(b):null};mxGraphModel.prototype.getChildren=function(a){return null!=a?a.children:null};mxGraphModel.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraphModel.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};
mxGraphModel.prototype.getChildCells=function(a,b,c){for(var b=null!=b?b:!1,c=null!=c?c:!1,d=this.getChildCount(a),e=[],f=0;f<d;f++){var g=this.getChildAt(a,f);(!c&&!b||c&&this.isEdge(g)||b&&this.isVertex(g))&&e.push(g)}return e};mxGraphModel.prototype.getTerminal=function(a,b){return null!=a?a.getTerminal(b):null};
mxGraphModel.prototype.setTerminal=function(a,b,c){var d=b!=this.getTerminal(a,c);this.execute(new mxTerminalChange(this,a,b,c));this.maintainEdgeParent&&d&&this.updateEdgeParent(a,this.getRoot());return b};mxGraphModel.prototype.setTerminals=function(a,b,c){this.beginUpdate();try{this.setTerminal(a,b,!0),this.setTerminal(a,c,!1)}finally{this.endUpdate()}};
mxGraphModel.prototype.terminalForCellChanged=function(a,b,c){var d=this.getTerminal(a,c);null!=b?b.insertEdge(a,c):null!=d&&d.removeEdge(a,c);return d};mxGraphModel.prototype.getEdgeCount=function(a){return null!=a?a.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(a,b){return null!=a?a.getEdgeAt(b):null};mxGraphModel.prototype.getDirectedEdgeCount=function(a,b,c){for(var d=0,e=this.getEdgeCount(a),f=0;f<e;f++){var g=this.getEdgeAt(a,f);g!=c&&this.getTerminal(g,b)==a&&d++}return d};
mxGraphModel.prototype.getConnections=function(a){return this.getEdges(a,!0,!0,!1)};mxGraphModel.prototype.getIncomingEdges=function(a){return this.getEdges(a,!0,!1,!1)};mxGraphModel.prototype.getOutgoingEdges=function(a){return this.getEdges(a,!1,!0,!1)};
mxGraphModel.prototype.getEdges=function(a,b,c,d){for(var b=null!=b?b:!0,c=null!=c?c:!0,d=null!=d?d:!0,e=this.getEdgeCount(a),f=[],g=0;g<e;g++){var h=this.getEdgeAt(a,g),k=this.getTerminal(h,!0),l=this.getTerminal(h,!1);(d&&k==l||k!=l&&(b&&l==a||c&&k==a))&&f.push(h)}return f};
mxGraphModel.prototype.getEdgesBetween=function(a,b,c){var c=null!=c?c:!1,d=this.getEdgeCount(a),e=this.getEdgeCount(b),f=a,g=d;e<d&&(g=e,f=b);d=[];for(e=0;e<g;e++){var h=this.getEdgeAt(f,e),k=this.getTerminal(h,!0),l=this.getTerminal(h,!1),m=l==a&&k==b;(k==a&&l==b||!c&&m)&&d.push(h)}return d};
mxGraphModel.prototype.getOpposites=function(a,b,c,d){var c=null!=c?c:!0,d=null!=d?d:!0,e=[];if(null!=a)for(var f=0;f<a.length;f++){var g=this.getTerminal(a[f],!0),h=this.getTerminal(a[f],!1);g==b&&null!=h&&h!=b&&d?e.push(h):h==b&&null!=g&&g!=b&&c&&e.push(g)}return e};mxGraphModel.prototype.getTopmostCells=function(a){for(var b=[],c=0;c<a.length;c++){for(var d=a[c],e=!0,f=this.getParent(d);null!=f;){if(0<=mxUtils.indexOf(a,f)){e=!1;break}f=this.getParent(f)}e&&b.push(d)}return b};
mxGraphModel.prototype.isVertex=function(a){return null!=a?a.isVertex():!1};mxGraphModel.prototype.isEdge=function(a){return null!=a?a.isEdge():!1};mxGraphModel.prototype.isConnectable=function(a){return null!=a?a.isConnectable():!1};mxGraphModel.prototype.getValue=function(a){return null!=a?a.getValue():null};mxGraphModel.prototype.setValue=function(a,b){this.execute(new mxValueChange(this,a,b));return b};mxGraphModel.prototype.valueForCellChanged=function(a,b){return a.valueChanged(b)};
mxGraphModel.prototype.getGeometry=function(a){return null!=a?a.getGeometry():null};mxGraphModel.prototype.setGeometry=function(a,b){b!=this.getGeometry(a)&&this.execute(new mxGeometryChange(this,a,b));return b};mxGraphModel.prototype.geometryForCellChanged=function(a,b){var c=this.getGeometry(a);a.setGeometry(b);return c};mxGraphModel.prototype.getStyle=function(a){return null!=a?a.getStyle():null};
mxGraphModel.prototype.setStyle=function(a,b){b!=this.getStyle(a)&&this.execute(new mxStyleChange(this,a,b));return b};mxGraphModel.prototype.styleForCellChanged=function(a,b){var c=this.getStyle(a);a.setStyle(b);return c};mxGraphModel.prototype.isCollapsed=function(a){return null!=a?a.isCollapsed():!1};mxGraphModel.prototype.setCollapsed=function(a,b){b!=this.isCollapsed(a)&&this.execute(new mxCollapseChange(this,a,b));return b};
mxGraphModel.prototype.collapsedStateForCellChanged=function(a,b){var c=this.isCollapsed(a);a.setCollapsed(b);return c};mxGraphModel.prototype.isVisible=function(a){return null!=a?a.isVisible():!1};mxGraphModel.prototype.setVisible=function(a,b){b!=this.isVisible(a)&&this.execute(new mxVisibleChange(this,a,b));return b};mxGraphModel.prototype.visibleStateForCellChanged=function(a,b){var c=this.isVisible(a);a.setVisible(b);return c};
mxGraphModel.prototype.execute=function(a){a.execute();this.beginUpdate();this.currentEdit.add(a);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",a));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",a));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));1==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.START_EDIT))};
mxGraphModel.prototype.endUpdate=function(){this.updateLevel--;0==this.updateLevel&&this.fireEvent(new mxEventObject(mxEvent.END_EDIT));if(!this.endingUpdate){this.endingUpdate=0==this.updateLevel;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var a=this.currentEdit;this.currentEdit=this.createUndoableEdit();a.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,
"edit",a))}}finally{this.endingUpdate=!1}}};mxGraphModel.prototype.createUndoableEdit=function(){var a=new mxUndoableEdit(this,!0);a.notify=function(){a.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",a,"changes",a.changes));a.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",a,"changes",a.changes))};return a};
mxGraphModel.prototype.mergeChildren=function(a,b,c){c=null!=c?c:!0;this.beginUpdate();try{var d={};this.mergeChildrenImpl(a,b,c,d);for(var e in d){var f=d[e],g=this.getTerminal(f,!0);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!0));g=this.getTerminal(f,!1);null!=g&&(g=d[mxCellPath.create(g)],this.setTerminal(f,g,!1))}}finally{this.endUpdate()}};
mxGraphModel.prototype.mergeChildrenImpl=function(a,b,c,d){this.beginUpdate();try{for(var e=a.getChildCount(),f=0;f<e;f++){var g=a.getChildAt(f);if("function"==typeof g.getId){var h=g.getId(),k=null!=h&&(!this.isEdge(g)||!c)?this.getCell(h):null;if(null==k){var l=g.clone();l.setId(h);l.setTerminal(g.getTerminal(!0),!0);l.setTerminal(g.getTerminal(!1),!1);k=b.insert(l);this.cellAdded(k)}d[mxCellPath.create(g)]=k;this.mergeChildrenImpl(g,k,c,d)}}}finally{this.endUpdate()}};
mxGraphModel.prototype.getParents=function(a){var b=[];if(null!=a)for(var c={},d=0;d<a.length;d++){var e=this.getParent(a[d]);if(null!=e){var f=mxCellPath.create(e);null==c[f]&&(c[f]=e,b.push(e))}}return b};mxGraphModel.prototype.cloneCell=function(a){return null!=a?this.cloneCells([a],!0)[0]:null};
mxGraphModel.prototype.cloneCells=function(a,b){for(var c={},d=[],e=0;e<a.length;e++)null!=a[e]?d.push(this.cloneCellImpl(a[e],c,b)):d.push(null);for(e=0;e<d.length;e++)null!=d[e]&&this.restoreClone(d[e],a[e],c);return d};mxGraphModel.prototype.cloneCellImpl=function(a,b,c){var d=this.cellCloned(a);b[mxObjectIdentity.get(a)]=d;if(c)for(var c=this.getChildCount(a),e=0;e<c;e++){var f=this.cloneCellImpl(this.getChildAt(a,e),b,!0);d.insert(f)}return d};mxGraphModel.prototype.cellCloned=function(a){return a.clone()};
mxGraphModel.prototype.restoreClone=function(a,b,c){var d=this.getTerminal(b,!0);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!0));d=this.getTerminal(b,!1);null!=d&&(d=c[mxObjectIdentity.get(d)],null!=d&&d.insertEdge(a,!1));for(var d=this.getChildCount(a),e=0;e<d;e++)this.restoreClone(this.getChildAt(a,e),this.getChildAt(b,e),c)};function mxRootChange(a,b){this.model=a;this.previous=this.root=b}mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};
function mxChildChange(a,b,c,d){this.model=a;this.previous=this.parent=b;this.child=c;this.previousIndex=this.index=d}
mxChildChange.prototype.execute=function(){var a=this.model.getParent(this.child),b=null!=a?a.getIndex(this.child):0;null==this.previous&&this.connect(this.child,!1);a=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);null!=this.previous&&this.connect(this.child,!0);this.parent=this.previous;this.previous=a;this.index=this.previousIndex;this.previousIndex=b};
mxChildChange.prototype.connect=function(a,b){var b=null!=b?b:!0,c=a.getTerminal(!0),d=a.getTerminal(!1);null!=c&&(b?this.model.terminalForCellChanged(a,c,!0):this.model.terminalForCellChanged(a,null,!0));null!=d&&(b?this.model.terminalForCellChanged(a,d,!1):this.model.terminalForCellChanged(a,null,!1));a.setTerminal(c,!0);a.setTerminal(d,!1);c=this.model.getChildCount(a);for(d=0;d<c;d++)this.connect(this.model.getChildAt(a,d),b)};
function mxTerminalChange(a,b,c,d){this.model=a;this.cell=b;this.previous=this.terminal=c;this.source=d}mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};function mxValueChange(a,b,c){this.model=a;this.cell=b;this.previous=this.value=c}mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};
function mxStyleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.style=c}mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};function mxGeometryChange(a,b,c){this.model=a;this.cell=b;this.previous=this.geometry=c}mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};
function mxCollapseChange(a,b,c){this.model=a;this.cell=b;this.previous=this.collapsed=c}mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};function mxVisibleChange(a,b,c){this.model=a;this.cell=b;this.previous=this.visible=c}mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};
function mxCellAttributeChange(a,b,c){this.cell=a;this.attribute=b;this.previous=this.value=c}mxCellAttributeChange.prototype.execute=function(){var a=this.cell.getAttribute(this.attribute);null==this.previous?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous);this.previous=a};function mxCell(a,b,c){this.value=a;this.setGeometry(b);this.setStyle(c);if(null!=this.onInit)this.onInit()}mxCell.prototype.id=null;mxCell.prototype.value=null;
mxCell.prototype.geometry=null;mxCell.prototype.style=null;mxCell.prototype.vertex=!1;mxCell.prototype.edge=!1;mxCell.prototype.connectable=!0;mxCell.prototype.visible=!0;mxCell.prototype.collapsed=!1;mxCell.prototype.parent=null;mxCell.prototype.source=null;mxCell.prototype.target=null;mxCell.prototype.children=null;mxCell.prototype.edges=null;mxCell.prototype.mxTransient="id,value,parent,source,target,children,edges".split(",");mxCell.prototype.getId=function(){return this.id};
mxCell.prototype.setId=function(a){this.id=a};mxCell.prototype.getValue=function(){return this.value};mxCell.prototype.setValue=function(a){this.value=a};mxCell.prototype.valueChanged=function(a){var b=this.getValue();this.setValue(a);return b};mxCell.prototype.getGeometry=function(){return this.geometry};mxCell.prototype.setGeometry=function(a){this.geometry=a};mxCell.prototype.getStyle=function(){return this.style};mxCell.prototype.setStyle=function(a){this.style=a};mxCell.prototype.isVertex=function(){return this.vertex};
mxCell.prototype.setVertex=function(a){this.vertex=a};mxCell.prototype.isEdge=function(){return this.edge};mxCell.prototype.setEdge=function(a){this.edge=a};mxCell.prototype.isConnectable=function(){return this.connectable};mxCell.prototype.setConnectable=function(a){this.connectable=a};mxCell.prototype.isVisible=function(){return this.visible};mxCell.prototype.setVisible=function(a){this.visible=a};mxCell.prototype.isCollapsed=function(){return this.collapsed};
mxCell.prototype.setCollapsed=function(a){this.collapsed=a};mxCell.prototype.getParent=function(){return this.parent};mxCell.prototype.setParent=function(a){this.parent=a};mxCell.prototype.getTerminal=function(a){return a?this.source:this.target};mxCell.prototype.setTerminal=function(a,b){b?this.source=a:this.target=a;return a};mxCell.prototype.getChildCount=function(){return null==this.children?0:this.children.length};mxCell.prototype.getIndex=function(a){return mxUtils.indexOf(this.children,a)};
mxCell.prototype.getChildAt=function(a){return null==this.children?null:this.children[a]};mxCell.prototype.insert=function(a,b){null!=a&&(null==b&&(b=this.getChildCount(),a.getParent()==this&&b--),a.removeFromParent(),a.setParent(this),null==this.children?(this.children=[],this.children.push(a)):this.children.splice(b,0,a));return a};mxCell.prototype.remove=function(a){var b=null;null!=this.children&&0<=a&&(b=this.getChildAt(a),null!=b&&(this.children.splice(a,1),b.setParent(null)));return b};
mxCell.prototype.removeFromParent=function(){null!=this.parent&&this.parent.remove(this.parent.getIndex(this))};mxCell.prototype.getEdgeCount=function(){return null==this.edges?0:this.edges.length};mxCell.prototype.getEdgeIndex=function(a){return mxUtils.indexOf(this.edges,a)};mxCell.prototype.getEdgeAt=function(a){return null==this.edges?null:this.edges[a]};
mxCell.prototype.insertEdge=function(a,b){if(null!=a&&(a.removeFromTerminal(b),a.setTerminal(this,b),null==this.edges||a.getTerminal(!b)!=this||0>mxUtils.indexOf(this.edges,a)))null==this.edges&&(this.edges=[]),this.edges.push(a);return a};mxCell.prototype.removeEdge=function(a,b){if(null!=a){if(a.getTerminal(!b)!=this&&null!=this.edges){var c=this.getEdgeIndex(a);0<=c&&this.edges.splice(c,1)}a.setTerminal(null,b)}return a};
mxCell.prototype.removeFromTerminal=function(a){var b=this.getTerminal(a);null!=b&&b.removeEdge(this,a)};mxCell.prototype.getAttribute=function(a,b){var c=this.getValue();return(null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT?c.getAttribute(a):null)||b};mxCell.prototype.setAttribute=function(a,b){var c=this.getValue();null!=c&&c.nodeType==mxConstants.NODETYPE_ELEMENT&&c.setAttribute(a,b)};
mxCell.prototype.clone=function(){var a=mxUtils.clone(this,this.mxTransient);a.setValue(this.cloneValue());return a};mxCell.prototype.cloneValue=function(){var a=this.getValue();null!=a&&("function"==typeof a.clone?a=a.clone():isNaN(a.nodeType)||(a=a.cloneNode(!0)));return a};function mxGeometry(a,b,c,d){mxRectangle.call(this,a,b,c,d)}mxGeometry.prototype=new mxRectangle;mxGeometry.prototype.constructor=mxGeometry;mxGeometry.prototype.TRANSLATE_CONTROL_POINTS=!0;
mxGeometry.prototype.alternateBounds=null;mxGeometry.prototype.sourcePoint=null;mxGeometry.prototype.targetPoint=null;mxGeometry.prototype.points=null;mxGeometry.prototype.offset=null;mxGeometry.prototype.relative=!1;
mxGeometry.prototype.swap=function(){if(null!=this.alternateBounds){var a=new mxRectangle(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x;this.y=this.alternateBounds.y;this.width=this.alternateBounds.width;this.height=this.alternateBounds.height;this.alternateBounds=a}};mxGeometry.prototype.getTerminalPoint=function(a){return a?this.sourcePoint:this.targetPoint};mxGeometry.prototype.setTerminalPoint=function(a,b){b?this.sourcePoint=a:this.targetPoint=a;return a};
mxGeometry.prototype.translate=function(a,b){this.clone();this.relative||(this.x+=a,this.y+=b);null!=this.sourcePoint&&(this.sourcePoint.x+=a,this.sourcePoint.y+=b);null!=this.targetPoint&&(this.targetPoint.x+=a,this.targetPoint.y+=b);if(this.TRANSLATE_CONTROL_POINTS&&null!=this.points)for(var c=this.points.length,d=0;d<c;d++){var e=this.points[d];null!=e&&(e.x+=a,e.y+=b)}};
var mxCellPath={PATH_SEPARATOR:".",create:function(a){var b="";if(null!=a)for(var c=a.getParent();null!=c;)b=c.getIndex(a)+mxCellPath.PATH_SEPARATOR+b,a=c,c=a.getParent();a=b.length;1<a&&(b=b.substring(0,a-1));return b},getParentPath:function(a){if(null!=a){var b=a.lastIndexOf(mxCellPath.PATH_SEPARATOR);if(0<=b)return a.substring(0,b);if(0<a.length)return""}return null},resolve:function(a,b){var c=a;if(null!=b)for(var d=b.split(mxCellPath.PATH_SEPARATOR),e=0;e<d.length;e++)c=c.getChildAt(parseInt(d[e]));
return c},compare:function(a,b){for(var c=Math.min(a.length,b.length),d=0,e=0;e<c;e++)if(a[e]!=b[e]){0==a[e].length||0==b[e].length?d=a[e]==b[e]?0:a[e]>b[e]?1:-1:(c=parseInt(a[e]),e=parseInt(b[e]),d=c==e?0:c>e?1:-1);break}0==d&&(c=a.length,e=b.length,c!=e&&(d=c>e?1:-1));return d}},mxPerimeter={RectanglePerimeter:function(a,b,c,d){var b=a.getCenterX(),e=a.getCenterY(),f=Math.atan2(c.y-e,c.x-b),g=new mxPoint(0,0),h=Math.PI,k=Math.PI/2-f,l=Math.atan2(a.height,a.width);f<-h+l||f>h-l?(g.x=a.x,g.y=e-a.width*
Math.tan(f)/2):f<-l?(g.y=a.y,g.x=b-a.height*Math.tan(k)/2):f<l?(g.x=a.x+a.width,g.y=e+a.width*Math.tan(f)/2):(g.y=a.y+a.height,g.x=b+a.height*Math.tan(k)/2);d&&(c.x>=a.x&&c.x<=a.x+a.width?g.x=c.x:c.y>=a.y&&c.y<=a.y+a.height&&(g.y=c.y),c.x<a.x?g.x=a.x:c.x>a.x+a.width&&(g.x=a.x+a.width),c.y<a.y?g.y=a.y:c.y>a.y+a.height&&(g.y=a.y+a.height));return g},EllipsePerimeter:function(a,b,c,d){var e=a.x,f=a.y,g=a.width/2,h=a.height/2,k=e+g,l=f+h,b=c.x,c=c.y,m=parseInt(b-k),n=parseInt(c-l);if(0==m&&0!=n)return new mxPoint(k,
l+h*n/Math.abs(n));if(0==m&&0==n)return new mxPoint(b,c);if(d){if(c>=f&&c<=f+a.height)return a=c-l,a=Math.sqrt(g*g*(1-a*a/(h*h)))||0,b<=e&&(a=-a),new mxPoint(k+a,c);if(b>=e&&b<=e+a.width)return a=b-k,a=Math.sqrt(h*h*(1-a*a/(g*g)))||0,c<=f&&(a=-a),new mxPoint(b,l+a)}e=n/m;l-=e*k;f=g*g*e*e+h*h;a=-2*k*f;h=Math.sqrt(a*a-4*f*(g*g*e*e*k*k+h*h*k*k-g*g*h*h));g=(-a+h)/(2*f);h=(-a-h)/(2*f);k=e*g+l;l=e*h+l;e=Math.sqrt(Math.pow(g-b,2)+Math.pow(k-c,2));b=Math.sqrt(Math.pow(h-b,2)+Math.pow(l-c,2));f=c=0;e<b?(c=
g,f=k):(c=h,f=l);return new mxPoint(c,f)},RhombusPerimeter:function(a,b,c,d){var b=a.x,e=a.y,f=a.width,a=a.height,g=b+f/2,h=e+a/2,k=c.x,c=c.y;if(g==k)return h>c?new mxPoint(g,e):new mxPoint(g,e+a);if(h==c)return g>k?new mxPoint(b,h):new mxPoint(b+f,h);var l=g,m=h;d&&(k>=b&&k<=b+f?l=k:c>=e&&c<=e+a&&(m=c));return k<g?c<h?mxUtils.intersection(k,c,l,m,g,e,b,h):mxUtils.intersection(k,c,l,m,g,e+a,b,h):c<h?mxUtils.intersection(k,c,l,m,g,e,b+f,h):mxUtils.intersection(k,c,l,m,g,e+a,b+f,h)},TrianglePerimeter:function(a,
b,c,d){var b=null!=b?b.style[mxConstants.STYLE_DIRECTION]:null,e=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_SOUTH,f=a.x,g=a.y,h=a.width,a=a.height,k=f+h/2,l=g+a/2,m=new mxPoint(f,g),n=new mxPoint(f+h,l),o=new mxPoint(f,g+a);b==mxConstants.DIRECTION_NORTH?(m=o,n=new mxPoint(k,g),o=new mxPoint(f+h,g+a)):b==mxConstants.DIRECTION_SOUTH?(n=new mxPoint(k,g+a),o=new mxPoint(f+h,g)):b==mxConstants.DIRECTION_WEST&&(m=new mxPoint(f+h,g),n=new mxPoint(f,l),o=new mxPoint(f+h,g+a));var q=c.x-k,r=
c.y-l,q=e?Math.atan2(q,r):Math.atan2(r,q),u=e?Math.atan2(h,a):Math.atan2(a,h),r=b==mxConstants.DIRECTION_NORTH||b==mxConstants.DIRECTION_WEST?q>-u&&q<u:q<-Math.PI+u||q>Math.PI-u,u=null;r?u=d&&(e&&c.x>=m.x&&c.x<=o.x||!e&&c.y>=m.y&&c.y<=o.y)?e?new mxPoint(c.x,m.y):new mxPoint(m.x,c.y):b==mxConstants.DIRECTION_NORTH?new mxPoint(f+h/2+a*Math.tan(q)/2,g+a):b==mxConstants.DIRECTION_SOUTH?new mxPoint(f+h/2-a*Math.tan(q)/2,g):b==mxConstants.DIRECTION_WEST?new mxPoint(f+h,g+a/2+h*Math.tan(q)/2):new mxPoint(f,
g+a/2-h*Math.tan(q)/2):(d&&(d=new mxPoint(k,l),c.y>=g&&c.y<=g+a?(d.x=e?k:b==mxConstants.DIRECTION_WEST?f+h:f,d.y=c.y):c.x>=f&&c.x<=f+h&&(d.x=c.x,d.y=!e?l:b==mxConstants.DIRECTION_NORTH?g+a:g),k=d.x,l=d.y),u=e&&c.x<=f+h/2||!e&&c.y<=g+a/2?mxUtils.intersection(c.x,c.y,k,l,m.x,m.y,n.x,n.y):mxUtils.intersection(c.x,c.y,k,l,n.x,n.y,o.x,o.y));null==u&&(u=new mxPoint(k,l));return u}};
function mxPrintPreview(a,b,c,d,e,f,g,h,k){this.graph=a;this.scale=null!=b?b:1/a.pageScale;this.border=null!=d?d:0;this.pageFormat=null!=c?c:a.pageFormat;this.title=null!=h?h:"Printer-friendly version";this.x0=null!=e?e:0;this.y0=null!=f?f:0;this.borderColor=g;this.pageSelector=null!=k?k:!0}mxPrintPreview.prototype.graph=null;mxPrintPreview.prototype.pageFormat=null;mxPrintPreview.prototype.scale=null;mxPrintPreview.prototype.border=0;mxPrintPreview.prototype.x0=0;mxPrintPreview.prototype.y0=0;
mxPrintPreview.prototype.autoOrigin=!0;mxPrintPreview.prototype.printOverlays=!1;mxPrintPreview.prototype.borderColor=null;mxPrintPreview.prototype.title=null;mxPrintPreview.prototype.pageSelector=null;mxPrintPreview.prototype.wnd=null;mxPrintPreview.prototype.pageCount=0;mxPrintPreview.prototype.getWindow=function(){return this.wnd};
mxPrintPreview.prototype.getDoctype=function(){var a="";5==document.documentMode?a='<meta http-equiv="X-UA-Compatible" content="IE=5">':8==document.documentMode?a='<meta http-equiv="X-UA-Compatible" content="IE=8">':9==document.documentMode&&(a='<meta http-equiv="X-UA-Compatible" content="IE=edge">');return a};
mxPrintPreview.prototype.open=function(a){var b=this.graph.cellRenderer.initializeOverlay,c=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=function(a,b){b.init(a.view.getDrawPane())});if(null==this.wnd){this.wnd=window.open();var d=this.wnd.document,e=this.getDoctype();null!=e&&0<e.length&&d.writeln(e);mxClient.IS_VML?d.writeln('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">'):d.writeln("<html>");d.writeln("<head>");this.writeHead(d,
a);d.writeln("</head>");d.writeln('<body class="mxPage">');var f=this.graph.getGraphBounds().clone(),g=this.graph.getView().getScale(),h=g/this.scale,k=this.graph.getView().getTranslate();this.autoOrigin||(this.x0=-k.x*this.scale,this.y0=-k.y*this.scale,f.width+=f.x,f.height+=f.y,f.x=0,this.border=f.y=0);f.width/=h;f.height/=h;var l=this.pageFormat.width-2*this.border,m=this.pageFormat.height-2*this.border,n=Math.max(1,Math.ceil((f.width+this.x0)/l)),o=Math.max(1,Math.ceil((f.height+this.y0)/m));
this.pageCount=n*o;var q=mxUtils.bind(this,function(){if(this.pageSelector&&(1<o||1<n)){var a=this.createPageSelector(o,n);d.body.appendChild(a);if(mxClient.IS_IE){a.style.position="absolute";var b=function(){a.style.top=d.body.scrollTop+10+"px"};mxEvent.addListener(this.wnd,"scroll",function(){b()});mxEvent.addListener(this.wnd,"resize",function(){b()})}}}),a=function(a,b){null!=this.borderColor&&(a.style.borderColor=this.borderColor,a.style.borderStyle="solid",a.style.borderWidth="1px");a.style.background=
"white";b&&(a.style.pageBreakAfter="always");mxClient.IS_IE?(d.writeln(a.outerHTML),a.parentNode.removeChild(a)):(a.parentNode.removeChild(a),d.body.appendChild(a));if(b){var c=d.createElement("hr");c.className="mxPageBreak";d.body.appendChild(c)}},r=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(null!=r)for(var u=0;u<r.length;u++)a(r[u],!0);for(var w=this.getAppendices(this.pageFormat.width,this.pageFormat.height),u=0;u<o;u++)for(var v=u*m/this.scale-this.y0/this.scale+(f.y-
k.y*g)/g,r=0;r<n;r++){if(null==this.wnd)return null;var x=r*l/this.scale-this.x0/this.scale+(f.x-k.x*g)/g,z=u*n+r+1,c=this.renderPage(this.pageFormat.width,this.pageFormat.height,mxUtils.bind(this,function(a){this.addGraphFragment(-x,-v,this.scale,z,a)}));c.setAttribute("id","mxPage-"+z);a(c,null!=w||u<o-1||r<n-1)}if(null!=w)for(u=0;u<w.length;u++)a(w[u],u<w.length);d.writeln("</body>");d.writeln("</html>");d.close();q();mxEvent.release(d.body)}this.wnd.focus()}catch(D){null!=c&&null!=c.parentNode&&
c.parentNode.removeChild(c)}finally{this.graph.cellRenderer.initializeOverlay=b}return this.wnd};
mxPrintPreview.prototype.writeHead=function(a,b){null!=this.title&&a.writeln("<title>"+this.title+"</title>");mxClient.IS_VML&&a.writeln('<style type="text/css">v\\:*{behavior:url(#default#VML)}o\\:*{behavior:url(#default#VML)}</style>');mxClient.link("stylesheet",mxClient.basePath+"/css/common.css",a);mxClient.IS_VML&&mxClient.link("stylesheet",mxClient.basePath+"/css/explorer.css",a);a.writeln('<style type="text/css">');a.writeln("@media print {");a.writeln("  table.mxPageSelector { display: none; }");
a.writeln("  hr.mxPageBreak { display: none; }");a.writeln("}");a.writeln("@media screen {");a.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }");a.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }");a.writeln("  body.mxPage { background: gray; }");a.writeln("}");null!=b&&a.writeln(b);a.writeln("</style>")};
mxPrintPreview.prototype.createPageSelector=function(a,b){var c=this.wnd.document,d=c.createElement("table");d.className="mxPageSelector";d.setAttribute("border","0");for(var e=c.createElement("tbody"),f=0;f<a;f++){for(var g=c.createElement("tr"),h=0;h<b;h++){var k=f*b+h+1,l=c.createElement("td"),m=c.createElement("a");m.setAttribute("href","#mxPage-"+k);mxClient.IS_NS&&!mxClient.IS_SF&&!mxClient.IS_GC&&m.setAttribute("onclick","var page = document.getElementById('mxPage-"+k+"');page.scrollIntoView(true);event.preventDefault();");
mxUtils.write(m,k,c);l.appendChild(m);g.appendChild(l)}e.appendChild(g)}d.appendChild(e);return d};
mxPrintPreview.prototype.renderPage=function(a,b,c){var d=document.createElement("div");try{d.style.width=a+"px";d.style.height=b+"px";d.style.overflow="hidden";d.style.pageBreakInside="avoid";8==document.documentMode&&(d.style.position="relative");var e=document.createElement("div");e.style.top=this.border+"px";e.style.left=this.border+"px";e.style.width=a-2*this.border+"px";e.style.height=b-2*this.border+"px";e.style.overflow="hidden";this.graph.dialect==mxConstants.DIALECT_VML&&(e.style.position=
"absolute");d.appendChild(e);document.body.appendChild(d);c(e)}catch(f){throw d.parentNode.removeChild(d),f;}return d};mxPrintPreview.prototype.getRoot=function(){var a=this.graph.view.currentRoot;null==a&&(a=this.graph.getModel().getRoot());return a};
mxPrintPreview.prototype.addGraphFragment=function(a,b,c,d,e){var d=this.graph.getView(),f=this.graph.container;this.graph.container=e;var g=d.getCanvas(),h=d.getBackgroundPane(),k=d.getDrawPane(),l=d.getOverlayPane();this.graph.dialect==mxConstants.DIALECT_SVG?d.createSvg():this.graph.dialect==mxConstants.DIALECT_VML?d.createVml():d.createHtml();var m=d.isEventsEnabled();d.setEventsEnabled(!1);var n=this.graph.isEnabled();this.graph.setEnabled(!1);var o=d.getTranslate();d.translate=new mxPoint(a,
b);a=null;try{var q=[this.getRoot()],a=new mxTemporaryCellStates(d,c,q)}finally{if(mxClient.IS_IE)d.overlayPane.innerHTML="";else for(c=e.firstChild;null!=c;)q=c.nextSibling,b=c.nodeName.toLowerCase(),"svg"==b?(c.setAttribute("width",parseInt(e.style.width)),c.setAttribute("height",parseInt(e.style.height))):"default"!=c.style.cursor&&"table"!=b&&c.parentNode.removeChild(c),c=q;d.overlayPane.parentNode.removeChild(d.overlayPane);this.graph.setEnabled(n);this.graph.container=f;d.canvas=g;d.backgroundPane=
h;d.drawPane=k;d.overlayPane=l;d.translate=o;a.destroy();d.setEventsEnabled(m)}};mxPrintPreview.prototype.getCoverPages=function(){return null};mxPrintPreview.prototype.getAppendices=function(){return null};mxPrintPreview.prototype.print=function(a){a=this.open(a);null!=a&&a.print()};mxPrintPreview.prototype.close=function(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)};
function mxStylesheet(){this.styles={};this.putDefaultVertexStyle(this.createDefaultVertexStyle());this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}
mxStylesheet.prototype.createDefaultVertexStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_RECTANGLE;a[mxConstants.STYLE_PERIMETER]=mxPerimeter.RectanglePerimeter;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_FILLCOLOR]="#C3D9FF";a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#774400";return a};
mxStylesheet.prototype.createDefaultEdgeStyle=function(){var a={};a[mxConstants.STYLE_SHAPE]=mxConstants.SHAPE_CONNECTOR;a[mxConstants.STYLE_ENDARROW]=mxConstants.ARROW_CLASSIC;a[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE;a[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_CENTER;a[mxConstants.STYLE_STROKECOLOR]="#6482B9";a[mxConstants.STYLE_FONTCOLOR]="#446299";return a};mxStylesheet.prototype.putDefaultVertexStyle=function(a){this.putCellStyle("defaultVertex",a)};
mxStylesheet.prototype.putDefaultEdgeStyle=function(a){this.putCellStyle("defaultEdge",a)};mxStylesheet.prototype.getDefaultVertexStyle=function(){return this.styles.defaultVertex};mxStylesheet.prototype.getDefaultEdgeStyle=function(){return this.styles.defaultEdge};mxStylesheet.prototype.putCellStyle=function(a,b){this.styles[a]=b};
mxStylesheet.prototype.getCellStyle=function(a,b){var c=b;if(null!=a&&0<a.length)for(var d=a.split(";"),c=null!=c&&";"!=a.charAt(0)?mxUtils.clone(c):{},e=0;e<d.length;e++){var f=d[e],g=f.indexOf("=");if(0<=g){var h=f.substring(0,g),f=f.substring(g+1);f==mxConstants.NONE?delete c[h]:mxUtils.isNumeric(f)?c[h]=parseFloat(f):c[h]=f}else if(f=this.styles[f],null!=f)for(h in f)c[h]=f[h]}return c};
function mxCellState(a,b,c){this.view=a;this.cell=b;this.style=c;this.origin=new mxPoint;this.absoluteOffset=new mxPoint}mxCellState.prototype=new mxRectangle;mxCellState.prototype.constructor=mxCellState;mxCellState.prototype.view=null;mxCellState.prototype.cell=null;mxCellState.prototype.style=null;mxCellState.prototype.invalid=!0;mxCellState.prototype.invalidOrder=!1;mxCellState.prototype.orderChanged=!1;mxCellState.prototype.origin=null;mxCellState.prototype.absolutePoints=null;
mxCellState.prototype.absoluteOffset=null;mxCellState.prototype.visibleSourceState=null;mxCellState.prototype.visibleTargetState=null;mxCellState.prototype.terminalDistance=0;mxCellState.prototype.length=0;mxCellState.prototype.segments=null;mxCellState.prototype.shape=null;mxCellState.prototype.text=null;
mxCellState.prototype.getPerimeterBounds=function(a,b){a=a||0;b=null!=b?b:new mxRectangle(this.x,this.y,this.width,this.height);if(null!=this.shape&&null!=this.shape.stencil){var c=this.shape.stencil.computeAspect(this.style,b.x,b.y,b.width,b.height);b.x=c.x;b.y=c.y;b.width=this.shape.stencil.w0*c.width;b.height=this.shape.stencil.h0*c.height}0!=a&&b.grow(a);return b};
mxCellState.prototype.setAbsoluteTerminalPoint=function(a,b){b?(null==this.absolutePoints&&(this.absolutePoints=[]),0==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[0]=a):null==this.absolutePoints?(this.absolutePoints=[],this.absolutePoints.push(null),this.absolutePoints.push(a)):1==this.absolutePoints.length?this.absolutePoints.push(a):this.absolutePoints[this.absolutePoints.length-1]=a};
mxCellState.prototype.setCursor=function(a){null!=this.shape&&this.shape.setCursor(a);null!=this.text&&this.text.setCursor(a)};mxCellState.prototype.getVisibleTerminal=function(a){a=this.getVisibleTerminalState(a);return null!=a?a.cell:null};mxCellState.prototype.getVisibleTerminalState=function(a){return a?this.visibleSourceState:this.visibleTargetState};mxCellState.prototype.setVisibleTerminalState=function(a,b){b?this.visibleSourceState=a:this.visibleTargetState=a};
mxCellState.prototype.destroy=function(){this.view.graph.cellRenderer.destroy(this)};
mxCellState.prototype.clone=function(){var a=new mxCellState(this.view,this.cell,this.style);if(null!=this.absolutePoints){a.absolutePoints=[];for(var b=0;b<this.absolutePoints.length;b++)a.absolutePoints[b]=this.absolutePoints[b].clone()}null!=this.origin&&(a.origin=this.origin.clone());null!=this.absoluteOffset&&(a.absoluteOffset=this.absoluteOffset.clone());null!=this.boundingBox&&(a.boundingBox=this.boundingBox.clone());a.terminalDistance=this.terminalDistance;a.segments=this.segments;a.length=
this.length;a.x=this.x;a.y=this.y;a.width=this.width;a.height=this.height;return a};function mxGraphSelectionModel(a){this.graph=a;this.cells=[]}mxGraphSelectionModel.prototype=new mxEventSource;mxGraphSelectionModel.prototype.constructor=mxGraphSelectionModel;mxGraphSelectionModel.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphSelectionModel.prototype.updatingSelectionResource="none"!=mxClient.language?"updatingSelection":"";mxGraphSelectionModel.prototype.graph=null;
mxGraphSelectionModel.prototype.singleSelection=!1;mxGraphSelectionModel.prototype.isSingleSelection=function(){return this.singleSelection};mxGraphSelectionModel.prototype.setSingleSelection=function(a){this.singleSelection=a};mxGraphSelectionModel.prototype.isSelected=function(a){return null!=a?0<=mxUtils.indexOf(this.cells,a):!1};mxGraphSelectionModel.prototype.isEmpty=function(){return 0==this.cells.length};mxGraphSelectionModel.prototype.clear=function(){this.changeSelection(null,this.cells)};
mxGraphSelectionModel.prototype.setCell=function(a){null!=a&&this.setCells([a])};mxGraphSelectionModel.prototype.setCells=function(a){if(null!=a){this.singleSelection&&(a=[this.getFirstSelectableCell(a)]);for(var b=[],c=0;c<a.length;c++)this.graph.isCellSelectable(a[c])&&b.push(a[c]);this.changeSelection(b,this.cells)}};mxGraphSelectionModel.prototype.getFirstSelectableCell=function(a){if(null!=a)for(var b=0;b<a.length;b++)if(this.graph.isCellSelectable(a[b]))return a[b];return null};
mxGraphSelectionModel.prototype.addCell=function(a){null!=a&&this.addCells([a])};mxGraphSelectionModel.prototype.addCells=function(a){if(null!=a){var b=null;this.singleSelection&&(b=this.cells,a=[this.getFirstSelectableCell(a)]);for(var c=[],d=0;d<a.length;d++)!this.isSelected(a[d])&&this.graph.isCellSelectable(a[d])&&c.push(a[d]);this.changeSelection(c,b)}};mxGraphSelectionModel.prototype.removeCell=function(a){null!=a&&this.removeCells([a])};
mxGraphSelectionModel.prototype.removeCells=function(a){if(null!=a){for(var b=[],c=0;c<a.length;c++)this.isSelected(a[c])&&b.push(a[c]);this.changeSelection(null,b)}};mxGraphSelectionModel.prototype.changeSelection=function(a,b){if(null!=a&&0<a.length&&null!=a[0]||null!=b&&0<b.length&&null!=b[0]){var c=new mxSelectionChange(this,a,b);c.execute();var d=new mxUndoableEdit(this,!1);d.add(c);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",d))}};
mxGraphSelectionModel.prototype.cellAdded=function(a){null!=a&&!this.isSelected(a)&&this.cells.push(a)};mxGraphSelectionModel.prototype.cellRemoved=function(a){null!=a&&(a=mxUtils.indexOf(this.cells,a),0<=a&&this.cells.splice(a,1))};function mxSelectionChange(a,b,c){this.selectionModel=a;this.added=null!=b?b.slice():null;this.removed=null!=c?c.slice():null}
mxSelectionChange.prototype.execute=function(){var a=mxLog.enter("mxSelectionChange.execute");window.status=mxResources.get(this.selectionModel.updatingSelectionResource)||this.selectionModel.updatingSelectionResource;if(null!=this.removed)for(var b=0;b<this.removed.length;b++)this.selectionModel.cellRemoved(this.removed[b]);if(null!=this.added)for(b=0;b<this.added.length;b++)this.selectionModel.cellAdded(this.added[b]);b=this.added;this.added=this.removed;this.removed=b;window.status=mxResources.get(this.selectionModel.doneResource)||
this.selectionModel.doneResource;mxLog.leave("mxSelectionChange.execute",a);this.selectionModel.fireEvent(new mxEventObject(mxEvent.CHANGE,"added",this.added,"removed",this.removed))};function mxCellEditor(a){this.graph=a}mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=!1;mxCellEditor.prototype.autoSize=!0;mxCellEditor.prototype.selectText=!0;
mxCellEditor.prototype.emptyLabelText="";mxCellEditor.prototype.textNode="";
mxCellEditor.prototype.init=function(){this.textarea=document.createElement("textarea");this.textarea.className="mxCellEditor";this.textarea.style.position="absolute";this.textarea.style.overflow="visible";this.textarea.setAttribute("cols","20");this.textarea.setAttribute("rows","4");mxClient.IS_NS&&(this.textarea.style.resize="none");mxEvent.addListener(this.textarea,"blur",mxUtils.bind(this,function(){this.focusLost()}));mxEvent.addListener(this.textarea,"change",mxUtils.bind(this,function(){this.setModified(!0)}));
mxEvent.addListener(this.textarea,"keydown",mxUtils.bind(this,function(a){mxEvent.isConsumed(a)||(113==a.keyCode||this.graph.isEnterStopsCellEditing()&&13==a.keyCode&&!mxEvent.isControlDown(a)&&!mxEvent.isShiftDown(a)?(this.graph.stopEditing(!1),mxEvent.consume(a)):27==a.keyCode?(this.graph.stopEditing(!0),mxEvent.consume(a)):(this.clearOnChange&&(this.clearOnChange=!1,this.textarea.value=""),this.setModified(!0)))}));this.changeHandler=mxUtils.bind(this,function(){null!=this.editingCell&&null==this.graph.getView().getState(this.editingCell)&&
this.stopEditing(!0)});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);mxEvent.addListener(this.textarea,!mxClient.IS_IE||9<=document.documentMode?"input":"keypress",mxUtils.bind(this,function(a){this.autoSize&&!mxEvent.isConsumed(a)&&setTimeout(mxUtils.bind(this,function(){this.resize()}),0)}))};mxCellEditor.prototype.isEventSource=function(a){return mxEvent.getSource(a)==this.textarea};
mxCellEditor.prototype.resize=function(){if(null!=this.textDiv){var a=this.graph.getView().getState(this.editingCell);if(null==a)this.stopEditing(!0);else{var b=this.graph.isLabelClipped(a.cell),c=this.graph.isWrapping(a.cell),d=this.graph.getModel().isEdge(a.cell),e=this.graph.getView().scale,f=parseInt(a.style[mxConstants.STYLE_SPACING]||0)*e,g=(parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*e+f,h=(parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*
e+f,k=(parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*e+f,e=(parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*e+f,g=new mxRectangle(a.x,a.y,a.width-e-h,a.height-g-k),g=null!=a.shape?a.shape.getLabelBounds(g):g;d?(this.bounds.x=a.absoluteOffset.x,this.bounds.y=a.absoluteOffset.y,this.bounds.width=0,this.bounds.height=0):null!=this.bounds&&(this.bounds.x=g.x,this.bounds.y=g.y,this.bounds.width=g.width,this.bounds.height=
g.height,d=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),d==mxConstants.ALIGN_LEFT?this.bounds.x-=a.width:d==mxConstants.ALIGN_RIGHT&&(this.bounds.x+=a.width),d=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),d==mxConstants.ALIGN_TOP?this.bounds.y-=a.height:d==mxConstants.ALIGN_BOTTOM&&(this.bounds.y+=a.height));d=this.textarea.value;if("\n"==d.charAt(d.length-1)||""==d)d+="&nbsp;";d=mxUtils.htmlEntities(d,!1);c?(this.textDiv.style.whiteSpace=
"normal",this.textDiv.style.width=this.bounds.width+"px"):d=d.replace(/ /g,"&nbsp;");d=d.replace(/\n/g,"<br/>");this.textDiv.innerHTML=d;d=this.textDiv.offsetWidth+30;g=this.textDiv.offsetHeight+16;d=Math.max(d,40);g=Math.max(g,20);b?(d=Math.min(this.bounds.width,d),g=Math.min(this.bounds.height,g)):c&&(d=Math.max(this.bounds.width,this.textDiv.scrollWidth));b=null!=a.text?a.text.margin:null;null==b&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),a=mxUtils.getValue(a.style,
mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE),b=mxUtils.getAlignmentAsPoint(b,a));null!=b&&(this.textarea.style.left=Math.max(0,Math.round(this.bounds.x-b.x*this.bounds.width+b.x*d)-3)+"px",this.textarea.style.top=Math.max(0,Math.round(this.bounds.y-b.y*this.bounds.height+b.y*g)+4)+"px");this.textarea.style.width=d+(this.textarea.offsetWidth-this.textarea.clientWidth+4)+"px";this.textarea.style.height=g+"px"}}};mxCellEditor.prototype.isModified=function(){return this.modified};
mxCellEditor.prototype.setModified=function(a){this.modified=a};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};
mxCellEditor.prototype.startEditing=function(a,b){null==this.textarea&&this.init();this.stopEditing(!0);var c=this.graph.getView().getState(a);if(null!=c){this.editingCell=a;this.trigger=b;this.textNode=null;null!=c.text&&this.isHideLabel(c)&&(this.textNode=c.text.node,this.textNode.style.visibility="hidden");var d=this.graph.getView().scale,d=mxUtils.getValue(c.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE)*d,e=mxUtils.getValue(c.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY),
f=mxUtils.getValue(c.style,mxConstants.STYLE_FONTCOLOR,"black"),g=mxUtils.getValue(c.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT),h=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD,k=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC,l=(mxUtils.getValue(c.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.fontSize=Math.round(d)+
"px";this.textarea.style.lineHeight=Math.round(d*mxConstants.LINE_HEIGHT)+"px";this.textarea.style.fontFamily=e;this.textarea.style.textAlign=g;this.textarea.style.color=f;this.textarea.style.fontWeight=h?"bold":"normal";this.textarea.style.fontStyle=k?"italic":"";this.textarea.style.textDecoration=l?"underline":"";this.textarea.style.overflow="auto";this.textarea.style.outline="none";this.bounds=d=this.getEditorBounds(c);this.textarea.style.left=d.x+"px";this.textarea.style.top=d.y+"px";this.textarea.style.width=
d.width+"px";this.textarea.style.height=d.height+"px";this.textarea.style.zIndex=5;c=this.getInitialValue(c,b);null==c||0==c.length?(c=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=!1;this.setModified(!1);this.textarea.value=c;this.graph.container.appendChild(this.textarea);"none"!=this.textarea.style.display&&(this.autoSize&&(this.textDiv=this.createTextDiv(),document.body.appendChild(this.textDiv),this.resize()),this.textarea.focus(),this.selectText&&(mxClient.IS_IOS?window.setTimeout(mxUtils.bind(this,
function(){this.textarea.setSelectionRange(0,9999)}),1):this.textarea.select()))}};
mxCellEditor.prototype.createTextDiv=function(){var a=document.createElement("div"),b=a.style;b.position="absolute";b.whiteSpace="nowrap";b.visibility="hidden";b.display=mxClient.IS_QUIRKS?"inline":"inline-block";b.zoom="1";b.verticalAlign="top";b.lineHeight=this.textarea.style.lineHeight;b.fontSize=this.textarea.style.fontSize;b.fontFamily=this.textarea.style.fontFamily;b.fontWeight=this.textarea.style.fontWeight;b.textAlign=this.textarea.style.textAlign;b.fontStyle=this.textarea.style.fontStyle;
b.textDecoration=this.textarea.style.textDecoration;return a};mxCellEditor.prototype.stopEditing=function(a){null!=this.editingCell&&(null!=this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null),!a&&this.isModified()&&this.graph.labelChanged(this.editingCell,this.getCurrentValue(),this.trigger),null!=this.textDiv&&(document.body.removeChild(this.textDiv),this.textDiv=null),this.bounds=this.trigger=this.editingCell=null,this.textarea.blur(),this.textarea.parentNode.removeChild(this.textarea))};
mxCellEditor.prototype.getInitialValue=function(a,b){return this.graph.getEditingValue(a.cell,b)};mxCellEditor.prototype.getCurrentValue=function(){return this.textarea.value.replace(/\r/g,"")};mxCellEditor.prototype.isHideLabel=function(){return!0};mxCellEditor.prototype.getMinimumSize=function(a){var b=this.graph.getView().scale;return new mxRectangle(0,0,null==a.text?30:a.text.size*b+20,"left"==this.textarea.style.textAlign?120:40)};
mxCellEditor.prototype.getEditorBounds=function(a){var b=this.graph.getModel().isEdge(a.cell),c=this.graph.getView().scale,d=this.getMinimumSize(a),e=d.width,d=d.height,f=parseInt(a.style[mxConstants.STYLE_SPACING]||0)*c,g=(parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*c+f,h=(parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*c+f,k=(parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*
c+f,c=(parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*c+f,h=new mxRectangle(a.x,a.y,Math.max(e,a.width-c-h),Math.max(d,a.height-g-k)),h=null!=a.shape?a.shape.getLabelBounds(h):h;b?(h.x=a.absoluteOffset.x,h.y=a.absoluteOffset.y,null!=a.text&&null!=a.text.boundingBox&&(0<a.text.boundingBox.x&&(h.x=a.text.boundingBox.x),0<a.text.boundingBox.y&&(h.y=a.text.boundingBox.y))):null!=a.text&&null!=a.text.boundingBox&&(h.x=Math.min(h.x,a.text.boundingBox.x),h.y=Math.min(h.y,
a.text.boundingBox.y));h.x+=c;h.y+=g;null!=a.text&&null!=a.text.boundingBox&&(b?(h.width=Math.max(e,a.text.boundingBox.width),h.height=Math.max(d,a.text.boundingBox.height)):(h.width=Math.max(h.width,a.text.boundingBox.width),h.height=Math.max(h.height,a.text.boundingBox.height)));this.graph.getModel().isVertex(a.cell)&&(b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER),b==mxConstants.ALIGN_LEFT?h.x-=a.width:b==mxConstants.ALIGN_RIGHT&&(h.x+=a.width),b=mxUtils.getValue(a.style,
mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE),b==mxConstants.ALIGN_TOP?h.y-=a.height:b==mxConstants.ALIGN_BOTTOM&&(h.y+=a.height));return h};mxCellEditor.prototype.getEmptyLabelText=function(){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};
mxCellEditor.prototype.destroy=function(){null!=this.textarea&&(mxEvent.release(this.textarea),null!=this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null,null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.changeHandler=null))};function mxCellRenderer(){}mxCellRenderer.prototype.defaultEdgeShape=mxConnector;mxCellRenderer.prototype.defaultVertexShape=mxRectangleShape;mxCellRenderer.prototype.defaultTextShape=mxText;
mxCellRenderer.prototype.legacyControlPosition=!0;mxCellRenderer.prototype.defaultShapes={};mxCellRenderer.registerShape=function(a,b){mxCellRenderer.prototype.defaultShapes[a]=b};mxCellRenderer.registerShape(mxConstants.SHAPE_RECTANGLE,mxRectangleShape);mxCellRenderer.registerShape(mxConstants.SHAPE_ELLIPSE,mxEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_RHOMBUS,mxRhombus);mxCellRenderer.registerShape(mxConstants.SHAPE_CYLINDER,mxCylinder);
mxCellRenderer.registerShape(mxConstants.SHAPE_CONNECTOR,mxConnector);mxCellRenderer.registerShape(mxConstants.SHAPE_ACTOR,mxActor);mxCellRenderer.registerShape(mxConstants.SHAPE_TRIANGLE,mxTriangle);mxCellRenderer.registerShape(mxConstants.SHAPE_HEXAGON,mxHexagon);mxCellRenderer.registerShape(mxConstants.SHAPE_CLOUD,mxCloud);mxCellRenderer.registerShape(mxConstants.SHAPE_LINE,mxLine);mxCellRenderer.registerShape(mxConstants.SHAPE_ARROW,mxArrow);
mxCellRenderer.registerShape(mxConstants.SHAPE_DOUBLE_ELLIPSE,mxDoubleEllipse);mxCellRenderer.registerShape(mxConstants.SHAPE_SWIMLANE,mxSwimlane);mxCellRenderer.registerShape(mxConstants.SHAPE_IMAGE,mxImageShape);mxCellRenderer.registerShape(mxConstants.SHAPE_LABEL,mxLabel);
mxCellRenderer.prototype.initialize=function(a,b){var c=a.view.graph.getModel();if(null!=a.view.graph.container&&null==a.shape&&a.cell!=a.view.currentRoot&&(c.isVertex(a.cell)||c.isEdge(a.cell)))if(this.createShape(a),null!=a.shape&&(null==b||b))this.initializeShape(a),a.view.graph.ordered||c.isEdge(a.cell)?a.invalidOrder=!0:a.view.graph.keepEdgesInForeground&&null!=this.firstEdge&&(this.firstEdge.parentNode==a.shape.node.parentNode?this.insertState(a,this.firstEdge):this.firstEdge=null),a.shape.scale=
a.view.scale,this.createCellOverlays(a),this.installListeners(a)};mxCellRenderer.prototype.initializeShape=function(a){a.shape.init(a.view.getDrawPane())};mxCellRenderer.prototype.getPreviousStateInContainer=function(a,b){for(var c=null,d=a.view.graph,e=d.getModel(),f=a.cell,g=e.getParent(f);null!=g&&null==c;)c=this.findPreviousStateInContainer(d,g,f,b),f=g,g=e.getParent(f);return c};
mxCellRenderer.prototype.findPreviousStateInContainer=function(a,b,c,d){for(var e=null,f=a.getModel(),c=null!=c?b.getIndex(c)-1:f.getChildCount(b)-1;0<=c&&null==e;c--)e=this.findPreviousStateInContainer(a,f.getChildAt(b,c),null,d);if(null==e&&(e=a.view.getState(b),null!=e&&(null==e.shape||null==e.shape.node||e.shape.node.parentNode!=d)))e=null;return e};
mxCellRenderer.prototype.order=function(a){var b=a.shape.node.parentNode,c=this.getPreviousStateInContainer(a,b),d=b.firstChild;null!=c&&(d=c.shape.node,null!=c.text&&null!=c.text.node&&c.text.node.parentNode==b&&(d=c.text.node),d=d.nextSibling);this.insertState(a,d)};
mxCellRenderer.prototype.orderEdge=function(a){var b=a.view,c=b.graph.getModel();if(b.graph.keepEdgesInForeground){if(null==this.firstEdge||null==this.firstEdge.parentNode||this.firstEdge.parentNode!=a.shape.node.parentNode)this.firstEdge=a.shape.node}else if(b.graph.keepEdgesInBackground){var d=a.shape.node,e=d.parentNode,c=c.getParent(a.cell),b=b.getState(c),e=null!=b&&null!=b.shape&&null!=b.shape.node?b.shape.node.nextSibling:e.firstChild;null!=e&&e!=d&&this.insertState(a,e)}};
mxCellRenderer.prototype.insertState=function(a,b){a.shape.node.parentNode.insertBefore(a.shape.node,b);null!=a.text&&null!=a.text.node&&a.text.node.parentNode==a.shape.node.parentNode&&a.shape.node.parentNode.insertBefore(a.text.node,a.shape.node.nextSibling)};
mxCellRenderer.prototype.createShape=function(a){if(null!=a.style){var b=mxStencilRegistry.getStencil(a.style[mxConstants.STYLE_SHAPE]);null!=b?a.shape=new mxShape(b):(b=this.getShapeConstructor(a),a.shape=new b);a.shape.points=a.absolutePoints;a.shape.bounds=new mxRectangle(a.x,a.y,a.width,a.height);a.shape.dialect=a.view.graph.dialect;this.configureShape(a)}};mxCellRenderer.prototype.getShape=function(a){return null!=a?mxCellRenderer.prototype.defaultShapes[a]:null};
mxCellRenderer.prototype.getShapeConstructor=function(a){var b=this.getShape(a.style[mxConstants.STYLE_SHAPE]);null==b&&(b=a.view.graph.getModel().isEdge(a.cell)?this.defaultEdgeShape:this.defaultVertexShape);return b};
mxCellRenderer.prototype.configureShape=function(a){a.shape.apply(a);a.shape.image=a.view.graph.getImage(a);a.shape.indicatorShape=this.getShape(a.view.graph.getIndicatorShape(a));a.shape.indicatorColor=a.view.graph.getIndicatorColor(a);a.shape.indicatorGradientColor=a.view.graph.getIndicatorGradientColor(a);a.shape.indicatorDirection=a.style[mxConstants.STYLE_INDICATOR_DIRECTION];a.shape.indicatorImage=a.view.graph.getIndicatorImage(a);this.postConfigureShape(a)};
mxCellRenderer.prototype.postConfigureShape=function(a){null!=a.shape&&(this.resolveColor(a,"indicatorColor",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"indicatorGradientColor",mxConstants.STYLE_GRADIENTCOLOR),this.resolveColor(a,"fill",mxConstants.STYLE_FILLCOLOR),this.resolveColor(a,"stroke",mxConstants.STYLE_STROKECOLOR),this.resolveColor(a,"gradient",mxConstants.STYLE_GRADIENTCOLOR))};
mxCellRenderer.prototype.resolveColor=function(a,b,c){var d=a.shape[b],e=a.view.graph,f=null;"inherit"==d?f=e.model.getParent(a.cell):"swimlane"==d?(f=null!=e.model.getTerminal(a.cell,!1)?e.model.getTerminal(a.cell,!1):a.cell,f=e.getSwimlane(f),c=e.swimlaneIndicatorColorAttribute):"indicated"==d&&(a.shape[b]=a.shape.indicatorColor);null!=f&&(d=e.getView().getState(f),a.shape[b]=null,null!=d&&(a.shape[b]=null!=d.shape&&"indicatorColor"!=b?d.shape[b]:d.style[c]))};
mxCellRenderer.prototype.getLabelValue=function(a){return a.view.graph.getLabel(a.cell)};
mxCellRenderer.prototype.createLabel=function(a,b){var c=a.view.graph;c.getModel().isEdge(a.cell);if(0<a.style[mxConstants.STYLE_FONTSIZE]||null==a.style[mxConstants.STYLE_FONTSIZE]){var d=c.isHtmlLabel(a.cell)||null!=b&&mxUtils.isNode(b);a.text=new this.defaultTextShape(b,new mxRectangle,a.style[mxConstants.STYLE_ALIGN]||mxConstants.ALIGN_CENTER,c.getVerticalAlign(a),a.style[mxConstants.STYLE_FONTCOLOR],a.style[mxConstants.STYLE_FONTFAMILY],a.style[mxConstants.STYLE_FONTSIZE],a.style[mxConstants.STYLE_FONTSTYLE],
a.style[mxConstants.STYLE_SPACING],a.style[mxConstants.STYLE_SPACING_TOP],a.style[mxConstants.STYLE_SPACING_RIGHT],a.style[mxConstants.STYLE_SPACING_BOTTOM],a.style[mxConstants.STYLE_SPACING_LEFT],a.style[mxConstants.STYLE_HORIZONTAL],a.style[mxConstants.STYLE_LABEL_BACKGROUNDCOLOR],a.style[mxConstants.STYLE_LABEL_BORDERCOLOR],c.isWrapping(a.cell)&&c.isHtmlLabel(a.cell),c.isLabelClipped(a.cell),a.style[mxConstants.STYLE_OVERFLOW],a.style[mxConstants.STYLE_LABEL_PADDING]);a.text.opacity=mxUtils.getValue(a.style,
mxConstants.STYLE_TEXT_OPACITY,100);a.text.dialect=d?mxConstants.DIALECT_STRICTHTML:a.view.graph.dialect;a.text.state=a;this.initializeLabel(a);var e=!1,f=function(b){var d=a;if(mxClient.IS_TOUCH||e)d=mxEvent.getClientX(b),b=mxEvent.getClientY(b),b=mxUtils.convertPoint(c.container,d,b),d=c.view.getState(c.getCellAt(b.x,b.y));return d};mxEvent.addGestureListeners(a.text.node,mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,a)),e=c.dialect!=
mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(b).nodeName)}),mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&c.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,f(b)))}),mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b,f(b))),e=!1)}));c.nativeDblClickEnabled&&mxEvent.addListener(a.text.node,"dblclick",mxUtils.bind(this,function(b){this.isLabelEvent(a,b)&&(c.dblClick(b,a.cell),mxEvent.consume(b))}))}};
mxCellRenderer.prototype.initializeLabel=function(a){var b=a.view.graph;a.text.dialect!=mxConstants.DIALECT_SVG&&(mxClient.IS_SVG&&mxClient.NO_FO?a.text.init(b.container):mxUtils.isVml(a.view.getDrawPane())&&(null!=a.shape.label?a.text.init(a.shape.label):a.text.init(a.shape.node)));null==a.text.node&&(a.text.init(a.view.getDrawPane()),null!=a.shape&&null!=a.text&&a.shape.node.parentNode.insertBefore(a.text.node,a.shape.node.nextSibling))};
mxCellRenderer.prototype.createCellOverlays=function(a){var b=a.view.graph.getCellOverlays(a.cell),c=null;if(null!=b)for(var c=new mxDictionary,d=0;d<b.length;d++){var e=null!=a.overlays?a.overlays.remove(b[d]):null;null==e&&(e=new mxImageShape(new mxRectangle,b[d].image.src),e.dialect=a.view.graph.dialect,e.preserveImageAspect=!1,e.overlay=b[d],this.initializeOverlay(a,e),this.installCellOverlayListeners(a,b[d],e),null!=b[d].cursor&&(e.node.style.cursor=b[d].cursor));c.put(b[d],e)}null!=a.overlays&&
a.overlays.visit(function(a,b){b.destroy()});a.overlays=c};mxCellRenderer.prototype.initializeOverlay=function(a,b){b.init(a.view.getOverlayPane())};
mxCellRenderer.prototype.installCellOverlayListeners=function(a,b,c){var d=a.view.graph;mxEvent.addListener(c.node,"click",function(c){d.isEditing()&&d.stopEditing(!d.isInvokesStopCellEditing());b.fireEvent(new mxEventObject(mxEvent.CLICK,"event",c,"cell",a.cell))});mxEvent.addGestureListeners(c.node,function(a){mxEvent.consume(a)},function(b){d.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,a))});mxClient.IS_TOUCH&&mxEvent.addListener(c.node,"touchend",function(c){b.fireEvent(new mxEventObject(mxEvent.CLICK,
"event",c,"cell",a.cell))})};
mxCellRenderer.prototype.createControl=function(a){var b=a.view.graph,c=b.getFoldingImage(a);if(b.foldingEnabled&&null!=c){if(null==a.control){var d=new mxRectangle(0,0,c.width,c.height);a.control=new mxImageShape(d,c.src);a.control.preserveImageAspect=!1;a.control.dialect=b.dialect;this.initControl(a,a.control,!0,function(c){if(b.isEnabled()){var d=!b.isCellCollapsed(a.cell);b.foldCells(d,!1,[a.cell]);mxEvent.consume(c)}})}}else null!=a.control&&(a.control.destroy(),a.control=null)};
mxCellRenderer.prototype.initControl=function(a,b,c,d){var e=a.view.graph;e.isHtmlLabel(a.cell)&&mxClient.NO_FO&&e.dialect==mxConstants.DIALECT_SVG?(b.dialect=mxConstants.DIALECT_PREFERHTML,b.init(e.container),b.node.style.zIndex=1):b.init(a.view.getOverlayPane());b=b.innerNode||b.node;d&&(e.isEnabled()&&(b.style.cursor="pointer"),mxEvent.addListener(b,"click",d));c&&mxEvent.addGestureListeners(b,function(b){e.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b,a));mxEvent.consume(b)},function(b){e.fireMouseEvent(mxEvent.MOUSE_MOVE,
new mxMouseEvent(b,a))});return b};mxCellRenderer.prototype.isShapeEvent=function(){return!0};mxCellRenderer.prototype.isLabelEvent=function(){return!0};
mxCellRenderer.prototype.installListeners=function(a){var b=a.view.graph,c=function(c){var d=a;if(b.dialect!=mxConstants.DIALECT_SVG&&"IMG"==mxEvent.getSource(c).nodeName||mxClient.IS_TOUCH)d=mxEvent.getClientX(c),c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b.container,d,c),d=b.view.getState(b.getCellAt(c.x,c.y));return d},d=!1;mxClient.IS_TOUCH&&(mxEvent.addListener(a.shape.node,"gesturestart",mxUtils.bind(this,function(a){b.lastTouchTime=0;d=!0;mxEvent.consume(a)})),mxEvent.addListener(a.shape.node,
"gestureend",mxUtils.bind(this,function(c){d=!1;b.fireGestureEvent(c,a.cell);mxEvent.consume(c)})));mxEvent.addGestureListeners(a.shape.node,mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&!d?b.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(c,null!=a.shape&&mxEvent.getSource(c)==a.shape.content?null:a)):d&&mxEvent.consume(c)}),mxUtils.bind(this,function(e){this.isShapeEvent(a,e)&&!d?b.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(e,null!=a.shape&&mxEvent.getSource(e)==a.shape.content?
null:c(e))):d&&mxEvent.consume(e)}),mxUtils.bind(this,function(e){this.isShapeEvent(a,e)&&!d?b.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(e,null!=a.shape&&mxEvent.getSource(e)==a.shape.content?null:c(e))):d&&mxEvent.consume(e)}));b.nativeDblClickEnabled&&mxEvent.addListener(a.shape.node,"dblclick",mxUtils.bind(this,function(c){this.isShapeEvent(a,c)&&(b.dblClick(c,a.cell),mxEvent.consume(c))}))};
mxCellRenderer.prototype.redrawLabel=function(a,b){var c=this.getLabelValue(a);if(null==a.text&&null!=c&&(mxUtils.isNode(c)||0<c.length))this.createLabel(a,c);else if(null!=a.text&&(null==c||0==c.length))a.text.destroy(),a.text=null;if(null!=a.text){var d=a.view.graph,e=d.isWrapping(a.cell),d=d.isLabelClipped(a.cell),f=this.getLabelBounds(a);if(b||a.text.value!=c||a.text.isWrapping!=e||a.text.isClipping!=d||a.text.scale!=a.view.scale||!a.text.bounds.equals(f))a.text.value=c,a.text.bounds=f,a.text.scale=
this.getTextScale(a),a.text.isWrapping=e,a.text.isClipping=d,a.text.redraw()}};mxCellRenderer.prototype.getTextScale=function(a){return a.view.scale};
mxCellRenderer.prototype.getLabelBounds=function(a){var b=a.view.graph,c=a.view.scale,d=b.getModel().isEdge(a.cell),e=new mxRectangle(a.absoluteOffset.x,a.absoluteOffset.y);if(d){var f=a.text.getSpacing();e.x+=f.x*c;e.y+=f.y*c;b=b.getCellGeometry(a.cell);null!=b&&(e.width=Math.max(0,b.width*c),e.height=Math.max(0,b.height*c))}else a.text.isPaintBoundsInverted()&&(f=e.x,e.x=e.y,e.y=f),e.x+=a.x,e.y+=a.y,e.width=Math.max(1,a.width),e.height=Math.max(1,a.height),b.isSwimlane(a.cell)&&(b=b.getStartSize(a.cell),
0<b.width?(f=Math.min(e.width,b.width*c),a.shape.flipH&&(e.x+=e.width-f),e.width=f):0<b.height&&(f=Math.min(e.height,b.height*c),a.shape.flipV&&(e.y+=e.height-f),e.height=f));null!=a.shape&&(e=a.shape.getLabelBounds(e));d||this.rotateLabelBounds(a,e);return e};
mxCellRenderer.prototype.rotateLabelBounds=function(a,b){if(a.text.isPaintBoundsInverted()){var c=(a.width-a.height)/2;b.x+=c;b.y-=c;c=b.width;b.width=b.height;b.height=c}b.x-=a.text.margin.x*b.width;b.y-=a.text.margin.y*b.height;if("fill"!=a.style[mxConstants.STYLE_OVERFLOW]&&"width"!=a.style[mxConstants.STYLE_OVERFLOW]){var c=a.view.scale,d=a.text.getSpacing();b.x+=d.x*c;b.y+=d.y*c;b.width=Math.max(0,b.width-a.text.spacingLeft*c-a.text.spacingRight*c);b.height=Math.max(0,b.height-a.text.spacingTop*
c-a.text.spacingBottom*c)}var e=a.text.getTextRotation();if(0!=e&&null!=a&&a.view.graph.model.isVertex(a.cell)&&(c=a.getCenterX(),d=a.getCenterY(),b.x!=c||b.y!=d))e*=Math.PI/180,pt=mxUtils.getRotatedPoint(new mxPoint(b.x,b.y),Math.cos(e),Math.sin(e),new mxPoint(c,d)),b.x=pt.x,b.y=pt.y};
mxCellRenderer.prototype.redrawCellOverlays=function(a,b){this.createCellOverlays(a);if(null!=a.overlays){var c=mxUtils.mod(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0),90),d=mxUtils.toRadians(c),e=Math.cos(d),f=Math.sin(d);a.overlays.visit(function(d,h){var k=h.overlay.getBounds(a);if(!a.view.graph.getModel().isEdge(a.cell)&&null!=a.shape&&0!=c){var l=k.getCenterX(),m=k.getCenterY(),m=mxUtils.getRotatedPoint(new mxPoint(l,m),e,f,new mxPoint(a.getCenterX(),a.getCenterY())),l=m.x,m=m.y;k.x=
Math.round(l-k.width/2);k.y=Math.round(m-k.height/2)}if(b||null==h.bounds||h.scale!=a.view.scale||!h.bounds.equals(k))h.bounds=k,h.scale=a.view.scale,h.redraw()})}};
mxCellRenderer.prototype.redrawControl=function(a,b){if(null!=a.control){var c=this.getControlBounds(a),d=this.legacyControlPosition?mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0):a.shape.getTextRotation(),e=a.view.scale;if(b||a.control.scale!=e||!a.control.bounds.equals(c)||a.control.rotation!=d)a.control.rotation=d,a.control.bounds=c,a.control.scale=e,a.control.redraw()}};
mxCellRenderer.prototype.getControlBounds=function(a){if(null!=a.control){var b=a.control.scale,c=a.control.bounds.width/b,b=a.control.bounds.height/b,d=a.view.scale,e=a.getCenterX(),f=a.getCenterY();if(!a.view.graph.getModel().isEdge(a.cell)&&(e=a.x+c*d,f=a.y+b*d,null!=a.shape)){var g=a.shape.getShapeRotation();if(this.legacyControlPosition)g=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0);else if(a.shape.isPaintBoundsInverted())var h=(a.width-a.height)/2,e=e+h,f=f-h;0!=g&&(h=mxUtils.toRadians(g),
g=Math.cos(h),h=Math.sin(h),f=mxUtils.getRotatedPoint(new mxPoint(e,f),g,h,new mxPoint(a.getCenterX(),a.getCenterY())),e=f.x,f=f.y)}return a.view.graph.getModel().isEdge(a.cell),new mxRectangle(Math.round(e-c/2*d),Math.round(f-b/2*d),Math.round(c*d),Math.round(b*d))}return null};
mxCellRenderer.prototype.redraw=function(a,b,c){if(null!=a.shape){var d=!1;a.view.graph.getModel().isEdge(a.cell);reconfigure=null!=b?b:!1;this.createControl(a);if(a.orderChanged||a.invalidOrder)a.view.graph.ordered?this.order(a):this.orderEdge(a);if(a.orderChanged||!mxUtils.equalEntries(a.shape.style,a.style))this.configureShape(a),b=!0;delete a.invalidOrder;delete a.orderChanged;if(b||null==a.shape.bounds||a.shape.scale!=a.view.scale||!a.shape.bounds.equals(a)||!mxUtils.equalPoints(a.shape.points,
a.absolutePoints))d=!0,a.shape.points=null!=a.absolutePoints?a.absolutePoints.slice():null,a.shape.bounds=new mxRectangle(a.x,a.y,a.width,a.height),a.shape.scale=a.view.scale,null==c||c?a.shape.redraw():a.shape.updateBoundingBox();if(null==c||c)this.redrawLabel(a,d),this.redrawCellOverlays(a,d),this.redrawControl(a,d)}};
mxCellRenderer.prototype.destroy=function(a){null!=a.shape&&(null!=a.text&&(a.text.destroy(),a.text=null),null!=a.overlays&&(a.overlays.visit(function(a,c){c.destroy()}),a.overlays=null),null!=a.control&&(a.control.destroy(),a.control=null),a.shape.destroy(),a.shape=null)};
var mxEdgeStyle={EntityRelation:function(a,b,c,d,e){var f=a.view,g=f.graph,d=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,mxConstants.ENTITY_SEGMENT)*f.scale,h=a.absolutePoints,k=h[0],l=h[h.length-1],h=!1;if(null!=k)b=new mxCellState,b.x=k.x,b.y=k.y;else if(null!=b){var m=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_NONE);m!=mxConstants.DIRECTION_MASK_NONE?h=m==mxConstants.DIRECTION_MASK_WEST:(k=g.getCellGeometry(b.cell),k.relative?h=0.5>=k.x:null!=c&&(h=c.x+c.width<b.x))}else return;
k=!0;null!=l?(c=new mxCellState,c.x=l.x,c.y=l.y):null!=c&&(m=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_NONE),m!=mxConstants.DIRECTION_MASK_NONE?k=m==mxConstants.DIRECTION_MASK_WEST:(a=g.getCellGeometry(c.cell),a.relative?k=0.5>=a.x:null!=b&&(k=b.x+b.width<c.x)));null!=b&&null!=c&&(a=h?b.x:b.x+b.width,b=f.getRoutingCenterY(b),g=k?c.x:c.x+c.width,c=f.getRoutingCenterY(c),f=new mxPoint(a+(h?-d:d),b),l=new mxPoint(g+(k?-d:d),c),h==k?(d=h?Math.min(a,g)-d:Math.max(a,g)+d,e.push(new mxPoint(d,
b)),e.push(new mxPoint(d,c))):(f.x<l.x==h?(d=b+(c-b)/2,e.push(f),e.push(new mxPoint(f.x,d)),e.push(new mxPoint(l.x,d))):e.push(f),e.push(l)))},Loop:function(a,b,c,d,e){if(null!=b){var c=a.view,f=c.graph,d=null!=d&&0<d.length?d[0]:null;null!=d&&(d=c.transformControlPoint(a,d),mxUtils.contains(b,d.x,d.y)&&(d=null));var g=0,h=0,k=0,l=0,f=mxUtils.getValue(a.style,mxConstants.STYLE_SEGMENT,f.gridSize)*c.scale,a=mxUtils.getValue(a.style,mxConstants.STYLE_DIRECTION,mxConstants.DIRECTION_WEST);a==mxConstants.DIRECTION_NORTH||
a==mxConstants.DIRECTION_SOUTH?(g=c.getRoutingCenterX(b),h=f):(k=c.getRoutingCenterY(b),l=f);null==d||d.x<b.x||d.x>b.x+b.width?null!=d?(g=d.x,l=Math.max(Math.abs(k-d.y),l)):a==mxConstants.DIRECTION_NORTH?k=b.y-2*h:a==mxConstants.DIRECTION_SOUTH?k=b.y+b.height+2*h:g=a==mxConstants.DIRECTION_EAST?b.x-2*l:b.x+b.width+2*l:null!=d&&(g=c.getRoutingCenterX(b),h=Math.max(Math.abs(g-d.x),l),k=d.y,l=0);e.push(new mxPoint(g-h,k-l));e.push(new mxPoint(g+h,k+l))}},ElbowConnector:function(a,b,c,d,e){var f=null!=
d&&0<d.length?d[0]:null,g=!1,h=!1;if(null!=b&&null!=c)if(null!=f)var k=Math.min(b.x,c.x),l=Math.max(b.x+b.width,c.x+c.width),h=Math.min(b.y,c.y),m=Math.max(b.y+b.height,c.y+c.height),f=a.view.transformControlPoint(a,f),g=f.y<h||f.y>m,h=f.x<k||f.x>l;else k=Math.max(b.x,c.x),l=Math.min(b.x+b.width,c.x+c.width),g=k==l,g||(h=Math.max(b.y,c.y),m=Math.min(b.y+b.height,c.y+c.height),h=h==m);!h&&(g||a.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL)?mxEdgeStyle.TopToBottom(a,b,c,d,e):mxEdgeStyle.SideToSide(a,
b,c,d,e)},SideToSide:function(a,b,c,d,e){var f=a.view,d=null!=d&&0<d.length?d[0]:null,g=a.absolutePoints,h=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=h&&(b=new mxCellState,b.x=h.x,b.y=h.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(a=Math.max(b.x,c.x),h=Math.min(b.x+b.width,c.x+c.width),a=null!=d?d.x:h+(a-h)/2,h=f.getRoutingCenterY(b),f=f.getRoutingCenterY(c),null!=d&&(d.y>=b.y&&d.y<=b.y+b.height&&(h=d.y),d.y>=c.y&&d.y<=c.y+c.height&&(f=d.y)),!mxUtils.contains(c,
a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),!mxUtils.contains(c,a,f)&&!mxUtils.contains(b,a,f)&&e.push(new mxPoint(a,f)),1==e.length&&(null!=d?!mxUtils.contains(c,a,d.y)&&!mxUtils.contains(b,a,d.y)&&e.push(new mxPoint(a,d.y)):(f=Math.max(b.y,c.y),b=Math.min(b.y+b.height,c.y+c.height),e.push(new mxPoint(a,f+(b-f)/2)))))},TopToBottom:function(a,b,c,d,e){var f=a.view,d=null!=d&&0<d.length?d[0]:null,g=a.absolutePoints,h=g[0],g=g[g.length-1];null!=d&&(d=f.transformControlPoint(a,d));null!=
h&&(b=new mxCellState,b.x=h.x,b.y=h.y);null!=g&&(c=new mxCellState,c.x=g.x,c.y=g.y);null!=b&&null!=c&&(h=Math.max(b.y,c.y),g=Math.min(b.y+b.height,c.y+c.height),a=f.getRoutingCenterX(b),null!=d&&d.x>=b.x&&d.x<=b.x+b.width&&(a=d.x),h=null!=d?d.y:g+(h-g)/2,!mxUtils.contains(c,a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),a=null!=d&&d.x>=c.x&&d.x<=c.x+c.width?d.x:f.getRoutingCenterX(c),!mxUtils.contains(c,a,h)&&!mxUtils.contains(b,a,h)&&e.push(new mxPoint(a,h)),1==e.length&&(null!=d&&1==e.length?
!mxUtils.contains(c,d.x,h)&&!mxUtils.contains(b,d.x,h)&&e.push(new mxPoint(d.x,h)):(f=Math.max(b.x,c.x),b=Math.min(b.x+b.width,c.x+c.width),e.push(new mxPoint(f+(b-f)/2,h)))))},SegmentConnector:function(a,b,c,d,e){var f=a.absolutePoints,g=!0,h=null,k=f[0];null==k&&null!=b?k=new mxPoint(a.view.getRoutingCenterX(b),a.view.getRoutingCenterY(b)):null!=k&&(k=k.clone());var l=f.length-1;if(null!=d&&0<d.length){for(var h=a.view.transformControlPoint(a,d[0]),m=b,n=f[0],o=!1,q=!1,o=h,r=d.length,u=0;2>u;u++){var w=
null!=n&&n.x==o.x,v=null!=n&&n.y==o.y,x=null!=m&&o.y>=m.y&&o.y<=m.y+m.height,m=null!=m&&o.x>=m.x&&o.x<=m.x+m.width,o=v||null==n&&x,q=w||null==n&&m;if(null!=n&&!v&&!w&&(x||m)){g=x?!1:!0;break}if(q||o){g=o;1==u&&(g=0==d.length%2?o:q);break}m=c;n=f[l];o=a.view.transformControlPoint(a,d[r-1])}g&&(null!=f[0]&&f[0].y!=h.y||null==f[0]&&null!=b&&(h.y<b.y||h.y>b.y+b.height))?e.push(new mxPoint(k.x,h.y)):!g&&(null!=f[0]&&f[0].x!=h.x||null==f[0]&&null!=b&&(h.x<b.x||h.x>b.x+b.width))&&e.push(new mxPoint(h.x,
k.y));g?k.y=h.y:k.x=h.x;for(u=0;u<d.length;u++)g=!g,h=a.view.transformControlPoint(a,d[u]),g?k.y=h.y:k.x=h.x,e.push(k.clone())}else h=k,g=!0;k=f[l];null==k&&null!=c&&(k=new mxPoint(a.view.getRoutingCenterX(c),a.view.getRoutingCenterY(c)));g&&(null!=f[l]&&f[l].y!=h.y||null==f[l]&&null!=c&&(h.y<c.y||h.y>c.y+c.height))?e.push(new mxPoint(k.x,h.y)):!g&&(null!=f[l]&&f[l].x!=h.x||null==f[l]&&null!=c&&(h.x<c.x||h.x>c.x+c.width))&&e.push(new mxPoint(h.x,k.y));if(null==f[0]&&null!=b)for(;1<e.length&&mxUtils.contains(b,
e[1].x,e[1].y);)e=e.splice(1,1);if(null==f[l]&&null!=c)for(;1<e.length&&mxUtils.contains(c,e[e.length-1].x,e[e.length-1].y);)e=e.splice(e.length-1,1)},orthBuffer:10,dirVectors:[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1:[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns:[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,
2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],inlineRoutePatterns:[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],vertexSeperations:[],limits:[[0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0]],LEFT_MASK:32,TOP_MASK:64,RIGHT_MASK:128,BOTTOM_MASK:256,LEFT:1,TOP:2,RIGHT:4,BOTTOM:8,SIDE_MASK:480,CENTER_MASK:512,SOURCE_MASK:1024,TARGET_MASK:2048,VERTEX_MASK:3072,OrthConnector:function(a,b,c,d,e){var f=a.view.graph,g=null==b?!1:f.getModel().isEdge(b.cell),f=null==c?!1:f.getModel().isEdge(c.cell);if(null!=d&&0<d.length||g||f)mxEdgeStyle.SegmentConnector(a,b,c,d,e);else{var d=a.absolutePoints,h=d[0],k=d[d.length-1],d=null!=b?b.x:h.x,g=null!=b?b.y:h.y,l=null!=b?b.width:1,m=
null!=b?b.height:1,n=null!=c?c.x:k.x,o=null!=c?c.y:k.y,q=null!=c?c.width:1,r=null!=c?c.height:1,f=a.view.scale*mxEdgeStyle.orthBuffer,u=[mxConstants.DIRECTION_MASK_ALL,mxConstants.DIRECTION_MASK_ALL];null!=b&&(u[0]=mxUtils.getPortConstraints(b,a,!0,mxConstants.DIRECTION_MASK_ALL));null!=c&&(u[1]=mxUtils.getPortConstraints(c,a,!1,mxConstants.DIRECTION_MASK_ALL));a=[0,0];d=[[d,g,l,m],[n,o,q,r]];for(l=0;2>l;l++)mxEdgeStyle.limits[l][1]=d[l][0]-f,mxEdgeStyle.limits[l][2]=d[l][1]-f,mxEdgeStyle.limits[l][4]=
d[l][0]+d[l][2]+f,mxEdgeStyle.limits[l][8]=d[l][1]+d[l][3]+f;l=d[0][0]+d[0][2]/2-(d[1][0]+d[1][2]/2);m=d[0][1]+d[0][3]/2-(d[1][1]+d[1][3]/2);g=0;0>l?g=0>m?2:1:0>=m&&(g=3,0==l&&(g=2));m=null;null!=b&&(m=h);b=[[0.5,0.5],[0.5,0.5]];for(l=0;2>l;l++)null!=m&&(b[l][0]=(m.x-d[l][0])/d[l][2],0.01>b[l][0]?a[l]=mxConstants.DIRECTION_MASK_WEST:0.99<b[l][0]&&(a[l]=mxConstants.DIRECTION_MASK_EAST),b[l][1]=(m.y-d[l][1])/d[l][3],0.01>b[l][1]?a[l]=mxConstants.DIRECTION_MASK_NORTH:0.99<b[l][1]&&(a[l]=mxConstants.DIRECTION_MASK_SOUTH)),
m=null,null!=c&&(m=k);l=d[0][1]-(d[1][1]+d[1][3]);m=d[0][0]-(d[1][0]+d[1][2]);n=d[1][1]-(d[0][1]+d[0][3]);o=d[1][0]-(d[0][0]+d[0][2]);mxEdgeStyle.vertexSeperations[1]=Math.max(m-2*f,0);mxEdgeStyle.vertexSeperations[2]=Math.max(l-2*f,0);mxEdgeStyle.vertexSeperations[4]=Math.max(n-2*f,0);mxEdgeStyle.vertexSeperations[3]=Math.max(o-2*f,0);c=[];h=[];k=[];h[0]=m>=o?mxConstants.DIRECTION_MASK_WEST:mxConstants.DIRECTION_MASK_EAST;k[0]=l>=n?mxConstants.DIRECTION_MASK_NORTH:mxConstants.DIRECTION_MASK_SOUTH;
h[1]=mxUtils.reversePortConstraints(h[0]);k[1]=mxUtils.reversePortConstraints(k[0]);m=m>=o?m:o;n=l>=n?l:n;o=[[0,0],[0,0]];q=!1;for(l=0;2>l;l++)0==a[l]&&(0==(h[l]&u[l])&&(h[l]=mxUtils.reversePortConstraints(h[l])),0==(k[l]&u[l])&&(k[l]=mxUtils.reversePortConstraints(k[l])),o[l][0]=k[l],o[l][1]=h[l]);n>2*f&&m>2*f&&(0<(h[0]&u[0])&&0<(k[1]&u[1])?(o[0][0]=h[0],o[0][1]=k[0],o[1][0]=k[1],o[1][1]=h[1],q=!0):0<(k[0]&u[0])&&0<(h[1]&u[1])&&(o[0][0]=k[0],o[0][1]=h[0],o[1][0]=h[1],o[1][1]=k[1],q=!0));n>2*f&&!q&&
(o[0][0]=k[0],o[0][1]=h[0],o[1][0]=k[1],o[1][1]=h[1],q=!0);m>2*f&&!q&&(o[0][0]=h[0],o[0][1]=k[0],o[1][0]=h[1],o[1][1]=k[1]);for(l=0;2>l;l++)if(0==a[l]&&(0==(o[l][0]&u[l])&&(o[l][0]=o[l][1]),c[l]=o[l][0]&u[l],c[l]|=(o[l][1]&u[l])<<8,c[l]|=(o[1-l][l]&u[l])<<16,c[l]|=(o[1-l][1-l]&u[l])<<24,0==(c[l]&15)&&(c[l]<<=8),0==(c[l]&3840)&&(c[l]=c[l]&15|c[l]>>8),0==(c[l]&983040)&&(c[l]=c[l]&65535|(c[l]&251658240)>>8),a[l]=c[l]&15,u[l]==mxConstants.DIRECTION_MASK_WEST||u[l]==mxConstants.DIRECTION_MASK_NORTH||u[l]==
mxConstants.DIRECTION_MASK_EAST||u[l]==mxConstants.DIRECTION_MASK_SOUTH))a[l]=u[l];l=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0];u=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1];l-=g;u-=g;1>l&&(l+=4);1>u&&(u+=4);u=mxEdgeStyle.routePatterns[l-1][u-1];mxEdgeStyle.wayPoints1[0][0]=d[0][0];mxEdgeStyle.wayPoints1[0][1]=d[0][1];switch(a[0]){case mxConstants.DIRECTION_MASK_WEST:mxEdgeStyle.wayPoints1[0][0]-=f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_SOUTH:mxEdgeStyle.wayPoints1[0][0]+=
b[0][0]*d[0][2];mxEdgeStyle.wayPoints1[0][1]+=d[0][3]+f;break;case mxConstants.DIRECTION_MASK_EAST:mxEdgeStyle.wayPoints1[0][0]+=d[0][2]+f;mxEdgeStyle.wayPoints1[0][1]+=b[0][1]*d[0][3];break;case mxConstants.DIRECTION_MASK_NORTH:mxEdgeStyle.wayPoints1[0][0]+=b[0][0]*d[0][2],mxEdgeStyle.wayPoints1[0][1]-=f}f=0;h=c=0<(a[0]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1;for(l=0;l<u.length;l++){k=u[l]&15;r=k==mxConstants.DIRECTION_MASK_EAST?3:k;r+=g;4<r&&(r-=4);m=mxEdgeStyle.dirVectors[r-
1];k=0<r%2?0:1;k!=c&&(f++,mxEdgeStyle.wayPoints1[f][0]=mxEdgeStyle.wayPoints1[f-1][0],mxEdgeStyle.wayPoints1[f][1]=mxEdgeStyle.wayPoints1[f-1][1]);var w=0<(u[l]&mxEdgeStyle.TARGET_MASK),q=0<(u[l]&mxEdgeStyle.SOURCE_MASK),n=(u[l]&mxEdgeStyle.SIDE_MASK)>>5,n=n<<g;15<n&&(n>>=4);o=0<(u[l]&mxEdgeStyle.CENTER_MASK);(q||w)&&9>n?(q=q?0:1,r=o&&0==k?d[q][0]+b[q][0]*d[q][2]:o?d[q][1]+b[q][1]*d[q][3]:mxEdgeStyle.limits[q][n],0==k?(n=(r-mxEdgeStyle.wayPoints1[f][0])*m[0],0<n&&(mxEdgeStyle.wayPoints1[f][0]+=m[0]*
n)):(n=(r-mxEdgeStyle.wayPoints1[f][1])*m[1],0<n&&(mxEdgeStyle.wayPoints1[f][1]+=m[1]*n))):o&&(mxEdgeStyle.wayPoints1[f][0]+=m[0]*Math.abs(mxEdgeStyle.vertexSeperations[r]/2),mxEdgeStyle.wayPoints1[f][1]+=m[1]*Math.abs(mxEdgeStyle.vertexSeperations[r]/2));0<f&&mxEdgeStyle.wayPoints1[f][k]==mxEdgeStyle.wayPoints1[f-1][k]?f--:c=k}for(l=0;l<=f&&!(l==f&&((0<(a[1]&(mxConstants.DIRECTION_MASK_EAST|mxConstants.DIRECTION_MASK_WEST))?0:1)==h?0:1)!=(f+1)%2);l++)e.push(new mxPoint(mxEdgeStyle.wayPoints1[l][0],
mxEdgeStyle.wayPoints1[l][1]))}},getRoutePattern:function(a,b,c,d){var e=a[0]==mxConstants.DIRECTION_MASK_EAST?3:a[0],a=a[1]==mxConstants.DIRECTION_MASK_EAST?3:a[1],e=e-b,a=a-b;1>e&&(e+=4);1>a&&(a+=4);b=routePatterns[e-1][a-1];if(0==c||0==d)null!=inlineRoutePatterns[e-1][a-1]&&(b=inlineRoutePatterns[e-1][a-1]);return b}},mxStyleRegistry={values:[],putValue:function(a,b){mxStyleRegistry.values[a]=b},getValue:function(a){return mxStyleRegistry.values[a]},getName:function(a){for(var b in mxStyleRegistry.values)if(mxStyleRegistry.values[b]==
a)return b;return null}};mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ELBOW,mxEdgeStyle.ElbowConnector);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ENTITY_RELATION,mxEdgeStyle.EntityRelation);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_LOOP,mxEdgeStyle.Loop);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SIDETOSIDE,mxEdgeStyle.SideToSide);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_TOPTOBOTTOM,mxEdgeStyle.TopToBottom);mxStyleRegistry.putValue(mxConstants.EDGESTYLE_ORTHOGONAL,mxEdgeStyle.OrthConnector);
mxStyleRegistry.putValue(mxConstants.EDGESTYLE_SEGMENT,mxEdgeStyle.SegmentConnector);mxStyleRegistry.putValue(mxConstants.PERIMETER_ELLIPSE,mxPerimeter.EllipsePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RECTANGLE,mxPerimeter.RectanglePerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_RHOMBUS,mxPerimeter.RhombusPerimeter);mxStyleRegistry.putValue(mxConstants.PERIMETER_TRIANGLE,mxPerimeter.TrianglePerimeter);
function mxGraphView(a){this.graph=a;this.translate=new mxPoint;this.graphBounds=new mxRectangle;this.states=new mxDictionary}mxGraphView.prototype=new mxEventSource;mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint;mxGraphView.prototype.doneResource="none"!=mxClient.language?"done":"";mxGraphView.prototype.updatingDocumentResource="none"!=mxClient.language?"updatingDocument":"";mxGraphView.prototype.allowEval=!1;
mxGraphView.prototype.captureDocumentGesture=!0;mxGraphView.prototype.optimizeVmlReflows=!0;mxGraphView.prototype.rendering=!0;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.updateStyle=!1;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(a){this.graphBounds=a};
mxGraphView.prototype.getBounds=function(a){var b=null;if(null!=a&&0<a.length)for(var c=this.graph.getModel(),d=0;d<a.length;d++)if(c.isVertex(a[d])||c.isEdge(a[d])){var e=this.getState(a[d]);null!=e&&(null==b?b=new mxRectangle(e.x,e.y,e.width,e.height):b.add(e))}return b};mxGraphView.prototype.setCurrentRoot=function(a){if(this.currentRoot!=a){var b=new mxCurrentRootChange(this,a);b.execute();var c=new mxUndoableEdit(this,!1);c.add(b);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",c));this.graph.sizeDidChange()}return a};
mxGraphView.prototype.scaleAndTranslate=function(a,b,c){var d=this.scale,e=new mxPoint(this.translate.x,this.translate.y);if(this.scale!=a||this.translate.x!=b||this.translate.y!=c)this.scale=a,this.translate.x=b,this.translate.y=c,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",a,"previousScale",d,"translate",this.translate,"previousTranslate",e))};mxGraphView.prototype.getScale=function(){return this.scale};
mxGraphView.prototype.setScale=function(a){var b=this.scale;this.scale!=a&&(this.scale=a,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange()));this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",a,"previousScale",b))};mxGraphView.prototype.getTranslate=function(){return this.translate};
mxGraphView.prototype.setTranslate=function(a,b){var c=new mxPoint(this.translate.x,this.translate.y);if(this.translate.x!=a||this.translate.y!=b)this.translate.x=a,this.translate.y=b,this.isEventsEnabled()&&(this.revalidate(),this.graph.sizeDidChange());this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",c))};mxGraphView.prototype.refresh=function(){null!=this.currentRoot&&this.clear();this.revalidate()};
mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(a,b,c){var d=this.graph.getModel(),a=a||d.getRoot(),b=null!=b?b:!1,c=null!=c?c:!0;this.removeState(a);if(c&&(b||a!=this.currentRoot))for(var c=d.getChildCount(a),e=0;e<c;e++)this.clear(d.getChildAt(a,e),b);else this.invalidate(a)};
mxGraphView.prototype.invalidate=function(a,b,c,d){var e=this.graph.getModel(),a=a||e.getRoot(),b=null!=b?b:!0,c=null!=c?c:!0,d=null!=d?d:!1,f=this.getState(a);null!=f&&(f.invalid=!0,d&&(f.orderChanged=!0));if(!a.invalidating){a.invalidating=!0;if(b)for(var g=e.getChildCount(a),f=0;f<g;f++)this.invalidate(e.getChildAt(a,f),b,c,d);if(c){d=e.getEdgeCount(a);for(f=0;f<d;f++)this.invalidate(e.getEdgeAt(a,f),b,c)}delete a.invalidating}};
mxGraphView.prototype.validate=function(a){var b=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;var c=null;if(this.optimizeVmlReflows&&null!=this.canvas&&null==this.textDiv&&(8==document.documentMode||mxClient.IS_QUIRKS)){c=this.canvas.style.display;this.canvas.style.display="none";var d=document.createElement("div");d.style.position="absolute";d.style.whiteSpace="nowrap";d.style.visibility="hidden";d.style.display=mxClient.IS_QUIRKS?
"inline":"inline-block";d.style.zoom="1";document.body.appendChild(d);this.textDiv=d}a=a||(null!=this.currentRoot?this.currentRoot:this.graph.getModel().getRoot());this.validateBounds(null,a);a=this.validatePoints(null,a);null==a&&(a=new mxRectangle);this.setGraphBounds(a);this.validateBackground();null!=c&&(this.canvas.style.display=c,document.body.removeChild(this.textDiv),this.textDiv=null);window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",b)};
mxGraphView.prototype.createBackgroundPageShape=function(a){return new mxRectangleShape(a,"white","black")};mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage();this.validateBackgroundPage()};
mxGraphView.prototype.validateBackgroundImage=function(){var a=this.graph.getBackgroundImage();if(null!=a){if(null==this.backgroundImage||this.backgroundImage.image!=a.src){null!=this.backgroundImage&&this.backgroundImage.destroy();var b=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(b,a.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw();8==document.documentMode&&mxEvent.addGestureListeners(this.backgroundImage.node,
mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))}))}this.redrawBackgroundImage(this.backgroundImage,a)}else null!=this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)};
mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var a=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(a),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),graph.nativeDblClickEnabled&&mxEvent.addListener(this.backgroundPageShape.node,
"dblclick",mxUtils.bind(this,function(a){this.graph.dblClick(a)})),mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){null!=this.graph.tooltipHandler&&this.graph.tooltipHandler.isHideOnHover()&&this.graph.tooltipHandler.hide();this.graph.isMouseDown&&!mxEvent.isConsumed(a)&&this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),mxUtils.bind(this,function(a){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,
new mxMouseEvent(a))}))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=a,this.backgroundPageShape.redraw())}else null!=this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)};mxGraphView.prototype.getBackgroundPageBounds=function(){var a=this.graph.pageFormat,b=this.scale*this.graph.pageScale;return new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,a.width*b,a.height*b)};
mxGraphView.prototype.redrawBackgroundImage=function(a,b){a.scale=this.scale;a.bounds.x=this.scale*this.translate.x;a.bounds.y=this.scale*this.translate.y;a.bounds.width=this.scale*b.width;a.bounds.height=this.scale*b.height;a.redraw()};
mxGraphView.prototype.validateBounds=function(a,b){var c=this.graph.getModel(),d=this.getState(b,!0);if(null!=d&&d.invalid){if(this.graph.isCellVisible(b)){if(b!=this.currentRoot&&null!=a){d.absoluteOffset.x=0;d.absoluteOffset.y=0;d.origin.x=a.origin.x;d.origin.y=a.origin.y;var e=this.graph.getCellGeometry(b);if(null!=e){if(!c.isEdge(b)){var f=e.offset||this.EMPTY_POINT;e.relative?(d.origin.x+=e.x*a.width/this.scale+f.x,d.origin.y+=e.y*a.height/this.scale+f.y):(d.absoluteOffset.x=this.scale*f.x,d.absoluteOffset.y=
this.scale*f.y,d.origin.x+=e.x,d.origin.y+=e.y)}d.x=this.scale*(this.translate.x+d.origin.x);d.y=this.scale*(this.translate.y+d.origin.y);d.width=this.scale*e.width;d.height=this.scale*e.height;if(c.isVertex(b)){if(e.relative&&(f=mxUtils.toRadians(a.style[mxConstants.STYLE_ROTATION]||"0"),0!=f)){var e=Math.cos(f),f=Math.sin(f),g=new mxPoint(d.getCenterX(),d.getCenterY()),h=new mxPoint(a.getCenterX(),a.getCenterY()),e=mxUtils.getRotatedPoint(g,e,f,h);d.x=e.x-d.width/2;d.y=e.y-d.height/2}this.updateVertexLabelOffset(d)}}}}else this.removeState(b);
f=this.graph.getChildOffsetForCell(b);null!=f&&(d.origin.x+=f.x,d.origin.y+=f.y)}if(null!=d&&(!this.graph.isCellCollapsed(b)||b==this.currentRoot)){e=c.getChildCount(b);for(f=0;f<e;f++)g=c.getChildAt(b,f),this.validateBounds(d,g)}};
mxGraphView.prototype.updateVertexLabelOffset=function(a){var b=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);b==mxConstants.ALIGN_LEFT?a.absoluteOffset.x-=a.width:b==mxConstants.ALIGN_RIGHT&&(a.absoluteOffset.x+=a.width);b=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);b==mxConstants.ALIGN_TOP?a.absoluteOffset.y-=a.height:b==mxConstants.ALIGN_BOTTOM&&(a.absoluteOffset.y+=a.height)};
mxGraphView.prototype.validatePoints=function(a,b){var c=this.graph.getModel(),d=this.getState(b),e=null;if(null!=d){if(d.invalid){var f=this.graph.getCellGeometry(b);if(null!=f&&c.isEdge(b)){var g=this.getState(this.getVisibleTerminal(b,!0));d.setVisibleTerminalState(g,!0);if(null!=g&&c.isEdge(g.cell)&&!c.isAncestor(g.cell,b)){var h=this.getState(c.getParent(g.cell));this.validatePoints(h,g.cell)}var k=this.getState(this.getVisibleTerminal(b,!1));d.setVisibleTerminalState(k,!1);null!=k&&c.isEdge(k.cell)&&
!c.isAncestor(k.cell,b)&&(h=this.getState(c.getParent(k.cell)),this.validatePoints(h,k.cell));this.updateFixedTerminalPoints(d,g,k);this.updatePoints(d,f.points,g,k);this.updateFloatingTerminalPoints(d,g,k);this.updateEdgeBounds(d);this.updateEdgeLabelOffset(d)}else null!=f&&f.relative&&null!=a&&c.isEdge(a.cell)&&(f=this.getPoint(a,f),null!=f&&(d.x=f.x,d.y=f.y,f.x=f.x/this.scale-this.translate.x,f.y=f.y/this.scale-this.translate.y,d.origin=f,this.childMoved(a,d)));d.invalid=!1;b!=this.currentRoot&&
this.graph.cellRenderer.redraw(d,!1,this.isRendering())}if(c.isEdge(b)||c.isVertex(b))null!=d.shape&&null!=d.shape.boundingBox&&(e=d.shape.boundingBox.clone()),null!=d.text&&!this.graph.isLabelClipped(d.cell)&&null!=d.text.boundingBox&&(null!=e?e.add(d.text.boundingBox):e=d.text.boundingBox.clone())}if(null!=d&&(!this.graph.isCellCollapsed(b)||b==this.currentRoot)){f=c.getChildCount(b);for(g=0;g<f;g++)h=c.getChildAt(b,g),h=this.validatePoints(d,h),null!=h&&(null==e?e=h:e.add(h))}return e};
mxGraphView.prototype.childMoved=function(a,b){var c=b.cell;if(!this.graph.isCellCollapsed(c)||c==this.currentRoot)for(var d=this.graph.getModel(),e=d.getChildCount(c),f=0;f<e;f++)this.validateBounds(b,d.getChildAt(c,f))};mxGraphView.prototype.updateFixedTerminalPoints=function(a,b,c){this.updateFixedTerminalPoint(a,b,!0,this.graph.getConnectionConstraint(a,b,!0));this.updateFixedTerminalPoint(a,c,!1,this.graph.getConnectionConstraint(a,c,!1))};
mxGraphView.prototype.updateFixedTerminalPoint=function(a,b,c,d){var e=null;null!=d&&(e=this.graph.getConnectionPoint(b,d));if(null==e&&null==b){var b=this.scale,d=this.translate,f=a.origin,e=this.graph.getCellGeometry(a.cell).getTerminalPoint(c);null!=e&&(e=new mxPoint(b*(d.x+e.x+f.x),b*(d.y+e.y+f.y)))}a.setAbsoluteTerminalPoint(e,c)};
mxGraphView.prototype.updatePoints=function(a,b,c,d){if(null!=a){var e=[];e.push(a.absolutePoints[0]);var f=this.getEdgeStyle(a,b,c,d);if(null!=f)c=this.getTerminalPort(a,c,!0),d=this.getTerminalPort(a,d,!1),f(a,c,d,b,e);else if(null!=b)for(f=0;f<b.length;f++)null!=b[f]&&(d=mxUtils.clone(b[f]),e.push(this.transformControlPoint(a,d)));b=a.absolutePoints;e.push(b[b.length-1]);a.absolutePoints=e}};
mxGraphView.prototype.transformControlPoint=function(a,b){var c=a.origin;return new mxPoint(this.scale*(b.x+this.translate.x+c.x),this.scale*(b.y+this.translate.y+c.y))};
mxGraphView.prototype.getEdgeStyle=function(a,b,c,d){a=null!=c&&c==d?mxUtils.getValue(a.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):!mxUtils.getValue(a.style,mxConstants.STYLE_NOEDGESTYLE,!1)?a.style[mxConstants.STYLE_EDGE]:null;"string"==typeof a&&(b=mxStyleRegistry.getValue(a),null==b&&this.isAllowEval()&&(b=mxUtils.eval(a)),a=b);return"function"==typeof a?a:null};
mxGraphView.prototype.updateFloatingTerminalPoints=function(a,b,c){var d=a.absolutePoints,e=d[0];null==d[d.length-1]&&null!=c&&this.updateFloatingTerminalPoint(a,c,b,!1);null==e&&null!=b&&this.updateFloatingTerminalPoint(a,b,c,!0)};
mxGraphView.prototype.updateFloatingTerminalPoint=function(a,b,c,d){var b=this.getTerminalPort(a,b,d),e=this.getNextPoint(a,c,d),f=this.graph.isOrthogonal(a),c=mxUtils.toRadians(Number(b.style[mxConstants.STYLE_ROTATION]||"0")),g=new mxPoint(b.getCenterX(),b.getCenterY());if(0!=c)var h=Math.cos(-c),k=Math.sin(-c),e=mxUtils.getRotatedPoint(e,h,k,g);h=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0);h+=parseFloat(a.style[d?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||
0);b=this.getPerimeterPoint(b,e,0==c&&f,h);0!=c&&(h=Math.cos(c),k=Math.sin(c),b=mxUtils.getRotatedPoint(b,h,k,g));a.setAbsoluteTerminalPoint(b,d)};mxGraphView.prototype.getTerminalPort=function(a,b,c){a=mxUtils.getValue(a.style,c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT);null!=a&&(a=this.getState(this.graph.getModel().getCell(a)),null!=a&&(b=a));return b};
mxGraphView.prototype.getPerimeterPoint=function(a,b,c,d){var e=null;if(null!=a){var f=this.getPerimeterFunction(a);if(null!=f&&null!=b&&(d=this.getPerimeterBounds(a,d),0<d.width||0<d.height))e=f(d,a,b,c);null==e&&(e=this.getPoint(a))}return e};mxGraphView.prototype.getRoutingCenterX=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return a.getCenterX()+b*a.width};
mxGraphView.prototype.getRoutingCenterY=function(a){var b=null!=a.style?parseFloat(a.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return a.getCenterY()+b*a.height};mxGraphView.prototype.getPerimeterBounds=function(a,b){b=null!=b?b:0;null!=a&&(b+=parseFloat(a.style[mxConstants.STYLE_PERIMETER_SPACING]||0));return a.getPerimeterBounds(b*this.scale)};
mxGraphView.prototype.getPerimeterFunction=function(a){a=a.style[mxConstants.STYLE_PERIMETER];if("string"==typeof a){var b=mxStyleRegistry.getValue(a);null==b&&this.isAllowEval()&&(b=mxUtils.eval(a));a=b}return"function"==typeof a?a:null};mxGraphView.prototype.getNextPoint=function(a,b,c){var a=a.absolutePoints,d=null;if(null!=a&&(c||2<a.length||null==b))d=a.length,d=a[c?Math.min(1,d-1):Math.max(0,d-2)];null==d&&null!=b&&(d=new mxPoint(b.getCenterX(),b.getCenterY()));return d};
mxGraphView.prototype.getVisibleTerminal=function(a,b){for(var c=this.graph.getModel(),d=c.getTerminal(a,b),e=d;null!=d&&d!=this.currentRoot;){if(!this.graph.isCellVisible(e)||this.graph.isCellCollapsed(d))e=d;d=c.getParent(d)}c.getParent(e)==c.getRoot()&&(e=null);return e};
mxGraphView.prototype.updateEdgeBounds=function(a){var b=a.absolutePoints;a.length=0;if(null!=b&&0<b.length){var c=b[0],d=b[b.length-1];if(null==c||null==d)a.cell!=this.currentRoot&&this.clear(a.cell,!0);else{if(c.x!=d.x||c.y!=d.y){var e=d.x-c.x,f=d.y-c.y;a.terminalDistance=Math.sqrt(e*e+f*f)}else a.terminalDistance=0;var d=0,g=[],f=c;if(null!=f){for(var c=f.x,h=f.y,k=c,l=h,m=1;m<b.length;m++){var n=b[m];null!=n&&(e=f.x-n.x,f=f.y-n.y,e=Math.sqrt(e*e+f*f),g.push(e),d+=e,f=n,c=Math.min(f.x,c),h=Math.min(f.y,
h),k=Math.max(f.x,k),l=Math.max(f.y,l))}a.length=d;a.segments=g;a.x=c;a.y=h;a.width=Math.max(1,k-c);a.height=Math.max(1,l-h)}}}};
mxGraphView.prototype.getPoint=function(a,b){var c=a.getCenterX(),d=a.getCenterY();if(null!=a.segments&&(null==b||b.relative)){for(var e=a.absolutePoints.length,f=((null!=b?b.x/2:0)+0.5)*a.length,g=a.segments[0],h=0,k=1;f>h+g&&k<e-1;)h+=g,g=a.segments[k++];e=0==g?0:(f-h)/g;f=a.absolutePoints[k-1];k=a.absolutePoints[k];if(null!=f&&null!=k){h=c=d=0;if(null!=b){var d=b.y,l=b.offset;null!=l&&(c=l.x,h=l.y)}l=k.x-f.x;k=k.y-f.y;c=f.x+l*e+((0==g?0:k/g)*d+c)*this.scale;d=f.y+k*e-((0==g?0:l/g)*d-h)*this.scale}}else null!=
b&&(l=b.offset,null!=l&&(c+=l.x,d+=l.y));return new mxPoint(c,d)};
mxGraphView.prototype.getRelativePoint=function(a,b,c){var d=this.graph.getModel().getGeometry(a.cell);if(null!=d){var e=a.absolutePoints.length;if(d.relative&&1<e){for(var d=a.length,f=a.segments,g=a.absolutePoints[0],h=a.absolutePoints[1],k=mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c),l=0,m=0,n=0,o=2;o<e;o++)m+=f[o-2],h=a.absolutePoints[o],g=mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c),g<=k&&(k=g,l=o-1,n=m),g=h;e=f[l];g=a.absolutePoints[l];h=a.absolutePoints[l+1];k=h.x;f=h.y;a=g.x-k;l=g.y-f;f=(a-(b-k))*
a+(l-(c-f))*l;a=Math.sqrt(0>=f?0:f*f/(a*a+l*l));a>e&&(a=e);e=Math.sqrt(mxUtils.ptSegDistSq(g.x,g.y,h.x,h.y,b,c));-1==mxUtils.relativeCcw(g.x,g.y,h.x,h.y,b,c)&&(e=-e);return new mxPoint(-2*((d/2-n-a)/d),e/this.scale)}}return new mxPoint};
mxGraphView.prototype.updateEdgeLabelOffset=function(a){var b=a.absolutePoints;a.absoluteOffset.x=a.getCenterX();a.absoluteOffset.y=a.getCenterY();if(null!=b&&0<b.length&&null!=a.segments){var c=this.graph.getCellGeometry(a.cell);if(c.relative){var d=this.getPoint(a,c);null!=d&&(a.absoluteOffset=d)}else{var d=b[0],e=b[b.length-1];if(null!=d&&null!=e){var b=e.x-d.x,f=e.y-d.y,g=e=0,c=c.offset;null!=c&&(e=c.x,g=c.y);c=d.y+f/2+g*this.scale;a.absoluteOffset.x=d.x+b/2+e*this.scale;a.absoluteOffset.y=c}}}};
mxGraphView.prototype.getState=function(a,b){var b=b||!1,c=null;null!=a&&(c=this.states.get(a),this.graph.isCellVisible(a)&&(null==c&&b&&this.graph.isCellVisible(a)?(c=this.createState(a),this.states.put(a,c)):b&&null!=c&&this.updateStyle&&(c.style=this.graph.getCellStyle(a))));return c};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(a){this.rendering=a};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};
mxGraphView.prototype.setAllowEval=function(a){this.allowEval=a};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(a){this.states=a};mxGraphView.prototype.getCellStates=function(a){if(null==a)return this.states;for(var b=[],c=0;c<a.length;c++){var d=this.getState(a[c]);null!=d&&b.push(d)}return b};
mxGraphView.prototype.removeState=function(a){var b=null;null!=a&&(b=this.states.remove(a),null!=b&&(this.graph.cellRenderer.destroy(b),b.destroy()));return b};mxGraphView.prototype.createState=function(a){var b=this.graph.getCellStyle(a),a=new mxCellState(this,a,b);this.graph.cellRenderer.initialize(a,this.isRendering());return a};mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};
mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.isContainerEvent=function(a){a=mxEvent.getSource(a);return a==this.graph.container||a.parentNode==this.backgroundPane||null!=a.parentNode&&a.parentNode.parentNode==this.backgroundPane||a==this.canvas.parentNode||a==this.canvas||a==this.backgroundPane||a==this.drawPane||a==this.overlayPane};
mxGraphView.prototype.isScrollEvent=function(a){var b=mxUtils.getOffset(this.graph.container),a=new mxPoint(a.clientX-b.x,a.clientY-b.y),b=this.graph.container.offsetWidth,c=this.graph.container.clientWidth;if(b>c&&a.x>c+2&&a.x<=b)return!0;b=this.graph.container.offsetHeight;c=this.graph.container.clientHeight;return b>c&&a.y>c+2&&a.y<=b?!0:!1};
mxGraphView.prototype.init=function(){this.installListeners();var a=this.graph;a.dialect==mxConstants.DIALECT_SVG?this.createSvg():a.dialect==mxConstants.DIALECT_VML?this.createVml():this.createHtml()};
mxGraphView.prototype.installListeners=function(){var a=this.graph,b=a.container;if(null!=b){mxEvent.addGestureListeners(b,mxUtils.bind(this,function(b){this.isContainerEvent(b)&&(!mxClient.IS_IE&&!mxClient.IS_GC&&!mxClient.IS_OP&&!mxClient.IS_SF||!this.isScrollEvent(b))&&a.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){this.isContainerEvent(b)&&
a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))}));mxEvent.addListener(b,"dblclick",mxUtils.bind(this,function(b){this.isContainerEvent(b)&&a.dblClick(b)}));var c=function(c){var e=null;mxClient.IS_TOUCH&&(e=mxEvent.getClientX(c),c=mxEvent.getClientY(c),c=mxUtils.convertPoint(b,e,c),e=a.view.getState(a.getCellAt(c.x,c.y)));return e};a.addMouseListener({mouseDown:function(){a.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}});this.moveHandler=mxUtils.bind(this,function(b){null!=
a.tooltipHandler&&a.tooltipHandler.isHideOnHover()&&a.tooltipHandler.hide();this.captureDocumentGesture&&a.isMouseDown&&!mxEvent.isConsumed(b)&&a.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b,c(b)))});this.endHandler=mxUtils.bind(this,function(b){this.captureDocumentGesture&&a.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))});mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}};
mxGraphView.prototype.createHtml=function(){var a=this.graph.container;null!=a&&(this.canvas=this.createHtmlPane("100%","100%"),this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),a.appendChild(this.canvas),mxClient.IS_QUIRKS&&(a=mxUtils.bind(this,function(a){a=this.getGraphBounds();
this.updateHtmlCanvasSize(a.x+a.width+this.graph.border,a.y+a.height+this.graph.border)}),mxEvent.addListener(window,"resize",a)))};mxGraphView.prototype.updateHtmlCanvasSize=function(a,b){if(null!=this.graph.container){var c=this.graph.container.offsetHeight;this.canvas.style.width=this.graph.container.offsetWidth<a?a+"px":"100%";this.canvas.style.height=c<b?b+"px":"100%"}};
mxGraphView.prototype.createHtmlPane=function(a,b){var c=document.createElement("DIV");null!=a&&null!=b?(c.style.position="absolute",c.style.left="0px",c.style.top="0px",c.style.width=a,c.style.height=b):c.style.position="relative";return c};
mxGraphView.prototype.createVml=function(){var a=this.graph.container;if(null!=a){var b=a.offsetWidth,c=a.offsetHeight;this.canvas=this.createVmlPane(b,c);this.backgroundPane=this.createVmlPane(b,c);this.drawPane=this.createVmlPane(b,c);this.overlayPane=this.createVmlPane(b,c);this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);a.appendChild(this.canvas)}};
mxGraphView.prototype.createVmlPane=function(a,b){var c=document.createElement(mxClient.VML_PREFIX+":group");c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=a+"px";c.style.height=b+"px";c.setAttribute("coordsize",a+","+b);c.setAttribute("coordorigin","0,0");return c};
mxGraphView.prototype.createSvg=function(){var a=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);var b=document.createElementNS(mxConstants.NS_SVG,
"svg");b.style.width="100%";b.style.height="100%";b.style.display="block";b.appendChild(this.canvas);null!=a&&(a.appendChild(b),this.updateContainerStyle(a))};mxGraphView.prototype.updateContainerStyle=function(a){"static"==mxUtils.getCurrentStyle(a).position&&(a.style.position="relative");mxClient.IS_POINTER&&(a.style.msTouchAction="none")};
mxGraphView.prototype.destroy=function(){var a=null!=this.canvas?this.canvas.ownerSVGElement:null;null==a&&(a=this.canvas);null!=a&&null!=a.parentNode&&(this.clear(this.currentRoot,!0),mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler),mxEvent.release(this.graph.container),a.parentNode.removeChild(a),this.overlayPane=this.drawPane=this.backgroundPane=this.canvas=this.endHandler=this.moveHandler=null)};
function mxCurrentRootChange(a,b){this.view=a;this.previous=this.root=b;this.isUp=null==b;if(!this.isUp)for(var c=this.view.currentRoot,d=this.view.graph.getModel();null!=c;){if(c==b){this.isUp=!0;break}c=d.getParent(c)}}
mxCurrentRootChange.prototype.execute=function(){var a=this.view.currentRoot;this.view.currentRoot=this.previous;this.previous=a;a=this.view.graph.getTranslateForRoot(this.view.currentRoot);null!=a&&(this.view.translate=new mxPoint(-a.x,-a.y));this.view.fireEvent(new mxEventObject(this.isUp?mxEvent.UP:mxEvent.DOWN,"root",this.view.currentRoot,"previous",this.previous));this.isUp?(this.view.clear(this.view.currentRoot,!0),this.view.validate()):this.view.refresh();this.isUp=!this.isUp};
function mxGraph(a,b,c,d){this.mouseListeners=null;this.renderHint=c;this.dialect=mxClient.IS_SVG?mxConstants.DIALECT_SVG:c==mxConstants.RENDERING_HINT_EXACT&&mxClient.IS_VML?mxConstants.DIALECT_VML:c==mxConstants.RENDERING_HINT_FASTEST?mxConstants.DIALECT_STRICTHTML:c==mxConstants.RENDERING_HINT_FASTER?mxConstants.DIALECT_PREFERHTML:mxConstants.DIALECT_MIXEDHTML;this.model=null!=b?b:new mxGraphModel;this.multiplicities=[];this.imageBundles=[];this.cellRenderer=this.createCellRenderer();this.setSelectionModel(this.createSelectionModel());
this.setStylesheet(null!=d?d:this.createStylesheet());this.view=this.createGraphView();this.graphModelChangeListener=mxUtils.bind(this,function(a,b){this.graphModelChanged(b.getProperty("edit").changes)});this.model.addListener(mxEvent.CHANGE,this.graphModelChangeListener);this.createHandlers();null!=a&&this.init(a);this.view.revalidate()}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/graph");mxGraph.prototype=new mxEventSource;mxGraph.prototype.constructor=mxGraph;
mxGraph.prototype.EMPTY_ARRAY=[];mxGraph.prototype.mouseListeners=null;mxGraph.prototype.isMouseDown=!1;mxGraph.prototype.model=null;mxGraph.prototype.view=null;mxGraph.prototype.stylesheet=null;mxGraph.prototype.selectionModel=null;mxGraph.prototype.cellEditor=null;mxGraph.prototype.cellRenderer=null;mxGraph.prototype.multiplicities=null;mxGraph.prototype.renderHint=null;mxGraph.prototype.dialect=null;mxGraph.prototype.gridSize=10;mxGraph.prototype.gridEnabled=!0;mxGraph.prototype.portsEnabled=!0;
mxGraph.prototype.nativeDblClickEnabled=!mxClient.IS_QUIRKS&&(null==document.documentMode||10>document.documentMode);mxGraph.prototype.doubleTapEnabled=!0;mxGraph.prototype.doubleTapTimeout=500;mxGraph.prototype.doubleTapTolerance=25;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchY=0;mxGraph.prototype.lastTouchTime=0;mxGraph.prototype.tapAndHoldEnabled=!0;mxGraph.prototype.tapAndHoldDelay=500;mxGraph.prototype.tapAndHoldInProgress=!1;mxGraph.prototype.tapAndHoldValid=!1;
mxGraph.prototype.initialTouchX=0;mxGraph.prototype.initialTouchY=0;mxGraph.prototype.tolerance=4;mxGraph.prototype.defaultOverlap=0.5;mxGraph.prototype.defaultParent=null;mxGraph.prototype.alternateEdgeStyle=null;mxGraph.prototype.backgroundImage=null;mxGraph.prototype.pageVisible=!1;mxGraph.prototype.pageBreaksVisible=!1;mxGraph.prototype.pageBreakColor="gray";mxGraph.prototype.pageBreakDashed=!0;mxGraph.prototype.minPageBreakDist=20;mxGraph.prototype.preferPageSize=!1;
mxGraph.prototype.pageFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;mxGraph.prototype.pageScale=1.5;mxGraph.prototype.enabled=!0;mxGraph.prototype.escapeEnabled=!0;mxGraph.prototype.invokesStopCellEditing=!0;mxGraph.prototype.enterStopsCellEditing=!1;mxGraph.prototype.useScrollbarsForPanning=!0;mxGraph.prototype.exportEnabled=!0;mxGraph.prototype.importEnabled=!0;mxGraph.prototype.cellsLocked=!1;mxGraph.prototype.cellsCloneable=!0;mxGraph.prototype.foldingEnabled=!0;mxGraph.prototype.cellsEditable=!0;
mxGraph.prototype.cellsDeletable=!0;mxGraph.prototype.cellsMovable=!0;mxGraph.prototype.edgeLabelsMovable=!0;mxGraph.prototype.vertexLabelsMovable=!1;mxGraph.prototype.dropEnabled=!1;mxGraph.prototype.splitEnabled=!0;mxGraph.prototype.cellsResizable=!0;mxGraph.prototype.cellsBendable=!0;mxGraph.prototype.cellsSelectable=!0;mxGraph.prototype.cellsDisconnectable=!0;mxGraph.prototype.autoSizeCells=!1;mxGraph.prototype.autoScroll=!0;mxGraph.prototype.timerAutoScroll=!1;
mxGraph.prototype.allowAutoPanning=!1;mxGraph.prototype.ignoreScrollbars=!1;mxGraph.prototype.autoExtend=!0;mxGraph.prototype.maximumGraphBounds=null;mxGraph.prototype.minimumGraphSize=null;mxGraph.prototype.minimumContainerSize=null;mxGraph.prototype.maximumContainerSize=null;mxGraph.prototype.resizeContainer=!1;mxGraph.prototype.border=0;mxGraph.prototype.ordered=!0;mxGraph.prototype.keepEdgesInForeground=!1;mxGraph.prototype.keepEdgesInBackground=!0;mxGraph.prototype.allowNegativeCoordinates=!0;
mxGraph.prototype.constrainChildren=!0;mxGraph.prototype.constrainChildrenOnResize=!1;mxGraph.prototype.extendParents=!0;mxGraph.prototype.extendParentsOnAdd=!0;mxGraph.prototype.extendParentsOnMove=!1;mxGraph.prototype.recursiveResize=!1;mxGraph.prototype.collapseToPreferredSize=!0;mxGraph.prototype.zoomFactor=1.2;mxGraph.prototype.keepSelectionVisibleOnZoom=!1;mxGraph.prototype.centerZoom=!0;mxGraph.prototype.resetViewOnRootChange=!0;mxGraph.prototype.resetEdgesOnResize=!1;
mxGraph.prototype.resetEdgesOnMove=!1;mxGraph.prototype.resetEdgesOnConnect=!0;mxGraph.prototype.allowLoops=!1;mxGraph.prototype.defaultLoopStyle=mxEdgeStyle.Loop;mxGraph.prototype.multigraph=!0;mxGraph.prototype.connectableEdges=!1;mxGraph.prototype.allowDanglingEdges=!0;mxGraph.prototype.cloneInvalidEdges=!1;mxGraph.prototype.disconnectOnMove=!0;mxGraph.prototype.labelsVisible=!0;mxGraph.prototype.htmlLabels=!1;mxGraph.prototype.swimlaneSelectionEnabled=!0;mxGraph.prototype.swimlaneNesting=!0;
mxGraph.prototype.swimlaneIndicatorColorAttribute=mxConstants.STYLE_FILLCOLOR;mxGraph.prototype.imageBundles=null;mxGraph.prototype.minFitScale=0.1;mxGraph.prototype.maxFitScale=8;mxGraph.prototype.panDx=0;mxGraph.prototype.panDy=0;mxGraph.prototype.collapsedImage=new mxImage(mxClient.imageBasePath+"/collapsed.gif",9,9);mxGraph.prototype.expandedImage=new mxImage(mxClient.imageBasePath+"/expanded.gif",9,9);
mxGraph.prototype.warningImage=new mxImage(mxClient.imageBasePath+"/warning"+(mxClient.IS_MAC?".png":".gif"),16,16);mxGraph.prototype.alreadyConnectedResource="none"!=mxClient.language?"alreadyConnected":"";mxGraph.prototype.containsValidationErrorsResource="none"!=mxClient.language?"containsValidationErrors":"";mxGraph.prototype.collapseExpandResource="none"!=mxClient.language?"collapse-expand":"";
mxGraph.prototype.init=function(a){this.container=a;this.cellEditor=this.createCellEditor();this.view.init();this.sizeDidChange();mxClient.IS_IE&&(mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})),mxEvent.addListener(a,"selectstart",mxUtils.bind(this,function(){return this.isEditing()})));8==document.documentMode&&a.insertAdjacentHTML("beforeend",'<v:group style="DISPLAY: none;"></v:group>')};
mxGraph.prototype.createHandlers=function(){this.tooltipHandler=new mxTooltipHandler(this);this.tooltipHandler.setEnabled(!1);this.selectionCellsHandler=new mxSelectionCellsHandler(this);this.connectionHandler=new mxConnectionHandler(this);this.connectionHandler.setEnabled(!1);this.graphHandler=new mxGraphHandler(this);this.panningHandler=new mxPanningHandler(this);this.panningHandler.panningEnabled=!1;this.popupMenuHandler=new mxPopupMenuHandler(this)};mxGraph.prototype.createSelectionModel=function(){return new mxGraphSelectionModel(this)};
mxGraph.prototype.createStylesheet=function(){return new mxStylesheet};mxGraph.prototype.createGraphView=function(){return new mxGraphView(this)};mxGraph.prototype.createCellRenderer=function(){return new mxCellRenderer};mxGraph.prototype.createCellEditor=function(){return new mxCellEditor(this)};mxGraph.prototype.getModel=function(){return this.model};mxGraph.prototype.getView=function(){return this.view};mxGraph.prototype.getStylesheet=function(){return this.stylesheet};
mxGraph.prototype.setStylesheet=function(a){this.stylesheet=a};mxGraph.prototype.getSelectionModel=function(){return this.selectionModel};mxGraph.prototype.setSelectionModel=function(a){this.selectionModel=a};mxGraph.prototype.getSelectionCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d.constructor!=mxRootChange){var e=null;d instanceof mxChildChange&&null==d.previous?e=d.child:null!=d.cell&&d.cell instanceof mxCell&&(e=d.cell);null!=e&&0>mxUtils.indexOf(b,e)&&b.push(e)}}return this.getModel().getTopmostCells(b)};
mxGraph.prototype.graphModelChanged=function(a){for(var b=0;b<a.length;b++)this.processChange(a[b]);this.removeSelectionCells(this.getRemovedCellsForChanges(a));this.view.validate();this.sizeDidChange()};mxGraph.prototype.getRemovedCellsForChanges=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];if(d instanceof mxRootChange)break;else d instanceof mxChildChange?null!=d.previous&&null==d.parent&&(b=b.concat(this.model.getDescendants(d.child))):d instanceof mxVisibleChange&&(b=b.concat(this.model.getDescendants(d.cell)))}return b};
mxGraph.prototype.processChange=function(a){if(a instanceof mxRootChange)this.clearSelection(),this.removeStateForCell(a.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new mxEventObject(mxEvent.ROOT));else if(a instanceof mxChildChange){var b=this.model.getParent(a.child);null!=b?this.view.invalidate(a.child,!0,!1,null!=a.previous):(this.removeStateForCell(a.child),this.view.currentRoot==a.child&&this.home());b!=a.previous&&
(null!=b&&this.view.invalidate(b,!1,!1),null!=a.previous&&this.view.invalidate(a.previous,!1,!1))}else a instanceof mxTerminalChange||a instanceof mxGeometryChange?this.view.invalidate(a.cell):a instanceof mxValueChange?this.view.invalidate(a.cell,!1,!1):a instanceof mxStyleChange?(this.view.invalidate(a.cell,!0,!0,!1),this.view.removeState(a.cell)):null!=a.cell&&a.cell instanceof mxCell&&this.removeStateForCell(a.cell)};
mxGraph.prototype.removeStateForCell=function(a){for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.removeStateForCell(this.model.getChildAt(a,c));this.view.removeState(a)};mxGraph.prototype.addCellOverlay=function(a,b){null==a.overlays&&(a.overlays=[]);a.overlays.push(b);var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);this.fireEvent(new mxEventObject(mxEvent.ADD_OVERLAY,"cell",a,"overlay",b));return b};mxGraph.prototype.getCellOverlays=function(a){return a.overlays};
mxGraph.prototype.removeCellOverlay=function(a,b){if(null==b)this.removeCellOverlays(a);else{var c=mxUtils.indexOf(a.overlays,b);0<=c?(a.overlays.splice(c,1),0==a.overlays.length&&(a.overlays=null),c=this.view.getState(a),null!=c&&this.cellRenderer.redraw(c),this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b))):b=null}return b};
mxGraph.prototype.removeCellOverlays=function(a){var b=a.overlays;if(null!=b){a.overlays=null;var c=this.view.getState(a);null!=c&&this.cellRenderer.redraw(c);for(c=0;c<b.length;c++)this.fireEvent(new mxEventObject(mxEvent.REMOVE_OVERLAY,"cell",a,"overlay",b[c]))}return b};mxGraph.prototype.clearCellOverlays=function(a){a=null!=a?a:this.model.getRoot();this.removeCellOverlays(a);for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.clearCellOverlays(this.model.getChildAt(a,c))};
mxGraph.prototype.setCellWarning=function(a,b,c,d){if(null!=b&&0<b.length)return c=null!=c?c:this.warningImage,b=new mxCellOverlay(c,"<font color=red>"+b+"</font>"),d&&b.addListener(mxEvent.CLICK,mxUtils.bind(this,function(){this.isEnabled()&&this.setSelectionCell(a)})),this.addCellOverlay(a,b);this.removeCellOverlays(a);return null};mxGraph.prototype.startEditing=function(a){this.startEditingAtCell(null,a)};
mxGraph.prototype.startEditingAtCell=function(a,b){null==a&&(a=this.getSelectionCell(),null!=a&&!this.isCellEditable(a)&&(a=null));null!=a&&(this.fireEvent(new mxEventObject(mxEvent.START_EDITING,"cell",a,"event",b)),this.cellEditor.startEditing(a,b))};mxGraph.prototype.getEditingValue=function(a){return this.convertValueToString(a)};mxGraph.prototype.stopEditing=function(a){this.cellEditor.stopEditing(a)};
mxGraph.prototype.labelChanged=function(a,b,c){this.model.beginUpdate();try{var d=a.value;this.cellLabelChanged(a,b,this.isAutoSizeCell(a));this.fireEvent(new mxEventObject(mxEvent.LABEL_CHANGED,"cell",a,"value",b,"old",d,"event",c))}finally{this.model.endUpdate()}return a};mxGraph.prototype.cellLabelChanged=function(a,b,c){this.model.beginUpdate();try{this.model.setValue(a,b),c&&this.cellSizeUpdated(a,!1)}finally{this.model.endUpdate()}};
mxGraph.prototype.escape=function(a){this.stopEditing(!0);this.connectionHandler.reset();this.graphHandler.reset();for(var a=this.getSelectionCells(),b=0;b<a.length;b++){var c=this.view.getState(a[b]);null!=c&&null!=c.handler&&c.handler.reset()}};
mxGraph.prototype.click=function(a){var b=a.getEvent(),c=a.getCell(),d=new mxEventObject(mxEvent.CLICK,"event",b,"cell",c);a.isConsumed()&&d.consume();this.fireEvent(d);this.isEnabled()&&!mxEvent.isConsumed(b)&&!d.isConsumed()&&(null!=c?this.selectCellForEvent(c,b):(c=null,this.isSwimlaneSelectionEnabled()&&(c=this.getSwimlaneAt(a.getGraphX(),a.getGraphY())),null!=c?this.selectCellForEvent(c,b):this.isToggleEvent(b)||this.clearSelection()))};
mxGraph.prototype.dblClick=function(a,b){var c=new mxEventObject(mxEvent.DOUBLE_CLICK,"event",a,"cell",b);this.fireEvent(c);this.isEnabled()&&!mxEvent.isConsumed(a)&&!c.isConsumed()&&null!=b&&this.isCellEditable(b)&&!this.isEditing(b)&&(this.startEditingAtCell(b,a),mxEvent.consume(a))};
mxGraph.prototype.tapAndHold=function(a){var b=a.getEvent(),c=new mxEventObject(mxEvent.TAP_AND_HOLD,"event",b,"cell",a.getCell());this.fireEvent(c);c.isConsumed()&&(this.panningHandler.panningTrigger=!1);this.isEnabled()&&!mxEvent.isConsumed(b)&&!c.isConsumed()&&this.connectionHandler.isEnabled()&&(b=this.view.getState(this.connectionHandler.marker.getCell(a)),null!=b&&(this.connectionHandler.marker.currentColor=this.connectionHandler.marker.validColor,this.connectionHandler.marker.markedState=b,
this.connectionHandler.marker.mark(),this.connectionHandler.first=new mxPoint(a.getGraphX(),a.getGraphY()),this.connectionHandler.edgeState=this.connectionHandler.createEdgeState(a),this.connectionHandler.previous=b,this.connectionHandler.fireEvent(new mxEventObject(mxEvent.START,"state",this.connectionHandler.previous))))};
mxGraph.prototype.scrollPointToVisible=function(a,b,c,d){if(!this.timerAutoScroll&&(this.ignoreScrollbars||mxUtils.hasScrollbars(this.container))){var e=this.container,d=null!=d?d:20;if(a>=e.scrollLeft&&b>=e.scrollTop&&a<=e.scrollLeft+e.clientWidth&&b<=e.scrollTop+e.clientHeight){var f=e.scrollLeft+e.clientWidth-a;if(f<d){if(a=e.scrollLeft,e.scrollLeft+=d-f,c&&a==e.scrollLeft){if(this.dialect==mxConstants.DIALECT_SVG)var a=this.view.getDrawPane().ownerSVGElement,g=this.container.scrollWidth+d-f;else g=
Math.max(e.clientWidth,e.scrollWidth)+d-f,a=this.view.getCanvas();a.style.width=g+"px";e.scrollLeft+=d-f}}else f=a-e.scrollLeft,f<d&&(e.scrollLeft-=d-f);f=e.scrollTop+e.clientHeight-b;f<d?(a=e.scrollTop,e.scrollTop+=d-f,a==e.scrollTop&&c&&(this.dialect==mxConstants.DIALECT_SVG?(a=this.view.getDrawPane().ownerSVGElement,b=this.container.scrollHeight+d-f):(b=Math.max(e.clientHeight,e.scrollHeight)+d-f,a=this.view.getCanvas()),a.style.height=b+"px",e.scrollTop+=d-f)):(f=b-e.scrollTop,f<d&&(e.scrollTop-=
d-f))}}else this.allowAutoPanning&&!this.panningHandler.active&&(null==this.panningManager&&(this.panningManager=this.createPanningManager()),this.panningManager.panTo(a+this.panDx,b+this.panDy))};mxGraph.prototype.createPanningManager=function(){return new mxPanningManager(this)};
mxGraph.prototype.getBorderSizes=function(){function a(a){var b=0,b="thin"==a?2:"medium"==a?4:"thick"==a?6:parseInt(a);isNaN(b)&&(b=0);return b}var b=mxUtils.getCurrentStyle(this.container),c=new mxRectangle;c.x=a(b.borderLeftWidth)+parseInt(b.paddingLeft||0);c.y=a(b.borderTopWidth)+parseInt(b.paddingTop||0);c.width=a(b.borderRightWidth)+parseInt(b.paddingRight||0);c.height=a(b.borderBottomWidth)+parseInt(b.paddingBottom||0);return c};
mxGraph.prototype.getPreferredPageSize=function(a,b,c){var a=this.view.scale,d=this.view.translate,e=this.pageFormat,f=a*this.pageScale,e=new mxRectangle(0,0,e.width*f,e.height*f),b=this.pageBreaksVisible?Math.ceil(b/e.width):1,c=this.pageBreaksVisible?Math.ceil(c/e.height):1;return new mxRectangle(0,0,b*e.width+2+d.x/a,c*e.height+2+d.y/a)};
mxGraph.prototype.sizeDidChange=function(){var a=this.getGraphBounds();if(null!=this.container){var b=this.getBorder(),c=Math.max(0,a.x+a.width+1+b),b=Math.max(0,a.y+a.height+1+b);null!=this.minimumContainerSize&&(c=Math.max(c,this.minimumContainerSize.width),b=Math.max(b,this.minimumContainerSize.height));this.resizeContainer&&this.doResizeContainer(c,b);if(this.preferPageSize||!mxClient.IS_IE&&this.pageVisible){var d=this.getPreferredPageSize(a,c,b);null!=d&&(c=d.width,b=d.height)}null!=this.minimumGraphSize&&
(c=Math.max(c,this.minimumGraphSize.width*this.view.scale),b=Math.max(b,this.minimumGraphSize.height*this.view.scale));c=Math.ceil(c-1);b=Math.ceil(b-1);this.dialect==mxConstants.DIALECT_SVG?(d=this.view.getDrawPane().ownerSVGElement,d.style.minWidth=Math.max(1,c)+"px",d.style.minHeight=Math.max(1,b)+"px",d.style.width="100%",d.style.height="100%"):mxClient.IS_QUIRKS?this.view.updateHtmlCanvasSize(Math.max(1,c),Math.max(1,b)):(this.view.canvas.style.minWidth=Math.max(1,c)+"px",this.view.canvas.style.minHeight=
Math.max(1,b)+"px");this.updatePageBreaks(this.pageBreaksVisible,c-1,b-1)}this.fireEvent(new mxEventObject(mxEvent.SIZE,"bounds",a))};
mxGraph.prototype.doResizeContainer=function(a,b){if(mxClient.IS_IE)if(mxClient.IS_QUIRKS)var c=this.getBorderSizes(),a=a+Math.max(2,c.x+c.width+1),b=b+Math.max(2,c.y+c.height+1);else 9<=document.documentMode?(a+=3,b+=5):(a+=1,b+=1);else b+=1;null!=this.maximumContainerSize&&(a=Math.min(this.maximumContainerSize.width,a),b=Math.min(this.maximumContainerSize.height,b));this.container.style.width=Math.ceil(a)+"px";this.container.style.height=Math.ceil(b)+"px"};
mxGraph.prototype.updatePageBreaks=function(a,b,c){var d=this.view.scale,e=this.view.translate,f=this.pageFormat,g=d*this.pageScale,e=new mxRectangle(d*e.x,d*e.y,f.width*g,f.height*g),a=a&&Math.min(e.width,e.height)>this.minPageBreakDist;e.x=mxUtils.mod(e.x,e.width);e.y=mxUtils.mod(e.y,e.height);f=a?Math.ceil((b-e.x)/e.width):0;a=a?Math.ceil((c-e.y)/e.height):0;null==this.horizontalPageBreaks&&0<f&&(this.horizontalPageBreaks=[]);if(null!=this.horizontalPageBreaks){for(g=0;g<=f;g++){var h=[new mxPoint(e.x+
g*e.width,1),new mxPoint(e.x+g*e.width,c)];null!=this.horizontalPageBreaks[g]?(this.horizontalPageBreaks[g].points=h,this.horizontalPageBreaks[g].redraw()):(h=new mxPolyline(h,this.pageBreakColor,this.scale),h.dialect=this.dialect,h.isDashed=this.pageBreakDashed,h.init(this.view.backgroundPane),h.redraw(),this.horizontalPageBreaks[g]=h)}for(g=f;g<this.horizontalPageBreaks.length;g++)this.horizontalPageBreaks[g].destroy();this.horizontalPageBreaks.splice(f,this.horizontalPageBreaks.length-f)}null==
this.verticalPageBreaks&&0<a&&(this.verticalPageBreaks=[]);if(null!=this.verticalPageBreaks){for(g=0;g<=a;g++)h=[new mxPoint(1,e.y+g*e.height),new mxPoint(b,e.y+g*e.height)],null!=this.verticalPageBreaks[g]?(this.verticalPageBreaks[g].points=h,this.verticalPageBreaks[g].redraw()):(h=new mxPolyline(h,this.pageBreakColor,d),h.dialect=this.dialect,h.isDashed=this.pageBreakDashed,h.init(this.view.backgroundPane),h.redraw(),this.verticalPageBreaks[g]=h);for(g=a;g<this.verticalPageBreaks.length;g++)this.verticalPageBreaks[g].destroy();
this.verticalPageBreaks.splice(a,this.verticalPageBreaks.length-a)}};mxGraph.prototype.getCellStyle=function(a){var b=this.model.getStyle(a),c=null,c=this.model.isEdge(a)?this.stylesheet.getDefaultEdgeStyle():this.stylesheet.getDefaultVertexStyle();null!=b&&(c=this.postProcessCellStyle(this.stylesheet.getCellStyle(b,c)));null==c&&(c=mxGraph.prototype.EMPTY_ARRAY);return c};
mxGraph.prototype.postProcessCellStyle=function(a){if(null!=a){var b=a[mxConstants.STYLE_IMAGE],c=this.getImageFromBundles(b);null!=c?a[mxConstants.STYLE_IMAGE]=c:c=b;null!=c&&"data:image/"==c.substring(0,11)&&("data:image/svg+xml,"!=c.substring(0,19)&&(b=c.indexOf(","),0<b&&(c=c.substring(0,b)+";base64,"+c.substring(b+1))),a[mxConstants.STYLE_IMAGE]=c)}return a};
mxGraph.prototype.setCellStyle=function(a,b){b=b||this.getSelectionCells();if(null!=b){this.model.beginUpdate();try{for(var c=0;c<b.length;c++)this.model.setStyle(b[c],a)}finally{this.model.endUpdate()}}};mxGraph.prototype.toggleCellStyle=function(a,b,c){c=c||this.getSelectionCell();this.toggleCellStyles(a,b,[c])};
mxGraph.prototype.toggleCellStyles=function(a,b,c){b=null!=b?b:!1;c=c||this.getSelectionCells();if(null!=c&&0<c.length){var d=this.view.getState(c[0]),d=null!=d?d.style:this.getCellStyle(c[0]);null!=d&&(b=mxUtils.getValue(d,a,b)?0:1,this.setCellStyles(a,b,c))}};mxGraph.prototype.setCellStyles=function(a,b,c){c=c||this.getSelectionCells();mxUtils.setCellStyles(this.model,c,a,b)};mxGraph.prototype.toggleCellStyleFlags=function(a,b,c){this.setCellStyleFlags(a,b,null,c)};
mxGraph.prototype.setCellStyleFlags=function(a,b,c,d){d=d||this.getSelectionCells();if(null!=d&&0<d.length){if(null==c){var e=this.view.getState(d[0]),e=null!=e?e.style:this.getCellStyle(d[0]);null!=e&&(c=(parseInt(e[a]||0)&b)!=b)}mxUtils.setCellStyleFlags(this.model,d,a,b,c)}};
mxGraph.prototype.alignCells=function(a,b,c){null==b&&(b=this.getSelectionCells());if(null!=b&&1<b.length){if(null==c)for(var d=0;d<b.length;d++){var e=this.view.getState(b[d]);if(null!=e&&!this.model.isEdge(b[d]))if(null==c)if(a==mxConstants.ALIGN_CENTER){c=e.x+e.width/2;break}else if(a==mxConstants.ALIGN_RIGHT)c=e.x+e.width;else if(a==mxConstants.ALIGN_TOP)c=e.y;else if(a==mxConstants.ALIGN_MIDDLE){c=e.y+e.height/2;break}else c=a==mxConstants.ALIGN_BOTTOM?e.y+e.height:e.x;else c=a==mxConstants.ALIGN_RIGHT?
Math.max(c,e.x+e.width):a==mxConstants.ALIGN_TOP?Math.min(c,e.y):a==mxConstants.ALIGN_BOTTOM?Math.max(c,e.y+e.height):Math.min(c,e.x)}if(null!=c){var f=this.view.scale;this.model.beginUpdate();try{for(d=0;d<b.length;d++)if(e=this.view.getState(b[d]),null!=e){var g=this.getCellGeometry(b[d]);null!=g&&!this.model.isEdge(b[d])&&(g=g.clone(),a==mxConstants.ALIGN_CENTER?g.x+=(c-e.x-e.width/2)/f:a==mxConstants.ALIGN_RIGHT?g.x+=(c-e.x-e.width)/f:a==mxConstants.ALIGN_TOP?g.y+=(c-e.y)/f:a==mxConstants.ALIGN_MIDDLE?
g.y+=(c-e.y-e.height/2)/f:a==mxConstants.ALIGN_BOTTOM?g.y+=(c-e.y-e.height)/f:g.x+=(c-e.x)/f,this.resizeCell(b[d],g))}this.fireEvent(new mxEventObject(mxEvent.ALIGN_CELLS,"align",a,"cells",b))}finally{this.model.endUpdate()}}}return b};
mxGraph.prototype.flipEdge=function(a){if(null!=a&&null!=this.alternateEdgeStyle){this.model.beginUpdate();try{var b=this.model.getStyle(a);null==b||0==b.length?this.model.setStyle(a,this.alternateEdgeStyle):this.model.setStyle(a,null);this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.FLIP_EDGE,"edge",a))}finally{this.model.endUpdate()}}return a};mxGraph.prototype.addImageBundle=function(a){this.imageBundles.push(a)};
mxGraph.prototype.removeImageBundle=function(a){for(var b=[],c=0;c<this.imageBundles.length;c++)this.imageBundles[c]!=a&&b.push(this.imageBundles[c]);this.imageBundles=b};mxGraph.prototype.getImageFromBundles=function(a){if(null!=a)for(var b=0;b<this.imageBundles.length;b++){var c=this.imageBundles[b].getImage(a);if(null!=c)return c}return null};
mxGraph.prototype.orderCells=function(a,b){null==b&&(b=mxUtils.sortCells(this.getSelectionCells(),!0));this.model.beginUpdate();try{this.cellsOrdered(b,a),this.fireEvent(new mxEventObject(mxEvent.ORDER_CELLS,"back",a,"cells",b))}finally{this.model.endUpdate()}return b};
mxGraph.prototype.cellsOrdered=function(a,b){if(null!=a){this.model.beginUpdate();try{for(var c=0;c<a.length;c++){var d=this.model.getParent(a[c]);b?this.model.add(d,a[c],c):this.model.add(d,a[c],this.model.getChildCount(d)-1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ORDERED,"back",b,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.groupCells=function(a,b,c){null==c&&(c=mxUtils.sortCells(this.getSelectionCells(),!0));c=this.getCellsForGroup(c);null==a&&(a=this.createGroupCell(c));var d=this.getBoundsForGroup(a,c,b);if(0<c.length&&null!=d){var e=this.model.getParent(a);null==e&&(e=this.model.getParent(c[0]));this.model.beginUpdate();try{null==this.getCellGeometry(a)&&this.model.setGeometry(a,new mxGeometry);var f=this.model.getChildCount(e);this.cellsAdded([a],e,f,null,null,!1);f=this.model.getChildCount(a);
this.cellsAdded(c,a,f,null,null,!1,!1);this.cellsMoved(c,-d.x,-d.y,!1,!0);this.cellsResized([a],[d],!1);this.fireEvent(new mxEventObject(mxEvent.GROUP_CELLS,"group",a,"border",b,"cells",c))}finally{this.model.endUpdate()}}return a};mxGraph.prototype.getCellsForGroup=function(a){var b=[];if(null!=a&&0<a.length){var c=this.model.getParent(a[0]);b.push(a[0]);for(var d=1;d<a.length;d++)this.model.getParent(a[d])==c&&b.push(a[d])}return b};
mxGraph.prototype.getBoundsForGroup=function(a,b,c){b=this.getBoundingBoxFromGeometry(b);null!=b&&(this.isSwimlane(a)&&(a=this.getStartSize(a),b.x-=a.width,b.y-=a.height,b.width+=a.width,b.height+=a.height),b.x-=c,b.y-=c,b.width+=2*c,b.height+=2*c);return b};mxGraph.prototype.createGroupCell=function(a){a=new mxCell("");a.setVertex(!0);a.setConnectable(!1);return a};
mxGraph.prototype.ungroupCells=function(a){var b=[];if(null==a){for(var a=this.getSelectionCells(),c=[],d=0;d<a.length;d++)0<this.model.getChildCount(a[d])&&c.push(a[d]);a=c}if(null!=a&&0<a.length){this.model.beginUpdate();try{for(d=0;d<a.length;d++){var e=this.model.getChildren(a[d]);if(null!=e&&0<e.length){var e=e.slice(),f=this.model.getParent(a[d]),g=this.model.getChildCount(f);this.cellsAdded(e,f,g,null,null,!0);b=b.concat(e)}}this.cellsRemoved(this.addAllEdges(a));this.fireEvent(new mxEventObject(mxEvent.UNGROUP_CELLS,
"cells",a))}finally{this.model.endUpdate()}}return b};mxGraph.prototype.removeCellsFromParent=function(a){null==a&&(a=this.getSelectionCells());this.model.beginUpdate();try{var b=this.getDefaultParent(),c=this.model.getChildCount(b);this.cellsAdded(a,b,c,null,null,!0);this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS_FROM_PARENT,"cells",a))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.updateGroupBounds=function(a,b,c){null==a&&(a=this.getSelectionCells());b=null!=b?b:0;c=null!=c?c:!1;this.model.beginUpdate();try{for(var d=0;d<a.length;d++){var e=this.getCellGeometry(a[d]);if(null!=e){var f=this.getChildCells(a[d]);if(null!=f&&0<f.length){var g=this.getBoundingBoxFromGeometry(f);if(0<g.width&&0<g.height){var h=this.isSwimlane(a[d])?this.getStartSize(a[d]):new mxRectangle,e=e.clone();c&&(e.x+=g.x-h.width-b,e.y+=g.y-h.height-b);e.width=g.width+h.width+2*b;e.height=
g.height+h.height+2*b;this.model.setGeometry(a[d],e);this.moveCells(f,-g.x+h.width+b,-g.y+h.height+b)}}}}}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cloneCells=function(a,b){var b=null!=b?b:!0,c=null;if(null!=a){for(var d={},c=[],e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e];c.push(a[e])}if(0<c.length)for(var f=this.view.scale,g=this.view.translate,c=this.model.cloneCells(a,!0),e=0;e<a.length;e++)if(!b&&this.model.isEdge(c[e])&&null!=this.getEdgeValidationError(c[e],this.model.getTerminal(c[e],!0),this.model.getTerminal(c[e],!1)))c[e]=null;else{var h=this.model.getGeometry(c[e]);if(null!=h){var k=this.view.getState(a[e]),
l=this.view.getState(this.model.getParent(a[e]));if(null!=k&&null!=l){var m=l.origin.x,l=l.origin.y;if(this.model.isEdge(c[e])){for(var k=k.absolutePoints,n=this.model.getTerminal(a[e],!0),o=mxCellPath.create(n);null!=n&&null==d[o];)n=this.model.getParent(n),o=mxCellPath.create(n);null==n&&h.setTerminalPoint(new mxPoint(k[0].x/f-g.x,k[0].y/f-g.y),!0);n=this.model.getTerminal(a[e],!1);for(o=mxCellPath.create(n);null!=n&&null==d[o];)n=this.model.getParent(n),o=mxCellPath.create(n);null==n&&(n=k.length-
1,h.setTerminalPoint(new mxPoint(k[n].x/f-g.x,k[n].y/f-g.y),!1));h=h.points;if(null!=h)for(k=0;k<h.length;k++)h[k].x+=m,h[k].y+=l}else h.x+=m,h.y+=l}}}else c=[]}return c};mxGraph.prototype.insertVertex=function(a,b,c,d,e,f,g,h,k){b=this.createVertex(a,b,c,d,e,f,g,h,k);return this.addCell(b,a)};mxGraph.prototype.createVertex=function(a,b,c,d,e,f,g,h,k){a=new mxGeometry(d,e,f,g);a.relative=null!=k?k:!1;c=new mxCell(c,a,h);c.setId(b);c.setVertex(!0);c.setConnectable(!0);return c};
mxGraph.prototype.insertEdge=function(a,b,c,d,e,f){b=this.createEdge(a,b,c,d,e,f);return this.addEdge(b,a,d,e)};mxGraph.prototype.createEdge=function(a,b,c,d,e,f){a=new mxCell(c,new mxGeometry,f);a.setId(b);a.setEdge(!0);a.geometry.relative=!0;return a};mxGraph.prototype.addEdge=function(a,b,c,d,e){return this.addCell(a,b,e,c,d)};mxGraph.prototype.addCell=function(a,b,c,d,e){return this.addCells([a],b,c,d,e)[0]};
mxGraph.prototype.addCells=function(a,b,c,d,e){null==b&&(b=this.getDefaultParent());null==c&&(c=this.model.getChildCount(b));this.model.beginUpdate();try{this.cellsAdded(a,b,c,d,e,!1,!0),this.fireEvent(new mxEventObject(mxEvent.ADD_CELLS,"cells",a,"parent",b,"index",c,"source",d,"target",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsAdded=function(a,b,c,d,e,f,g){if(null!=a&&null!=b&&null!=c){this.model.beginUpdate();try{for(var h=f?this.view.getState(b):null,k=null!=h?h.origin:null,l=new mxPoint(0,0),h=0;h<a.length;h++)if(null==a[h])c--;else{var m=this.model.getParent(a[h]);if(null!=k&&a[h]!=b&&b!=m){var n=this.view.getState(m),o=null!=n?n.origin:l,q=this.model.getGeometry(a[h]);if(null!=q){var r=o.x-k.x,u=o.y-k.y,q=q.clone();q.translate(r,u);!q.relative&&this.model.isVertex(a[h])&&!this.isAllowNegativeCoordinates()&&
(q.x=Math.max(0,q.x),q.y=Math.max(0,q.y));this.model.setGeometry(a[h],q)}}b==m&&c+h>this.model.getChildCount(b)&&c--;this.model.add(b,a[h],c+h);this.isExtendParentsOnAdd()&&this.isExtendParent(a[h])?this.extendParent(a[h]):(null==g||g)&&this.constrainChild(a[h]);null!=d&&this.cellConnected(a[h],d,!0);null!=e&&this.cellConnected(a[h],e,!1)}this.fireEvent(new mxEventObject(mxEvent.CELLS_ADDED,"cells",a,"parent",b,"index",c,"source",d,"target",e,"absolute",f))}finally{this.model.endUpdate()}}};
mxGraph.prototype.removeCells=function(a,b){b=null!=b?b:!0;null==a&&(a=this.getDeletableCells(this.getSelectionCells()));b&&(a=this.getDeletableCells(this.addAllEdges(a)));this.model.beginUpdate();try{this.cellsRemoved(a),this.fireEvent(new mxEventObject(mxEvent.REMOVE_CELLS,"cells",a,"includeEdges",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsRemoved=function(a){if(null!=a&&0<a.length){var b=this.view.scale,c=this.view.translate;this.model.beginUpdate();try{for(var d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++){for(var g=this.getConnections(a[e]),h=0;h<g.length;h++)if(f=mxCellPath.create(g[h]),null==d[f]){var k=this.model.getGeometry(g[h]);if(null!=k){var l=this.view.getState(g[h]);if(null!=l){var k=k.clone(),m=l.getVisibleTerminal(!0)==a[e],n=l.absolutePoints,o=m?0:n.length-
1;k.setTerminalPoint(new mxPoint(n[o].x/b-c.x,n[o].y/b-c.y),m);this.model.setTerminal(g[h],null,m);this.model.setGeometry(g[h],k)}}}this.model.remove(a[e])}this.fireEvent(new mxEventObject(mxEvent.CELLS_REMOVED,"cells",a))}finally{this.model.endUpdate()}}};
mxGraph.prototype.splitEdge=function(a,b,c,d,e){d=d||0;e=e||0;null==c&&(c=this.cloneCells([a])[0]);var f=this.model.getParent(a),g=this.model.getTerminal(a,!0);this.model.beginUpdate();try{this.cellsMoved(b,d,e,!1,!1),this.cellsAdded(b,f,this.model.getChildCount(f),null,null,!0),this.cellsAdded([c],f,this.model.getChildCount(f),g,b[0],!1),this.cellConnected(a,b[0],!0),this.fireEvent(new mxEventObject(mxEvent.SPLIT_EDGE,"edge",a,"cells",b,"newEdge",c,"dx",d,"dy",e))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.toggleCells=function(a,b,c){null==b&&(b=this.getSelectionCells());c&&(b=this.addAllEdges(b));this.model.beginUpdate();try{this.cellsToggled(b,a),this.fireEvent(new mxEventObject(mxEvent.TOGGLE_CELLS,"show",a,"cells",b,"includeEdges",c))}finally{this.model.endUpdate()}return b};mxGraph.prototype.cellsToggled=function(a,b){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var c=0;c<a.length;c++)this.model.setVisible(a[c],b)}finally{this.model.endUpdate()}}};
mxGraph.prototype.foldCells=function(a,b,c,d){b=null!=b?b:!1;null==c&&(c=this.getFoldableCells(this.getSelectionCells(),a));this.stopEditing(!1);this.model.beginUpdate();try{this.cellsFolded(c,a,b,d),this.fireEvent(new mxEventObject(mxEvent.FOLD_CELLS,"collapse",a,"recurse",b,"cells",c))}finally{this.model.endUpdate()}return c};
mxGraph.prototype.cellsFolded=function(a,b,c,d){if(null!=a&&0<a.length){this.model.beginUpdate();try{for(var e=0;e<a.length;e++)if((!d||this.isCellFoldable(a[e],b))&&b!=this.isCellCollapsed(a[e]))(this.model.setCollapsed(a[e],b),this.swapBounds(a[e],b),this.isExtendParent(a[e])&&this.extendParent(a[e]),c)&&this.foldCells(this.model.getChildren(a[e]),b,c);this.fireEvent(new mxEventObject(mxEvent.CELLS_FOLDED,"cells",a,"collapse",b,"recurse",c))}finally{this.model.endUpdate()}}};
mxGraph.prototype.swapBounds=function(a,b){if(null!=a){var c=this.model.getGeometry(a);null!=c&&(c=c.clone(),this.updateAlternateBounds(a,c,b),c.swap(),this.model.setGeometry(a,c))}};
mxGraph.prototype.updateAlternateBounds=function(a,b,c){if(null!=a&&null!=b){c=this.view.getState(a);c=null!=c?c.style:this.getCellStyle(a);if(null==b.alternateBounds){var d=b;this.collapseToPreferredSize&&(a=this.getPreferredSizeForCell(a),null!=a&&(d=a,a=mxUtils.getValue(c,mxConstants.STYLE_STARTSIZE),0<a&&(d.height=Math.max(d.height,a))));b.alternateBounds=new mxRectangle(0,0,d.width,d.height)}if(null!=b.alternateBounds){b.alternateBounds.x=b.x;b.alternateBounds.y=b.y;var e=mxUtils.toRadians(c[mxConstants.STYLE_ROTATION]||
"0");0!=e&&(a=b.alternateBounds.getCenterX()-b.getCenterX(),c=b.alternateBounds.getCenterY()-b.getCenterY(),d=Math.cos(e),e=Math.sin(e),b.alternateBounds.x+=d*a-e*c-a,b.alternateBounds.y+=e*a+d*c-c)}}};mxGraph.prototype.addAllEdges=function(a){return a.slice().concat(this.getAllEdges(a))};
mxGraph.prototype.getAllEdges=function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++){for(var d=this.model.getEdgeCount(a[c]),e=0;e<d;e++)b.push(this.model.getEdgeAt(a[c],e));d=this.model.getChildren(a[c]);b=b.concat(this.getAllEdges(d))}return b};mxGraph.prototype.updateCellSize=function(a,b){b=null!=b?b:!1;this.model.beginUpdate();try{this.cellSizeUpdated(a,b),this.fireEvent(new mxEventObject(mxEvent.UPDATE_CELL_SIZE,"cell",a,"ignoreChildren",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellSizeUpdated=function(a,b){if(null!=a){this.model.beginUpdate();try{var c=this.getPreferredSizeForCell(a),d=this.model.getGeometry(a);if(null!=c&&null!=d){var e=this.isCellCollapsed(a),d=d.clone();if(this.isSwimlane(a)){var f=this.view.getState(a),g=null!=f?f.style:this.getCellStyle(a),h=this.model.getStyle(a);null==h&&(h="");mxUtils.getValue(g,mxConstants.STYLE_HORIZONTAL,!0)?(h=mxUtils.setStyle(h,mxConstants.STYLE_STARTSIZE,c.height+8),e&&(d.height=c.height+8),d.width=c.width):
(h=mxUtils.setStyle(h,mxConstants.STYLE_STARTSIZE,c.width+8),e&&(d.width=c.width+8),d.height=c.height);this.model.setStyle(a,h)}else d.width=c.width,d.height=c.height;if(!b&&!e){var k=this.view.getBounds(this.model.getChildren(a));if(null!=k){var l=this.view.translate,m=this.view.scale,n=(k.y+k.height)/m-d.y-l.y;d.width=Math.max(d.width,(k.x+k.width)/m-d.x-l.x);d.height=Math.max(d.height,n)}}this.cellsResized([a],[d],!1)}}finally{this.model.endUpdate()}}};
mxGraph.prototype.getPreferredSizeForCell=function(a){var b=null;if(null!=a){var c=this.view.getState(a),d=null!=c?c.style:this.getCellStyle(a);if(null!=d&&!this.model.isEdge(a)){var e=d[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,f=0,b=0;if((null!=this.getImage(c)||null!=d[mxConstants.STYLE_IMAGE])&&d[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_LABEL)d[mxConstants.STYLE_VERTICAL_ALIGN]==mxConstants.ALIGN_MIDDLE&&(f+=parseFloat(d[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),
d[mxConstants.STYLE_ALIGN]!=mxConstants.ALIGN_CENTER&&(b+=parseFloat(d[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize);f+=2*(d[mxConstants.STYLE_SPACING]||0);f+=d[mxConstants.STYLE_SPACING_LEFT]||0;f+=d[mxConstants.STYLE_SPACING_RIGHT]||0;b+=2*(d[mxConstants.STYLE_SPACING]||0);b+=d[mxConstants.STYLE_SPACING_TOP]||0;b+=d[mxConstants.STYLE_SPACING_BOTTOM]||0;c=this.getFoldingImage(c);null!=c&&(f+=c.width+8);c=this.getLabel(a);null!=c&&0<c.length?(this.isHtmlLabel(a)||(c=c.replace(/\n/g,
"<br>")),e=mxUtils.getSizeForString(c,e,d[mxConstants.STYLE_FONTFAMILY]),a=e.width+f,b=e.height+b,mxUtils.getValue(d,mxConstants.STYLE_HORIZONTAL,!0)||(d=b,b=a,a=d),this.gridEnabled&&(a=this.snap(a+this.gridSize/2),b=this.snap(b+this.gridSize/2)),b=new mxRectangle(0,0,a,b)):(d=4*this.gridSize,b=new mxRectangle(0,0,d,d))}}return b};mxGraph.prototype.resizeCell=function(a,b,c){return this.resizeCells([a],[b],c)[0]};
mxGraph.prototype.resizeCells=function(a,b,c){c=null!=c?c:this.isRecursiveResize();this.model.beginUpdate();try{this.cellsResized(a,b,c),this.fireEvent(new mxEventObject(mxEvent.RESIZE_CELLS,"cells",a,"bounds",b))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellsResized=function(a,b,c){c=null!=c?c:!1;if(null!=a&&null!=b&&a.length==b.length){this.model.beginUpdate();try{for(var d=0;d<a.length;d++)this.cellResized(a[d],b[d],!1,c),this.isExtendParent(a[d])?this.extendParent(a[d]):this.isConstrainChildrenOnResize()&&this.constrainChild(a[d]);this.resetEdgesOnResize&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_RESIZED,"cells",a,"bounds",b))}finally{this.model.endUpdate()}}};
mxGraph.prototype.cellResized=function(a,b,c,d){var e=this.model.getGeometry(a);if(null!=e&&(e.x!=b.x||e.y!=b.y||e.width!=b.width||e.height!=b.height)){e=e.clone();!c&&e.relative?(c=e.offset,null!=c&&(c.x+=b.x-e.x,c.y+=b.y-e.y)):(e.x=b.x,e.y=b.y);e.width=b.width;e.height=b.height;!e.relative&&this.model.isVertex(a)&&!this.isAllowNegativeCoordinates()&&(e.x=Math.max(0,e.x),e.y=Math.max(0,e.y));this.model.beginUpdate();try{d&&this.resizeChildCells(a,e),this.model.setGeometry(a,e),this.isConstrainChildrenOnResize()&&
this.constrainChildCells(a)}finally{this.model.endUpdate()}}};mxGraph.prototype.resizeChildCells=function(a,b){for(var c=this.model.getGeometry(a),d=b.width/c.width,c=b.height/c.height,e=this.model.getChildCount(a),f=0;f<e;f++)this.scaleCell(this.model.getChildAt(a,f),d,c,!0)};mxGraph.prototype.constrainChildCells=function(a){for(var b=this.model.getChildCount(a),c=0;c<b;c++)this.constrainChild(this.model.getChildAt(a,c))};
mxGraph.prototype.scaleCell=function(a,b,c,d){var e=this.model.getGeometry(a);if(null!=e){var e=e.clone(),f=e.points;if(null!=f){for(d=0;d<f.length;d++)f[d].x*=b,f[d].y*=c;this.model.setGeometry(a,e)}else this.model.isVertex(a)&&(e.x*=b,e.y*=c,e.width*=b,e.height*=c,this.cellResized(a,e,!0,d))}};
mxGraph.prototype.extendParent=function(a){if(null!=a){var b=this.model.getParent(a),c=this.model.getGeometry(b);if(null!=b&&null!=c&&!this.isCellCollapsed(b)&&(a=this.model.getGeometry(a),null!=a&&(c.width<a.x+a.width||c.height<a.y+a.height)))c=c.clone(),c.width=Math.max(c.width,a.x+a.width),c.height=Math.max(c.height,a.y+a.height),this.cellsResized([b],[c],!1)}};mxGraph.prototype.importCells=function(a,b,c,d,e){return this.moveCells(a,b,c,!0,d,e)};
mxGraph.prototype.moveCells=function(a,b,c,d,e,f){b=null!=b?b:0;c=null!=c?c:0;d=null!=d?d:!1;if(null!=a&&(0!=b||0!=c||d||null!=e)){this.model.beginUpdate();try{d&&(a=this.cloneCells(a,this.isCloneInvalidEdges()),null==e&&(e=this.getDefaultParent()));var g=this.isAllowNegativeCoordinates();null!=e&&this.setAllowNegativeCoordinates(!0);this.cellsMoved(a,b,c,!d&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),null==e,this.isExtendParentsOnMove()&&null==e);this.setAllowNegativeCoordinates(g);if(null!=
e){var h=this.model.getChildCount(e);this.cellsAdded(a,e,h,null,null,!0)}this.fireEvent(new mxEventObject(mxEvent.MOVE_CELLS,"cells",a,"dx",b,"dy",c,"clone",d,"target",e,"event",f))}finally{this.model.endUpdate()}}return a};
mxGraph.prototype.cellsMoved=function(a,b,c,d,e,f){if(null!=a&&(0!=b||0!=c)){f=null!=f?f:!1;this.model.beginUpdate();try{d&&this.disconnectGraph(a);for(var g=0;g<a.length;g++)this.translateCell(a[g],b,c),f&&this.isExtendParent(a[g])?this.extendParent(a[g]):e&&this.constrainChild(a[g]);this.resetEdgesOnMove&&this.resetEdges(a);this.fireEvent(new mxEventObject(mxEvent.CELLS_MOVED,"cells",a,"dx",c,"dy",c,"disconnect",d))}finally{this.model.endUpdate()}}};
mxGraph.prototype.translateCell=function(a,b,c){var d=this.model.getGeometry(a);null!=d&&(d=d.clone(),d.translate(b,c),!d.relative&&this.model.isVertex(a)&&!this.isAllowNegativeCoordinates()&&(d.x=Math.max(0,d.x),d.y=Math.max(0,d.y)),d.relative&&!this.model.isEdge(a)&&(null==d.offset?d.offset=new mxPoint(b,c):(d.offset.x+=b,d.offset.y+=c)),this.model.setGeometry(a,d))};
mxGraph.prototype.getCellContainmentArea=function(a){if(null!=a&&!this.model.isEdge(a)){var b=this.model.getParent(a);if(b==this.getDefaultParent()||b==this.getCurrentRoot())return this.getMaximumGraphBounds();if(null!=b&&b!=this.getDefaultParent()){var c=this.model.getGeometry(b);if(null!=c){var d=a=0,e=c.width,c=c.height;this.isSwimlane(b)&&(b=this.getStartSize(b),a=b.width,e-=b.width,d=b.height,c-=b.height);return new mxRectangle(a,d,e,c)}}}return null};
mxGraph.prototype.getMaximumGraphBounds=function(){return this.maximumGraphBounds};
mxGraph.prototype.constrainChild=function(a){if(null!=a){var b=this.model.getGeometry(a),c=this.isConstrainChild(a)?this.getCellContainmentArea(a):this.getMaximumGraphBounds();if(null!=b&&null!=c&&!b.relative&&(b.x<c.x||b.y<c.y||c.width<b.x+b.width||c.height<b.y+b.height)){var d=this.getOverlap(a),b=b.clone();0<c.width&&(b.x=Math.min(b.x,c.x+c.width-(1-d)*b.width));0<c.height&&(b.y=Math.min(b.y,c.y+c.height-(1-d)*b.height));b.x=Math.max(b.x,c.x-b.width*d);b.y=Math.max(b.y,c.y-b.height*d);b.width=
Math.min(b.width,c.width);b.height=Math.min(b.height,c.height);this.model.setGeometry(a,b)}}};
mxGraph.prototype.resetEdges=function(a){if(null!=a){for(var b={},c=0;c<a.length;c++){var d=mxCellPath.create(a[c]);b[d]=a[c]}this.model.beginUpdate();try{for(c=0;c<a.length;c++){var e=this.model.getEdges(a[c]);if(null!=e)for(d=0;d<e.length;d++){var f=this.view.getState(e[d]),g=null!=f?f.getVisibleTerminal(!0):this.view.getVisibleTerminal(e[d],!0),h=null!=f?f.getVisibleTerminal(!1):this.view.getVisibleTerminal(e[d],!1),k=mxCellPath.create(g),l=mxCellPath.create(h);(null==b[k]||null==b[l])&&this.resetEdge(e[d])}this.resetEdges(this.model.getChildren(a[c]))}}finally{this.model.endUpdate()}}};
mxGraph.prototype.resetEdge=function(a){var b=this.model.getGeometry(a);null!=b&&null!=b.points&&0<b.points.length&&(b=b.clone(),b.points=[],this.model.setGeometry(a,b));return a};mxGraph.prototype.getAllConnectionConstraints=function(a){return null!=a&&null!=a.shape&&null!=a.shape.stencil?a.shape.stencil.constraints:null};
mxGraph.prototype.getConnectionConstraint=function(a,b,c){var b=null,d=a.style[c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X];if(null!=d){var e=a.style[c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y];null!=e&&(b=new mxPoint(parseFloat(d),parseFloat(e)))}d=!1;null!=b&&(d=mxUtils.getValue(a.style,c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,!0));return new mxConnectionConstraint(b,d)};
mxGraph.prototype.setConnectionConstraint=function(a,b,c,d){if(null!=d){this.model.beginUpdate();try{null==d||null==d.point?(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,null,[a]),this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a])):null!=d.point&&(this.setCellStyles(c?mxConstants.STYLE_EXIT_X:mxConstants.STYLE_ENTRY_X,d.point.x,[a]),this.setCellStyles(c?
mxConstants.STYLE_EXIT_Y:mxConstants.STYLE_ENTRY_Y,d.point.y,[a]),d.perimeter?this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,null,[a]):this.setCellStyles(c?mxConstants.STYLE_EXIT_PERIMETER:mxConstants.STYLE_ENTRY_PERIMETER,"0",[a]))}finally{this.model.endUpdate()}}};
mxGraph.prototype.getConnectionPoint=function(a,b){var c=null;if(null!=a){var d=this.view.getPerimeterBounds(a),e=new mxPoint(d.getCenterX(),d.getCenterY()),f=a.style[mxConstants.STYLE_DIRECTION],g=0;if(null!=f&&(f==mxConstants.DIRECTION_NORTH?g+=270:f==mxConstants.DIRECTION_WEST?g+=180:f==mxConstants.DIRECTION_SOUTH&&(g+=90),f==mxConstants.DIRECTION_NORTH||f==mxConstants.DIRECTION_SOUTH)){d.x+=d.width/2-d.height/2;d.y+=d.height/2-d.width/2;var h=d.width;d.width=d.height;d.height=h}if(null!=b.point){var k=
c=1,l=0,m=0;if(this.getModel().isVertex(a.cell)){var n=a.style[mxConstants.STYLE_FLIPH],o=a.style[mxConstants.STYLE_FLIPV];null!=a.shape&&null!=a.shape.stencil&&(n=1==mxUtils.getValue(a.style,"stencilFlipH",0)||n,o=1==mxUtils.getValue(a.style,"stencilFlipV",0)||o);if("north"==f||"south"==f)h=n,n=o,o=h;n&&(c=-1,l=-d.width);o&&(k=-1,m=-d.height)}c=new mxPoint(d.x+b.point.x*d.width*c-l,d.y+b.point.y*d.height*k-m)}f=a.style[mxConstants.STYLE_ROTATION]||0;b.perimeter?(0!=g&&null!=c&&(h=d=0,90==g?h=1:180==
g?d=-1:270==f&&(h=-1),c=mxUtils.getRotatedPoint(c,d,h,e)),null!=c&&b.perimeter&&(c=this.view.getPerimeterPoint(a,c,!1))):f+=g;0!=f&&null!=c&&(g=mxUtils.toRadians(f),d=Math.cos(g),h=Math.sin(g),c=mxUtils.getRotatedPoint(c,d,h,e))}return c};mxGraph.prototype.connectCell=function(a,b,c,d){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.cellConnected(a,b,c,d);this.fireEvent(new mxEventObject(mxEvent.CONNECT_CELL,"edge",a,"terminal",b,"source",c,"previous",e))}finally{this.model.endUpdate()}return a};
mxGraph.prototype.cellConnected=function(a,b,c,d){if(null!=a){this.model.beginUpdate();try{var e=this.model.getTerminal(a,c);this.setConnectionConstraint(a,b,c,d);this.isPortsEnabled()&&(d=null,this.isPort(b)&&(d=b.getId(),b=this.getTerminalForPort(b,c)),this.setCellStyles(c?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT,d,[a]));this.model.setTerminal(a,b,c);this.resetEdgesOnConnect&&this.resetEdge(a);this.fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",a,"terminal",b,"source",
c,"previous",e))}finally{this.model.endUpdate()}}};
mxGraph.prototype.disconnectGraph=function(a){if(null!=a){this.model.beginUpdate();try{for(var b=this.view.scale,c=this.view.translate,d={},e=0;e<a.length;e++){var f=mxCellPath.create(a[e]);d[f]=a[e]}for(e=0;e<a.length;e++)if(this.model.isEdge(a[e])){var g=this.model.getGeometry(a[e]);if(null!=g){var h=this.view.getState(a[e]),k=this.view.getState(this.model.getParent(a[e]));if(null!=h&&null!=k){var g=g.clone(),l=-k.origin.x,m=-k.origin.y,n=h.absolutePoints,o=this.model.getTerminal(a[e],!0);if(null!=
o&&this.isCellDisconnectable(a[e],o,!0)){for(var q=mxCellPath.create(o);null!=o&&null==d[q];)o=this.model.getParent(o),q=mxCellPath.create(o);null==o&&(g.setTerminalPoint(new mxPoint(n[0].x/b-c.x+l,n[0].y/b-c.y+m),!0),this.model.setTerminal(a[e],null,!0))}var r=this.model.getTerminal(a[e],!1);if(null!=r&&this.isCellDisconnectable(a[e],r,!1)){for(var u=mxCellPath.create(r);null!=r&&null==d[u];)r=this.model.getParent(r),u=mxCellPath.create(r);if(null==r){var w=n.length-1;g.setTerminalPoint(new mxPoint(n[w].x/
b-c.x+l,n[w].y/b-c.y+m),!1);this.model.setTerminal(a[e],null,!1)}}this.model.setGeometry(a[e],g)}}}}finally{this.model.endUpdate()}}};mxGraph.prototype.getCurrentRoot=function(){return this.view.currentRoot};mxGraph.prototype.getTranslateForRoot=function(){return null};mxGraph.prototype.isPort=function(){return!1};mxGraph.prototype.getTerminalForPort=function(a){return this.model.getParent(a)};mxGraph.prototype.getChildOffsetForCell=function(){return null};
mxGraph.prototype.enterGroup=function(a){a=a||this.getSelectionCell();null!=a&&this.isValidRoot(a)&&(this.view.setCurrentRoot(a),this.clearSelection())};mxGraph.prototype.exitGroup=function(){var a=this.model.getRoot(),b=this.getCurrentRoot();if(null!=b){for(var c=this.model.getParent(b);c!=a&&!this.isValidRoot(c)&&this.model.getParent(c)!=a;)c=this.model.getParent(c);c==a||this.model.getParent(c)==a?this.view.setCurrentRoot(null):this.view.setCurrentRoot(c);null!=this.view.getState(b)&&this.setSelectionCell(b)}};
mxGraph.prototype.home=function(){var a=this.getCurrentRoot();null!=a&&(this.view.setCurrentRoot(null),null!=this.view.getState(a)&&this.setSelectionCell(a))};mxGraph.prototype.isValidRoot=function(a){return null!=a};mxGraph.prototype.getGraphBounds=function(){return this.view.getGraphBounds()};
mxGraph.prototype.getCellBounds=function(a,b,c){var d=[a];b&&(d=d.concat(this.model.getEdges(a)));d=this.view.getBounds(d);if(c)for(var c=this.model.getChildCount(a),e=0;e<c;e++){var f=this.getCellBounds(this.model.getChildAt(a,e),b,!0);null!=d?d.add(f):d=f}return d};
mxGraph.prototype.getBoundingBoxFromGeometry=function(a,b){var b=null!=b?b:!1,c=null;if(null!=a)for(var d=0;d<a.length;d++)if(b||this.model.isVertex(a[d])){var e=this.getCellGeometry(a[d]);if(null!=e){var f=e.points;if(null!=f&&0<f.length){for(var g=new mxRectangle(f[0].x,f[0].y,0,0),h=function(a){null!=a&&g.add(new mxRectangle(a.x,a.y,0,0))},k=1;k<f.length;k++)h(f[k]);h(e.getTerminalPoint(!0));h(e.getTerminalPoint(!1));e=g}null==c?c=new mxRectangle(e.x,e.y,e.width,e.height):c.add(e)}}return c};
mxGraph.prototype.refresh=function(a){this.view.clear(a,null==a);this.view.validate();this.sizeDidChange();this.fireEvent(new mxEventObject(mxEvent.REFRESH))};mxGraph.prototype.snap=function(a){this.gridEnabled&&(a=Math.round(a/this.gridSize)*this.gridSize);return a};
mxGraph.prototype.panGraph=function(a,b){if(this.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.container))this.container.scrollLeft=-a,this.container.scrollTop=-b;else{var c=this.view.getCanvas();if(this.dialect==mxConstants.DIALECT_SVG)if(0==a&&0==b){if(mxClient.IS_IE?c.setAttribute("transform","translate("+a+","+b+")"):c.removeAttribute("transform"),null!=this.shiftPreview1){for(var d=this.shiftPreview1.firstChild;null!=d;){var e=d.nextSibling;this.container.appendChild(d);d=e}this.shiftPreview1.parentNode.removeChild(this.shiftPreview1);
this.shiftPreview1=null;this.container.appendChild(c.parentNode);for(d=this.shiftPreview2.firstChild;null!=d;)e=d.nextSibling,this.container.appendChild(d),d=e;this.shiftPreview2.parentNode.removeChild(this.shiftPreview2);this.shiftPreview2=null}}else{c.setAttribute("transform","translate("+a+","+b+")");if(null==this.shiftPreview1){this.shiftPreview1=document.createElement("div");this.shiftPreview1.style.position="absolute";this.shiftPreview1.style.overflow="visible";this.shiftPreview2=document.createElement("div");
this.shiftPreview2.style.position="absolute";this.shiftPreview2.style.overflow="visible";for(var f=this.shiftPreview1,d=this.container.firstChild;null!=d;)e=d.nextSibling,d!=c.parentNode?f.appendChild(d):f=this.shiftPreview2,d=e;this.container.insertBefore(this.shiftPreview1,c.parentNode);this.container.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=a+"px";this.shiftPreview1.style.top=b+"px";this.shiftPreview2.style.left=a+"px";this.shiftPreview2.style.top=b+"px"}else c.style.left=
a+"px",c.style.top=b+"px";this.panDx=a;this.panDy=b;this.fireEvent(new mxEventObject(mxEvent.PAN))}};mxGraph.prototype.zoomIn=function(){this.zoom(this.zoomFactor)};mxGraph.prototype.zoomOut=function(){this.zoom(1/this.zoomFactor)};mxGraph.prototype.zoomActual=function(){1==this.view.scale?this.view.setTranslate(0,0):(this.view.translate.x=0,this.view.translate.y=0,this.view.setScale(1))};mxGraph.prototype.zoomTo=function(a,b){this.zoom(a/this.view.scale,b)};
mxGraph.prototype.zoom=function(a,b){var b=null!=b?b:this.centerZoom,c=this.view.scale*a,d=this.view.getState(this.getSelectionCell());if(this.keepSelectionVisibleOnZoom&&null!=d)d=new mxRectangle(d.x*a,d.y*a,d.width*a,d.height*a),this.view.scale=c,this.scrollRectToVisible(d)||(this.view.revalidate(),this.view.setScale(c));else if(b&&!mxUtils.hasScrollbars(this.container)){var d=this.container.offsetWidth,e=this.container.offsetHeight;if(1<a)var f=(a-1)/(2*c),d=d*-f,e=e*-f;else f=(1/a-1)/(2*this.view.scale),
d*=f,e*=f;this.view.scaleAndTranslate(c,this.view.translate.x+d,this.view.translate.y+e)}else this.view.setScale(c),mxUtils.hasScrollbars(this.container)&&(e=d=0,b&&(d=this.container.offsetWidth*(a-1)/2,e=this.container.offsetHeight*(a-1)/2),this.container.scrollLeft=Math.round(this.container.scrollLeft*a+d),this.container.scrollTop=Math.round(this.container.scrollTop*a+e))};
mxGraph.prototype.zoomToRect=function(a){var b=this.container.clientWidth/a.width/(this.container.clientHeight/a.height);a.x=Math.max(0,a.x);a.y=Math.max(0,a.y);var c=Math.min(this.container.scrollWidth,a.x+a.width),d=Math.min(this.container.scrollHeight,a.y+a.height);a.width=c-a.x;a.height=d-a.y;1>b?(b=a.height/b,c=(b-a.height)/2,a.height=b,b=Math.min(a.y,c),a.y-=b,d=Math.min(this.container.scrollHeight,a.y+a.height),a.height=d-a.y):(b*=a.width,c=(b-a.width)/2,a.width=b,b=Math.min(a.x,c),a.x-=b,
c=Math.min(this.container.scrollWidth,a.x+a.width),a.width=c-a.x);b=this.container.clientWidth/a.width;c=this.view.scale*b;mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),this.container.scrollLeft=Math.round(a.x*b),this.container.scrollTop=Math.round(a.y*b)):this.view.scaleAndTranslate(c,this.view.translate.x-a.x/this.view.scale,this.view.translate.y-a.y/this.view.scale)};
mxGraph.prototype.fit=function(a,b){if(null!=this.container){var a=null!=a?a:0,b=null!=b?b:!1,c=this.container.clientWidth,d=this.container.clientHeight,e=this.view.getGraphBounds();b&&null!=e.x&&null!=e.y&&(e.width+=e.x,e.height+=e.y,e.x=0,e.y=0);var f=this.view.scale,g=e.width/f,h=e.height/f;null!=this.backgroundImage&&(g=Math.max(g,this.backgroundImage.width-e.x/f),h=Math.max(h,this.backgroundImage.height-e.y/f));var k=b?a:2*a,c=Math.floor(100*Math.min(c/(g+k),d/(h+k)))/100;null!=this.minFitScale&&
(c=Math.max(c,this.minFitScale));null!=this.maxFitScale&&(c=Math.min(c,this.maxFitScale));b?this.view.scale!=c&&this.view.setScale(c):mxUtils.hasScrollbars(this.container)?(this.view.setScale(c),null!=e.x&&(this.container.scrollLeft=Math.round(e.x/f)*c-a-Math.max(0,(this.container.clientWidth-g*c)/2)),null!=e.y&&(this.container.scrollTop=Math.round(e.y/f)*c-a-Math.max(0,(this.container.clientHeight-h*c)/2))):this.view.scaleAndTranslate(c,null!=e.x?Math.floor(this.view.translate.x-e.x/f+a+1):a,null!=
e.y?Math.floor(this.view.translate.y-e.y/f+a+1):a)}return this.view.scale};mxGraph.prototype.scrollCellToVisible=function(a,b){var c=-this.view.translate.x,d=-this.view.translate.y,e=this.view.getState(a);null!=e&&(c=new mxRectangle(c+e.x,d+e.y,e.width,e.height),b&&null!=this.container&&(d=this.container.clientWidth,e=this.container.clientHeight,c.x=c.getCenterX()-d/2,c.width=d,c.y=c.getCenterY()-e/2,c.height=e),this.scrollRectToVisible(c)&&this.view.setTranslate(this.view.translate.x,this.view.translate.y))};
mxGraph.prototype.scrollRectToVisible=function(a){var b=!1;if(null!=a){var c=this.container.offsetWidth,d=this.container.offsetHeight,e=Math.min(c,a.width),f=Math.min(d,a.height);if(mxUtils.hasScrollbars(this.container)){c=this.container;a.x+=this.view.translate.x;a.y+=this.view.translate.y;var g=c.scrollLeft-a.x,d=Math.max(g-c.scrollLeft,0);0<g?c.scrollLeft-=g+2:(g=a.x+e-c.scrollLeft-c.clientWidth,0<g&&(c.scrollLeft+=g+2));e=c.scrollTop-a.y;g=Math.max(0,e-c.scrollTop);0<e?c.scrollTop-=e+2:(e=a.y+
f-c.scrollTop-c.clientHeight,0<e&&(c.scrollTop+=e+2));!this.useScrollbarsForPanning&&(0!=d||0!=g)&&this.view.setTranslate(d,g)}else{var g=-this.view.translate.x,h=-this.view.translate.y,k=this.view.scale;a.x+e>g+c&&(this.view.translate.x-=(a.x+e-c-g)/k,b=!0);a.y+f>h+d&&(this.view.translate.y-=(a.y+f-d-h)/k,b=!0);a.x<g&&(this.view.translate.x+=(g-a.x)/k,b=!0);a.y<h&&(this.view.translate.y+=(h-a.y)/k,b=!0);b&&(this.view.refresh(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.refresh())}}return b};
mxGraph.prototype.getCellGeometry=function(a){return this.model.getGeometry(a)};mxGraph.prototype.isCellVisible=function(a){return this.model.isVisible(a)};mxGraph.prototype.isCellCollapsed=function(a){return this.model.isCollapsed(a)};mxGraph.prototype.isCellConnectable=function(a){return this.model.isConnectable(a)};
mxGraph.prototype.isOrthogonal=function(a){var b=a.style[mxConstants.STYLE_ORTHOGONAL];if(null!=b)return b;a=this.view.getEdgeStyle(a);return a==mxEdgeStyle.SegmentConnector||a==mxEdgeStyle.ElbowConnector||a==mxEdgeStyle.SideToSide||a==mxEdgeStyle.TopToBottom||a==mxEdgeStyle.EntityRelation||a==mxEdgeStyle.OrthConnector};mxGraph.prototype.isLoop=function(a){var b=a.getVisibleTerminalState(!0),a=a.getVisibleTerminalState(!1);return null!=b&&b==a};mxGraph.prototype.isCloneEvent=function(a){return mxEvent.isControlDown(a)};
mxGraph.prototype.isToggleEvent=function(a){return mxClient.IS_MAC?mxEvent.isMetaDown(a):mxEvent.isControlDown(a)};mxGraph.prototype.isGridEnabledEvent=function(a){return null!=a&&!mxEvent.isAltDown(a)};mxGraph.prototype.isConstrainedEvent=function(a){return mxEvent.isShiftDown(a)};mxGraph.prototype.validationAlert=function(a){mxUtils.alert(a)};mxGraph.prototype.isEdgeValid=function(a,b,c){return null==this.getEdgeValidationError(a,b,c)};
mxGraph.prototype.getEdgeValidationError=function(a,b,c){if(null!=a&&!this.isAllowDanglingEdges()&&(null==b||null==c))return"";if(null!=a&&null==this.model.getTerminal(a,!0)&&null==this.model.getTerminal(a,!1))return null;if(!this.allowLoops&&b==c&&null!=b||!this.isValidConnection(b,c))return"";if(null!=b&&null!=c){var d="";if(!this.multigraph){var e=this.model.getEdgesBetween(b,c,!0);if(1<e.length||1==e.length&&e[0]!=a)d+=(mxResources.get(this.alreadyConnectedResource)||this.alreadyConnectedResource)+
"\n"}var e=this.model.getDirectedEdgeCount(b,!0,a),f=this.model.getDirectedEdgeCount(c,!1,a);if(null!=this.multiplicities)for(var g=0;g<this.multiplicities.length;g++){var h=this.multiplicities[g].check(this,a,b,c,e,f);null!=h&&(d+=h)}h=this.validateEdge(a,b,c);null!=h&&(d+=h);return 0<d.length?d:null}return this.allowDanglingEdges?null:""};mxGraph.prototype.validateEdge=function(){return null};
mxGraph.prototype.validateGraph=function(a,b){for(var a=null!=a?a:this.model.getRoot(),b=null!=b?b:{},c=!0,d=this.model.getChildCount(a),e=0;e<d;e++){var f=this.model.getChildAt(a,e),g=b;this.isValidRoot(f)&&(g={});g=this.validateGraph(f,g);null!=g?this.setCellWarning(f,g.replace(/\n/g,"<br>")):this.setCellWarning(f,null);c=c&&null==g}d="";this.isCellCollapsed(a)&&!c&&(d+=(mxResources.get(this.containsValidationErrorsResource)||this.containsValidationErrorsResource)+"\n");d=this.model.isEdge(a)?d+
(this.getEdgeValidationError(a,this.model.getTerminal(a,!0),this.model.getTerminal(a,!1))||""):d+(this.getCellValidationError(a)||"");e=this.validateCell(a,b);null!=e&&(d+=e);null==this.model.getParent(a)&&this.view.validate();return 0<d.length||!c?d:null};
mxGraph.prototype.getCellValidationError=function(a){var b=this.model.getDirectedEdgeCount(a,!0),c=this.model.getDirectedEdgeCount(a,!1),a=this.model.getValue(a),d="";if(null!=this.multiplicities)for(var e=0;e<this.multiplicities.length;e++){var f=this.multiplicities[e];if(f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<b||1==f.min&&0==b||1==f.max&&1<b))d+=f.countError+"\n";else if(!f.source&&mxUtils.isNode(a,f.type,f.attr,f.value)&&(0==f.max&&0<c||1==f.min&&0==c||1==f.max&&1<c))d+=
f.countError+"\n"}return 0<d.length?d:null};mxGraph.prototype.validateCell=function(){return null};mxGraph.prototype.getBackgroundImage=function(){return this.backgroundImage};mxGraph.prototype.setBackgroundImage=function(a){this.backgroundImage=a};mxGraph.prototype.getFoldingImage=function(a){if(null!=a&&this.foldingEnabled&&!this.getModel().isEdge(a.cell)){var b=this.isCellCollapsed(a.cell);if(this.isCellFoldable(a.cell,!b))return b?this.collapsedImage:this.expandedImage}return null};
mxGraph.prototype.convertValueToString=function(a){a=this.model.getValue(a);if(null!=a){if(mxUtils.isNode(a))return a.nodeName;if("function"==typeof a.toString)return a.toString()}return""};mxGraph.prototype.getLabel=function(a){var b="";if(this.labelsVisible&&null!=a){var c=this.view.getState(a),c=null!=c?c.style:this.getCellStyle(a);mxUtils.getValue(c,mxConstants.STYLE_NOLABEL,!1)||(b=this.convertValueToString(a))}return b};mxGraph.prototype.isHtmlLabel=function(){return this.isHtmlLabels()};
mxGraph.prototype.isHtmlLabels=function(){return this.htmlLabels};mxGraph.prototype.setHtmlLabels=function(a){this.htmlLabels=a};mxGraph.prototype.isWrapping=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return null!=a?"wrap"==a[mxConstants.STYLE_WHITE_SPACE]:!1};mxGraph.prototype.isLabelClipped=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return null!=a?"hidden"==a[mxConstants.STYLE_OVERFLOW]:!1};
mxGraph.prototype.getTooltip=function(a,b,c){var d=null;if(null!=a){if(null!=a.control&&(b==a.control.node||b.parentNode==a.control.node))d=this.collapseExpandResource,d=mxResources.get(d)||d;null==d&&null!=a.overlays&&a.overlays.visit(function(a,c){if(null==d&&(b==c.node||b.parentNode==c.node))d=c.overlay.toString()});null==d&&(c=this.selectionCellsHandler.getHandler(a.cell),null!=c&&"function"==typeof c.getTooltipForNode&&(d=c.getTooltipForNode(b)));null==d&&(d=this.getTooltipForCell(a.cell))}return d};
mxGraph.prototype.getTooltipForCell=function(a){return null!=a&&null!=a.getTooltip?a.getTooltip():this.convertValueToString(a)};mxGraph.prototype.getCursorForCell=function(){return null};mxGraph.prototype.getStartSize=function(a){var b=new mxRectangle,c=this.view.getState(a),a=null!=c?c.style:this.getCellStyle(a);null!=a&&(c=parseInt(mxUtils.getValue(a,mxConstants.STYLE_STARTSIZE,mxConstants.DEFAULT_STARTSIZE)),mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,!0)?b.height=c:b.width=c);return b};
mxGraph.prototype.getImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_IMAGE]:null};mxGraph.prototype.getVerticalAlign=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_VERTICAL_ALIGN]||mxConstants.ALIGN_MIDDLE:null};mxGraph.prototype.getIndicatorColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_COLOR]:null};
mxGraph.prototype.getIndicatorGradientColor=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_GRADIENTCOLOR]:null};mxGraph.prototype.getIndicatorShape=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_SHAPE]:null};mxGraph.prototype.getIndicatorImage=function(a){return null!=a&&null!=a.style?a.style[mxConstants.STYLE_INDICATOR_IMAGE]:null};mxGraph.prototype.getBorder=function(){return this.border};
mxGraph.prototype.setBorder=function(a){this.border=a};mxGraph.prototype.isSwimlane=function(a){if(null!=a&&this.model.getParent(a)!=this.model.getRoot()){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);if(null!=b&&!this.model.isEdge(a))return b[mxConstants.STYLE_SHAPE]==mxConstants.SHAPE_SWIMLANE}return!1};mxGraph.prototype.isResizeContainer=function(){return this.resizeContainer};mxGraph.prototype.setResizeContainer=function(a){this.resizeContainer=a};
mxGraph.prototype.isEnabled=function(){return this.enabled};mxGraph.prototype.setEnabled=function(a){this.enabled=a};mxGraph.prototype.isEscapeEnabled=function(){return this.escapeEnabled};mxGraph.prototype.setEscapeEnabled=function(a){this.escapeEnabled=a};mxGraph.prototype.isInvokesStopCellEditing=function(){return this.invokesStopCellEditing};mxGraph.prototype.setInvokesStopCellEditing=function(a){this.invokesStopCellEditing=a};mxGraph.prototype.isEnterStopsCellEditing=function(){return this.enterStopsCellEditing};
mxGraph.prototype.setEnterStopsCellEditing=function(a){this.enterStopsCellEditing=a};mxGraph.prototype.isCellLocked=function(a){var b=this.model.getGeometry(a);return this.isCellsLocked()||null!=b&&this.model.isVertex(a)&&b.relative};mxGraph.prototype.isCellsLocked=function(){return this.cellsLocked};mxGraph.prototype.setCellsLocked=function(a){this.cellsLocked=a};mxGraph.prototype.getCloneableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellCloneable(a)}))};
mxGraph.prototype.isCellCloneable=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isCellsCloneable()&&0!=a[mxConstants.STYLE_CLONEABLE]};mxGraph.prototype.isCellsCloneable=function(){return this.cellsCloneable};mxGraph.prototype.setCellsCloneable=function(a){this.cellsCloneable=a};mxGraph.prototype.getExportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canExportCell(a)}))};
mxGraph.prototype.canExportCell=function(){return this.exportEnabled};mxGraph.prototype.getImportableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.canImportCell(a)}))};mxGraph.prototype.canImportCell=function(){return this.importEnabled};mxGraph.prototype.isCellSelectable=function(){return this.isCellsSelectable()};mxGraph.prototype.isCellsSelectable=function(){return this.cellsSelectable};
mxGraph.prototype.setCellsSelectable=function(a){this.cellsSelectable=a};mxGraph.prototype.getDeletableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellDeletable(a)}))};mxGraph.prototype.isCellDeletable=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isCellsDeletable()&&0!=a[mxConstants.STYLE_DELETABLE]};mxGraph.prototype.isCellsDeletable=function(){return this.cellsDeletable};
mxGraph.prototype.setCellsDeletable=function(a){this.cellsDeletable=a};mxGraph.prototype.isLabelMovable=function(a){return!this.isCellLocked(a)&&(this.model.isEdge(a)&&this.edgeLabelsMovable||this.model.isVertex(a)&&this.vertexLabelsMovable)};mxGraph.prototype.isCellRotatable=function(a){var b=this.view.getState(a);return 0!=(null!=b?b.style:this.getCellStyle(a))[mxConstants.STYLE_ROTATABLE]};mxGraph.prototype.getMovableCells=function(a){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellMovable(a)}))};
mxGraph.prototype.isCellMovable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsMovable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_MOVABLE]};mxGraph.prototype.isCellsMovable=function(){return this.cellsMovable};mxGraph.prototype.setCellsMovable=function(a){this.cellsMovable=a};mxGraph.prototype.isGridEnabled=function(){return this.gridEnabled};mxGraph.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxGraph.prototype.isPortsEnabled=function(){return this.portsEnabled};
mxGraph.prototype.setPortsEnabled=function(a){this.portsEnabled=a};mxGraph.prototype.getGridSize=function(){return this.gridSize};mxGraph.prototype.setGridSize=function(a){this.gridSize=a};mxGraph.prototype.getTolerance=function(){return this.tolerance};mxGraph.prototype.setTolerance=function(a){this.tolerance=a};mxGraph.prototype.isVertexLabelsMovable=function(){return this.vertexLabelsMovable};mxGraph.prototype.setVertexLabelsMovable=function(a){this.vertexLabelsMovable=a};
mxGraph.prototype.isEdgeLabelsMovable=function(){return this.edgeLabelsMovable};mxGraph.prototype.setEdgeLabelsMovable=function(a){this.edgeLabelsMovable=a};mxGraph.prototype.isSwimlaneNesting=function(){return this.swimlaneNesting};mxGraph.prototype.setSwimlaneNesting=function(a){this.swimlaneNesting=a};mxGraph.prototype.isSwimlaneSelectionEnabled=function(){return this.swimlaneSelectionEnabled};mxGraph.prototype.setSwimlaneSelectionEnabled=function(a){this.swimlaneSelectionEnabled=a};
mxGraph.prototype.isMultigraph=function(){return this.multigraph};mxGraph.prototype.setMultigraph=function(a){this.multigraph=a};mxGraph.prototype.isAllowLoops=function(){return this.allowLoops};mxGraph.prototype.setAllowDanglingEdges=function(a){this.allowDanglingEdges=a};mxGraph.prototype.isAllowDanglingEdges=function(){return this.allowDanglingEdges};mxGraph.prototype.setConnectableEdges=function(a){this.connectableEdges=a};mxGraph.prototype.isConnectableEdges=function(){return this.connectableEdges};
mxGraph.prototype.setCloneInvalidEdges=function(a){this.cloneInvalidEdges=a};mxGraph.prototype.isCloneInvalidEdges=function(){return this.cloneInvalidEdges};mxGraph.prototype.setAllowLoops=function(a){this.allowLoops=a};mxGraph.prototype.isDisconnectOnMove=function(){return this.disconnectOnMove};mxGraph.prototype.setDisconnectOnMove=function(a){this.disconnectOnMove=a};mxGraph.prototype.isDropEnabled=function(){return this.dropEnabled};
mxGraph.prototype.setDropEnabled=function(a){this.dropEnabled=a};mxGraph.prototype.isSplitEnabled=function(){return this.splitEnabled};mxGraph.prototype.setSplitEnabled=function(a){this.splitEnabled=a};mxGraph.prototype.isCellResizable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsResizable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_RESIZABLE]};mxGraph.prototype.isCellsResizable=function(){return this.cellsResizable};
mxGraph.prototype.setCellsResizable=function(a){this.cellsResizable=a};mxGraph.prototype.isTerminalPointMovable=function(){return!0};mxGraph.prototype.isCellBendable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsBendable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_BENDABLE]};mxGraph.prototype.isCellsBendable=function(){return this.cellsBendable};mxGraph.prototype.setCellsBendable=function(a){this.cellsBendable=a};
mxGraph.prototype.isCellEditable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return this.isCellsEditable()&&!this.isCellLocked(a)&&0!=b[mxConstants.STYLE_EDITABLE]};mxGraph.prototype.isCellsEditable=function(){return this.cellsEditable};mxGraph.prototype.setCellsEditable=function(a){this.cellsEditable=a};mxGraph.prototype.isCellDisconnectable=function(a){return this.isCellsDisconnectable()&&!this.isCellLocked(a)};mxGraph.prototype.isCellsDisconnectable=function(){return this.cellsDisconnectable};
mxGraph.prototype.setCellsDisconnectable=function(a){this.cellsDisconnectable=a};mxGraph.prototype.isValidSource=function(a){return null==a&&this.allowDanglingEdges||null!=a&&(!this.model.isEdge(a)||this.connectableEdges)&&this.isCellConnectable(a)};mxGraph.prototype.isValidTarget=function(a){return this.isValidSource(a)};mxGraph.prototype.isValidConnection=function(a,b){return this.isValidSource(a)&&this.isValidTarget(b)};mxGraph.prototype.setConnectable=function(a){this.connectionHandler.setEnabled(a)};
mxGraph.prototype.isConnectable=function(){return this.connectionHandler.isEnabled()};mxGraph.prototype.setTooltips=function(a){this.tooltipHandler.setEnabled(a)};mxGraph.prototype.setPanning=function(a){this.panningHandler.panningEnabled=a};mxGraph.prototype.isEditing=function(a){if(null!=this.cellEditor){var b=this.cellEditor.getEditingCell();return null==a?null!=b:a==b}return!1};
mxGraph.prototype.isAutoSizeCell=function(a){var b=this.view.getState(a),a=null!=b?b.style:this.getCellStyle(a);return this.isAutoSizeCells()||1==a[mxConstants.STYLE_AUTOSIZE]};mxGraph.prototype.isAutoSizeCells=function(){return this.autoSizeCells};mxGraph.prototype.setAutoSizeCells=function(a){this.autoSizeCells=a};mxGraph.prototype.isExtendParent=function(a){return!this.getModel().isEdge(a)&&this.isExtendParents()};mxGraph.prototype.isExtendParents=function(){return this.extendParents};
mxGraph.prototype.setExtendParents=function(a){this.extendParents=a};mxGraph.prototype.isExtendParentsOnAdd=function(){return this.extendParentsOnAdd};mxGraph.prototype.setExtendParentsOnAdd=function(a){this.extendParentsOnAdd=a};mxGraph.prototype.isExtendParentsOnMove=function(){return this.extendParentsOnMove};mxGraph.prototype.setExtendParentsOnMove=function(a){this.extendParentsOnMove=a};mxGraph.prototype.isRecursiveResize=function(){return this.recursiveResize};
mxGraph.prototype.setRecursiveResize=function(a){this.recursiveResize=a};mxGraph.prototype.isConstrainChild=function(a){return this.isConstrainChildren()&&!this.getModel().isEdge(this.getModel().getParent(a))};mxGraph.prototype.isConstrainChildren=function(){return this.constrainChildren};mxGraph.prototype.setConstrainChildrenOnResize=function(a){this.constrainChildrenOnResize=a};mxGraph.prototype.isConstrainChildrenOnResize=function(){return this.constrainChildrenOnResize};
mxGraph.prototype.setConstrainChildren=function(a){this.constrainChildren=a};mxGraph.prototype.isAllowNegativeCoordinates=function(){return this.allowNegativeCoordinates};mxGraph.prototype.setAllowNegativeCoordinates=function(a){this.allowNegativeCoordinates=a};mxGraph.prototype.getOverlap=function(a){return this.isAllowOverlapParent(a)?this.defaultOverlap:0};mxGraph.prototype.isAllowOverlapParent=function(){return!1};
mxGraph.prototype.getFoldableCells=function(a,b){return this.model.filterCells(a,mxUtils.bind(this,function(a){return this.isCellFoldable(a,b)}))};mxGraph.prototype.isCellFoldable=function(a){var b=this.view.getState(a),b=null!=b?b.style:this.getCellStyle(a);return 0<this.model.getChildCount(a)&&0!=b[mxConstants.STYLE_FOLDABLE]};
mxGraph.prototype.isValidDropTarget=function(a,b,c){return null!=a&&(this.isSplitEnabled()&&this.isSplitTarget(a,b,c)||!this.model.isEdge(a)&&(this.isSwimlane(a)||0<this.model.getChildCount(a)&&!this.isCellCollapsed(a)))};
mxGraph.prototype.isSplitTarget=function(a,b,c){return this.model.isEdge(a)&&null!=b&&1==b.length&&this.isCellConnectable(b[0])&&null==this.getEdgeValidationError(a,this.model.getTerminal(a,!0),b[0])?(c=this.model.getTerminal(a,!0),a=this.model.getTerminal(a,!1),!this.model.isAncestor(b[0],c)&&!this.model.isAncestor(b[0],a)):!1};
mxGraph.prototype.getDropTarget=function(a,b,c){if(!this.isSwimlaneNesting())for(var d=0;d<a.length;d++)if(this.isSwimlane(a[d]))return null;d=mxUtils.convertPoint(this.container,mxEvent.getClientX(b),mxEvent.getClientY(b));d.x-=this.panDx;d.y-=this.panDy;d=this.getSwimlaneAt(d.x,d.y);if(null==c)c=d;else if(null!=d){for(var e=this.model.getParent(d);null!=e&&this.isSwimlane(e)&&e!=c;)e=this.model.getParent(e);e==c&&(c=d)}for(;null!=c&&!this.isValidDropTarget(c,a,b)&&!this.model.isLayer(c);)c=this.model.getParent(c);
return!this.model.isLayer(c)&&0>mxUtils.indexOf(a,c)?c:null};mxGraph.prototype.getDefaultParent=function(){var a=this.getCurrentRoot();null==a&&(a=this.defaultParent,null==a&&(a=this.model.getRoot(),a=this.model.getChildAt(a,0)));return a};mxGraph.prototype.setDefaultParent=function(a){this.defaultParent=a};mxGraph.prototype.getSwimlane=function(a){for(;null!=a&&!this.isSwimlane(a);)a=this.model.getParent(a);return a};
mxGraph.prototype.getSwimlaneAt=function(a,b,c){c=c||this.getDefaultParent();if(null!=c)for(var d=this.model.getChildCount(c),e=0;e<d;e++){var f=this.model.getChildAt(c,e),g=this.getSwimlaneAt(a,b,f);if(null!=g)return g;if(this.isSwimlane(f)&&(g=this.view.getState(f),this.intersects(g,a,b)))return f}return null};
mxGraph.prototype.getCellAt=function(a,b,c,d,e){d=null!=d?d:!0;e=null!=e?e:!0;c=null!=c?c:this.getDefaultParent();if(null!=c)for(var f=this.model.getChildCount(c)-1;0<=f;f--){var g=this.model.getChildAt(c,f),h=this.getCellAt(a,b,g,d,e);if(null!=h)return h;if(this.isCellVisible(g)&&(e&&this.model.isEdge(g)||d&&this.model.isVertex(g)))if(h=this.view.getState(g),this.intersects(h,a,b))return g}return null};
mxGraph.prototype.intersects=function(a,b,c){if(null!=a){var d=a.absolutePoints;if(null!=d)for(var a=this.tolerance*this.tolerance,e=d[0],f=1;f<d.length;f++){var g=d[f];if(mxUtils.ptSegDistSq(e.x,e.y,g.x,g.y,b,c)<=a)return!0;e=g}else if(e=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0),0!=e&&(d=Math.cos(-e),e=Math.sin(-e),f=new mxPoint(a.getCenterX(),a.getCenterY()),e=mxUtils.getRotatedPoint(new mxPoint(b,c),d,e,f),b=e.x,c=e.y),mxUtils.contains(a,b,c))return!0}return!1};
mxGraph.prototype.hitsSwimlaneContent=function(a,b,c){var d=this.getView().getState(a),a=this.getStartSize(a);if(null!=d){var e=this.getView().getScale(),b=b-d.x,c=c-d.y;if(0<a.width&&0<b&&b>a.width*e||0<a.height&&0<c&&c>a.height*e)return!0}return!1};mxGraph.prototype.getChildVertices=function(a){return this.getChildCells(a,!0,!1)};mxGraph.prototype.getChildEdges=function(a){return this.getChildCells(a,!1,!0)};
mxGraph.prototype.getChildCells=function(a,b,c){a=null!=a?a:this.getDefaultParent();a=this.model.getChildCells(a,null!=b?b:!1,null!=c?c:!1);b=[];for(c=0;c<a.length;c++)this.isCellVisible(a[c])&&b.push(a[c]);return b};mxGraph.prototype.getConnections=function(a,b){return this.getEdges(a,b,!0,!0,!1)};mxGraph.prototype.getIncomingEdges=function(a,b){return this.getEdges(a,b,!0,!1,!1)};mxGraph.prototype.getOutgoingEdges=function(a,b){return this.getEdges(a,b,!1,!0,!1)};
mxGraph.prototype.getEdges=function(a,b,c,d,e,f){for(var c=null!=c?c:!0,d=null!=d?d:!0,e=null!=e?e:!0,f=null!=f?f:!1,g=[],h=this.isCellCollapsed(a),k=this.model.getChildCount(a),l=0;l<k;l++){var m=this.model.getChildAt(a,l);if(h||!this.isCellVisible(m))g=g.concat(this.model.getEdges(m,c,d))}g=g.concat(this.model.getEdges(a,c,d));h=[];for(l=0;l<g.length;l++)m=this.view.getState(g[l]),k=null!=m?m.getVisibleTerminal(!0):this.view.getVisibleTerminal(g[l],!0),m=null!=m?m.getVisibleTerminal(!1):this.view.getVisibleTerminal(g[l],
!1),(e&&k==m||k!=m&&(c&&m==a&&(null==b||this.isValidAncestor(k,b,f))||d&&k==a&&(null==b||this.isValidAncestor(m,b,f))))&&h.push(g[l]);return h};mxGraph.prototype.isValidAncestor=function(a,b,c){return c?this.model.isAncestor(b,a):this.model.getParent(a)==b};
mxGraph.prototype.getOpposites=function(a,b,c,d){var c=null!=c?c:!0,d=null!=d?d:!0,e=[],f={};if(null!=a)for(var g=0;g<a.length;g++){var h=this.view.getState(a[g]),k=null!=h?h.getVisibleTerminal(!0):this.view.getVisibleTerminal(a[g],!0),h=null!=h?h.getVisibleTerminal(!1):this.view.getVisibleTerminal(a[g],!1);if(k==b&&null!=h&&h!=b&&d){var l=mxCellPath.create(h);null==f[l]&&(f[l]=h,e.push(h))}else h==b&&null!=k&&k!=b&&c&&(l=mxCellPath.create(k),null==f[l]&&(f[l]=k,e.push(k)))}return e};
mxGraph.prototype.getEdgesBetween=function(a,b,c){for(var c=null!=c?c:!1,d=this.getEdges(a),e=[],f=0;f<d.length;f++){var g=this.view.getState(d[f]),h=null!=g?g.getVisibleTerminal(!0):this.view.getVisibleTerminal(d[f],!0),g=null!=g?g.getVisibleTerminal(!1):this.view.getVisibleTerminal(d[f],!1);(h==a&&g==b||!c&&h==b&&g==a)&&e.push(d[f])}return e};
mxGraph.prototype.getPointForEvent=function(a,b){var c=mxUtils.convertPoint(this.container,mxEvent.getClientX(a),mxEvent.getClientY(a)),d=this.view.scale,e=this.view.translate,f=!1!=b?this.gridSize/2:0;c.x=this.snap(c.x/d-e.x-f);c.y=this.snap(c.y/d-e.y-f);return c};
mxGraph.prototype.getCells=function(a,b,c,d,e,f){f=null!=f?f:[];if(0<c||0<d){var g=a+c,h=b+d,e=e||this.getDefaultParent();if(null!=e)for(var k=this.model.getChildCount(e),l=0;l<k;l++){var m=this.model.getChildAt(e,l),n=this.view.getState(m);if(this.isCellVisible(m)&&null!=n){var o=n,n=mxUtils.getValue(n.style,mxConstants.STYLE_ROTATION)||0;0!=n&&(o=mxUtils.getBoundingBox(o,n));o.x>=a&&o.y+o.height<=h&&o.y>=b&&o.x+o.width<=g?f.push(m):this.getCells(a,b,c,d,m,f)}}}return f};
mxGraph.prototype.getCellsBeyond=function(a,b,c,d,e){var f=[];if(d||e)if(null==c&&(c=this.getDefaultParent()),null!=c)for(var g=this.model.getChildCount(c),h=0;h<g;h++){var k=this.model.getChildAt(c,h),l=this.view.getState(k);this.isCellVisible(k)&&null!=l&&(!d||l.x>=a)&&(!e||l.y>=b)&&f.push(k)}return f};
mxGraph.prototype.findTreeRoots=function(a,b,c){var b=null!=b?b:!1,c=null!=c?c:!1,d=[];if(null!=a){for(var e=this.getModel(),f=e.getChildCount(a),g=null,h=0,k=0;k<f;k++){var l=e.getChildAt(a,k);if(this.model.isVertex(l)&&this.isCellVisible(l)){for(var m=this.getConnections(l,b?a:null),n=0,o=0,q=0;q<m.length;q++)this.view.getVisibleTerminal(m[q],!0)==l?n++:o++;(c&&0==n&&0<o||!c&&0==o&&0<n)&&d.push(l);m=c?o-n:n-o;m>h&&(h=m,g=l)}}0==d.length&&null!=g&&d.push(g)}return d};
mxGraph.prototype.traverse=function(a,b,c,d,e){if(null!=c&&null!=a){var b=null!=b?b:!0,e=e||[],f=mxCellPath.create(a);if(null==e[f]&&(e[f]=a,d=c(a,d),null==d||d))if(d=this.model.getEdgeCount(a),0<d)for(f=0;f<d;f++){var g=this.model.getEdgeAt(a,f),h=this.model.getTerminal(g,!0)==a;if(!b||h)h=this.model.getTerminal(g,!h),this.traverse(h,b,c,g,e)}}};mxGraph.prototype.isCellSelected=function(a){return this.getSelectionModel().isSelected(a)};mxGraph.prototype.isSelectionEmpty=function(){return this.getSelectionModel().isEmpty()};
mxGraph.prototype.clearSelection=function(){return this.getSelectionModel().clear()};mxGraph.prototype.getSelectionCount=function(){return this.getSelectionModel().cells.length};mxGraph.prototype.getSelectionCell=function(){return this.getSelectionModel().cells[0]};mxGraph.prototype.getSelectionCells=function(){return this.getSelectionModel().cells.slice()};mxGraph.prototype.setSelectionCell=function(a){this.getSelectionModel().setCell(a)};mxGraph.prototype.setSelectionCells=function(a){this.getSelectionModel().setCells(a)};
mxGraph.prototype.addSelectionCell=function(a){this.getSelectionModel().addCell(a)};mxGraph.prototype.addSelectionCells=function(a){this.getSelectionModel().addCells(a)};mxGraph.prototype.removeSelectionCell=function(a){this.getSelectionModel().removeCell(a)};mxGraph.prototype.removeSelectionCells=function(a){this.getSelectionModel().removeCells(a)};mxGraph.prototype.selectRegion=function(a,b){var c=this.getCells(a.x,a.y,a.width,a.height);this.selectCellsForEvent(c,b);return c};
mxGraph.prototype.selectNextCell=function(){this.selectCell(!0)};mxGraph.prototype.selectPreviousCell=function(){this.selectCell()};mxGraph.prototype.selectParentCell=function(){this.selectCell(!1,!0)};mxGraph.prototype.selectChildCell=function(){this.selectCell(!1,!1,!0)};
mxGraph.prototype.selectCell=function(a,b,c){var d=this.selectionModel,e=0<d.cells.length?d.cells[0]:null;1<d.cells.length&&d.clear();var d=null!=e?this.model.getParent(e):this.getDefaultParent(),f=this.model.getChildCount(d);null==e&&0<f?(a=this.model.getChildAt(d,0),this.setSelectionCell(a)):(null==e||b)&&null!=this.view.getState(d)&&null!=this.model.getGeometry(d)?this.getCurrentRoot()!=d&&this.setSelectionCell(d):null!=e&&c?0<this.model.getChildCount(e)&&(a=this.model.getChildAt(e,0),this.setSelectionCell(a)):
0<f&&(b=d.getIndex(e),a?(b++,a=this.model.getChildAt(d,b%f)):(b--,a=this.model.getChildAt(d,0>b?f-1:b)),this.setSelectionCell(a))};mxGraph.prototype.selectAll=function(a){a=a||this.getDefaultParent();a=this.model.getChildren(a);null!=a&&this.setSelectionCells(a)};mxGraph.prototype.selectVertices=function(a){this.selectCells(!0,!1,a)};mxGraph.prototype.selectEdges=function(a){this.selectCells(!1,!0,a)};
mxGraph.prototype.selectCells=function(a,b,c){c=c||this.getDefaultParent();c=this.model.filterDescendants(mxUtils.bind(this,function(c){return null!=this.view.getState(c)&&0==this.model.getChildCount(c)&&(this.model.isVertex(c)&&a||this.model.isEdge(c)&&b)}),c);this.setSelectionCells(c)};mxGraph.prototype.selectCellForEvent=function(a,b){var c=this.isCellSelected(a);this.isToggleEvent(b)?c?this.removeSelectionCell(a):this.addSelectionCell(a):(!c||1!=this.getSelectionCount())&&this.setSelectionCell(a)};
mxGraph.prototype.selectCellsForEvent=function(a,b){this.isToggleEvent(b)?this.addSelectionCells(a):this.setSelectionCells(a)};
mxGraph.prototype.createHandler=function(a){var b=null;null!=a&&(this.model.isEdge(a.cell)?(b=this.view.getEdgeStyle(a),b=this.isLoop(a)||b==mxEdgeStyle.ElbowConnector||b==mxEdgeStyle.SideToSide||b==mxEdgeStyle.TopToBottom?new mxElbowEdgeHandler(a):b==mxEdgeStyle.SegmentConnector||b==mxEdgeStyle.OrthConnector?new mxEdgeSegmentHandler(a):new mxEdgeHandler(a)):b=new mxVertexHandler(a));return b};mxGraph.prototype.addMouseListener=function(a){null==this.mouseListeners&&(this.mouseListeners=[]);this.mouseListeners.push(a)};
mxGraph.prototype.removeMouseListener=function(a){if(null!=this.mouseListeners)for(var b=0;b<this.mouseListeners.length;b++)if(this.mouseListeners[b]==a){this.mouseListeners.splice(b,1);break}};mxGraph.prototype.updateMouseEvent=function(a){if(null==a.graphX||null==a.graphY){var b=mxUtils.convertPoint(this.container,a.getX(),a.getY());a.graphX=b.x-this.panDx;a.graphY=b.y-this.panDy}return a};
mxGraph.prototype.getStateForTouchEvent=function(a){var b=mxEvent.getClientX(a),a=mxEvent.getClientY(a),b=mxUtils.convertPoint(this.container,b,a);return this.view.getState(this.getCellAt(b.x,b.y))};
mxGraph.prototype.isEventIgnored=function(a,b,c){var d=mxEvent.isMouseEvent(b.getEvent()),e=this.isEditing();b.getEvent()==this.lastEvent?e=!0:this.lastEvent=b.getEvent();null!=this.eventSource&&a!=mxEvent.MOUSE_MOVE?(mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.eventSource=this.mouseUpRedirect=this.mouseMoveRedirect=null):null!=this.eventSource&&b.getSource()!=this.eventSource?e=!0:mxClient.IS_TOUCH&&a==mxEvent.MOUSE_DOWN&&!d&&(this.eventSource=
b.getSource(),this.mouseMoveRedirect=mxUtils.bind(this,function(a){this.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a,this.getStateForTouchEvent(a)))}),this.mouseUpRedirect=mxUtils.bind(this,function(a){this.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a,this.getStateForTouchEvent(a)))}),mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveRedirect,this.mouseUpRedirect));this.isSyntheticEventIgnored(a,b,c)&&(e=!0);!mxEvent.isPopupTrigger(this.lastEvent)&&mxClient.IS_IE&&"CSS1Compat"==
document.compatMode&&a!=mxEvent.MOUSE_MOVE&&2==b.getEvent().detail?null!=this.lastMouseX&&Math.abs(this.lastMouseX-b.getX())<=this.doubleTapTolerance&&null!=this.lastMouseY&&Math.abs(this.lastMouseY-b.getY())<=this.doubleTapTolerance&&(e=!0):!mxEvent.isPopupTrigger(this.lastEvent)&&a!=mxEvent.MOUSE_MOVE&&2==this.lastEvent.detail&&(e=!0);if(a==mxEvent.MOUSE_UP&&this.isMouseDown)this.isMouseDown=!1;else if(a==mxEvent.MOUSE_DOWN&&!this.isMouseDown)this.isMouseDown=!0,this.isMouseTrigger=d;else if(!e&&
((!mxClient.IS_FF||a!=mxEvent.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!=d||a==mxEvent.MOUSE_DOWN&&this.isMouseDown||a==mxEvent.MOUSE_UP&&!this.isMouseDown))e=!0;!e&&a==mxEvent.MOUSE_DOWN&&(this.lastMouseX=b.getX(),this.lastMouseY=b.getY());return e};
mxGraph.prototype.isSyntheticEventIgnored=function(a,b,c){c=!1;b=mxEvent.isMouseEvent(b.getEvent());this.ignoreMouseEvents&&b&&a!=mxEvent.MOUSE_MOVE?(this.ignoreMouseEvents=a!=mxEvent.MOUSE_UP,c=!0):mxClient.IS_FF&&!b&&a==mxEvent.MOUSE_UP&&(this.ignoreMouseEvents=!0);return c};
mxGraph.prototype.fireMouseEvent=function(a,b,c){null==c&&(c=this);b=this.updateMouseEvent(b);a==mxEvent.MOUSE_DOWN&&this.isEditing()&&!this.cellEditor.isEventSource(b.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing());if(!this.nativeDblClickEnabled&&!mxEvent.isPopupTrigger(b.getEvent())||this.doubleTapEnabled&&mxClient.IS_TOUCH&&mxEvent.isTouchEvent(b.getEvent())){var d=(new Date).getTime();if(this.isEnabled())if(!mxClient.IS_QUIRKS&&a==mxEvent.MOUSE_DOWN||mxClient.IS_QUIRKS&&a==mxEvent.MOUSE_UP&&
!this.fireDoubleClick){if(null!=this.lastTouchEvent&&this.lastTouchEvent!=b.getEvent()&&d-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-b.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-b.getY())<this.doubleTapTolerance&&2>this.doubleClickCounter){this.doubleClickCounter++;a==mxEvent.MOUSE_UP?b.getCell()==this.lastTouchCell&&null!=this.lastTouchCell&&(this.lastTouchTime=0,a=this.lastTouchCell,this.lastTouchCell=null,this.dblClick(b.getEvent(),a)):(this.fireDoubleClick=
!0,this.lastTouchTime=0);mxEvent.consume(b.getEvent());return}if(null==this.lastTouchEvent||this.lastTouchEvent!=b.getEvent())this.lastTouchCell=b.getCell(),this.lastTouchX=b.getX(),this.lastTouchY=b.getY(),this.lastTouchTime=d,this.lastTouchEvent=b.getEvent(),this.doubleClickCounter=0}else if((this.isMouseDown||a==mxEvent.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;a=this.lastTouchCell;this.lastTouchCell=null;(null!=a||mxEvent.isTouchEvent(b.getEvent())&&(mxClient.IS_GC||mxClient.IS_SF))&&
Math.abs(this.lastTouchX-b.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-b.getY())<this.doubleTapTolerance?this.dblClick(b.getEvent(),a):mxEvent.consume(b.getEvent());return}}if(!this.isEventIgnored(a,b,c)){this.fireEvent(new mxEventObject(mxEvent.FIRE_MOUSE_EVENT,"eventName",a,"event",b));if(mxClient.IS_OP||mxClient.IS_SF||mxClient.IS_GC||mxClient.IS_IE&&mxClient.IS_SVG||b.getEvent().target!=this.container){a==mxEvent.MOUSE_MOVE&&this.isMouseDown&&this.autoScroll&&this.scrollPointToVisible(b.getGraphX(),
b.getGraphY(),this.autoExtend);if(null!=this.mouseListeners){c=[c,b];b.getEvent().returnValue=!0;for(d=0;d<this.mouseListeners.length;d++){var e=this.mouseListeners[d];a==mxEvent.MOUSE_DOWN?e.mouseDown.apply(e,c):a==mxEvent.MOUSE_MOVE?e.mouseMove.apply(e,c):a==mxEvent.MOUSE_UP&&e.mouseUp.apply(e,c)}}a==mxEvent.MOUSE_UP&&this.click(b)}mxEvent.isTouchEvent(b.getEvent())&&a==mxEvent.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress?(this.tapAndHoldInProgress=!0,this.initialTouchX=b.getGraphX(),
this.initialTouchY=b.getGraphY(),this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(mxUtils.bind(this,function(){this.tapAndHoldValid&&this.tapAndHold(b);this.tapAndHoldValid=this.tapAndHoldInProgress=!1}),this.tapAndHoldDelay),this.tapAndHoldValid=!0):a==mxEvent.MOUSE_UP?this.tapAndHoldValid=this.tapAndHoldInProgress=!1:this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-b.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-
b.getGraphY())<this.tolerance);a==mxEvent.MOUSE_DOWN&&mxEvent.isTouchEvent(b.getEvent())&&b.consume(!1)}};mxGraph.prototype.fireGestureEvent=function(a,b){this.lastTouchTime=0;this.fireEvent(new mxEventObject(mxEvent.GESTURE,"event",a,"cell",b))};
mxGraph.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tooltipHandler&&this.tooltipHandler.destroy(),null!=this.selectionCellsHandler&&this.selectionCellsHandler.destroy(),null!=this.panningHandler&&this.panningHandler.destroy(),null!=this.popupMenuHandler&&this.popupMenuHandler.destroy(),null!=this.connectionHandler&&this.connectionHandler.destroy(),null!=this.graphHandler&&this.graphHandler.destroy(),null!=this.cellEditor&&this.cellEditor.destroy(),null!=this.view&&this.view.destroy(),
null!=this.model&&null!=this.graphModelChangeListener&&(this.model.removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null),this.container=null)};function mxCellOverlay(a,b,c,d,e,f){this.image=a;this.tooltip=b;this.align=null!=c?c:this.align;this.verticalAlign=null!=d?d:this.verticalAlign;this.offset=null!=e?e:new mxPoint;this.cursor=null!=f?f:"help"}mxCellOverlay.prototype=new mxEventSource;mxCellOverlay.prototype.constructor=mxCellOverlay;mxCellOverlay.prototype.image=null;
mxCellOverlay.prototype.tooltip=null;mxCellOverlay.prototype.align=mxConstants.ALIGN_RIGHT;mxCellOverlay.prototype.verticalAlign=mxConstants.ALIGN_BOTTOM;mxCellOverlay.prototype.offset=null;mxCellOverlay.prototype.cursor=null;mxCellOverlay.prototype.defaultOverlap=0.5;
mxCellOverlay.prototype.getBounds=function(a){var b=a.view.graph.getModel().isEdge(a.cell),c=a.view.scale,d=null,e=this.image.width,f=this.image.height;b?(b=a.absolutePoints,1==b.length%2?d=b[Math.floor(b.length/2)]:(d=b.length/2,a=b[d-1],b=b[d],d=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2))):(d=new mxPoint,d.x=this.align==mxConstants.ALIGN_LEFT?a.x:this.align==mxConstants.ALIGN_CENTER?a.x+a.width/2:a.x+a.width,d.y=this.verticalAlign==mxConstants.ALIGN_TOP?a.y:this.verticalAlign==mxConstants.ALIGN_MIDDLE?
a.y+a.height/2:a.y+a.height);return new mxRectangle(Math.round(d.x-(e*this.defaultOverlap-this.offset.x)*c),Math.round(d.y-(f*this.defaultOverlap-this.offset.y)*c),e*c,f*c)};mxCellOverlay.prototype.toString=function(){return this.tooltip};function mxOutline(a,b){this.source=a;null!=b&&this.init(b)}mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=!0;mxOutline.prototype.showViewport=!0;
mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.labelsVisible=!1;mxOutline.prototype.updateOnPan=!1;mxOutline.prototype.sizerImage=null;mxOutline.prototype.suspended=!1;mxOutline.prototype.forceVmlHandles=8==document.documentMode;
mxOutline.prototype.init=function(a){this.outline=new mxGraph(a,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());this.outline.foldingEnabled=!1;this.outline.autoScroll=!1;var b=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(a){!this.suspended&&null!=this.outline&&b.apply(this.outline,arguments)});mxClient.IS_SVG&&(a=this.outline.getView().getCanvas().parentNode,a.setAttribute("shape-rendering","optimizeSpeed"),a.setAttribute("image-rendering",
"optimizeSpeed"));this.outline.labelsVisible=this.labelsVisible;this.outline.setEnabled(!1);this.updateHandler=mxUtils.bind(this,function(){!this.suspended&&!this.active&&this.update()});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);a=this.source.getView();a.addListener(mxEvent.SCALE,this.updateHandler);a.addListener(mxEvent.TRANSLATE,this.updateHandler);a.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);a.addListener(mxEvent.DOWN,
this.updateHandler);a.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.panHandler=mxUtils.bind(this,function(a){this.updateOnPan&&this.updateHandler.apply(this,arguments)});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,
0,0,0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);this.selectionBorder.dialect=this.outline.dialect;this.forceVmlHandles&&(this.selectionBorder.isHtmlAllowed=function(){return!1});this.selectionBorder.init(this.outline.getView().getOverlayPane());a=mxUtils.bind(this,function(a){var b=mxEvent.getSource(a),e=mxUtils.bind(this,function(a){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(a))}),f=mxUtils.bind(this,
function(a){mxEvent.removeGestureListeners(b,null,e,f);this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(a))});mxEvent.addGestureListeners(b,null,e,f);this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a))});mxEvent.addGestureListeners(this.selectionBorder.node,a);this.sizer=this.createSizer();this.forceVmlHandles&&(this.sizer.isHtmlAllowed=function(){return!1});this.sizer.init(this.outline.getView().getOverlayPane());this.enabled&&(this.sizer.node.style.cursor="pointer");
mxEvent.addGestureListeners(this.sizer.node,a);this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(!1)};mxOutline.prototype.isEnabled=function(){return this.enabled};mxOutline.prototype.setEnabled=function(a){this.enabled=a};mxOutline.prototype.setZoomEnabled=function(a){this.sizer.node.style.visibility=a?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(!0)};
mxOutline.prototype.createSizer=function(){var a=null!=this.sizerImage?new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src):new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR);a.dialect=this.outline.dialect;return a};mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};
mxOutline.prototype.getOutlineOffset=function(){return null};
mxOutline.prototype.update=function(a){if(null!=this.source){var b=this.source.view.scale,c=this.source.getGraphBounds(),c=new mxRectangle(c.x/b+this.source.panDx,c.y/b+this.source.panDy,c.width/b,c.height/b),d=new mxRectangle(0,0,this.source.container.clientWidth/b,this.source.container.clientHeight/b),e=c.clone();e.add(d);var f=this.getSourceContainerSize(),d=Math.max(f.width/b,e.width),b=Math.max(f.height/b,e.height),e=Math.max(0,this.outline.container.clientWidth-this.border),f=Math.max(0,this.outline.container.clientHeight-
this.border),e=Math.min(e/d,f/b);if(0<e){this.outline.getView().scale!=e&&(this.outline.getView().scale=e,a=!0);d=this.outline.getView();d.currentRoot!=this.source.getView().currentRoot&&d.setCurrentRoot(this.source.getView().currentRoot);var b=this.source.view.translate,f=b.x+this.source.panDx,g=b.y+this.source.panDy,e=this.getOutlineOffset(e);null!=e&&(f+=e.x,g+=e.y);0>c.x&&(f-=c.x);0>c.y&&(g-=c.y);if(d.translate.x!=f||d.translate.y!=g)d.translate.x=f,d.translate.y=g,a=!0;var c=d.translate,e=this.source.getView().scale,
f=e/d.scale,g=1/d.scale,h=this.source.container;this.bounds=new mxRectangle((c.x-b.x-this.source.panDx)/g,(c.y-b.y-this.source.panDy)/g,h.clientWidth/f,h.clientHeight/f);this.bounds.x+=this.source.container.scrollLeft*d.scale/e;this.bounds.y+=this.source.container.scrollTop*d.scale/e;c=this.selectionBorder.bounds;if(c.x!=this.bounds.x||c.y!=this.bounds.y||c.width!=this.bounds.width||c.height!=this.bounds.height)this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw();c=this.sizer.bounds;
d=new mxRectangle(this.bounds.x+this.bounds.width-c.width/2,this.bounds.y+this.bounds.height-c.height/2,c.width,c.height);if(c.x!=d.x||c.y!=d.y||c.width!=d.width||c.height!=d.height)this.sizer.bounds=d,"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();a&&this.outline.view.revalidate()}}};
mxOutline.prototype.mouseDown=function(a,b){if(this.enabled&&this.showViewport){var c=!mxEvent.isMouseEvent(b.getEvent())?this.source.tolerance:0,c=this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(b.getGraphX()-c,b.getGraphY()-c,2*c,2*c):null;this.zoom=b.isSource(this.sizer)||null!=c&&mxUtils.intersects(shape.bounds,c);this.startX=b.getX();this.startY=b.getY();this.active=!0;this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)?(this.dx0=this.source.container.scrollLeft,
this.dy0=this.source.container.scrollTop):this.dy0=this.dx0=0}b.consume()};
mxOutline.prototype.mouseMove=function(a,b){if(this.active){this.selectionBorder.node.style.display=this.showViewport?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var c=this.getTranslateForEvent(b),d=c.x,e=c.y,c=null;if(this.zoom)c=this.source.container,e=d/(c.clientWidth/c.clientHeight),c=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+d),Math.max(1,this.bounds.height+e)),this.selectionBorder.bounds=c,this.selectionBorder.redraw();else{var f=
this.outline.getView().scale,c=new mxRectangle(this.bounds.x+d,this.bounds.y+e,this.bounds.width,this.bounds.height);this.selectionBorder.bounds=c;this.selectionBorder.redraw();d=d/f*this.source.getView().scale;e=e/f*this.source.getView().scale;this.source.panGraph(-d-this.dx0,-e-this.dy0)}d=this.sizer.bounds;this.sizer.bounds=new mxRectangle(c.x+c.width-d.width/2,c.y+c.height-d.height/2,d.width,d.height);"hidden"!=this.sizer.node.style.visibility&&this.sizer.redraw();b.consume()}};
mxOutline.prototype.getTranslateForEvent=function(a){return new mxPoint(a.getX()-this.startX,a.getY()-this.startY)};
mxOutline.prototype.mouseUp=function(a,b){if(this.active){var c=this.getTranslateForEvent(b),d=c.x,c=c.y;if(0<Math.abs(d)||0<Math.abs(c)){if(this.zoom){var c=this.selectionBorder.bounds.width,e=this.source.getView().scale;this.source.zoomTo(e-d*e/c,!1)}else if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container))this.source.panGraph(0,0),d/=this.outline.getView().scale,c/=this.outline.getView().scale,e=this.source.getView().translate,this.source.getView().setTranslate(e.x-
d,e.y-c);this.update();b.consume()}this.index=null;this.active=!1}};
mxOutline.prototype.destroy=function(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),mxEvent.addListener(this.source.container,"scroll",this.updateHandler),this.source=null);null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null);null!=this.selectionBorder&&(this.selectionBorder.destroy(),
this.selectionBorder=null);null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)};function mxMultiplicity(a,b,c,d,e,f,g,h,k,l){this.source=a;this.type=b;this.attr=c;this.value=d;this.min=null!=e?e:0;this.max=null!=f?f:"n";this.validNeighbors=g;this.countError=mxResources.get(h)||h;this.typeError=mxResources.get(k)||k;this.validNeighborsAllowed=null!=l?l:!0}mxMultiplicity.prototype.type=null;mxMultiplicity.prototype.attr=null;mxMultiplicity.prototype.value=null;mxMultiplicity.prototype.source=null;
mxMultiplicity.prototype.min=null;mxMultiplicity.prototype.max=null;mxMultiplicity.prototype.validNeighbors=null;mxMultiplicity.prototype.validNeighborsAllowed=!0;mxMultiplicity.prototype.countError=null;mxMultiplicity.prototype.typeError=null;
mxMultiplicity.prototype.check=function(a,b,c,d,e,f){var g="";if(this.source&&this.checkTerminal(a,c,b)||!this.source&&this.checkTerminal(a,d,b)){if(null!=this.countError&&(this.source&&(0==this.max||e>=this.max)||!this.source&&(0==this.max||f>=this.max)))g+=this.countError+"\n";null!=this.validNeighbors&&null!=this.typeError&&0<this.validNeighbors.length&&(this.checkNeighbors(a,b,c,d)||(g+=this.typeError+"\n"))}return 0<g.length?g:null};
mxMultiplicity.prototype.checkNeighbors=function(a,b,c,d){for(var b=a.model.getValue(c),d=a.model.getValue(d),c=!this.validNeighborsAllowed,e=this.validNeighbors,f=0;f<e.length;f++)if(this.source&&this.checkType(a,d,e[f])){c=this.validNeighborsAllowed;break}else if(!this.source&&this.checkType(a,b,e[f])){c=this.validNeighborsAllowed;break}return c};mxMultiplicity.prototype.checkTerminal=function(a,b){b=a.model.getValue(b);return this.checkType(a,b,this.type,this.attr,this.value)};
mxMultiplicity.prototype.checkType=function(a,b,c,d,e){return null!=b?isNaN(b.nodeType)?b==c:mxUtils.isNode(b,c,d,e):!1};function mxLayoutManager(a){this.undoHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.beforeUndo(c.getProperty("edit"))});this.moveHandler=mxUtils.bind(this,function(a,c){this.isEnabled()&&this.cellsMoved(c.getProperty("cells"),c.getProperty("event"))});this.setGraph(a)}mxLayoutManager.prototype=new mxEventSource;mxLayoutManager.prototype.constructor=mxLayoutManager;
mxLayoutManager.prototype.graph=null;mxLayoutManager.prototype.bubbling=!0;mxLayoutManager.prototype.enabled=!0;mxLayoutManager.prototype.updateHandler=null;mxLayoutManager.prototype.moveHandler=null;mxLayoutManager.prototype.isEnabled=function(){return this.enabled};mxLayoutManager.prototype.setEnabled=function(a){this.enabled=a};mxLayoutManager.prototype.isBubbling=function(){return this.bubbling};mxLayoutManager.prototype.setBubbling=function(a){this.bubbling=a};
mxLayoutManager.prototype.getGraph=function(){return this.graph};mxLayoutManager.prototype.setGraph=function(a){if(null!=this.graph){var b=this.graph.getModel();b.removeListener(this.undoHandler);this.graph.removeListener(this.moveHandler)}this.graph=a;null!=this.graph&&(b=this.graph.getModel(),b.addListener(mxEvent.BEFORE_UNDO,this.undoHandler),this.graph.addListener(mxEvent.MOVE_CELLS,this.moveHandler))};mxLayoutManager.prototype.getLayout=function(){return null};
mxLayoutManager.prototype.beforeUndo=function(a){var a=this.getCellsForChanges(a.changes),b=this.getGraph().getModel();if(this.isBubbling())for(var c=b.getParents(a);0<c.length;)a=a.concat(c),c=b.getParents(c);this.layoutCells(mxUtils.sortCells(a,!1))};
mxLayoutManager.prototype.cellsMoved=function(a,b){if(null!=a&&null!=b)for(var c=mxUtils.convertPoint(this.getGraph().container,mxEvent.getClientX(b),mxEvent.getClientY(b)),d=this.getGraph().getModel(),e=0;e<a.length;e++){var f=this.getLayout(d.getParent(a[e]));null!=f&&f.moveCell(a[e],c.x,c.y)}};
mxLayoutManager.prototype.getCellsForChanges=function(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d];if(e instanceof mxRootChange)return[];for(var e=this.getCellsForChange(e),f=0;f<e.length;f++)if(null!=e[f]){var g=mxCellPath.create(e[f]);null==c[g]&&(c[g]=e[f],b.push(e[f]))}}return b};
mxLayoutManager.prototype.getCellsForChange=function(a){var b=this.getGraph().getModel();return a instanceof mxChildChange?[a.child,a.previous,b.getParent(a.child)]:a instanceof mxTerminalChange||a instanceof mxGeometryChange?[a.cell,b.getParent(a.cell)]:[]};
mxLayoutManager.prototype.layoutCells=function(a){if(0<a.length){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=null,d=0;d<a.length;d++)a[d]!=b.getRoot()&&a[d]!=c&&(c=a[d],this.executeLayout(this.getLayout(c),c));this.fireEvent(new mxEventObject(mxEvent.LAYOUT_CELLS,"cells",a))}finally{b.endUpdate()}}};mxLayoutManager.prototype.executeLayout=function(a,b){null!=a&&null!=b&&a.execute(b)};mxLayoutManager.prototype.destroy=function(){this.setGraph(null)};
function mxSpaceManager(a,b,c,d){this.resizeHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.cellsResized(b.getProperty("cells"))});this.foldHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.cellsResized(b.getProperty("cells"))});this.shiftRightwards=null!=b?b:!0;this.shiftDownwards=null!=c?c:!0;this.extendParents=null!=d?d:!0;this.setGraph(a)}mxSpaceManager.prototype=new mxEventSource;mxSpaceManager.prototype.constructor=mxSpaceManager;mxSpaceManager.prototype.graph=null;
mxSpaceManager.prototype.enabled=!0;mxSpaceManager.prototype.shiftRightwards=!0;mxSpaceManager.prototype.shiftDownwards=!0;mxSpaceManager.prototype.extendParents=!0;mxSpaceManager.prototype.resizeHandler=null;mxSpaceManager.prototype.foldHandler=null;mxSpaceManager.prototype.isCellIgnored=function(a){return!this.getGraph().getModel().isVertex(a)};mxSpaceManager.prototype.isCellShiftable=function(a){return this.getGraph().getModel().isVertex(a)&&this.getGraph().isCellMovable(a)};
mxSpaceManager.prototype.isEnabled=function(){return this.enabled};mxSpaceManager.prototype.setEnabled=function(a){this.enabled=a};mxSpaceManager.prototype.isShiftRightwards=function(){return this.shiftRightwards};mxSpaceManager.prototype.setShiftRightwards=function(a){this.shiftRightwards=a};mxSpaceManager.prototype.isShiftDownwards=function(){return this.shiftDownwards};mxSpaceManager.prototype.setShiftDownwards=function(a){this.shiftDownwards=a};mxSpaceManager.prototype.isExtendParents=function(){return this.extendParents};
mxSpaceManager.prototype.setExtendParents=function(a){this.extendParents=a};mxSpaceManager.prototype.getGraph=function(){return this.graph};mxSpaceManager.prototype.setGraph=function(a){null!=this.graph&&(this.graph.removeListener(this.resizeHandler),this.graph.removeListener(this.foldHandler));this.graph=a;null!=this.graph&&(this.graph.addListener(mxEvent.RESIZE_CELLS,this.resizeHandler),this.graph.addListener(mxEvent.FOLD_CELLS,this.foldHandler))};
mxSpaceManager.prototype.cellsResized=function(a){if(null!=a){var b=this.graph.getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)if(!this.isCellIgnored(a[c])){this.cellResized(a[c]);break}}finally{b.endUpdate()}}};
mxSpaceManager.prototype.cellResized=function(a){var b=this.getGraph(),c=b.getView(),d=b.getModel(),e=c.getState(a),f=c.getState(d.getParent(a));if(null!=e&&null!=f){var g=this.getCellsToShift(e),h=d.getGeometry(a);if(null!=g&&null!=h){var k=c.translate,l=c.scale,c=e.x-f.origin.x-k.x*l,f=e.y-f.origin.y-k.y*l,k=e.x+e.width,m=e.y+e.height,n=e.width-h.width*l+c-h.x*l,o=e.height-h.height*l+f-h.y*l,q=1-h.width*l/e.width,e=1-h.height*l/e.height;d.beginUpdate();try{for(h=0;h<g.length;h++)g[h]!=a&&this.isCellShiftable(g[h])&&
this.shiftCell(g[h],n,o,c,f,k,m,q,e,this.isExtendParents()&&b.isExtendParent(g[h]))}finally{d.endUpdate()}}}};
mxSpaceManager.prototype.shiftCell=function(a,b,c,d,e,f,g,h,k,l){var d=this.getGraph(),m=d.getView().getState(a);if(null!=m){var n=d.getModel(),o=n.getGeometry(a);if(null!=o){n.beginUpdate();try{if(this.isShiftRightwards())if(m.x>=f)o=o.clone(),o.translate(-b,0);else{var q=Math.max(0,m.x-x0),o=o.clone();o.translate(-h*q,0)}if(this.isShiftDownwards())if(m.y>=g)o=o.clone(),o.translate(0,-c);else{var r=Math.max(0,m.y-e),o=o.clone();o.translate(0,-k*r)}o!=n.getGeometry(a)&&(n.setGeometry(a,o),l&&d.extendParent(a))}finally{n.endUpdate()}}}};
mxSpaceManager.prototype.getCellsToShift=function(a){var b=this.getGraph(),c=b.getModel().getParent(a.cell),d=this.isShiftDownwards(),e=this.isShiftRightwards();return b.getCellsBeyond(a.x+(d?0:a.width),a.y+(d&&e?0:a.height),c,e,d)};mxSpaceManager.prototype.destroy=function(){this.setGraph(null)};
function mxSwimlaneManager(a,b,c,d){this.horizontal=null!=b?b:!0;this.addEnabled=null!=c?c:!0;this.resizeEnabled=null!=d?d:!0;this.addHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(b.getProperty("cells"))});this.resizeHandler=mxUtils.bind(this,function(a,b){this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(b.getProperty("cells"))});this.setGraph(a)}mxSwimlaneManager.prototype=new mxEventSource;mxSwimlaneManager.prototype.constructor=mxSwimlaneManager;
mxSwimlaneManager.prototype.graph=null;mxSwimlaneManager.prototype.enabled=!0;mxSwimlaneManager.prototype.horizontal=!0;mxSwimlaneManager.prototype.addEnabled=!0;mxSwimlaneManager.prototype.resizeEnabled=!0;mxSwimlaneManager.prototype.addHandler=null;mxSwimlaneManager.prototype.resizeHandler=null;mxSwimlaneManager.prototype.isEnabled=function(){return this.enabled};mxSwimlaneManager.prototype.setEnabled=function(a){this.enabled=a};mxSwimlaneManager.prototype.isHorizontal=function(){return this.horizontal};
mxSwimlaneManager.prototype.setHorizontal=function(a){this.horizontal=a};mxSwimlaneManager.prototype.isAddEnabled=function(){return this.addEnabled};mxSwimlaneManager.prototype.setAddEnabled=function(a){this.addEnabled=a};mxSwimlaneManager.prototype.isResizeEnabled=function(){return this.resizeEnabled};mxSwimlaneManager.prototype.setResizeEnabled=function(a){this.resizeEnabled=a};mxSwimlaneManager.prototype.getGraph=function(){return this.graph};
mxSwimlaneManager.prototype.setGraph=function(a){null!=this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler));this.graph=a;null!=this.graph&&(this.graph.addListener(mxEvent.ADD_CELLS,this.addHandler),this.graph.addListener(mxEvent.CELLS_RESIZED,this.resizeHandler))};mxSwimlaneManager.prototype.isSwimlaneIgnored=function(a){return!this.getGraph().isSwimlane(a)};
mxSwimlaneManager.prototype.isCellHorizontal=function(a){return this.graph.isSwimlane(a)?(a=this.graph.getCellStyle(a),1==mxUtils.getValue(a,mxConstants.STYLE_HORIZONTAL,1)):!this.isHorizontal()};mxSwimlaneManager.prototype.cellsAdded=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)this.isSwimlaneIgnored(a[c])||this.swimlaneAdded(a[c])}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.swimlaneAdded=function(a){for(var b=this.getGraph().getModel(),c=b.getParent(a),d=b.getChildCount(c),e=null,f=0;f<d;f++){var g=b.getChildAt(c,f);if(g!=a&&!this.isSwimlaneIgnored(g)&&(e=b.getGeometry(g),null!=e))break}null!=e&&(b=null!=c?this.isCellHorizontal(c):this.horizontal,this.resizeSwimlane(a,e.width,e.height,b))};
mxSwimlaneManager.prototype.cellsResized=function(a){if(null!=a){var b=this.getGraph().getModel();b.beginUpdate();try{for(var c=0;c<a.length;c++)if(!this.isSwimlaneIgnored(a[c])){var d=b.getGeometry(a[c]);if(null!=d){for(var e=new mxRectangle(0,0,d.width,d.height),f=a[c],g=f;null!=g;){var f=g,g=b.getParent(g),h=this.graph.isSwimlane(g)?this.graph.getStartSize(g):new mxRectangle;e.width+=h.width;e.height+=h.height}var k=null!=g?this.isCellHorizontal(g):this.horizontal;this.resizeSwimlane(f,e.width,
e.height,k)}}}finally{b.endUpdate()}}};
mxSwimlaneManager.prototype.resizeSwimlane=function(a,b,c,d){var e=this.getGraph().getModel();e.beginUpdate();try{var f=this.isCellHorizontal(a);if(!this.isSwimlaneIgnored(a)){var g=e.getGeometry(a);if(null!=g&&(d&&g.height!=c||!d&&g.width!=b))g=g.clone(),d?g.height=c:g.width=b,e.setGeometry(a,g)}for(var h=this.graph.isSwimlane(a)?this.graph.getStartSize(a):new mxRectangle,b=b-h.width,c=c-h.height,k=e.getChildCount(a),d=0;d<k;d++)this.resizeSwimlane(e.getChildAt(a,d),b,c,f)}finally{e.endUpdate()}};
mxSwimlaneManager.prototype.destroy=function(){this.setGraph(null)};function mxTemporaryCellStates(a,b,c){this.view=a;b=null!=b?b:1;this.oldBounds=a.getGraphBounds();this.oldStates=a.getStates();this.oldScale=a.getScale();a.setStates(new mxDictionary);a.setScale(b);if(null!=c){for(var b=a.createState(new mxCell),d=0;d<c.length;d++)a.validateBounds(b,c[d]);for(var e=null,d=0;d<c.length;d++){var f=a.validatePoints(b,c[d]);null==e?e=f:e.add(f)}null==e&&(e=new mxRectangle);a.setGraphBounds(e)}}
mxTemporaryCellStates.prototype.view=null;mxTemporaryCellStates.prototype.oldStates=null;mxTemporaryCellStates.prototype.oldBounds=null;mxTemporaryCellStates.prototype.oldScale=null;mxTemporaryCellStates.prototype.destroy=function(){this.view.setScale(this.oldScale);this.view.setStates(this.oldStates);this.view.setGraphBounds(this.oldBounds)};function mxCellStatePreview(a){this.graph=a;this.deltas={}}mxCellStatePreview.prototype.graph=null;mxCellStatePreview.prototype.deltas=null;
mxCellStatePreview.prototype.count=0;mxCellStatePreview.prototype.isEmpty=function(){return 0==this.count};mxCellStatePreview.prototype.moveState=function(a,b,c,d,e){var d=null!=d?d:!0,e=null!=e?e:!0,f=mxCellPath.create(a.cell),g=this.deltas[f];null==g?(g=new mxPoint(b,c),this.deltas[f]=g,this.count++):d?(g.X+=b,g.Y+=c):(g.X=b,g.Y=c);e&&this.addEdges(a);return g};
mxCellStatePreview.prototype.show=function(a){var b=this.graph.getModel(),c=b.getRoot(),d;for(d in this.deltas){var e=mxCellPath.resolve(c,d),f=this.graph.view.getState(e),g=this.deltas[d],e=this.graph.view.getState(b.getParent(e));this.translateState(e,f,g.x,g.y)}for(d in this.deltas)e=mxCellPath.resolve(c,d),f=this.graph.view.getState(e),g=this.deltas[d],e=this.graph.view.getState(b.getParent(e)),this.revalidateState(e,f,g.x,g.y,a)};
mxCellStatePreview.prototype.translateState=function(a,b,c,d){if(null!=b){var e=this.graph.getModel();if(e.isVertex(b.cell)){b.invalid=!0;this.graph.view.validateBounds(a,b.cell);var a=e.getGeometry(b.cell),f=mxCellPath.create(b.cell);if((0!=c||0!=d)&&null!=a&&(!a.relative||null!=this.deltas[f]))b.x+=c,b.y+=d}a=e.getChildCount(b.cell);for(f=0;f<a;f++)this.translateState(b,this.graph.view.getState(e.getChildAt(b.cell,f)),c,d)}};
mxCellStatePreview.prototype.revalidateState=function(a,b,c,d,e){if(null!=b){b.invalid=!0;this.graph.view.validatePoints(a,b.cell);var f=mxCellPath.create(b.cell),g=this.graph.getModel(),h=this.graph.getCellGeometry(b.cell);if((0!=c||0!=d)&&null!=h&&h.relative&&g.isVertex(b.cell)&&(null==a||g.isVertex(a.cell)||null!=this.deltas[f]))b.x+=c,b.y+=d,this.graph.cellRenderer.redraw(b);null!=e&&e(b);a=g.getChildCount(b.cell);for(f=0;f<a;f++)this.revalidateState(b,this.graph.view.getState(g.getChildAt(b.cell,
f)),c,d,e)}};mxCellStatePreview.prototype.addEdges=function(a){for(var b=this.graph.getModel(),c=b.getEdgeCount(a.cell),d=0;d<c;d++){var e=this.graph.view.getState(b.getEdgeAt(a.cell,d));null!=e&&this.moveState(e,0,0)}};function mxConnectionConstraint(a,b){this.point=a;this.perimeter=null!=b?b:!0}mxConnectionConstraint.prototype.point=null;mxConnectionConstraint.prototype.perimeter=null;
function mxGraphHandler(a){this.graph=a;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape()});this.graph.addListener(mxEvent.PAN,this.panHandler)}mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=mxClient.IS_IE?20:50;mxGraphHandler.prototype.enabled=!0;mxGraphHandler.prototype.highlightEnabled=!0;mxGraphHandler.prototype.cloneEnabled=!0;mxGraphHandler.prototype.moveEnabled=!0;mxGraphHandler.prototype.guidesEnabled=!1;
mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=!0;mxGraphHandler.prototype.selectEnabled=!0;mxGraphHandler.prototype.removeCellsFromParent=!0;mxGraphHandler.prototype.connectOnDrop=!1;mxGraphHandler.prototype.scrollOnMove=!0;mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=!1;mxGraphHandler.prototype.shape=null;
mxGraphHandler.prototype.scaleGrid=!1;mxGraphHandler.prototype.rotationEnabled=!0;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(a){this.enabled=a};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};mxGraphHandler.prototype.setCloneEnabled=function(a){this.cloneEnabled=a};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};
mxGraphHandler.prototype.setMoveEnabled=function(a){this.moveEnabled=a};mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(a){this.selectEnabled=a};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};mxGraphHandler.prototype.setRemoveCellsFromParent=function(a){this.removeCellsFromParent=a};mxGraphHandler.prototype.getInitialCellForEvent=function(a){return a.getCell()};
mxGraphHandler.prototype.isDelayedSelection=function(a){return this.graph.isCellSelected(a)};
mxGraphHandler.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=b.getState()){var c=this.getInitialCellForEvent(b);this.delayedSelection=this.isDelayedSelection(c);this.cell=null;this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent());if(this.isMoveEnabled()){var d=this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||null!=e.points&&0<e.points.length||
null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;!mxClient.IS_SF&&!mxClient.IS_GC||"SELECT"!=b.getSource().nodeName?b.consume():mxClient.IS_SF&&"SELECT"==b.getSource().nodeName&&(this.cellWasClicked=!1,this.first=null)}}};
mxGraphHandler.prototype.getGuideStates=function(){var a=this.graph.getDefaultParent(),b=this.graph.getModel(),c=mxUtils.bind(this,function(a){return null!=this.graph.view.getState(a)&&b.isVertex(a)&&null!=b.getGeometry(a)&&!b.getGeometry(a).relative});return this.graph.view.getCellStates(b.filterDescendants(c,a))};mxGraphHandler.prototype.getCells=function(a){return!this.delayedSelection&&this.graph.isCellMovable(a)?[a]:this.graph.getMovableCells(this.graph.getSelectionCells())};
mxGraphHandler.prototype.getPreviewBounds=function(a){a=this.getBoundingBox(a);null!=a&&(a.grow(-1,-1),a.width<this.minimumSize&&(a.x-=(this.minimumSize-a.width)/2,a.width=this.minimumSize),a.height<this.minimumSize&&(a.y-=(this.minimumSize-a.height)/2,a.height=this.minimumSize));return a};
mxGraphHandler.prototype.getBoundingBox=function(a){var b=null;if(null!=a&&0<a.length)for(var c=this.graph.getModel(),d=0;d<a.length;d++)if(c.isVertex(a[d])||c.isEdge(a[d])){var e=this.graph.view.getState(a[d]);if(null!=e){var f=e;c.isVertex(a[d])&&null!=e.shape&&null!=e.shape.boundingBox&&(f=e.shape.boundingBox);null==b?b=new mxRectangle(f.x,f.y,f.width,f.height):b.add(f)}}return b};
mxGraphHandler.prototype.createPreviewShape=function(a){a=new mxRectangleShape(a,null,this.previewColor);a.isDashed=!0;this.htmlPreview?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()),a.pointerEvents=!1);return a};
mxGraphHandler.prototype.start=function(a,b,c){this.cell=a;this.first=mxUtils.convertPoint(this.graph.container,b,c);this.cells=this.getCells(this.cell);this.bounds=this.graph.getView().getBounds(this.cells);this.pBounds=this.getPreviewBounds(this.cells);this.guidesEnabled&&(this.guide=new mxGuide(this.graph,this.getGuideStates()))};mxGraphHandler.prototype.useGuidesForEvent=function(a){return null!=this.guide?this.guide.isEnabledForEvent(a.getEvent()):!0};
mxGraphHandler.prototype.snap=function(a){var b=this.scaleGrid?this.graph.view.scale:1;a.x=this.graph.snap(a.x/b)*b;a.y=this.graph.snap(a.y/b)*b;return a};
mxGraphHandler.prototype.mouseMove=function(a,b){var c=this.graph;if(!b.isConsumed()&&c.isMouseDown&&null!=this.cell&&null!=this.first&&null!=this.bounds){var d=mxUtils.convertPoint(c.container,b.getX(),b.getY()),e=d.x-this.first.x,f=d.y-this.first.y,d=c.tolerance;if(null!=this.shape||Math.abs(e)>d||Math.abs(f)>d){null==this.highlight&&(this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3));null==this.shape&&(this.shape=this.createPreviewShape(this.bounds));var g=c.isGridEnabledEvent(b.getEvent()),
d=!0;if(null!=this.guide&&this.useGuidesForEvent(b))f=this.guide.move(this.bounds,new mxPoint(e,f),g),d=!1,e=f.x,f=f.y;else if(g)var h=c.getView().translate,k=c.getView().scale,g=this.bounds.x-(c.snap(this.bounds.x/k-h.x)+h.x)*k,h=this.bounds.y-(c.snap(this.bounds.y/k-h.y)+h.y)*k,f=this.snap(new mxPoint(e,f)),e=f.x-g,f=f.y-h;null!=this.guide&&d&&this.guide.hide();c.isConstrainedEvent(b.getEvent())&&(Math.abs(e)>Math.abs(f)?f=0:e=0);this.currentDx=e;this.currentDy=f;this.updatePreviewShape();d=null;
f=b.getCell();c.isDropEnabled()&&this.highlightEnabled&&(d=c.getDropTarget(this.cells,b.getEvent(),f));g=d;for(h=c.getModel();null!=g&&g!=this.cells[0];)g=h.getParent(g);var k=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled(),e=c.getView().getState(d),l=!1;null!=e&&null==g&&(h.getParent(this.cell)!=d||k)?(this.target!=d&&(this.target=d,this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)),l=!0):(this.target=null,this.connectOnDrop&&null!=f&&1==this.cells.length&&c.getModel().isVertex(f)&&
c.isCellConnectable(f)&&(e=c.getView().getState(f),null!=e&&(c=null==c.getEdgeValidationError(null,this.cell,f)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR,this.setHighlightColor(c),l=!0)));null!=e&&l?this.highlight.highlight(e):this.highlight.hide()}b.consume();mxEvent.consume(b.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!b.isConsumed()&&null!=b.getState()&&!c.isMouseDown)e=c.getCursorForCell(b.getCell()),null==e&&c.isEnabled()&&c.isCellMovable(b.getCell())&&
(e=c.getModel().isEdge(b.getCell())?mxConstants.CURSOR_MOVABLE_EDGE:mxConstants.CURSOR_MOVABLE_VERTEX),b.getState().setCursor(e)};mxGraphHandler.prototype.updatePreviewShape=function(){null!=this.shape&&(this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())};mxGraphHandler.prototype.setHighlightColor=function(a){null!=this.highlight&&this.highlight.setHighlightColor(a)};
mxGraphHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()){var c=this.graph;if(null!=this.cell&&null!=this.first&&null!=this.shape&&null!=this.currentDx&&null!=this.currentDy){var d=c.getView().scale,e=c.isCloneEvent(b.getEvent())&&c.isCellsCloneable()&&this.isCloneEnabled(),f=this.currentDx/d,d=this.currentDy/d,g=b.getCell();this.connectOnDrop&&null==this.target&&null!=g&&c.getModel().isVertex(g)&&c.isCellConnectable(g)&&c.isEdgeValid(null,this.cell,g)?c.connectionHandler.connect(this.cell,
g,b.getEvent()):(g=this.target,c.isSplitEnabled()&&c.isSplitTarget(g,this.cells,b.getEvent())?c.splitEdge(g,this.cells,null,f,d):this.moveCells(this.cells,f,d,e,this.target,b.getEvent()))}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(b)}this.cellWasClicked&&b.consume();this.reset()};mxGraphHandler.prototype.selectDelayed=function(a){this.graph.selectCellForEvent(this.cell,a.getEvent())};
mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.delayedSelection=this.cellWasClicked=!1;this.target=this.cell=this.first=this.guides=this.currentDy=this.currentDx=null};
mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(a,b,c){if(this.graph.getModel().isVertex(a)){var a=this.graph.getView().getState(a),c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(c),mxEvent.getClientY(c)),d=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0);if(0!=d)var b=Math.cos(-d),d=Math.sin(-d),e=new mxPoint(a.getCenterX(),a.getCenterY()),c=mxUtils.getRotatedPoint(c,b,d,e);return null!=a&&!mxUtils.contains(a,c.x,c.y)}return!1};
mxGraphHandler.prototype.moveCells=function(a,b,c,d,e,f){d&&(a=this.graph.getCloneableCells(a));null==e&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),a,f)&&(e=this.graph.getDefaultParent());a=this.graph.moveCells(a,b-this.graph.panDx/this.graph.view.scale,c-this.graph.panDy/this.graph.view.scale,d,e,f);this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(a[0]);d&&this.graph.setSelectionCells(a)};
mxGraphHandler.prototype.destroyShapes=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.guide&&(this.guide.destroy(),this.guide=null);null!=this.highlight&&(this.highlight.destroy(),this.highlight=null)};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);this.destroyShapes()};
function mxPanningHandler(a){null!=a&&(this.graph=a,this.graph.addMouseListener(this),this.forcePanningHandler=mxUtils.bind(this,function(a,c){var d=c.getProperty("eventName"),e=c.getProperty("event");d==mxEvent.MOUSE_DOWN&&this.isForcePanningEvent(e)&&(this.start(e),this.active=!0,e.consume())}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler))}mxPanningHandler.prototype=new mxEventSource;mxPanningHandler.prototype.constructor=mxPanningHandler;
mxPanningHandler.prototype.graph=null;mxPanningHandler.prototype.useLeftButtonForPanning=!1;mxPanningHandler.prototype.usePopupTrigger=!0;mxPanningHandler.prototype.ignoreCell=!1;mxPanningHandler.prototype.previewEnabled=!0;mxPanningHandler.prototype.useGrid=!1;mxPanningHandler.prototype.panningEnabled=!0;mxPanningHandler.prototype.isPanningEnabled=function(){return this.panningEnabled};mxPanningHandler.prototype.setPanningEnabled=function(a){this.panningEnabled=a};
mxPanningHandler.prototype.isPanningTrigger=function(a){var b=a.getEvent();return this.useLeftButtonForPanning&&(this.ignoreCell||null==a.getState())&&mxEvent.isLeftMouseButton(b)||mxEvent.isControlDown(b)&&mxEvent.isShiftDown(b)||this.usePopupTrigger&&mxEvent.isPopupTrigger(b)};mxPanningHandler.prototype.isForcePanningEvent=function(){return!1};mxPanningHandler.prototype.mouseDown=function(a,b){!b.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(b)&&(this.start(b),this.consumePanningTrigger(b))};
mxPanningHandler.prototype.start=function(a){this.dx0=-this.graph.container.scrollLeft;this.dy0=-this.graph.container.scrollTop;this.startX=a.getX();this.startY=a.getY();this.panningTrigger=!0};mxPanningHandler.prototype.consumePanningTrigger=function(a){a.consume()};
mxPanningHandler.prototype.mouseMove=function(a,b){var c=b.getX()-this.startX,d=b.getY()-this.startY;if(this.active){var e=b.getEvent().scale;null!=e&&1!=e?this.scaleGraph(e,!0):this.previewEnabled&&(this.useGrid&&(c=this.graph.snap(c),d=this.graph.snap(d)),this.graph.panGraph(c+this.dx0,d+this.dy0));this.fireEvent(new mxEventObject(mxEvent.PAN,"event",b))}else this.panningTrigger&&(e=this.active,this.active=Math.abs(c)>this.graph.tolerance||Math.abs(d)>this.graph.tolerance,!e&&this.active&&this.fireEvent(new mxEventObject(mxEvent.PAN_START,
"event",b)));(this.active||this.panningTrigger)&&b.consume()};
mxPanningHandler.prototype.mouseUp=function(a,b){var c=Math.abs(b.getX()-this.startX),d=Math.abs(b.getY()-this.startY);if(this.active){if(!this.graph.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.graph.container)){c=b.getX()-this.startX;d=b.getY()-this.startY;this.useGrid&&(c=this.graph.snap(c),d=this.graph.snap(d));var e=this.graph.getView().scale,f=this.graph.getView().translate;this.graph.panGraph(0,0);var g=b.getEvent().scale;null!=g&&1!=g?this.scaleGraph(g,!1):this.panGraph(f.x+c/e,f.y+
d/e)}this.active=!1;this.fireEvent(new mxEventObject(mxEvent.PAN_END,"event",b));b.consume()}this.panningTrigger=!1};mxPanningHandler.prototype.scaleGraph=function(a,b){b?this.graph.view.getCanvas().setAttribute("transform","scale("+a+")"):(this.graph.view.getCanvas().removeAttribute("transform"),this.graph.view.setScale(this.graph.view.scale*a))};mxPanningHandler.prototype.panGraph=function(a,b){this.graph.getView().setTranslate(a,b)};
mxPanningHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(mxEvent.FIRE_MOUSE_EVENT,this.forcePanningHandler)};function mxPopupMenuHandler(a,b){null!=a&&(this.graph=a,this.factoryMethod=b,this.graph.addMouseListener(this),this.init())}mxPopupMenuHandler.prototype=new mxPopupMenu;mxPopupMenuHandler.prototype.constructor=mxPanningHandler;mxPopupMenuHandler.prototype.graph=null;mxPopupMenuHandler.prototype.selectOnPopup=!0;
mxPopupMenuHandler.prototype.clearSelectionOnBackground=!0;mxPopupMenuHandler.prototype.triggerX=null;mxPopupMenuHandler.prototype.triggerY=null;mxPopupMenuHandler.prototype.init=function(){mxPopupMenu.prototype.init.apply(this);mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(){this.graph.tooltipHandler.hide()}))};mxPopupMenuHandler.prototype.isSelectOnPopup=function(){return this.selectOnPopup};
mxPopupMenuHandler.prototype.mouseDown=function(a,b){this.isEnabled()&&(this.hideMenu(),this.triggerX=b.getGraphX(),this.triggerY=b.getGraphY(),this.popupTrigger=this.isPopupTrigger(b),this.inTolerance=!0)};mxPopupMenuHandler.prototype.mouseMove=function(a,b){if(this.inTolerance&&null!=this.triggerX&&null!=this.triggerY&&(Math.abs(b.getGraphX()-this.triggerX)>this.graph.tolerance||Math.abs(b.getGraphY()-this.triggerY)>this.graph.tolerance))this.inTolerance=!1};
mxPopupMenuHandler.prototype.mouseUp=function(a,b){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){var c=this.getCellForPopupEvent(b);this.graph.isEnabled()&&this.isSelectOnPopup(b)&&null!=c&&!this.graph.isCellSelected(c)?this.graph.setSelectionCell(c):this.clearSelectionOnBackground&&null==c&&this.graph.clearSelection();this.graph.tooltipHandler.hide();var d=mxUtils.getScrollOrigin();this.popup(b.getX()+d.x+1,b.getY()+d.y+1,c,b.getEvent());b.consume()}this.inTolerance=
this.popupTrigger=!1};mxPopupMenuHandler.prototype.getCellForPopupEvent=function(a){return a.getCell()};mxPopupMenuHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxPopupMenu.prototype.destroy.apply(this)};
function mxCellMarker(a,b,c,d){mxEventSource.call(this);null!=a&&(this.graph=a,this.validColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.invalidColor=null!=b?c:mxConstants.DEFAULT_INVALID_COLOR,this.hotspot=null!=d?d:mxConstants.DEFAULT_HOTSPOT,this.highlight=new mxCellHighlight(a))}mxUtils.extend(mxCellMarker,mxEventSource);mxCellMarker.prototype.graph=null;mxCellMarker.prototype.enabled=!0;mxCellMarker.prototype.hotspot=mxConstants.DEFAULT_HOTSPOT;mxCellMarker.prototype.hotspotEnabled=!1;
mxCellMarker.prototype.validColor=null;mxCellMarker.prototype.invalidColor=null;mxCellMarker.prototype.currentColor=null;mxCellMarker.prototype.validState=null;mxCellMarker.prototype.markedState=null;mxCellMarker.prototype.setEnabled=function(a){this.enabled=a};mxCellMarker.prototype.isEnabled=function(){return this.enabled};mxCellMarker.prototype.setHotspot=function(a){this.hotspot=a};mxCellMarker.prototype.getHotspot=function(){return this.hotspot};
mxCellMarker.prototype.setHotspotEnabled=function(a){this.hotspotEnabled=a};mxCellMarker.prototype.isHotspotEnabled=function(){return this.hotspotEnabled};mxCellMarker.prototype.hasValidState=function(){return null!=this.validState};mxCellMarker.prototype.getValidState=function(){return this.validState};mxCellMarker.prototype.getMarkedState=function(){return this.markedState};mxCellMarker.prototype.reset=function(){this.validState=null;null!=this.markedState&&(this.markedState=null,this.unmark())};
mxCellMarker.prototype.process=function(a){var b=null;if(this.isEnabled()){var b=this.getState(a),c=null!=b?this.isValidState(b):!1,a=this.getMarkerColor(a.getEvent(),b,c);this.validState=c?b:null;if(b!=this.markedState||a!=this.currentColor)this.currentColor=a,null!=b&&null!=this.currentColor?(this.markedState=b,this.mark()):null!=this.markedState&&(this.markedState=null,this.unmark())}return b};
mxCellMarker.prototype.markCell=function(a,b){var c=this.graph.getView().getState(a);null!=c&&(this.currentColor=null!=b?b:this.validColor,this.markedState=c,this.mark())};mxCellMarker.prototype.mark=function(){this.highlight.setHighlightColor(this.currentColor);this.highlight.highlight(this.markedState);this.fireEvent(new mxEventObject(mxEvent.MARK,"state",this.markedState))};mxCellMarker.prototype.unmark=function(){this.mark()};mxCellMarker.prototype.isValidState=function(){return!0};
mxCellMarker.prototype.getMarkerColor=function(a,b,c){return c?this.validColor:this.invalidColor};mxCellMarker.prototype.getState=function(a){var b=this.graph.getView();cell=this.getCell(a);b=this.getStateToMark(b.getState(cell));return null!=b&&this.intersects(b,a)?b:null};mxCellMarker.prototype.getCell=function(a){return a.getCell()};mxCellMarker.prototype.getStateToMark=function(a){return a};
mxCellMarker.prototype.intersects=function(a,b){return this.hotspotEnabled?mxUtils.intersectsHotspot(a,b.getGraphX(),b.getGraphY(),this.hotspot,mxConstants.MIN_HOTSPOT_SIZE,mxConstants.MAX_HOTSPOT_SIZE):!0};mxCellMarker.prototype.destroy=function(){this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);this.highlight.destroy()};
function mxSelectionCellsHandler(a){mxEventSource.call(this);this.graph=a;this.handlers=new mxDictionary;this.graph.addMouseListener(this);this.refreshHandler=mxUtils.bind(this,function(){this.isEnabled()&&this.refresh()});this.graph.getSelectionModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getModel().addListener(mxEvent.CHANGE,this.refreshHandler);this.graph.getView().addListener(mxEvent.SCALE,this.refreshHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.refreshHandler);
this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.refreshHandler);this.graph.getView().addListener(mxEvent.DOWN,this.refreshHandler);this.graph.getView().addListener(mxEvent.UP,this.refreshHandler)}mxUtils.extend(mxSelectionCellsHandler,mxEventSource);mxSelectionCellsHandler.prototype.graph=null;mxSelectionCellsHandler.prototype.enabled=!0;mxSelectionCellsHandler.prototype.refreshHandler=null;mxSelectionCellsHandler.prototype.maxHandlers=100;
mxSelectionCellsHandler.prototype.handlers=null;mxSelectionCellsHandler.prototype.isEnabled=function(){return this.enabled};mxSelectionCellsHandler.prototype.setEnabled=function(a){this.enabled=a};mxSelectionCellsHandler.prototype.getHandler=function(a){return this.handlers.get(a)};mxSelectionCellsHandler.prototype.reset=function(){this.handlers.visit(function(a,b){b.reset.apply(b)})};
mxSelectionCellsHandler.prototype.refresh=function(){var a=this.handlers;this.handlers=new mxDictionary;for(var b=this.graph.getSelectionCells(),c=0;c<b.length;c++){var d=this.graph.view.getState(b[c]);if(null!=d){var e=a.remove(b[c]);null!=e&&(e.state!=d?(e.destroy(),e=null):e.redraw());null==e&&(e=this.graph.createHandler(d),this.fireEvent(new mxEventObject(mxEvent.ADD,"state",d)));null!=e&&this.handlers.put(b[c],e)}}a.visit(mxUtils.bind(this,function(a,b){this.fireEvent(new mxEventObject(mxEvent.REMOVE,
"state",b.state));b.destroy()}))};mxSelectionCellsHandler.prototype.mouseDown=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseDown.apply(b,c)})}};mxSelectionCellsHandler.prototype.mouseMove=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseMove.apply(b,c)})}};
mxSelectionCellsHandler.prototype.mouseUp=function(a,b){if(this.graph.isEnabled()&&this.isEnabled()){var c=[a,b];this.handlers.visit(function(a,b){b.mouseUp.apply(b,c)})}};mxSelectionCellsHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.refreshHandler&&(this.graph.getSelectionModel().removeListener(this.refreshHandler),this.graph.getModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler),this.refreshHandler=null)};
function mxConnectionHandler(a,b){mxEventSource.call(this);null!=a&&(this.graph=a,this.factoryMethod=b,this.init())}mxUtils.extend(mxConnectionHandler,mxEventSource);mxConnectionHandler.prototype.graph=null;mxConnectionHandler.prototype.factoryMethod=!0;mxConnectionHandler.prototype.moveIconFront=!1;mxConnectionHandler.prototype.moveIconBack=!1;mxConnectionHandler.prototype.connectImage=null;mxConnectionHandler.prototype.targetConnectImage=!1;mxConnectionHandler.prototype.enabled=!0;
mxConnectionHandler.prototype.select=!0;mxConnectionHandler.prototype.createTarget=!1;mxConnectionHandler.prototype.marker=null;mxConnectionHandler.prototype.constraintHandler=null;mxConnectionHandler.prototype.error=null;mxConnectionHandler.prototype.waypointsEnabled=!1;mxConnectionHandler.prototype.ignoreMouseDown=!1;mxConnectionHandler.prototype.first=null;mxConnectionHandler.prototype.connectIconOffset=new mxPoint(0,mxConstants.TOOLTIP_VERTICAL_OFFSET);
mxConnectionHandler.prototype.edgeState=null;mxConnectionHandler.prototype.changeHandler=null;mxConnectionHandler.prototype.drillHandler=null;mxConnectionHandler.prototype.mouseDownCounter=0;mxConnectionHandler.prototype.movePreviewAway=mxClient.IS_VML;mxConnectionHandler.prototype.isEnabled=function(){return this.enabled};mxConnectionHandler.prototype.setEnabled=function(a){this.enabled=a};mxConnectionHandler.prototype.isCreateTarget=function(){return this.createTarget};
mxConnectionHandler.prototype.setCreateTarget=function(a){this.createTarget=a};mxConnectionHandler.prototype.createShape=function(){var a=new mxPolyline([],mxConstants.INVALID_COLOR);a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.pointerEvents=!1;a.isDashed=!0;a.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(a.node,this.graph,null);return a};
mxConnectionHandler.prototype.init=function(){this.graph.addMouseListener(this);this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.changeHandler=mxUtils.bind(this,function(){null!=this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell));null!=this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.reset()});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE,
this.changeHandler);this.graph.getView().addListener(mxEvent.TRANSLATE,this.changeHandler);this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.changeHandler);this.drillHandler=mxUtils.bind(this,function(){this.reset()});this.graph.addListener(mxEvent.START_EDITING,this.drillHandler);this.graph.getView().addListener(mxEvent.DOWN,this.drillHandler);this.graph.getView().addListener(mxEvent.UP,this.drillHandler)};mxConnectionHandler.prototype.isConnectableCell=function(){return!0};
mxConnectionHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph);a.hotspotEnabled=!0;a.getCell=mxUtils.bind(this,function(b,c){var c=mxCellMarker.prototype.getCell.apply(a,arguments),d=this.graph.view.scale,d=new mxPoint(this.graph.snap(b.getGraphX()/d)*d,this.graph.snap(b.getGraphY()/d)*d);this.error=null;null==c&&(c=this.graph.getCellAt(d.x,d.y));if(this.graph.isSwimlane(c)&&this.graph.hitsSwimlaneContent(c,d.x,d.y)||!this.isConnectableCell(c))c=null;null!=c?this.isConnecting()?
null!=this.previous&&(this.error=this.validateConnection(this.previous.cell,c),null!=this.error&&0==this.error.length&&(c=null,this.isCreateTarget()&&(this.error=null))):this.isValidSource(c)||(c=null):this.isConnecting()&&!this.isCreateTarget()&&!this.graph.allowDanglingEdges&&(this.error="");return c});a.isValidState=mxUtils.bind(this,function(b){return this.isConnecting()?null==this.error:mxCellMarker.prototype.isValidState.apply(a,arguments)});a.getMarkerColor=mxUtils.bind(this,function(b,c,d){return null==
this.connectImage||this.isConnecting()?mxCellMarker.prototype.getMarkerColor.apply(a,arguments):null});a.intersects=mxUtils.bind(this,function(b,c){return null!=this.connectImage||this.isConnecting()?!0:mxCellMarker.prototype.intersects.apply(a,arguments)});return a};
mxConnectionHandler.prototype.start=function(a,b,c,d){this.previous=a;this.first=new mxPoint(b,c);this.edgeState=null!=d?d:this.createEdgeState(null);this.marker.currentColor=this.marker.validColor;this.marker.markedState=a;this.marker.mark();this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous))};mxConnectionHandler.prototype.isConnecting=function(){return null!=this.first&&null!=this.shape};mxConnectionHandler.prototype.isValidSource=function(a){return this.graph.isValidSource(a)};
mxConnectionHandler.prototype.isValidTarget=function(){return!0};mxConnectionHandler.prototype.validateConnection=function(a,b){return!this.isValidTarget(b)?"":this.graph.getEdgeValidationError(null,a,b)};mxConnectionHandler.prototype.getConnectImage=function(){return this.connectImage};mxConnectionHandler.prototype.isMoveIconToFrontForState=function(a){return null!=a.text&&a.text.node.parentNode==this.graph.container?!0:this.moveIconFront};
mxConnectionHandler.prototype.createIcons=function(a){var b=this.getConnectImage(a);if(null!=b&&null!=a){this.iconState=a;var c=[],d=new mxRectangle(0,0,b.width,b.height),e=new mxImageShape(d,b.src,null,null,0);e.preserveImageAspect=!1;this.isMoveIconToFrontForState(a)?(e.dialect=mxConstants.DIALECT_STRICTHTML,e.init(this.graph.container)):(e.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,e.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&
null!=e.node.previousSibling&&e.node.parentNode.insertBefore(e.node,e.node.parentNode.firstChild));e.node.style.cursor=mxConstants.CURSOR_CONNECT;var f=mxUtils.bind(this,function(){return null!=this.currentState?this.currentState:a}),b=mxUtils.bind(this,function(a){mxEvent.isConsumed(a)||(this.icon=e,this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(a,f())))});mxEvent.redirectMouseEvents(e.node,this.graph,f,b);c.push(e);this.redrawIcons(c,this.iconState);return c}return null};
mxConnectionHandler.prototype.redrawIcons=function(a,b){if(null!=a&&null!=a[0]&&null!=b){var c=this.getIconPosition(a[0],b);a[0].bounds.x=c.x;a[0].bounds.y=c.y;a[0].redraw()}};
mxConnectionHandler.prototype.getIconPosition=function(a,b){var c=this.graph.getView().scale,d=b.getCenterX(),e=b.getCenterY();if(this.graph.isSwimlane(b.cell)){var f=this.graph.getStartSize(b.cell),d=0!=f.width?b.x+f.width*c/2:d,e=0!=f.height?b.y+f.height*c/2:e,f=mxUtils.toRadians(mxUtils.getValue(b.style,mxConstants.STYLE_ROTATION)||0);if(0!=f)var c=Math.cos(f),f=Math.sin(f),g=new mxPoint(b.getCenterX(),b.getCenterY()),e=mxUtils.getRotatedPoint(new mxPoint(d,e),c,f,g),d=e.x,e=e.y}return new mxPoint(d-
a.bounds.width/2,e-a.bounds.height/2)};mxConnectionHandler.prototype.destroyIcons=function(){if(null!=this.icons){for(var a=0;a<this.icons.length;a++)this.icons[a].destroy();this.iconState=this.selectedIcon=this.icon=this.icons=null}};mxConnectionHandler.prototype.isStartEvent=function(){return null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint||null!=this.previous&&null==this.error&&(null==this.icons||null!=this.icons&&null!=this.icon)};
mxConnectionHandler.prototype.mouseDown=function(a,b){this.mouseDownCounter++;this.isEnabled()&&this.graph.isEnabled()&&!b.isConsumed()&&!this.isConnecting()&&this.isStartEvent(b)&&(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new mxPoint(b.getGraphX(),
b.getGraphY()),this.edgeState=this.createEdgeState(b),this.mouseDownCounter=1,this.waypointsEnabled&&null==this.shape&&(this.waypoints=null,this.shape=this.createShape()),null==this.previous&&null!=this.edgeState&&this.edgeState.cell.geometry.setTerminalPoint(this.graph.getPointForEvent(b.getEvent()),!0),this.fireEvent(new mxEventObject(mxEvent.START,"state",this.previous)),b.consume());this.selectedIcon=this.icon;this.icon=null};mxConnectionHandler.prototype.isImmediateConnectSource=function(a){return!this.graph.isCellMovable(a.cell)};
mxConnectionHandler.prototype.createEdgeState=function(){return null};mxConnectionHandler.prototype.updateCurrentState=function(a){var b=this.marker.process(a);this.constraintHandler.update(a,null==this.first);this.currentState=b};mxConnectionHandler.prototype.convertWaypoint=function(a){var b=this.graph.getView().getScale(),c=this.graph.getView().getTranslate();a.x=a.x/b-c.x;a.y=a.y/b-c.y};
mxConnectionHandler.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&(this.ignoreMouseDown||null!=this.first||!this.graph.isMouseDown)){!this.isEnabled()&&null!=this.currentState&&(this.destroyIcons(),this.currentState=null);(null!=this.first||this.isEnabled()&&this.graph.isEnabled())&&this.updateCurrentState(b);if(null!=this.first){var c=this.graph.getView().scale,c=new mxPoint(this.graph.snap(b.getGraphX()/c)*c,this.graph.snap(b.getGraphY()/c)*c),d=null,e=c;null!=this.constraintHandler.currentConstraint&&
null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint&&(d=this.constraintHandler.currentConstraint,e=this.constraintHandler.currentPoint.clone());var f=this.first;if(null!=this.selectedIcon){var g=this.selectedIcon.bounds.width,h=this.selectedIcon.bounds.height;null!=this.currentState&&this.targetConnectImage?(g=this.getIconPosition(this.selectedIcon,this.currentState),this.selectedIcon.bounds.x=g.x,this.selectedIcon.bounds.y=g.y):(g=new mxRectangle(b.getGraphX()+this.connectIconOffset.x,
b.getGraphY()+this.connectIconOffset.y,g,h),this.selectedIcon.bounds=g);this.selectedIcon.redraw()}if(null!=this.edgeState){this.edgeState.absolutePoints=[null,null!=this.currentState?null:e];this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint);null!=this.currentState&&(null==d&&(d=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,
!1,d));f=null;if(null!=this.waypoints){f=[];for(e=0;e<this.waypoints.length;e++)d=this.waypoints[e].clone(),this.convertWaypoint(d),f[e]=d}this.graph.view.updatePoints(this.edgeState,f,this.previous,this.currentState);this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState);e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1];f=this.edgeState.absolutePoints[0]}else null!=this.currentState&&null==this.constraintHandler.currentConstraint&&(g=this.getTargetPerimeterPoint(this.currentState,
b),null!=g&&(e=g)),null==this.sourceConstraint&&null!=this.previous&&(g=this.getSourcePerimeterPoint(this.previous,null!=this.waypoints&&0<this.waypoints.length?this.waypoints[0]:e,b),null!=g&&(f=g));if(null==this.currentState&&this.movePreviewAway){g=f;null!=this.edgeState&&2<this.edgeState.absolutePoints.length&&(d=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2],null!=d&&(g=d));d=e.x-g.x;g=e.y-g.y;h=Math.sqrt(d*d+g*g);if(0==h)return;e.x-=4*d/h;e.y-=4*g/h}if(null==this.shape&&
(d=Math.abs(c.x-this.first.x),g=Math.abs(c.y-this.first.y),d>this.graph.tolerance||g>this.graph.tolerance))this.shape=this.createShape(),this.updateCurrentState(b);null!=this.shape&&(null!=this.edgeState?this.shape.points=this.edgeState.absolutePoints:(c=[f],null!=this.waypoints&&(c=c.concat(this.waypoints)),c.push(e),this.shape.points=c),this.drawPreview());mxEvent.consume(b.getEvent());b.consume()}else!this.isEnabled()||!this.graph.isEnabled()?this.constraintHandler.reset():this.previous!=this.currentState&&
null==this.edgeState?(this.destroyIcons(),null!=this.currentState&&null==this.error&&(this.icons=this.createIcons(this.currentState),null==this.icons&&(this.currentState.setCursor(mxConstants.CURSOR_CONNECT),b.consume())),this.previous=this.currentState):this.previous==this.currentState&&null!=this.currentState&&null==this.icons&&!this.graph.isMouseDown&&b.consume();null!=this.constraintHandler.currentConstraint&&this.marker.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){c=
!1;f=b.getSource();for(e=0;e<this.icons.length&&!c;e++)c=f==this.icons[e].node||f.parentNode==this.icons[e].node;c||this.updateIcons(this.currentState,this.icons,b)}}else this.constraintHandler.reset()};
mxConnectionHandler.prototype.getTargetPerimeterPoint=function(a){var b=null,c=a.view,d=c.getPerimeterFunction(a);if(null!=d){var e=null!=this.waypoints&&0<this.waypoints.length?this.waypoints[this.waypoints.length-1]:new mxPoint(this.previous.getCenterX(),this.previous.getCenterY()),c=d(c.getPerimeterBounds(a),this.edgeState,e,!1);null!=c&&(b=c)}else b=new mxPoint(a.getCenterX(),a.getCenterY());return b};
mxConnectionHandler.prototype.getSourcePerimeterPoint=function(a,b,c){var c=null,d=a.view,e=d.getPerimeterFunction(a),f=new mxPoint(a.getCenterX(),a.getCenterY());if(null!=e){var g=mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION,0),h=-g*(Math.PI/180);0!=g&&(b=mxUtils.getRotatedPoint(new mxPoint(b.x,b.y),Math.cos(h),Math.sin(h),f));a=e(d.getPerimeterBounds(a),a,b,!1);null!=a&&(0!=g&&(a=mxUtils.getRotatedPoint(new mxPoint(a.x,a.y),Math.cos(-h),Math.sin(-h),f)),c=a)}else c=f;return c};
mxConnectionHandler.prototype.updateIcons=function(){};mxConnectionHandler.prototype.isStopEvent=function(a){return null!=a.getState()};
mxConnectionHandler.prototype.addWaypointForEvent=function(a){var b=mxUtils.convertPoint(this.graph.container,a.getX(),a.getY()),c=Math.abs(b.x-this.first.x),b=Math.abs(b.y-this.first.y);if(null!=this.waypoints||1<this.mouseDownCounter&&(c>this.graph.tolerance||b>this.graph.tolerance))null==this.waypoints&&(this.waypoints=[]),c=this.graph.view.scale,b=new mxPoint(this.graph.snap(a.getGraphX()/c)*c,this.graph.snap(a.getGraphY()/c)*c),this.waypoints.push(b)};
mxConnectionHandler.prototype.mouseUp=function(a,b){if(!b.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(b)){this.addWaypointForEvent(b);b.consume();return}if(null==this.error){var c=null!=this.previous?this.previous.cell:null,d=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(d=this.constraintHandler.currentFocus.cell);null==d&&this.marker.hasValidState()&&(d=this.marker.validState.cell);this.connect(c,d,b.getEvent(),
b.getCell())}else null!=this.previous&&null!=this.marker.validState&&this.previous.cell==this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.source,evt),0<this.error.length&&this.graph.validationAlert(this.error);this.destroyIcons();b.consume()}null!=this.first&&this.reset()};
mxConnectionHandler.prototype.reset=function(){null!=this.shape&&(this.shape.destroy(),this.shape=null);this.destroyIcons();this.marker.reset();this.constraintHandler.reset();this.sourceConstraint=this.error=this.previous=this.edgeState=null;this.mouseDownCounter=0;this.first=null;this.fireEvent(new mxEventObject(mxEvent.RESET))};mxConnectionHandler.prototype.drawPreview=function(){var a=null==this.error;this.shape.strokewidth=this.getEdgeWidth(a);a=this.getEdgeColor(a);this.shape.stroke=a;this.shape.redraw()};
mxConnectionHandler.prototype.getEdgeColor=function(a){return a?mxConstants.VALID_COLOR:mxConstants.INVALID_COLOR};mxConnectionHandler.prototype.getEdgeWidth=function(a){return a?3:1};
mxConnectionHandler.prototype.connect=function(a,b,c,d){if(null!=b||this.isCreateTarget()||this.graph.allowDanglingEdges){var e=this.graph.getModel(),f=null;e.beginUpdate();try{if(null!=a&&null==b&&this.isCreateTarget()&&(b=this.createTargetVertex(c,a),null!=b)){d=this.graph.getDropTarget([b],c,d);if(null==d||!this.graph.getModel().isEdge(d)){var g=this.graph.getView().getState(d);if(null!=g){var h=e.getGeometry(b);h.x-=g.origin.x;h.y-=g.origin.y}}else d=this.graph.getDefaultParent();this.graph.addCell(b,
d)}var k=this.graph.getDefaultParent();null!=a&&null!=b&&e.getParent(a)==e.getParent(b)&&e.getParent(e.getParent(a))!=e.getRoot()&&(k=e.getParent(a),null!=a.geometry&&a.geometry.relative&&null!=b.geometry&&b.geometry.relative&&(k=e.getParent(k)));h=g=null;null!=this.edgeState&&(g=this.edgeState.cell.value,h=this.edgeState.cell.style);f=this.insertEdge(k,null,g,a,b,h);if(null!=f){this.graph.setConnectionConstraint(f,a,!0,this.sourceConstraint);this.graph.setConnectionConstraint(f,b,!1,this.constraintHandler.currentConstraint);
null!=this.edgeState&&e.setGeometry(f,this.edgeState.cell.geometry);var l=e.getGeometry(f);null==l&&(l=new mxGeometry,l.relative=!0,e.setGeometry(f,l));if(null!=this.waypoints&&0<this.waypoints.length){var m=this.graph.view.scale,n=this.graph.view.translate;l.points=[];for(a=0;a<this.waypoints.length;a++){var o=this.waypoints[a];l.points.push(new mxPoint(o.x/m-n.x,o.y/m-n.y))}}null==b&&(o=this.graph.getPointForEvent(c,!1),o.x-=this.graph.panDx/this.graph.view.scale,o.y-=this.graph.panDy/this.graph.view.scale,
l.setTerminalPoint(o,!1));this.fireEvent(new mxEventObject(mxEvent.CONNECT,"cell",f,"event",c,"target",d))}}catch(q){mxLog.show(),mxLog.debug(q.message)}finally{e.endUpdate()}this.select&&this.selectCells(f,b)}};mxConnectionHandler.prototype.selectCells=function(a){this.graph.setSelectionCell(a)};mxConnectionHandler.prototype.insertEdge=function(a,b,c,d,e,f){if(null==this.factoryMethod)return this.graph.insertEdge(a,b,c,d,e,f);b=this.createEdge(c,d,e,f);return this.graph.addEdge(b,a,d,e)};
mxConnectionHandler.prototype.createTargetVertex=function(a,b){for(var c=this.graph.getCellGeometry(b);null!=c&&c.relative;)b=this.graph.getModel().getParent(b),c=this.graph.getCellGeometry(b);var d=this.graph.cloneCells([b])[0],c=this.graph.getModel().getGeometry(d);if(null!=c){var e=this.graph.getPointForEvent(a);c.x=this.graph.snap(e.x-c.width/2)-this.graph.panDx/this.graph.view.scale;c.y=this.graph.snap(e.y-c.height/2)-this.graph.panDy/this.graph.view.scale;if(null!=this.first){var f=this.graph.view.getState(b);
if(null!=f){var g=this.getAlignmentTolerance();Math.abs(this.graph.snap(this.first.x)-this.graph.snap(e.x))<=g?c.x=f.x:Math.abs(this.graph.snap(this.first.y)-this.graph.snap(e.y))<=g&&(c.y=f.y)}}}return d};mxConnectionHandler.prototype.getAlignmentTolerance=function(){return this.graph.isGridEnabled()?this.graph.gridSize:this.graph.tolerance};
mxConnectionHandler.prototype.createEdge=function(a,b,c,d){var e=null;null!=this.factoryMethod&&(e=this.factoryMethod(b,c,d));null==e&&(e=new mxCell(a||""),e.setEdge(!0),e.setStyle(d),a=new mxGeometry,a.relative=!0,e.setGeometry(a));return e};
mxConnectionHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);null!=this.changeHandler&&(this.graph.getModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler),this.changeHandler=null);null!=this.drillHandler&&(this.graph.removeListener(this.drillHandler),
this.graph.getView().removeListener(this.drillHandler),this.drillHandler=null)};function mxConstraintHandler(a){this.graph=a}mxConstraintHandler.prototype.pointImage=new mxImage(mxClient.imageBasePath+"/point.gif",5,5);mxConstraintHandler.prototype.graph=null;mxConstraintHandler.prototype.enabled=!0;mxConstraintHandler.prototype.highlightColor=mxConstants.DEFAULT_VALID_COLOR;mxConstraintHandler.prototype.isEnabled=function(){return this.enabled};
mxConstraintHandler.prototype.setEnabled=function(a){this.enabled=a};mxConstraintHandler.prototype.reset=function(){if(null!=this.focusIcons){for(var a=0;a<this.focusIcons.length;a++)this.focusIcons[a].destroy();this.focusIcons=null}null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null);this.focusPoints=this.currentFocus=this.currentPoint=this.currentFocusArea=this.currentConstraint=null};mxConstraintHandler.prototype.getTolerance=function(){return this.graph.getTolerance()};
mxConstraintHandler.prototype.getImageForConstraint=function(){return this.pointImage};mxConstraintHandler.prototype.isEventIgnored=function(){return!1};mxConstraintHandler.prototype.isStateIgnored=function(){return!1};mxConstraintHandler.prototype.destroyIcons=function(){if(null!=this.focusIcons){for(var a=0;a<this.focusIcons.length;a++)this.focusIcons[a].destroy();this.focusPoints=this.focusIcons=null}};
mxConstraintHandler.prototype.destroyFocusHighlight=function(){null!=this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)};
mxConstraintHandler.prototype.update=function(a,b){if(this.isEnabled()&&!this.isEventIgnored(a)){var c=this.getTolerance(),d=new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c),e=null!=a.getCell()?this.graph.isCellConnectable(a.getCell()):!1;if(null==this.currentFocusArea||!mxUtils.intersects(this.currentFocusArea,d)||null!=a.getState()&&null!=this.currentFocus&&e)if(this.currentFocusArea=null,a.getState()!=this.currentFocus)if(this.currentFocus=null,this.constraints=null!=a.getState()&&e&&!this.isStateIgnored(a.getState(),
b)?this.graph.getAllConnectionConstraints(a.getState(),b):null,null!=this.constraints){this.currentFocus=a.getState();this.currentFocusArea=new mxRectangle(a.getState().x,a.getState().y,a.getState().width,a.getState().height);if(null!=this.focusIcons){for(e=0;e<this.focusIcons.length;e++)this.focusIcons[e].destroy();this.focusPoints=this.focusIcons=null}this.focusIcons=[];this.focusPoints=[];for(e=0;e<this.constraints.length;e++){var f=this.graph.getConnectionPoint(a.getState(),this.constraints[e]),
g=this.getImageForConstraint(a.getState(),this.constraints[e],f),h=g.src,g=new mxRectangle(f.x-g.width/2,f.y-g.height/2,g.width,g.height),g=new mxImageShape(g,h);g.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;g.preserveImageAspect=!1;g.init(this.graph.getView().getOverlayPane());null!=g.node.previousSibling&&g.node.parentNode.insertBefore(g.node,g.node.parentNode.firstChild);h=mxUtils.bind(this,function(){return null!=this.currentFocus?
this.currentFocus:a.getState()});g.redraw();mxEvent.redirectMouseEvents(g.node,this.graph,h);this.currentFocusArea.add(g.bounds);this.focusIcons.push(g);this.focusPoints.push(f)}this.currentFocusArea.grow(c)}else this.destroyIcons(),this.destroyFocusHighlight();this.currentPoint=this.currentConstraint=null;if(null!=this.focusIcons&&null!=this.constraints&&(null==a.getState()||this.currentFocus==a.getState()))for(e=0;e<this.focusIcons.length;e++)if(mxUtils.intersects(this.focusIcons[e].bounds,d)){this.currentConstraint=
this.constraints[e];this.currentPoint=this.focusPoints[e];c=this.focusIcons[e].bounds.clone();c.grow(mxClient.IS_IE?3:2);mxClient.IS_IE&&(c.width-=1,c.height-=1);null==this.focusHighlight?(c=new mxRectangleShape(c,null,this.highlightColor,3),c.dialect=this.graph.dialect==mxConstants.DIALECT_SVG?mxConstants.DIALECT_SVG:mxConstants.DIALECT_VML,c.init(this.graph.getView().getOverlayPane()),this.focusHighlight=c,h=mxUtils.bind(this,function(){return null!=this.currentFocus?this.currentFocus:a.getState()}),
mxEvent.redirectMouseEvents(c.node,this.graph,h)):(this.focusHighlight.bounds=c,this.focusHighlight.redraw());break}null==this.currentConstraint&&this.destroyFocusHighlight()}};mxConstraintHandler.prototype.destroy=function(){this.reset()};
function mxRubberband(a){null!=a&&(this.graph=a,this.graph.addMouseListener(this),this.forceRubberbandHandler=mxUtils.bind(this,function(a,c){var d=c.getProperty("eventName"),e=c.getProperty("event");if(d==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(e)){var d=mxUtils.getOffset(this.graph.container),f=mxUtils.getScrollOrigin(this.graph.container);f.x-=d.x;f.y-=d.y;this.start(e.getX()+f.x,e.getY()+f.y);e.consume(!1)}}),this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),
this.panHandler=mxUtils.bind(this,function(){this.repaint()}),this.graph.addListener(mxEvent.PAN,this.panHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=!0;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;mxRubberband.prototype.currentX=0;mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};
mxRubberband.prototype.setEnabled=function(a){this.enabled=a};mxRubberband.prototype.isForceRubberbandEvent=function(a){return mxEvent.isAltDown(a.getEvent())};mxRubberband.prototype.mouseDown=function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null==b.getState()){var c=mxUtils.getOffset(this.graph.container),d=mxUtils.getScrollOrigin(this.graph.container);d.x-=c.x;d.y-=c.y;this.start(b.getX()+d.x,b.getY()+d.y);b.consume(!1)}};
mxRubberband.prototype.start=function(a,b){function c(a){var a=new mxMouseEvent(a),b=mxUtils.convertPoint(d,a.getX(),a.getY());a.graphX=b.x;a.graphY=b.y;return a}this.first=new mxPoint(a,b);var d=this.graph.container;this.dragHandler=mxUtils.bind(this,function(a){this.mouseMove(this.graph,c(a))});this.dropHandler=mxUtils.bind(this,function(a){this.mouseUp(this.graph,c(a))});mxClient.IS_FF&&mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)};
mxRubberband.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&null!=this.first){var c=mxUtils.getScrollOrigin(this.graph.container),d=mxUtils.getOffset(this.graph.container);c.x-=d.x;c.y-=d.y;var d=b.getX()+c.x,c=b.getY()+c.y,e=this.first.x-d,f=this.first.y-c,g=this.graph.tolerance;if(null!=this.div||Math.abs(e)>g||Math.abs(f)>g)null==this.div&&(this.div=this.createShape()),mxUtils.clearSelection(),this.update(d,c),b.consume()}};
mxRubberband.prototype.createShape=function(){null==this.sharedDiv&&(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity));this.graph.container.appendChild(this.sharedDiv);return this.sharedDiv};mxRubberband.prototype.mouseUp=function(a,b){var c=null!=this.div;this.reset();c&&(c=new mxRectangle(this.x,this.y,this.width,this.height),this.graph.selectRegion(c,b.getEvent()),b.consume())};
mxRubberband.prototype.reset=function(){null!=this.div&&this.div.parentNode.removeChild(this.div);mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler);this.dropHandler=this.dragHandler=null;this.currentY=this.currentX=0;this.div=this.first=null};mxRubberband.prototype.update=function(a,b){this.currentX=a;this.currentY=b;this.repaint()};
mxRubberband.prototype.repaint=function(){if(null!=this.div){var a=this.currentX-this.graph.panDx,b=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,a);this.y=Math.min(this.first.y,b);this.width=Math.max(this.first.x,a)-this.x;this.height=Math.max(this.first.y,b)-this.y;a=mxClient.IS_VML?this.graph.panDy:0;this.div.style.left=this.x+(mxClient.IS_VML?this.graph.panDx:0)+"px";this.div.style.top=this.y+a+"px";this.div.style.width=Math.max(1,this.width)+"px";this.div.style.height=Math.max(1,
this.height)+"px"}};mxRubberband.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),null!=this.sharedDiv&&(this.sharedDiv=null))};function mxVertexHandler(a){null!=a&&(this.state=a,this.init())}mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=!1;
mxVertexHandler.prototype.index=null;mxVertexHandler.prototype.allowHandleBoundsCheck=!0;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;mxVertexHandler.prototype.rotationEnabled=!1;mxVertexHandler.prototype.rotationRaster=!0;mxVertexHandler.prototype.livePreview=!1;mxVertexHandler.prototype.manageSizers=!1;
mxVertexHandler.prototype.init=function(){this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.pointerEvents=!1;this.selectionBorder.init(this.graph.getView().getOverlayPane());
mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);this.graph.isCellMovable(this.state.cell)&&(this.selectionBorder.node.style.cursor=mxConstants.CURSOR_MOVABLE_VERTEX);if(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var a=this.graph.isCellResizable(this.state.cell);this.sizers=[];if(a||this.graph.isLabelMovable(this.state.cell)&&2<=this.state.width&&2<=this.state.height){var b=0;a&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",
b++)),this.sizers.push(this.createSizer("n-resize",b++)),this.sizers.push(this.createSizer("ne-resize",b++)),this.sizers.push(this.createSizer("w-resize",b++)),this.sizers.push(this.createSizer("e-resize",b++)),this.sizers.push(this.createSizer("sw-resize",b++)),this.sizers.push(this.createSizer("s-resize",b++))),this.sizers.push(this.createSizer("se-resize",b++)));a=this.graph.model.getGeometry(this.state.cell);null!=a&&!a.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)&&
(this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&2>this.state.width&&2>this.state.height&&(this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,null,null,mxConstants.LABEL_HANDLE_FILLCOLOR),this.sizers.push(this.labelShape))}if(this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&
(0>=mxGraphHandler.prototype.maxCells||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&2<this.state.width&&2<this.state.height)this.rotationShape=this.createSizer("pointer",mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR),this.sizers.push(this.rotationShape);this.redraw()};mxVertexHandler.prototype.getSelectionBounds=function(a){return new mxRectangle(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height))};
mxVertexHandler.prototype.createSelectionShape=function(a){a=new mxRectangleShape(a,null,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};
mxVertexHandler.prototype.createSizer=function(a,b,c,d){c=c||mxConstants.HANDLE_SIZE;c=new mxRectangle(0,0,c,c);d=this.createSizerShape(c,b,d);d.isHtmlAllowed()&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(d.bounds.height-=1,d.bounds.width-=1,d.dialect=mxConstants.DIALECT_STRICTHTML,d.init(this.graph.container)):(d.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,d.init(this.graph.getView().getOverlayPane()));
mxEvent.redirectMouseEvents(d.node,this.graph,this.state);this.graph.isEnabled()&&(d.node.style.cursor=a);this.isSizerVisible(b)||(d.node.style.visibility="hidden");return d};mxVertexHandler.prototype.isSizerVisible=function(){return!0};
mxVertexHandler.prototype.createSizerShape=function(a,b,c){return null!=this.handleImage?(a=new mxRectangle(a.x,a.y,this.handleImage.width,this.handleImage.height),a=new mxImageShape(a,this.handleImage.src),a.preserveImageAspect=!1,a):b==mxEvent.ROTATION_HANDLE?new mxEllipse(a,c||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR):new mxRectangleShape(a,c||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxVertexHandler.prototype.moveSizerTo=function(a,b,c){null!=a&&(a.bounds.x=Math.round(b-a.bounds.width/2),a.bounds.y=Math.round(c-a.bounds.height/2),a.redraw())};
mxVertexHandler.prototype.getHandleForEvent=function(a){function b(b){if(null!=b&&(a.isSource(b)||null!=d&&mxUtils.intersects(b.bounds,d)&&"none"!=b.node.style.display&&"hidden"!=b.node.style.visibility)){var c=a.getGraphX()-b.bounds.getCenterX(),b=a.getGraphY()-b.bounds.getCenterY(),c=c*c+b*b;if(null==e||c<=e)return e=c,!0}return!1}var c=!mxEvent.isMouseEvent(a.getEvent())?this.tolerance:1,d=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*
c):null,e=null,c=null;if(null!=this.sizers)for(var f=0;f<this.sizers.length;f++)b(this.sizers[f])&&(c=f);b(this.rotationShape)?c=mxEvent.ROTATION_HANDLE:b(this.labelShape)&&(c=mxEvent.LABEL_HANDLE);return c};mxVertexHandler.prototype.mouseDown=function(a,b){var c=!mxEvent.isMouseEvent(b.getEvent())?this.tolerance:0;if(!b.isConsumed()&&this.graph.isEnabled()&&(0<c||b.getState()==this.state))c=this.getHandleForEvent(b),null!=c&&(this.start(b.getGraphX(),b.getGraphY(),c),b.consume())};
mxVertexHandler.prototype.start=function(a,b,c){this.inTolerance=!0;this.index=c;this.startX=a;this.startY=b;this.selectionBorder.node.style.display=c==mxEvent.ROTATION_HANDLE?"inline":"none";if(this.livePreview){this.hideSizers();c==mxEvent.ROTATION_HANDLE?this.rotationShape.node.style.display="":null!=this.sizers[c]&&(this.sizers[c].node.style.display="");a=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(b=0;b<a.length;b++)c=this.graph.selectionCellsHandler.getHandler(a[b]),null!=
c&&this.edgeHandlers.push(c)}else this.preview=this.createSelectionShape(this.bounds),!(mxClient.IS_SVG&&0!=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"))&&null!=this.state.text&&this.state.text.node.parentNode==this.graph.container?(this.preview.dialect=mxConstants.DIALECT_STRICTHTML,this.preview.init(this.graph.container)):(this.preview.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG,this.preview.init(this.graph.view.getOverlayPane()))};
mxVertexHandler.prototype.hideSizers=function(){for(var a=0;a<this.sizers.length;a++)this.sizers[a].node.style.display="none"};mxVertexHandler.prototype.checkTolerance=function(a){if(this.inTolerance&&null!=this.startX&&null!=this.startY&&(mxEvent.isMouseEvent(a.getEvent())||Math.abs(a.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(a.getGraphY()-this.startY)>this.graph.tolerance))this.inTolerance=!1};
mxVertexHandler.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&null!=this.index){this.checkTolerance(b);if(!this.inTolerance){var c=new mxPoint(b.getGraphX(),b.getGraphY()),d=this.graph.isGridEnabledEvent(b.getEvent()),e=this.graph.getView().scale;if(this.index==mxEvent.LABEL_HANDLE)d&&(c.x=this.graph.snap(c.x/e)*e,c.y=this.graph.snap(c.y/e)*e),this.moveSizerTo(this.sizers[this.sizers.length-1],c.x,c.y);else if(this.index==mxEvent.ROTATION_HANDLE){var f=this.state.x+this.state.width/2-c.x,
g=this.state.y+this.state.height/2-c.y;this.currentAlpha=0!=f?180*Math.atan(g/f)/Math.PI+90:0>g?180:0;0<f&&(this.currentAlpha-=180);this.rotationRaster&&this.graph.isGridEnabledEvent(b.getEvent())&&(f=c.x-this.state.getCenterX(),g=c.y-this.state.getCenterY(),e=Math.abs(Math.sqrt(f*f+g*g)-this.state.height/2-20),e=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(e))))),this.currentAlpha=Math.round(this.currentAlpha/e)*e);this.selectionBorder.rotation=this.currentAlpha;this.selectionBorder.redraw();
this.livePreview&&this.redrawHandles()}else{var h=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),k=Math.cos(-h),l=Math.sin(-h),m=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),f=c.x-this.startX,g=c.y-this.startY,c=this.graph.view.translate,n=l*f+k*g;this.bounds=this.union(this.selectionBounds,k*f-l*g,n,this.index,d,e,c);k=Math.cos(h);l=Math.sin(h);g=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY());f=g.x-m.x;g=g.y-m.y;this.bounds.x+=k*f-l*g-f;this.bounds.y+=
l*f+k*g-g;this.livePreview?(f=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height),k=this.state.origin,this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new mxPoint(this.state.x/e-c.x,this.state.y/e-c.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height,this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.state.x=
f.x,this.state.y=f.y,this.state.width=f.width,this.state.height=f.height,this.state.origin=k):this.drawPreview()}}b.consume()}else!this.graph.isMouseDown&&null!=this.getHandleForEvent(b)&&b.consume(!1)};
mxVertexHandler.prototype.mouseUp=function(a,b){if(null!=this.index&&null!=this.state){var c=new mxPoint(b.getGraphX(),b.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index==mxEvent.ROTATION_HANDLE){if(null!=this.currentAlpha){var d=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);0!=d&&this.rotateCell(this.state.cell,d)}}else{var e=this.graph.isGridEnabledEvent(b.getEvent()),f=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),g=Math.cos(-f),h=
Math.sin(-f),k=c.x-this.startX,l=c.y-this.startY,c=h*k+g*l,k=g*k-h*l,l=c,m=this.graph.view.scale;this.resizeCell(this.state.cell,k/m,l/m,this.index,e)}}finally{this.graph.getModel().endUpdate()}b.consume();this.reset()}};
mxVertexHandler.prototype.rotateCell=function(a,b){var c=this.graph.getModel();if(c.isVertex(a)){var d=a==this.state?this.state:this.graph.view.getState(a);null!=d&&this.graph.setCellStyles(mxConstants.STYLE_ROTATION,(d.style[mxConstants.STYLE_ROTATION]||0)+b,[a]);if(this.state.cell!=a&&(d=this.graph.getCellGeometry(a),null!=d&&!d.relative&&0!=b)){var e=this.graph.getModel().getParent(a),f=this.graph.getCellGeometry(e);if(!d.relative&&null!=f){var g=mxUtils.toRadians(b),e=Math.cos(g),g=Math.sin(g),
h=new mxPoint(d.getCenterX(),d.getCenterY()),f=new mxPoint(f.width/2,f.height/2),e=mxUtils.getRotatedPoint(h,e,g,f),d=d.clone();d.x=e.x-d.width/2;d.y=e.y-d.height/2;c.setGeometry(a,d)}}d=c.getChildCount(a);for(e=0;e<d;e++)this.rotateCell(c.getChildAt(a,e),b)}};
mxVertexHandler.prototype.reset=function(){null!=this.sizers&&null!=this.index&&null!=this.sizers[this.index]&&"none"==this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display="");this.index=this.inTolerance=this.currentAlpha=null;null!=this.preview&&(this.preview.destroy(),this.preview=null);null!=this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new mxRectangle(this.selectionBounds.x,
this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview());if(this.livePreview&&null!=this.sizers)for(var a=0;a<this.sizers.length;a++)null!=this.sizers[a]&&(this.sizers[a].node.style.display="");this.redrawHandles();this.edgeHandlers=null};
mxVertexHandler.prototype.resizeCell=function(a,b,c,d,e){var f=this.graph.model.getGeometry(a);if(null!=f)if(d==mxEvent.LABEL_HANDLE)d=this.graph.view.scale,b=(this.labelShape.bounds.getCenterX()-this.startX)/d,c=(this.labelShape.bounds.getCenterY()-this.startY)/d,f=f.clone(),null==f.offset?f.offset=new mxPoint(b,c):(f.offset.x+=b,f.offset.y+=c),this.graph.model.setGeometry(a,f);else{var d=this.union(f,b,c,d,e,1,new mxPoint(0,0)),g=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0");
if(0!=g){var b=d.getCenterX()-f.getCenterX(),c=d.getCenterY()-f.getCenterY(),e=Math.cos(g),h=Math.sin(g),g=e*b-h*c-b,b=h*b+e*c-c,c=d.x-f.x,k=d.y-f.y,l=e*c-h*k,e=h*c+e*k;d.x+=g;d.y+=b;if(!this.graph.isCellCollapsed(a)&&(0!=g||0!=b))c=f.x-d.x+l,k=f.y-d.y+e,this.moveChildren(a,c,k)}this.graph.resizeCell(a,d)}};
mxVertexHandler.prototype.moveChildren=function(a,b,c){for(var d=this.graph.getModel(),e=d.getChildCount(a),f=0;f<e;f++){var g=d.getChildAt(a,f);if(d.isVertex(g)){var h=this.graph.getCellGeometry(g);null!=h&&!h.relative&&(h=h.clone(),h.x+=b,h.y+=c,d.setGeometry(g,h))}}};
mxVertexHandler.prototype.union=function(a,b,c,d,e,f,g){if(this.singleSizer){var g=a.x+a.width+b,h=a.y+a.height+c;e&&(g=this.graph.snap(g/f)*f,h=this.graph.snap(h/f)*f);f=new mxRectangle(a.x,a.y,0,0);f.add(new mxRectangle(g,h,0,0));return f}var h=a.x-g.x*f,k=h+a.width,l=a.y-g.y*f,a=l+a.height;4<d?(a+=c,e&&(a=this.graph.snap(a/f)*f)):3>d&&(l+=c,e&&(l=this.graph.snap(l/f)*f));if(0==d||3==d||5==d)h+=b,e&&(h=this.graph.snap(h/f)*f);else if(2==d||4==d||7==d)k+=b,e&&(k=this.graph.snap(k/f)*f);e=k-h;a-=
l;0>e&&(h+=e,e=Math.abs(e));0>a&&(l+=a,a=Math.abs(a));return new mxRectangle(h+g.x*f,l+g.y*f,e,a)};mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.state.x,this.state.y,this.state.width,this.state.height);this.redrawHandles();this.drawPreview()};
mxVertexHandler.prototype.redrawHandles=function(){var a=this.state;if(null!=this.sizers){if(null==this.index&&this.manageSizers&&1<this.sizers.length){var b=this.tolerance;a.width<2*this.sizers[0].bounds.width-2+2*b?(this.sizers[1].node.style.display="none",this.sizers[6].node.style.display="none"):(this.sizers[1].node.style.display="",this.sizers[6].node.style.display="");a.height<2*this.sizers[0].bounds.height-2+2*b?(this.sizers[3].node.style.display="none",this.sizers[4].node.style.display="none"):
(this.sizers[3].node.style.display="",this.sizers[4].node.style.display="");if(a.width<2*this.sizers[0].bounds.width-2+3*b||a.height<2*this.sizers[0].bounds.height-2+3*b)a=new mxRectangle(a.x,a.y,a.width,a.height),b/=2,a.x-=(this.sizers[0].bounds.width+b)/2,a.width+=this.sizers[0].bounds.width+b,a.y-=(this.sizers[0].bounds.height+b)/2,a.height+=this.sizers[0].bounds.height+b}var b=a.x+a.width,c=a.y+a.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],b,c);else{var d=a.x+a.width/2,e=a.y+a.height/
2;if(1<this.sizers.length){var f="nw-resize,n-resize,ne-resize,e-resize,se-resize,s-resize,sw-resize,w-resize".split(","),g=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0"),h=Math.cos(g),k=Math.sin(g),g=Math.round(4*g/Math.PI),l=new mxPoint(a.getCenterX(),a.getCenterY()),m=mxUtils.getRotatedPoint(new mxPoint(a.x,a.y),h,k,l);this.moveSizerTo(this.sizers[0],m.x,m.y);this.sizers[0].node.style.cursor=f[mxUtils.mod(0+g,f.length)];m.x=d;m.y=a.y;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[1],
m.x,m.y);this.sizers[1].node.style.cursor=f[mxUtils.mod(1+g,f.length)];m.x=b;m.y=a.y;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[2],m.x,m.y);this.sizers[2].node.style.cursor=f[mxUtils.mod(2+g,f.length)];m.x=a.x;m.y=e;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[3],m.x,m.y);this.sizers[3].node.style.cursor=f[mxUtils.mod(7+g,f.length)];m.x=b;m.y=e;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[4],m.x,m.y);this.sizers[4].node.style.cursor=f[mxUtils.mod(3+
g,f.length)];m.x=a.x;m.y=c;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[5],m.x,m.y);this.sizers[5].node.style.cursor=f[mxUtils.mod(6+g,f.length)];m.x=d;m.y=c;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[6],m.x,m.y);this.sizers[6].node.style.cursor=f[mxUtils.mod(5+g,f.length)];m.x=b;m.y=c;m=mxUtils.getRotatedPoint(m,h,k,l);this.moveSizerTo(this.sizers[7],m.x,m.y);this.sizers[7].node.style.cursor=f[mxUtils.mod(4+g,f.length)];this.moveSizerTo(this.sizers[8],d+this.state.absoluteOffset.x,
e+this.state.absoluteOffset.y)}else 2<=this.state.width&&2<=this.state.height?this.moveSizerTo(this.sizers[0],d+this.state.absoluteOffset.x,e+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],a.x,a.y)}}null!=this.rotationShape&&(g=mxUtils.toRadians(null!=this.currentAlpha?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0"),h=Math.cos(g),k=Math.sin(g),l=new mxPoint(this.state.getCenterX(),this.state.getCenterY()),m=mxUtils.getRotatedPoint(new mxPoint(a.x+a.width/2,a.y-16),
h,k,l),null!=this.rotationShape.node&&this.moveSizerTo(this.rotationShape,m.x,m.y));null!=this.selectionBorder&&(this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"));if(null!=this.edgeHandlers)for(a=0;a<this.edgeHandlers.length;a++)this.edgeHandlers[a].redraw()};
mxVertexHandler.prototype.drawPreview=function(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode==this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0"),this.preview.redraw());this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw()};
mxVertexHandler.prototype.destroy=function(){null!=this.preview&&(this.preview.destroy(),this.preview=null);this.selectionBorder.destroy();this.labelShape=this.selectionBorder=null;if(null!=this.sizers){for(var a=0;a<this.sizers.length;a++)this.sizers[a].destroy(),this.sizers[a]=null;this.sizers=null}};function mxEdgeHandler(a){null!=a&&(this.state=a,this.init())}mxEdgeHandler.prototype.graph=null;mxEdgeHandler.prototype.state=null;mxEdgeHandler.prototype.marker=null;
mxEdgeHandler.prototype.constraintHandler=null;mxEdgeHandler.prototype.error=null;mxEdgeHandler.prototype.shape=null;mxEdgeHandler.prototype.bends=null;mxEdgeHandler.prototype.labelShape=null;mxEdgeHandler.prototype.cloneEnabled=!0;mxEdgeHandler.prototype.addEnabled=!1;mxEdgeHandler.prototype.removeEnabled=!1;mxEdgeHandler.prototype.preferHtml=!1;mxEdgeHandler.prototype.allowHandleBoundsCheck=!0;mxEdgeHandler.prototype.snapToTerminals=!1;mxEdgeHandler.prototype.handleImage=null;
mxEdgeHandler.prototype.tolerance=0;
mxEdgeHandler.prototype.init=function(){this.graph=this.state.view.graph;this.marker=this.createMarker();this.constraintHandler=new mxConstraintHandler(this.graph);this.points=[];this.abspoints=this.getSelectionPoints(this.state);this.shape=this.createSelectionShape(this.abspoints);this.shape.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;this.shape.init(this.graph.getView().getOverlayPane());this.shape.pointerEvents=!1;this.shape.node.style.cursor=
mxConstants.CURSOR_MOVABLE_EDGE;mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode==this.graph.container;if(!this.preferHtml){var a=this.state.getVisibleTerminalState(!0);null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container);this.preferHtml||(a=this.state.getVisibleTerminalState(!1),null!=a&&(this.preferHtml=null!=a.text&&a.text.node.parentNode==this.graph.container))}if(this.graph.getSelectionCount()<
mxGraphHandler.prototype.maxCells||0>=mxGraphHandler.prototype.maxCells)this.bends=this.createBends();this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape=new mxRectangleShape(new mxRectangle,mxConstants.LABEL_HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR);this.initBend(this.labelShape);this.labelShape.node.style.cursor=mxConstants.CURSOR_LABEL_HANDLE;mxEvent.redirectMouseEvents(this.labelShape.node,this.graph,this.state);this.redraw()};
mxEdgeHandler.prototype.isAddPointEvent=function(a){return mxEvent.isShiftDown(a)};mxEdgeHandler.prototype.isRemovePointEvent=function(a){return mxEvent.isShiftDown(a)};mxEdgeHandler.prototype.getSelectionPoints=function(a){return a.absolutePoints};mxEdgeHandler.prototype.createSelectionShape=function(a){a=new mxPolyline(a,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};mxEdgeHandler.prototype.getSelectionColor=function(){return mxConstants.EDGE_SELECTION_COLOR};
mxEdgeHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.EDGE_SELECTION_STROKEWIDTH};mxEdgeHandler.prototype.isSelectionDashed=function(){return mxConstants.EDGE_SELECTION_DASHED};mxEdgeHandler.prototype.isConnectableCell=function(){return!0};
mxEdgeHandler.prototype.createMarker=function(){var a=new mxCellMarker(this.graph),b=this;a.getCell=function(a){var d=mxCellMarker.prototype.getCell.apply(this,arguments),e=b.getPointForEvent(a);if(d==b.state.cell||null==d)d=this.graph.getCellAt(e.x,e.y),b.state.cell==d&&(d=null);var f=b.graph.getModel();if(this.graph.isSwimlane(d)&&this.graph.hitsSwimlaneContent(d,e.x,e.y)||!b.isConnectableCell(d)||d==b.state.cell||null!=d&&!b.graph.connectableEdges&&f.isEdge(d)||f.isAncestor(b.state.cell,d))d=null;
return d};a.isValidState=function(a){var d=b.graph.getModel(),d=b.graph.view.getTerminalPort(a,b.graph.view.getState(d.getTerminal(b.state.cell,!b.isSource)),!b.isSource),d=null!=d?d.cell:null;b.error=b.validateConnection(b.isSource?a.cell:d,b.isSource?d:a.cell);return null==b.error};return a};mxEdgeHandler.prototype.validateConnection=function(a,b){return this.graph.getEdgeValidationError(this.state.cell,a,b)};
mxEdgeHandler.prototype.createBends=function(){for(var a=this.state.cell,b=[],c=0;c<this.abspoints.length;c++)if(this.isHandleVisible(c)){var d=c==this.abspoints.length-1;if((d=0==c||d)||this.graph.isCellBendable(a)){var e=this.createHandleShape(c);this.initBend(e);this.isHandleEnabled(c)&&(e.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE,mxEvent.redirectMouseEvents(e.node,this.graph,this.state));b.push(e);d||(this.points.push(new mxPoint(0,0)),e.node.style.visibility="hidden")}}return b};
mxEdgeHandler.prototype.isHandleEnabled=function(){return!0};mxEdgeHandler.prototype.isHandleVisible=function(){return!0};mxEdgeHandler.prototype.createHandleShape=function(a){if(null!=this.handleImage)return a=new mxImageShape(new mxRectangle(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src),a.preserveImageAspect=!1,a;a=mxConstants.HANDLE_SIZE;this.preferHtml&&(a-=1);return new mxRectangleShape(new mxRectangle(0,0,a,a),mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};
mxEdgeHandler.prototype.initBend=function(a){this.preferHtml?(a.dialect=mxConstants.DIALECT_STRICTHTML,a.init(this.graph.container)):(a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG,a.init(this.graph.getView().getOverlayPane()))};
mxEdgeHandler.prototype.getHandleForEvent=function(a){function b(b){if(null!=b&&"none"!=b.node.style.display&&"hidden"!=b.node.style.visibility&&(a.isSource(b)||null!=d&&mxUtils.intersects(b.bounds,d))){var c=a.getGraphX()-b.bounds.getCenterX(),b=a.getGraphY()-b.bounds.getCenterY(),c=c*c+b*b;if(null==e||c<=e)return e=c,!0}return!1}var c=!mxEvent.isMouseEvent(a.getEvent())?this.tolerance:1,d=this.allowHandleBoundsCheck&&(mxClient.IS_IE||0<c)?new mxRectangle(a.getGraphX()-c,a.getGraphY()-c,2*c,2*c):
null,e=null,c=null;if(a.isSource(this.state.text)||b(this.labelShape))c=mxEvent.LABEL_HANDLE;if(null!=this.bends)for(var f=0;f<this.bends.length;f++)b(this.bends[f])&&(c=f);return c};
mxEdgeHandler.prototype.mouseDown=function(a,b){var c=null,c=this.getHandleForEvent(b);this.addEnabled&&null==c&&this.isAddPointEvent(b.getEvent())?this.addPoint(this.state,b.getEvent()):null!=c&&!b.isConsumed()&&this.graph.isEnabled()&&(this.removeEnabled&&this.isRemovePointEvent(b.getEvent())?this.removePoint(this.state,c):(c!=mxEvent.LABEL_HANDLE||this.graph.isLabelMovable(b.getCell()))&&this.start(b.getX(),b.getY(),c),b.consume())};
mxEdgeHandler.prototype.start=function(a,b,c){this.startX=a;this.startY=b;this.isSource=null==this.bends?!1:0==c;this.isTarget=null==this.bends?!1:c==this.bends.length-1;this.isLabel=c==mxEvent.LABEL_HANDLE;if(this.isSource||this.isTarget){if(a=this.state.cell,b=this.graph.model.getTerminal(a,this.isSource),null==b&&this.graph.isTerminalPointMovable(a,this.isSource)||null!=b&&this.graph.isCellDisconnectable(a,b,this.isSource))this.index=c}else this.index=c};
mxEdgeHandler.prototype.clonePreviewState=function(){return this.state.clone()};mxEdgeHandler.prototype.getSnapToTerminalTolerance=function(){return this.graph.gridSize*this.graph.view.scale/2};
mxEdgeHandler.prototype.getPointForEvent=function(a){var b=new mxPoint(a.getGraphX(),a.getGraphY()),c=this.getSnapToTerminalTolerance(),d=this.graph.getView(),e=!1,f=!1;if(this.snapToTerminals&&0<c){var g=function(a){if(null!=a){var d=a.x;Math.abs(b.x-d)<c&&(b.x=d,e=!0);a=a.y;Math.abs(b.y-a)<c&&(b.y=a,f=!0)}},h=function(a){null!=a&&g.call(this,new mxPoint(d.getRoutingCenterX(a),d.getRoutingCenterY(a)))};h.call(this,this.state.getVisibleTerminalState(!0));h.call(this,this.state.getVisibleTerminalState(!1));
if(null!=this.abspoints)for(h=0;h<this.abspoints;h++)h!=this.index&&g.call(this,this.abspoints[h])}this.graph.isGridEnabledEvent(a.getEvent())&&(a=d.scale,h=d.translate,e||(b.x=(this.graph.snap(b.x/a-h.x)+h.x)*a),f||(b.y=(this.graph.snap(b.y/a-h.y)+h.y)*a));return b};
mxEdgeHandler.prototype.getPreviewTerminalState=function(a){this.constraintHandler.update(a,this.isSource);this.marker.process(a);var a=this.marker.getValidState(),b=null;null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint&&this.marker.reset();null!=a?b=a:null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(b=this.constraintHandler.currentFocus);return b};
mxEdgeHandler.prototype.getPreviewPoints=function(a){var b=this.graph.getCellGeometry(this.state.cell),b=null!=b.points?b.points.slice():null;!this.isSource&&!this.isTarget?(this.convertPoint(a,!1),null==b?b=[a]:b[this.index-1]=a):this.graph.resetEdgesOnConnect&&(b=null);return b};
mxEdgeHandler.prototype.updatePreviewState=function(a,b,c){var d=this.isSource?c:this.state.getVisibleTerminalState(!0),e=this.isTarget?c:this.state.getVisibleTerminalState(!1),f=this.graph.getConnectionConstraint(a,d,!0),g=this.graph.getConnectionConstraint(a,e,!1),h=this.constraintHandler.currentConstraint;null==h&&(h=new mxConnectionConstraint);this.isSource?f=h:this.isTarget&&(g=h);(!this.isSource||null!=d)&&a.view.updateFixedTerminalPoint(a,d,!0,f);(!this.isTarget||null!=e)&&a.view.updateFixedTerminalPoint(a,
e,!1,g);if((this.isSource||this.isTarget)&&null==c)a.setAbsoluteTerminalPoint(b,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.allowDanglingEdges?null:"");a.view.updatePoints(a,this.points,d,e);a.view.updateFloatingTerminalPoints(a,d,e)};
mxEdgeHandler.prototype.mouseMove=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.getPointForEvent(b);if(this.isLabel)this.label.x=c.x,this.label.y=c.y;else{this.points=this.getPreviewPoints(c);var d=this.isSource||this.isTarget?this.getPreviewTerminalState(b):null,e=this.clonePreviewState(c,null!=d?d.cell:null);this.updatePreviewState(e,c,d);this.setPreviewColor(null==this.error?this.marker.validColor:this.marker.invalidColor);this.abspoints=e.absolutePoints;this.active=!0}this.drawPreview();
mxEvent.consume(b.getEvent());b.consume()}else mxClient.IS_IE&&null!=this.getHandleForEvent(b)&&b.consume(!1)};
mxEdgeHandler.prototype.mouseUp=function(a,b){if(null!=this.index&&null!=this.marker){var c=this.state.cell;if(b.getX()!=this.startX||b.getY()!=this.startY)if(null!=this.error)0<this.error.length&&this.graph.validationAlert(this.error);else if(this.isLabel)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){var d=null;null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(d=this.constraintHandler.currentFocus.cell);null==
d&&this.marker.hasValidState()&&(d=this.marker.validState.cell);if(null!=d)c=this.connect(c,d,this.isSource,this.graph.isCloneEvent(b.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable(),b);else if(this.graph.isAllowDanglingEdges()){d=this.abspoints[this.isSource?0:this.abspoints.length-1];d.x=d.x/this.graph.view.scale-this.graph.view.translate.x;d.y=d.y/this.graph.view.scale-this.graph.view.translate.y;var e=this.graph.getView().getState(this.graph.getModel().getParent(c));null!=e&&(d.x-=
e.origin.x,d.y-=e.origin.y);d.x-=this.graph.panDx/this.graph.view.scale;d.y-=this.graph.panDy/this.graph.view.scale;this.changeTerminalPoint(c,d,this.isSource)}}else this.active?this.changePoints(c,this.points):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().revalidate(this.state.cell));null!=this.marker&&(this.reset(),c!=this.state.cell&&this.graph.setSelectionCell(c));b.consume()}};
mxEdgeHandler.prototype.reset=function(){this.points=this.label=this.index=this.error=null;this.isTarget=this.isSource=this.isLabel=this.active=!1;this.marker.reset();this.constraintHandler.reset();this.setPreviewColor(mxConstants.EDGE_SELECTION_COLOR);this.redraw()};mxEdgeHandler.prototype.setPreviewColor=function(a){null!=this.shape&&(this.shape.stroke=a)};
mxEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate();b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x);a.y=Math.round(a.y/c-d.y);c=this.graph.getView().getState(this.graph.getModel().getParent(this.state.cell));null!=c&&(a.x-=c.origin.x,a.y-=c.origin.y);return a};
mxEdgeHandler.prototype.moveLabel=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a.cell);if(null!=e){var e=e.clone(),f=this.graph.getView().getRelativePoint(a,b,c);e.x=f.x;e.y=f.y;var g=this.graph.getView().scale;e.offset=new mxPoint(0,0);f=this.graph.view.getPoint(a,e);e.offset=new mxPoint((b-f.x)/g,(c-f.y)/g);d.setGeometry(a.cell,e)}};
mxEdgeHandler.prototype.connect=function(a,b,c,d,e){var e=this.graph.getModel(),f=e.getParent(a);e.beginUpdate();try{if(d){var g=a.clone();e.add(f,g,e.getChildCount(f));var h=e.getTerminal(a,!c);this.graph.connectCell(g,h,!c);a=g}var k=this.constraintHandler.currentConstraint;null==k&&(k=new mxConnectionConstraint);this.graph.connectCell(a,b,c,k)}finally{e.endUpdate()}return a};
mxEdgeHandler.prototype.changeTerminalPoint=function(a,b,c){var d=this.graph.getModel(),e=d.getGeometry(a);if(null!=e){d.beginUpdate();try{e=e.clone(),e.setTerminalPoint(b,c),d.setGeometry(a,e),this.graph.connectCell(a,null,c,new mxConnectionConstraint)}finally{d.endUpdate()}}};mxEdgeHandler.prototype.changePoints=function(a,b){var c=this.graph.getModel(),d=c.getGeometry(a);null!=d&&(d=d.clone(),d.points=b,c.setGeometry(a,d))};
mxEdgeHandler.prototype.addPoint=function(a,b){var c=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(b),mxEvent.getClientY(b)),d=this.graph.isGridEnabledEvent(b);this.convertPoint(c,d);this.addPointAt(a,c.x,c.y);mxEvent.consume(b)};
mxEdgeHandler.prototype.addPointAt=function(a,b,c){var d=this.graph.getCellGeometry(a.cell),b=new mxPoint(b,c);if(null!=d){var d=d.clone(),c=this.graph.view.translate,e=this.graph.view.scale,c=mxUtils.findNearestSegment(a,(b.x+c.x)*e,(b.y+c.y)*e);null==d.points?d.points=[b]:d.points.splice(c,0,b);this.graph.getModel().setGeometry(a.cell,d);this.destroy();this.init()}};
mxEdgeHandler.prototype.removePoint=function(a,b){if(0<b&&b<this.abspoints.length-1){var c=this.graph.getCellGeometry(this.state.cell);null!=c&&null!=c.points&&(c=c.clone(),c.points.splice(b-1,1),this.graph.getModel().setGeometry(a.cell,c),this.destroy(),this.init())}};
mxEdgeHandler.prototype.getHandleFillColor=function(a){var a=0==a,b=this.state.cell,c=this.graph.getModel().getTerminal(b,a),d=mxConstants.HANDLE_FILLCOLOR;null!=c&&!this.graph.isCellDisconnectable(b,c,a)||null==c&&!this.graph.isTerminalPointMovable(b,a)?d=mxConstants.LOCKED_HANDLE_FILLCOLOR:null!=c&&this.graph.isCellDisconnectable(b,c,a)&&(d=mxConstants.CONNECT_HANDLE_FILLCOLOR);return d};
mxEdgeHandler.prototype.redraw=function(){this.abspoints=this.state.absolutePoints.slice();this.redrawHandles();var a=this.graph.getModel().getGeometry(this.state.cell).points;if(null!=this.bends&&0<this.bends.length&&null!=a){null==this.points&&(this.points=[]);for(var b=1;b<this.bends.length-1;b++)null!=this.bends[b]&&null!=this.abspoints[b]&&(this.points[b-1]=a[b-1])}this.drawPreview()};
mxEdgeHandler.prototype.redrawHandles=function(){var a=this.state.cell,b=mxConstants.LABEL_HANDLE_SIZE;this.label=new mxPoint(this.state.absoluteOffset.x,this.state.absoluteOffset.y);this.labelShape.bounds=new mxRectangle(Math.round(this.label.x-b/2),Math.round(this.label.y-b/2),b,b);this.labelShape.redraw();b=this.graph.getLabel(a);null!=b&&0<b.length&&this.graph.isLabelMovable(a)?this.labelShape.node.style.visibility="visible":this.labelShape.node.style.visibility="hidden";if(null!=this.bends&&
0<this.bends.length){var c=this.abspoints.length-1,a=this.abspoints[0],d=this.abspoints[0].y,b=this.bends[0].bounds;this.bends[0].bounds=new mxRectangle(Math.round(this.abspoints[0].x-b.width/2),Math.round(d-b.height/2),b.width,b.height);this.bends[0].fill=this.getHandleFillColor(0);this.bends[0].redraw();var d=this.abspoints[c],e=this.abspoints[c].x,c=this.abspoints[c].y,f=this.bends.length-1,b=this.bends[f].bounds;this.bends[f].bounds=new mxRectangle(Math.round(e-b.width/2),Math.round(c-b.height/
2),b.width,b.height);this.bends[f].fill=this.getHandleFillColor(f);this.bends[f].redraw();this.redrawInnerBends(a,d)}};
mxEdgeHandler.prototype.redrawInnerBends=function(){for(var a=1;a<this.bends.length-1;a++)if(null!=this.bends[a])if(null!=this.abspoints[a]){var b=this.abspoints[a].x,c=this.abspoints[a].y,d=this.bends[a].bounds;this.bends[a].node.style.visibility="visible";this.bends[a].bounds=new mxRectangle(Math.round(b-d.width/2),Math.round(c-d.height/2),d.width,d.height);this.bends[a].redraw()}else this.bends[a].destroy(),this.bends[a]=null};
mxEdgeHandler.prototype.drawPreview=function(){if(this.isLabel){var a=mxConstants.LABEL_HANDLE_SIZE,a=new mxRectangle(Math.round(this.label.x-a/2),Math.round(this.label.y-a/2),a,a);this.labelShape.bounds=a;this.labelShape.redraw()}else this.shape.points=this.abspoints,this.shape.redraw()};
mxEdgeHandler.prototype.destroy=function(){null!=this.marker&&(this.marker.destroy(),this.marker=null);null!=this.shape&&(this.shape.destroy(),this.shape=null);null!=this.labelShape&&(this.labelShape.destroy(),this.labelShape=null);null!=this.constraintHandler&&(this.constraintHandler.destroy(),this.constraintHandler=null);if(null!=this.bends){for(var a=0;a<this.bends.length;a++)null!=this.bends[a]&&(this.bends[a].destroy(),this.bends[a]=null);this.bends=null}};
function mxElbowEdgeHandler(a){mxEdgeHandler.call(this,a)}mxUtils.extend(mxElbowEdgeHandler,mxEdgeHandler);mxElbowEdgeHandler.prototype=new mxEdgeHandler;mxElbowEdgeHandler.prototype.constructor=mxElbowEdgeHandler;mxElbowEdgeHandler.prototype.flipEnabled=!0;mxElbowEdgeHandler.prototype.doubleClickOrientationResource="none"!=mxClient.language?"doubleClickOrientation":"";
mxElbowEdgeHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");a.push(this.createVirtualBend());this.points.push(new mxPoint(0,0));b=this.createHandleShape(2);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);
a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");return a};
mxElbowEdgeHandler.prototype.createVirtualBend=function(){var a=this.createHandleShape();this.initBend(a);var b=this.getCursorForBend();a.node.style.cursor=b;b=mxUtils.bind(this,function(a){!mxEvent.isConsumed(a)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell,a),mxEvent.consume(a))});mxEvent.redirectMouseEvents(a.node,this.graph,this.state,null,null,null,b);this.graph.isCellBendable(this.state.cell)||(a.node.style.display="none");return a};
mxElbowEdgeHandler.prototype.getCursorForBend=function(){return this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.TopToBottom||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_TOPTOBOTTOM||(this.state.style[mxConstants.STYLE_EDGE]==mxEdgeStyle.ElbowConnector||this.state.style[mxConstants.STYLE_EDGE]==mxConstants.EDGESTYLE_ELBOW)&&this.state.style[mxConstants.STYLE_ELBOW]==mxConstants.ELBOW_VERTICAL?"row-resize":"col-resize"};
mxElbowEdgeHandler.prototype.getTooltipForNode=function(a){var b=null;if(null!=this.bends&&null!=this.bends[1]&&(a==this.bends[1].node||a.parentNode==this.bends[1].node))b=this.doubleClickOrientationResource,b=mxResources.get(b)||b;return b};
mxElbowEdgeHandler.prototype.convertPoint=function(a,b){var c=this.graph.getView().getScale(),d=this.graph.getView().getTranslate(),e=this.state.origin;b&&(a.x=this.graph.snap(a.x),a.y=this.graph.snap(a.y));a.x=Math.round(a.x/c-d.x-e.x);a.y=Math.round(a.y/c-d.y-e.y)};
mxElbowEdgeHandler.prototype.redrawInnerBends=function(a,b){var c=this.graph.getModel().getGeometry(this.state.cell),d=this.state.absolutePoints,e=null;1<d.length?(a=d[1],b=d[d.length-2]):null!=c.points&&0<c.points.length&&(e=d[0]);e=null==e?new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2):new mxPoint(this.graph.getView().scale*(e.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(e.y+this.graph.getView().translate.y+this.state.origin.y));d=this.bends[1].bounds;c=d.width;
d=d.height;null==this.handleImage&&(d=c=mxConstants.HANDLE_SIZE);var f=new mxRectangle(Math.round(e.x-c/2),Math.round(e.y-d/2),c,d);null==this.handleImage&&"hidden"!=this.labelShape.node.style.visibility&&mxUtils.intersects(f,this.labelShape.bounds)&&(c+=3,d+=3,f=new mxRectangle(Math.round(e.x-c/2),Math.round(e.y-d/2),c,d));this.bends[1].bounds=f;this.bends[1].redraw()};function mxEdgeSegmentHandler(a){mxEdgeHandler.call(this,a)}mxUtils.extend(mxEdgeSegmentHandler,mxEdgeHandler);
mxEdgeSegmentHandler.prototype=new mxElbowEdgeHandler;mxEdgeSegmentHandler.prototype.constructor=mxEdgeSegmentHandler;
mxEdgeSegmentHandler.prototype.getPreviewPoints=function(a){if(this.isSource||this.isTarget)return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments);this.convertPoint(a,!1);var b=this.state.absolutePoints,c=b[0].clone();this.convertPoint(c,!1);for(var d=[],e=1;e<b.length;e++){var f=b[e].clone();this.convertPoint(f,!1);e==this.index&&(c.x==f.x?(c.x=a.x,f.x=a.x):(c.y=a.y,f.y=a.y));e<b.length-1&&d.push(f);c=f}if(1==d.length){if(c=this.state.view,e=this.state.getVisibleTerminalState(!0),
f=this.state.getVisibleTerminalState(!1),null!=f&null!=e){var g=this.state.origin.x,h=this.state.origin.y;mxUtils.contains(f,d[0].x+g,d[0].y+h)?b[1].y==b[2].y?d[0].y=c.getRoutingCenterY(e)-h:d[0].x=c.getRoutingCenterX(e)-g:mxUtils.contains(e,d[0].x+g,d[0].y+h)&&(b[1].y==b[0].y?d[0].y=c.getRoutingCenterY(f)-h:d[0].x=c.getRoutingCenterX(f)-g)}}else 0==d.length&&(d=[a]);return d};
mxEdgeSegmentHandler.prototype.createBends=function(){var a=[],b=this.createHandleShape(0);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");var c=this.state.absolutePoints;if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(var d=0;d<c.length-1;d++)b=this.createVirtualBend(),a.push(b),b.node.style.cursor=0==c[d].x-
c[d+1].x?"col-resize":"row-resize",this.points.push(new mxPoint(0,0)),mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none")}b=this.createHandleShape(c.length);this.initBend(b);b.node.style.cursor=mxConstants.CURSOR_BEND_HANDLE;mxEvent.redirectMouseEvents(b.node,this.graph,this.state);a.push(b);mxClient.IS_TOUCH&&b.node.setAttribute("pointer-events","none");return a};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};
mxEdgeSegmentHandler.prototype.refresh=function(){if(null!=this.bends){for(var a=0;a<this.bends.length;a++)null!=this.bends[a]&&(this.bends[a].destroy(),this.bends[a]=null);this.bends=this.createBends()}};
mxEdgeSegmentHandler.prototype.redrawInnerBends=function(a,b){if(this.graph.isCellBendable(this.state.cell)){var c=mxConstants.HANDLE_SIZE,d=this.state.absolutePoints;if(null!=d&&1<d.length)for(var e=0;e<this.state.absolutePoints.length-1;e++)if(null!=this.bends[e+1]){var a=d[e],b=d[e+1],f=new mxPoint(a.x+(b.x-a.x)/2,a.y+(b.y-a.y)/2);this.bends[e+1].bounds=new mxRectangle(Math.round(f.x-c/2),Math.round(f.y-c/2),c,c);this.bends[e+1].redraw()}}};
mxEdgeSegmentHandler.prototype.changePoints=function(a,b){var b=[],c=this.abspoints;if(1<c.length)for(var d=c[0],e=c[1],f=2;f<c.length;f++){var g=c[f];if((Math.round(d.x)!=Math.round(e.x)||Math.round(e.x)!=Math.round(g.x))&&(Math.round(d.y)!=Math.round(e.y)||Math.round(e.y)!=Math.round(g.y)))d=e,e=e.clone(),this.convertPoint(e,!1),b.push(e);e=g}mxElbowEdgeHandler.prototype.changePoints.apply(this,arguments)};
function mxKeyHandler(a,b){null!=a&&(this.graph=a,this.target=b||document.documentElement,this.normalKeys=[],this.shiftKeys=[],this.controlKeys=[],this.controlShiftKeys=[],this.keydownHandler=mxUtils.bind(this,function(a){this.keyDown(a)}),mxEvent.addListener(this.target,"keydown",this.keydownHandler),mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()})))}mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;
mxKeyHandler.prototype.normalKeys=null;mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=!0;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(a){this.enabled=a};mxKeyHandler.prototype.bindKey=function(a,b){this.normalKeys[a]=b};mxKeyHandler.prototype.bindShiftKey=function(a,b){this.shiftKeys[a]=b};
mxKeyHandler.prototype.bindControlKey=function(a,b){this.controlKeys[a]=b};mxKeyHandler.prototype.bindControlShiftKey=function(a,b){this.controlShiftKeys[a]=b};mxKeyHandler.prototype.isControlDown=function(a){return mxEvent.isControlDown(a)};mxKeyHandler.prototype.getFunction=function(a){return null!=a?this.isControlDown(a)?mxEvent.isShiftDown(a)?this.controlShiftKeys[a.keyCode]:this.controlKeys[a.keyCode]:mxEvent.isShiftDown(a)?this.shiftKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};
mxKeyHandler.prototype.isGraphEvent=function(a){a=mxEvent.getSource(a);if(a==this.target||a.parentNode==this.target||null!=this.graph.cellEditor&&a==this.graph.cellEditor.textarea)return!0;for(;null!=a;){if(a==this.graph.container)return!0;a=a.parentNode}return!1};
mxKeyHandler.prototype.keyDown=function(a){if(this.graph.isEnabled()&&!mxEvent.isConsumed(a)&&this.isGraphEvent(a)&&this.isEnabled())if(27==a.keyCode)this.escape(a);else if(!this.graph.isEditing()){var b=this.getFunction(a);null!=b&&(b(a),mxEvent.consume(a))}};mxKeyHandler.prototype.escape=function(a){this.graph.isEscapeEnabled()&&this.graph.escape(a)};
mxKeyHandler.prototype.destroy=function(){null!=this.target&&null!=this.keydownHandler&&(mxEvent.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null);this.target=null};function mxTooltipHandler(a,b){null!=a&&(this.graph=a,this.delay=b||500,this.graph.addMouseListener(this))}mxTooltipHandler.prototype.zIndex=10005;mxTooltipHandler.prototype.graph=null;mxTooltipHandler.prototype.delay=null;mxTooltipHandler.prototype.ignoreTouchEvents=!0;
mxTooltipHandler.prototype.hideOnHover=!1;mxTooltipHandler.prototype.enabled=!0;mxTooltipHandler.prototype.isEnabled=function(){return this.enabled};mxTooltipHandler.prototype.setEnabled=function(a){this.enabled=a};mxTooltipHandler.prototype.isHideOnHover=function(){return this.hideOnHover};mxTooltipHandler.prototype.setHideOnHover=function(a){this.hideOnHover=a};
mxTooltipHandler.prototype.init=function(){null!=document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),mxEvent.addGestureListeners(this.div,mxUtils.bind(this,function(){this.hideTooltip()})))};mxTooltipHandler.prototype.mouseDown=function(a,b){this.reset(b,!1);this.hideTooltip()};
mxTooltipHandler.prototype.mouseMove=function(a,b){if(b.getX()!=this.lastX||b.getY()!=this.lastY)this.reset(b,!0),(this.isHideOnHover()||b.getState()!=this.state||b.getSource()!=this.node&&(!this.stateSource||null!=b.getState()&&this.stateSource==(b.isSource(b.getState().shape)||!b.isSource(b.getState().text))))&&this.hideTooltip();this.lastX=b.getX();this.lastY=b.getY()};mxTooltipHandler.prototype.mouseUp=function(a,b){this.reset(b,!0);this.hideTooltip()};
mxTooltipHandler.prototype.resetTimer=function(){null!=this.thread&&(window.clearTimeout(this.thread),this.thread=null)};
mxTooltipHandler.prototype.reset=function(a,b){if(!this.ignoreTouchEvents||mxEvent.isMouseEvent(a.getEvent()))if(this.resetTimer(),b&&this.isEnabled()&&null!=a.getState()&&(null==this.div||"hidden"==this.div.style.visibility)){var c=a.getState(),d=a.getSource(),e=a.getX(),f=a.getY(),g=a.isSource(c.shape)||a.isSource(c.text);this.thread=window.setTimeout(mxUtils.bind(this,function(){!this.graph.isEditing()&&!this.graph.popupMenuHandler.isMenuShowing()&&(this.show(this.graph.getTooltip(c,d,e,f),e,f),
this.state=c,this.node=d,this.stateSource=g)}),this.delay)}};mxTooltipHandler.prototype.hide=function(){this.resetTimer();this.hideTooltip()};mxTooltipHandler.prototype.hideTooltip=function(){null!=this.div&&(this.div.style.visibility="hidden")};
mxTooltipHandler.prototype.show=function(a,b,c){if(null!=a&&0<a.length){null==this.div&&this.init();var d=mxUtils.getScrollOrigin();this.div.style.zIndex=this.zIndex;this.div.style.left=b+d.x+"px";this.div.style.top=c+mxConstants.TOOLTIP_VERTICAL_OFFSET+d.y+"px";mxUtils.isNode(a)?(this.div.innerHTML="",this.div.appendChild(a)):this.div.innerHTML=a.replace(/\n/g,"<br>");this.div.style.visibility="";mxUtils.fit(this.div)}};
mxTooltipHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);mxEvent.release(this.div);null!=this.div&&null!=this.div.parentNode&&this.div.parentNode.removeChild(this.div);this.div=null};function mxCellTracker(a,b,c){mxCellMarker.call(this,a,b);this.graph.addMouseListener(this);null!=c&&(this.getCell=c);mxClient.IS_IE&&mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}mxUtils.extend(mxCellTracker,mxCellMarker);
mxCellTracker.prototype.mouseDown=function(){};mxCellTracker.prototype.mouseMove=function(a,b){this.isEnabled()&&this.process(b)};mxCellTracker.prototype.mouseUp=function(){this.reset()};mxCellTracker.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),mxCellMarker.prototype.destroy.apply(this))};
function mxCellHighlight(a,b,c,d){null!=a&&(this.graph=a,this.highlightColor=null!=b?b:mxConstants.DEFAULT_VALID_COLOR,this.strokeWidth=null!=c?c:mxConstants.HIGHLIGHT_STROKEWIDTH,this.dashed=null!=d?d:!1,this.repaintHandler=mxUtils.bind(this,function(){null!=this.state&&(this.state=this.graph.view.getState(this.state.cell),null==this.state?this.hide():this.repaint())}),this.graph.getView().addListener(mxEvent.SCALE,this.repaintHandler),this.graph.getView().addListener(mxEvent.TRANSLATE,this.repaintHandler),
this.graph.getView().addListener(mxEvent.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getModel().addListener(mxEvent.CHANGE,this.repaintHandler),this.resetHandler=mxUtils.bind(this,function(){this.hide()}),this.graph.getView().addListener(mxEvent.DOWN,this.resetHandler),this.graph.getView().addListener(mxEvent.UP,this.resetHandler))}mxCellHighlight.prototype.keepOnTop=!1;mxCellHighlight.prototype.graph=!0;mxCellHighlight.prototype.state=null;mxCellHighlight.prototype.spacing=2;
mxCellHighlight.prototype.resetHandler=null;mxCellHighlight.prototype.setHighlightColor=function(a){this.highlightColor=a;null!=this.shape&&(this.shape.stroke=a)};mxCellHighlight.prototype.drawHighlight=function(){this.shape=this.createShape();this.repaint();!this.keepOnTop&&this.shape.node.parentNode.firstChild!=this.shape.node&&this.shape.node.parentNode.insertBefore(this.shape.node,this.shape.node.parentNode.firstChild)};
mxCellHighlight.prototype.createShape=function(){var a=null,a=this.graph.model.isEdge(this.state.cell)?new mxPolyline(this.state.absolutePoints,this.highlightColor,this.strokeWidth):new mxRectangleShape(new mxRectangle,null,this.highlightColor,this.strokeWidth);a.dialect=this.graph.dialect!=mxConstants.DIALECT_SVG?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(a.node,this.graph,this.state);a.pointerEvents=!1;a.isDashed=this.dashed;
return a};mxCellHighlight.prototype.repaint=function(){null!=this.state&&null!=this.shape&&(this.graph.model.isEdge(this.state.cell)?this.shape.points=this.state.absolutePoints:(this.shape.bounds=new mxRectangle(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")),null!=this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())};
mxCellHighlight.prototype.hide=function(){this.highlight(null)};mxCellHighlight.prototype.highlight=function(a){this.state!=a&&(null!=this.shape&&(this.shape.destroy(),this.shape=null),this.state=a,null!=this.state&&this.drawHighlight())};
mxCellHighlight.prototype.destroy=function(){this.graph.getView().removeListener(this.repaintHandler);this.graph.getModel().removeListener(this.repaintHandler);this.graph.getView().removeListener(this.resetHandler);this.graph.getModel().removeListener(this.resetHandler);null!=this.shape&&(this.shape.destroy(),this.shape=null)};
function mxDefaultKeyHandler(a){if(null!=a){this.editor=a;this.handler=new mxKeyHandler(a.graph);var b=this.handler.escape;this.handler.escape=function(c){b.apply(this,arguments);a.hideProperties();a.fireEvent(new mxEventObject(mxEvent.ESCAPE,"event",c))}}}mxDefaultKeyHandler.prototype.editor=null;mxDefaultKeyHandler.prototype.handler=null;
mxDefaultKeyHandler.prototype.bindAction=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(b)});c?this.handler.bindControlKey(a,d):this.handler.bindKey(a,d)};mxDefaultKeyHandler.prototype.destroy=function(){this.handler.destroy();this.handler=null};function mxDefaultPopupMenu(a){this.config=a}mxDefaultPopupMenu.prototype.imageBasePath=null;mxDefaultPopupMenu.prototype.config=null;
mxDefaultPopupMenu.prototype.createMenu=function(a,b,c,d){if(null!=this.config){var e=this.createConditions(a,c,d);this.addItems(a,b,c,d,e,this.config.firstChild,null)}};
mxDefaultPopupMenu.prototype.addItems=function(a,b,c,d,e,f,g){for(var h=!1;null!=f;){if("add"==f.nodeName){var k=f.getAttribute("if");if(null==k||e[k]){var k=f.getAttribute("as"),k=mxResources.get(k)||k,l=mxUtils.eval(mxUtils.getTextContent(f)),m=f.getAttribute("action"),n=f.getAttribute("icon"),o=f.getAttribute("iconCls");h&&(b.addSeparator(g),h=!1);null!=n&&this.imageBasePath&&(n=this.imageBasePath+n);k=this.addAction(b,a,k,n,l,m,c,g,o);this.addItems(a,b,c,d,e,f.firstChild,k)}}else"separator"==
f.nodeName&&(h=!0);f=f.nextSibling}};mxDefaultPopupMenu.prototype.addAction=function(a,b,c,d,e,f,g,h,k){return a.addItem(c,d,function(a){"function"==typeof e&&e.call(b,b,g,a);null!=f&&b.execute(f,g,a)},h,k)};
mxDefaultPopupMenu.prototype.createConditions=function(a,b,c){var d=a.graph.getModel(),e=d.getChildCount(b),f=[];f.nocell=null==b;f.ncells=1<a.graph.getSelectionCount();f.notRoot=d.getRoot()!=d.getParent(a.graph.getDefaultParent());f.cell=null!=b;d=null!=b&&1==a.graph.getSelectionCount();f.nonEmpty=d&&0<e;f.expandable=d&&a.graph.isCellFoldable(b,!1);f.collapsable=d&&a.graph.isCellFoldable(b,!0);f.validRoot=d&&a.graph.isValidRoot(b);f.emptyValidRoot=f.validRoot&&0==e;f.swimlane=d&&a.graph.isSwimlane(b);
e=this.config.getElementsByTagName("condition");for(d=0;d<e.length;d++){var g=mxUtils.eval(mxUtils.getTextContent(e[d])),h=e[d].getAttribute("name");null!=h&&"function"==typeof g&&(f[h]=g(a,b,c))}return f};function mxDefaultToolbar(a,b){this.editor=b;null!=a&&null!=b&&this.init(a)}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=!1;
mxDefaultToolbar.prototype.init=function(a){null!=a&&(this.toolbar=new mxToolbar(a),this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(a,c){var d=c.getProperty("function");this.editor.insertFunction=null!=d?mxUtils.bind(this,function(){d.apply(this,arguments);this.toolbar.resetMode()}):null})),this.resetHandler=mxUtils.bind(this,function(){null!=this.toolbar&&this.toolbar.resetMode(!0)}),this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(mxEvent.ESCAPE,
this.resetHandler))};mxDefaultToolbar.prototype.addItem=function(a,b,c,d){var e=mxUtils.bind(this,function(){null!=c&&0<c.length&&this.editor.execute(c)});return this.toolbar.addItem(a,b,e,d)};mxDefaultToolbar.prototype.addSeparator=function(a){a=a||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(a)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(a){return this.toolbar.addActionCombo(a)};
mxDefaultToolbar.prototype.addActionOption=function(a,b,c){var d=mxUtils.bind(this,function(){this.editor.execute(c)});this.addOption(a,b,d)};mxDefaultToolbar.prototype.addOption=function(a,b,c){return this.toolbar.addOption(a,b,c)};mxDefaultToolbar.prototype.addMode=function(a,b,c,d,e){var f=mxUtils.bind(this,function(){this.editor.setMode(c);null!=e&&e(this.editor)});return this.toolbar.addSwitchMode(a,b,f,d)};
mxDefaultToolbar.prototype.addPrototype=function(a,b,c,d,e,f){var g=function(){return"function"==typeof c?c():null!=c?c.clone():null},h=mxUtils.bind(this,function(a,b){"function"==typeof e?e(this.editor,g(),a,b):this.drop(g(),a,b);this.toolbar.resetMode();mxEvent.consume(a)}),a=this.toolbar.addMode(a,b,h,d,null,f);this.installDropHandler(a,function(a,b,c){h(b,c)});return a};
mxDefaultToolbar.prototype.drop=function(a,b,c){var d=this.editor.graph,e=d.getModel();if(null==c||e.isEdge(c)||!this.connectOnDrop||!d.isCellConnectable(c)){for(;null!=c&&!d.isValidDropTarget(c,[a],b);)c=e.getParent(c);this.insert(a,b,c)}else this.connect(a,b,c)};
mxDefaultToolbar.prototype.insert=function(a,b,c){var d=this.editor.graph;if(d.canImportCell(a)){var e=mxEvent.getClientX(b),f=mxEvent.getClientY(b),e=mxUtils.convertPoint(d.container,e,f);return d.isSplitEnabled()&&d.isSplitTarget(c,[a],b)?d.splitEdge(c,[a],null,e.x,e.y):this.editor.addVertex(c,a,e.x,e.y)}return null};
mxDefaultToolbar.prototype.connect=function(a,b,c){var b=this.editor.graph,d=b.getModel();if(null!=c&&b.isCellConnectable(a)&&b.isEdgeValid(null,c,a)){var e=null;d.beginUpdate();try{var f=d.getGeometry(c),g=d.getGeometry(a).clone();g.x=f.x+(f.width-g.width)/2;g.y=f.y+(f.height-g.height)/2;var h=this.spacing*b.gridSize,k=20*d.getDirectedEdgeCount(c,!0);this.editor.horizontalFlow?g.x+=(g.width+f.width)/2+h+k:g.y+=(g.height+f.height)/2+h+k;a.setGeometry(g);var l=d.getParent(c);b.addCell(a,l);b.constrainChild(a);
e=this.editor.createEdge(c,a);if(null==d.getGeometry(e)){var m=new mxGeometry;m.relative=!0;d.setGeometry(e,m)}b.addEdge(e,l,c,a)}finally{d.endUpdate()}b.setSelectionCells([a,e]);b.scrollCellToVisible(a)}};
mxDefaultToolbar.prototype.installDropHandler=function(a,b){var c=document.createElement("img");c.setAttribute("src",a.getAttribute("src"));var d=mxUtils.bind(this,function(){c.style.width=2*a.offsetWidth+"px";c.style.height=2*a.offsetHeight+"px";mxUtils.makeDraggable(a,this.editor.graph,b,c);mxEvent.removeListener(c,"load",d)});mxClient.IS_IE?d():mxEvent.addListener(c,"load",d)};
mxDefaultToolbar.prototype.destroy=function(){null!=this.resetHandler&&(this.editor.graph.removeListener("dblclick",this.resetHandler),this.editor.removeListener("escape",this.resetHandler),this.resetHandler=null);null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)};
function mxEditor(a){this.actions=[];this.addActions();if(null!=document.body){this.cycleAttributeValues=[];this.popupHandler=new mxDefaultPopupMenu;this.undoManager=new mxUndoManager;this.graph=this.createGraph();this.toolbar=this.createToolbar();this.keyHandler=new mxDefaultKeyHandler(this);this.configure(a);this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName;!mxClient.IS_LOCAL&&null!=this.urlInit&&(this.session=this.createSession());if(null!=this.onInit)this.onInit();mxClient.IS_IE&&
mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}mxLoadResources&&mxResources.add(mxClient.basePath+"/resources/editor");mxEditor.prototype=new mxEventSource;mxEditor.prototype.constructor=mxEditor;mxEditor.prototype.askZoomResource="none"!=mxClient.language?"askZoom":"";mxEditor.prototype.lastSavedResource="none"!=mxClient.language?"lastSaved":"";mxEditor.prototype.currentFileResource="none"!=mxClient.language?"currentFile":"";
mxEditor.prototype.propertiesResource="none"!=mxClient.language?"properties":"";mxEditor.prototype.tasksResource="none"!=mxClient.language?"tasks":"";mxEditor.prototype.helpResource="none"!=mxClient.language?"help":"";mxEditor.prototype.outlineResource="none"!=mxClient.language?"outline":"";mxEditor.prototype.outline=null;mxEditor.prototype.graph=null;mxEditor.prototype.graphRenderHint=null;mxEditor.prototype.toolbar=null;mxEditor.prototype.session=null;mxEditor.prototype.status=null;
mxEditor.prototype.popupHandler=null;mxEditor.prototype.undoManager=null;mxEditor.prototype.keyHandler=null;mxEditor.prototype.actions=null;mxEditor.prototype.dblClickAction="edit";mxEditor.prototype.swimlaneRequired=!1;mxEditor.prototype.disableContextMenu=!0;mxEditor.prototype.insertFunction=null;mxEditor.prototype.forcedInserting=!1;mxEditor.prototype.templates=null;mxEditor.prototype.defaultEdge=null;mxEditor.prototype.defaultEdgeStyle=null;mxEditor.prototype.defaultGroup=null;
mxEditor.prototype.groupBorderSize=null;mxEditor.prototype.filename=null;mxEditor.prototype.linefeed="&#xa;";mxEditor.prototype.postParameterName="xml";mxEditor.prototype.escapePostData=!0;mxEditor.prototype.urlPost=null;mxEditor.prototype.urlImage=null;mxEditor.prototype.urlInit=null;mxEditor.prototype.urlNotify=null;mxEditor.prototype.urlPoll=null;mxEditor.prototype.horizontalFlow=!1;mxEditor.prototype.layoutDiagram=!1;mxEditor.prototype.swimlaneSpacing=0;mxEditor.prototype.maintainSwimlanes=!1;
mxEditor.prototype.layoutSwimlanes=!1;mxEditor.prototype.cycleAttributeValues=null;mxEditor.prototype.cycleAttributeIndex=0;mxEditor.prototype.cycleAttributeName="fillColor";mxEditor.prototype.tasks=null;mxEditor.prototype.tasksWindowImage=null;mxEditor.prototype.tasksTop=20;mxEditor.prototype.help=null;mxEditor.prototype.helpWindowImage=null;mxEditor.prototype.urlHelp=null;mxEditor.prototype.helpWidth=300;mxEditor.prototype.helpHeight=260;mxEditor.prototype.propertiesWidth=240;
mxEditor.prototype.propertiesHeight=null;mxEditor.prototype.movePropertiesDialog=!1;mxEditor.prototype.validating=!1;mxEditor.prototype.modified=!1;mxEditor.prototype.isModified=function(){return this.modified};mxEditor.prototype.setModified=function(a){this.modified=a};
mxEditor.prototype.addActions=function(){this.addAction("save",function(a){a.save()});this.addAction("print",function(a){(new mxPrintPreview(a.graph,1)).open()});this.addAction("show",function(a){mxUtils.show(a.graph,null,10,10)});this.addAction("exportImage",function(a){var b=a.getUrlImage();if(null==b||mxClient.IS_LOCAL)a.execute("show");else{var c=mxUtils.getViewXml(a.graph,1),c=mxUtils.getXml(c,"\n");mxUtils.submit(b,a.postParameterName+"="+encodeURIComponent(c),document,"_blank")}});this.addAction("refresh",
function(a){a.graph.refresh()});this.addAction("cut",function(a){a.graph.isEnabled()&&mxClipboard.cut(a.graph)});this.addAction("copy",function(a){a.graph.isEnabled()&&mxClipboard.copy(a.graph)});this.addAction("paste",function(a){a.graph.isEnabled()&&mxClipboard.paste(a.graph)});this.addAction("delete",function(a){a.graph.isEnabled()&&a.graph.removeCells()});this.addAction("group",function(a){a.graph.isEnabled()&&a.graph.setSelectionCell(a.groupCells())});this.addAction("ungroup",function(a){a.graph.isEnabled()&&
a.graph.setSelectionCells(a.graph.ungroupCells())});this.addAction("removeFromParent",function(a){a.graph.isEnabled()&&a.graph.removeCellsFromParent()});this.addAction("undo",function(a){a.graph.isEnabled()&&a.undo()});this.addAction("redo",function(a){a.graph.isEnabled()&&a.redo()});this.addAction("zoomIn",function(a){a.graph.zoomIn()});this.addAction("zoomOut",function(a){a.graph.zoomOut()});this.addAction("actualSize",function(a){a.graph.zoomActual()});this.addAction("fit",function(a){a.graph.fit()});
this.addAction("showProperties",function(a,b){a.showProperties(b)});this.addAction("selectAll",function(a){a.graph.isEnabled()&&a.graph.selectAll()});this.addAction("selectNone",function(a){a.graph.isEnabled()&&a.graph.clearSelection()});this.addAction("selectVertices",function(a){a.graph.isEnabled()&&a.graph.selectVertices()});this.addAction("selectEdges",function(a){a.graph.isEnabled()&&a.graph.selectEdges()});this.addAction("edit",function(a,b){a.graph.isEnabled()&&a.graph.isCellEditable(b)&&a.graph.startEditingAtCell(b)});
this.addAction("toBack",function(a){a.graph.isEnabled()&&a.graph.orderCells(!0)});this.addAction("toFront",function(a){a.graph.isEnabled()&&a.graph.orderCells(!1)});this.addAction("enterGroup",function(a,b){a.graph.enterGroup(b)});this.addAction("exitGroup",function(a){a.graph.exitGroup()});this.addAction("home",function(a){a.graph.home()});this.addAction("selectPrevious",function(a){a.graph.isEnabled()&&a.graph.selectPreviousCell()});this.addAction("selectNext",function(a){a.graph.isEnabled()&&a.graph.selectNextCell()});
this.addAction("selectParent",function(a){a.graph.isEnabled()&&a.graph.selectParentCell()});this.addAction("selectChild",function(a){a.graph.isEnabled()&&a.graph.selectChildCell()});this.addAction("collapse",function(a){a.graph.isEnabled()&&a.graph.foldCells(!0)});this.addAction("collapseAll",function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!0,!1,b)}});this.addAction("expand",function(a){a.graph.isEnabled()&&a.graph.foldCells(!1)});this.addAction("expandAll",
function(a){if(a.graph.isEnabled()){var b=a.graph.getChildVertices();a.graph.foldCells(!1,!1,b)}});this.addAction("bold",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD)});this.addAction("italic",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC)});this.addAction("underline",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE)});
this.addAction("shadow",function(a){a.graph.isEnabled()&&a.graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_SHADOW)});this.addAction("alignCellsLeft",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_LEFT)});this.addAction("alignCellsCenter",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_CENTER)});this.addAction("alignCellsRight",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_RIGHT)});this.addAction("alignCellsTop",
function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_TOP)});this.addAction("alignCellsMiddle",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_MIDDLE)});this.addAction("alignCellsBottom",function(a){a.graph.isEnabled()&&a.graph.alignCells(mxConstants.ALIGN_BOTTOM)});this.addAction("alignFontLeft",function(a){a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT)});this.addAction("alignFontCenter",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_ALIGN,
mxConstants.ALIGN_CENTER)});this.addAction("alignFontRight",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT)});this.addAction("alignFontTop",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_TOP)});this.addAction("alignFontMiddle",function(a){a.graph.isEnabled()&&a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE)});this.addAction("alignFontBottom",function(a){a.graph.isEnabled()&&
a.graph.setCellStyles(mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_BOTTOM)});this.addAction("zoom",function(a){var b=100*a.graph.getView().scale,b=parseFloat(mxUtils.prompt(mxResources.get(a.askZoomResource)||a.askZoomResource,b))/100;isNaN(b)||a.graph.getView().setScale(b)});this.addAction("toggleTasks",function(a){null!=a.tasks?a.tasks.setVisible(!a.tasks.isVisible()):a.showTasks()});this.addAction("toggleHelp",function(a){null!=a.help?a.help.setVisible(!a.help.isVisible()):a.showHelp()});
this.addAction("toggleOutline",function(a){null==a.outline?a.showOutline():a.outline.setVisible(!a.outline.isVisible())});this.addAction("toggleConsole",function(){mxLog.setVisible(!mxLog.isVisible())})};mxEditor.prototype.createSession=function(){return this.connect(this.urlInit,this.urlPoll,this.urlNotify,mxUtils.bind(this,function(a){this.fireEvent(new mxEventObject(mxEvent.SESSION,"session",a))}))};
mxEditor.prototype.configure=function(a){null!=a&&((new mxCodec(a.ownerDocument)).decode(a,this),this.resetHistory())};mxEditor.prototype.resetFirstTime=function(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"};mxEditor.prototype.resetHistory=function(){this.lastSnapshot=(new Date).getTime();this.undoManager.clear();this.ignoredChanges=0;this.setModified(!1)};mxEditor.prototype.addAction=function(a,b){this.actions[a]=b};
mxEditor.prototype.execute=function(a,b,c){var d=this.actions[a];if(null!=d)try{var e=arguments;e[0]=this;d.apply(this,e)}catch(f){throw mxUtils.error("Cannot execute "+a+": "+f.message,280,!0),f;}else mxUtils.error("Cannot find action "+a,280,!0)};mxEditor.prototype.addTemplate=function(a,b){this.templates[a]=b};mxEditor.prototype.getTemplate=function(a){return this.templates[a]};
mxEditor.prototype.createGraph=function(){var a=new mxGraph(null,null,this.graphRenderHint);a.setTooltips(!0);a.setPanning(!0);this.installDblClickHandler(a);this.installUndoHandler(a);this.installDrillHandler(a);this.installChangeHandler(a);this.installInsertHandler(a);a.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(a,c,d){return this.createPopupMenu(a,c,d)});a.connectionHandler.factoryMethod=mxUtils.bind(this,function(a,c){return this.createEdge(a,c)});this.createSwimlaneManager(a);
this.createLayoutManager(a);return a};mxEditor.prototype.createSwimlaneManager=function(a){a=new mxSwimlaneManager(a,!1);a.isHorizontal=mxUtils.bind(this,function(){return this.horizontalFlow});a.isEnabled=mxUtils.bind(this,function(){return this.maintainSwimlanes});return a};
mxEditor.prototype.createLayoutManager=function(a){var b=new mxLayoutManager(a),c=this;b.getLayout=function(b){var e=null,f=c.graph.getModel();if(null!=f.getParent(b))if(c.layoutSwimlanes&&a.isSwimlane(b))null==c.swimlaneLayout&&(c.swimlaneLayout=c.createSwimlaneLayout()),e=c.swimlaneLayout;else if(c.layoutDiagram&&(a.isValidRoot(b)||null==f.getParent(f.getParent(b))))null==c.diagramLayout&&(c.diagramLayout=c.createDiagramLayout()),e=c.diagramLayout;return e};return b};
mxEditor.prototype.setGraphContainer=function(a){null==this.graph.container&&(this.graph.init(a),this.rubberband=new mxRubberband(this.graph),this.disableContextMenu&&mxEvent.disableContextMenu(a),mxClient.IS_QUIRKS&&new mxDivResizer(a))};mxEditor.prototype.installDblClickHandler=function(a){a.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(b,c){var d=c.getProperty("cell");null!=d&&a.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,d),c.consume())}))};
mxEditor.prototype.installUndoHandler=function(a){var b=mxUtils.bind(this,function(a,b){this.undoManager.undoableEditHappened(b.getProperty("edit"))});a.getModel().addListener(mxEvent.UNDO,b);a.getView().addListener(mxEvent.UNDO,b);b=function(b,d){var e=d.getProperty("edit").changes;a.setSelectionCells(a.getSelectionCellsForChanges(e))};this.undoManager.addListener(mxEvent.UNDO,b);this.undoManager.addListener(mxEvent.REDO,b)};
mxEditor.prototype.installDrillHandler=function(a){var b=mxUtils.bind(this,function(){this.fireEvent(new mxEventObject(mxEvent.ROOT))});a.getView().addListener(mxEvent.DOWN,b);a.getView().addListener(mxEvent.UP,b)};
mxEditor.prototype.installChangeHandler=function(a){var b=mxUtils.bind(this,function(b,d){this.setModified(!0);!0==this.validating&&a.validateGraph();for(var e=d.getProperty("edit").changes,f=0;f<e.length;f++){var g=e[f];if(g instanceof mxRootChange||g instanceof mxValueChange&&g.cell==this.graph.model.root||g instanceof mxCellAttributeChange&&g.cell==this.graph.model.root){this.fireEvent(new mxEventObject(mxEvent.ROOT));break}}});a.getModel().addListener(mxEvent.CHANGE,b)};
mxEditor.prototype.installInsertHandler=function(a){var b=this;a.addMouseListener({mouseDown:function(a,d){if(null!=b.insertFunction&&!d.isPopupTrigger()&&(b.forcedInserting||null==d.getState()))b.graph.clearSelection(),b.insertFunction(d.getEvent(),d.getCell()),this.isActive=!0,d.consume()},mouseMove:function(a,b){this.isActive&&b.consume()},mouseUp:function(a,b){this.isActive&&(this.isActive=!1,b.consume())}})};
mxEditor.prototype.createDiagramLayout=function(){var a=this.graph.gridSize,b=new mxStackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*a,2*a);b.isVertexIgnored=function(a){return!b.graph.isSwimlane(a)};return b};mxEditor.prototype.createSwimlaneLayout=function(){return new mxCompactTreeLayout(this.graph,this.horizontalFlow)};mxEditor.prototype.createToolbar=function(){return new mxDefaultToolbar(null,this)};
mxEditor.prototype.setToolbarContainer=function(a){this.toolbar.init(a);mxClient.IS_QUIRKS&&new mxDivResizer(a)};
mxEditor.prototype.setStatusContainer=function(a){null==this.status&&(this.status=a,this.addListener(mxEvent.SAVE,mxUtils.bind(this,function(){var a=(new Date).toLocaleString();this.setStatus((mxResources.get(this.lastSavedResource)||this.lastSavedResource)+": "+a)})),this.addListener(mxEvent.OPEN,mxUtils.bind(this,function(){this.setStatus((mxResources.get(this.currentFileResource)||this.currentFileResource)+": "+this.filename)})),mxClient.IS_QUIRKS&&new mxDivResizer(a))};
mxEditor.prototype.setStatus=function(a){null!=this.status&&null!=a&&(this.status.innerHTML=a)};mxEditor.prototype.setTitleContainer=function(a){this.addListener(mxEvent.ROOT,mxUtils.bind(this,function(){a.innerHTML=this.getTitle()}));mxClient.IS_QUIRKS&&new mxDivResizer(a)};mxEditor.prototype.treeLayout=function(a,b){null!=a&&(new mxCompactTreeLayout(this.graph,b)).execute(a)};
mxEditor.prototype.getTitle=function(){for(var a="",b=this.graph,c=b.getCurrentRoot();null!=c&&null!=b.getModel().getParent(b.getModel().getParent(c));)b.isValidRoot(c)&&(a=" > "+b.convertValueToString(c)+a),c=b.getModel().getParent(c);return this.getRootTitle()+a};mxEditor.prototype.getRootTitle=function(){return this.graph.convertValueToString(this.graph.getModel().getRoot())};mxEditor.prototype.undo=function(){this.undoManager.undo()};mxEditor.prototype.redo=function(){this.undoManager.redo()};
mxEditor.prototype.groupCells=function(){var a=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),a)};mxEditor.prototype.createGroup=function(){return this.graph.getModel().cloneCell(this.defaultGroup)};mxEditor.prototype.open=function(a){null!=a&&(this.readGraphModel(mxUtils.load(a).getXml().documentElement),this.filename=a,this.fireEvent(new mxEventObject(mxEvent.OPEN,"filename",a)))};
mxEditor.prototype.readGraphModel=function(a){(new mxCodec(a.ownerDocument)).decode(a,this.graph.getModel());this.resetHistory()};mxEditor.prototype.save=function(a,b){a=a||this.getUrlPost();if(null!=a&&0<a.length){var c=this.writeGraphModel(b);this.postDiagram(a,c);this.setModified(!1)}this.fireEvent(new mxEventObject(mxEvent.SAVE,"url",a))};
mxEditor.prototype.postDiagram=function(a,b){this.escapePostData&&(b=encodeURIComponent(b));mxUtils.post(a,this.postParameterName+"="+b,mxUtils.bind(this,function(c){this.fireEvent(new mxEventObject(mxEvent.POST,"request",c,"url",a,"data",b))}))};mxEditor.prototype.writeGraphModel=function(a){var a=null!=a?a:this.linefeed,b=(new mxCodec).encode(this.graph.getModel());return mxUtils.getXml(b,a)};mxEditor.prototype.getUrlPost=function(){return this.urlPost};mxEditor.prototype.getUrlImage=function(){return this.urlImage};
mxEditor.prototype.connect=function(a,b,c,d){var e=null;mxClient.IS_LOCAL||(e=new mxSession(this.graph.getModel(),a,b,c),e.addListener(mxEvent.RECEIVE,mxUtils.bind(this,function(a,b){null!=b.getProperty("node").getAttribute("namespace")&&this.resetHistory()})),e.addListener(mxEvent.DISCONNECT,d),e.addListener(mxEvent.CONNECT,d),e.addListener(mxEvent.NOTIFY,d),e.addListener(mxEvent.GET,d),e.start());return e};
mxEditor.prototype.swapStyles=function(a,b){var c=this.graph.getStylesheet().styles[b];this.graph.getView().getStylesheet().putCellStyle(b,this.graph.getStylesheet().styles[a]);this.graph.getStylesheet().putCellStyle(a,c);this.graph.refresh()};
mxEditor.prototype.showProperties=function(a){a=a||this.graph.getSelectionCell();null==a&&(a=this.graph.getCurrentRoot(),null==a&&(a=this.graph.getModel().getRoot()));if(null!=a){this.graph.stopEditing(!0);var b=mxUtils.getOffset(this.graph.container),c=b.x+10,b=b.y;if(null!=this.properties&&!this.movePropertiesDialog)c=this.properties.getX(),b=this.properties.getY();else{var d=this.graph.getCellBounds(a);null!=d&&(c+=d.x+Math.min(200,d.width),b+=d.y)}this.hideProperties();a=this.createProperties(a);
null!=a&&(this.properties=new mxWindow(mxResources.get(this.propertiesResource)||this.propertiesResource,a,c,b,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}};mxEditor.prototype.isPropertiesVisible=function(){return null!=this.properties};
mxEditor.prototype.createProperties=function(a){var b=this.graph.getModel(),c=b.getValue(a);if(mxUtils.isNode(c)){var d=new mxForm("properties");d.addText("ID",a.getId()).setAttribute("readonly","true");var e=null,f=null,g=null,h=null,k=null;b.isVertex(a)&&(e=b.getGeometry(a),null!=e&&(f=d.addText("top",e.y),g=d.addText("left",e.x),h=d.addText("width",e.width),k=d.addText("height",e.height)));for(var l=b.getStyle(a),m=d.addText("Style",l||""),n=c.attributes,o=[],c=0;c<n.length;c++)o[c]=d.addTextarea(n[c].nodeName,
n[c].nodeValue,"label"==n[c].nodeName?4:2);c=mxUtils.bind(this,function(){this.hideProperties();b.beginUpdate();try{null!=e&&(e=e.clone(),e.x=parseFloat(g.value),e.y=parseFloat(f.value),e.width=parseFloat(h.value),e.height=parseFloat(k.value),b.setGeometry(a,e));0<m.value.length?b.setStyle(a,m.value):b.setStyle(a,null);for(var c=0;c<n.length;c++){var d=new mxCellAttributeChange(a,n[c].nodeName,o[c].value);b.execute(d)}this.graph.isAutoSizeCell(a)&&this.graph.updateCellSize(a)}finally{b.endUpdate()}});
l=mxUtils.bind(this,function(){this.hideProperties()});d.addButtons(c,l);return d.table}return null};mxEditor.prototype.hideProperties=function(){null!=this.properties&&(this.properties.destroy(),this.properties=null)};
mxEditor.prototype.showTasks=function(){if(null==this.tasks){var a=document.createElement("div");a.style.padding="4px";a.style.paddingLeft="20px";var b=document.body.clientWidth,b=new mxWindow(mxResources.get(this.tasksResource)||this.tasksResource,a,b-220,this.tasksTop,200);b.setClosable(!0);b.destroyOnClose=!1;var c=mxUtils.bind(this,function(){mxEvent.release(a);a.innerHTML="";this.createTasks(a)});this.graph.getModel().addListener(mxEvent.CHANGE,c);this.graph.getSelectionModel().addListener(mxEvent.CHANGE,
c);this.graph.addListener(mxEvent.ROOT,c);null!=this.tasksWindowImage&&b.setImage(this.tasksWindowImage);this.tasks=b;this.createTasks(a)}this.tasks.setVisible(!0)};mxEditor.prototype.refreshTasks=function(a){null!=this.tasks&&(a=this.tasks.content,mxEvent.release(a),a.innerHTML="",this.createTasks(a))};mxEditor.prototype.createTasks=function(){};
mxEditor.prototype.showHelp=function(a){if(null==this.help){var b=document.createElement("iframe");b.setAttribute("src",mxResources.get("urlHelp")||this.urlHelp);b.setAttribute("height","100%");b.setAttribute("width","100%");b.setAttribute("frameBorder","0");b.style.backgroundColor="white";var a=document.body.clientWidth,c=document.body.clientHeight||document.documentElement.clientHeight,d=new mxWindow(mxResources.get(this.helpResource)||this.helpResource,b,(a-this.helpWidth)/2,(c-this.helpHeight)/
3,this.helpWidth,this.helpHeight);d.setMaximizable(!0);d.setClosable(!0);d.destroyOnClose=!1;d.setResizable(!0);null!=this.helpWindowImage&&d.setImage(this.helpWindowImage);mxClient.IS_NS&&(a=function(){b.setAttribute("height",d.div.offsetHeight-26+"px")},d.addListener(mxEvent.RESIZE_END,a),d.addListener(mxEvent.MAXIMIZE,a),d.addListener(mxEvent.NORMALIZE,a),d.addListener(mxEvent.SHOW,a));this.help=d}this.help.setVisible(!0)};
mxEditor.prototype.showOutline=function(){if(null==this.outline){var a=document.createElement("div");a.style.overflow="hidden";a.style.position="relative";a.style.width="100%";a.style.height="100%";a.style.background="white";a.style.cursor="move";8==document.documentMode&&(a.style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=100)");var b=new mxWindow(mxResources.get(this.outlineResource)||this.outlineResource,a,600,480,200,200,!1),c=new mxOutline(this.graph,a);b.setClosable(!0);b.setResizable(!0);
b.destroyOnClose=!1;b.addListener(mxEvent.RESIZE_END,function(){c.update()});this.outline=b;this.outline.outline=c}this.outline.setVisible(!0);this.outline.outline.update(!0)};mxEditor.prototype.setMode=function(a){"select"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!1)):"connect"==a?(this.graph.panningHandler.useLeftButtonForPanning=!1,this.graph.setConnectable(!0)):"pan"==a&&(this.graph.panningHandler.useLeftButtonForPanning=!0,this.graph.setConnectable(!1))};
mxEditor.prototype.createPopupMenu=function(a,b,c){this.popupHandler.createMenu(this,a,b,c)};mxEditor.prototype.createEdge=function(){var a=null;if(null!=this.defaultEdge)a=this.graph.getModel().cloneCell(this.defaultEdge);else{a=new mxCell("");a.setEdge(!0);var b=new mxGeometry;b.relative=!0;a.setGeometry(b)}b=this.getEdgeStyle();null!=b&&a.setStyle(b);return a};mxEditor.prototype.getEdgeStyle=function(){return this.defaultEdgeStyle};
mxEditor.prototype.consumeCycleAttribute=function(a){return null!=this.cycleAttributeValues&&0<this.cycleAttributeValues.length&&this.graph.isSwimlane(a)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null};mxEditor.prototype.cycleAttribute=function(a){if(null!=this.cycleAttributeName){var b=this.consumeCycleAttribute(a);null!=b&&a.setStyle(a.getStyle()+";"+this.cycleAttributeName+"="+b)}};
mxEditor.prototype.addVertex=function(a,b,c,d){for(var e=this.graph.getModel();null!=a&&!this.graph.isValidDropTarget(a);)a=e.getParent(a);var a=null!=a?a:this.graph.getSwimlaneAt(c,d),f=this.graph.getView().scale,g=e.getGeometry(b),h=e.getGeometry(a);if(this.graph.isSwimlane(b)&&!this.graph.swimlaneNesting)a=null;else{if(null==a&&this.swimlaneRequired)return null;if(null!=a&&null!=h){var k=this.graph.getView().getState(a);if(null!=k){if(c-=k.origin.x*f,d-=k.origin.y*f,this.graph.isConstrainedMoving){var h=
g.width,l=g.height,m=k.x+k.width;c+h>m&&(c-=c+h-m);m=k.y+k.height;d+l>m&&(d-=d+l-m)}}else null!=h&&(c-=h.x*f,d-=h.y*f)}}g=g.clone();g.x=this.graph.snap(c/f-this.graph.getView().translate.x-this.graph.gridSize/2);g.y=this.graph.snap(d/f-this.graph.getView().translate.y-this.graph.gridSize/2);b.setGeometry(g);null==a&&(a=this.graph.getDefaultParent());this.cycleAttribute(b);this.fireEvent(new mxEventObject(mxEvent.BEFORE_ADD_VERTEX,"vertex",b,"parent",a));e.beginUpdate();try{b=this.graph.addCell(b,
a),null!=b&&(this.graph.constrainChild(b),this.fireEvent(new mxEventObject(mxEvent.ADD_VERTEX,"vertex",b)))}finally{e.endUpdate()}null!=b&&(this.graph.setSelectionCell(b),this.graph.scrollCellToVisible(b),this.fireEvent(new mxEventObject(mxEvent.AFTER_ADD_VERTEX,"vertex",b)));return b};
mxEditor.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.destroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.templates=this.status=null)};
var mxCodecRegistry={codecs:[],aliases:[],register:function(a){if(null!=a){var b=a.getName();mxCodecRegistry.codecs[b]=a;var c=mxUtils.getFunctionName(a.template.constructor);c!=b&&mxCodecRegistry.addAlias(c,b)}return a},addAlias:function(a,b){mxCodecRegistry.aliases[a]=b},getCodec:function(a){var b=null;if(null!=a){var b=mxUtils.getFunctionName(a),c=mxCodecRegistry.aliases[b];null!=c&&(b=c);b=mxCodecRegistry.codecs[b];if(null==b)try{b=new mxObjectCodec(new a),mxCodecRegistry.register(b)}catch(d){}}return b}};
function mxCodec(a){this.document=a||mxUtils.createXmlDocument();this.objects=[]}mxCodec.prototype.document=null;mxCodec.prototype.objects=null;mxCodec.prototype.encodeDefaults=!1;mxCodec.prototype.putObject=function(a,b){return this.objects[a]=b};mxCodec.prototype.getObject=function(a){var b=null;null!=a&&(b=this.objects[a],null==b&&(b=this.lookup(a),null==b&&(a=this.getElementById(a),null!=a&&(b=this.decode(a)))));return b};mxCodec.prototype.lookup=function(){return null};
mxCodec.prototype.getElementById=function(a,b){return mxUtils.findNodeByAttribute(this.document.documentElement,null!=b?b:"id",a)};mxCodec.prototype.getId=function(a){var b=null;null!=a&&(b=this.reference(a),null==b&&a instanceof mxCell&&(b=a.getId(),null==b&&(b=mxCellPath.create(a),0==b.length&&(b="root"))));return b};mxCodec.prototype.reference=function(){return null};
mxCodec.prototype.encode=function(a){var b=null;if(null!=a&&null!=a.constructor){var c=mxCodecRegistry.getCodec(a.constructor);null!=c?b=c.encode(this,a):mxUtils.isNode(a)?b=mxClient.IS_IE?a.cloneNode(!0):this.document.importNode(a,!0):mxLog.warn("mxCodec.encode: No codec for "+mxUtils.getFunctionName(a.constructor))}return b};
mxCodec.prototype.decode=function(a,b){var c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){var d=null;try{d=eval(a.nodeName)}catch(e){}try{var f=mxCodecRegistry.getCodec(d);null!=f?c=f.decode(this,a,b):(c=a.cloneNode(!0),c.removeAttribute("as"))}catch(g){mxLog.debug("Cannot decode "+a.nodeName+": "+g.message)}}return c};mxCodec.prototype.encodeCell=function(a,b,c){b.appendChild(this.encode(a));if(null==c||c)for(var c=a.getChildCount(),d=0;d<c;d++)this.encodeCell(a.getChildAt(d),b)};
mxCodec.prototype.isCellCodec=function(a){return null!=a&&"function"==typeof a.isCellCodec?a.isCellCodec():!1};mxCodec.prototype.decodeCell=function(a,b){var b=null!=b?b:!0,c=null;if(null!=a&&a.nodeType==mxConstants.NODETYPE_ELEMENT){c=mxCodecRegistry.getCodec(a.nodeName);if(!this.isCellCodec(c))for(var d=a.firstChild;null!=d&&!this.isCellCodec(c);)c=mxCodecRegistry.getCodec(d.nodeName),d=d.nextSibling;this.isCellCodec(c)||(c=mxCodecRegistry.getCodec(mxCell));c=c.decode(this,a);b&&this.insertIntoGraph(c)}return c};
mxCodec.prototype.insertIntoGraph=function(a){var b=a.parent,c=a.getTerminal(!0),d=a.getTerminal(!1);a.setTerminal(null,!1);a.setTerminal(null,!0);a.parent=null;null!=b&&b.insert(a);null!=c&&c.insertEdge(a,!0);null!=d&&d.insertEdge(a,!1)};mxCodec.prototype.setAttribute=function(a,b,c){null!=b&&null!=c&&a.setAttribute(b,c)};
function mxObjectCodec(a,b,c,d){this.template=a;this.exclude=null!=b?b:[];this.idrefs=null!=c?c:[];this.mapping=null!=d?d:[];this.reverse={};for(var e in this.mapping)this.reverse[this.mapping[e]]=e}mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};
mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor};mxObjectCodec.prototype.getFieldName=function(a){if(null!=a){var b=this.reverse[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.getAttributeName=function(a){if(null!=a){var b=this.mapping[a];null!=b&&(a=b)}return a};mxObjectCodec.prototype.isExcluded=function(a,b){return b==mxObjectIdentity.FIELD_NAME||0<=mxUtils.indexOf(this.exclude,b)};
mxObjectCodec.prototype.isReference=function(a,b){return 0<=mxUtils.indexOf(this.idrefs,b)};mxObjectCodec.prototype.encode=function(a,b){var c=a.document.createElement(this.getName()),b=this.beforeEncode(a,b,c);this.encodeObject(a,b,c);return this.afterEncode(a,b,c)};mxObjectCodec.prototype.encodeObject=function(a,b,c){a.setAttribute(c,"id",a.getId(b));for(var d in b){var e=d,f=b[e];null!=f&&!this.isExcluded(b,e,f,!0)&&(mxUtils.isNumeric(e)&&(e=null),this.encodeValue(a,b,e,f,c))}};
mxObjectCodec.prototype.encodeValue=function(a,b,c,d,e){if(null!=d){if(this.isReference(b,c,d,!0)){var f=a.getId(d);if(null==f){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+c+"="+d);return}d=f}f=this.template[c];if(null==c||a.encodeDefaults||f!=d)c=this.getAttributeName(c),this.writeAttribute(a,b,c,d,e)}};mxObjectCodec.prototype.writeAttribute=function(a,b,c,d,e){"object"!=typeof d?this.writePrimitiveAttribute(a,b,c,d,e):this.writeComplexAttribute(a,b,c,d,e)};
mxObjectCodec.prototype.writePrimitiveAttribute=function(a,b,c,d,e){d=this.convertValueToXml(d);null==c?(b=a.document.createElement("add"),"function"==typeof d?b.appendChild(a.document.createTextNode(d)):a.setAttribute(b,"value",d),e.appendChild(b)):"function"!=typeof d&&a.setAttribute(e,c,d)};
mxObjectCodec.prototype.writeComplexAttribute=function(a,b,c,d,e){a=a.encode(d);null!=a?(null!=c&&a.setAttribute("as",c),e.appendChild(a)):mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+c+": "+d)};mxObjectCodec.prototype.convertValueToXml=function(a){if("undefined"==typeof a.length&&(!0==a||!1==a))a=!0==a?"1":"0";return a};mxObjectCodec.prototype.convertValueFromXml=function(a){mxUtils.isNumeric(a)&&(a=parseFloat(a));return a};mxObjectCodec.prototype.beforeEncode=function(a,b){return b};
mxObjectCodec.prototype.afterEncode=function(a,b,c){return c};mxObjectCodec.prototype.decode=function(a,b,c){var d=b.getAttribute("id"),e=a.objects[d];null==e&&(e=c||this.cloneTemplate(),null!=d&&a.putObject(d,e));b=this.beforeDecode(a,b,e);this.decodeNode(a,b,e);return this.afterDecode(a,b,e)};mxObjectCodec.prototype.decodeNode=function(a,b,c){null!=b&&(this.decodeAttributes(a,b,c),this.decodeChildren(a,b,c))};
mxObjectCodec.prototype.decodeAttributes=function(a,b,c){b=b.attributes;if(null!=b)for(var d=0;d<b.length;d++)this.decodeAttribute(a,b[d],c)};mxObjectCodec.prototype.decodeAttribute=function(a,b,c){var d=b.nodeName;if("as"!=d&&"id"!=d){var b=this.convertValueFromXml(b.nodeValue),e=this.getFieldName(d);if(this.isReference(c,e,b,!1)){a=a.getObject(b);if(null==a){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+d+"="+b);return}b=a}this.isExcluded(c,d,b,!1)||(c[d]=b)}};
mxObjectCodec.prototype.decodeChildren=function(a,b,c){for(b=b.firstChild;null!=b;){var d=b.nextSibling;b.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,b,c)&&this.decodeChild(a,b,c);b=d}};
mxObjectCodec.prototype.decodeChild=function(a,b,c){var d=this.getFieldName(b.getAttribute("as"));if(null==d||!this.isExcluded(c,d,b,!1)){var e=this.getFieldTemplate(c,d,b),f=null;"add"==b.nodeName?(f=b.getAttribute("value"),null==f&&(f=mxUtils.eval(mxUtils.getTextContent(b)))):f=a.decode(b,e);this.addObjectValue(c,d,f,e)}};mxObjectCodec.prototype.getFieldTemplate=function(a,b){a=a[b];a instanceof Array&&0<a.length&&(a=null);return a};
mxObjectCodec.prototype.addObjectValue=function(a,b,c,d){null!=c&&c!=d&&(null!=b&&0<b.length?a[b]=c:a.push(c))};mxObjectCodec.prototype.processInclude=function(a,b,c){if("include"==b.nodeName){b=b.getAttribute("name");if(null!=b)try{var d=mxUtils.load(b).getDocumentElement();null!=d&&a.decode(d,c)}catch(e){}return!0}return!1};mxObjectCodec.prototype.beforeDecode=function(a,b){return b};mxObjectCodec.prototype.afterDecode=function(a,b,c){return c};
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxCell,["children","edges","overlays","mxTransient"],["parent","source","target"]);a.isCellCodec=function(){return!0};a.isExcluded=function(a,c,d,e){return mxObjectCodec.prototype.isExcluded.apply(this,arguments)||e&&"value"==c&&d.nodeType==mxConstants.NODETYPE_ELEMENT};a.afterEncode=function(a,c,d){if(null!=c.value&&c.value.nodeType==mxConstants.NODETYPE_ELEMENT){var e=d,d=mxClient.IS_IE?c.value.cloneNode(!0):a.document.importNode(c.value,
!0);d.appendChild(e);a=e.getAttribute("id");d.setAttribute("id",a);e.removeAttribute("id")}return d};a.beforeDecode=function(a,c,d){var e=c,f=this.getName();c.nodeName!=f?(e=c.getElementsByTagName(f)[0],null!=e&&e.parentNode==c?(mxUtils.removeWhitespace(e,!0),mxUtils.removeWhitespace(e,!1),e.parentNode.removeChild(e)):e=null,d.value=c.cloneNode(!0),c=d.value.getAttribute("id"),null!=c&&(d.setId(c),d.value.removeAttribute("id"))):d.setId(c.getAttribute("id"));if(null!=e)for(c=0;c<this.idrefs.length;c++){var f=
this.idrefs[c],g=e.getAttribute(f);if(null!=g){e.removeAttribute(f);var h=a.objects[g]||a.lookup(g);null==h&&(g=a.getElementById(g),null!=g&&(h=(mxCodecRegistry.codecs[g.nodeName]||this).decode(a,g)));d[f]=h}}return e};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphModel);a.encodeObject=function(a,c,d){var e=a.document.createElement("root");a.encodeCell(c.getRoot(),e);d.appendChild(e)};a.decodeChild=function(a,c,d){"root"==c.nodeName?this.decodeRoot(a,c,d):mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeRoot=function(a,c,d){for(var e=null,c=c.firstChild;null!=c;){var f=a.decodeCell(c);null!=f&&null==f.getParent()&&(e=f);c=c.nextSibling}null!=e&&d.setRoot(e)};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxRootChange,["model","previous","root"]);a.afterEncode=function(a,c,d){a.encodeCell(c.root,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var c=c.cloneNode(!0),e=c.firstChild;d.root=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;)d=e.nextSibling,a.decodeCell(e),e.parentNode.removeChild(e),e=d}return c};a.afterDecode=function(a,c,
d){d.previous=d.root;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxChildChange,["model","child","previousIndex"],["parent","previous"]);a.isReference=function(a,c,d,e){return"child"==c&&(null!=a.previous||!e)?!0:0<=mxUtils.indexOf(this.idrefs,c)};a.afterEncode=function(a,c,d){this.isReference(c,"child",c.child,!0)?d.setAttribute("child",a.getId(c.child)):a.encodeCell(c.child,d);return d};a.beforeDecode=function(a,c,d){if(null!=c.firstChild&&c.firstChild.nodeType==mxConstants.NODETYPE_ELEMENT){var c=
c.cloneNode(!0),e=c.firstChild;d.child=a.decodeCell(e,!1);d=e.nextSibling;e.parentNode.removeChild(e);for(e=d;null!=e;){d=e.nextSibling;if(e.nodeType==mxConstants.NODETYPE_ELEMENT){var f=e.getAttribute("id");null==a.lookup(f)&&a.decodeCell(e)}e.parentNode.removeChild(e);e=d}}else e=c.getAttribute("child"),d.child=a.getObject(e);return c};a.afterDecode=function(a,c,d){d.child.parent=d.previous;d.previous=d.parent;d.previousIndex=d.index;return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxTerminalChange,["model","previous"],["cell","terminal"]);a.afterDecode=function(a,c,d){d.previous=d.terminal;return d};return a}());var mxGenericChangeCodec=function(a,b){var c=new mxObjectCodec(a,["model","previous"],["cell"]);c.afterDecode=function(a,c,f){mxUtils.isNode(f.cell)&&(f.cell=a.decodeCell(f.cell,!1));f.previous=f[b];return f};return c};mxCodecRegistry.register(mxGenericChangeCodec(new mxValueChange,"value"));
mxCodecRegistry.register(mxGenericChangeCodec(new mxStyleChange,"style"));mxCodecRegistry.register(mxGenericChangeCodec(new mxGeometryChange,"geometry"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCollapseChange,"collapsed"));mxCodecRegistry.register(mxGenericChangeCodec(new mxVisibleChange,"visible"));mxCodecRegistry.register(mxGenericChangeCodec(new mxCellAttributeChange,"value"));mxCodecRegistry.register(function(){return new mxObjectCodec(new mxGraph,"graphListeners,eventListeners,view,container,cellRenderer,editor,selection".split(","))}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxGraphView);a.encode=function(a,c){return this.encodeCell(a,c,c.graph.getModel().getRoot())};a.encodeCell=function(a,c,d){var e=c.graph.getModel(),f=c.getState(d),g=e.getParent(d);if(null==g||null!=f){var h=e.getChildCount(d),k=c.graph.getCellGeometry(d),l=null;g==e.getRoot()?l="layer":null==g?l="graph":e.isEdge(d)?l="edge":0<h&&null!=k?l="group":e.isVertex(d)&&(l="vertex");if(null!=l){var m=a.document.createElement(l);null!=c.graph.getLabel(d)&&
(m.setAttribute("label",c.graph.getLabel(d)),c.graph.isHtmlLabel(d)&&m.setAttribute("html",!0));if(null==g){var n=c.getGraphBounds();null!=n&&(m.setAttribute("x",Math.round(n.x)),m.setAttribute("y",Math.round(n.y)),m.setAttribute("width",Math.round(n.width)),m.setAttribute("height",Math.round(n.height)));m.setAttribute("scale",c.scale)}else if(null!=f&&null!=k){for(n in f.style)g=f.style[n],"function"==typeof g&&"object"==typeof g&&(g=mxStyleRegistry.getName(g)),null!=g&&"function"!=typeof g&&"object"!=
typeof g&&m.setAttribute(n,g);g=f.absolutePoints;if(null!=g&&0<g.length){k=Math.round(g[0].x)+","+Math.round(g[0].y);for(n=1;n<g.length;n++)k+=" "+Math.round(g[n].x)+","+Math.round(g[n].y);m.setAttribute("points",k)}else m.setAttribute("x",Math.round(f.x)),m.setAttribute("y",Math.round(f.y)),m.setAttribute("width",Math.round(f.width)),m.setAttribute("height",Math.round(f.height));n=f.absoluteOffset;null!=n&&(0!=n.x&&m.setAttribute("dx",Math.round(n.x)),0!=n.y&&m.setAttribute("dy",Math.round(n.y)))}for(n=
0;n<h;n++)f=this.encodeCell(a,c,e.getChildAt(d,n)),null!=f&&m.appendChild(f)}}return m};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxStylesheet);a.encode=function(a,c){var d=a.document.createElement(this.getName()),e;for(e in c.styles){var f=c.styles[e],g=a.document.createElement("add");if(null!=e){g.setAttribute("as",e);for(var h in f){var k=this.getStringValue(h,f[h]);if(null!=k){var l=a.document.createElement("add");l.setAttribute("value",k);l.setAttribute("as",h);g.appendChild(l)}}0<g.childNodes.length&&d.appendChild(g)}}return d};a.getStringValue=function(a,
c){var d=typeof c;"function"==d?c=mxStyleRegistry.getName(style[j]):"object"==d&&(c=null);return c};a.decode=function(a,c,d){var d=d||new this.template.constructor,e=c.getAttribute("id");null!=e&&(a.objects[e]=d);for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName&&(e=c.getAttribute("as"),null!=e)){var f=c.getAttribute("extend"),g=null!=f?mxUtils.clone(d.styles[f]):null;null==g&&(null!=f&&mxLog.warn("mxStylesheetCodec.decode: stylesheet "+f+" not found to extend"),g={});
for(f=c.firstChild;null!=f;){if(f.nodeType==mxConstants.NODETYPE_ELEMENT){var h=f.getAttribute("as");if("add"==f.nodeName){var k=mxUtils.getTextContent(f),l=null;null!=k&&0<k.length?l=mxUtils.eval(k):(l=f.getAttribute("value"),mxUtils.isNumeric(l)&&(l=parseFloat(l)));null!=l&&(g[h]=l)}else"remove"==f.nodeName&&delete g[h]}f=f.nextSibling}d.putCellStyle(e,g)}c=c.nextSibling}return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultKeyHandler);a.encode=function(){return null};a.decode=function(a,c,d){if(null!=d)for(c=c.firstChild;null!=c;){if(!this.processInclude(a,c,d)&&"add"==c.nodeName){var e=c.getAttribute("as"),f=c.getAttribute("action"),g=c.getAttribute("control");d.bindAction(e,f,g)}c=c.nextSibling}return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultToolbar);a.encode=function(){return null};a.decode=function(a,c,d){if(null!=d)for(var e=d.editor,c=c.firstChild;null!=c;){if(c.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(a,c,d))if("separator"==c.nodeName)d.addSeparator();else if("br"==c.nodeName)d.toolbar.addBreak();else if("hr"==c.nodeName)d.toolbar.addLine();else if("add"==c.nodeName){var f=c.getAttribute("as"),f=mxResources.get(f)||f,g=c.getAttribute("icon"),
h=c.getAttribute("pressedIcon"),k=c.getAttribute("action"),l=c.getAttribute("mode"),m=c.getAttribute("template"),n="0"!=c.getAttribute("toggle"),o=mxUtils.getTextContent(c),q=null;if(null!=k)q=d.addItem(f,g,k,h);else if(null!=l)var r=mxUtils.eval(o),q=d.addMode(f,g,l,h,r);else if(null!=m||null!=o&&0<o.length)q=e.templates[m],m=c.getAttribute("style"),null!=q&&null!=m&&(q=q.clone(),q.setStyle(m)),m=null,null!=o&&0<o.length&&(m=mxUtils.eval(o)),q=d.addPrototype(f,g,q,h,m,n);else if(h=mxUtils.getChildNodes(c),
0<h.length)if(null==g){m=d.addActionCombo(f);for(f=0;f<h.length;f++)n=h[f],"separator"==n.nodeName?d.addOption(m,"---"):"add"==n.nodeName&&(g=n.getAttribute("as"),n=n.getAttribute("action"),d.addActionOption(m,g,n))}else{var u=null,w=d.addPrototype(f,g,function(){var a=e.templates[u.value];if(null!=a){var a=a.clone(),b=u.options[u.selectedIndex].cellStyle;null!=b&&a.setStyle(b);return a}mxLog.warn("Template "+a+" not found");return null},null,null,n),u=d.addCombo();mxEvent.addListener(u,"change",
function(){d.toolbar.selectMode(w,function(a){a=mxUtils.convertPoint(e.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));return e.addVertex(null,r(),a.x,a.y)});d.toolbar.noReset=!1});for(f=0;f<h.length;f++)n=h[f],"separator"==n.nodeName?d.addOption(u,"---"):"add"==n.nodeName&&(g=n.getAttribute("as"),o=n.getAttribute("template"),d.addOption(u,g,o||m).cellStyle=n.getAttribute("style"))}null!=q&&(m=c.getAttribute("id"),null!=m&&0<m.length&&q.setAttribute("id",m))}c=c.nextSibling}return d};
return a}());mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxDefaultPopupMenu);a.encode=function(){return null};a.decode=function(a,c,d){var e=c.getElementsByTagName("include")[0];null!=e?this.processInclude(a,e,d):null!=d&&(d.config=c);return d};return a}());
mxCodecRegistry.register(function(){var a=new mxObjectCodec(new mxEditor,"modified,lastSnapshot,ignoredChanges,undoManager,graphContainer,toolbarContainer".split(","));a.afterDecode=function(a,c,d){a=c.getAttribute("defaultEdge");null!=a&&(c.removeAttribute("defaultEdge"),d.defaultEdge=d.templates[a]);a=c.getAttribute("defaultGroup");null!=a&&(c.removeAttribute("defaultGroup"),d.defaultGroup=d.templates[a]);return d};a.decodeChild=function(a,c,d){if("Array"==c.nodeName){if("templates"==c.getAttribute("as")){this.decodeTemplates(a,
c,d);return}}else if("ui"==c.nodeName){this.decodeUi(a,c,d);return}mxObjectCodec.prototype.decodeChild.apply(this,arguments)};a.decodeUi=function(a,c,d){for(a=c.firstChild;null!=a;){if("add"==a.nodeName){var c=a.getAttribute("as"),e=a.getAttribute("element"),f=a.getAttribute("style"),g=null;if(null!=e)g=document.getElementById(e),null!=g&&null!=f&&(g.style.cssText+=";"+f);else{var e=parseInt(a.getAttribute("x")),h=parseInt(a.getAttribute("y")),k=a.getAttribute("width"),l=a.getAttribute("height"),
g=document.createElement("div");g.style.cssText=f;(new mxWindow(mxResources.get(c)||c,g,e,h,k,l,!1,!0)).setVisible(!0)}"graph"==c?d.setGraphContainer(g):"toolbar"==c?d.setToolbarContainer(g):"title"==c?d.setTitleContainer(g):"status"==c?d.setStatusContainer(g):"map"==c&&d.setMapContainer(g)}else"resource"==a.nodeName?mxResources.add(a.getAttribute("basename")):"stylesheet"==a.nodeName&&mxClient.link("stylesheet",a.getAttribute("name"));a=a.nextSibling}};a.decodeTemplates=function(a,c,d){null==d.templates&&
(d.templates=[]);for(var c=mxUtils.getChildNodes(c),e=0;e<c.length;e++){for(var f=c[e].getAttribute("as"),g=c[e].firstChild;null!=g&&1!=g.nodeType;)g=g.nextSibling;null!=g&&(d.templates[f]=a.decodeCell(g))}};return a}());var CSS_PROP_BIT_QUANTITY=1,CSS_PROP_BIT_HASH_VALUE=2,CSS_PROP_BIT_NEGATIVE_QUANTITY=4,CSS_PROP_BIT_QSTRING_CONTENT=8,CSS_PROP_BIT_QSTRING_URL=16,CSS_PROP_BIT_HISTORY_INSENSITIVE=32,CSS_PROP_BIT_Z_INDEX=64,CSS_PROP_BIT_ALLOWED_IN_LINK=128,cssSchema=function(){var a=["rgb(?:\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)|a\\(\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0|\\d+(?:\\.\\d+)?%)\\s*,\\s*(?:\\d+|0(?:\\.\\d+)?|\\.\\d+|1(?:\\.0+)?|0|\\d+(?:\\.\\d+)?%)) *\\)"],
b=[/^ *$/i,RegExp("^ *(?:\\s*"+a[0]+"|(?:\\s*"+a[0]+")?)+ *$","i"),RegExp("^ *\\s*"+a[0]+" *$","i"),RegExp("^ *\\s*"+a[0]+"\\s*"+a[0]+" *$","i")],c=["aliceblue,antiquewhite,aqua,aquamarine,azure,beige,bisque,black,blanchedalmond,blue,blueviolet,brown,burlywood,cadetblue,chartreuse,chocolate,coral,cornflowerblue,cornsilk,crimson,cyan,darkblue,darkcyan,darkgoldenrod,darkgray,darkgreen,darkkhaki,darkmagenta,darkolivegreen,darkorange,darkorchid,darkred,darksalmon,darkseagreen,darkslateblue,darkslategray,darkturquoise,darkviolet,deeppink,deepskyblue,dimgray,dodgerblue,firebrick,floralwhite,forestgreen,fuchsia,gainsboro,ghostwhite,gold,goldenrod,gray,green,greenyellow,honeydew,hotpink,indianred,indigo,ivory,khaki,lavender,lavenderblush,lawngreen,lemonchiffon,lightblue,lightcoral,lightcyan,lightgoldenrodyellow,lightgreen,lightgrey,lightpink,lightsalmon,lightseagreen,lightskyblue,lightslategray,lightsteelblue,lightyellow,lime,limegreen,linen,magenta,maroon,mediumaquamarine,mediumblue,mediumorchid,mediumpurple,mediumseagreen,mediumslateblue,mediumspringgreen,mediumturquoise,mediumvioletred,midnightblue,mintcream,mistyrose,moccasin,navajowhite,navy,oldlace,olive,olivedrab,orange,orangered,orchid,palegoldenrod,palegreen,paleturquoise,palevioletred,papayawhip,peachpuff,peru,pink,plum,powderblue,purple,red,rosybrown,royalblue,saddlebrown,salmon,sandybrown,seagreen,seashell,sienna,silver,skyblue,slateblue,slategray,snow,springgreen,steelblue,tan,teal,thistle,tomato,turquoise,violet,wheat,white,whitesmoke,yellow,yellowgreen".split(","),
"all-scroll,col-resize,crosshair,default,e-resize,hand,help,move,n-resize,ne-resize,no-drop,not-allowed,nw-resize,pointer,progress,row-resize,s-resize,se-resize,sw-resize,text,vertical-text,w-resize,wait".split(","),"-moz-inline-box,-moz-inline-stack,block,inline,inline-block,inline-table,list-item,run-in,table,table-caption,table-cell,table-column,table-column-group,table-footer-group,table-header-group,table-row,table-row-group".split(","),"armenian,circle,decimal,decimal-leading-zero,disc,georgian,lower-alpha,lower-greek,lower-latin,lower-roman,square,upper-alpha,upper-latin,upper-roman".split(","),
"100,200,300,400,500,600,700,800,900,bold,bolder,lighter".split(","),"condensed,expanded,extra-condensed,extra-expanded,narrower,semi-condensed,semi-expanded,ultra-condensed,ultra-expanded,wider".split(","),"behind,center-left,center-right,far-left,far-right,left-side,leftwards,right-side,rightwards".split(","),"large,larger,small,smaller,x-large,x-small,xx-large,xx-small".split(","),"-moz-pre-wrap,-o-pre-wrap,-pre-wrap,nowrap,pre,pre-line,pre-wrap".split(","),"dashed,dotted,double,groove,outset,ridge,solid".split(","),
"baseline,middle,sub,super,text-bottom,text-top".split(","),"caption,icon,menu,message-box,small-caption,status-bar".split(","),"fast,faster,slow,slower,x-fast,x-slow".split(","),["above","below","higher","level","lower"],["border-box","contain","content-box","cover","padding-box"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["high","low","x-high",
"x-low"],["absolute","relative","static"],["capitalize","lowercase","uppercase"],["child","female","male"],["bidi-override","embed"],["bottom","top"],["clip","ellipsis"],["continuous","digits"],["hide","show"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["code"],["collapse"],["fixed"],["hidden"],["inherit"],["inset"],["invert"],
["justify"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["transparent"],["visible"]];return{"-moz-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-moz-border-radius-bottomleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-bottomright":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topleft":{cssExtra:b[0],cssPropBits:5},"-moz-border-radius-topright":{cssExtra:b[0],cssPropBits:5},"-moz-box-shadow":{cssExtra:b[1],
cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"-moz-opacity":{cssPropBits:1,cssLitGroup:[c[47]]},"-moz-outline":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"-moz-outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[49]]},"-moz-outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"-moz-outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"-o-text-overflow":{cssPropBits:0,
cssLitGroup:[c[25]]},"-webkit-border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"-webkit-border-radius-bottom-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-bottom-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-left":{cssExtra:b[0],cssPropBits:5},"-webkit-border-radius-top-right":{cssExtra:b[0],cssPropBits:5},"-webkit-border-top-left-radius":{cssExtra:b[0],
cssPropBits:5},"-webkit-border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"-webkit-box-shadow":{cssExtra:b[1],cssAlternates:["boxShadow"],cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},azimuth:{cssPropBits:5,cssLitGroup:[c[6],c[30],c[42],c[47]]},background:{cssExtra:RegExp("^ *(?:\\s*"+a[0]+"){0,2} *$","i"),cssPropBits:23,cssLitGroup:[c[0],c[14],c[17],c[24],c[30],c[35],c[36],c[38],c[42],c[45],c[47],c[51],c[54],c[57],c[58],c[62]]},"background-attachment":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[35],
c[45],c[51],c[58]]},"background-color":{cssExtra:b[2],cssPropBits:130,cssLitGroup:[c[0],c[47],c[62]]},"background-image":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[35],c[54]]},"background-position":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[24],c[30],c[35],c[42]]},"background-repeat":{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[17],c[35],c[57]]},border:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-bottom-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-bottom-left-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-right-radius":{cssExtra:b[0],cssPropBits:5},"border-bottom-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-collapse":{cssPropBits:0,cssLitGroup:[c[44],c[47],c[59]]},"border-color":{cssExtra:RegExp("^ *(?:\\s*"+
a[0]+"){1,4} *$","i"),cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-left-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-left-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-left-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-radius":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[36]]},"border-right":{cssExtra:b[3],
cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-right-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-right-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-right-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-spacing":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47]]},"border-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top":{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],
c[9],c[34],c[46],c[47],c[48],c[52],c[54],c[62]]},"border-top-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],c[62]]},"border-top-left-radius":{cssExtra:b[0],cssPropBits:5},"border-top-right-radius":{cssExtra:b[0],cssPropBits:5},"border-top-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"border-top-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},"border-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},bottom:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"box-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"caption-side":{cssPropBits:0,cssLitGroup:[c[24],c[47]]},clear:{cssPropBits:0,cssLitGroup:[c[30],c[40],c[47],c[54]]},clip:{cssExtra:/^ *\s*rect\(\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto)\s*,\s*(?:0|[+\-]?\d+(?:\.\d+)?(?:[cem]m|ex|in|p[ctx])|auto) *\) *$/i,cssPropBits:0,cssLitGroup:[c[38],c[47]]},color:{cssExtra:b[2],
cssPropBits:130,cssLitGroup:[c[0],c[47]]},content:{cssPropBits:0},"counter-increment":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},"counter-reset":{cssExtra:b[0],cssPropBits:5,cssLitGroup:[c[47],c[54]]},cue:{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-after":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"cue-before":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},cursor:{cssExtra:b[0],cssPropBits:144,cssLitGroup:[c[1],c[35],c[38],c[47]]},direction:{cssPropBits:0,cssLitGroup:[c[31],c[47]]},display:{cssPropBits:32,
cssLitGroup:[c[2],c[47],c[54]]},elevation:{cssPropBits:5,cssLitGroup:[c[13],c[47]]},"empty-cells":{cssPropBits:0,cssLitGroup:[c[27],c[47]]},filter:{cssExtra:/^ *(?:\s*alpha\(\s*opacity\s*=\s*(?:0|\d+(?:\.\d+)?%|[+\-]?\d+(?:\.\d+)?) *\))+ *$/i,cssPropBits:32},"float":{cssAlternates:["cssFloat","styleFloat"],cssPropBits:32,cssLitGroup:[c[30],c[47],c[54]]},font:{cssExtra:b[0],cssPropBits:9,cssLitGroup:[c[4],c[7],c[11],c[15],c[29],c[35],c[36],c[47],c[52],c[55],c[60]]},"font-family":{cssExtra:b[0],cssPropBits:8,
cssLitGroup:[c[15],c[35],c[47]]},"font-size":{cssPropBits:1,cssLitGroup:[c[7],c[47],c[52]]},"font-stretch":{cssPropBits:0,cssLitGroup:[c[5],c[55]]},"font-style":{cssPropBits:0,cssLitGroup:[c[29],c[47],c[55]]},"font-variant":{cssPropBits:0,cssLitGroup:[c[47],c[55],c[60]]},"font-weight":{cssPropBits:0,cssLitGroup:[c[4],c[47],c[55]]},height:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},left:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"letter-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"line-height":{cssPropBits:1,
cssLitGroup:[c[47],c[55]]},"list-style":{cssPropBits:16,cssLitGroup:[c[3],c[28],c[47],c[54]]},"list-style-image":{cssPropBits:16,cssLitGroup:[c[47],c[54]]},"list-style-position":{cssPropBits:0,cssLitGroup:[c[28],c[47]]},"list-style-type":{cssPropBits:0,cssLitGroup:[c[3],c[47],c[54]]},margin:{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-bottom":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-left":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"margin-right":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},
"margin-top":{cssPropBits:5,cssLitGroup:[c[38],c[47]]},"max-height":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"max-width":{cssPropBits:1,cssLitGroup:[c[38],c[47],c[54]]},"min-height":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},"min-width":{cssPropBits:1,cssLitGroup:[c[38],c[47]]},opacity:{cssPropBits:33,cssLitGroup:[c[47]]},outline:{cssExtra:b[3],cssPropBits:7,cssLitGroup:[c[0],c[9],c[34],c[46],c[47],c[48],c[49],c[52],c[54]]},"outline-color":{cssExtra:b[2],cssPropBits:2,cssLitGroup:[c[0],c[47],
c[49]]},"outline-style":{cssPropBits:0,cssLitGroup:[c[9],c[46],c[47],c[48],c[54]]},"outline-width":{cssPropBits:5,cssLitGroup:[c[34],c[47],c[52]]},overflow:{cssPropBits:32,cssLitGroup:[c[38],c[46],c[47],c[58],c[63]]},"overflow-x":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},"overflow-y":{cssPropBits:0,cssLitGroup:[c[32],c[38],c[46],c[58],c[63]]},padding:{cssPropBits:1,cssLitGroup:[c[47]]},"padding-bottom":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-left":{cssPropBits:33,cssLitGroup:[c[47]]},
"padding-right":{cssPropBits:33,cssLitGroup:[c[47]]},"padding-top":{cssPropBits:33,cssLitGroup:[c[47]]},"page-break-after":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-before":{cssPropBits:0,cssLitGroup:[c[30],c[37],c[38],c[39],c[47]]},"page-break-inside":{cssPropBits:0,cssLitGroup:[c[38],c[39],c[47]]},pause:{cssPropBits:5,cssLitGroup:[c[47]]},"pause-after":{cssPropBits:5,cssLitGroup:[c[47]]},"pause-before":{cssPropBits:5,cssLitGroup:[c[47]]},pitch:{cssPropBits:5,cssLitGroup:[c[19],
c[47],c[52]]},"pitch-range":{cssPropBits:5,cssLitGroup:[c[47]]},"play-during":{cssExtra:b[0],cssPropBits:16,cssLitGroup:[c[38],c[47],c[53],c[54],c[57]]},position:{cssPropBits:32,cssLitGroup:[c[20],c[47]]},quotes:{cssExtra:b[0],cssPropBits:0,cssLitGroup:[c[47],c[54]]},richness:{cssPropBits:5,cssLitGroup:[c[47]]},right:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},speak:{cssPropBits:0,cssLitGroup:[c[47],c[54],c[55],c[61]]},"speak-header":{cssPropBits:0,cssLitGroup:[c[37],c[47],c[56]]},"speak-numeral":{cssPropBits:0,
cssLitGroup:[c[26],c[47]]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[c[43],c[47],c[54]]},"speech-rate":{cssPropBits:5,cssLitGroup:[c[12],c[47],c[52]]},stress:{cssPropBits:5,cssLitGroup:[c[47]]},"table-layout":{cssPropBits:0,cssLitGroup:[c[38],c[45],c[47]]},"text-align":{cssPropBits:0,cssLitGroup:[c[30],c[42],c[47],c[50]]},"text-decoration":{cssPropBits:0,cssLitGroup:[c[18],c[47],c[54]]},"text-indent":{cssPropBits:5,cssLitGroup:[c[47]]},"text-overflow":{cssPropBits:0,cssLitGroup:[c[25]]},"text-shadow":{cssExtra:b[1],
cssPropBits:7,cssLitGroup:[c[0],c[35],c[48],c[54]]},"text-transform":{cssPropBits:0,cssLitGroup:[c[21],c[47],c[54]]},"text-wrap":{cssPropBits:0,cssLitGroup:[c[33],c[54],c[55]]},top:{cssPropBits:37,cssLitGroup:[c[38],c[47]]},"unicode-bidi":{cssPropBits:0,cssLitGroup:[c[23],c[47],c[55]]},"vertical-align":{cssPropBits:5,cssLitGroup:[c[10],c[24],c[47]]},visibility:{cssPropBits:32,cssLitGroup:[c[44],c[46],c[47],c[63]]},"voice-family":{cssExtra:b[0],cssPropBits:8,cssLitGroup:[c[22],c[35],c[47]]},volume:{cssPropBits:1,
cssLitGroup:[c[16],c[47],c[52]]},"white-space":{cssPropBits:0,cssLitGroup:[c[8],c[47],c[55]]},width:{cssPropBits:33,cssLitGroup:[c[38],c[47]]},"word-spacing":{cssPropBits:5,cssLitGroup:[c[47],c[55]]},"word-wrap":{cssPropBits:0,cssLitGroup:[c[41],c[55]]},"z-index":{cssPropBits:69,cssLitGroup:[c[38],c[47]]},zoom:{cssPropBits:1,cssLitGroup:[c[55]]}}}(),decodeCss,html,html4,html_sanitize,lexCss,parseCssDeclarations,parseCssStylesheet,sanitizeCssProperty,sanitizeStylesheet;
"undefined"!==typeof window&&(window.cssSchema=cssSchema);
(function(){function a(a){var b=parseInt(a.substring(1),16);return 65535<b?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(b&1023))):b==b?String.fromCharCode(b):" ">a[1]?"":a[1]}function b(a,b){return'"'+a.replace(/[\u0000-\u001f\\\"\x3c\x3e]/g,b)+'"'}function c(a){return f[a]||(f[a]="\\"+a.charCodeAt(0).toString(16)+" ")}function d(a){return g[a]||(g[a]=("\u0010">a?"%0":"%")+a.charCodeAt(0).toString(16))}var e,f,g;f={"\\":"\\\\"};g={"\\":"%5c"};e=RegExp("\\uFEFF|U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?|url[(][\\t\\n\\f ]*(?:\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)[\\t\\n\\f ]*[)]|(?!url[(])-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*[(]|(?:@?-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))|#)(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*|\"(?:'|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*\"|'(?:\"|[^'\"\\n\\f\\\\]|\\\\[\\s\\S])*'|[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)(?:%|-?(?:[a-zA-Z_]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))(?:[a-zA-Z0-9_-]|[\\u0080-\\ud7ff\\ue000-\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]|\\\\(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff]))*)?|<\!--|--\>|[\\t\\n\\f ]+|/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)|[~|^$*]=|[^\"'\\\\/]|/(?![/*])",
"gi");decodeCss=function(b){return b.replace(RegExp("\\\\(?:(?:[0-9a-fA-F]{1,6}[\\t\\n\\f ]?|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|[\\ud800-\\udbff][\\udc00-\\udfff])|[\\n\\f])","g"),a)};lexCss=function(a){var f,g,m,n,o,q,r;a=""+a;r=a.replace(/\r\n?/g,"\n").match(e)||[];g=0;m=" ";for(a=0,o=r.length;a<o;++a)q=decodeCss(r[a]),n=q.length,f=q.charCodeAt(0),q=34==f||39==f?b(q.substring(1,n-1),c):47==f&&1<n||"\\"==q||"--\>"==q||"<\!--"==q||"\ufeff"==q||32>=f?" ":/url\(/i.test(q)?"url("+b(q.replace(RegExp("^url\\([\\t\\n\\f ]*[\"']?|[\"']?[\\t\\n\\f ]*\\)$",
"gi"),""),d)+")":q,(m!=q||" "!=q)&&(r[g++]=m=q);return r.length=g,r}})();"undefined"!==typeof window&&(window.lexCss=lexCss,window.decodeCss=decodeCss);
sanitizeCssProperty=function(){function a(a){return"string"===typeof a?'url("'+a.replace(e,b)+'")':d}function b(a){return f[a]}function c(a,b,c){var d;return c?(d=(""+a).match(k),d&&(!d[1]||h.test(d[1]))?c(a,b):null):null}var d='url("about:blank")',e=/[\n\f\r\"\'()*\x3c\x3e]/g,f={"\n":"%0a","\u000c":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},g,h,k;k=/^(?:([^:/?# ]+):)?/;h=/^(?:https?|mailto)$/i;return g={},function(b,e,f,h){for(var k=e.cssPropBits,r=k&
(CSS_PROP_BIT_QSTRING_CONTENT|CSS_PROP_BIT_QSTRING_URL),u=NaN,w=0,v=0,x,z,D,H,C,A,y,F,B;w<f.length;++w){B=f[w].toLowerCase();x=B.charCodeAt(0);if(32===x)x="";else if(34===x)x=r===CSS_PROP_BIT_QSTRING_URL&&h?a(c(decodeCss(f[w].substring(1,B.length-1)),b,h)):r===CSS_PROP_BIT_QSTRING_CONTENT?B:"";else if(35===x&&/^#(?:[0-9a-f]{3}){1,2}$/.test(B))x=k&CSS_PROP_BIT_HASH_VALUE?B:"";else if(48<=x&&57>=x)x=k&CSS_PROP_BIT_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?B.match(/^\d{1,7}$/)?B:"":B:"";else if(z=B.charCodeAt(1),
D=B.charCodeAt(2),C=48<=z&&57>=z,A=48<=D&&57>=D,43===x&&(C||46===z&&A))x=k&CSS_PROP_BIT_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?B.match(/^\+\d{1,7}$/)?B:"":(C?"":"0")+B.substring(1):"";else if(45===x&&(C||46===z&&A))x=k&CSS_PROP_BIT_NEGATIVE_QUANTITY?k&CSS_PROP_BIT_Z_INDEX?B.match(/^\-\d{1,7}$/)?B:"":(C?"-":"-0")+B.substring(1):k&CSS_PROP_BIT_QUANTITY?"0":"";else if(46===x&&C)x=k&CSS_PROP_BIT_QUANTITY?"0"+B:"";else if("url("===B.substring(0,4))x=h&&r&CSS_PROP_BIT_QSTRING_URL?a(c(f[w].substring(5,B.length-
2),b,h)):"";else{if("("===B.charAt(B.length-1)){B=1;x=w+1;y=f.length;for(var I=void 0;x<y&&B;)I=f[x++],B+="("===I?1:")"===I?-1:0;H=x;f.splice(w,H-w,B=f.slice(w,H).join(" "))}if(y=e.cssLitGroup){if(!(x=e.cssLitMap)){x=e;for(var I={},E=void 0,M=void 0,L=void 0,M=y.length;0<=--M;){E=y[M];for(L=E.length;0<=--L;)I[E[L]]=g}x=x.cssLitMap=I}}else x=g;x=(F=x,F[B]===g||e.cssExtra&&e.cssExtra.test(B))?B:/^\w+$/.test(B)&&r===CSS_PROP_BIT_QSTRING_CONTENT?u+1===v?(f[u]=f[u].substring(0,f[u].length-1)+" "+B+'"',
B=""):(u=v,'"'+B+'"'):""}B=x;B&&(f[v++]=B)}1===v&&f[0]===d&&(v=0);f.length=v}}();
var sanitizeCssSelectors=function(a,b){function c(c,f){function g(c,d,e){var f,k,l;for(k="",c<d&&(l=a[c].toLowerCase(),("*"===l||"body"===l&&c+1!==d&&!e||"number"===typeof(f=html4.ELEMENTS[l])&&!(f&html4.eflags.UNSAFE))&&(++c,k=l)),e="";c<d;){l=a[c];if("#"===l.charAt(0)){if(/^#_|__$|[^#0-9A-Za-z:_\-]/.test(l))return null;e+=l+"-"+b}else if("."===l)if(++c<d&&/^[0-9A-Za-z:_\-]+$/.test(l=a[c])&&!/^_|__$/.test(l))e+="."+l;else return null;else break;++c}f="";if(c<d&&":"===a[c]&&(l=a[++c],"visited"===
l||"link"===l)){if(!/^[a*]?$/.test(k))return null;h=!0;f=":"+l;k="a";++c}return c===d?k+e+f:null}var h=!1,o,q,r,u,w,v,x;" "===a[c]&&++c;f-1!==c&&" "===a[f]&&--f;w=[];u=c;o="";for(q=c;q<f;++q)if(x=a[q],r=">"===x,r||" "===x){o=g(u,q,!1);if(!o||r&&/^html/i.test(o))return;u=q+1;w.push(o,r?" > ":" ")}if(o=g(u,f,!0))w.push(o),v=w.join(""),/^body\b/.test(v)?v=".vdoc-body___."+b+v.substring(4):v="."+b+" "+v,(h?d:e).push(v)}var d=[],e=[],f=0,g,h;for(g=0;g<a.length;++g)" "==a[g]&&(">"==a[g-1]||">"==a[g+1])||
(a[f++]=a[g]);a.length=f;f=a.length;h=0;for(g=0;g<f;++g)","==a[g]&&(c(h,g),h=g+1);c(h,f);return[e,d]};
sanitizeStylesheet=function(){function a(a){var b=!1,c,g,h;for(c=0,g=a.length;c<g-1;++c)h=a[c],":"===a[c+1]&&(b=!(cssSchema[h].cssPropBits&CSS_PROP_BIT_ALLOWED_IN_LINK)),b&&(a[c]=""),";"===h&&(b=!1);return a.join("")}var b={},c={braille:b,embossed:b,handheld:b,print:b,projection:b,screen:b,speech:b,tty:b,tv:b};return function(d,e,f){function g(){l=0!==k.length&&null!==k[k.length-1]}var h=void 0,k=[],l=!1;parseCssStylesheet(d,{startStylesheet:function(){h=[]},endStylesheet:function(){},startAtrule:function(a,
d){l?a=null:"@media"===a?(d=d.filter(function(a){return c[a]==b}),d.length?h.push(a,d.join(","),"{"):a=null):("@import"===a&&window.console&&window.console.log("@import "+d.join(" ")+" elided"),a=null);l=!a;k.push(a)},endAtrule:function(){k.pop();l||h.push(";");g()},startBlock:function(){l||h.push("{")},endBlock:function(){l||(h.push("}"),l=!0)},startRuleset:function(a){var b=void 0,c=!1,d,f,g;l||(g=sanitizeCssSelectors(a,e),d=g[0],b=g[1],!d.length&&!b.length?l=!0:(f=d.join(", "),f||(f="head > html",
c=!0),h.push(f,"{")));k.push(l?null:{historySensitiveSelectors:b,endOfSelectors:h.length-1,removeHistoryInsensitiveSelectors:c})},endRuleset:function(){var b=k.pop(),c=h.length,d,e;l||(h.push("}"),b&&(d=b.historySensitiveSelectors,d.length&&(e=h.slice(b.endOfSelectors),h.push(d.join(", "),a(e)))));b&&b.removeHistoryInsensitiveSelectors&&h.splice(b.endOfSelectors-1,c+1);g()},declaration:function(a,b){var c;l||(c=cssSchema[a],c&&(sanitizeCssProperty(a,c,b,f),b.length&&h.push(a,":",b.join(" "),";")))}});
return h.join("")}}();"undefined"!==typeof window&&(window.sanitizeCssProperty=sanitizeCssProperty,window.sanitizeCssSelectors=sanitizeCssSelectors,window.sanitizeStylesheet=sanitizeStylesheet);
(function(){function a(a,c,d,e,f){for(var n=c++,o,q;c<d&&"{"!==a[c]&&";"!==a[c];)++c;return c<d&&(f||";"===a[c])&&(q=n+1,o=c,q<d&&" "===a[q]&&++q,o>q&&" "===a[o-1]&&--o,e.startAtrule&&e.startAtrule(a[n].toLowerCase(),a.slice(q,o)),c="{"===a[c]?b(a,c,d,e):c+1,e.endAtrule&&e.endAtrule()),c}function b(d,e,f,l){var m;for(++e,l.startBlock&&l.startBlock();e<f;){m=d[e].charAt(0);if("}"==m){++e;break}" "===m||";"===m?e+=1:"@"===m?e=a(d,e,f,l,!1):"{"===m?e=b(d,e,f,l):e=c(d,e,f,l)}return l.endBlock&&l.endBlock(),
e}function c(a,b,c,f){var m=b,n=d(a,b,c,!0),o;if(0>n)return n=~n,b===n?n+1:n;b=n;n>m&&" "===a[n-1]&&--n;o=a[b];++b;if("{"!==o)return b;for(f.startRuleset&&f.startRuleset(a.slice(m,n));b<c;){o=a[b];if("}"===o){++b;break}" "===o?b+=1:b=e(a,b,c,f)}return f.endRuleset&&f.endRuleset(),b<c?b+1:b}function d(a,b,c,d){for(var e=[],f=-1,o;b<c;++b)if(o=a[b].charAt(0),"["===o||"("===o)e[++f]=o;else if("]"===o&&"["===e[f]||")"===o&&"("===e[f])--f;else if("{"===o||"}"===o||";"===o||"@"===o||":"===o&&!d)break;return 0<=
f&&(b=~(b+1)),b}function e(a,b,c,e){var m=a[b++],n,o,q,r;if(!f.test(m))return b+1;b<c&&" "===a[b]&&++b;if(b==c||":"!==a[b]){for(;b<c&&";"!==(o=a[b])&&"}"!==o;)++b;return b}++b;b<c&&" "===a[b]&&++b;n=b;b=d(a,b,c,!1);if(0>b)b=~b;else{for(q=[],r=0;n<b;++n)o=a[n]," "!==o&&(q[r++]=o);if(b<c){do{o=a[b];if(";"===o||"}"===o)break;r=0}while(++b<c);";"===o&&++b}r&&e.declaration&&e.declaration(m.toLowerCase(),q)}return b}var f;parseCssStylesheet=function(b,d){var e=lexCss(b),f,m;d.startStylesheet&&d.startStylesheet();
for(f=0,m=e.length;f<m;){var n;if(" "===e[f])n=f+1;else{n=e;var o=f,q=m,r=d;f=void 0;n=o<q?(f=n[o],"@"===f.charAt(0)?a(n,o,q,r,!0):c(n,o,q,r)):o}f=n}d.endStylesheet&&d.endStylesheet()};f=/^-?[a-z]/i;parseCssDeclarations=function(a,b){var c=lexCss(a),d,f;for(d=0,f=c.length;d<f;)d=" "!==c[d]?e(c,d,f,b):d+1}})();"undefined"!==typeof window&&(window.parseCssStylesheet=parseCssStylesheet,window.parseCssDeclarations=parseCssDeclarations);html4={};
html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10};
html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,
"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,
"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,
"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,
"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,
"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,
"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,
"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0};html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128};
html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,article:16,aside:16,audio:16,b:0,base:18,basefont:18,bdi:16,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,data:16,datalist:16,dd:1,del:0,details:16,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:16,figure:16,font:0,footer:16,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,header:16,hgroup:16,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,
label:0,legend:0,li:1,link:18,map:0,mark:16,menu:0,meta:18,meter:16,nav:0,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,output:16,p:1,param:18,pre:0,progress:16,q:0,s:0,samp:0,script:84,section:16,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,summary:16,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:16,title:24,tr:1,tt:0,u:0,ul:0,"var":0,video:16};html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2};
html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0};html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0};html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};html4.ATTRIBS=html4.ATTRIBS;html4.ELEMENTS=html4.ELEMENTS;html4.URIEFFECTS=html4.URIEFFECTS;
html4.LOADERTYPES=html4.LOADERTYPES;html4.atype=html4.atype;html4.eflags=html4.eflags;html4.ltypes=html4.ltypes;html4.ueffects=html4.ueffects;"undefined"!==typeof window&&(window.html4=html4);
html=function(a){function b(a,b){var c=b,d;return c=c.toLowerCase(),z.hasOwnProperty(c)?z[c]:(d=c.match(F),d?String.fromCharCode(parseInt(d[1],10)):(d=c.match(M))?String.fromCharCode(parseInt(d[1],16)):"")}function c(a){return a.replace(I,b)}function d(a){return(""+a).replace(C,"&amp;").replace(O,"&lt;").replace(E,"&gt;").replace(R,"&#34;")}function e(a){return a.replace(K,"&amp;$1").replace(O,"&lt;").replace(E,"&gt;")}function f(a){var b={cdata:a.cdata||a.cdata,comment:a.comment||a.comment,endDoc:a.endDoc||
a.endDoc,endTag:a.endTag||a.endTag,pcdata:a.pcdata||a.pcdata,rcdata:a.rcdata||a.rcdata,startDoc:a.startDoc||a.startDoc,startTag:a.startTag||a.startTag};return function(a,c){var d;var e=/(\x3c\/|\x3c\!--|\x3c[!?]|[\x26\x3c\x3e])/g,f,g,k;d=a+"";if(ba)d=d.split(e);else{for(k=[],f=0;null!==(g=e.exec(d));)k.push(d.substring(f,g.index)),k.push(g[0]),f=g.index+g[0].length;d=(k.push(d.substring(f)),k)}h(b,d,0,{noMoreGT:!1,noMoreEndComments:!1},c)}}function g(a,b,c,d,e){return function(){h(a,b,c,d,e)}}function h(b,
c,d,e,f){var h,m,n,o,p,q,y,r,w,v;try{b.startDoc&&0==d&&b.startDoc(f);for(r=d,o=c.length;r<o;)switch(m=c[r++],q=c[r],m){case "&":D.test(q)?(b.pcdata&&b.pcdata("&"+q,f,A,g(b,c,r,e,f)),++r):b.pcdata&&b.pcdata("&amp;",f,A,g(b,c,r,e,f));break;case "</":if(p=/^(\w+)[^\'\"]*/.exec(q))if(p[0].length===q.length&&">"===c[r+1])r+=2,v=p[1].toLowerCase(),b.endTag&&b.endTag(v,f,A,g(b,c,r,e,f));else{var d=c,B=r,u=b,F=f,z=A,E=e,I=l(d,B);r=I?(u.endTag&&u.endTag(I.name,F,z,g(u,d,B,E,F)),I.next):d.length}else b.pcdata&&
b.pcdata("&lt;/",f,A,g(b,c,r,e,f));break;case "<":if(p=/^(\w+)\s*\/?/.exec(q))if(p[0].length===q.length&&">"===c[r+1])r+=2,v=p[1].toLowerCase(),b.startTag&&b.startTag(v,[],f,A,g(b,c,r,e,f)),n=a.ELEMENTS[v],n&x&&(w={name:v,next:r,eflags:n},r=k(c,w,b,f,A,e));else{var d=c,B=b,u=f,F=A,z=e,L=l(d,r);r=L?(B.startTag&&B.startTag(L.name,L.attrs,u,F,g(B,d,L.next,z,u)),L.eflags&x?k(d,L,B,u,F,z):L.next):d.length}else b.pcdata&&b.pcdata("&lt;",f,A,g(b,c,r,e,f));break;case "<\!--":if(!e.noMoreEndComments){for(y=
r+1;y<o&&!(">"===c[y]&&/--$/.test(c[y-1]));++y);y<o?(b.comment&&(h=c.slice(r,y).join(""),b.comment(h.substr(0,h.length-2),f,A,g(b,c,y+1,e,f))),r=y+1):e.noMoreEndComments=!0}e.noMoreEndComments&&b.pcdata&&b.pcdata("&lt;!--",f,A,g(b,c,r,e,f));break;case "<!":if(/^\w/.test(q)){if(!e.noMoreGT){for(y=r+1;y<o&&!(">"===c[y]);++y);y<o?r=y+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;!",f,A,g(b,c,r,e,f))}else b.pcdata&&b.pcdata("&lt;!",f,A,g(b,c,r,e,f));break;case "<?":if(!e.noMoreGT){for(y=r+1;y<o&&
!(">"===c[y]);++y);y<o?r=y+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;?",f,A,g(b,c,r,e,f));break;case ">":b.pcdata&&b.pcdata("&gt;",f,A,g(b,c,r,e,f));break;case "":break;default:b.pcdata&&b.pcdata(m,f,A,g(b,c,r,e,f))}b.endDoc&&b.endDoc(f)}catch(M){if(M!==A)throw M;}}function k(b,c,d,f,h,k){var l=b.length,m,n,o;for(B.hasOwnProperty(c.name)||(B[c.name]=RegExp("^"+c.name+"(?:[\\s\\/]|$)","i")),o=B[c.name],m=c.next,n=c.next+1;n<l&&!("</"===b[n-1]&&o.test(b[n]));++n);n<l&&(n-=1);l=b.slice(m,n).join("");
if(c.eflags&a.eflags.CDATA)d.cdata&&d.cdata(l,f,h,g(d,b,n,k,f));else if(c.eflags&a.eflags.RCDATA)d.rcdata&&d.rcdata(e(l),f,h,g(d,b,n,k,f));else throw Error("bug");return n}function l(b,d){var e=/^(\w+)/.exec(b[d]),f={},g,h,k,l,m,n;for(f.name=e[1].toLowerCase(),f.eflags=a.ELEMENTS[f.name],k=b[d].substr(e[0].length),n=d+1,m=b.length;n<m&&!(">"===b[n]);++n)k+=b[n];if(!(m<=n)){for(l=[];""!==k;)if(e=v.exec(k))if(e[4]&&!e[5]||e[6]&&!e[7]){for(e=e[4]||e[6],g=!1,k=[k,b[n++]];n<m;++n){if(g){if(">"===b[n])break}else 0<=
b[n].indexOf(e)&&(g=!0);k.push(b[n])}if(m<=n)break;k=k.join("")}else{g=e[1].toLowerCase();var o;if(e[2]){var y=e[3];o=y.charCodeAt(0);o=((34===o||39===o)&&(y=y.substr(1,y.length-2)),c(y.replace(Q,"")))}else o=g;h=o;l.push(g,h);k=k.substr(e[0].length)}else k=k.replace(/^[\s\S][^a-z\s]*/,"");return f.attrs=l,f.next=n+1,f}}function m(b){var c=function(a,b){e||b.push(a)},e,g;return f({startDoc:function(){g=[];e=!1},startTag:function(c,f,h){var k,l,m;if(!e&&a.ELEMENTS.hasOwnProperty(c)&&(l=a.ELEMENTS[c],
!(l&a.eflags.FOLDABLE))){f=b(c,f);if(!f)return e=!(l&a.eflags.EMPTY),void 0;l&a.eflags.EMPTY||g.push(c);h.push("<",c);for(c=0,l=f.length;c<l;c+=2)k=f[c],m=f[c+1],null!==m&&void 0!==m&&h.push(" ",k,'="',d(m),'"');h.push(">")}},endTag:function(b,c){var d,f,h;if(e)return e=!1,void 0;if(a.ELEMENTS.hasOwnProperty(b)&&(d=a.ELEMENTS[b],!(d&(a.eflags.EMPTY|a.eflags.FOLDABLE)))){if(d&a.eflags.OPTIONAL_ENDTAG)for(f=g.length;0<=--f;){h=g[f];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(f=
g.length;0<=--f&&!(g[f]===b););if(!(0>f)){for(d=g.length;--d>f;)h=g[d],a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||c.push("</",h,">");g.length=f;c.push("</",b,">")}}},pcdata:c,rcdata:c,cdata:c,endDoc:function(a){for(;g.length;--g.length)a.push("</",g[g.length-1],">")}})}function n(a,b){var c;return b?(c=(""+a).match(H),c&&(!c[1]||w.test(c[1]))?b(a):null):null}function o(a,b,c,d,e){var f;c||a(b+" removed",{change:"removed",tagName:b});d!==e&&(f="changed",d&&!e?f="removed":!d&&e&&(f="added"),a(b+"."+c+
" "+f,{change:f,tagName:b,attribName:c,oldValue:d,newValue:e}))}function q(b,c,d,e,f){var g,h,k,l,m,q,r;for(l=0;l<c.length;l+=2){h=c[l];r=c[l+1];m=r;k=null;((g=b+"::"+h,a.ATTRIBS.hasOwnProperty(g))||(g="*::"+h,a.ATTRIBS.hasOwnProperty(g)))&&(k=a.ATTRIBS[g]);if(null!==k)switch(k){case a.atype.NONE:break;case a.atype.SCRIPT:r=null;f&&o(f,b,h,m,r);break;case a.atype.STYLE:if("undefined"===typeof T){r=null;f&&o(f,b,h,m,r);break}q=[];T(r,{declaration:function(a,b){var c=a.toLowerCase(),e=y[c];e&&(G(c,
e,b,d),q.push(a+": "+b.join(" ")))}});r=0<q.length?q.join(" ; "):null;f&&o(f,b,h,m,r);break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:r=e?e(r):r;f&&o(f,b,h,m,r);break;case a.atype.URI:r=n(r,d);f&&o(f,b,h,m,r);break;case a.atype.URI_FRAGMENT:r&&"#"===r.charAt(0)?(r=r.substring(1),r=e?e(r):r,null!==r&&void 0!==r&&(r="#"+r)):r=null;f&&o(f,b,h,m,r);break;default:r=null,f&&o(f,b,h,m,r)}else r=null,f&&o(f,b,h,m,r);c[l+1]=
r}return c}function r(b,c,d){return function(e,f){if(!(a.ELEMENTS[e]&a.eflags.UNSAFE))return q(e,f,b,c,d);d&&o(d,e,void 0,void 0,void 0)}}function u(a,b){var c=[];return m(b)(a,c),c.join("")}var w,v,x,z,D,H,C,A,y,F,B,I,E,M,L,K,O,Q,T,R,G,ba;"undefined"!==typeof window&&(T=window.parseCssDeclarations,G=window.sanitizeCssProperty,y=window.cssSchema);z={lt:"<",gt:">",amp:"&",nbsp:"\u00a0",quot:'"',apos:"'"};F=/^#(\d+)$/;M=/^#x([0-9A-Fa-f]+)$/;Q=/\0/g;I=/\x26(#\d+|#x[0-9A-Fa-f]+|\w+);/g;C=/\x26/g;K=/\x26([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi;
O=/[\x3c]/g;E=/\x3e/g;R=/\"/g;v=/^\s*([a-z][-\w]*)(?:\s*(=)\s*((")[^"]*("|$)|(')[^']*('|$)|(?=[a-z][-\w]*\s*=)|[^"'\s]*))?/i;D=/^(#[0-9]+|#x[0-9a-f]+|\w+);/i;ba=3==="a,b".split(/(,)/).length;x=a.eflags.CDATA|a.eflags.RCDATA;A={};B={};H=/^(?:([^:/?# ]+):)?/;w=/^(?:https?|mailto)$/i;return L={},L.escapeAttrib=L.escapeAttrib=d,L.makeHtmlSanitizer=L.makeHtmlSanitizer=m,L.makeSaxParser=L.makeSaxParser=f,L.makeTagPolicy=L.makeTagPolicy=r,L.normalizeRCData=L.normalizeRCData=e,L.sanitize=L.sanitize=function(a,
b,c,d){b=r(b,c,d);return u(a,b)},L.sanitizeAttribs=L.sanitizeAttribs=q,L.sanitizeWithPolicy=L.sanitizeWithPolicy=u,L.unescapeEntities=L.unescapeEntities=c,L}(html4);html_sanitize=html.sanitize;"undefined"!==typeof window&&(window.html=html,window.html_sanitize=html_sanitize);function clean(a){return a?html_sanitize(a,function(a){return a},function(a){return a}):a};function updateModel(){var a=getSetting();if(3>a.getAttribute("Version")){for(var b=primitives("Converter"),c=0;c<b.length;c++){for(var d=b[c].getAttribute("Inputs").split(","),e=b[c].getAttribute("Outputs").split(","),f="",g=0;g<d.length;g++)0<g&&(f+=";"),f=f+d[g]+","+e[g];b[c].setAttribute("Data",f)}a.setAttribute("Version",3)}4>a.getAttribute("Version")&&(a.setAttribute("SolutionAlgorithm","RK1"),a.setAttribute("Version",4));if(5>a.getAttribute("Version")){b=primitives("Stock");for(c=0;c<b.length;c++)b[c].setAttribute("NonNegative",
!1);a.setAttribute("Version",5)}if(6>a.getAttribute("Version")){b=primitives("Picture");for(c=0;c<b.length;c++)b[c].setAttribute("FlipHorizontal",!1),b[c].setAttribute("FlipVertical",!1);a.setAttribute("Version",6)}if(7>a.getAttribute("Version")){b=primitives("Link");for(c=0;c<b.length;c++)b[c].setAttribute("BiDirectional",!1);a.setAttribute("Version",7)}if(8>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"));for(c=0;c<b.length;c++)b[c].setAttribute("Image",
"None");b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("Image","Display");a.setAttribute("Version",8)}9>a.getAttribute("Version")&&(a.setAttribute("BackgroundColor","white"),a.setAttribute("Version",9));if(10>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setVisible(!1);a.setAttribute("Version",10);graph.refresh()}11>a.getAttribute("Version")&&(b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),primitives("Text")),graph.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,
mxConstants.NONE,b),a.setAttribute("Version",11));if(12>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"));d=primitives("Picture");for(c=0;c<d.length;c++)d[c].setAttribute("LabelPosition","Bottom");for(c=0;c<b.length;c++)b[c].setAttribute("LabelPosition","Middle");a.setAttribute("Version",12)}if(13>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Image","None"),b[c].setAttribute("LabelPosition","Middle");
a.setAttribute("Version",13)}if(14>a.getAttribute("Version")){b=primitives("Stock").concat(primitives("Parameter"),primitives("Converter"),primitives("Folder"));for(c=0;c<b.length;c++)b[c].setAttribute("FlipHorizontal",!1),b[c].setAttribute("FlipVertical",!1);a.setAttribute("Version",14)}if(15>a.getAttribute("Version")){b=primitives("Button");for(c=0;c<b.length;c++)d=b[c].getAttribute("Function"),d=d.replace(/getName/g,"findName"),d=d.replace(/getType/g,"findType"),d=d.replace(/getAll/g,"findAll"),
b[c].setAttribute("Function",d);a.setAttribute("Version",15)}if(16>a.getAttribute("Version")){b=primitives("Parameter");for(c=0;c<b.length;c++)b[c].value=changeNodeName(b[c].value,"Variable");a.setAttribute("Version",16)}17>a.getAttribute("Version")&&(a.setAttribute("Throttle",-1),a.setAttribute("Version",17));if(18>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("yAxis2",""),b[c].setAttribute("Primitives2","");a.setAttribute("Version",18)}19>a.getAttribute("Version")&&
(a.setAttribute("Macros",""),a.setAttribute("Version",19));20>a.getAttribute("Version")&&(c=a.getAttribute("Units"),isDefined(c)&&a.setAttribute("Units",c.replace(/,/g,"*")),a.setAttribute("Version",20));if(21>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)"Scatterplot"==b[c].getAttribute("Type")?(b[c].setAttribute("showMarkers",!0),b[c].setAttribute("showLines",!1)):(b[c].setAttribute("showMarkers",!1),b[c].setAttribute("showLines",!0));a.setAttribute("Version",21)}22>
a.getAttribute("Version")&&(a.setAttribute("SensitivityPrimitives",""),a.setAttribute("SensitivityRuns",50),a.setAttribute("SensitivityBounds","50, 80, 95, 100"),a.setAttribute("SensitivityShowRuns","false"),a.setAttribute("Version",22));23>a.getAttribute("Version")&&(c=findValue([/\bmin\(\s*</i,/\bmax\(\s*</i,/\bmean\(\s*</i,/\bmedian\(\s*</i,/\bstddev\(\s*</i]),0<c.length&&(b="<p>Insight Maker has received an update that removes the need for the <i>&lt;Primitive&gt;</i> notation. You may now use the <i>[Primitive]</i> in place of it.</p> <br/><p>A side effect of this update is that the usage of the Min(), Max(), Mean(), Median() and StdDev() statistical functions for aggregating over a primitive's history have been renamed to PastMin(), PastMax(), etc... (the usage of these function for values is unchanged; e.g. Max(1, 4, 2) is still correct).</p><br/><p>To correct this you need to change equations like:</p><br/><b>Max(&lt;x&gt;)</b></p><br/>to</p><br/><b>PastMax([x])</b></p><br/><p>The following of your primitives appear to use these function and need to be updated to work correctly with this change. You can adjust their equations manually:</p>"+
("<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>"),Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b,buttons:Ext.MessageBox.OK})),a.setAttribute("Version",23));if(24>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Type","None");b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("showArea",!1);b=primitives("Text");for(c=0;c<b.length;c++)b[c].setAttribute("LabelPosition",
"Middle");a.setAttribute("Version",24)}25>a.getAttribute("Version")&&(setAllConnectable(),a.setAttribute("Version",25));if(26>a.getAttribute("Version")){b=primitives("Flow");for(c=0;c<b.length;c++)isTrue(b[c].getAttribute("OnlyPositive"))||(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[b[c]]),graph.setCellStyles("startFill",0,[b[c]]));a.setAttribute("Version",26)}if(27>a.getAttribute("Version")){b=primitives("Display");for(c=0;c<b.length;c++)b[c].setAttribute("legendPosition","Automatic");
a.setAttribute("Version",27)}if(28>a.getAttribute("Version")){b=primitives();for(c=0;c<b.length;c++)"ShowSlider"in b[c]&&b[c].setAttribute("SliderStep","");a.setAttribute("Version",28)}29>a.getAttribute("Version")&&(c=excludeType(findValue(/[A-Za-z0-9_]\s+\(/i),"Button"),viewConfig.allowEdits&&0<c.length&&(b='<p>Insight Maker has received a significant update to its equation engine providing improved flexibility and power.</p><br/><p>A side effect of this update is that function names must now immediately be followed by a parenthesis. Thus, for instance, "Max&nbsp;&nbsp(1,2)" is no longer valid and needs to be replaced with  "Max(1,2)." This also improves the clarity and readability of equations.</p> <br/><p>The following of your primitives appear to use an unsupported format. Their equations will automatically be updated to use the correct format:</p>'+
("<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>"),Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b+"<br/><p>You may save your model to keep these updates.</p>",buttons:Ext.MessageBox.OK})),0<c.length&&c.map(function(a){setValue(a,getValue(a).replace(/([A-Za-z0-9_])\s+\(/gi,"$1("))}),a.setAttribute("Version",29));if(30>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("Solver",defaultSolver);
a.setAttribute("Version",30)}if(31>a.getAttribute("Version")){b=primitives("Agents");for(c=0;c<b.length;c++)b[c].setAttribute("ShowSlider",!1),b[c].setAttribute("SliderMax",100),b[c].setAttribute("SliderMin",0),b[c].setAttribute("SliderStep",1);a.setAttribute("Version",31)}if(32>a.getAttribute("Version")){b=primitives("Folder");for(c=0;c<b.length;c++)b[c].setAttribute("AgentBase","");a.setAttribute("Version",32)}if(33>a.getAttribute("Version")){b=primitives("Action");for(c=0;c<b.length;c++)b[c].setAttribute("Repeat",
!0),b[c].setAttribute("Recalculate",!0);b=primitives("Transition");for(c=0;c<b.length;c++)b[c].setAttribute("Repeat",!1),b[c].setAttribute("Recalculate",!0);b=primitives("State");for(c=0;c<b.length;c++)b[c].setAttribute("Residency","0");a.setAttribute("Version",33)}34>a.getAttribute("Version")&&(c=excludeType(findValue(/\[self\]/i),"Button"),viewConfig.allowEdits&&0<c.length&&(b='<p>Insight Maker has received a significant update to its equation engine improving Agent Based Modeling..</p><br/><p>A side effect of this update is that the "Self" agent must always be referred to using the variable syntax -- <i>Self</i> -- instead of the old primitive syntax -- <i>[Self]</i>.</p> <br/><p>The following of your primitives appear to use the outdated format. Their equations will automatically be updated to use the correct format:</p>'+
("<br/><p><b>"+Ext.Array.map(c,function(a){return a.getAttribute("name")}).join(", ")+"</b></p>"),Ext.Msg.show({icon:Ext.MessageBox.WARNING,title:"Model Update Required",msg:b+"<br/><p>You may save your model to keep these updates.</p>",buttons:Ext.MessageBox.OK})),0<c.length&&c.map(function(a){setValue(a,getValue(a).replace(/\[Self\]/gi,"Self"))}),a.setAttribute("Version",34))};function sliderPrimitives(a){for(var a=a?findType(a):primitives(),b=[],c=0;c<a.length;c++)isTrue(a[c].getAttribute("ShowSlider"))&&b.push(a[c]);return b}
function createSliders(a,b,c){function d(){var a=Ext.create("Ext.form.field.Number",{slider:l,width:60,decimalPrecision:h,ignoreChange:!1,hideTrigger:!0,keyNavEnabled:!1,selectOnFocus:!0,mouseWheelEnabled:!1,minValue:parseFloat(f[g].getAttribute("SliderMin")),maxValue:parseFloat(f[g].getAttribute("SliderMax")),listeners:{change:function(a){if(!a.ignoreChange&&a.validate()){a.ignoreChange=!0;var b=parseFloat(a.getValue());isNaN(b)||a.slider.setValue(b);a.ignoreChange=!1}}}});l.addListener("change",
function(d,e){d.confirming||((!a.ignoreChange||parseFloat(a.getValue())!=parseFloat(e))&&a.setRawValue(parseFloat(e)),getValue(d.sliderCell).trim()!=parseFloat(getValue(d.sliderCell).trim())?(d.confirming=!0,c(d,b,a,e)):b(d.sliderCell,parseFloat(e)))});var d=f[g].getAttribute("Note");isUndefined(d)&&(d="");e.add(Ext.create("Ext.Component",{html:"<big> &bull; "+f[g].getAttribute("name")+"</big>"+(""==d?"":"<div style='font-size:small;color:grey'>"+d+"</div>"),padding:3}));e.add(Ext.create("Ext.container.Container",
{layout:{type:"hbox",align:"stretch"},margin:3,items:[l,a]}));k==parseFloat(k)&&a.setValue(parseFloat(getValue(f[g])))}var e=Ext.create("Ext.container.Container",{layout:{type:"vbox",align:"stretch"}}),f=sliderPrimitives(a);sliders=[];for(var g=0;g<f.length;g++){var h=(a=parseFloat(f[g].getAttribute("SliderStep"))?parseFloat(f[g].getAttribute("SliderStep")):void 0)?Math.ceil(-Math.log(a)/Math.log(10)):Math.floor(-(Math.log(Math.max(0.1,f[g].getAttribute("SliderMax")-f[g].getAttribute("SliderMin")))/
Math.log(10)-4)),k=getValue(f[g]).trim(),h=Math.max(0,h),l=Ext.create("Ext.slider.Single",{flex:1,minValue:parseFloat(f[g].getAttribute("SliderMin")),sliderCell:f[g],value:parseFloat(k)==k?parseFloat(k):void 0,maxValue:parseFloat(f[g].getAttribute("SliderMax")),decimalPrecision:h,increment:a});sliders.push(l);d()}return e};Ext.onReady(function(){main()});require.config&&require.config({baseUrl:builder_path+"/resources"});var defaultSolver='{"enabled": false, "algorithm": "RK1", "timeStep": 1}';
Ext.form.customFields={code:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0}),converter:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^0-9\;\,\. \-]/g}),units:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0,stripCharsRe:/[^A-Za-z 0-9\.\/\(\)\*\^]/g}),richText:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!0}),solver:Ext.extend(Ext.form.TriggerField,{enableKeyEvents:!1,selectOnFocus:!1,clicksToEdit:9999})};
Ext.override(Ext.form.HtmlEditor,{createLink:function(){var a=prompt(this.createLinkText,this.defaultLinkValue);if(a&&"http://"!=a){var b=this.win.getSelection();""==b&&(b=a);b='<a href="'+a+'" target="_blank">'+b+"</a>";if(Ext.isIE){if(range=this.getDoc().selection.createRange())range.pasteHTML(b),this.syncValue(),this.deferFocus()}else this.execCmd("InsertHTML",b),this.deferFocus()}}});
function renderTimeBut(){var a=Ext.id();Ext.Function.defer(function(){(new Ext.Button({text:"Edit Time Settings",height:16,padding:0,margin:0,margins:0,handler:function(){var a=JSON.parse(getSelected()[0].getAttribute("Solver"));a.cell=getSelected()[0];showTimeSettings(a)}})).render(document.body,a)},15);return'<div id="'+a+'"></div>'}window.addEventListener("message",callAPI,!1);function callAPI(a){try{a.source.postMessage(eval(a.data),"*")}catch(b){}}
function isLocal(){return"localhost"==document.location.hostname||"insightmaker.dev"==document.location.hostname}mxGraph.prototype.stopEditing=function(a){null!==this.cellEditor&&this.cellEditor.stopEditing(a)};
var equationRenderer=function(a){/\\n/.test(a)&&(a=a.match(/(.*?)\\n/)[1]+"...");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\[(.*?)\]/g,"<font color='Green'>[$1]</font>");a=a.replace(/(&lt;&lt;.*?&gt;&gt;)/g,"<font color='Orange'>$1</font>");a=a.replace(/(\u00ab.*?\u00bb)/g,"<font color='Orange'>$1</font>");a=a.replace(/\b([\d\.e]+)\b/g,"<font color='DeepSkyBlue'>$1</font>");a=a.replace(/(\{.*?\})/g,"<font color='Orange'>$1</font>");return clean(a)};
isLocal()||(window.onerror=function(a,b,c){if(!/removeChild/.test(a))return a=[a,b,c].join(" : "),_gaq.push(["_trackEvent","Errors","App",a,null,!0]),console.log(a),!0});try{mxUtils.alert=function(a){Ext.example.msg("<table><tr><td valign='top'><img src='"+builder_path+"/images/stop.png' style='padding-right:.3em;' width=48px height=48px  /></td><td>"+a+"</td></tr></table>","")}}catch(err$$3){alert("Insight Maker failed to load all its resources. Check your network connection and try to reload Insight Maker.")}
var GraphEditor={},mainPanel,mxPanel,ribbonPanel,configPanel,sizeChanging,graph,sliders=[],settingCell,selectionChanged,primitiveBank={},clipboardListener,undoHistory;
function main(){function a(a){a.setAttribute("Units","Unitless");a.setAttribute("MaxConstraintUsed",!1);a.setAttribute("MinConstraintUsed",!1);a.setAttribute("MaxConstraint","100");a.setAttribute("MinConstraint","0");a.setAttribute("ShowSlider",!1);a.setAttribute("SliderMax",100);a.setAttribute("SliderMin",0);a.setAttribute("SliderStep","")}Ext.QuickTips.init();try{mxEvent.disableContextMenu(document.body)}catch(b){return}mxConstants.DEFAULT_HOTSPOT=0.3;mxConstants.LINE_HEIGHT=1.15;graph=new mxGraph;
undoHistory=new mxUndoManager;var c=mxUtils.parseXml('<mxStylesheet> \t<add as="defaultVertex" extend="defaultVertex"> \t\t<add as="strokeColor" value="#666666"/> \t\t<add as="fontColor" value="#333333"/>  <add as="overflow" value=""/> \t\t<add as="fontSize" value="14"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="2"/> \t</add> \t<add as="defaultEdge" extend="defaultEdge"> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="rounded" value="1"/> \t\t<add as="fontSize" value="14"/> \t\t<add as="edgeStyle" value="elbowEdgeStyle"/> \t\t<add as="fontFamily" value="Comic Sans MS"/> \t\t<add as="strokeWidth" value="4"/> \t</add> \t<add as="stock" extend="defaultVertex"> \t\t<add as="fillColor" value="#A6D3F8"/> \t</add> \t<add as="state" extend="defaultVertex"> \t\t<add as="fillColor" value="#ffffff"/> \t</add> \t<add as="transition" extend="defaultEdge"> \t\t<add as="strokeColor" value="#000000"/> \t\t<add as="fontColor" value="#000000"/> \t</add> \t<add as="agents" extend="defaultVertex"> \t\t<add as="fillColor" value="#F0E68C"/> \t\t<add as="shape" value="cloud"/> \t</add> \t<add as="textArea" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t<add as="text" extend="defaultVertex"> \t\t<add as="strokeColor" value="none"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="fontSize" value="30"/> \t\t<add as="fontStyle" value="4"/> \t</add> \t \t<add as="parameter" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="variable" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FDCDAC"/> \t</add> \t<add as="action" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t</add> \t<add as="converter" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="perimeter" value="ellipsePerimeter"/> \t\t<add as="fillColor" value="#B3E2CD"/> \t</add> \t<add as="button" extend="defaultVertex"> \t\t<add as="rounded" value="1"/> \t\t<add as="glass" value="1"/> \t\t<add as="fillColor" value="#C0C0C0"/> \t\t<add as="fontColor" value="black"/> \t\t<add as="strokeWidth" value="3"/> \t\t<add as="fontFamily" value="Helvetica"/> \t</add> \t<add as="display" extend="defaultVertex"> \t\t<add as="shape" value="ellipse"/> \t\t<add as="fillColor" value="#FFFFFF"/> \t\t<add as="strokeColor" value="#FFFFFF"/> \t\t<add as="fontColor" value="#FFFFFF"/> \t\t<add as="opacity" value="0"/> \t</add> \t<add as="picture" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="entity" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t\t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t<add as="flow" extend="defaultEdge"> \t</add> \t<add as="link" extend="defaultEdge"> \t\t<add as="strokeColor" value="#808080"/> \t\t<add as="fontColor" value="#808080"/> \t\t<add as="opacity" value="70"/> \t\t<add as="edgeStyle" value="straight"/> \t\t<add as="strokeWidth" value="2"/> \t\t<add as="dashed" value="1"/> \t\t<add as="noLabel" value="0"/> \t</add> \t \t<add as="line" extend="defaultVertex"> \t\t<add as="shape" value="line"/> \t\t<add as="strokeWidth" value="4"/> \t\t<add as="labelBackgroundColor" value="white"/> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="spacingTop" value="8"/> \t</add> \t<add as="image" extend="defaultVertex"> \t\t<add as="shape" value="image"/> \t\t<add as="verticalLabelPosition" value="bottom"/> \t\t<add as="verticalAlign" value="top"/> \t</add> \t \t<add as="folder" extend="defaultVertex"> \t\t<add as="verticalAlign" value="top"/> \t\t<add as="dashed" value="1"/> \t\t<add as="fillColor" value="none"/> \t\t<add as="rounded" value="1"/> \t</add> </mxStylesheet> '),
d=new mxCodec(c);d.decode(c.documentElement,graph.getStylesheet());graph.alternateEdgeStyle="vertical";graph.connectableEdges=!0;graph.disconnectOnMove=!1;graph.edgeLabelsMovable=!0;graph.enterStopsCellEditing=!0;graph.allowLoops=!1;viewConfig.allowEdits&&(mxVertexHandler.prototype.rotationEnabled=!0);mxVertexHandler.prototype.manageSizers=!0;mxVertexHandler.prototype.livePreview=!0;if(!mxClient.IS_TOUCH&&!(0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints))Ext.FocusManager.enable(),Ext.FocusManager.keyNav.disable(),
Ext.FocusManager.shouldShowFocusFrame=function(){return!1};else{mxShape.prototype.svgStrokeTolerance=18;mxVertexHandler.prototype.tolerance=12;mxEdgeHandler.prototype.tolerance=12;mxGraph.prototype.tolerance=12;mxConstants.DEFAULT_HOTSPOT=0.5;mxConstants.HANDLE_SIZE=16;mxConstants.LABEL_HANDLE_SIZE=7;graph.addListener(mxEvent.TAP_AND_HOLD,function(a,b){var c=b.getProperty("event"),d=b.getProperty("cell");null!==d&&isValued(d)?showEditor(d):showContextMenu(null,c);b.consume()});mxPanningHandler.prototype.isPanningTrigger=
function(a){var b=a.getEvent();return null==a.getState()&&!mxEvent.isMouseEvent(b)||mxEvent.isPopupTrigger(b)&&(null==a.getState()||mxEvent.isControlDown(b)||mxEvent.isShiftDown(b))};var e=mxGraphHandler.prototype.mouseDown;mxGraphHandler.prototype.mouseDown=function(a,b){e.apply(this,arguments);this.graph.isCellSelected(b.getCell())&&1<this.graph.getSelectionCount()&&(this.delayedSelection=!1)};var f=mxGraph.prototype.dblClick;mxGraph.prototype.dblClick=function(a,b){if(null==b)var c=mxUtils.convertPoint(this.container,
mxEvent.getClientX(a),mxEvent.getClientY(a)),b=this.getCellAt(c.x,c.y);f.call(this,a,b)};d=new mxImage(builder_path+"/images/touch-handle.png",16,16);mxVertexHandler.prototype.handleImage=d;mxEdgeHandler.prototype.handleImage=d;mxOutline.prototype.sizerImage=d;(new Image).src=d.src;var g=builder_path+"/images/touch-connector.png";(new Image).src=g;var h=mxVertexHandler.prototype.init;mxVertexHandler.prototype.init=function(){h.apply(this,arguments);this.graph.connectionHandler.isEnabled()&&this.graph.isCellConnectable(this.state.cell)&&
1==this.graph.getSelectionCount()&&graph.connectionHandler.isConnectableCell(this.state.cell)&&(this.connectorImg=mxUtils.createImage(g),this.connectorImg.style.cursor="pointer",this.connectorImg.style.width="29px",this.connectorImg.style.height="29px",this.connectorImg.style.position="absolute",mxClient.IS_TOUCH||(this.connectorImg.setAttribute("title",mxResources.get("connect")),mxEvent.redirectMouseEvents(this.connectorImg,this.graph,this.state)),mxEvent.addGestureListeners(this.connectorImg,mxUtils.bind(this,
function(a){this.graph.popupMenuHandler.hideMenu();this.graph.stopEditing(!1);var b=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(a),mxEvent.getClientY(a));this.graph.connectionHandler.start(this.state,b.x,b.y);this.graph.isMouseDown=!0;this.graph.isMouseTrigger=mxEvent.isMouseEvent(a);mxEvent.consume(a)})),this.graph.container.appendChild(this.connectorImg));this.redrawHandles()};var k=mxVertexHandler.prototype.hideSizers;mxVertexHandler.prototype.hideSizers=function(){k.apply(this,
arguments);null!=this.connectorImg&&(this.connectorImg.style.visibility="hidden")};var l=mxVertexHandler.prototype.reset;mxVertexHandler.prototype.reset=function(){l.apply(this,arguments);null!=this.connectorImg&&(this.connectorImg.style.visibility="")};var m=mxVertexHandler.prototype.redrawHandles;mxVertexHandler.prototype.redrawHandles=function(){m.apply(this);if(null!=this.state&&null!=this.connectorImg){var a=new mxPoint,b=this.state;mxVertexHandler.prototype.singleSizer?(a.x=b.x+b.width-this.connectorImg.offsetWidth/
2,a.y=b.y-this.connectorImg.offsetHeight/2):(a.x=b.x+b.width+mxConstants.HANDLE_SIZE/2+4+this.connectorImg.offsetWidth/2,a.y=b.y+b.height/2);var c=mxUtils.toRadians(mxUtils.getValue(b.style,mxConstants.STYLE_ROTATION,0));if(0!=c)var d=Math.cos(c),c=Math.sin(c),b=new mxPoint(b.getCenterX(),b.getCenterY()),a=mxUtils.getRotatedPoint(a,d,c,b);this.connectorImg.style.left=a.x-this.connectorImg.offsetWidth/2+"px";this.connectorImg.style.top=a.y-this.connectorImg.offsetHeight/2+"px"}};var n=mxVertexHandler.prototype.destroy;
mxVertexHandler.prototype.destroy=function(a,b){n.apply(this,arguments);null!=this.connectorImg&&(this.connectorImg.parentNode.removeChild(this.connectorImg),this.connectorImg=null)}}mxEdgeHandler.prototype.addEnabled=!0;mxEdgeHandler.prototype.removeEnabled=!0;graph.isHtmlLabel=function(a){return null!=a&&null!=a.value&&"Display"!=a.value.nodeName};graph.isWrapping=graph.isHtmlLabel;graph.isCellLocked=function(a){return!viewConfig.allowEdits||0===getOpacity(a)};graph.allowButtonSelect=!1;graph.isCellSelectable=
function(a){return"Setting"!=a.value.nodeName&&"Display"!=a.value.nodeName&&(graph.allowButtonSelect||"Button"!=a.value.nodeName&&0!==getOpacity(a))};graph.isCellEditable=function(a){return!viewConfig.allowEdits?!1:"Display"!=a.value.nodeName&&"Setting"!=a.value.nodeName&&0!==getOpacity(a)&&"Ghost"!=a.value.nodeName&&("Button"!=a.value.nodeName||graph.isCellSelected(a))};graph.getCursorForCell=function(a){if("Button"==a.value.nodeName)return"pointer"};graph.convertValueToString=function(a){return mxUtils.isNode(a.value)&&
!("Link"==a.value.nodeName&&"Link"==orig(a).getAttribute("name"))?clean(orig(a).getAttribute("name")):""};graph.labelChanged=function(a,b){if(validPrimitiveName(b,a)){var c=a.getAttribute("name");graph.model.beginUpdate();var d=new mxCellAttributeChange(a,"name",b);graph.getModel().execute(d);selectionChanged(!1);propogateGhosts(a);propogateName(a,c);graph.model.endUpdate();return a}};graph.getEditingValue=function(a){if(mxUtils.isNode(a.value))return a.getAttribute("name")};setupHoverIcons();c=mxUtils.createXmlDocument();
primitiveBank.text=c.createElement("Text");primitiveBank.text.setAttribute("name",getText("Text Area"));primitiveBank.text.setAttribute("LabelPosition","Middle");primitiveBank.folder=c.createElement("Folder");primitiveBank.folder.setAttribute("name",getText("New Folder"));primitiveBank.folder.setAttribute("Note","");primitiveBank.folder.setAttribute("Type","None");primitiveBank.folder.setAttribute("Solver",defaultSolver);primitiveBank.folder.setAttribute("Image","None");primitiveBank.folder.setAttribute("FlipHorizontal",
!1);primitiveBank.folder.setAttribute("FlipVertical",!1);primitiveBank.folder.setAttribute("LabelPosition","Middle");primitiveBank.folder.setAttribute("AgentBase","");primitiveBank.ghost=c.createElement("Ghost");primitiveBank.ghost.setAttribute("Source","");primitiveBank.picture=c.createElement("Picture");primitiveBank.picture.setAttribute("name","");primitiveBank.picture.setAttribute("Note","");primitiveBank.picture.setAttribute("Image","Growth");primitiveBank.picture.setAttribute("FlipHorizontal",
!1);primitiveBank.picture.setAttribute("FlipVertical",!1);primitiveBank.picture.setAttribute("LabelPosition","Bottom");primitiveBank.display=c.createElement("Display");primitiveBank.display.setAttribute("name",getText("Default Display"));primitiveBank.display.setAttribute("Note","");primitiveBank.display.setAttribute("Type","Time Series");primitiveBank.display.setAttribute("xAxis",getText("Time")+" (%u)");primitiveBank.display.setAttribute("yAxis","");primitiveBank.display.setAttribute("yAxis2","");
primitiveBank.display.setAttribute("showMarkers",!1);primitiveBank.display.setAttribute("showLines",!0);primitiveBank.display.setAttribute("showArea",!1);primitiveBank.display.setAttribute("ThreeDimensional",!1);primitiveBank.display.setAttribute("Primitives","");primitiveBank.display.setAttribute("Primitives2","");primitiveBank.display.setAttribute("AutoAddPrimitives",!1);primitiveBank.display.setAttribute("ScatterplotOrder","X Primitive, Y Primitive");primitiveBank.display.setAttribute("Image",
"Display");primitiveBank.display.setAttribute("FlipHorizontal",!1);primitiveBank.display.setAttribute("FlipVertical",!1);primitiveBank.display.setAttribute("LabelPosition","Bottom");primitiveBank.display.setAttribute("legendPosition","Automatic");primitiveBank.stock=c.createElement("Stock");primitiveBank.stock.setAttribute("name",getText("New Stock"));primitiveBank.stock.setAttribute("Note","");primitiveBank.stock.setAttribute("InitialValue","0");primitiveBank.stock.setAttribute("StockMode","Store");
primitiveBank.stock.setAttribute("Delay","10");primitiveBank.stock.setAttribute("Volume","100");primitiveBank.stock.setAttribute("NonNegative",!1);a(primitiveBank.stock);primitiveBank.stock.setAttribute("Image","None");primitiveBank.stock.setAttribute("FlipHorizontal",!1);primitiveBank.stock.setAttribute("FlipVertical",!1);primitiveBank.stock.setAttribute("LabelPosition","Middle");primitiveBank.state=c.createElement("State");primitiveBank.state.setAttribute("name",getText("New State"));primitiveBank.state.setAttribute("Note",
"");primitiveBank.state.setAttribute("Active","false");primitiveBank.state.setAttribute("Residency","0");primitiveBank.state.setAttribute("Image","None");primitiveBank.state.setAttribute("FlipHorizontal",!1);primitiveBank.state.setAttribute("FlipVertical",!1);primitiveBank.state.setAttribute("LabelPosition","Middle");primitiveBank.transition=c.createElement("Transition");primitiveBank.transition.setAttribute("name",getText("Transition"));primitiveBank.transition.setAttribute("Note","");primitiveBank.transition.setAttribute("Trigger",
"Timeout");primitiveBank.transition.setAttribute("Value","1");primitiveBank.transition.setAttribute("Repeat",!1);primitiveBank.transition.setAttribute("Recalculate",!1);a(primitiveBank.transition);primitiveBank.action=c.createElement("Action");primitiveBank.action.setAttribute("name",getText("New Action"));primitiveBank.action.setAttribute("Note","");primitiveBank.action.setAttribute("Trigger","Probability");primitiveBank.action.setAttribute("Value","0.5");primitiveBank.action.setAttribute("Repeat",
!0);primitiveBank.action.setAttribute("Recalculate",!1);primitiveBank.action.setAttribute("Action","Self.Move({Rand(), Rand()})");primitiveBank.agents=c.createElement("Agents");primitiveBank.agents.setAttribute("name",getText("New Agent Population"));primitiveBank.agents.setAttribute("Note","");primitiveBank.agents.setAttribute("Size",100);primitiveBank.agents.setAttribute("GeoWrap",!1);primitiveBank.agents.setAttribute("GeoDimUnits","Unitless");primitiveBank.agents.setAttribute("GeoWidth",200);primitiveBank.agents.setAttribute("GeoHeight",
100);primitiveBank.agents.setAttribute("Placement","Random");primitiveBank.agents.setAttribute("PlacementFunction","{Rand()*Width([Self]), Rand()*Height([Self])}");primitiveBank.agents.setAttribute("Network","None");primitiveBank.agents.setAttribute("NetworkFunction","RandBoolean(0.02)");primitiveBank.agents.setAttribute("Agent","");primitiveBank.agents.setAttribute("Image","None");primitiveBank.agents.setAttribute("FlipHorizontal",!1);primitiveBank.agents.setAttribute("FlipVertical",!1);primitiveBank.agents.setAttribute("LabelPosition",
"Middle");primitiveBank.agents.setAttribute("ShowSlider",!1);primitiveBank.agents.setAttribute("SliderMax",100);primitiveBank.agents.setAttribute("SliderMin",0);primitiveBank.agents.setAttribute("SliderStep",1);primitiveBank.variable=c.createElement("Variable");primitiveBank.variable.setAttribute("name",getText("New Variable"));primitiveBank.variable.setAttribute("Note","");primitiveBank.variable.setAttribute("Equation","0");a(primitiveBank.variable);primitiveBank.variable.setAttribute("Image","None");
primitiveBank.variable.setAttribute("FlipHorizontal",!1);primitiveBank.variable.setAttribute("FlipVertical",!1);primitiveBank.variable.setAttribute("LabelPosition","Middle");primitiveBank.button=c.createElement("Button");primitiveBank.button.setAttribute("name",getText("New Button"));primitiveBank.button.setAttribute("Note","");primitiveBank.button.setAttribute("Function",'showMessage("Button action triggered!\\n\\nIf you want to edit this Action, click on the button while holding down the Shift key on your keyboard.")');
primitiveBank.button.setAttribute("Image","None");primitiveBank.button.setAttribute("FlipHorizontal",!1);primitiveBank.button.setAttribute("FlipVertical",!1);primitiveBank.button.setAttribute("LabelPosition","Middle");primitiveBank.converter=c.createElement("Converter");primitiveBank.converter.setAttribute("name",getText("New Converter"));primitiveBank.converter.setAttribute("Note","");primitiveBank.converter.setAttribute("Source","Time");primitiveBank.converter.setAttribute("Data","0,0; 1,1; 2,4; 3,9");
primitiveBank.converter.setAttribute("Interpolation","Linear");a(primitiveBank.converter);primitiveBank.converter.setAttribute("Image","None");primitiveBank.converter.setAttribute("FlipHorizontal",!1);primitiveBank.converter.setAttribute("FlipVertical",!1);primitiveBank.converter.setAttribute("LabelPosition","Middle");primitiveBank.flow=c.createElement("Flow");primitiveBank.flow.setAttribute("name",getText("Flow"));primitiveBank.flow.setAttribute("Note","");primitiveBank.flow.setAttribute("FlowRate",
"0");primitiveBank.flow.setAttribute("OnlyPositive",!0);primitiveBank.flow.setAttribute("TimeIndependent",!1);a(primitiveBank.flow);primitiveBank.link=c.createElement("Link");primitiveBank.link.setAttribute("name",getText("Link"));primitiveBank.link.setAttribute("Note","");primitiveBank.link.setAttribute("BiDirectional",!1);primitiveBank.setting=c.createElement("Setting");primitiveBank.setting.setAttribute("Note","");primitiveBank.setting.setAttribute("Version","34");primitiveBank.setting.setAttribute("Throttle",
"1");primitiveBank.setting.setAttribute("TimeLength","100");primitiveBank.setting.setAttribute("TimeStart","0");primitiveBank.setting.setAttribute("TimeStep","1");primitiveBank.setting.setAttribute("TimeUnits","Years");primitiveBank.setting.setAttribute("Units","");primitiveBank.setting.setAttribute("SolutionAlgorithm","RK1");primitiveBank.setting.setAttribute("BackgroundColor","white");primitiveBank.setting.setAttribute("Macros","");primitiveBank.setting.setAttribute("SensitivityPrimitives","");
primitiveBank.setting.setAttribute("SensitivityRuns",50);primitiveBank.setting.setAttribute("SensitivityBounds","50, 80, 95, 100");primitiveBank.setting.setAttribute("SensitivityShowRuns","false");primitiveBank.setting.setAttribute("StrictUnits","true");mxPanel=Ext.create("Ext.Component",{border:!1});mainPanel=Ext.create("Ext.Panel",{region:"center",border:!1,layout:"fit",items:[mxPanel]});mainPanel.on("resize",function(){graph.sizeDidChange()});configPanel=Ext.create("Ext.Panel",ConfigPanel());ribbonPanel=
Ext.create("Ext.Panel",RibbonPanel(graph,mainPanel,configPanel));new Ext.Viewport({layout:"border",padding:viewConfig.showTopLinks?"19 5 5 5":"5 5 5 5",items:[ribbonPanel,{xtype:"toolbar",region:"south",dock:"bottom",hidden:!1,id:"unfoldToolbar",layout:{align:"bottom"},items:[{iconCls:"units-add-icon",text:getText("View Story"),scope:this,id:"unfoldUnfoldBut",handler:function(){is_editor&&!is_embed&&mxUtils.alert("Edits to the model will not be saved while you are viewing the story.");revealUnfoldButtons(!0);
beginUnfolding()}},{scale:"large",iconAlign:"top",iconCls:"reload-icon",text:getText("Start Over"),scope:this,id:"reloadUnfoldBut",handler:function(){restartUnfolding()}},{hidden:is_ebook,scale:"large",iconAlign:"top",iconCls:"cancel-icon",text:getText("Exit Story"),scope:this,id:"exitUnfoldBut",handler:function(){revealUnfoldButtons(!1);finishUnfolding()}},{html:"",id:"messageUnfoldBut",flex:1,xtype:"box",style:{"font-size":"larger"},margin:"4 10 4 10",align:"middle",minHeight:32},{scale:"large",
iconAlign:"top",iconCls:"next-icon",text:getText("Step Forward"),scope:this,id:"nextUnfoldBut",handler:function(){doUnfoldStep()}}]}]});graph.addListener(mxEvent.CELL_CONNECTED,function(a,b){var c=b.getProperty("edge");"Link"==c.value.nodeName&&linkBroken(c)});graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){b.properties.collapse||a.orderCells(!1,b.properties.cells)});mainPanel.el.insertHtml("beforeBegin","<div id='mainGraph'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>");
mxPanel.el.dom.style.overflow="auto";mxClient.IS_MAC&&mxClient.IS_SF&&graph.addListener(mxEvent.SIZE,function(a){a.container.style.overflow="auto"});graph.model.styleForCellChanged=function(a,b){var c=mxGraphModel.prototype.styleForCellChanged(a,b);propogateGhosts(a);return c};graph.model.addListener(mxEvent.CHANGED,function(){setSaveEnabled(!0)});graph.model.addListener(mxEvent.CHANGE,function(a,b){var c=b.getProperty("changes");10>c.length&&c.animate&&mxEffects.animateChanges(graph,c)});graph.addListener(mxEvent.CELLS_REMOVED,
function(a,b){for(var c=b.getProperty("cells"),d=0;d<c.length;d++)if(deletePrimitive(c[d]),"Folder"==c[d].value.nodeName){var e=childrenCells(c[d]);if(null!=e)for(var f=0;f<e.length;f++)deletePrimitive(e[f])}selectionChanged(!0)});graph.addListener(mxEvent.CLICK,function(a,b){var c=b.getProperty("cell"),d=b.getProperty("event");if(!b.isConsumed()){var e=ribbonPanelItems().getComponent("valued");if((null==c||"Folder"==c.value.nodeName)&&nodeInsertSelected()){var d=graph.getPointForEvent(d),f,g;null!=
c&&"Folder"==c.value.nodeName?(f=c,g=c.geometry.getPoint().x,c=c.geometry.getPoint().y):(f=graph.getDefaultParent(),c=g=0);var h;graph.getModel().beginUpdate();try{if(e.getComponent("stock").pressed?h=graph.insertVertex(f,null,primitiveBank.stock.cloneNode(!0),d.x-50-g,d.y-20-c,100,40,"stock"):e.getComponent("variable").pressed?h=graph.insertVertex(f,null,primitiveBank.variable.cloneNode(!0),d.x-50-g,d.y-25-c,120,50,"variable"):e.getComponent("text").pressed?h=graph.insertVertex(f,null,primitiveBank.text.cloneNode(!0),
d.x-100-g,d.y-25-c,200,50,"text"):e.getComponent("converter").pressed?(h=graph.insertVertex(f,null,primitiveBank.converter.cloneNode(!0),d.x-50-g,d.y-25-c,120,50,"converter"),setConverterInit(h)):e.getComponent("buttonBut").pressed?h=graph.insertVertex(f,null,primitiveBank.button.cloneNode(!0),d.x-50-g,d.y-25-c,120,40,"button"):e.getComponent("picture").pressed&&(h=graph.insertVertex(f,null,primitiveBank.picture.cloneNode(!0),d.x-24-g,d.y-24-c,64,64,"picture"),setPicture(h)),e.getComponent("stock").toggle(!1),
e.getComponent("variable").toggle(!1),e.getComponent("text").toggle(!1),e.getComponent("converter").toggle(!1),e.getComponent("picture").toggle(!1),e.getComponent("buttonBut").toggle(!1),isValued(h)||"Agents"==h.value.nodeName)for(var k=primitives("Display"),e=0;e<k.length;e++){var l=k[e];if(isTrue(l.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=l.getAttribute("Type")&&("Map"!=l.getAttribute("Type")||"Agents"==h.value.nodeName)){var m=l.getAttribute("Primitives");if("undefined"==typeof m)l.setAttribute("Primitives",
h.id);else{var n=m.split(",");n.push(h.id);l.setAttribute("Primitives",n.join(","))}}}}finally{graph.setSelectionCell(h),graph.getModel().endUpdate(),b.consume(),graph.cellEditor.startEditing(h)}}else null==c&&graph.clearSelection()}});graph.init(mxPanel.el.dom);graph.setConnectable(viewConfig.allowEdits);graph.setDropEnabled(!0);graph.setSplitEnabled(!1);graph.connectionHandler.connectImage=new mxImage(builder_path+"/images/connector.gif",16,16);graph.connectionHandler.isConnectableCell=function(a){if(!a||
0===getOpacity(a))return!1;var b=connectionType();if("Link"==a.value.nodeName||"None"==b)return!1;if("Link"==b)return!0;a=orig(a);return"Stock"==a.value.nodeName||"State"==a.value.nodeName};graph.setPanning(!0);graph.setTooltips(!1);graph.connectionHandler.setCreateTarget(!1);new mxRubberband(graph);d=graph.getDefaultParent();graph.popupMenuHandler.factoryMethod=function(a,b,c){c.shiftKey||viewConfig.enableContextMenu&&showContextMenu(null,c)};graph.model.addListener(mxEvent.CHANGED,clearPrimitiveCache);
settingCell=graph.insertVertex(d,null,primitiveBank.setting,20,20,80,40);settingCell.visible=!1;d=graph.insertVertex(d,null,primitiveBank.display.cloneNode(!0),50,20,64,64,"roundImage;image="+builder_path+"/images/DisplayFull.png;");d.visible=!1;d.setAttribute("AutoAddPrimitives",!0);d.setAttribute("name",getText("Default Display"));graph.getEdgeValidationError=function(a,b,c){if(null!=a&&("Flow"==a.value.nodeName||"Transition"==a.value.nodeName)||null==this.model.getValue(a)&&ribbonPanelItems().getComponent("connect").getComponent("flow").pressed){if(isDefined(b)&&
null!==b&&b.isConnectable()&&!("Stock"==b.value.nodeName||"Ghost"==b.value.nodeName&&"Stock"==orig(b).value.nodeName||"State"==b.value.nodeName||"Ghost"==b.value.nodeName&&"State"==orig(b).value.nodeName))return getText("You cannot make that connection.");if(isDefined(c)&&null!==c&&c.isConnectable()){if(!("Stock"==c.value.nodeName||"Ghost"==c.value.nodeName&&"Stock"==orig(c).value.nodeName||"State"==c.value.nodeName||"Ghost"==c.value.nodeName&&"State"==orig(c).value.nodeName))return getText("You cannot make that connection.");
if(isDefined(b)&&null!==b&&b.isConnectable()&&orig(b).value.nodeName!=orig(c).value.nodeName)return getText("You cannot connect stocks to transitions.")}}if(null!=a&&"Link"==a.value.nodeName||null==this.model.getValue(a)&&ribbonPanelItems().getComponent("connect").getComponent("link").pressed)if(isDefined(b)&&null!==b&&"Link"==b.value.nodeName||isDefined(c)&&null!==c&&"Link"==c.value.nodeName)return getText("Links cannot be connected to links.");return mxGraph.prototype.getEdgeValidationError.apply(this,
arguments)};if(null!=graph_source_data&&0<graph_source_data.length||-1==drupal_node_ID)c=mxUtils.parseXml(-1==drupal_node_ID?blankGraphTemplate:graph_source_data),d=new mxCodec(c),d.decode(c.documentElement,graph.getModel()),updateModel();loadBackgroundColor();viewConfig.saveEnabled&&(d=new mxAutoSaveManager(graph),d.autoSaveThreshold=0,d.save=function(){""!=graph_title&&!1==unfoldingManager.unfolding&&saveModel()});d=function(a,b){undoHistory.undoableEditHappened(b.getProperty("edit"))};graph.getModel().addListener(mxEvent.UNDO,
d);graph.getView().addListener(mxEvent.UNDO,d);graph.addListener(mxEvent.CELLS_FOLDED,function(a,b){for(var c=b.properties.cells,d=0;d<c.length;d++)setPicture(c[d]),setLabelPosition(c[d])});var o=ribbonPanelItems(),d=function(){var a=!graph.isSelectionEmpty(),b=a&&(1==graph.getSelectionCount()?"Ghost"!=graph.getSelectionCell().value.nodeName:!0);o.getComponent("valued").getComponent("folder").setDisabled(0>=graph.getSelectionCount());o.getComponent("valued").getComponent("ghostBut").setDisabled(1!=
graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&"Picture"!=graph.getSelectionCell().value.nodeName&&"Agents"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Transition"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName);o.getComponent("actions").getComponent("cut").setDisabled(!a);o.getComponent("actions").getComponent("copy").setDisabled(!a);o.getComponent("actions").getComponent("delete").setDisabled(!a);
o.getComponent("style").getComponent("fillcolor").setDisabled(!(!a||b));o.getComponent("style").getComponent("fontcolor").setDisabled(!b);o.getComponent("style").getComponent("linecolor").setDisabled(!b);o.getComponent("style").getComponent("bold").setDisabled(!b);o.getComponent("style").getComponent("italic").setDisabled(!b);o.getComponent("style").getComponent("underline").setDisabled(!b);fontCombo.setDisabled(!b);sizeCombo.setDisabled(!b);o.getComponent("style").getComponent("align").setDisabled(!b);
o.getComponent("style").getComponent("movemenu").setDisabled(!a);o.getComponent("style").getComponent("picturemenu").setDisabled(!a);o.getComponent("connect").getComponent("reverse").setDisabled(!(a&&(cellsContainNodename(graph.getSelectionCells(),"Link")||cellsContainNodename(graph.getSelectionCells(),"Flow")||cellsContainNodename(graph.getSelectionCells(),"Transition"))));setStyles()};graph.getSelectionModel().addListener(mxEvent.CHANGED,d);clipboardListener=function(){o.getComponent("actions").getComponent("paste").setDisabled(mxClipboard.isEmpty())};
clipboardListener();c=function(){o.getComponent("actions").getComponent("undo").setDisabled(!undoHistory.canUndo());o.getComponent("actions").getComponent("redo").setDisabled(!undoHistory.canRedo())};undoHistory.addListener(mxEvent.ADD,c);undoHistory.addListener(mxEvent.UNDO,c);undoHistory.addListener(mxEvent.REDO,c);d();c();var q=graph.createGroupCell;graph.createGroupCell=function(){var a=q.apply(this,arguments);a.setStyle("folder");a.setValue(primitiveBank.folder.cloneNode(!0));return a};graph.connectionHandler.factoryMethod=
function(a,b){var c,d;ribbonPanelItems().getComponent("connect").getComponent("link").pressed?(c="link",d=primitiveBank.link.cloneNode(!0)):null!=a&&"Stock"==a.value.nodeName||null!=b&&"Stock"==b.value.nodeName?(c="flow",d=primitiveBank.flow.cloneNode(!0)):(c="transition",d=primitiveBank.transition.cloneNode(!0));c=new mxCell(d,new mxGeometry(0,0,100,100),c);c.geometry.setTerminalPoint(new mxPoint(0,100),!0);c.geometry.setTerminalPoint(new mxPoint(100,0),!1);c.edge=!0;c.connectable=!0;return c};graph.getTooltipForCell=
function(a){return null!=a&&null!=a.value.getAttribute("Note")&&0<a.value.getAttribute("Note").length?a.value.getAttribute("Note"):""};var r=new Ext.ToolTip({html:"",hideDelay:0,dismissDelay:0,showDelay:0});graph.tooltipHandler.show=function(a,b,c){null!=a&&0<a.length?(r.update(a),r.showAt([b,c+mxConstants.TOOLTIP_VERTICAL_OFFSET])):r.hide()};graph.tooltipHandler.hide=function(){r.hide()};graph.tooltipHandler.hideTooltip=function(){r.hide()};mxGraphHandler.prototype.guidesEnabled=!0;mxGraphHandler.prototype.mouseDown=
function(a,b){if(!b.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&null!=b.getState()){var c=this.getInitialCellForEvent(b);if(null!==c&&"Button"==c.value.nodeName&&!graph.getSelectionModel().isSelected(c)){if(!1==b.evt.shiftKey)return pressButton(c),b.consume(),graph.allowButtonSelect=!1;graph.allowButtonSelect=!0}this.delayedSelection=this.isDelayedSelection(c);this.cell=null;this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(c,b.getEvent());if(this.isMoveEnabled()){var d=
this.graph.model,e=d.getGeometry(c);this.graph.isCellMovable(c)&&(!d.isEdge(c)||1<this.graph.getSelectionCount()||null!=e.points&&0<e.points.length||null==d.getTerminal(c,!0)||null==d.getTerminal(c,!1)||this.graph.allowDanglingEdges||this.graph.isCloneEvent(b.getEvent())&&this.graph.isCellsCloneable())&&this.start(c,b.getX(),b.getY());this.cellWasClicked=!0;!mxClient.IS_SF&&!mxClient.IS_GC||"SELECT"!=b.getSource().nodeName?b.consume():mxClient.IS_SF&&"SELECT"==b.getSource().nodeName&&(this.cellWasClicked=
!1,this.first=null)}}};mxGuide.prototype.isEnabledForEvent=function(a){return!mxEvent.isAltDown(a)};d=function(a,b){var c=b.getProperty("edit").changes;graph.setSelectionCells(graph.getSelectionCellsForChanges(c))};undoHistory.addListener(mxEvent.UNDO,d);undoHistory.addListener(mxEvent.REDO,d);viewConfig.focusDiagram&&graph.container.focus();setTopLinks();is_topBar||toggleTopBar();is_sideBar||configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1);mxKeyHandler.prototype.isGraphEvent=function(a){if(a.altKey||
a.shiftKey)return!1;a=Ext.WindowManager.getActive();return isDefined(a)&&null!==a&&a.modal?!1:isUndefined(Ext.FocusManager.focusedCmp)||"x-container"==Ext.FocusManager.focusedCmp.componentCls||"x-window"==Ext.FocusManager.focusedCmp.componentCls||"x-panel"==Ext.FocusManager.focusedCmp.componentCls||"x-panel-header"==Ext.FocusManager.focusedCmp.componentCls||"x-window-header"==Ext.FocusManager.focusedCmp.componentCls||"x-btn-group"==Ext.FocusManager.focusedCmp.componentCls};d=new mxKeyHandler(graph);
d.getFunction=function(a){return null!=a?mxEvent.isControlDown(a)||mxClient.IS_MAC&&a.metaKey?this.controlKeys[a.keyCode]:this.normalKeys[a.keyCode]:null};d.bindKey(13,function(){graph.foldCells(!1)});d.bindControlKey(65,function(){graph.selectAll()});d.bindControlKey(66,function(){viewConfig.allowEdits&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});d.bindControlKey(73,function(){viewConfig.allowEdits&&
(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});d.bindControlKey(85,function(){viewConfig.allowEdits&&(graph.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(graph.getSelectionCells(),"Ghost")),setStyles())});d.bindControlKey(89,function(){undoHistory.redo()});d.bindControlKey(90,function(){undoHistory.undo()});d.bindControlKey(67,function(){mxClipboard.copy(graph);
clipboardListener()});d.bindControlKey(13,function(){runModel()});d.bindControlKey(75,function(){scratchpadFn()});viewConfig.allowEdits&&(d.bindKey(8,function(){graph.removeCells(graph.getSelectionCells(),!1)}),d.bindKey(46,function(){graph.removeCells(graph.getSelectionCells(),!1)}),d.bindControlKey(88,function(){mxClipboard.cut(graph);clipboardListener()}),d.bindControlKey(83,function(){saveModel()}),d.bindControlKey(86,function(){mxClipboard.paste(graph);clipboardListener()}),d.bindControlKey(192,
function(){var a=graph.getSelectionCell();isDefined(a)&&null!=a&&(new Ext.RichTextWindow({parent:"",cell:a,html:getNote(a)})).show()}));d.bindControlKey(69,function(){doSensitivity()});d.bindControlKey(76,function(){timeSettingsFn()});d.bindControlKey(70,function(){showFindAndReplace()});d.bindControlKey(71,function(){var a=Ext.getCmp("findNextBut");a&&!a.disabled&&findNext()});d.bindControlKey(80,function(){var a=mxUtils.prompt(getText("Enter page count for printing")+":","1");null!=a&&(a=mxUtils.getScaleForPageCount(a,
graph),(new mxPrintPreview(graph,a)).open())});graph.getSelectionModel().addListener(mxEvent.CHANGE,function(){selectionChanged(!1)});var u=function(a){var a=a.split(","),b=primitives();if(null!=b)for(var c=0;c<b.length;c++)-1<Ext.Array.indexOf(a,b[c].id)&&(a[Ext.Array.indexOf(a,b[c].id)]=b[c].getAttribute("name"));return a.join(", ")};selectionChanged=function(a){function b(a,c){return"<a href='"+a+"' class='description_link' target='_blank'>Learn more about "+c+" &rsaquo;</a><div style='clear:both'></div>"}
isDefined(grid)&&(grid.plugins[0].completeEdit(),configPanel.removeAll());var c=graph.getSelectionCell();a&&(c=null);var a=[],d=[],e=[],f;null!=c&&(f=c.value.nodeName);if(null!=c&&1==graph.getSelectionCells().length&&"Ghost"!=f){if(configPanel.setTitle(getText(f)),e=[{name:"Note",text:getText("Note"),value:c.getAttribute("Note"),group:"  "+getText("General"),editor:new Ext.form.customFields.richText({})},{name:"name",text:getText("(name)"),value:c.getAttribute("name"),group:"  "+getText("General")}],
(isValued(c)||"Agents"==c.value.nodeName)&&"State"!=c.value.nodeName&&"Action"!=c.value.nodeName)viewConfig.allowEdits&&"Converter"!=c.value.nodeName&&(e.push({name:"ShowSlider",text:getText("Show Value Slider"),value:isTrue(c.getAttribute("ShowSlider")),group:getText("Slider")}),e.push({name:"SliderMax",text:getText("Slider Max"),value:parseFloat(c.getAttribute("SliderMax")),group:getText("Slider"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderMin",text:getText("Slider Min"),
value:parseFloat(c.getAttribute("SliderMin")),group:getText("Slider"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"SliderStep",text:getText("Slider Step"),value:c.getAttribute("SliderStep"),group:getText("Slider"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!0,decimalPrecision:9}})),"Transition"!=c.value.nodeName&&"Agents"!=c.value.nodeName&&e.push({name:"Units",text:getText("Units"),value:c.getAttribute("Units"),group:getText("Validation"),editor:new Ext.form.customFields.units({})}),
viewConfig.allowEdits&&"Agents"!=c.value.nodeName&&(e.push({name:"MaxConstraintUsed",text:getText("Max Constraint"),value:isTrue(c.getAttribute("MaxConstraintUsed")),group:getText("Validation")}),e.push({name:"MaxConstraint",text:getText("Max Constraint"),value:parseFloat(c.getAttribute("MaxConstraint")),group:getText("Validation"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}),e.push({name:"MinConstraintUsed",text:getText("Min Constraint"),value:isTrue(c.getAttribute("MinConstraintUsed")),
group:getText("Validation")}),e.push({name:"MinConstraint",text:getText("Min Constraint"),value:parseFloat(c.getAttribute("MinConstraint")),group:getText("Validation"),editor:{xtype:"numberfield",allowDecimals:!0,decimalPrecision:9}}))}else configPanel.setTitle("");var g="<br/><img style='float:left; margin-right: 7px' src='"+builder_path+"/images/gui/help.png' width=32px height=32px />",h="",k="";if(null==c||1<graph.getSelectionCells().length)if(f=sliderPrimitives(),-1==drupal_node_ID&&0==f.length)h=
is_ebook?"<center><big>Select a primitive to see its properties.</big></center>":"<center><a href='http://www.youtube.com/watch?v=uH5zM7J-eHU' target='_blank'><img src='"+builder_path+"/images/Help.jpg' width=217 height=164 /></a><br/><br/><br/>Or take a look at the <a href='http://InsightMaker.com/help' target='_blank'>Detailed Insight Maker Manual</a><br/><br/>There is also a <a href='http://www.systemswiki.org/index.php?title=Modeling_%26_Simulation_with_Insight_Maker' target='_blank'>free, on-line education course</a> which teaches you how to think in a systems manner using Insight Maker.</center>";
else{h=clean(graph_description);""==h&&-1!=drupal_node_ID&&viewConfig.saveEnabled&&(h="<span style='color: #555'>"+getText("You haven't entered a description for this Insight yet. Please enter one to help others understand it.")+"</span>");""!=h&&(h="<div class='sidebar_description'>"+h+"</div>");-1!=drupal_node_ID&&null==c&&(h=h+' <div class="sidebar_share"> '+getText("Share")+' <span  id="st_facebook_button" displayText="Facebook"></span><span  id="st_twitter_button" displayText="Tweet"></span><span  id="st_linkedin_button" displayText="LinkedIn"></span><span  id="st_mail_button" displayText="EMail"></span></div>'+
(is_editor?'<div class="sidebar_edit"><a href="#" onclick="updateProperties()">'+getText("Edit description")+"</a></div>":""));if(""!=graph_tags.trim()){var l="";graph_tags.split(",").forEach(function(a){a=a.trim();l=l+"<a target='_blank' href='/tag/"+clean(a.replace(/ /g,"-"))+"'>"+clean(a)+"</a> "});h=h+"<div class='sidebar_tags'>Tags: "+l+"</div>"}!is_editor&&""!=graph_author_name&&(h=h+"<div class='sidebar_author'>Insight Author: <a target='_blank' href='/user/"+clean(graph_author_id)+"'>"+clean(graph_author_name)+
"</a></div>");0<f.length&&(a.push(createSliders(!1,setValue,function(a,b,c,d){Ext.Msg.confirm("Change Value","<p>The current value of the primitive is:</p><br/><p><pre>"+getValue(a.sliderCell).replace(/\\n/g,"\n")+"</pre></p><br/><p>Are you sure you want to change this value using the slider?</p>",function(e){"yes"==e?b(a.sliderCell,parseFloat(d)):(c.setRawValue(""),a.setValue(void 0));a.confirming=!1})})),a.push({xtype:"component",html:"<br/><br/>"}))}else if("Stock"==f)k=g+"A stock stores a material or a resource. Lakes and Bank Accounts are both examples of stocks. One stores water while the other stores money. The Initial Value defines how much material is initially in the Stock. "+
b("/stocks","Stocks"),e.push({name:"InitialValue",text:getText("Initial Value")+" =",value:c.getAttribute("InitialValue"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"AllowNegatives",text:getText("Allow Negatives"),value:!isTrue(c.getAttribute("NonNegative")),group:" "+getText("Configuration")}),e.push({name:"StockMode",text:getText("Stock Type"),value:c.getAttribute("StockMode"),group:getText("Behavior"),editor:new Ext.form.ComboBox({triggerAction:"all",
store:[["Store",getText("Store")],["Conveyor",getText("Conveyor")]],selectOnFocus:!0})}),e.push({name:"Delay",text:getText("Delay"),value:isDefined(c.getAttribute("Delay"))?c.getAttribute("Delay").toString():"",group:getText("Behavior"),renderer:equationRenderer});else if("Variable"==f)k=g+"A variable is a dynamically updated object in your model that synthesizes available data or provides a constant value for use in your equations. The birth rate of a population or the maximum volume of water in a lake are both possible uses of variables."+
b("/variables","Variables"),e.push({name:"Equation",text:getText("Value/Equation")+" =",value:c.getAttribute("Equation"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Link"==c.value.nodeName)k=g+"Links connect the different parts of your model. If one primitive in your model refers to another in its equation, the two primitives must either be directly connected or connected through a link. Once connected with links, square-brackets may be used to reference values of other primitives. So if you have a stock called <i>Bank Balance</i>, you could refer to it in another primitive's equation with <i>[Bank Balance]</i>."+
b("/links","Links"),e.push({name:"BiDirectional",text:getText("Bi-Directional"),value:isTrue(c.getAttribute("BiDirectional")),group:" "+getText("Configuration")});else if("Folder"==c.value.nodeName)k=g+"Folders group together similar items in a logical way. You can collapse and expand folders to hide or reveal model complexity.",e.push({name:"Type",text:getText("Behavior"),value:c.getAttribute("Type"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:[["None",
getText("None")],["Agent",getText("Agent")]],editable:!1,selectOnFocus:!0})}),e.push({name:"Solver",text:getText("Time Settings"),value:c.getAttribute("Equation"),group:" "+getText("Configuration"),renderer:renderTimeBut}),e.push({name:"AgentBase",text:getText("Agent Parent"),value:c.getAttribute("AgentBase"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Button"==c.value.nodeName)k=g+"Buttons are used for interactivity. To select a button without triggering its action, hold down the Shift key when you click the button. Buttons are currently in Beta and their implementation may change in later versions of Insight Maker. Available button API commands are <a href='http://insightmaker.com/sites/default/files/API/' target='_blank'>available here</a>."+
b("/scripting","Model Scripting"),e.push({name:"Function",text:getText("Action"),value:c.getAttribute("Function"),group:" "+getText("Configuration"),editor:new Ext.form.TextArea({grow:!0,growMax:80})}),e.push({name:"xx",text:" ",value:"",group:" "+getText("Configuration"),editor:new Ext.form.TextArea({grow:!0,growMax:80,style:"display:none"})}),e.push({name:"xy",text:" ",value:"",group:" "+getText("Configuration"),editor:new Ext.form.TextArea({grow:!0,growMax:80,style:"display:none"})});else if("Flow"==
c.value.nodeName)k=g+"Flows represent the transfer of material from one stock to another. For example given the case of a lake, the flows for the lake might be: River Inflow, River Outflow, Precipitation, and Evaporation. Flows are given a flow rate and they operator over one unit of time; in effect: flow per one second or per one minute."+b("/flows","Flows"),e.push({name:"FlowRate",text:getText("Flow Rate")+" =",value:c.getAttribute("FlowRate"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),
renderer:equationRenderer}),e.push({name:"OnlyPositive",text:getText("Only Positive Rates"),value:isTrue(c.getAttribute("OnlyPositive")),group:" "+getText("Configuration")});else if("Transition"==c.value.nodeName)k=g+"Transitions move agents between states. You can have transitions trigger based on some condition, a probability, or a timeout."+b("/transitions","Transitions"),e.push({name:"Trigger",text:getText("Triggered by"),value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",
store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!0})}),e.push({name:"Value",text:getText("Value")+" =",value:c.getAttribute("Value"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"Repeat",text:getText("Repeat"),value:isTrue(c.getAttribute("Repeat")),group:" "+getText("Configuration")}),e.push({name:"Recalculate",text:getText("Recalculate"),value:isTrue(c.getAttribute("Recalculate")),group:" "+getText("Configuration")});
else if("Action"==c.value.nodeName)k=g+"Action primitives can be used to execute some action such as moving agents or dynamically create connections between them."+b("/actions","Actions"),e.push({name:"Trigger",text:getText("Triggered by"),value:c.getAttribute("Trigger"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:["Timeout","Probability","Condition"],editable:!1,selectOnFocus:!0})}),e.push({name:"Value",text:getText("Trigger Value")+" =",value:c.getAttribute("Value"),
group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"Action",text:getText("Action")+" =",value:c.getAttribute("Action"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"Repeat",text:getText("Repeat"),value:isTrue(c.getAttribute("Repeat")),group:" "+getText("Configuration")}),e.push({name:"Recalculate",text:getText("Recalculate"),value:isTrue(c.getAttribute("Recalculate")),
group:" "+getText("Configuration")});else if("State"==c.value.nodeName)k=g+"The primitive representing the current state of an agent. A boolean yes/no property. You can connect states with transitions to move an agent between states."+b("/states","States"),e.push({name:"Active",text:getText("Start Active")+" = ",value:c.getAttribute("Active"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer}),e.push({name:"Residency",text:getText("Residency")+
" = ",value:c.getAttribute("Residency"),group:" "+getText("Configuration"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});else if("Agents"==c.value.nodeName){k=g+"Agent populations hold a collection of agents: individually simulated entities which may interact with each other."+b("/agentpopulations","Agent Populations");f=[];for(var m=primitives("Folder"),g=0;g<m.length;g++)"Agent"==m[g].getAttribute("Type")&&f.push([m[g].id,clean(m[g].getAttribute("name"))]);f=new Ext.data.ArrayStore({id:0,
fields:["myId","displayText"],data:f});e.push({name:"Agent",text:getText("Agent Base"),value:c.getAttribute("Agent"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!0,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:u});e.push({name:"Size",text:getText("Population Size"),value:c.getAttribute("Size"),group:" "+getText("Configuration"),editor:{xtype:"numberfield",minValue:0,allowDecimals:!1}});e.push({name:"GeoWidth",
text:getText("Width"),value:c.getAttribute("GeoWidth"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"GeoHeight",text:getText("Height"),value:c.getAttribute("GeoHeight"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"GeoDimUnits",text:getText("Dimension Units"),value:c.getAttribute("GeoDimUnits"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.units({})});
e.push({name:"GeoWrap",text:getText("Wrap Around"),value:isTrue(c.getAttribute("GeoWrap")),group:" "+getText("Geometry")});e.push({name:"Placement",text:getText("Placement Method"),value:c.getAttribute("Placement"),group:" "+getText("Geometry"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!0,editable:!1,store:[["Random",getText("Random")],["Grid",getText("Grid")],["Ellipse",getText("Ellipse")],["Network",getText("Network")],["Custom Function",getText("Custom Function")]]}),
renderer:u});e.push({name:"PlacementFunction",text:getText("Custom Function"),value:c.getAttribute("PlacementFunction"),group:" "+getText("Geometry"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer});e.push({name:"Network",text:getText("Network Structure"),value:c.getAttribute("Network"),group:" "+getText("Network"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",selectOnFocus:!0,editable:!1,store:[["None",getText("None")],["Custom Function",getText("Custom Function")]]})});
e.push({name:"NetworkFunction",text:getText("Custom Function"),value:c.getAttribute("NetworkFunction"),group:" "+getText("Network"),editor:new Ext.form.customFields.code({}),renderer:equationRenderer})}else if("Ghost"==f)k=g+"This item is a 'Ghost' of another primitive. It mirrors the values and properties of its source primitive. You cannot edit the properties of the Ghost. You need to instead edit the properties of its source.<br/><p><center><a href='#' onclick='var x = findID(getSelected()[0].getAttribute(\"Source\"));highlight(x);'>Show Source</a></center></p>"+
b("/ghosting","Ghosts");else if("Converter"==f){k=g+"Converters store a table of input and output data. When the input source takes on one of the input values, the converter takes on the corresponding output value. If no specific input value exists for the current input source value, then the nearest input neighbors are averaged. "+b("/converters","Converters");m=neighborhood(c);f=[["Time","Time"]];for(g=0;g<m.length;g++)m[g].linkHidden||f.push([m[g].item.id,clean(m[g].item.getAttribute("name"))]);
f=new Ext.data.ArrayStore({id:0,fields:["myId","displayText"],data:f});e.push({name:"Source",text:getText("Input Source"),value:c.getAttribute("Source"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",queryMode:"local",store:f,selectOnFocus:!0,valueField:"myId",editable:!1,displayField:"displayText"}),renderer:u});e.push({name:"Data",text:getText("Data"),value:c.getAttribute("Data"),group:getText("Input/Output Table"),editor:new Ext.form.customFields.converter({})});
e.push({name:"Interpolation",text:getText("Interpolation"),value:c.getAttribute("Interpolation"),group:" "+getText("Configuration"),editor:new Ext.form.ComboBox({triggerAction:"all",store:[["None",getText("None")],["Linear",getText("Linear")]],editable:!1,selectOnFocus:!0})})}else"Picture"==f&&(k=g+"Pictures can make your model diagram come alive. Use the picture settings in the Styles section of the main toolbar to change the picture."+b("/diagramming","Modeling Diagramming"));configPanel.removeAll();
""!=h&&d.push(Ext.create("Ext.Component",{html:'<div class="'+(-1==drupal_node_ID?"":"sidebar_top")+'">'+h+"</div>"}));""!=k&&a.push(Ext.create("Ext.Component",{html:'<div class="sidebar_bottom">'+k+"</div>"}));createGrid(e,d,a,c);if(-1!=drupal_node_ID)try{stWidget.addEntry({service:"twitter",element:document.getElementById("st_twitter_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description}),
stWidget.addEntry({service:"facebook",element:document.getElementById("st_facebook_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description}),stWidget.addEntry({service:"linkedin",element:document.getElementById("st_linkedin_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",
summary:graph_description}),stWidget.addEntry({service:"email",element:document.getElementById("st_mail_button"),url:"http://InsightMaker.com/insight/"+drupal_node_ID,title:graph_title,type:"chicklet",image:"http://insightmaker.com/sites/default/files/logo.png",summary:graph_description})}catch(n){}};selectionChanged(!1);-1==drupal_node_ID?setSaveEnabled(!0):setSaveEnabled(!1);updateWindowTitle();saved_enabled||ribbonPanelItems().getComponent("savegroup").setVisible(!1);handelCursors();handleUnfoldToolbar();
is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit())}var surpressCloseWarning=!1;function confirmClose(){if(surpressCloseWarning)surpressCloseWarning=!1;else if(saved_enabled&&!ribbonPanelItems().getComponent("savegroup").getComponent("savebut").disabled)return getText("You have made unsaved changes to this Insight. If you close now, they will be lost.")}Ext.EventManager.on(window,"beforeunload",function(){return confirmClose()});
Ext.example=function(){var a;return{msg:function(b,c){a||(a=Ext.core.DomHelper.insertFirst(document.body,{id:"msg-div"},!0));var d=Ext.String.format.apply(String,Array.prototype.slice.call(arguments,1)),d=Ext.core.DomHelper.append(a,'<div class="msg"><h3>'+b+"</h3><p>"+d+"</p></div>",!0);d.hide();d.slideIn("t").ghost("t",{delay:4500,remove:!0})}}}();Ext.round=function(a,b){var c=Number(a);"number"==typeof b&&(b=Math.pow(10,b),c=Math.round(a*b)/b);return c};
var makeGhost=function(){var a=graph.getSelectionCell(),b=graph.getDefaultParent(),c=getPosition(a),d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",30);graph.getModel().beginUpdate();b=graph.insertVertex(b,null,primitiveBank.ghost.cloneNode(!0),c[0]+10,c[1]+10,a.getGeometry().width,a.getGeometry().height,d);b.value.setAttribute("Source",a.id);b.value.setAttribute("name",a.getAttribute("name"));graph.setSelectionCell(b);graph.getModel().endUpdate()},makeFolder=function(){var a=graph.groupCells(null,
20);a.setConnectable(!0);graph.setSelectionCell(a);graph.orderCells(!0)};
function showContextMenu(a,b){var c=getSelected(),d=!1;0<c.length&&(d="Folder"==c[0].value.nodeName&&!getCollapsed(c[0]));var e=0<c.length&&!d,f=[];e?f=[{text:getText("Ghost Primitive"),iconCls:"ghost-icon",disabled:1!=graph.getSelectionCount()||!isValued(graph.getSelectionCell())&&"Picture"!=graph.getSelectionCell().value.nodeName||"Flow"==graph.getSelectionCell().value.nodeName||"Ghost"==graph.getSelectionCell().value.nodeName,handler:makeGhost},{text:getText("Create Folder"),iconCls:"folder-icon",
disabled:!e,handler:makeFolder},,"-",{text:getText("Delete"),iconCls:"delete-icon",disabled:!e,handler:function(){graph.removeCells(graph.getSelectionCells(),!1)}}]:(f=[{text:getText("Create Stock"),iconCls:"stock-icon-small",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Stock"),"Stock",[a.x,a.y],[100,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Variable"),
iconCls:"parameter-icon-small",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Variable"),"Variable",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Converter"),iconCls:"converter-icon",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Converter"),"Converter",[a.x,a.y],
[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},"-",{text:getText("Create State"),handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New State"),"State",[a.x,a.y],[100,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Action"),handler:function(){graph.model.beginUpdate();
var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Action"),"Action",[a.x,a.y],[120,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Agent Population"),handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("Agent Population"),"Agents",[a.x,a.y],[170,80]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},
20)}},"-",{text:getText("Create Text"),iconCls:"font-icon",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Text"),"Text",[a.x,a.y],[200,50]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Picture"),iconCls:"picture-icon",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive("","Picture",[a.x,a.y],[64,64]);
graph.model.endUpdate();d&&setParent(e,c[0]);setPicture(e);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}},{text:getText("Create Button"),iconCls:"button-icon",handler:function(){graph.model.beginUpdate();var a=graph.getPointForEvent(b),e=createPrimitive(getText("New Button"),"Button",[a.x,a.y],[120,40]);graph.model.endUpdate();d&&setParent(e,c[0]);setSelected(e);setTimeout(function(){graph.cellEditor.startEditing(e)},20)}}],is_ebook||(f=f.concat(["-",{text:getText("Insert Insight Maker Model"),
handler:function(){showInsertModelWindow(graph.getPointForEvent(b))}}])));(new Ext.menu.Menu({items:f})).showAt([mxEvent.getClientX(b)+1,mxEvent.getClientY(b)+1])}var blankGraphTemplate='<mxGraphModel>\n  <root>\n    <mxCell id="0"/>\n    <mxCell id="1" parent="0"/>\n    <Picture name="" Note="" Image="http://insightmaker.com/builder/images/rabbit.jpg" FlipHorizontal="false" FlipVertical="false" LabelPosition="Bottom" id="17">\n      <mxCell style="picture;image=http://insightmaker.com/builder/images/rabbit.jpg;imageFlipV=0;imageFlipH=0;shape=image" parent="1" vertex="1">\n        <mxGeometry x="10" y="192.75" width="210" height="224.25" as="geometry"/>\n      </mxCell>\n    </Picture>\n    <Setting Note="" Version="25" TimeLength="20" TimeStart="0" TimeStep="1" TimeUnits="Years" StrictUnits="true" Units="" HiddenUIGroups="Validation,User Interface" SolutionAlgorithm="RK1" BackgroundColor="white" Throttle="1" Macros="" SensitivityPrimitives="" SensitivityRuns="50" SensitivityBounds="50, 80, 95, 100" SensitivityShowRuns="false" id="2">\n      <mxCell parent="1" vertex="1" visible="0">\n        <mxGeometry x="20" y="20" width="80" height="40" as="geometry"/>\n      </mxCell>\n    </Setting>\n    <Display name="Default Display" Note="" Type="Time Series" xAxis="Time (%u)" yAxis="" ThreeDimensional="false" Primitives="4" AutoAddPrimitives="true" ScatterplotOrder="X Primitive, Y Primitive" Image="Display" yAxis2="" Primitives2="" showMarkers="false" showLines="true" showArea="false" id="3">\n      <mxCell style="roundImage;image=/builder/images/DisplayFull.png;" parent="1" vertex="1" visible="0">\n        <mxGeometry x="50" y="20" width="64" height="64" as="geometry"/>\n      </mxCell>\n    </Display>\n    <Stock name="Rabbits" Note="The number of rabbits currently alive." InitialValue="200" StockMode="Store" Delay="10" Volume="100" NonNegative="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="1000" SliderMin="0" Image="None" AllowNegatives="true" LabelPosition="Middle" FlipHorizontal="false" FlipVertical="false" id="4">\n      <mxCell style="stock;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="407.5" y="422" width="100" height="40" as="geometry"/>\n      </mxCell>\n    </Stock>\n    <Flow name="Births" Note="The number of rabbits born each year." FlowRate="[Rabbits]*[Rabbit Birth Rate]" OnlyPositive="true" TimeIndependent="false" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="100" SliderMin="0" id="5">\n      <mxCell style="" parent="1" target="4" edge="1">\n        <mxGeometry x="47.5" y="32" width="100" height="100" as="geometry">\n          <mxPoint x="457.5" y="184.5" as="sourcePoint"/>\n          <mxPoint x="57.5" y="282" as="targetPoint"/>\n          <mxPoint x="-0.5" y="5" as="offset"/>\n        </mxGeometry>\n      </mxCell>\n    </Flow>\n    <Variable name="Rabbit Birth Rate" Note="The proportional increase in the number of rabbits per year." Equation="0.1" Units="Unitless" MaxConstraintUsed="false" MinConstraintUsed="false" MaxConstraint="100" MinConstraint="0" ShowSlider="false" SliderMax="1" SliderMin="0" Image="None" LabelPosition="Middle" FlipHorizontal="false" FlipVertical="false" id="6">\n      <mxCell style="parameter;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="551.25" y="157" width="140" height="50" as="geometry"/>\n      </mxCell>\n    </Variable>\n    <Text name="&amp;larr; This is a Stock" LabelPosition="Middle" id="8">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="536.25" y="392" width="160" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Stocks store things like money or water or, in this case, rabbits." LabelPosition="Middle" id="9">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="516.25" y="428.5" width="210" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="This is a Flow &amp;rarr;" LabelPosition="Middle" id="10">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="267.5" y="182" width="150" height="50" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Flows move material between Stocks. In this case it represents the birth of new rabbits." LabelPosition="Middle" id="11">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="227.5" y="224.5" width="210" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="This is a Variable&#xa;" LabelPosition="Middle" id="12">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="496.25" y="62" width="245" height="35" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Link name="Link" Note="" BiDirectional="false" id="7">\n      <mxCell style="entity" parent="1" source="6" target="5" edge="1">\n        <mxGeometry x="47.5" y="32" width="100" height="100" as="geometry">\n          <mxPoint x="47.5" y="132" as="sourcePoint"/>\n          <mxPoint x="147.5" y="32" as="targetPoint"/>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Text name="&amp;larr; This is a Link" LabelPosition="Middle" id="13">\n      <mxCell style="textArea;fontStyle=1;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="511.25" y="247" width="210" height="30" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="It allows the equation for &lt;i&gt;Births&lt;/i&gt; to reference the &lt;i&gt;Rabbit Birth Rate&lt;/i&gt;." LabelPosition="Middle" id="14">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;align=center;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="516.25" y="271.5" width="210" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="Here is a simple model to get you started. It simulates a rabbit population over the course of 20 years. Luckily for these rabbits, there is no rabbit mortality! &#xa;&#xa;Click the &lt;i&gt;Run Simulation&lt;/i&gt; button on the right of the toolbar to see how the rabbit population will grow over time." LabelPosition="Middle" id="15">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Times New Roman;fontSize=18;strokeColor=none;fontColor=#333300;align=left;fillColor=none;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="15" y="12.75" width="405" height="150" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name=" Move your mouse over it and click the &quot;=&quot; to inspect its value.&#xa;&amp;darr;" LabelPosition="Middle" id="18">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#000000;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="492.5" y="92" width="257.5" height="60" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Text name="&lt;b&gt;Adding Primitives:&lt;/b&gt; Select type in toolbar and then click in the canvas.&#xa;&lt;b&gt;Adding Connections:&lt;/b&gt; Select type in toolbar, hover mouse over connectable primitive and drag arrow." LabelPosition="Middle" id="21">\n      <mxCell style="textArea;fontStyle=0;fontFamily=Verdana;fontSize=14;strokeColor=none;fontColor=#808080;align=center;labelBackgroundColor=none" parent="1" vertex="1">\n        <mxGeometry x="5" y="480" width="745" height="70" as="geometry"/>\n      </mxCell>\n    </Text>\n    <Link name="Link" Note="" BiDirectional="false" id="22">\n      <mxCell style="entity" parent="1" source="4" target="5" edge="1">\n        <mxGeometry width="100" height="100" as="geometry">\n          <mxPoint y="100" as="sourcePoint"/>\n          <mxPoint x="100" as="targetPoint"/>\n          <Array as="points">\n            <mxPoint x="380" y="420"/>\n            <mxPoint x="360" y="380"/>\n            <mxPoint x="360" y="340"/>\n            <mxPoint x="380" y="310"/>\n            <mxPoint x="407" y="292"/>\n            <mxPoint x="440" y="290"/>\n          </Array>\n        </mxGeometry>\n      </mxCell>\n    </Link>\n    <Button name="Clear Sample Model" Note="" Function="clearModel()" Image="None" FlipHorizontal="false" FlipVertical="false" LabelPosition="Middle" id="23">\n      <mxCell style="button;fontSize=20;fillColor=#FFFF99;strokeColor=#FF9900;fontColor=#0000FF;fontStyle=5" parent="1" vertex="1">\n        <mxGeometry x="80" y="418.5" width="240" height="60" as="geometry"/>\n      </mxCell>\n    </Button>\n  </root>\n</mxGraphModel>\n';var analysisCount=0;function getGraphXml(a){a=(new mxCodec(mxUtils.createXmlDocument())).encode(a.getModel());return mxUtils.getPrettyXml(a)}
function sendGraphtoServer(a){Ext.Ajax.request({url:builder_path+"/save.php",method:"POST",params:{data:getGraphXml(a),nid:drupal_node_ID,title:graph_title,description:graph_description,tags:graph_tags},success:function(a){parseInt(a.responseText)!=a.responseText?console.log("Insight Save Issue:\n\n"+a.responseText):(drupal_node_ID=a.responseText,setSaveEnabled(!1),updateWindowTitle(),setTopLinks())},failure:function(a){console.log("Insight Not Saved:\n\n"+a.responseText)}})}
function validPrimitiveName(a,b){if("Stock"==b.value.nodeName||"Variable"==b.value.nodeName||"Converter"==b.value.nodeName||"Flow"==b.value.nodeName||"Display"==b.value.nodeName||"Agents"==b.value.nodeName||"Transition"==b.value.nodeName||"State"==b.value.nodeName){if(0<a.length&&!/[\[\]\(\)\{\}\<\>\'\"]/.test(a))return!0;mxUtils.alert(getText("Primitive names cannot contain brackets, parenthesis, or quotes."));return!1}return!0}
function isPrimitive(a){return!("Button"==a.value.nodeName||"Picture"==a.value.nodeName||"Text"==a.value.nodeName)}function cellsContainNodename(a,b){for(var c=0;c<a.length;c++)if(a[c].value.nodeName==b)return!0}
function nodeInsertSelected(){var a=ribbonPanelItems().getComponent("valued");return a.getComponent("stock").pressed||a.getComponent("variable").pressed||a.getComponent("text").pressed||a.getComponent("converter").pressed||a.getComponent("picture").pressed||a.getComponent("buttonBut").pressed}function connectionType(){return ribbonPanelItems().getComponent("connect").getComponent("link").pressed?"Link":ribbonPanelItems().getComponent("connect").getComponent("flow").pressed?"Flow":"None"}
function setAllConnectable(){graph.setConnectable(!0);for(var a=primitives(),b=0;b<a.length;b++)a[b].setConnectable(!0)}var primitiveCache={};function primitives(a){if(primitiveCache[" "+a])return primitiveCache[" "+a];var b=childrenCells(graph.getModel().getChildren(graph.getModel().getRoot())[0]);if(null==a)primitiveCache[" "+a]=b;else{for(var c=[],d=0;d<b.length;d++)b[d].value.nodeName==a&&c.push(b[d]);primitiveCache[" "+a]=c}return primitiveCache[" "+a]}
function childrenCells(a){a=graph.getModel().getChildren(a);if(null!=a){for(var b=[],c=0;c<a.length;c++)"Folder"==a[c].value.nodeName&&(b=b.concat(childrenCells(a[c])));a=a.concat(b);for(c=a.length-1;0<=c;c--)(null==a[c]||null==a[c].value)&&a.splice(c,1);return a}return null}var neighborhoodCache={};function clearPrimitiveCache(){primitiveCache={};neighborhoodCache={}}
function neighborhood(a){function b(a,b){var c=[];if("Agents"==orig(a).value.nodeName&&orig(a).getAttribute("Agent")){var d=orig(a).getAttribute("Agent");d&&getChildren(findID(d)).forEach(function(a){isValued(a)&&"Ghost"!=a.value.nodeName&&c.push({item:a,type:"agent",linkHidden:b,name:a.getAttribute("name")})})}return c.sort(function(a,b){return a.name==b.name?0:a.name>b.name?1:-1})}var c=inAgent(a);if(neighborhoodCache[a.id])return neighborhoodCache[a.id];var d=[],e=primitives();if(null!=e)if(null!=
a){var f=[],g=[];a.isEdge()&&(null!==orig(a.source)&&d.push({item:orig(a.source),type:"direct"}),null!==orig(a.target)&&d.push({item:orig(a.target),type:"direct"}));"Agents"==a.value.nodeName&&a.getAttribute("Agent")&&(d=d.concat(b(a)));for(var h=0;h<e.length;h++)"Flow"==e[h].value.nodeName?f.push(orig(e[h])):"Link"==e[h].value.nodeName&&g.push(orig(e[h]));for(h=0;h<f.length;h++)f[h].source==a&&d.push({item:f[h],type:"direct",linkHidden:!0}),f[h].target==a&&d.push({item:f[h],type:"direct",linkHidden:!0});
for(h=0;h<g.length;h++)if(g[h].source==a&&isDefined(g[h].target)&&null!==g[h].target&&(e=!isTrue(g[h].getAttribute("BiDirectional")),d.push({item:orig(g[h].target),type:"direct",linkHidden:e}),d=d.concat(b(g[h].target,e))),g[h].target==a&&isDefined(g[h].source)&&null!==g[h].source&&(!inAgent(orig(g[h].source))||c))d.push({item:orig(g[h].source),type:"direct"}),d=d.concat(b(g[h].source))}else for(h=0;h<e.length;h++)isValued(e[h])&&d.push({item:orig(e[h]),type:"direct"});d=Ext.Array.clean(d);c=[];for(h=
0;h<d.length;h++){g=!1;for(e=0;e<c.length;e++)if(c[e].type==d[h].type&&c[e].item.id==d[h].item.id){g=!0;break}g||(isValued(d[h].item)||"Agents"==d[h].item.value.nodeName)&&c.push(d[h])}return neighborhoodCache[a.id]=c}function doubleArray(a){for(var b=[],c=0;c<a.length;c++)b.push([a[c],a[c]]);return b}
function isValued(a){return isUndefined(a)||null==a||isUndefined(orig(a))?!1:"Converter"==orig(a).value.nodeName||"Flow"==orig(a).value.nodeName||"Stock"==orig(a).value.nodeName||"Variable"==orig(a).value.nodeName||"Transition"==orig(a).value.nodeName||"State"==orig(a).value.nodeName}
function setSaveEnabled(a){if(is_editor&&!is_embed){var b=ribbonPanelItems().getComponent("savegroup").getComponent("savebut");a&&!1==unfoldingManager.unfolding?(b.setDisabled(!1),b.setText("Save Insight")):(b.setDisabled(!0),b.setText("Insight Saved"))}}function updateWindowTitle(){is_embed||(document.title=""==graph_title?"Untitled Insight | Insight Maker":graph_title+" | Insight Maker")}function hasDisplay(){var a=primitives();return cellsContainNodename(a,"Display")}
function urlImage(a){return a.getAttribute("Image")&&"http"==a.getAttribute("Image").substring(0,4).toLowerCase()}
function setPicture(a){var b=a.getStyle();"None"==a.getAttribute("Image")||""==a.getAttribute("Image")||" "==a.getAttribute("Image")||"null"==a.getAttribute("Image")||"Folder"==a.value.nodeName&&!a.isCollapsed()?(b=mxUtils.setStyle(b,"image","None"),b="Display"==a.value.nodeName||"Stock"==a.value.nodeName||"Folder"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):"Button"==a.value.nodeName?mxUtils.setStyle(b,"shape","rectangle"):mxUtils.setStyle(b,"shape","ellipse")):(b=urlImage(a)?mxUtils.setStyle(b,
"image",a.getAttribute("Image")):mxUtils.setStyle(b,"image",builder_path+"/images/SD/"+a.getAttribute("Image")+".png"),b=isTrue(a.getAttribute("FlipVertical"))?mxUtils.setStyle(b,"imageFlipV",1):mxUtils.setStyle(b,"imageFlipV",0),b=isTrue(a.getAttribute("FlipHorizontal"))?mxUtils.setStyle(b,"imageFlipH",1):mxUtils.setStyle(b,"imageFlipH",0),b=mxUtils.setStyle(b,"shape","image"));b=new mxStyleChange(graph.getModel(),a,b);graph.getModel().execute(b);propogateGhosts(a)}
function setLabelPosition(a){var b=a.getAttribute("LabelPosition"),c=a.getStyle();"Folder"==a.value.nodeName&&!a.isCollapsed()?(c=mxUtils.setStyle(c,"labelPosition",null),c=mxUtils.setStyle(c,"align",null),c=mxUtils.setStyle(c,"verticalLabelPosition",null),c=mxUtils.setStyle(c,"verticalAlign",null)):"Top"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","top"),c=mxUtils.setStyle(c,"verticalAlign","bottom")):"Bottom"==
b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","bottom"),c=mxUtils.setStyle(c,"verticalAlign","top")):"Middle"==b?(c=mxUtils.setStyle(c,"labelPosition","middle"),c=mxUtils.setStyle(c,"align","center"),c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle")):"Left"==b?(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle"),
c=mxUtils.setStyle(c,"labelPosition","left"),c=mxUtils.setStyle(c,"align","right")):"Right"==b&&(c=mxUtils.setStyle(c,"verticalLabelPosition","middle"),c=mxUtils.setStyle(c,"verticalAlign","middle"),c=mxUtils.setStyle(c,"labelPosition","right"),c=mxUtils.setStyle(c,"align","left"));b=new mxStyleChange(graph.getModel(),a,c);graph.getModel().execute(b);propogateGhosts(a)}
function removeAgent(a){for(var b=primitives("Agents"),c=0;c<b.length;c++)b[c].getAttribute("Agent")==a.id&&b[c].setAttribute("Agent","")}
function deletePrimitive(a){var b=primitives(),c=getSetting();if(c.getAttribute("SensitivityPrimitives")){var d=c.getAttribute("SensitivityPrimitives").split(","),e=Ext.Array.indexOf(d,a.id);-1<e&&(d.splice(e,1),c.setAttribute("SensitivityPrimitives",d.join(",")))}"Folder"==a.value.nodeName&&"Agent"==a.getAttribute("Type")&&removeAgent(a);for(c=0;c<b.length;c++)"Display"==b[c].value.nodeName?b[c].getAttribute("Primitives")&&(d=b[c].getAttribute("Primitives").split(","),e=Ext.Array.indexOf(d,a.id),
-1<e&&(d.splice(e,1),b[c].setAttribute("Primitives",d.join(",")))):"Converter"==b[c].value.nodeName?b[c].getAttribute("Source")==a.id?b[c].setAttribute("Source","Time"):"Link"==a.value.nodeName&&testConverterSource(b[c]):"Ghost"==b[c].value.nodeName&&b[c].value.getAttribute("Source")==a.id&&(d=b[c],deletePrimitive(d),graph.removeCells([d],!1))}
function linkBroken(a){for(var b=primitives(),c=0;c<b.length;c++)"Converter"==b[c].value.nodeName&&testConverterSource(b[c]);null!==a.getTerminal(!1)&&"Converter"==a.getTerminal(!1).value.nodeName&&"undefined"!=typeof a.getTerminal(!0)&&isValued(a.getTerminal(!0))&&a.getTerminal(!1).setAttribute("Source",orig(a.getTerminal(!0)).id)}
function testConverterSource(a){for(var b=neighborhood(a),c=!1,d=0;d<b.length;d++)b[d].linkHidden||a.getAttribute("Source")==b[d].item.id&&(c=!0);c||a.setAttribute("Source","Time")}function downloadModel(){var a=getGraphXml(graph);surpressCloseWarning=!0;document.getElementById("downloader").title.value=encodeURIComponent(graph_title);document.getElementById("downloader").code.value=encodeURIComponent(a);document.getElementById("downloader").submit()}
function getSetting(){for(var a=primitives(),b=0;b<a.length;b++)if("Setting"==a[b].value.nodeName)return a[b];alert("Settings primitive could not be found.");return null}function handelCursors(){graph.container.style.cursor=!1==nodeInsertSelected()?"auto":"crosshair"}var propertiesWin;
function updateProperties(){var a;a=""==graph_title?"Untitled Insight":graph_title;propertiesWin?""!=graph_title&&(Ext.getCmp("sinsightTitle").setValue(graph_title),Ext.getCmp("sinsightTags").setValue(graph_tags),Ext.getCmp("sinsightDescription").setValue(graph_description)):propertiesWin=new Ext.Window({applyTo:"property-win",layout:{type:"vbox",align:"stretch"},modal:!0,width:500,title:"Save Insight",height:350,closable:!1,resizable:!0,closeAction:"hide",defaults:{width:230,labelWidth:150},items:[new Ext.form.TextField({fieldLabel:"Insight Title",
name:"sinsightTitle",id:"sinsightTitle",allowBlank:!1,selectOnFocus:!0,value:a,margin:2}),new Ext.form.TextField({fieldLabel:"Tags",name:"sinsightTags",id:"sinsightTags",allowBlank:!0,emptyText:"Environment, Unintended Consequences",value:graph_tags,margin:2}),new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!1,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"Description",name:"sinsightDescription",id:"sinsightDescription",allowBlank:!0,emptyText:"Enter a brief description of the Insight.",
value:graph_description,margin:2,flex:1})],buttons:[{text:"Cancel",scale:"large",iconCls:"cancel-icon",handler:function(){propertiesWin.hide()}},{iconCls:"apply-icon",scale:"large",text:"Save",handler:function(){if(Ext.getCmp("sinsightTitle").validate()){propertiesWin.hide();graph_title=Ext.String.trim(Ext.getCmp("sinsightTitle").getValue());graph_description=Ext.String.trim(Ext.getCmp("sinsightDescription").getValue());graph_description=graph_description.replace(/^(\u200b|&nbsp;)/g,"");graph_description=
graph_description.replace(/(\u200b|&nbsp;)$/g,"");if("<br>"==graph_description||"<br/>"==graph_description||"\u200b"==graph_description||"&nbsp;"==graph_description)graph_description="";graph_tags=Ext.getCmp("sinsightTags").getValue();setSaveEnabled(!0);sendGraphtoServer(graph);selectionChanged(!1)}else mxUtils.alert("You must specify a name for the Insight.")}}]});propertiesWin.show();Ext.getCmp("sinsightTitle").focus(!0,300)}
function isTrue(a){return"false"!=a&&"No"!=a&&0!=a&&(1==a||-1==a||"True"==a||"true"==a||!0==a||"Yes"==a)}function customUnits(){if("undefined"!=typeof getSetting().getAttribute("Units")){for(var a=getSetting().getAttribute("Units").split("\n"),b=0;b<a.length;b++)a[b]=a[b].split("<>");return a}return[]}function orig(a){return isUndefined(a)||null===a?null:"Ghost"===a.value.nodeName?graph.getModel().getCell(a.value.getAttribute("Source")):a}
function currentStyleIs(a){for(var b=graph.getCellStyle(graph.getSelectionCell())[mxConstants.STYLE_FONTSTYLE],c=3;1<=c;c--)b-=a*Math.pow(2,c),0>b&&(b+=a*Math.pow(2,c));return b>=a}
function setStyles(){if(!is_embed&&is_editor)if(graph.isSelectionEmpty())ribbonPanelItems().getComponent("style").getComponent("bold").toggle(!1),ribbonPanelItems().getComponent("style").getComponent("italic").toggle(!1),ribbonPanelItems().getComponent("style").getComponent("underline").toggle(!1),sizeCombo.setValue(""),fontCombo.setValue("");else{ribbonPanelItems().getComponent("style").getComponent("bold").toggle(currentStyleIs(mxConstants.FONT_BOLD));ribbonPanelItems().getComponent("style").getComponent("italic").toggle(currentStyleIs(mxConstants.FONT_ITALIC));
ribbonPanelItems().getComponent("style").getComponent("underline").toggle(currentStyleIs(mxConstants.FONT_UNDERLINE));var a=graph.getCellStyle(graph.getSelectionCell());sizeCombo.setValue(a[mxConstants.STYLE_FONTSIZE]);fontCombo.setValue(a[mxConstants.STYLE_FONTFAMILY])}}function quickLabel(a,b,c){var d=getSetting();return processLabel(a,b,c,d.getAttribute("TimeUnits"),d.getAttribute("TimeStep"),d.getAttribute("SolutionAlgorithm"))}
function processLabel(a,b,c,d,e,f){a=replaceAll(a,"%%","<PERCENTSIGNPLACEHOLDER>");a=replaceAll(a,"%u",d);a=replaceAll(a,"%t",b);a=replaceAll(a,"%o",c);a=replaceAll(a,"%ts",e);a=replaceAll(a,"%a",f);a=replaceAll(a,"<PERCENTSIGNPLACEHOLDER>","%");return clean(a)}function replaceAll(a,b,c){return isUndefined(a)?"":a.replace(RegExp(b,"g"),c)}
function loadBackgroundColor(){mxPanel.el.dom.style["background-color"]=getSetting().getAttribute("BackgroundColor");mxPanel.el.dom.style.backgroundColor=getSetting().getAttribute("BackgroundColor")}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}function isTouch(){return mxClient.IS_TOUCH}
function propogateGhosts(a){for(var b=primitives("Ghost"),c=0;c<b.length;c++)if(b[c].getAttribute("Source")==a.id){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",30);b[c].setStyle(d);d=new mxCellAttributeChange(b[c],"name",a.getAttribute("name"));graph.getModel().execute(d)}}
function propogateName(a,b){if(isValued(a))for(var c=getName(a),d=RegExp("\\["+b+"\\]","gi"),e=graph.getConnections(a),f=0;f<e.length;f++){var g;g="Flow"==e[f].value.nodeName||"Transition"==e[f].value.nodeName?e[f]:e[f].target.id==a.id?e[f].source:e[f].target;(isValued(g)||g&&"Action"==g.value.nodeName)&&setValue(g,getValue(g).replace(d,"["+c+"]"))}}function map(a,b){return a instanceof Array?Ext.Array.map(a,b):b(a)}
function unitsUsedInModel(){for(var a=primitives(),b=[],c=0;c<a.length;c++){var d=a[c].getAttribute("Units");"Setting"!=a[c].value.nodeName&&isDefined(d)&&null!==d&&"Unitless"!=d&&b.push(d)}return Ext.Array.unique(b)}function changeNodeName(a,b){for(var c=mxUtils.createXmlDocument().createElement(b),d=a.attributes,e=0;e<d.length;e++)c.setAttribute(d[e].name,d[e].value);return c}
function cmd(a){return mxClient.IS_MAC?"<span style='color:grey'>(&#8984;"+a+")</span>":"<span style='color:grey'>(Ctrl-"+a+")</span>"}function inAgent(a){return!a||null==a?!1:(a=getParent(a))&&"Agent"==a.getAttribute("Type")?!0:inAgent(a)}
function isGray(a){if(isUndefined(a))return!0;a="#"==a[0]?a:colourNameToHex(a);if("#6482B9"==a)return!0;var b=a[1];if(4==a.length)for(var c=2;c<a.length;c++){if(a[c]!=b)return!1}else if(7==a.length){for(c=1;c<a.length;c+=2)if(a[c]!=b)return!1;b=a[2];for(c=2;c<a.length;c+=2)if(a[c]!=b)return!1}return!0}
function colourNameToHex(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",
darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",
goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",
lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",
olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",
slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:!1};var macrosWin,scratchPadStatus="";function ribbonPanelItems(){return ribbonPanel.getDockedItems()[0]}
var showMacros=function(){isUndefined(macrosWin)&&(macrosWin=new Ext.Window({layout:"fit",modal:!0,autoScroll:!0,width:440,title:getText("Insight Macros"),height:360,resizable:!1,closeAction:"close",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:100},frame:!0,autoScroll:!0,bodyStyle:"padding:5px 5px 0",defaults:{width:405},items:[{xtype:"textareafield",fieldLabel:getText("Macros"),id:"macroTxt",name:"macroTxt",height:210},{xtype:"displayfield",labelAlign:"center",fieldLabel:getText("Example Macros"),
value:"g <- {9.80665 meters/seconds^2}<br/>TemperatureFtoC(f) <- (f+32)*5/9"}]})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){macrosWin.hide()}},{iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){graph.getModel().beginUpdate();var a=new mxCellAttributeChange(getSetting(),"Macros",Ext.getCmp("macroTxt").getValue());graph.getModel().execute(a);graph.getModel().endUpdate();macrosWin.hide()}}]}));Ext.getCmp("macroTxt").setValue(getSetting().getAttribute("Macros"));
macrosWin.show()},scratchpadFn=function(){"shown"==scratchPadStatus?(Ext.get("mainGraph").setDisplayed("none"),scratchPadStatus="hidden"):("hidden"==scratchPadStatus?Ext.get("mainGraph").setDisplayed("block"):(Ext.get("mainGraph").setDisplayed("block"),Scratchpad($("#mainGraph"))),scratchPadStatus="shown")},sizeCombo,fontCombo,RibbonPanel=function(a,b,c){function d(b){m.push({text:getText("Width: %s",b),handler:function(){a.setCellStyles(mxConstants.STYLE_STROKEWIDTH,b,excludeType(a.getSelectionCells(),
"Ghost"));a.setCellStyles(mxConstants.ARROW_SIZE,10*b,excludeType(a.getSelectionCells(),"Ghost"))}})}function e(b){function c(d){return function(){b?a.setCellStyles(mxConstants.STYLE_STARTARROW,d,excludeType(a.getSelectionCells(),"Ghost")):a.setCellStyles(mxConstants.STYLE_ENDARROW,d,excludeType(a.getSelectionCells(),"Ghost"))}}for(var d=[["None",mxConstants.NONE],"-",["Regular Arrow",mxConstants.ARROW_CLASSIC],["Block Arrow",mxConstants.ARROW_BLOCK],["Open Arrow",mxConstants.ARROW_OPEN],["Diamond",
mxConstants.ARROW_DIAMOND],["Thin Diamond",mxConstants.ARROW_DIAMOND_THIN],["Oval",mxConstants.ARROW_OVAL]],e=0;e<d.length;e++)"-"!==d[e]&&(d[e]={text:d[e][0],handler:c(d[e][1])});return d}Ext.Ajax.timeout=6E4;var f=function(a,b){var c=ribbonPanelItems();"flow"==a.id&&b?c.getComponent("connect").getComponent("link").toggle(!1):"link"==a.id&&b&&c.getComponent("connect").getComponent("flow").toggle(!1);"stock"==a.id&&b?(c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),
c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"variable"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):
"text"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"converter"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),
c.getComponent("valued").getComponent("picture").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"picture"==a.id&&b?(c.getComponent("valued").getComponent("stock").toggle(!1),c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("buttonBut").toggle(!1)):"buttonBut"==a.id&&b&&(c.getComponent("valued").getComponent("stock").toggle(!1),
c.getComponent("valued").getComponent("variable").toggle(!1),c.getComponent("valued").getComponent("text").toggle(!1),c.getComponent("valued").getComponent("converter").toggle(!1),c.getComponent("valued").getComponent("picture").toggle(!1));handelCursors()},g={xtype:"menu",iconsCls:"picture-icon",items:"Growth,Balance,Positive Feedback Clockwise,Positive Feedback Counterclockwise,Negative Feedback Clockwise,Negative Feedback Counterclockwise,Unknown Feedback Clockwise,Unknown Feedback Counterclockwise,Plus,Minus,Forwards,Backwards,Up,Down,Diagonal,Reload,Play,Pause,Stop,Info,Question,Warning,Checkmark,Prohibited,Idea,Home,Book,Clock,Computer,Dice,Cards,Gear,Hammer,Smiley,Heart,Key,Lock,Loudspeaker,Footprints,Mail,Network,Notes,Pushpin,Paperclip,People,Person,Wallet,Money,Flag,Star,Rocket,Alarm,Beaker,Ball,Hat,List,Bolt,Cookie,Plugin,Monitor,Telescope,Chalkboard,Open,Trash".split(",").map(function(a){return{text:'<center><div class="x-combo-list-item" style="white-space:normal";><img src="'+
builder_path+"/images/SD/"+a+'.png" width=48 height=48/></div></center>',handler:function(){setImage(getSelected(),a)}}})},h="000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,969696,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,6482B9,993366,C0C0C0,FF99CC,FDCDAC,FFFF99,B3E2CD,CCFFFF,A6D3F8,CC99FF,FFFFFF".split(","),k=Ext.create("Ext.menu.ColorPicker",{colors:h,allowReselect:!0,handler:function(b,c){if("string"==
typeof c){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"));for(var d=a.getSelectionCells(),e=[],f=0;f<d.length;f++)("Link"==d[f].value.nodeName||"Flow"==d[f].value.nodeName)&&e.push(d[f]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"#"+c,e,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),"BackgroundColor","#"+c)),loadBackgroundColor());a.getModel().endUpdate()}}});
k.add("-");k.add({text:getText("Transparent"),handler:function(){a.getModel().beginUpdate();a.setCellStyles(mxConstants.STYLE_FILLCOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"));for(var b=a.getSelectionCells(),c=[],d=0;d<b.length;d++)("Link"==b[d].value.nodeName||"Flow"==b[d].value.nodeName)&&c.push(b[d]);a.setCellStyles(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,mxConstants.NONE,c,excludeType(a.getSelectionCells(),"Ghost"));a.isSelectionEmpty()&&(a.getModel().execute(new mxCellAttributeChange(getSetting(),
"BackgroundColor","white")),loadBackgroundColor());a.getModel().endUpdate()}});var l=new Ext.menu.ColorPicker({colors:h,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_FONTCOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"))}}),h=new Ext.menu.ColorPicker({colors:h,allowReselect:!0,handler:function(b,c){"string"==typeof c&&a.setCellStyles(mxConstants.STYLE_STROKECOLOR,"#"+c,excludeType(a.getSelectionCells(),"Ghost"))}});h.add("-");h.add({text:getText("Transparent"),
handler:function(){a.setCellStyles(mxConstants.STYLE_STROKECOLOR,mxConstants.NONE,excludeType(a.getSelectionCells(),"Ghost"))}});h.add("-");h.add({text:getText("Solid Line"),handler:function(){a.setCellStyles(mxConstants.STYLE_DASHED,0,excludeType(a.getSelectionCells(),"Ghost"))}});h.add({text:getText("Dashed Line"),handler:function(){a.setCellStyles(mxConstants.STYLE_DASHED,1,excludeType(a.getSelectionCells(),"Ghost"))}});h.add("-");for(var m=[],n=1;10>=n;n++)d(n);for(n=15;50>=n;n+=5)d(n);h.add({text:getText("Line Width"),
menu:{items:m}});h.add("-");h.add({text:getText("Line Start"),menu:{items:e(!0)}});h.add({text:getText("Line End"),menu:{items:e(!1)}});n=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"string",name:"font"}],data:[{label:"Comic",font:"Comic Sans MS"},{label:"Helvetica",font:"Helvetica"},{label:"Verdana",font:"Verdana"},{label:"Times New Roman",font:"Times New Roman"},{label:"Garamond",font:"Garamond"},{label:"Courier New",font:"Courier New"}]});fontCombo=new Ext.form.ComboBox({store:n,
displayField:"label",valueField:"font",queryMode:"local",width:120,colspan:3,triggerAction:"all",emptyText:getText("Select a font..."),selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTFAMILY,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))}}});fontCombo.on("specialkey",function(b,c){if(10==c.keyCode||13==c.keyCode){var d=b.getValue();null!=d&&0<d.length&&(a.setCellStyles(mxConstants.STYLE_FONTFAMILY,d,excludeType(a.getSelectionCells(),"Ghost")),
this.setValue(d))}});n=Ext.create("Ext.data.Store",{fields:[{type:"string",name:"label"},{type:"float",name:"size"}],data:[{label:"6pt",size:6},{label:"8pt",size:8},{label:"9pt",size:9},{label:"10pt",size:10},{label:"12pt",size:12},{label:"14pt",size:14},{label:"18pt",size:18},{label:"24pt",size:24},{label:"30pt",size:30},{label:"36pt",size:36},{label:"48pt",size:48},{label:"60pt",size:60}]});sizeCombo=new Ext.form.ComboBox({colspan:2,store:n,displayField:"label",valueField:"size",queryMode:"local",
width:50,triggerAction:"all",emptyText:"",selectOnFocus:!0,listeners:{select:function(b,c){null!=c&&a.setCellStyles(mxConstants.STYLE_FONTSIZE,b.getValue(),excludeType(a.getSelectionCells(),"Ghost"))}}});sizeCombo.on("specialkey",function(b,c){if(10==c.keyCode||13==c.keyCode){var d=parseInt(b.getValue());!isNaN(d)&&0<d&&(this.setValue(d),a.setCellStyles(mxConstants.STYLE_FONTSIZE,d,excludeType(a.getSelectionCells(),"Ghost")))}});n={items:[{text:"400%",scope:this,handler:function(){setZoom(4)}},{text:"200%",
scope:this,handler:function(){setZoom(2)}},{text:"150%",scope:this,handler:function(){setZoom(1.5)}},{text:"100%",scope:this,handler:function(){setZoom(1)}},{text:"75%",scope:this,handler:function(){setZoom(0.75)}},{text:"50%",scope:this,handler:function(){setZoom(0.5)}},{text:"25%",scope:this,handler:function(){setZoom(0.25)}},"-",{text:getText("Zoom In"),iconCls:"zoomin-icon",scope:this,handler:function(){setZoom("in")}},{text:getText("Zoom Out"),iconCls:"zoomout-icon",scope:this,handler:function(){setZoom("out")}},
"-",{text:getText("Actual Size"),iconCls:"zoomactual-icon",scope:this,handler:function(){setZoom("actual")}},{text:getText("Fit Window"),iconCls:"fit-icon",scope:this,handler:function(){setZoom("fit")}}]};!is_embed&&is_editor&&n.items.push("-",{text:getText("Organic Layout"),scope:this,handler:function(){layoutModel("organic")}},{text:getText("Circle Layout"),scope:this,handler:function(){layoutModel("circular")}});return{id:"ribbonPanel",xtype:"panel",layout:"border",region:"center",split:!0,border:!1,
items:[b,c],collapsible:!1,tbar:new Ext.toolbar.Toolbar({enableOverflow:!0,items:[{hidden:!viewConfig.primitiveGroup,xtype:"buttongroup",columns:4,height:95,title:getText("Add Primitive"),id:"valued",items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"stock",text:getText("Stock"),iconCls:"stock-icon",tooltip:getText("Create a new Stock by clicking on the canvas"),enableToggle:!0,toggleHandler:f,pressed:!1,scope:this},{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,
id:"variable",text:getText("Variable"),iconCls:"parameter-icon",tooltip:getText("Create a new Variable by clicking on the canvas"),enableToggle:!0,toggleHandler:f,pressed:!1,scope:this},{id:"converter",text:getText("Converter"),iconCls:"converter-icon",tooltip:getText("Create a new Converter by clicking on the canvas"),enableToggle:!0,toggleHandler:f,pressed:!1,scope:this},{id:"text",text:getText("Text"),iconCls:"font-icon",tooltip:getText("Create a new Text Area by clicking on the canvas"),enableToggle:!0,
toggleHandler:f,pressed:!1,scope:this},{id:"ghostBut",text:getText("Ghost"),iconCls:"ghost-icon",tooltip:getText("Create a linked clone of the selected primitive which can help you organize your model"),scope:this,handler:makeGhost},{id:"picture",text:getText("Picture"),iconCls:"picture-icon",tooltip:getText("Create a new Picture by clicking on the canvas"),enableToggle:!0,toggleHandler:f,pressed:!1,scope:this},{id:"folder",text:getText("Folder"),iconCls:"folder-icon",tooltip:getText("Creates a new Folder containing the selected primitives"),
scope:this,handler:makeFolder},{id:"buttonBut",text:getText("Button"),iconCls:"button-icon",tooltip:getText("Creates a new Button with interactivity"),scope:this,enableToggle:!0,toggleHandler:f,pressed:!1}]},{hidden:!viewConfig.connectionsGroup,xtype:"buttongroup",columns:1,height:95,title:getText("Connections"),id:"connect",items:[{id:"link",text:getText("Link"),iconCls:"link-small-icon",tooltip:getText("Use Links to connect primitives"),enableToggle:!0,toggleHandler:f,pressed:!1,scope:this},{id:"flow",
text:getText("Flow"),iconCls:"flow-small-icon",tooltip:getText("Use Flows to connect primitives"),enableToggle:!0,toggleHandler:f,pressed:-1==drupal_node_ID,scope:this},{id:"reverse",text:getText("Reverse"),iconCls:"reverse-icon",tooltip:getText("Reverse connection direction"),handler:function(){a.getModel().beginUpdate();var b=a.getSelectionCells();if(null!=b)for(var c=0;c<b.length;c++)if(b[c].isEdge()){var d=b[c].getGeometry(),e=b[c].source,f=new mxTerminalChange(a.getModel(),b[c],b[c].target,!0);
a.getModel().execute(f);f=new mxTerminalChange(a.getModel(),b[c],e,!1);a.getModel().execute(f);e=d.sourcePoint;d.sourcePoint=d.targetPoint;d.targetPoint=e;null!=d.points&&d.points.reverse();f=new mxGeometryChange(a.getModel(),b[c],d);a.getModel().execute(f)}a.getModel().endUpdate()},scope:this}]},{hidden:!viewConfig.actionsGroup,xtype:"buttongroup",columns:is_ebook?1:2,height:95,title:getText("Actions"),id:"actions",items:[{id:"undo",text:getText("Undo"),iconCls:"undo-icon",tooltip:getText("Undo change")+
" "+cmd("Z"),handler:function(){undoHistory.undo()},scope:this},{id:"redo",text:getText("Redo"),iconCls:"redo-icon",tooltip:getText("Redo change")+" "+cmd("Y"),handler:function(){undoHistory.redo()},scope:this},{hidden:is_ebook,id:"copy",text:getText("Copy"),iconCls:"copy-icon",tooltip:getText("Copy")+" "+cmd("C"),handler:function(){mxClipboard.copy(a);clipboardListener()},scope:this},{hidden:is_ebook,id:"cut",text:getText("Cut"),iconCls:"cut-icon",tooltip:getText("Cut")+" "+cmd("X"),handler:function(){mxClipboard.cut(a);
clipboardListener()},scope:this},{hidden:is_ebook,text:getText("Paste"),iconCls:"paste-icon",tooltip:getText("Paste")+" "+cmd("V"),id:"paste",handler:function(){mxClipboard.paste(a);clipboardListener()},scope:this},{id:"delete",text:getText("Delete"),iconCls:"delete-icon",tooltip:getText("Delete primitive"),handler:function(){a.removeCells(a.getSelectionCells(),!1)},scope:this}]},{hidden:!viewConfig.styleGroup,xtype:"buttongroup",columns:5,height:95,title:getText("Styles"),id:"style",items:[fontCombo,
sizeCombo,{id:"fontcolor",text:"",tooltip:getText("Font Color"),iconCls:"fontcolor-icon",menu:l},{id:"linecolor",text:"",tooltip:getText("Line Style"),iconCls:"linecolor-icon",menu:h},{id:"fillcolor",text:"",colspan:1,tooltip:getText("Fill Color"),iconCls:"fillcolor-icon",menu:k},{id:"movemenu",text:"",tooltip:getText("Change Order"),iconCls:"back-icon",handler:function(){},menu:{id:"move-menu",cls:"move-menu",items:[{id:"moveback",text:getText("Move to Back"),iconCls:"back-icon",handler:function(){a.orderCells(!0)},
scope:this},{id:"movefront",text:getText("Move to Front"),iconCls:"front-icon",handler:function(){a.orderCells(!1)},scope:this}]}},{id:"picturemenu",text:"",tooltip:getText("Adjust Picture"),iconCls:"picture-icon",handler:function(){},menu:{id:"picture-menu",cls:"picture-menu",items:[{text:"No Image",iconCls:"cancel-small-icon",handler:function(){setImage(getSelected(),"None")}},"-",{text:"Custom Image",iconCls:"url-link-icon",handler:function(){Ext.Msg.prompt("Image URL","<p>You may use a link to an existing custom image stored on-line. Please note that the image is only stored as a link within Insight Maker so you need to ensure that the original image stays on-line for it to remain in your model.</p><br/><p>Enter the full URL to the image:</p>",
function(a,b){"ok"==a&&setImage(getSelected(),b)},null,!1,urlImage(getSelected()[0])?getSelected()[0].getAttribute("Image"):"")}},{text:getText("Built-In Images"),menu:g,iconCls:"picture-icon"},"-",{id:"fliphitem",text:getText("Flip Horizontal"),iconCls:"fliph-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipHorizontal"))){var d=new mxCellAttributeChange(b[c],"FlipHorizontal",!isTrue(b[c].getAttribute("FlipHorizontal")));
a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},scope:this},{id:"flipvitem",text:getText("Flip Vertical"),iconCls:"flipv-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("FlipVertical"))){var d=new mxCellAttributeChange(b[c],"FlipVertical",!isTrue(b[c].getAttribute("FlipVertical")));a.getModel().execute(d);setPicture(b[c])}a.getModel().endUpdate()},scope:this}]}},{id:"bold",text:"",
iconCls:"bold-icon",tooltip:getText("Bold")+" "+cmd("B"),handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_BOLD,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"italic",text:"",tooltip:getText("Italic")+" "+cmd("I"),iconCls:"italic-icon",handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_ITALIC,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"underline",text:"",enableToggle:!0,
tooltip:getText("Underline")+" "+cmd("U"),iconCls:"underline-icon",handler:function(){a.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,mxConstants.FONT_UNDERLINE,excludeType(a.getSelectionCells(),"Ghost"));setStyles()},scope:this},{id:"align",text:"",iconCls:"left-icon",tooltip:getText("Label Position"),handler:function(){},menu:{id:"reading-menu",cls:"reading-menu",items:[{text:getText("Align Left"),checked:!1,group:"rp-group",scope:this,iconCls:"left-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,
mxConstants.ALIGN_LEFT,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Center"),checked:!0,group:"rp-group",scope:this,iconCls:"center-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER,excludeType(a.getSelectionCells(),"Ghost"))}},{text:getText("Align Right"),checked:!1,group:"rp-group",scope:this,iconCls:"right-icon",handler:function(){a.setCellStyles(mxConstants.STYLE_ALIGN,mxConstants.ALIGN_RIGHT,excludeType(a.getSelectionCells(),"Ghost"))}},
"-",{text:getText("Position Middle"),checked:!0,group:"vrp-group",scope:this,iconCls:"middle-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Middle");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Top"),checked:!1,group:"vrp-group",scope:this,iconCls:"top-icon",handler:function(){var b=
excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Top");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Right"),checked:!1,group:"vrp-group",scope:this,iconCls:"left-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=
new mxCellAttributeChange(b[c],"LabelPosition","Right");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},{text:getText("Position Bottom"),checked:!1,group:"vrp-group",scope:this,iconCls:"bottom-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Bottom");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}},
{text:getText("Position Left"),checked:!1,group:"vrp-group",scope:this,iconCls:"right-icon",handler:function(){var b=excludeType(getSelected(),"Ghost");a.getModel().beginUpdate();for(var c=0;c<b.length;c++)if(isDefined(b[c].getAttribute("LabelPosition"))){var d=new mxCellAttributeChange(b[c],"LabelPosition","Left");a.getModel().execute(d);setLabelPosition(b[c])}a.getModel().endUpdate()}}]}},{id:"zoomMenuButton",text:"",iconCls:"zoom-icon",handler:function(){},menu:n}]},{hidden:!viewConfig.exploreGroup,
id:"control-no-edit",xtype:"buttongroup",columns:2,height:95,title:"Explore",items:[{iconAlign:"top",id:"scratchpadLarge",text:getText("Scratchpad"),iconCls:"scratchpad-large-icon",tooltip:getText("Draw a sketch on your diagram")+" "+cmd("K"),enableToggle:!0,scale:"large",cls:"button",rowspan:3,handler:scratchpadFn,scope:this},{iconAlign:"top",scale:"large",cls:"button",rowspan:3,text:getText("Zoom"),iconCls:"zoom-large-icon",tooltip:getText("Zoom Diagram"),id:"zoomlargebutgrouped",handler:function(){},
menu:n}]},{hidden:!viewConfig.toolsGroup,xtype:"buttongroup",columns:!is_editor||is_embed?1:is_ebook?2:3,height:95,title:getText("Tools"),id:"configgroup",items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"config",text:getText("Time Settings"),iconCls:"clock-icon",tooltip:getText("Configure time start and stop")+" "+cmd("L"),handler:timeSettingsFn,scope:this},{hidden:!is_editor||is_embed,id:"scratchpad",text:getText("Scratchpad"),iconCls:"scratchpad-icon",tooltip:getText("Draw notes on your diagram")+
" "+cmd("K"),enableToggle:!0,handler:scratchpadFn,scope:this},{id:"embed_but",text:getText("Embed"),hidden:!is_editor||is_embed||is_ebook,iconCls:"embed-icon",tooltip:getText("Embed this Insight in another web page"),handler:function(){-1==drupal_node_ID?Ext.MessageBox.show({title:getText("Save the Insight"),msg:getText("You must save this Insight before you can embed it."),buttons:Ext.MessageBox.OK,animEl:"mb9",icon:Ext.MessageBox.ERROR}):Ext.MessageBox.show({title:getText("Embed"),msg:getText("To embed this Insight in another webpage (such as a blog or a private site), copy and paste the following code into the source HTML code of your webpage: %s",
'<br/><br/><center><tt>&lt;IFRAME SRC="http://InsightMaker.com/insight/'+drupal_node_ID+'/embed?topBar=1&sideBar=1&zoom=1" TITLE="Embedded Insight" width=600 height=420&gt;&lt;/IFRAME&gt;</tt></center><br/>'),buttons:Ext.MessageBox.OK,animEl:"mb9",icon:Ext.MessageBox.INFO})},scope:this},{hidden:!is_editor||is_embed,id:"textBut",text:getText("Equations"),iconCls:"equations-icon",tooltip:getText("A listing of all equations in the Insight"),handler:textEquations,scope:this},{hidden:!is_editor||is_embed||
is_ebook,text:getText("Add Story"),iconCls:"unfold-icon",tooltip:getText("Display the model step-by-step to share a story"),handler:showUnfoldingWin,scope:this},{text:getText("Advanced"),iconCls:"advanced-icon",hidden:!is_editor||is_embed,handler:function(){},menu:{items:[{id:"macroBut",text:getText("Macros"),iconCls:"download-icon",tooltip:getText("Edit macro functions and constants for use anywhere in your equations"),handler:showMacros,scope:this},{id:"sensitivityBut",text:getText("Sensitivity"),
iconCls:"sensitivity-icon",tooltip:getText("Sensitivity testing"),handler:doSensitivity,scope:this},{id:"optimizeBut",text:getText("Optimize"),iconCls:"optimize-icon",tooltip:getText("Optimize model parameters"),handler:doOptimizer,scope:this}]}},{hidden:!is_editor||is_embed||is_ebook,text:getText("Help"),iconCls:"help-icon",tooltip:getText("Insight Maker's Manual"),handler:function(){showURL("http://insightmaker.com/manual")},scope:this}]},{hidden:!is_embed,iconAlign:"top",id:"scratchpadLargeEmbed",
text:getText("Scratchpad"),iconCls:"scratchpad-large-icon",tooltip:getText("Draw notes on your diagram")+" "+cmd("K"),enableToggle:!0,scale:"large",cls:"button",rowspan:3,handler:scratchpadFn,scope:this},{hidden:!is_embed,iconAlign:"top",scale:"large",cls:"button",rowspan:3,text:getText("Zoom"),iconCls:"zoom-large-icon",tooltip:getText("Zoom Diagram"),id:"zoomlargebutEmbed",handler:function(){},menu:n},viewConfig.runFlush?"->":"-",{hidden:!viewConfig.saveEnabled,id:"savegroup",xtype:"buttongroup",
columns:1,height:95,width:90,title:"Save",items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,text:getText("Save Insight"),iconCls:"save-icon",tooltip:getText("Save Insight")+" "+cmd("S"),id:"savebut",handler:function(){saveModel()},scope:this}]},{hidden:viewConfig.buttonGroups,iconAlign:"top",scale:"large",cls:"button",rowspan:3,id:"run_embed",text:getText("Run Simulation"),iconCls:"run-icon",tooltip:getText("Run")+" "+cmd("Enter"),handler:function(){runModel()},scope:this},{hidden:!viewConfig.buttonGroups,
xtype:"buttongroup",columns:1,title:getText("Simulate"),height:95,items:[{iconAlign:"top",scale:"large",cls:"x-btn-as-arrow",rowspan:3,id:"run",text:"Run Simulation",iconCls:"run-icon",tooltip:getText("Run")+" "+cmd("Enter"),handler:function(){runModel()},scope:this}]},viewConfig.showLogo?"->":"",{hidden:!viewConfig.showLogo,xtype:"box",width:154,id:"logo",text:"",iconCls:"logo-icon",tooltip:"InsightMaker.com",html:"<a href='http://insightmaker.com'><img src='http://insightmaker.com/builder/images/logo.png'/></a>",
scope:this}]})}};Ext.onReady(function(){Ext.getBody().createChild({tag:"style",type:"text/css",html:".x-item-disabled .x-grid-cell-inner {color: gray !important; font-style: italic !important}"})});var grid;function getRenderer(a){return"renderer"in a?a.renderer:"boolean"==typeof a.value?function(a){return isTrue(a)?"Yes":"No"}:!1}
function getEditor(a){if("editor"in a)return a.editor;a=a.value;return a instanceof Date?new Ext.form.DateField({selectOnFocus:!0}):"number"==typeof a?Ext.create("Ext.form.field.Number",{selectOnFocus:!0}):"boolean"==typeof a?new Ext.form.ComboBox({triggerAction:"all",store:[["false",getText("No")],["true",getText("Yes")]],selectOnFocus:!0,editable:!1}):new Ext.form.TextField({selectOnFocus:!0})}
function createGrid(a,b,c,d){for(var e=0;e<b.length;e++)configPanel.add(b[e]);if(0<a.length){for(var f=[],b=[],g=[],h=[],e=0;e<a.length;e++)f.push({id:a[e].name,name:a[e].name,text:a[e].text,value:a[e].value,group:a[e].group}),"boolean"==typeof f[e].value&&(f[e].value=isTrue(f[e].value).toString()),b[a[e].name]=a[e].text,g[a[e].name]=getEditor(a[e]),!1!=getRenderer(a[e])&&(h[a[e].name]=getRenderer(a[e]));a=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},{name:"text",type:"string"},
{name:"value",type:"string"},{name:"group",type:"string"}],data:f,groupers:[{property:"group"}]});handleGridEnables(a,d);e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:"{name}",collapse:Ext.emptyFn});grid=Ext.create("Ext.grid.property.Grid",{selectedPrimitive:d,store:a,hideHeaders:!0,border:!1,id:"propGrid",features:[e],propertyNames:b,customEditors:g,customRenderers:h,viewConfig:{getRowClass:function(a){return!0==a.data.disabled?"x-item-disabled":""}},listeners:{beforeedit:viewConfig.allowEdits?
function(a,b){if("Solver"==b.record.data.name)return!1}:function(){return!1}}});configPanel.add(grid);grid.plugins[0].on("edit",function(a,b){if(is_editor){var c=b.record.get("name");b.record.commit();graph.getModel().beginUpdate();try{if("name"!=c||!isPrimitive(d)||validPrimitiveName(""+b.value,d)){if("name"==c)var e=getName(d);var f=new mxCellAttributeChange(d,c,""+b.value);graph.getModel().execute(f);"name"==c&&(propogateGhosts(d),propogateName(d,e))}"Folder"==d.value.nodeName&&"Type"==c&&"None"==
""+b.value&&removeAgent(d);"Stock"==d.value.nodeName&&"AllowNegatives"==c&&(f=new mxCellAttributeChange(d,"NonNegative",""+!isTrue(b.value)),graph.getModel().execute(f));"Flow"==d.value.nodeName&&(isTrue(d.getAttribute("OnlyPositive"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[d]):(graph.setCellStyles(mxConstants.STYLE_STARTARROW,"block",[d]),graph.setCellStyles("startFill",0,[d])));"Link"==d.value.nodeName&&(isTrue(d.getAttribute("BiDirectional"))?graph.setCellStyles(mxConstants.STYLE_STARTARROW,
mxConstants.ARROW_CLASSIC,[d]):graph.setCellStyles(mxConstants.STYLE_STARTARROW,"",[d]));("Image"==c||"FlipHorizontal"==c||"FlipVertical"==c)&&setPicture(d);"LabelPosition"==c&&setLabelPosition(d)}finally{graph.getModel().endUpdate()}handleGridEnables(null,d)}})}for(e=0;e<c.length;e++)configPanel.add(c[e])}
function handleGridEnables(a,b){var c;c=null!=a?a:grid.getStore();"Folder"==b.value.nodeName&&("Agent"==b.getAttribute("Type")?getGridRecord(c,"AgentBase").set("disabled",!1):getGridRecord(c,"AgentBase").set("disabled",!0));if("Action"==b.value.nodeName||"Transition"==b.value.nodeName)"Condition"==b.getAttribute("Trigger")?getGridRecord(c,"Recalculate").set("disabled",!0):getGridRecord(c,"Recalculate").set("disabled",!1);"Stock"==b.value.nodeName&&("Store"==b.getAttribute("StockMode")?getGridRecord(c,
"Delay").set("disabled",!0):"Conveyor"==b.getAttribute("StockMode")&&getGridRecord(c,"Delay").set("disabled",!1));"Agents"==b.value.nodeName&&("Custom Function"==b.getAttribute("Placement")?getGridRecord(c,"PlacementFunction").set("disabled",!1):getGridRecord(c,"PlacementFunction").set("disabled",!0),"Custom Function"==b.getAttribute("Network")?getGridRecord(c,"NetworkFunction").set("disabled",!1):getGridRecord(c,"NetworkFunction").set("disabled",!0));if(is_editor&&isValued(b)&&"State"!=b.value.nodeName&&
"Action"!=b.value.nodeName){try{getGridRecord(c,"MaxConstraint").set("disabled",!isTrue(b.getAttribute("MaxConstraintUsed"))),getGridRecord(c,"MinConstraint").set("disabled",!isTrue(b.getAttribute("MinConstraintUsed")))}catch(d){}if("Converter"!=b.value.nodeName)try{getGridRecord(c,"SliderMax").set("disabled",!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderMin").set("disabled",!isTrue(b.getAttribute("ShowSlider"))),getGridRecord(c,"SliderStep").set("disabled",!isTrue(b.getAttribute("ShowSlider")))}catch(e){}}}
var ConfigPanel=function(){return{id:"configPanel",region:"east",width:viewConfig.sideBarWidth,split:!0,autoScroll:!0,listeners:{beforeexpand:function(){setSelected([])}},collapsible:!0,title:getText("Configuration"),border:!0,layout:{type:"vbox",align:"stretch"}}};function getGridRecord(a,b){return a.getAt(a.findBy(function(a){return a.data.name==b}))};var codeEditor;Ext.form.customFields.code=Ext.extend(Ext.form.customFields.code,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.EquationWindow({parent:this,code:this.getValue(),cell:getSelected()[0]});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!/\\n/.test(a.getValue()))},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.EquationWindow=function(a){function b(a){var b="<b>"+a[1].replace(/\$\$/g,"").replace(/##/g,"").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;")+"</b><br/>"+a[2];a[3]&&(b+="<br/><br/><b>Example:</b><br/>&nbsp;&nbsp;",b="string"==typeof a[3]?b+a[3].replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;"):b+a[3][0].replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;")+" <b>&rarr;</b> "+
a[3][1].replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\n/g,"<br/>").replace(/ /g,"&nbsp;"));k.push(new Ext.Button({text:a[0],margin:2,tooltip:b,handler:function(){insertAtCursor(a[1].replace(/\$\$/g,"").replace(/##/g,""))}}))}var c=this;c.args=a;for(var d=c.args.code.replace(/\\n/g,"\n"),e=c.args.cell,f=[],g=neighborhood(e),a=0;a<g.length;a++)if(!g[a].linkHidden){var h='<big><img width=16 height=16 src="'+builder_path+'/images/add.png"/> '+clean(g[a].item.getAttribute("name"))+"</big>";"agent"==
g[a].type&&(h="<i class='gray'>&nbsp;&nbsp;"+h+"</i>");f.push({name:g[a].item.getAttribute("name"),item:h})}0==f.length?f=new Ext.Component({margin:10,width:viewConfig.referenceBarWidth,region:"east",html:"<big><i class='gray'>"+getText("No references to other primitives available.<br/><br/>You can connect primitives and create references using Links.")+"</i></big>"}):(a=new Ext.data.Store({autoDestroy:!0,idIndex:0,fields:[{type:"string",name:"name"},{type:"string",name:"item"}],data:f}),f=new Ext.grid.Panel({store:a,
region:"east",width:viewConfig.referenceBarWidth,margin:"3 3 3 3",columns:[{header:"References",flex:1,dataIndex:"item",sortable:!1}]}));codeEditor=new Ext.form.TextArea({id:"myCode",name:"myCode",enterIsSpecial:!0,value:d,fieldStyle:"font-size:large;",width:200,margin:"3 3 3 3",region:"center",listeners:{specialkey:function(a,b){b.getKey()==b.TAB&&insertAtCursor(String.fromCharCode("      "))}}});g=[["Mathematical",[["Round","Round(##Value$$)","Rounds a number to the nearest integer.",["Round(3.6)",
"4"]],["Round Up","Ceiling(##Value$$)","Rounds a number up to the nearest integer.",["Ceiling(3.6)","4"]],["Round Down","Floor(##Value$$)","Rounds a number down to the nearest integer.",["Floor(3.6)","3"]],["Cos","Cos(##Angle$$)","Finds the cosine of an angle.",["Cos({180 Degrees})","-1"]],["ArcCos","ArcCos(##Value$$)","Finds the arc-cosine of a value. The result includes units.",["ArcCos(0)","{90 Degrees}"]],["Sin","Sin(##Angle$$)","Finds the sine of an angle.",["Sin({180 Degrees})","0"]],["ArcSin",
"ArcSin(##Value$$)","Finds the arc-sine of a value.  The result includes units.",["ArcSin(1)","{90 Degrees}"]],["Tan","Tan(##Angle$$)","Finds the tangent of an angle.",["Tan({Pi/4 Radians})","1"]],["ArcTan","ArcTan(##Value$$)","Finds the arc-tangent of a value. The result includes units.",["ArcTan(1)","{45 Degrees}"]],["Log","Log(##Value$$)","Returns the base-10 logarithm of a number.",["Log(1000)","3"]],["Ln","Ln(##Value$$)","Returns the natural logarithm of a number.",["Ln(e^2)","2"]],["Exp","Exp(##Value$$)",
"Returns e taken to a power.",["Exp(1)","e"]],["Sum","Sum(##Values$$)","Returns the sum of a vector or list of numbers.",["Sum(7, 5, 6)","18"]],["Product","Product(##Values$$)","Returns the product of a vector or list of numbers.",["Product(2, 4, -1)","-8"]],["Maximum","Max(##Values$$)","Returns the largest of a vector or list of numbers.",["Max(2, 4, -1)","4"]],["Minimum","Min(##Values$$)","Returns the smallest of a vector or list of numbers.",["Min(2, 4, -1, 3)","-1"]],["Mean","Mean(##Values$$)",
"Returns the mean of a vector or list of numbers.",["Mean(2, 7, 3)","4"]],["Median","Median(##Values$$)","Returns the median of a vector or list of numbers.",["Median(2, 7, 3)","3"]],["Standard Deviation","StdDev(##Values$$)","Returns the standard deviation of a vector or list of numbers.",["StdDev(1, 2, 3)","1"]],["Absolute Value","Abs(##Value$$)","Returns the absolute value of a number.",["Abs(-23)","23"]],["Mod","##(Value One)$$ mod ##(Value Two)$$","Returns the remainder of the division of two numbers.",
["13 mod 5","3"]],["Square Root","Sqrt(##Value$$)","Returns the square root of a number.",["Sqrt(9)","3"]],["Pi","pi","The value 3.14159265."],["e","e","The value 2.71828183."],["Logit","Logit(##Value$$)","Returns the logit transformation of the value. Converts values on a 0 to 1 scale to a -Infinity to Infinity scale.",["Logit(0.5)","0"]],["Expit","Expit(##Value$$)","Returns the expit transformation of the value. Converts values on a -Infinity to Infinity scale to a 0 to 1 scale.",["Expit(0)","0.5"]]]],
["Time",[["Seconds","Seconds()","The current time in seconds.",["Seconds()*1000","The time in milliseconds"]],["Minutes","Minutes()","The current time in minutes.",["Seconds() = Minutes()*60","True"]],["Hours","Hours()","The current time in hours."],["Days","Days()","The current time in days."],["Weeks","Weeks()","The current time in weeks."],["Months","Months()","The current time in weeks."],["Years","Years()","The current time in years.","IfThenElse(Years() > 10, 15, 0)"],["Current Time","Time()",
"The current time including units.","IfThenElse(Time() > {10 Years}, 15, 0)"],["Time Start","TimeStart()","The simulation start time including units."],["Time Step","TimeStep()","The simulation time step including units."],["Time Length","TimeLength()","The total length of the simulation including units."],["Time End","TimeEnd()","The time at which the simulation ends including units.",["TimeStart() + TimeLength() = TimeEnd()","True"]]]],["Historical",[["Delay","Delay(##[Primitive]$$, ##Delay Length$$, ##Default Value$$)",
"Returns the value of a primitive for a specified length of time ago. Default Value stands in for the primitive value in the case of negative times.","Delay([Income], {5 Years})"],["Delay1","Delay1(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, first-order exponential delay of the value of a primitive. The Initial Value is optional.","Delay1([Income], 5, 10000)"],["Delay3","Delay3(##[Primitive]$$, ##Delay Length$$, ##Initial Value$$)","Returns a smoothed, third-order exponential delay of the value of a primitive. The Initial Value is optional.",
"Delay3([Income], {20 Months}, 10000)"],["Smooth","Smooth(##[Primitive]$$, ##Length$$, ##Initial Value$$)","Returns a smoothing of a primitive's past values. Results in an averaged curve fit. Length affects the weight of past values. The Initial Value is optional."],["PastValues","PastValues(##[Primitive]$$, ##Period = All Time$$)","Returns the values a primitive has taken on over the course of the simulation as a vector. The second optional argument is a time window to limit the depth of the history.",
["Sum(PastValues([Income]))","Total past income"]],["Maximum","PastMax(##[Primitive]$$, ##Period = All Time$$)","Returns the maximum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",["PastMax([Income], {10 Years})","The maximum income in the past 10 years"]],["Minimum","PastMin(##[Primitive]$$, ##Period = All Time$$)","Returns the minimum of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation.",
["PastMin([Income], 10)","The minimum income in the past 10 units of time"]],["Median","PastMedian(##[Primitive]$$, ##Period = All Time$$)","Returns the median of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Mean","PastMean(##[Primitive]$$, ##Period = All Time$$)","Returns the mean of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],
["Standard Deviation","PastStdDev(##[Primitive]$$, ##Period = All Time$$)","Returns the standard deviation of the values a primitive has taken on over the course of the simulation. The second optional argument is a time window to limit the calculation."],["Correlation","PastCorrelation(##[Primitive]$$, ##[Primitive]$$, ##Period = All Time$$)","Returns the correlation between the values that two primitives have taken on over the course of the simulation. The third optional argument is an optional time window to limit the calculation.",
["PastCorrelation([Income], [Expenditures], {10 Years})","The correlation between income and expenditures over the past 10 years."]],["Fix","Fix(##Value$$, ##Period=-1$$)","Takes the dynamic value and forces it to be fixed over the course of the period. If period is -1, the value is held constant over the course of the whole simulation.",["Fix(Rand(), {5 Years})","Chooses a new random value every five years"]]]],["Random Numbers",[["Uniform Distribution","Rand(##Minimum$$, ##Maximum$$)","Generates a uniformly distributed random number between the minimum and maximum. The minimum and maximum are optional and default to 0 and 1 respectively.",
["Rand()","0.7481"]],["Normal Distribution","RandNormal(##Mean$$, ##Standard Deviation$$)","Generates a normally distributed random number with a mean and a standard deviation. The mean and standard deviation are optional and default to 0 and 1 respectively.",["RandNormal(10, 1)","11.23"]],["Lognormal Distribution","RandLognormal(##Mean$$, ##Standard Deviation$$)","Generates a log-normally distributed random number with a mean and a standard deviation."],["Binary Distribution","RandBoolean(##Probability$$)",
"Returns 1 with the specified probability, otherwise 0. The probability is optional and defaults to 0.5: a coin flip.",["RandBoolean(0.1)","False"]],["Binomial Distribution","RandBinomial(##Count$$, ##Probability$$)","Generates a binomially distributed random number. The number of successes in Count random events each with Probability of success."],["Negative Binomial","RandNegativeBinomial(##Successes$$, ##Probability$$)","Generates a negative binomially distributed random number. The number of random events each with Probability of success required to generate the specified Successes."],
["Poisson Distribution","RandPoisson(##Lambda$$)","Generates a Poisson distributed random number."],["Triangular Distribution","RandTriangular(##Minimum$$, ##Maximum$$, ##Peak$$)","Generates a triangularly distributed random number."],["Exponential Distribution","RandExp(##Lambda$$)","Generates an exponentially distributed random number with the specified rate parameter."],["Gamma Distribution","RandGamma(##Alpha$$, ##Beta$$)","Generates a Gamma distributed random number."],["Beta Distribution","RandBeta(##Alpha$$, ##Beta$$)",
"Generates a Beta distributed random number."],["Custom Distribution","RandDist(##X$$, ##Y$$)","Generates a random number according to a custom distribution. Takes two vectors with the x- and y-coordinates respectively of points defining the distribution. Points are interpolated linearly. The distribution does not have to be normalized such that its area is 1, but the points must be sorted from smallest to largest x locations. You may also pass a single vector containing pairs of {x, y} coordinates (e.g. { {1, 0}, {3, 4}, {4, 0} } ).",
["RandDist({0, 1, 2, 3}, {0, 5, 1, 0})","1.2"]]]],["Agents",[["Find All","##[Agent Population]$$.FindAll()","Returns a vector of all the agents in the agent population."],["Find State","##[Agent Population]$$.FindState(##[State]$$)","Returns a vector of agents in the specified state.",["[University].FindState([Smoker])","All smokers in the University population"]],["Find Not State","##[Agent Population]$$.FindNotState(##[State]$$)","Returns a vector of agents not in the specified state.",["[University].FindNotState([Smoker])",
"All non-smokers in the University population"]],["Find Index","##[Agent Population]$$.FindIndex(##Index$$)","Returns an agent with the specified index. Agent indexes start at 1.",["[Population].FindIndex(1)","The first agent created"]],["Find Nearby","##[Agent Population]$$.FindNearby(##[Target]$$, ##Distance$$)","Returns a vector of agents that are within the specified distance of a target agent.",["[Population].FindState([Infected]).FindNearby(Self, 25)","All infected people who are near the agent"]],
["Find Nearest","##[Agent Population]$$.FindNearest(##[Target]$$, ##Count=1$$)","Returns the nearest agents to the target agent. The number of agents returned is specified by the optional Count.",["[Population].FindNearest([Target])","The nearest agent to the target"]],["Find Furthest","##[Agent Population]$$.FindFurthest(##[Target]$$, ##Count=1$$)","Returns the agent farthest from the target agent. The number of agents returned is specified by the optional Count.",["[Population].FindFurthest([Target], 4)",
"The four furthest agents from the target"]],["Value","##[Agent Population]$$.Value(##[Primitive]$$)","Returns the values of the specified primitive for each agent in the population as a vector.",["[University].Value([GPA]).Mean()","The average GPA of all students in the University population"]],["Set Value","##[Agent Population]$$.SetValue(##[Primitive]$$, ##Value$$)","Sets the value of the specified primitive for each agent in the population to the given value.",["[University].SetValue([Smoker], false)",
"Make all the smokers quit smoking"]],["Location","##[Agent]$$.Location()","Returns the location of an agent as the vector {x, y}.",["Self.Location().x","The x-coordinate of the agent"]],["Distance","Distance(##[Agent 1]$$, ##[Agent 2]$$)","Returns the distance between two agents."],["Move","##[Agent]$$.Move(##{x, y}$$)","Moves an agent the amount specified.",["Self.Move({Rand(), Rand()})","Take a random walk"]],["MoveTowards","##[Agent]$$.MoveTowards(##[Target]$$, ##Distance$$)","Moves an agent towards a target agent the distance specified.",
["Self.MoveTowards([Prey], 10)","Chase after the prey"]],["Connected","##[Agent]$$.Connected()","Returns the agents connected to an agent in the network.",["Self.Connected().Length()","The number of connections an agent has"]],["Connect","##[Agent 1]$$.Connect(##[Agent 2]$$)","Connects two agents in the network. The second agent can also be a vector of agents.",["Self.Connect([Population].FindNearest(Self))","Connects an agent to the nearest agent to it in the population"]],["Unconnect","##[Agent 1]$$.Unconnect(##[Agent 2]$$)",
"Unconnects two agents in the network. The second agent can also be a vector of agents.",["Self.Unconnect(Self.Connected())","Removes an agent's connections"]],["PopulationSize","##[Agent Population]$$.PopulationSize()","The total number of agents in a population."],["Add","##[Agent Population]$$.Add(##[Base]=Initial Agent$$)","Adds a new agent to the population. If [Base] is set, the new agent will be a clone of [Base]. Otherwise the agent will be like a newly created agent at the start of the simulation.",
["Repeat([University].Add(), 200)","Enroll 200 new students in the University"]],["Remove","##[Agent]$$.Remove()",'Removes an agent from the population. The agent will no longer be simulated. Can be used to "Kill" an agent.',["[University].FindState([Smoker]).Map(x.Remove())","Expel all the smokers from the University"]],["Width","Width(##[Agent]$$)","The width of the geographic region an agent is within."],["Height","Height(##[Agent]$$)","The height of the geographic region and agent is within."]]],
["Vectors",[["Range","##Start$$:##End$$",'Creates a vector with a range of sequential values going from start to end. To use step sizes other than 1, place the step size between the start and the end, for example "0:0.5:10".',["1:5","{1, 2, 3, 4, 5}"]],["Length","##Vector$$.Length()","The number of elements in a vector. Count() is a synonym for length.",["{1, 1, 2, 3}.Length()","4"]],["Select","##Vector$${##Selector$$}","Selects one or more elements from a vector. The selector can be an integer or vector of integers, a string or vector of strings (for named vectors), or a vector of booleans.",
["{1,3,7}{2}","3"]],["Join","Join(##Item 1$$, ##Item 2$$, ##Item N$$)","Merges items together into a single vector.",["Join(0, {1, 1, 2})","{0, 1, 1, 2}"]],["Flatten","##Vector$$.Flatten()","Flattens a vector removing and expanding all nested vectors.",["{ {0}, {1, 1, 2} }.Flatten()","{0, 1, 1, 2}"]],["Unique","##Vector$$.Unique()","Returns a vector with duplicates removed.",["{1, 1, 2, 3}.Unique()","{1, 2, 3}"]],["Union","##Vector$$.Union(##Vector 2$$)","Returns the combined elements of two vectors (with duplicates removed).",
["{1, 2}.Union({2, 3})","{1, 2, 3}"]],["Intersection","##Vector$$.Intersection(##Vector 2$$)","Returns the elements that exist in both vectors.",["{1, 2}.Intersection({2, 3})","{2}"]],["Difference","##Vector$$.Difference(##Vector 2$$)","Returns the elements that exist in only one of the two vectors.",["{1, 2}.Difference({2, 3})","{1, 3}"]],["Sort","##Vector$$.Sort()","Sorts a vector from smallest value to largest value.",["{1, 3, 2}.Sort()","{1, 2, 3}"]],["Reverse","##Vector$$.Reverse()","Reverses the ordering of elements in a vector.",
["{1, 2, 3}.Reverse()","{3, 2, 1}"]],["Sample","##Vector$$.Sample(##Sample Size$$, ##Allow Repeats=False$$)","Takes a random sample from a vector. Allow Repeats determines whether the same index can be sampled multiple time and is false by default.",["{1, 4, 9}.Sample(2)","{9, 1}"]],["IndexOf","##Vector$$.IndexOf(##Needle$$)","Returns the position of the needle within the vector (starting with index 1). If the needle is not found, 0 is returned.",["{1, 4, 9}.IndexOf(9)","3"]],["Contains","##Vector$$.Contains(##Needle$$)",
"Returns true if the needle is in the vector. Otherwise returns false.",["{1, 4, 9}.Contains(9)","true"]],["Repeat","Repeat(##Expression$$, ##Times$$)","Creates a new vector by repeating an expression a specified expression a number of times. 'x' in the expression refers to the current index. Times may also be a vector of strings in which case a named vector is created.",["Repeat(x^2, 3)","{1, 4, 9}"]],["Map","##Vector$$.Map(##Function$$)","Applies a function to each element of a vector and returns the result. The function may also be an expression where 'x' in the expression represents the current element.",
["{1, 2, 3}.Map(x*2)","{2, 4, 6}"]],["Filter","##Vector$$.Filter(##Function$$)","Tests each element of a vector using a function and returns the elements which evaluate to true. The function may also be an expression where 'x' in the expression represents the current element.",["{1, 2, 3}.Filter(x >= 2)","{2, 3}"]],["Keys","##Vector$$.Keys()","Returns the keys for a named vector as a vector. Any element without a key will be omitted.",["{a: 1, b: 4, b: 9}.Keys()","{'a', 'b', 'c'}"]],["Values","##Vector$$.Values()",
"Returns the values of a vector (stripping away any keys if it is a named vector).",["{a: 1, b: 4, b: 9}.Values()","{1, 4, 9}"]]]],["General",[["If Then Else","IfThenElse(##Test Condition$$, ##Value if True$$, ##Value if False$$)","Tests a condition and returns one value if the condition is true and another value if the condition is false.",["IfThenElse(20 > 10, 7, 5)","7"]],["Pulse","Pulse(##Time$$, ##Height$$, ##Width=0$$, ##Repeat=-1$$)","Creates a pulse input at the specified time with the specified Height and Width. Height defaults to 1 and Width defaults to 0. Repeat is optional and will create a pulse train with the specified time if positive..",
"Pulse({10 Years}, 5, 2)"],["Step","Step(##Start$$, ##Height=1$$)","Creates an input that is initially set to 0 and after the time of Start is set to Height. Height defaults to 1.","Step({10 Years}, 5)"],["Ramp","Ramp(##Start$$, ##Finish$$, ##Height=1$$)","Creates a ramp input which moves linearly from 0 to Height between the Start and Finish times. Before Start, the value is 0; after Finish, the value is Height. Height defaults to 1.","Ramp({10 Year}, {20 Years}, 5)"],["Pause","Pause()","Pauses the simulation and allows sliders to be adjusted. Often used in combination with an IfThenElse function.",
"IfThenElse(Years() = 20, Pause(), 0)"],["Stop","Stop()","Immediately terminates the simulation. Often used in combination with an IfThenElse function.","IfThenElse(Rand() < 0.01, Stop(), 0)"]]],["Strings",[["Length","##String$$.Length()","The length of a string in characters.",['"abcde".Length()',"5"]],["Range","##String$$.Range(##Characters$$)","Obtains a certain character or set of characters.",['"abcde".Range(2:4)','"bcd"']],["Split","##String$$.Split(##Deliminator$$)","Splits a string into a vector at the locations of the Deliminator.",
['"abcde".Split("c")','{"ab", "de"}']],["IndexOf","##String$$.IndexOf(##Needle$$)","Finds the location of the first occurrence of the needle in the string.",['"abcde".IndexOf("c")',"3"]],["Contains","##String$$.Contains(##Needle$$)","Returns true if the needle is in the string. Otherwise returns false.",['"abcde".Contains("cd")',"true"]],["UpperCase","##String$$.UpperCase()","Uppercases all letters in a string.",['"Test".UpperCase()','"TEST"']],["LowerCase","##String$$.LowerCase()","Lowercases all letters in a string.",
['"Test".LowerCase()','"test"']],["Join","##Vector$$.Join(##String$$)","Combines the characters in a vector using the given string.",['{"a", "bc", "d"}.Join("-")','"a-bc-d"']],["Trim","##String$$.Trim()","Removes whitespace on either side of a string.",['" abc  ".Trim()','"abc"']],["Parse","##String$$.Parse()","Converts a string to a number.",['"1.2".Parse() + 3.3',"4.5"]]]],["Programming",[["Variables","##Variable$$ <- ##Value$$","Assigns a value to a reusable variable.",["x <- 10\nx^2","100"]],
["If-Then-Else","If ##Condition$$ Then\n  ##Expression$$\nElse If ##Condition$$ Then\n  ##Expression$$\nElse\n  ##Expression$$\nEnd If","Test one or more conditions and selectively execute code based on these tests."],["While Loop","While ##Condition$$\n  ##Expression$$\nEnd Loop","Repeats an action until a condition is no longer true.",["x <- 1\nWhile x < 10\n  x <- x*2\nEnd Loop\nx","16"]],["For-In Loop","For ##Variable$$ in ##Vector$$\n  ##Expression$$\nEnd Loop","Repeats an action for each element in a vector.",
["sum <- 0\nFor x in {1, 10, 27}\n  sum <- sum + x\nEnd Loop\nsum","38"]],["Functions","Function ##Name$$()\n  ##Expression$$\nEnd Function","Creates a reusable function.",["Function Square(x)\n  x^2\nEnd Function\nSquare(5)","25"]],["Anonymous Functions","##Variable$$ <- Function()\n  ##Expression$$\nEnd Function","Creates an anonymous function.",["square <- Function(x)\n  x^2\nEnd Function\nsquare(5)","25"]],["Anonymous Functions","Function() ##Expression$$","Creates a single-line anonymous function.",
["{1, 2, 3}.Map(Function(value) value^2 - value)","{0, 2, 6}"]],["Throwing Errors","throw '##Message$$'","Passes an error message up to the nearest Try-Catch block or aborts the simulation with the error message.",'throw "Error: Index out of range."'],["Error Handling","Try\n  ##Expression$$\nCatch ##ErrorString$$\n  ##Expression // Handle the error$$\nEnd Try","Attempts to execute some code. If an error occurs, the error is passed as a string variable to the catch block which will then be executed. The catch block will not be executed unless an error occurs.",
'Try\n  mean(x)\nCatch err\n  alert("Could not calculate the mean of the variable. Error Message: "+err)\nEnd Try']]],["User Input",[["Alert","Alert(##Message$$)","Show an alert dialogue with the message.",'Alert("An event has occurred.")'],["Prompt","Prompt(##Message$$, ##Default=''$$)","Prompts the user for an input and returns it. Can optionally provide a default value for the input.",'timeScale <- Prompt("What time scale should we use?.", 10).Parse()'],["Confirm","Confirm(##Message$$)","Prompts the user to confirm a statement and returns a boolean based on whether they confirmed it or not.",
'advanced <- Confirm("Use advanced mode?")']]]];d=[];for(a=0;a<g.length;a++){for(var k=[],h=0;h<g[a][1].length;h++)b(g[a][1][h]);d.push({title:g[a][0],items:k,layout:{type:"hbox",align:"stretch"},autoScroll:!0})}a=new Ext.Component({html:"<big><big><big>=</big></big></big>",region:"west",margin:"0 0 0 3"});d=new Ext.TabPanel({region:"south",height:85,activeTab:0,margin:"0 3 0 3",enableTabScroll:!0,items:d,border:!1});g=getText("Equation Editor");"Stock"==e.value.nodeName?g=getText("Initial Value Equation"):
"Variable"==e.value.nodeName?g=getText("Variable Equation"):"State"==e.value.nodeName?g=getText("Initial Active Equation"):"Flow"==e.value.nodeName?g=getText("Flow Rate Equation"):"Transition"==e.value.nodeName&&(g=getText("Transition Equation"));c.win=new Ext.Window({title:g+": "+clean(e.getAttribute("name")),layout:"border",closeAction:"destroy",border:!1,modal:!0,items:[codeEditor,f,d,a],width:Math.min(Ext.getBody().getViewSize().width,600),height:Math.min(Ext.getBody().getViewSize().height,400),
resizable:!1,shadow:!0,buttonAlign:"left",buttons:[{disabled:!viewConfig.allowEdits,hidden:"State"==e.value.nodeName||"Action"==e.value.nodeName||"Transition"==e.value.nodeName||"Agents"==e.value.nodeName,scale:"large",text:getText("Units"),iconCls:"units-icon",tooltip:getText("Edit primitive units"),handler:function(){(new Ext.UnitsWindow({parent:"",cell:e,units:e.getAttribute("Units")})).show()}},"->",{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.win.close();""!=
c.args.parent&&c.args.parent.resumeEvents()}},{disabled:!viewConfig.allowEdits,iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){var a=codeEditor.getValue(),a=a.replace(/\n|\r/g,"\\n");""!=c.args.parent&&c.args.parent.setValue(a);c.win.close();""!=c.args.parent?(c.args.parent.resumeEvents(),grid.plugins[0].completeEdit(),c.args.parent.setEditable(!/\\n/.test(a))):(graph.getModel().beginUpdate(),setValue(c.args.cell,a),graph.getModel().endUpdate(),selectionChanged(!1))}}]});
f.on("beforeselect",function(a,b){b.data.name&&(insertAtCursor("["+b.data.name+"]"),codeEditor.focus(!1,!0));return!1});c.show=function(){c.win.show();codeEditor.focus(!0,!0)}};
function insertAtCursor(a){var b=codeEditor.getFocusEl().id,b=document.getElementById(b);b.focus();var c=getInputSelection(b).start,d=getInputSelection(b).end;codeEditor.setValue(codeEditor.getValue().substring(0,c)+a+codeEditor.getValue().substring(d,codeEditor.getValue().length));codeEditor.getFocusEl().focus();b.setSelectionRange?(b.focus(),b.setSelectionRange(d+a.length,d+a.length)):b.createTextRange&&(c=b.createTextRange(),c.collapse(!0),c.moveEnd("character",d+a.length),c.moveStart("character",
d+a.length),c.select());b.focus()}
function getInputSelection(a){var b=0,c=0,d,e,f;if("number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd)b=a.selectionStart,c=a.selectionEnd;else if((e=document.selection.createRange())&&e.parentElement()==a)f=a.value.length,d=a.value.replace(/\r\n/g,"\n"),c=a.createTextRange(),c.moveToBookmark(e.getBookmark()),a=a.createTextRange(),a.collapse(!1),-1<c.compareEndPoints("StartToEnd",a)?b=c=f:(b=-c.moveStart("character",-f),b+=d.slice(0,b).split("\n").length-1,-1<c.compareEndPoints("EndToEnd",
a)?c=f:(c=-c.moveEnd("character",-f),c+=d.slice(0,c).split("\n").length-1));return{start:b,end:c}};Ext.form.customFields.converter=Ext.extend(Ext.form.customFields.converter,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.ConverterWindow({parent:this,oldKeys:this.getValue(),interpolation:graph.getSelectionCell().getAttribute("Interpolation")});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.ConverterWindow=function(a){function b(){isUndefined(q)||(q.axes.items[1].minimum=d()[0],q.axes.items[1].maximum=d()[1]);for(var a="",b=0;b<m.getCount();b++)0<b&&(a+=";"),a=a+m.getAt(b).data.xVal+","+m.getAt(b).data.yVal;for(var c=[],a=a.split(";"),e=[],b=0;b<a.length;b++){var g=a[b].split(",");0<b&&c.push({xVal:parseFloat(g[0]),yVal:parseFloat(e[1])});c.push({xVal:parseFloat(g[0]),yVal:parseFloat(g[1])});e=g}null==f?f=new Ext.data.Store({fields:l,data:c}):(f.removeAll(),f.loadData(c))}function c(){for(var a=
"",b=0;b<m.getCount();b++)0<b&&(a+="; "),a=a+m.getAt(b).data.xVal+","+m.getAt(b).data.yVal;return a}function d(){return 0==m.getCount()?[0,1]:[m.getAt(0).data.xVal,m.getAt(m.getCount()-1).data.xVal]}var e=this;e.args=a;var f=null,a=[];if(!isUndefined(e.args.oldKeys))for(var g=e.args.oldKeys.split(";"),h=0;h<g.length;h++){var k=g[h].split(",");a.push({xVal:parseFloat(k[0]),yVal:parseFloat(k[1])})}var l=[{name:"xVal",type:"float"},{name:"yVal",type:"float"}],m=new Ext.data.Store({fields:l,data:a,sorters:["xVal"]}),
n=new Ext.grid.plugin.CellEditing({clicksToEdit:1}),o=new Ext.grid.GridPanel({store:m,width:600,region:"center",margins:"0 5 5 5",plugins:[n],viewConfig:{headersDisabled:!0,markDirty:!1},tbar:["->",{iconCls:"units-add-icon",text:getText("Add Point"),handler:function(){n.completeEdit();m.insert(0,{xVal:0,yVal:0});m.sort("xVal","ASC");o.getView().refresh();var a=m.findBy(function(a){return 0==a.get("xVal")&&0==a.get("yVal")});o.getSelectionModel().selectRange(a,a);n.startEdit(a,a)}}],columns:[{id:"xVal",
header:getText("Input Value"),dataIndex:"xVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}},{header:getText("Output Value"),dataIndex:"yVal",flex:1,sortable:!1,menuDisabled:!0,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10,selectOnFocus:!0}},{xtype:"actioncolumn",width:40,items:[{iconCls:"units-remove-icon",tooltip:getText("Delete"),handler:function(a,c){m.remove(m.getAt(c));m.sort("xVal","ASC");b();o.getView().refresh()}}]}]});
b();var a="Linear"==e.args.interpolation?m:f,g="",g=""!=e.args.parent?graph.getSelectionCell():e.args.cell,g="Time"==g.getAttribute("Source")?"Time":findID(g.getAttribute("Source")).getAttribute("name"),q=new Ext.chart.Chart({xtype:"chart",store:a,animate:!1,shadow:!1,axes:[{type:"Numeric",position:"left",fields:["yVal"],title:getText("Output"),grid:!0,labelTitle:{font:"14px Verdana"}},{type:"Numeric",position:"bottom",fields:["xVal"],title:getText("Input")+" ("+clean(g)+")",grid:!0,maximum:d()[1],
minimum:d()[0],labelTitle:{font:"14px Verdana"}}],series:[{type:"line",axis:"left",showMarkers:!0,highlight:!1,smooth:!1,style:{"stroke-width":3},xField:"xVal",yField:"yVal"}],listeners:{click:function(a){var c=q.getEventXY(a),d=0,e=1,f=0.01,g=0.01;q.revX&&(d=q.revX(c[0]),e=q.revY(c[1]),f=q.revX(c[0]+1)-d,g=q.revY(c[1]-1)-e);var h,k,c=f.toExponential().split("e")[1];h="-"==c[1]?(Math.round(d/Math.pow(10,c+1))*Math.pow(10,c+1)).toPrecision(9):(Math.round(d/Math.pow(10,c-1))*Math.pow(10,c-1)).toPrecision(9);
c=g.toExponential().split("e")[1];k="-"==c[1]?(Math.round(e/Math.pow(10,c+1))*Math.pow(10,c+1)).toPrecision(9):(Math.round(e/Math.pow(10,c-1))*Math.pow(10,c-1)).toPrecision(9);if(a.shiftKey)c=m.findBy(function(a){return a.get("xVal")>d-4*f&&a.get("xVal")<d+4*f&&a.get("yVal")>e-4*g&&a.get("yVal")<e+4*g}),-1<c&&m.remove(m.getAt(c));else if(a.altKey){if(0<m.count()){for(var c=m.getAt(0),l=1;l<m.count();l++)Math.abs(c.get("xVal")-d)>Math.abs(m.getAt(l).get("xVal")-d)&&(c=m.getAt(l));c.set("xVal",h);c.set("yVal",
k)}}else c=m.findBy(function(a){return a.get("xVal")>d-3*f&&a.get("xVal")<d+3*f}),(c=-1<c?m.getAt(c):null)?c.set("yVal",k):(a={xVal:h,yVal:k},n.completeEdit(),m.insert(0,a));m.sort("xVal","ASC");a.shiftKey||(a=m.findBy(function(a){return a.get("xVal")==h&&a.get("yVal")==k}),0<=a&&o.getSelectionModel().selectRange(a,a));b();o.getView().refresh()}}}),a=new Ext.Panel({width:490,height:200,layout:"fit",margins:"5 5 0",region:"north",split:!0,minHeight:100,maxHeight:500,items:q});e.win=new Ext.Window({title:getText("Converter Data Specification"),
layout:"border",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,508),height:Math.min(Ext.getBody().getViewSize().height,500),items:[a,o],buttons:[{disabled:!viewConfig.allowEdits,scale:"large",text:getText("Units"),iconCls:"units-icon",tooltip:getText("Edit primitive units"),handler:function(){(new Ext.UnitsWindow({parent:"",cell:e.args.cell,units:e.args.cell.getAttribute("Units")})).show()}},
{disabled:!viewConfig.allowEdits,scale:"large",text:getText("Import Data"),iconCls:"import-icon",tooltip:getText("Import data from a CSV or other text file"),handler:function(){importData(m)}},"->",{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){e.win.close();""!=e.args.parent&&e.args.parent.resumeEvents()}},{disabled:!viewConfig.allowEdits,scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){n.completeEdit();""!=e.args.parent?e.args.parent.setValue(c()):
e.args.cell.setAttribute("Data",c());e.win.close();""!=e.args.parent?(e.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):selectionChanged(!1)}}]});m.on("update",function(){m.sort("xVal","ASC");b()});m.on("dataChanged",function(){b()});e.show=function(){e.win.show()}};
function setConverterInit(a){var b=parseFloat(getTimeStart(),10),c=parseFloat(getTimeStart(),10)+parseFloat(getTimeLength(),10);a.setAttribute("Data",b+","+Math.pow(b,2)+"; "+(b+c)/2+","+Math.pow((b+c)/2,2)+"; "+c+","+Math.pow(c,2))};function importData(a){var b=new Ext.FormPanel({fieldDefaults:{labelWidth:130,width:355},autoScroll:!0,frame:!0,defaultType:"textfield",items:[{xtype:"displayfield",fieldLabel:"",value:"<center>"+getText("Copy and paste the contents from your CSV file or tab-delimited file into the data field below.")+"</center>"},{xtype:"textareafield",fieldLabel:"Data",name:"impData",id:"impData",allowBlank:!1,selectOnFocus:!0,value:getText("Example Input, Example Output")+"\n24, 62\n641, 12\n234, 56\n123, 19",
height:195},{xtype:"checkboxfield",fieldLabel:getText("Include First Row"),inputValue:"1",name:"impIncludeHeader",id:"impIncludeHeader"},new Ext.form.NumberField({fieldLabel:getText("Input Column Index"),name:"impInputIndex",id:"impInputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:1}),new Ext.form.NumberField({fieldLabel:getText("Output Column Index"),name:"impOutputIndex",id:"impOutputIndex",allowBlank:!1,minValue:1,allowDecimals:!1,value:2})]}),c=new Ext.Window({title:getText("Import Converter Data"),
layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,380),height:Math.min(Ext.getBody().getViewSize().height,410),items:[b],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Import"),handler:function(){try{var b=parseCSV(Ext.getCmp("impData").getValue())}catch(e){mxUtils.alert(getText("There was an error with your data file. It should be a valid CSV or tab-delimited text file."));
return}if(0>=b.length)mxUtils.alert(getText("Could not import as no data entered."));else{var f=Ext.getCmp("impInputIndex").getValue()-1,g=Ext.getCmp("impOutputIndex").getValue()-1;if(f<b[0].length&&g<b[0].length){a.removeAll();for(var h=[],k=0==Ext.getCmp("impIncludeHeader").getValue()?1:0;k<b.length;k++)try{var l=flexibleParseFloat(b[k][f]),m=flexibleParseFloat(b[k][g]);isNaN(l)||isNaN(m)?mxUtils.alert(getText("(%s, %s) is not a pair of numbers. Skipping row during import.",b[k][f],b[k][g])):h.push({xVal:l,
yVal:m})}catch(n){mxUtils.alert(getText("Skipping badly formed row (%s, %s) on import.",b[k][f],b[k][g]))}a.add(h);c.close()}else mxUtils.alert(getText("Invalid column index for data file. Maximum number of columns is %s.",b[0].length))}}}]});c.show()}function flexibleParseFloat(a){return parseFloat(a.replace(/\,/g,""))}
function parseCSV(a){var b=/([,\015\012\t;] *)/g,c=/("")*"([,\015\012\t;] *)/g,d=0,e=[],f=[];do{var g='"'==a.charAt(d)?c:b;g.lastIndex=d;var h=g.exec(a);if(!h||!h.length)break;d=a.substring(d,g.lastIndex-h[h.length-1].length);'"'==d.charAt(0)&&(d=d.substring(1,d.length-1).replace(/""/g,'"'));f.push(d);h=h[0];0>h.indexOf(",")&&0>h.indexOf("\t")&&(e.push(f),f=[]);d=g.lastIndex}while(1);d<a.length&&(a=a.substring(d).trim())&&f.push(a);0<f.length&&e.push(f);return e};Ext.form.customFields.units=Ext.extend(Ext.form.customFields.units,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.UnitsWindow({parent:this,units:this.getValue()});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.UnitsWindow=function(a){var b=this;b.setUnitsText=function(a){c.setValue(clean(a))};b.args=a;var c=new Ext.form.field.Text({xtype:"textfield",height:40,fieldStyle:"font-size: x-large; text-align:center;",stripCharsRe:/[^A-Za-z 0-9\.\/\(\)\*\^]/g});b.args.tree=new Ext.tree.Panel({animate:!1,frame:!0,autoScroll:!0,useArrows:!0,flex:1,margin:"5,5,5,5",rootVisible:!1,folderSort:!1,listeners:{selectionchange:function(a,c){c[0].data.leaf&&b.setUnitsText(c[0].data.text)}}});b.setupUnits=function(a){a.setRootNode({text:getText("Units"),
draggable:!1,id:"Units",leaf:!1,iconCls:"icon-folder"});var b=a.getRootNode(),a=[b],c=b.appendChild({text:"Unitless",draggable:!1,leaf:!0,expanded:!0}),g=unitsUsedInModel();if(0<g.length)for(var c=b.appendChild({text:getText("Units Used in Model"),draggable:!1,leaf:!1,expanded:!0}),h=0;h<g.length;h++)c.appendChild({text:g[h],draggable:!1,leaf:!0,expanded:!0});g=customUnits();if(0<g.length){c=b.appendChild({text:getText("Custom Units"),draggable:!1,leaf:!1,expanded:!0});for(h=0;h<g.length;h++)c.appendChild({text:clean(g[h][0]),
draggable:!1,leaf:!0,expanded:!1})}b=0;g="Distance, Area and Volume\r Metric\r  Millimeters\r  Centimeters\r  Meters\r  Kilometers\r  -\r  Square Millimeters\r  Square Centimeters\r  Square Meters\r  Hectares\r  Square Kilometers\r  -\r  Cubic Millimeters\r  Cubic Centimeters\r  Liters\r  Cubic Meters\r English\r  Inches\r  Feet\r  Yards\r  Miles\r  -\r  Square Inches\r  Square Feet\r  Square Yards\r  Acres\r  Square Miles\r  -\r  Fluid Ounces\r  Quarts\r  Gallons\r  Acre Feet\rVelocity, Acceleration and Flow\r Metric\r  Meters per Second\r  Meters per Second Squared\r  Kilometers per Hour\r  Kilometers per Hour Squared\r  -\r  Liters per Second\r  Cubic Meters per Second\r  -\r  Kilograms per Second\r English\r  Feet per Second\r  Feet per Second Squared\r  Miles per Hour\r  Miles per Hour Squared\r  -\r  Gallons per Second\r  Gallons per Minute\r  -\r  Pounds per Second\rMass, Force and Pressure\r Metric\r  Milligrams\r  Grams\r  Kilograms\r  Tonnes\r  -\r  Newtons\r  -\r  Pascals\r  Kilopascals\r  Bars\r  Atmospheres\r English\r  Ounces\r  Pounds\r  Tons\r  -\r  Pounds Force\r  -\r  Pounds per Square Inch\rTemperature and Energy\r Metric\r  Degrees Celsius\r  Degrees Kelvin\r  -\r  Joules\r  Kilojoules\r  -\r  Watts\r  Kilowatts\r  Megawatts\r  Gigawatts\r  -\r  Amperes\r  -\r  Millivolts\r  Volts\r  Kilovolts\r  -\r  Coulombs\r  -\r  Farads\r English\r  Degrees Fahrenheit\r  -\r  Calories\r  Kilocalories\r  British Thermal Units\rTime\r Milliseconds\r Seconds\r Minutes\r Hours\r Days\r Weeks\r Months\r Quarters\r Years\rMoney\r Dollars\r Flow of Dollars\r  Dollars per Second\r  Dollars per Hour\r  Dollars per Day\r  Dollars per Week\r  Dollars per Month\r  Dollars per Quarter\r  Dollars per Year\r -\r Euros\r Flow of Euros\r  Euros per Second\r  Euros per Hour\r  Euros per Day\r  Euros per Week\r  Euros per Month\r  Euros per Quarter\r  Euros per Year\rBusiness and Commerce\r People\r Customers\r Employees\r Workers\r -\r Factories\r Buildings\r -\r Units\r Widgets\r Parts\rEcology and Nature\r Individuals\r Animals\r Plants\r Trees\r Biomass\rChemistry\r Atoms\r Molecules\r -\r Moles".split(/[\n\r]/);
for(h=0;h<g.length;h++){var k=g[h].match(/^ *(.*?)$/);if("-"!=k[1]){var l=g[h].length-k[1].length;if(l>b)c.leaf=!1,c.iconCls="icon-folder",c=a[a.length-1].appendChild(c),a.push(c);else if(l<b){a[a.length-1].appendChild(c);for(c=0;c<b-l;c++)a.pop()}else a[a.length-1].appendChild(c);b=l;c={text:k[1],draggable:!1,leaf:!0,expanded:!1}}}};b.setupUnits(b.args.tree);b.win=new Ext.Window({title:getText("Primitive Value Units"),layout:{type:"vbox",align:"stretch"},closeAction:"destroy",border:!1,modal:!0,
resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,508),height:Math.min(Ext.getBody().getViewSize().height,400),items:[c,b.args.tree],buttons:[{id:"units_but",scale:"large",text:getText("Custom Named Units"),iconCls:"units-icon",handler:function(){var a=getSetting(),c=Ext.create("Ext.data.Store",{fields:[{name:"name",type:"string"},{name:"synonym",type:"string"},{name:"scale",type:"float"}],data:function(){for(var a=[],b=customUnits(),
c=0;c<b.length;c++){var d=b[c];a.push({name:d[0],scale:d[1],synonym:d[2]})}return a}(),sorters:["name"]}),f=new Ext.grid.plugin.RowEditing({saveText:"Apply"}),g=[{header:getText("Name"),dataIndex:"name",flex:2,sortable:!0,editor:{xtype:"textfield",allowBlank:!1,regex:/^[a-zA-Z][a-z A-Z]*$/,regexText:getText("The unit name may only contain letters and spaces.")}},{xtype:"numbercolumn",header:getText("Scale"),dataIndex:"scale",width:100,sortable:!1,editor:{xtype:"numberfield",allowBlank:!1,decimalPrecision:10}},
{header:getText("Synonym"),dataIndex:"synonym",flex:3,sortable:!1,editor:{xtype:"textfield",allowBlank:!0,regex:/^([a-zA-Z][a-z A-Z]*(\^-?[\d\.]+)?[\*\/]?)*$/,regexText:getText("The unit synonym should be of the form: Meters*Seconds^2/Kilograms.")}}],h=new Ext.grid.GridPanel({store:c,plugins:[f],features:[],tbar:[{iconCls:"units-remove-icon",itemId:"removeBut",text:getText("Remove Units"),disabled:!0,handler:function(){f.completeEdit();for(var a=h.getSelectionModel().getSelection(),b=0,d;d=a[b];b++)c.remove(d)}},
"->",{iconCls:"units-add-icon",text:getText("Add Units"),handler:function(){var a={name:getText("New Unit"),synonym:"",scale:1};f.completeEdit();c.insert(0,a);c.getAt(0).setDirty();h.getView().refresh();h.getSelectionModel().selectRange(0,0);f.startEdit(0,0)}}],columns:g});h.getSelectionModel().on("selectionchange",function(a){h.getDockedItems()[0].getComponent("removeBut").setDisabled(1>a.getCount())});var k=new Ext.Window({layout:"fit",modal:!0,title:getText("Configure Custom Units"),width:Math.min(Ext.getBody().getViewSize().width,
430),height:Math.min(Ext.getBody().getViewSize().height,330),resizable:!0,closeAction:"close",closable:!1,items:[h],obj:b,buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){k.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){h.plugins[0].completeEdit();for(var f=c.getCount(),g=0;g<f;g++)c.getAt(g).commit();f="";0<c.getCount()&&(f=c.getAt(0).get("name")+"<>"+c.getAt(0).get("scale")+"<>"+c.getAt(0).get("synonym"));for(g=1;g<c.getCount();g++)f=
f+"\n"+c.getAt(g).get("name")+"<>"+c.getAt(g).get("scale")+"<>"+c.getAt(g).get("synonym");graph.getModel().beginUpdate();g=new mxCellAttributeChange(a,"Units",f);graph.getModel().execute(g);graph.getModel().endUpdate();b.setupUnits(b.args.tree);k.close()}}]});k.show()},scope:this},"->",{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){b.win.close();""!=b.args.parent&&b.args.parent.resumeEvents()}},{disabled:!viewConfig.allowEdits,scale:"large",iconCls:"apply-icon",text:getText("Apply"),
handler:function(){""!=b.args.parent?(b.args.parent.setValue(c.getValue()),b.win.close(),b.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):(graph.getModel().beginUpdate(),b.args.cell.setAttribute("Units",c.getValue()),graph.getModel().endUpdate(),b.win.close())}}]});b.show=function(){b.win.show();b.setUnitsText(b.args.units)}};var sensitivityProgress,sensitivityController={};
function doSensitivity(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=[],c=primitives(),d=0;d<c.length;d++)isValued(c[d])&&!inAgent(c[d])&&b.push({pid:c[d].id,pname:c[d].getAttribute("name")});a.loadData(b);var b=getSetting(),a=new Ext.FormPanel({fieldDefaults:{labelWidth:145,width:355},autoScroll:!0,frame:!0,defaultType:"textfield",items:[Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Monitored Primitives"),name:"monPrimitives",
id:"monPrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to monitor"),value:b.getAttribute("SensitivityPrimitives")?b.getAttribute("SensitivityPrimitives").split(","):[]}),new Ext.form.NumberField({fieldLabel:getText("Number of Runs"),name:"nRuns",id:"nRuns",allowBlank:!1,minValue:10,allowDecimals:!1,value:b.getAttribute("SensitivityRuns")}),{fieldLabel:getText("Confidence Regions")+" (%)",name:"confRegion",id:"confRegion",allowBlank:!1,
value:b.getAttribute("SensitivityBounds")},{xtype:"checkboxfield",fieldLabel:getText("Plot Each Run (slower)"),inputValue:"true",name:"plotEach",id:"plotEach",checked:isTrue(b.getAttribute("SensitivityShowRuns"))},{xtype:"displayfield",fieldLabel:"",value:"<div style='padding-top:1.2em; padding-left: 0.8em;padding-right: 0.8em'><img style='float:left; margin-right: 7px' src='"+builder_path+"/images/gui/help.png' width=32px height=32px />Sensitivity analysis runs your simulation multiple times with random inputs to see how the results vary (in a sense, how 'sensitive' the results are to the inputs).<br/><br/> In order to use sensitivity analysis you need to have sources of randomness in your model. For instance, you can use the <i>Rand()</i> function or other Insight Maker random generation functions to choose random variables or random starting values. Please note, that if you want to have a random variable value, you can use <i>Fix(Rand())</i> to set the variable to a random value at the start of the simulation and keep it at the same value for the rest of that simulation.</div>"}]}),
e=new Ext.Window({title:getText("Sensitivity Analysis"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,380),height:Math.min(Ext.getBody().getViewSize().height,425),items:[a],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){e.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Run Analysis"),handler:function(){var a=Ext.getCmp("nRuns").getValue(),
b=Ext.getCmp("monPrimitives").getValue(),c=Ext.Array.map(Ext.getCmp("confRegion").getValue().split(","),parseFloat),d=isTrue(Ext.getCmp("plotEach").getValue());if(1>b.length)mxUtils.alert(getText("You must select one or more primitives to monitor."));else if(1>c.length)mxUtils.alert(getText("You must specify one or more bounds as percentages."));else{for(var l=0;l<c.length;l++)if(0>=c[l]||100<c[l]){mxUtils.alert(getText("Bounds are percentage values that must be between 0 and 100."));return}l=getSetting();
graph.getModel().beginUpdate();var m=new mxCellAttributeChange(l,"SensitivityPrimitives",b.join(","));graph.getModel().execute(m);m=new mxCellAttributeChange(l,"SensitivityRuns",a);graph.getModel().execute(m);m=new mxCellAttributeChange(l,"SensitivityBounds",c.join(", "));graph.getModel().execute(m);m=new mxCellAttributeChange(l,"SensitivityShowRuns",d);graph.getModel().execute(m);graph.getModel().endUpdate();sensitivityProgress=Ext.MessageBox.show({msg:getText("Running Sensitivity Analysis..."),
icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});sensitivityController={nRuns:a,items:b,bounds:c,showRuns:d,results:[]};setTimeout("runSensitivity()",15);e.close()}}}]});e.show()}
function runSensitivity(){var a=runModel({silent:!0});if("none"!=a.error)mxUtils.alert(a.error),highlight(a.errorPrimitive),sensitivityProgress&&sensitivityProgress.close();else if(sensitivityController.results.push(a),sensitivityProgress.updateProgress(sensitivityController.results.length/sensitivityController.nRuns," "),sensitivityController.results.length<sensitivityController.nRuns)sensitivityController.noYield?runSensitivity():setTimeout("runSensitivity()",15);else{for(var a=sensitivityController.nRuns,
b=sensitivityController.results,c=sensitivityController.bounds,d=sensitivityController.items,e=[],f=0;f<d.length;f++){for(var g=findID(d[f]),h=[],k=0;k<a;k++)h.push(b[k].value(g));for(var l={median:[]},k=0;k<c.length;k++)l[c[k]+"_lower"]=[],l[c[k]+"_upper"]=[];for(var m=0;m<h[0].length;m++){for(var n=[],k=0;k<h.length;k++)n.push(h[k][m]);n=n.sort(function(a,b){return a-b});l.median.push(getQuantile(n,0.5));for(k=0;k<c.length;k++)l[c[k]+"_lower"].push(getQuantile(n,0.5-c[k]/100/2)),l[c[k]+"_upper"].push(getQuantile(n,
0.5+c[k]/100/2))}var n={name:g.getAttribute("name")+" Quantiles Table",type:"table"},o=[],q=[];o.push(getText("Time"));q.push(b[0].Time);o.push(getText("Median"));q.push(l.median);for(var r=[{name:getText("Median"),data:l.median,type:"line",color:"black"}],m="#ECC928,#425FCA,#8E630F,#007012,#CC2C33,#773A86".split(","),u=[],w=[],k=c.length-1;0<=k;k--)o.push(c[k]+"% "+getText("Lower")),q.push(l[c[k]+"_lower"]),o.push(c[k]+"% "+getText("Upper")),q.push(l[c[k]+"_upper"]),0<k&&w.push({name:"Lower "+c[k]+
"%",data:l[c[k-1]+"_lower"],type:"line",color:m[k%m.length],fill:!0,hideMarkers:!0,hideLegend:!0}),u.push({name:c[k]+"% "+getText("Region"),data:l[c[k]+"_upper"],type:"line",color:m[k%m.length],fill:!0,hideMarkers:!0});for(k=0;k<u.length;k++)r.push(u[k]);for(k=w.length-1;0<=k;k--)r.push(w[k]);r.push({name:"White Cover",data:l[c[c.length-1]+"_lower"],type:"line",color:"white",fill:!0,hideMarkers:!0,hideLegend:!0});n.header=o;n.data=q;e.push({legend:"right",data:r,name:g.getAttribute("name")+" "+getText("Quantiles Chart"),
type:"chart",horizontalGrid:!1,verticalGrid:!1,xType:"Numeric",xData:b[0].Time,xLabel:"Time",yLabel:g.getAttribute("name")});e.push(n);if(sensitivityController.showRuns){n={name:g.getAttribute("name")+" "+getText("Runs Table"),type:"table"};o=[];q=[];r=[];for(m=0;m<a;m++)o.push("Run "+(m+1)),q.push(h[m]),r.push({title:"",data:h[m],type:"line",hideMarkers:!0});n.header=o;n.data=q;e.push({legend:"none",data:r,name:g.getAttribute("name")+" "+getText("Runs Chart"),type:"chart",horizontalGrid:!0,verticalGrid:!0,
xType:"Numeric",xData:b[0].Time,xLabel:"Time",yLabel:g.getAttribute("name")});e.push(n)}}sensitivityProgress.close();showData(getText("Sensitivity Analysis Results"),e)}}function getQuantile(a,b){var c=a.length*b;return Math.ceil(c)==a.length?a[a.length-1]:c==Math.ceil(c)?a[c]:(a[Math.floor(c)]+a[Math.ceil(c)])/2};var optimizerProgress,optimizerController={};
function doOptimizer(){for(var a=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),b=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),c=[],d=[],e=primitives(),f=0;f<e.length;f++)if(isValued(e[f])&&!inAgent(e[f])){var g={pid:e[f].id,pname:e[f].getAttribute("name")};c.push(g);("Stock"==e[f].value.nodeName||"Variable"==e[f].value.nodeName)&&d.push(g)}b.loadData(c);a.loadData(d);c=getSetting();d=c.getAttribute("OptimizerGridStore")?
JSON.parse(c.getAttribute("OptimizerGridStore")):[];for(f=d.length-1;0<=f;f--)findID(d[f].id)||d.splice(f,1);var h=Ext.create("Ext.data.Store",{fields:["id","minBound","maxBound","desiredAccuracy"],data:d}),f=Ext.create("Ext.grid.Panel",{store:h,columns:[{header:getText("Primitive Name"),sortable:!1,menuDisabled:!0,dataIndex:"id",flex:1,renderer:function(a){return getName(findID(a))}},{header:getText("Minimum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"minBound",width:90,editor:{xtype:"numberfield",
allowBlank:!1,allowDecimals:!0,decimalPrecision:9}},{header:getText("Maximum Bound"),sortable:!1,menuDisabled:!0,dataIndex:"maxBound",width:90,editor:{xtype:"numberfield",allowBlank:!1,allowDecimals:!0,decimalPrecision:9}},{header:getText("Accuracy"),sortable:!1,menuDisabled:!0,dataIndex:"desiredAccuracy",width:65,editor:{xtype:"numberfield",allowBlank:!1,step:0.1,minValue:0,allowDecimals:!0,decimalPrecision:9}}],selType:"cellmodel",plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})],
flex:1,width:368}),a=new Ext.FormPanel({fieldDefaults:{labelWidth:145,width:355},autoScroll:!0,frame:!0,items:[Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Primitive"),name:"optGoalPrimitive",id:"optGoalPrimitive",displayField:"pname",valueField:"pid",queryMode:"local",store:b,forceSelection:!0,allowBlank:!1,emptyText:getText("Select primitive to target"),value:c.getAttribute("OptimizerGoalPrimitive")?c.getAttribute("OptimizerGoalPrimitive"):void 0}),Ext.create("Ext.form.field.ComboBox",
{fieldLabel:getText("Goal"),name:"optGoal",id:"optGoal",queryMode:"local",store:[["Minimize",getText("Minimize")],["Maximize",getText("Maximize")]],forceSelection:!0,allowBlank:!1,value:c.getAttribute("OptimizerGoal")?c.getAttribute("OptimizerGoal"):"Minimize"}),Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("Goal Type"),name:"optGoalType",id:"optGoalType",queryMode:"local",store:[["Integral of Value",getText("Integral of Value")],["Final Value",getText("Final Value")]],forceSelection:!0,
allowBlank:!1,value:c.getAttribute("OptimizerGoalType")?c.getAttribute("OptimizerGoalType"):"Integral of Value"}),Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Primitives to Change"),name:"optChangePrimitives",id:"optChangePrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:a,emptyText:getText("Select primitives to adjust"),listeners:{change:function(a,b,c){a=b.split?b.split(", "):[];c=c.split?c.split(", "):[];for(b=0;b<a.length;b++)""!=a[b].trim()&&-1==h.find("id",
a[b])&&h.add({id:a[b],minBound:0,maxBound:1,desiredAccuracy:0.1});for(b=0;b<c.length;b++)""!=c[b].trim()&&-1==a.indexOf(c[b])&&h.removeAt(h.find("id",c[b]))}},value:c.getAttribute("OptimizerPrimitives")?c.getAttribute("OptimizerPrimitives").split(","):[]})]}),b=new Ext.FormPanel({fieldDefaults:{labelWidth:195,width:355},autoScroll:!0,frame:!0,items:[new Ext.form.NumberField({fieldLabel:getText("Random Starts"),name:"nRandomStarts",id:"nRandomStarts",allowBlank:!1,minValue:0,allowDecimals:!1,value:c.getAttribute("OptimizerRandomStarts")?
c.getAttribute("OptimizerRandomStarts"):0}),new Ext.form.NumberField({fieldLabel:getText("Maximum Number of Iterations"),name:"nIterations",id:"nIterations",allowBlank:!1,minValue:1,allowDecimals:!1,value:c.getAttribute("OptimizerMaxIterations")?c.getAttribute("OptimizerMaxIterations"):100}),new Ext.form.NumberField({fieldLabel:getText("Step Reduction Factor"),name:"nStepReduction",id:"nStepReduction",allowBlank:!1,minValue:0,maxValue:1,step:0.1,allowDecimals:!0,value:c.getAttribute("OptimizerStepReduction")?
c.getAttribute("OptimizerStepReduction"):0.5})]}),k=new Ext.Window({title:getText("Optimization"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,380),height:Math.min(Ext.getBody().getViewSize().height,425),items:[Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"vbox",activeTab:0,plain:!0,flex:1,items:[{title:getText("General"),items:[a,f]},{title:getText("Advanced"),items:b}]})],
buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){k.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Run Optimization"),handler:function(){var a=Ext.getCmp("nRandomStarts").getValue(),b=Ext.getCmp("nIterations").getValue(),c=Ext.getCmp("nStepReduction").getValue(),d=Ext.getCmp("optGoal").getValue(),e=Ext.getCmp("optGoalType").getValue(),f=Ext.getCmp("optGoalPrimitive").getValue(),g=Ext.getCmp("optChangePrimitives").getValue();if(1>g.length)mxUtils.alert(getText("You must select one or more primitives to change."));
else if(f){var w=getSetting();graph.getModel().beginUpdate();var v=new mxCellAttributeChange(w,"OptimizerPrimitives",g.join(","));graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoalPrimitive",f);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoal",d);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerGoalType",e);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerStepReduction",c);graph.getModel().execute(v);v=new mxCellAttributeChange(w,
"OptimizerMaxIterations",b);graph.getModel().execute(v);v=new mxCellAttributeChange(w,"OptimizerRandomStarts",a);graph.getModel().execute(v);var x=[];h.each(function(a){x.push(a.getData())});v=new mxCellAttributeChange(w,"OptimizerGridStore",JSON.stringify(x));graph.getModel().execute(v);graph.getModel().endUpdate();optimizerProgress=Ext.MessageBox.show({msg:getText("Optimizing Model..."),icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});optimizerController={runs:-1,randomStarts:a,
optIterations:b,stepReduction:c,optGoal:d,goalType:e,goalPrimitive:f,changePrimitives:g,gridData:x};k.close();setTimeout("runOptimizer()",30)}else mxUtils.alert(getText("You must select a goal primitive to optimize."))}}]});k.show()}
function runOptimizer(){-1==optimizerController.runs&&setupOptimizer();if(optimizerController.runs<=optimizerController.randomStarts){optimizerController.midRun||(optMsg("Run: "+optimizerController.runs),optimizerController.iterations=0,optimizerController.stepScale=1,optimizerController.metAccuracyConditions=!1,optimizerController.opts.push(new DataStore),setInitialPosition(0!=optimizerController.runs));var a=Date.now();for(optimizerController.midRun=!0;!metFinishedConditions();){optimizerController.currentPointMarker=
evaluateCurrentPoint();optimizerController.startPoints.length-1<optimizerController.runs&&(optimizerController.startPoints.push(optimizerController.currentPointMarker),optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]));var b=explore();if(b.stationary()){optMsg("Reducing Step Size");reduceStepSizes();for(var c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=optimizerController.coreDimensions[c];
optimizerController.dimensionsDiscarded=0}else if(optMsg("Moving"),isLocal()&&console.log(b),patternMove(b),!dimensionExists(b))if(optMsg("Inserting Dimension: "+b.toString()),optimizerController.optDimensions.splice(optimizerController.optDimensions.length-1),optimizerController.optDimensions=[b].concat(optimizerController.optDimensions),optimizerController.dimensionsDiscarded+=1,optimizerController.dimensionsDiscarded>optimizerController.coreDimensions.length){for(c=0;c<optimizerController.coreDimensions.length;c++)optimizerController.optDimensions[c]=
optimizerController.coreDimensions[c];optimizerController.dimensionsDiscarded=0}else optMsg("Dimension Already Exists:"+b.toString());optimizerController.iterations+=1;optimizerController.opts[optimizerController.opts.length-1].data.push(optimizerController.solutionSpace[0][optimizerController.currentPointMarker]);b=Math.log(optimizerController.stepScale*optimizerController.stepSizes[0]/optimizerController.accuracies[0]);for(c=1;c<optimizerController.stepSizes.length;c++){var d=Math.log(optimizerController.stepScale*
optimizerController.stepSizes[c]/optimizerController.accuracies[c]);d>b&&(b=d)}-1==optimizerController.maxAcc&&(optimizerController.maxAcc=b);c=1/(optimizerController.randomStarts+1);optimizerProgress.updateProgress((optimizerController.runs+1)*c+c*Math.min(0.95,Math.max(optimizerController.iterations/optimizerController.optIterations,(optimizerController.maxAcc-b)/optimizerController.maxAcc))," ");if(2<(Date.now()-a)/1E3){setTimeout("runOptimizer()",30);return}}optimizerController.bestPoints.push(optimizerController.currentPointMarker);
optimizerController.midRun=!1;optimizerController.runs++;setTimeout("runOptimizer()",30)}else finishOptimizer()}
function setupOptimizer(){optimizerController.startTime=Date.now();optimizerController.midRun=!1;optimizerController.goal=findID(optimizerController.goalPrimitive);optimizerController.targets=findID(optimizerController.changePrimitives);optimizerController.maximums=[];optimizerController.minimums=[];optimizerController.accuracies=[];for(var a=0;a<optimizerController.targets.length;a++)for(var b=0;b<optimizerController.gridData.length;b++){var c=optimizerController.gridData[b];if(c.id==optimizerController.targets[a].id){optimizerController.maximums.push(c.maxBound);
optimizerController.minimums.push(c.minBound);optimizerController.accuracies.push(c.desiredAccuracy);break}}optimizerController.reductionRate=optimizerController.stepReduction;optimizerController.minimize="Minimize"==optimizerController.optGoal?1:-1;optimizerController.stepScale=1;optimizerController.stepSizes=[];for(a=0;a<optimizerController.maximums.length;a++)optimizerController.stepSizes.push((optimizerController.maximums[a]-optimizerController.minimums[a])/4);optimizerController.evaluations=
0;optimizerController.currentPointMarker=0;optimizerController.iterations=0;optimizerController.solutionSpace=[];optimizerController.runs=0;optimizerController.bestPoints=[];optimizerController.startPoints=[];optimizerController.terminationReasons=[];optimizerController.opts=[];optimizerController.metAccuracyConditions=!1;optimizerController.maxAcc=-1;optimizerController.coreDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.coreDimensions.push(new OptDimension(a));
optimizerController.optDimensions=[];for(a=0;a<optimizerController.targets.length;a++)optimizerController.optDimensions.push(optimizerController.coreDimensions[a]);optimizerController.dimensionsDiscarded=0}
function finishOptimizer(){for(var a=optimizerController.bestPoints[0],b=1;b<optimizerController.bestPoints.length;b++)optimizerController.solutionSpace[0][optimizerController.bestPoints[b]]*optimizerController.minimize<optimizerController.solutionSpace[0][a]*optimizerController.minimize&&(a=optimizerController.bestPoints[b]);for(b=1;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a]);a="<div style='padding: 1em; text-align: center;'><p>"+
getText("Your model has been set to the optimum solution.")+"</p><br/>"+optString(a);a=a+"<br/><p>"+getText("Please note that the optimization algorithm is unable to fully account for local minimums or maximums. If your solution space contains such features, the algorithm may have returned erroneous results.")+"</p>";if(0<optimizerController.randomStarts){a=a+"<hr><p>"+getText("You specified a total of %s random iterations. The optimums of the initial iteration and each random one are as follows",
optimizerController.randomStarts)+":<br/>";for(b=0;b<optimizerController.bestPoints.length;b++)a=a+"\n\n"+optString(optimizerController.bestPoints[b])}a=a+"<hr/><p>"+getText("Optimization Duration: %s seconds",(Date.now()-optimizerController.startTime)/1E3)+"</p></div>";a=[{name:"Summary",type:"html",data:a}];if(1==optimizerController.targets.length){for(var c=[],d=[],e=[],b=0;b<optimizerController.evaluations;b++)e.push({x:optimizerController.solutionSpace[1][b],y:optimizerController.solutionSpace[0][b]});
e.sort(function(a,b){return a.x-b.x});for(b=0;b<e.length;b++)c.push(e[b].x),d.push(e[b].y);a.push({name:getText("Explored Solution Space"),type:"chart",xLabel:getName(optimizerController.targets[0]),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType,legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:[{data:d,type:"line",name:"Results"}]})}c=[];d=[];for(b=0;b<optimizerController.opts.length;b++)c=c.concat(optimizerController.opts[b].iterations()),d.push({data:optimizerController.opts[b].data,
type:"line",name:"Run "+(b+1)});c=Ext.Array.unique(c);a.push({name:getText("Iterations"),type:"chart",xLabel:getText("Iteration"),yLabel:getName(optimizerController.goal)+" "+optimizerController.goalType+" Optimum",legend:"none",horizontalGrid:!0,verticalGrid:!0,xType:"Numeric",xData:c,data:d});c=[[],[]];d=[getName(optimizerController.goal)+" "+optimizerController.goalType];for(e=0;e<optimizerController.targets.length;e++)d.push(getName(optimizerController.targets[e])),c.push([]);d.push("Note");for(b=
0;b<optimizerController.evaluations;b++){for(e=0;e<=optimizerController.targets.length;e++)c[e].push(optimizerController.solutionSpace[e][b]);-1!=optimizerController.startPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Start")):-1!=optimizerController.bestPoints.indexOf(b)?c[c.length-1].push(getText("Iteration Optimum")):c[c.length-1].push("")}a.push({name:getText("Results Table"),type:"table",data:c,header:d});showData(getText("Optimization Results"),a);optimizerProgress.close()}
var OptDimension=function(a){this.coords=[];if(null!=a)for(var b=0;b<optimizerController.targets.length;b++)b==a?this.coords.push(1):this.coords.push(0);else for(b=0;b<optimizerController.targets.length;b++)this.coords.push(0)};OptDimension.prototype.toString=function(){for(var a=[],b=0;b<this.coords.length;b++)a.push(this.coords[b]);return"<<"+a.join(", ")+">>"};OptDimension.prototype.append=function(a,b){for(var b=b?b:1,c=0;c<a.coords.length;c++)this.coords[c]+=a.coords[c]*b};
OptDimension.prototype.apply=function(a){for(var b=0;b<optimizerController.targets.length;b++){var c=parseFloat(getValue(optimizerController.targets[b]))+this.coords[b]*a*optimizerController.stepSizes[b]*optimizerController.stepScale;optMsg("Value "+b+": "+c);setValue(optimizerController.targets[b],c)}};OptDimension.prototype.stationary=function(){for(var a=0;a<this.coords.length;a++)if(0!=this.coords[a])return!1;return!0};
OptDimension.prototype.makeUnit=function(){for(var a=this.length(),b=0;b<this.coords.length;b++)this.coords[b]/=a};OptDimension.prototype.length=function(){for(var a=0,b=0;b<this.coords.length;b++)a+=Math.pow(this.coords[b],2);return Math.sqrt(a)};OptDimension.prototype.equalTo=function(a){for(var b=0,c=0;c<this.coords.length;c++)b+=Math.abs(a.coords[c]*this.coords[c]);b/=this.length()*a.length();return 0.99<b};
function dimensionExists(a){for(var b=0;b<optimizerController.optDimensions.length;b++)if(optimizerController.optDimensions[b].equalTo(a))return!0;return!1}function metFinishedConditions(){if(optimizerController.iterations>optimizerController.optIterations)return optimizerController.terminationReasons.push("Iterations"),!0;optimizerController.metAccuracyConditions&&optimizerController.terminationReasons.push("StepSize");return optimizerController.metAccuracyConditions}
function reduceStepSizes(){optimizerController.metAccuracyConditions=!0;for(var a=0;a<optimizerController.stepSizes.length;a++)if(optimizerController.stepSizes[a]*optimizerController.stepScale>=optimizerController.accuracies[a]){optimizerController.metAccuracyConditions=!1;break}optimizerController.stepScale*=optimizerController.reductionRate;optMsg("Step scale: "+optimizerController.stepScale)}function restoreCurrentPoint(){restorePoint(optimizerController.currentPointMarker)}
function restorePoint(a){for(var b=0;b<optimizerController.targets.length;b++)setValue(optimizerController.targets[b],optimizerController.solutionSpace[b+1][a])}
function evaluateCurrentPoint(){testPointBounds();for(var a=[],b=0;b<optimizerController.targets.length;b++)a.push(parseFloat(getValue(optimizerController.targets[b])));for(var c=0;c<optimizerController.evaluations;c++){for(var d=!0,b=0;b<optimizerController.targets.length;b++)if(optimizerController.solutionSpace[b+1][c]!=a[b]){d=!1;break}if(d)return c}a=runModel({silent:!0});if("none"!=a.error)throw mxUtils.alert(a.error),highlight(a.errorPrimitive),optimizerProgress&&optimizerProgress.close(),"Opt Error";
optimizerController.evaluations+=1;optimizerController.solutionSpace.length=optimizerController.targets.length+1;for(b=0;b<optimizerController.solutionSpace.length;b++)optimizerController.solutionSpace[b]||(optimizerController.solutionSpace[b]=[]),optimizerController.solutionSpace[b].length=optimizerController.evaluations;if("Final Value"==optimizerController.goalType)optimizerController.solutionSpace[0][optimizerController.evaluations-1]=a.lastValue(optimizerController.goal);else if("Integral of Value"==
optimizerController.goalType){a=a.value(optimizerController.goal);for(b=c=0;b<a.length;b++)c+=a[b];optimizerController.solutionSpace[0][optimizerController.evaluations-1]=c}else alert("Unknonw optimizer goal type: "+optimizerController.goalType);for(b=0;b<optimizerController.targets.length;b++)optimizerController.solutionSpace[b+1][optimizerController.evaluations-1]=parseFloat(getValue(optimizerController.targets[b]));return optimizerController.evaluations-1}
function explore(){var a=new OptDimension,b=optimizerController.currentPointMarker,c;optMsg("Exploring");for(var d=0;d<optimizerController.optDimensions.length;d++)optMsg("Dimensions "+optimizerController.optDimensions[d].toString()),optimizerController.optDimensions[d].apply(1),c=evaluateCurrentPoint(),firstBetter(c,b)?(optMsg("Plus 1 Success"),a.append(optimizerController.optDimensions[d],1),b=c):(restorePoint(b),optimizerController.optDimensions[d].apply(-1),c=evaluateCurrentPoint(),firstBetter(c,
b)?(optMsg("Minus 1 Success"),a.append(optimizerController.optDimensions[d],-1),b=c):(optMsg("Static"),restorePoint(b)));return a}
function patternMove(a){optMsg("Pattern Move: "+a.toString());var b=evaluateCurrentPoint();a.apply(1);a=evaluateCurrentPoint();optMsg("Step One: "+optimizerController.solutionSpace[0][b]);optMsg("Step Two: "+optimizerController.solutionSpace[0][a]);firstBetter(b,a)?(optMsg("Chose 1"),optimizerController.currentPointMarker=b):(optMsg("Chose 2"),optimizerController.currentPointMarker=a);restoreCurrentPoint()}
function firstBetter(a,b){return optimizerController.solutionSpace[0][a]*optimizerController.minimize<optimizerController.solutionSpace[0][b]*optimizerController.minimize}
function testPointBounds(){for(var a=0;a<optimizerController.targets.length;a++)parseFloat(getValue(optimizerController.targets[a]))>optimizerController.maximums[a]&&setValue(optimizerController.targets[a],optimizerController.maximums[a]),parseFloat(getValue(optimizerController.targets[a]))<optimizerController.minimums[a]&&setValue(optimizerController.targets[a],optimizerController.minimums[a])}
function setInitialPosition(a){for(var b=0;b<optimizerController.targets.length;b++){var c;c=a?Math.random():0.5;setValue(optimizerController.targets[b],(optimizerController.maximums[b]-optimizerController.minimums[b])*c+optimizerController.minimums[b])}}
function optString(a){var b=optimizerController.terminationReasons[optimizerController.bestPoints.indexOf(a)],c;c="<br/><center><table border='1' cellpadding='4' align = 'center' style='text-align:center;background-color: #f8ffcf; border: solid 1px black;'><tr><td style='padding:.5em'><b>Primitive</b></td><td style='padding:.5em'><b>Optimum</b></td><td style='padding:.5em'><b>Range</b></td></tr><tr><td colspan=3 style='padding:.5em'><b>Goal Primitive</b></td></tr><tr><td style='padding:.5em'><b>["+getName(optimizerController.goal)+
"]</b></td><td style='padding:.5em'>"+optimizerController.solutionSpace[0][a]+"</td><td style='padding:.5em'>";c=("Iterations"==b?c+" optimization terminated due to exceeding maximum number of allowed iterations":c+"--")+"</td></tr><tr><td colspan=3 style='padding:.5em'><b>Changed Primitives</b></td></tr>";for(var d=0;d<optimizerController.targets.length;d++){var e=optimizerController.solutionSpace[d+1][a];c=c+"<tr><td style='padding:.5em'><b>["+getName(optimizerController.targets[d])+"]</></td><td style='padding:.5em'>"+
e+"</td><td style='padding:.5em'>";"StepSize"==b?(c=e==optimizerController.minimums[d]?c+"-Infinity":c+(e-optimizerController.accuracies[d]),c+=" - ",c=e==optimizerController.maximums[d]?c+"Infinity":c+(e+optimizerController.accuracies[d])):c+="--";c+="</td></tr>"}return c+"</table></center>"}var DataStore=function(){this.data=[]};DataStore.prototype.iterations=function(){for(var a=[],b=0;b<this.data.length;b++)a.push(b);return a};function optMsg(a){isLocal()&&console.log(a)};function dataRenderer(a){return a instanceof Vector?a.toString():a instanceof Agent?"Agent":commaStr(a)}function commaStr(a){if(isUndefined(a)||null===a)return"";if(1E9<=a||1.0E-9>=a&&0!=a)return a.toPrecision(3);for(var a=round(a,9)+"",b=a.split("."),a=b[0],b=1<b.length?"."+b[1]:"",c=/(\d+)(\d{3})/;c.test(a);)a=a.replace(c,"$1,$2");return a+b}
function round(a,b,c){var d,e,f,b=Math.pow(10,b|0),a=a*b;f=0<a|-(0>a);e=a%1===0.5*f;d=Math.floor(a);if(e)switch(c){case "PHP_ROUND_HALF_DOWN":a=d+(0>f);break;case "PHP_ROUND_HALF_EVEN":a=d+d%2*f;break;case "PHP_ROUND_HALF_ODD":a=d+!(d%2);break;default:a=d+(0<f)}return(e?a:Math.round(a))/b}var displayConfigWin,displayConfigStore,displayConfigStore2;
function openDisplayConfigure(a){displayConfigWin||(displayConfigStore=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),displayConfigStore2=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:[]}),displayConfigWin=new Ext.Window({layout:"fit",modal:!0,autoScroll:!0,title:getText("Chart/Table Configuration"),width:Math.min(Ext.getBody().getViewSize().width,410),height:Math.min(Ext.getBody().getViewSize().height,
580),resizable:!1,closeAction:"hide",plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:80},frame:!0,autoScroll:!0,id:"displayConfigure",bodyStyle:"padding:5px 5px 0",defaults:{width:365},items:[{xtype:"fieldset",title:getText("General Settings"),defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[{fieldLabel:getText("Title"),id:"chartTitle",name:"chartTitle",allowBlank:!1},Ext.create("Ext.form.ComboBox",{fieldLabel:getText("Type"),name:"chartType",id:"chartType",allowBlank:!1,
store:[["Time Series",getText("Time Series")],["Scatterplot",getText("Scatterplot")],["Tabular",getText("Tabular")],["Map",getText("Map")]],queryMode:"local",forceSelection:!0,listeners:{change:function(a,b){a.validate()&&("Scatterplot"==b?(Ext.getCmp("xAxisLabel").setValue("%o"),Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),Ext.getCmp("showLines").setValue(!1)):"Time Series"==b?(Ext.getCmp("xAxisLabel").setValue("Time (%u)"),Ext.getCmp("yAxisLabel").setValue(""),
Ext.getCmp("showMarkers").setValue(!1),Ext.getCmp("showLines").setValue(!0)):"Map"==b&&(Ext.getCmp("xAxisLabel").setValue("%o"),Ext.getCmp("yAxisLabel").setValue("%o"),Ext.getCmp("showMarkers").setValue(!0),Ext.getCmp("showLines").setValue(!1)),Ext.getCmp("chartSettings").setDisabled("Tabular"==b),Ext.getCmp("chartSettings2").setDisabled("Time Series"!=b))}}}),Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Data"),name:"chartPrimitives",id:"chartPrimitives",displayField:"pname",valueField:"pid",
queryMode:"local",store:displayConfigStore,emptyText:getText("Select which data to display")}),{xtype:"checkboxfield",fieldLabel:getText("Add New"),name:"autoAdd",id:"autoAdd",boxLabel:getText("Add newly created primitives to the data")}]},{xtype:"fieldset",title:getText("Chart Settings"),defaultType:"textfield",id:"chartSettings",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:getText("X-Axis"),layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},
items:[{flex:1,fieldLabel:getText("Label"),id:"xAxisLabel",name:"xAxisLabel"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),width:50,id:"xAxisMin",name:"xAxisMin",margins:"0 0 0 5"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"xAxisMax",name:"xAxisMax",margins:"0 0 0 5"}]},{xtype:"fieldcontainer",fieldLabel:getText("Y-Axis"),layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"yAxisLabel",name:"yAxisLabel"},
{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),width:50,id:"yAxisMin",name:"yAxisMin",margins:"0 0 0 5"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"yAxisMax",name:"yAxisMax",margins:"0 0 0 5"}]},{xtype:"combo",id:"legendPosition",fieldLabel:getText("Legend Position"),allowBlank:!1,store:[["Automatic",getText("Automatic")],["Top",getText("Top")],["Right",getText("Right")],["Bottom",getText("Bottom")],["Left",getText("Left")],["None",getText("None")]],queryMode:"local",
forceSelection:!0},{xtype:"container",layout:"column",anchor:"100%",margin:7,items:[{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Show Markers"),name:"showMarkers",inputValue:"1",id:"showMarkers"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Show Lines"),name:"showLines",inputValue:"1",id:"showLines"},{columnWidth:0.33,xtype:"checkboxfield",boxLabel:getText("Use Areas"),name:"showArea",inputValue:"1",id:"showArea"}]},{xtype:"fieldset",title:getText("Secondary Y-Axis"),defaultType:"textfield",
id:"chartSettings2",defaults:{anchor:"100%"},layout:"anchor",items:[{xtype:"fieldcontainer",fieldLabel:getText("Axis"),layout:"hbox",defaultType:"textfield",fieldDefaults:{labelAlign:"top"},items:[{flex:1,fieldLabel:getText("Label"),id:"yAxisLabel2",name:"yAxisLabel2"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Min"),width:50,id:"yAxisMin2",name:"yAxisMin2",margins:"0 0 0 5"},{hidden:!0,xtype:"numberfield",fieldLabel:getText("Max"),width:50,id:"yAxisMax2",name:"yAxisMax2",margins:"0 0 0 5"}]},
Ext.create("Ext.ux.form.field.BoxSelect",{fieldLabel:getText("Data"),name:"chartPrimitives2",id:"chartPrimitives2",displayField:"pname",valueField:"pid",queryMode:"local",store:displayConfigStore2,emptyText:getText("Select which data to display")})]}]}]})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){displayConfigWin.hide()}},{iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){var a=displayConfigWin.myDisplay,b=displayConfigWin.myWin;
if(Ext.getCmp("chartTitle").validate()&&Ext.getCmp("chartType").validate()&&Ext.getCmp("chartPrimitives").validate()){graph.getModel().beginUpdate();graph.getModel().execute(new mxCellAttributeChange(a,"name",Ext.getCmp("chartTitle").getValue()));b.tabs.getActiveTab().setTitle(Ext.getCmp("chartTitle").getValue());var c=Ext.getCmp("chartType").getValue();graph.getModel().execute(new mxCellAttributeChange(a,"Type",c));graph.getModel().execute(new mxCellAttributeChange(a,"AutoAddPrimitives",Ext.getCmp("autoAdd").getValue().toString()));
graph.getModel().execute(new mxCellAttributeChange(a,"legendPosition",Ext.getCmp("legendPosition").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"xAxis",Ext.getCmp("xAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxis",Ext.getCmp("yAxisLabel").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxis2",Ext.getCmp("yAxisLabel2").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"xAxisMin",Ext.getCmp("xAxisMin").getValue()));
graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMin",Ext.getCmp("yAxisMin").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMin2",Ext.getCmp("yAxisMin2").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"xAxisMax",Ext.getCmp("xAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMax",Ext.getCmp("yAxisMax").getValue()));graph.getModel().execute(new mxCellAttributeChange(a,"yAxisMax2",Ext.getCmp("yAxisMax2").getValue()));
var g=Ext.getCmp("chartPrimitives").getValue();if("Scatterplot"==c)2<g.length?(g.length=2,mxUtils.alert(getText("The primitive list for the scatterplot has been truncated to two items. One for the x-Axis and one for the y-Axis."))):1==g.length&&mxUtils.alert(getText("You need two primitives to create a scatterplot. One for the x-Axis and one for the y-Axis."));else if("Map"==c){for(var c=!1,h=g.length-1;0<=h;h--)g[h]&&"Agents"!=findID(g[h]).value.nodeName?(g.splice(h,1),c=!0):g[h]||g.splice(h,1);
c&&mxUtils.alert(getText("Map charts can only show agent population primitives."))}graph.getModel().execute(new mxCellAttributeChange(a,"Primitives",g.join(",")));graph.getModel().execute(new mxCellAttributeChange(a,"Primitives2",Ext.getCmp("chartPrimitives2").getValue().join(",")));graph.getModel().execute(new mxCellAttributeChange(a,"showMarkers",Ext.getCmp("showMarkers").getValue().toString()));graph.getModel().execute(new mxCellAttributeChange(a,"showLines",Ext.getCmp("showLines").getValue().toString()));
graph.getModel().execute(new mxCellAttributeChange(a,"showArea",Ext.getCmp("showArea").getValue().toString()));b.tabs.getActiveTab().removeAll();for(h=b.displayInformation.maps.length-1;0<=h;h--)b.displayInformation.maps[h].id==a.id&&b.displayInformation.maps.splice(h,1);for(h=b.displayInformation.histograms.length-1;0<=h;h--)b.displayInformation.histograms[h].id==a.id&&b.displayInformation.histograms.splice(h,1);b.tabs.getActiveTab().add(renderDisplay(a,b.displayInformation));displayConfigWin.hide();
graph.getModel().endUpdate()}else mxUtils.alert(getText("Correct the display configuration before applying."))}}]}));for(var b=[],c=0;c<a.displayInformation.displayedIds.length;c++)b.push({pid:a.displayInformation.displayedIds[c],pname:a.displayInformation.displayedHeaders[c]});b.sort(function(a,b){return a.pname.localeCompare(b.pname)});displayConfigStore.loadData(b);displayConfigStore2.loadData(b);b=a.tabs.getActiveTab().display;Ext.getCmp("chartTitle").setValue(b.getAttribute("name"));Ext.getCmp("chartType").setValue(b.getAttribute("Type"));
Ext.getCmp("xAxisLabel").setValue(b.getAttribute("xAxis"));Ext.getCmp("yAxisLabel").setValue(b.getAttribute("yAxis"));Ext.getCmp("yAxisLabel2").setValue(b.getAttribute("yAxis2"));Ext.getCmp("xAxisMin").setValue(b.getAttribute("xAxisMin"));Ext.getCmp("yAxisMin").setValue(b.getAttribute("yAxisMin"));Ext.getCmp("yAxisMin2").setValue(b.getAttribute("yAxisMin2"));Ext.getCmp("xAxisMax").setValue(b.getAttribute("xAxisMax"));Ext.getCmp("yAxisMax").setValue(b.getAttribute("yAxisMax"));Ext.getCmp("yAxisMax2").setValue(b.getAttribute("yAxisMax2"));
Ext.getCmp("legendPosition").setValue(b.getAttribute("legendPosition"));Ext.getCmp("showMarkers").setValue(b.getAttribute("showMarkers"));Ext.getCmp("showLines").setValue(b.getAttribute("showLines"));Ext.getCmp("showArea").setValue(b.getAttribute("showArea"));Ext.getCmp("autoAdd").setValue(b.getAttribute("AutoAddPrimitives"));Ext.getCmp("chartPrimitives").setValue([]);isUndefined(b.getAttribute("Primitives"))||Ext.getCmp("chartPrimitives").setValue(b.getAttribute("Primitives").split(","));Ext.getCmp("chartPrimitives2").setValue([]);
isUndefined(b.getAttribute("Primitives2"))||Ext.getCmp("chartPrimitives2").setValue(b.getAttribute("Primitives2").split(","));displayConfigWin.myDisplay=b;displayConfigWin.myWin=a;displayConfigWin.show()}
function renderDisplay(a,b){function c(a,c){C.push(a);A.push(a+"x");y.push(a+"y");H.push({type:"float",name:a+"x"});H.push({type:"float",name:a+"y"});for(var d=0,d=0;d<b.colors.length&&!(b.ids[d]==B&&b.headers[d]==c);d++);var e=null;isGray(b.colors[d])?(e=r[u],u++,u%=r.length):e=b.colors[d];q.push({title:c,animate:!1,type:"line",axis:"left",xField:a+"x",yField:a+"y",showMarkers:!0,style:{"stroke-width":0,opacity:0,stroke:"none"},markerConfig:{type:["circle","triangle","diamond","cross","plus"][l%
6],fill:e,radius:5},smooth:!1,tips:{trackMouse:!0,width:160,renderer:F(E)}})}for(var d=a.getAttribute("Type"),e=isDefined(a.getAttribute("Primitives"))?a.getAttribute("Primitives").split(","):[],f=e.length-1;0<=f;f--)inAgent(findID(e[f]))&&e.splice(f,1);for(var g=isDefined(a.getAttribute("Primitives2"))?a.getAttribute("Primitives2").split(","):[],f=g.length-1;0<=f;f--)inAgent(findID(g[f]))&&g.splice(f,1);if(0==e.length||"Scatterplot"==d&&2>e.length)return{xtype:"box",html:"<br/><br/><br/><b><big><center><span style='color:darkgray'>"+
getText("No data to display")+"<br/><br/>"+getText("Press 'Configure' to select data")+"</span></center></big></b>"};var h,k=[];if("Tabular"==d){for(var k=[{header:getText("Time"),sortable:!0,flex:1,dataIndex:"Time",renderer:function(a){return round(a,9)}}],l=0;l<e.length;l++)for(f=0;f<b.ids.length;f++)e[l]==b.ids[f]&&k.push({header:b.headers[f],sortable:!0,flex:1,dataIndex:b.elementIds[f],renderer:dataRenderer});return new Ext.grid.GridPanel({store:b.store,columns:k,stripeRows:!0,border:!1,frame:!1,
header:!1,dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"exporterbutton",downloadName:a.getAttribute("name")}]}]})}if("Time Series"==d){e=e.concat(g);h=[];var m=[],n=[],o=[],q=[],r="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(","),u=0,w=[];if(isTrue(a.getAttribute("showArea"))){for(var v=[],x=[],l=0;l<e.length;l++)for(f=0;f<b.ids.length;f++)if(e[l]==b.ids[f])if(b.renderers[f]){var z=-1==g.indexOf(e[l]);z&&(isGray(b.colors[f])?(w.push(r[u]),u++,u%=
r.length):w.push(b.colors[f]),v.push(b.elementIds[f]),x.push(b.headers[f]))}else k.push(createHistogramChart(b,f));q.push({highlight:!1,type:"area",axis:"left",xField:"Time",yField:v,title:x,smooth:!1});v="theme"+Math.random();Ext.chart.theme[v]=Ext.extend(Ext.chart.theme.Base,{constructor:function(a){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({colors:w},a))}})}else for(l=0;l<e.length;l++)for(f=0;f<b.ids.length;f++)if(e[l]==b.ids[f])if(b.renderers[f]){var z=-1==g.indexOf(e[l]),
D=b.elementIds[f],x=null;isGray(b.colors[f])?(x=r[u],u++,u%=r.length):x=b.colors[f];x={stoke:x,fill:x,"stroke-width":3};isTrue(a.getAttribute("showLines"))||(x.opacity=0,x.stroke="none");z?(n.push(b.headers[f]),h.push(D)):(o.push(b.headers[f]),m.push(D));q.push({type:"line",axis:z?"left":"right",xField:"Time",yField:z?h[h.length-1]:m[m.length-1],title:z?n[n.length-1]:o[o.length-1],showMarkers:isTrue(a.getAttribute("showMarkers")),smooth:!1,style:x,tips:{trackMouse:!0,width:160,renderer:function(a,
b){this.setTitle(clean(b.series.title)+":<br/>"+a.get("Time")+", "+commaStr(b.value[1]))}}})}else k.push(createHistogramChart(b,f));f=[{type:"Numeric",position:"bottom",fields:"Time",minimum:isUndefined(a.getAttribute("xAxisMin"))?b.store.min("Time"):a.getAttribute("xAxisMin")/(b.times[1]-b.times[0])-b.times[0],maximum:isUndefined(a.getAttribute("xAxisMax"))?void 0:a.getAttribute("xAxisMax")/(b.times[1]-b.times[0])-b.times[0],title:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),n.join(", ")),
grid:!0,labelTitle:{font:"12px Verdana"},label:{renderer:function(a){return round(a,9)}},getRange:function(){return{min:b.store.min("Time"),max:b.times[b.times.length-1]}}}];e.length>g.length&&f.push({type:"Numeric",position:"left",minimum:a.getAttribute("yAxisMin"),maximum:a.getAttribute("yAxisMax"),fields:h,grid:!0,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),n.join(", ")),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange});0<g.length&&f.push({minimum:a.getAttribute("yAxis2Min"),
maximum:a.getAttribute("yAxis2Max"),type:"Numeric",position:"right",fields:m,grid:e.length==g.length,title:quickLabel(a.getAttribute("yAxis2"),a.getAttribute("name"),o.join(", ")),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange});h=Ext.create("Ext.chart.Chart",{flex:1,theme:isTrue(a.getAttribute("showArea"))?v:void 0,background:{fill:"#fff"},html:"<div id='scratchpad"+analysisCount+"_"+a.id+"' style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",
xtype:"chart",animate:!1,shadow:!1,store:b.store,axes:f,series:q});"None"!=a.getAttribute("legendPosition")&&(h.legend=Ext.create("Ext.chart.Legend",{position:"Automatic"==a.getAttribute("legendPosition")?4<e.length?"right":"top":a.getAttribute("legendPosition").toLowerCase(),chart:h,boxStrokeWidth:0,boxStroke:"#fff",itemSpacing:4,padding:0,isVertical:!1}))}else if("Scatterplot"==d){g=[];h=[];for(l=0;l<e.length;l++)for(f=0;f<b.ids.length;f++)e[l]==b.ids[f]&&(b.renderers[f]?(g.push(b.elementIds[f]),
h.push(b.headers[f])):k.push(createHistogramChart(b,f)));x={"stroke-width":3};isTrue(a.getAttribute("showLines"))||(x.opacity=0,x.stroke="none");h=Ext.create("Ext.chart.Chart",{flex:1,background:{fill:"#fff"},xtype:"chart",animate:!1,html:"<div id='scratchpad"+analysisCount+"_"+a.id+"'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",shadow:!1,store:b.store,axes:[{minimum:a.getAttribute("xAxisMin"),maximum:a.getAttribute("xAxisMax"),type:"Numeric",position:"bottom",
fields:g[0],grid:!0,title:quickLabel(a.getAttribute("xAxis"),a.getAttribute("name"),h[0]),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange},{minimum:a.getAttribute("yAxisMin"),maximum:a.getAttribute("yAxisMax"),type:"Numeric",position:"left",fields:g[1],grid:!0,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),h[1]),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:unfilteredRange}],series:[{type:"line",axis:"left",xField:g[0],yField:g[1],
showMarkers:isTrue(a.getAttribute("showMarkers")),style:x,smooth:!1,tips:{trackMouse:!0,width:160,renderer:function(a,b){this.setTitle(commaStr(b.value[0])+", "+commaStr(b.value[1]))}}}]})}else if("Map"==d){for(var r="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(","),u=0,w=[],H=[{type:"float",name:"agentIndex"},{type:"string",name:"states"}],q=[],C=[],A=[],y=[],f=[],F=function(a){return function(b,c){this.setTitle("<p><center>"+a+" "+b.get("agentIndex")+"</center></p></p>"+
b.get("states")+"</p><p>"+commaStr(c.value[0])+", "+commaStr(c.value[1])+"</p>")}},l=0;l<e.length;l++){var B=e[l],I=b.agents[B];if(isUndefined(I)){alert("Primitive is not an agent population!");return}f.push(I);var E=getName(findID(I.item.getAttribute("Agent")));c("series_"+B+"__",E);for(g=0;g<I.data.states.length;g++)h="series_"+B+"_"+I.data.states[g]+"_",m=getName(findID(I.data.states[g])),c(h,m)}e=new Ext.data.Store({fields:H});h=Ext.create("Ext.chart.Chart",{background:{fill:"#fff"},flex:1,legend:"None"==
a.getAttribute("legendPosition")?!1:{position:"Automatic"==a.getAttribute("legendPosition")?4<C.length?"right":"top":a.getAttribute("legendPosition").toLowerCase()},xtype:"chart",animate:!1,html:"<div id='scratchpad"+analysisCount+"_"+a.id+"'  style='z-index:1000;position:absolute; width:100%;height:100%;display:none;'></div>",shadow:!1,store:e,axes:[{type:"Numeric",position:"bottom",fields:A,grid:!1,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),"Position ("+I.item.getAttribute("GeoDimUnits")+
")"),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:function(){return{min:0,max:parseFloat(simpleNum(I.data.width,I.data.units))}}},{type:"Numeric",position:"left",fields:y,grid:!1,title:quickLabel(a.getAttribute("yAxis"),a.getAttribute("name"),"Position ("+I.item.getAttribute("GeoDimUnits")+")"),labelTitle:{font:"12px Verdana"},label:{renderer:commaStr},getRange:function(){return{min:0,max:parseFloat(simpleNum(I.data.height,I.data.units))}}}],series:q});b.maps.push({id:a.id,
store:e,agents:f,bases:C,chart:h});buildMapStore(b.maps[b.maps.length-1],b.scripter.time)}if("Tabular"!=d)return d=[],0<h.series.length&&d.push(h),d=d.concat(k),{xtype:"panel",items:d,layout:1==d.length?"fit":{type:"vbox",align:"stretch"},dockedItems:[{xtype:"toolbar",dock:"bottom",items:["->",{xtype:"button",text:"Download",handler:function(){surpressCloseWarning=!0;this.up("panel").down("chart").save({type:"image/png"})}}]}]}}
function createResultsWindow(a){a.maps=[];a.histograms=[];analysisCount++;var b=primitives("Display"),c=[],d={time:0};a.scripter=d;for(var e=0;e<b.length;e++)c.push({xtype:"panel",title:b[e].getAttribute("name"),items:[renderDisplay(b[e],a)],layout:"fit",display:b[e]});c=new Ext.TabPanel({activeTab:0,flex:1,deferredRender:!1,frame:!1,border:!1,enableTabScroll:!0,defaults:{autoScroll:!0},items:c});d.updatingSlider=!1;d.timeIndex=0;d.maxTime=function(){return this.simulator.displayInformation.store.maxLoaded};
d.minTime=0;d.timeStep=2;d.times=a.times;d.simulator=simulate;d.showSliders=function(){d.slidersShown||(0<sliderPrimitives(["Variable"]).length&&(d.dockedPanel=Ext.create("Ext.Panel",{xtype:"panel",layout:"fit",items:[createSliders("Variable",function(a,b){if(d.isFinished)mxUtils.alert("The simulation has finished and slider values cannot be changed.");else{for(var c=new Material(b),e=0;e<simulate.sliders[a.id].length;e++)simulate.sliders[a.id][e].equation=c;simulate.sliders[a.id][0].dna.equation=
c;simulate.valueChange=!0}},function(a,b,c,d){b(a.sliderCell,d)})],dock:"right",width:200,autoScroll:!0,title:"Sliders",collapsible:!0,split:!0,border:!0,bodyStyle:"background: none",collapseDirection:"right",animCollapse:!1}),f.addDocked(d.dockedPanel)),d.slidersShown=!0)};d.slider=Ext.create("Ext.form.SliderField",{minValue:0,animate:!1,hideLabel:!0,disabled:!0,maxValue:a.times.length-1,flex:1,step:d.timeStep,margins:"0 10 0 10",useTips:!0,tipText:function(a){return""+a.slider.s.times[a.slider.getValue()]}});
d.combo=Ext.create("Ext.form.field.ComboBox",{fieldLabel:"",labelWidth:0,allowBlank:!1,store:[[0.2,getText("%s x Normal","0.2")],[0.5,getText("%s x Normal","0.5")],[1,getText("Normal Speed")],[1.5,getText("%s x Normal","1.5")],[2,getText("%s x Normal","2")],[5,getText("%s x Normal","5")],[10,getText("%s x Normal","10")],[-1,getText("Full Speed")]],queryMode:"local",value:parseFloat(getSetting().getAttribute("Throttle")),width:102,forceSelection:!0,listeners:{select:function(a){graph.getModel().beginUpdate();
a=new mxCellAttributeChange(getSetting(),"Throttle",a.getValue());graph.getModel().execute(a);graph.getModel().endUpdate()}}});d.slider.s=d;d.slider.on("change",function(a,b){this.s.updatingSlider||(b>this.s.maxTime()?this.setValue(this.s.maxTime()):this.s.loadTime(b))});d.playBut=Ext.create("Ext.button.Button",{scale:"medium",allowDepress:!0,enableToggle:!0,pressed:!0,icon:builder_path+"/images/pause.png"});d.stopBut=Ext.create("Ext.button.Button",{scale:"medium",margins:"0 10 0 10",icon:builder_path+
"/images/stopper.png",handler:function(){endRunningSimulation()}});d.finished=function(){this.isFinished=!0;this.stopBut.hide();this.slider.setDisabled(!1);this.dockedPanel&&this.dockedPanel.collapse()};d.playBut.s=d;d.animInter=-1;d.playBut.on("toggle",function(b,c){c?(d.endMode="wait",d.slider.getValue()==a.times.length-1&&d.slider.setValue(d.minTime),d.playBut.setIcon(builder_path+"/images/pause.png"),d.advanceTimer(),d.animInter=setInterval(function(){d.advanceTimer()},100/Math.min(0.5,d.combo.getValue())),
d.simulator&&!d.simulator.completed()&&d.simulator.resume()):d.pause(!0)});d.pause=function(a){this.slider.isDisabled()&&this.showSliders();a&&!this.isFinished&&this.slider.setValue(this.maxTime());this.playBut.pressed&&this.playBut.toggle(!1,!0);this.playBut.setIcon(builder_path+"/images/play.png");clearInterval(this.animInter);a&&!this.simulator.completed()&&this.simulator.sleep()};d.endMode="wait";d.advanceTimer=function(){this.slider.getValue()<this.maxTime()||this.maxTime()==a.times.length-1?
this.slider.getValue()<a.times.length-1?-1==this.combo.getValue()?this.loadTime(this.maxTime()):this.loadTime(Math.min(this.maxTime(),this.slider.getValue()+this.timeStep*Math.max(0.5,this.combo.getValue()))):this.playBut.toggle():("pause"==this.endMode||d.isFinished)&&this.pause()};d.loadTime=function(b){a.store.clearFilter(!0);this.time=b;a.store.filter([{filterFn:function(a){return a.get("id")<=b}}]);a.maps.forEach(function(a){buildMapStore(a,b)});a.histograms.forEach(function(a){buildHistogramStore(a,
b)});this.updatingSlider=!0;this.slider.setValue(b);this.updatingSlider=!1};b={title:getText("Simulation Results %s",analysisCount),analysisCount:analysisCount,scratchPadStatus:{},closable:!0,displays:b,tabs:c,renderTo:"ribbonPanel",constrain:!0,maximized:viewConfig.fullScreenResults,expandedState:!0,displayInformation:a,minWidth:350,minHeight:300,width:Math.min(Ext.getBody().getViewSize().width,580),height:Math.min(Ext.getBody().getViewSize().height,!viewConfig.showResultsEdit?460:500),resizable:!0,
maximizable:!0,minimizable:!0,simulate:simulate,layout:{type:"vbox",align:"stretch"},items:[c,{xtype:"container",layout:{type:"hbox",align:"middle"},margins:"5 3 10 10",items:[d.playBut,d.slider,d.combo,d.stopBut]}],dockedItems:[{xtype:"toolbar",enableOverflow:!0,dock:"top",hidden:!viewConfig.showResultsEdit,items:[{iconCls:"add-icon",scale:"large",text:getText("Add Display"),handler:function(){var a=graph.getDefaultParent(),b=this.findParentByType("window");graph.getModel().beginUpdate();a=graph.insertVertex(a,
null,primitiveBank.display.cloneNode(!0),10,10,64,64,"display");a.visible=!1;graph.getModel().endUpdate();b.displays.push(a);b.tabs.add({title:a.getAttribute("name"),items:[renderDisplay(a,b.displayInformation)],layout:"fit",display:a});b.tabs.setActiveTab(primitives("Display").length-1);openDisplayConfigure(b)}},{scale:"large",iconCls:"big-delete-icon",text:getText("Delete Display"),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab());
graph.getModel().beginUpdate();graph.removeCells([a.displays[c]],!1);graph.getModel().endUpdate();a.displays.splice(c,1);b.remove(b.getActiveTab())}else mxUtils.alert(getText("No chart or table to delete."))}},{scale:"large",iconCls:"leftarrow-icon",text:"",tooltip:getText("Move display to the left."),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),d=a.displays[c];graph.orderCells(!0,[d]);var e=b.getActiveTab();a.displays.splice(c,
1);a.displays=[d].concat(a.displays);b.remove(e,!1);b.insert(0,e);b.setActiveTab(e)}else mxUtils.alert(getText("No chart or table to reorder."))}},{scale:"large",iconCls:"rightarrow-icon",text:"",tooltip:getText("Move display to the right."),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,c=b.items.indexOf(b.getActiveTab()),d=a.displays[c];graph.orderCells(!1,[d]);a.displays.splice(c,1);a.displays.push(d);a=b.getActiveTab();b.remove(a,!1);b.add(a);b.setActiveTab(a)}else mxUtils.alert(getText("No chart or table to reorder."))}},
"->",{scale:"large",iconCls:"scratchpad-large-icon",text:getText("Scratchpad"),handler:function(){var a=this.findParentByType("window");if(0<a.displays.length){var b=a.tabs,b=b.items.indexOf(b.getActiveTab()),b=a.displays[b];if("Tabular"!=b.getAttribute("Type")){b="scratchpad"+a.analysisCount+"_"+b.id;"shown"==a.scratchPadStatus[b]?(Ext.get(b).setDisplayed("none"),a.scratchPadStatus[b]="hidden"):("hidden"==a.scratchPadStatus[b]?Ext.get(b).setDisplayed("block"):(Ext.get(b).setDisplayed("block"),Scratchpad($("#"+
b))),a.scratchPadStatus[b]="shown");return}}mxUtils.alert(getText("Scratchpads can only be shown for charts."))}},{scale:"large",iconCls:"configure-icon",text:getText("Configure"),handler:function(){var a=this.findParentByType("window");0<a.displays.length?openDisplayConfigure(a):mxUtils.alert(getText("Add a chart or table to configure it."))}}]}]};is_ebook&&(b.maximizable=!1,b.closable=!1,b.resizable=!1,b.minimizable=!1,b.tools=[{type:"close-large",width:32,height:32,handler:function(){f.close()}}]);
var f=new Ext.Window(b);f.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,f.expand())});f.on("close",function(){d.simulator.completed()||d.simulator.terminate();clearInterval(d.animInter)});f.scripter=d;f.show();return f}
function buildMapStore(a,b){function c(){for(var b={agentIndex:n+1,states:o},c=0;c<a.bases.length;c++)b[a.bases[c]+"x"]=k,b[a.bases[c]+"y"]=l;return b}for(var d=[],e={},f={},g=0;g<a.agents.length;g++)for(var h=a.agents[g],k=-parseFloat(simpleNum(h.data.width,h.data.units)),l=-parseFloat(simpleNum(h.data.height,h.data.units)),m=a.agents[g].results[b].current,n=0;n<m.length;n++){f[m[n].instanceId]=m[n].location;e[m[n].instanceId]=m[n].connected;var o=null!==m[n].state?m[n].state.map(function(a){return a.name}).join(", "):
"",q=c(),r="series_"+h.id+"__";q[r+"x"]=m[n].location.items[0];q[r+"y"]=m[n].location.items[1];d.push(q);if(null!==m[n].state)for(var u=0;u<m[n].state.length;u++)q=c(),r="series_"+h.id+"_"+m[n].state[u].id+"_",q[r+"x"]=m[n].location.items[0],q[r+"y"]=m[n].location.items[1],d.push(q)}h={};m=Object.keys(e);for(n=0;n<m.length;n++){q=m[n];for(g=0;g<e[q].length;g++)r=[q,e[q][g]].sort().join("__"),h[r]||(h[r]=[f[q],f[e[q][g]]])}a.chart.links=h;a.store.loadData(d)}
function buildHistogramStore(a,b){a.store.loadData(createHistogramData(a.data[b],a.min,a.max))}
function createHistogramChart(a,b){var c=new Ext.data.JsonStore({fields:[{name:"Label",type:"string"},{name:"Count",type:"float"}],data:[]}),d={store:c,data:a.res[a.ids[b]].results},e=d.data;try{d.min=Math.floor(0+functionBank.min(e).value),d.max=Math.ceil(0+functionBank.max(e).value)}catch(f){d.min=-1,d.max=1}isNaN(d.min)&&(d.min=-1,d.max=1);d.min==d.max&&(d.min-=1,d.max+=1);c=Ext.create("Ext.chart.Chart",{xtype:"chart",flex:1,animate:!1,shadow:!1,store:c,axes:[{type:"Category",position:"bottom",
fields:["Label"],labelTitle:{font:"12px Verdana"},title:a.headers[b]},{type:"Numeric",position:"left",fields:"Count",decimals:0,minimum:0}],series:[{type:"column",xField:"Label",yField:"Count",gutter:5,tips:{trackMouse:!0,width:80,renderer:function(a,b){this.setTitle("<center>"+commaStr(b.value[1])+"</center>")}}}]});buildHistogramStore(d,a.scripter.time);a.histograms.push(d);return c}
function createHistogramData(a,b,c){for(var d=[],c=(c-b)/20,e=0;20>e;e++)d.push({Label:round(b+c/2+c*e,9),Count:0});for(e=0;e<a.items.length;e++){var f=0+a.items[e].value;isNaN(f)||(f=Math.max(0,Math.min(19,Math.round((f-b)/c-0.5))),d[f].Count+=1)}return d};(function(a,b){function c(a){var b=Ha[a]={};return p.each(a.split(na),function(a,c){b[c]=!0}),b}function d(a,c,d){if(d===b&&1===a.nodeType)if(d="data-"+c.replace(ga,"-$1").toLowerCase(),d=a.getAttribute(d),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:wa.test(d)?p.parseJSON(d):d}catch(e){}p.data(a,c,d)}else d=b;return d}function e(a){for(var b in a)if(!("data"===b&&p.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function f(){return!1}function g(){return!0}
function h(a){return!a||!a.parentNode||11===a.parentNode.nodeType}function k(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}function l(a,b,c){b=b||0;if(p.isFunction(b))return p.grep(a,function(a,d){return!!b.call(a,d,a)===c});if(b.nodeType)return p.grep(a,function(a){return a===b===c});if("string"==typeof b){var d=p.grep(a,function(a){return 1===a.nodeType});if(yb.test(b))return p.filter(b,d,!c);b=p.filter(b,d)}return p.grep(a,function(a){return 0<=p.inArray(a,b)===c})}function m(a){var b=Ra.split("|"),
a=a.createDocumentFragment();if(a.createElement)for(;b.length;)a.createElement(b.pop());return a}function n(a,b){if(1===b.nodeType&&p.hasData(a)){var c,d,e;d=p._data(a);var f=p._data(b,d),g=d.events;if(g)for(c in delete f.handle,f.events={},g)for(d=0,e=g[c].length;d<e;d++)p.event.add(b,c,g[c][d]);f.data&&(f.data=p.extend({},f.data))}}function o(a,b){var c;1===b.nodeType&&(b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase(),"object"===c?(b.parentNode&&
(b.outerHTML=a.outerHTML),p.support.html5Clone&&a.innerHTML&&!p.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&pa.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.selected=a.defaultSelected:"input"===c||"textarea"===c?b.defaultValue=a.defaultValue:"script"===c&&b.text!==a.text&&(b.text=a.text),b.removeAttribute(p.expando))}function q(a){return"undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName("*"):"undefined"!=typeof a.querySelectorAll?
a.querySelectorAll("*"):[]}function r(a){pa.test(a.type)&&(a.defaultChecked=a.checked)}function u(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Sa.length;e--;)if(b=Sa[e]+c,b in a)return b;return d}function w(a,b){return a=b||a,"none"===p.css(a,"display")||!p.contains(a.ownerDocument,a)}function v(a,b){for(var c,d,e=[],f=0,g=a.length;f<g;f++)c=a[f],c.style&&(e[f]=p._data(c,"olddisplay"),b?(!e[f]&&"none"===c.style.display&&(c.style.display=""),""===c.style.display&&w(c)&&
(e[f]=p._data(c,"olddisplay",H(c.nodeName)))):(d=ha(c,"display"),!e[f]&&"none"!==d&&p._data(c,"olddisplay",d)));for(f=0;f<g;f++)if(c=a[f],c.style&&(!b||"none"===c.style.display||""===c.style.display))c.style.display=b?e[f]||"":"none";return a}function x(a,b,c){return(a=ja.exec(b))?Math.max(0,a[1]-(c||0))+(a[2]||"px"):b}function z(a,b,c,d){for(var b=c===(d?"border":"content")?4:"width"===b?1:0,e=0;4>b;b+=2)"margin"===c&&(e+=p.css(a,c+Ba[b],!0)),d?("content"===c&&(e-=parseFloat(ha(a,"padding"+Ba[b]))||
0),"margin"!==c&&(e-=parseFloat(ha(a,"border"+Ba[b]+"Width"))||0)):(e+=parseFloat(ha(a,"padding"+Ba[b]))||0,"padding"!==c&&(e+=parseFloat(ha(a,"border"+Ba[b]+"Width"))||0));return e}function D(a,b,c){var d="width"===b?a.offsetWidth:a.offsetHeight,e=!0,f=p.support.boxSizing&&"border-box"===p.css(a,"boxSizing");if(0>=d){d=ha(a,b);if(0>d||null==d)d=a.style[b];if(fa.test(d))return d;e=f&&(p.support.boxSizingReliable||d===a.style[b]);d=parseFloat(d)||0}return d+z(a,b,c||(f?"border":"content"),e)+"px"}
function H(a){if(Na[a])return Na[a];var b=p("<"+a+">").appendTo(G.body),c=b.css("display");b.remove();if("none"===c||""===c){N=G.body.appendChild(N||p.extend(G.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!X||!N.createElement)X=(N.contentWindow||N.contentDocument).document,X.write("<!doctype html><html><body>"),X.close();b=X.body.appendChild(X.createElement(a));c=ha(b,"display");G.body.removeChild(N)}return Na[a]=c,c}function C(a,b,c,d){var e;if(p.isArray(b))p.each(b,function(b,e){c||
Wa.test(a)?d(a,e):C(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(!c&&"object"===p.type(b))for(e in b)C(a+"["+e+"]",b[e],c,d);else d(a,b)}function A(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e,f,g=b.toLowerCase().split(na),h=0,k=g.length;if(p.isFunction(c))for(;h<k;h++)d=g[h],f=/^\+/.test(d),f&&(d=d.substr(1)||"*"),e=a[d]=a[d]||[],e[f?"unshift":"push"](c)}}function y(a,c,d,e,f,g){f=f||c.dataTypes[0];g=g||{};g[f]=!0;for(var h,f=a[f],k=0,l=f?f.length:0,m=a===zb;k<l&&(m||!h);k++)h=
f[k](c,d,e),"string"==typeof h&&(!m||g[h]?h=b:(c.dataTypes.unshift(h),h=y(a,c,d,e,h,g)));return(m||!h)&&!g["*"]&&(h=y(a,c,d,e,"*",g)),h}function F(a,c){var d,e,f=p.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);e&&p.extend(!0,a,e)}function B(){try{return new a.XMLHttpRequest}catch(b){}}function I(){return setTimeout(function(){lb=b},0),lb=p.now()}function E(a,b){p.each(b,function(b,c){for(var d=(Xa[b]||[]).concat(Xa["*"]),e=0,f=d.length;e<f&&!d[e].call(a,b,c);e++);
})}function M(a,b,c){var d=0,e=mb.length,f=p.Deferred().always(function(){delete g.elem}),g=function(){for(var b=lb||I(),b=Math.max(0,h.startTime+h.duration-b),c=1-(b/h.duration||0),d=0,e=h.tweens.length;d<e;d++)h.tweens[d].run(c);return f.notifyWith(a,[h,c,b]),1>c&&e?b:(f.resolveWith(a,[h]),!1)},h=f.promise({elem:a,props:p.extend({},b),opts:p.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:lb||I(),duration:c.duration,tweens:[],createTween:function(b,c){var d=p.Tween(a,
h.opts,b,c,h.opts.specialEasing[b]||h.opts.easing);return h.tweens.push(d),d},stop:function(b){for(var c=0,d=b?h.tweens.length:0;c<d;c++)h.tweens[c].run(1);return b?f.resolveWith(a,[h,b]):f.rejectWith(a,[h,b]),this}}),c=h.props;for(L(c,h.opts.specialEasing);d<e;d++)if(b=mb[d].call(h,a,c,h.opts))return b;return E(h,c),p.isFunction(h.opts.start)&&h.opts.start.call(a,h),p.fx.timer(p.extend(g,{anim:h,queue:h.opts.queue,elem:a})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}
function L(a,b){var c,d,e,f,g;for(c in a)if(d=p.camelCase(c),e=b[d],f=a[c],p.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=p.cssHooks[d],g&&"expand"in g)for(c in f=g.expand(f),delete a[d],f)c in a||(a[c]=f[c],b[c]=e);else b[d]=e}function K(a,b,c,d,e){return new K.prototype.init(a,b,c,d,e)}function O(a,b){for(var c,d={height:a},e=0;4>e;e+=2-b)c=Ba[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function Q(a){return p.isWindow(a)?a:9===a.nodeType?a.defaultView||
a.parentWindow:!1}var T,R,G=a.document,ba=a.location,Z=a.navigator,P=a.jQuery,U=a.$,J=Array.prototype.push,S=Array.prototype.slice,ra=Array.prototype.indexOf,ea=Object.prototype.toString,ua=Object.prototype.hasOwnProperty,va=String.prototype.trim,p=function(a,b){return new p.fn.init(a,b,T)},ma=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,La=/\S/,na=/\s+/,ib=La.test("\u00c2 ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,Ma=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,jb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,xb=/^[\],:{}\s]*$/,
wb=/(?:^|:|,)(?:\s*\[)+/g,Aa=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,V=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,ya=/^-ms-/,Ga=/-([\da-z])/gi,W=function(a,b){return(b+"").toUpperCase()},ca=function(){G.addEventListener?(G.removeEventListener("DOMContentLoaded",ca,!1),p.ready()):"complete"===G.readyState&&(G.detachEvent("onreadystatechange",ca),p.ready())},xa={};p.fn=p.prototype={constructor:p,init:function(a,c,d){var e,f;if(!a)return this;if(a.nodeType)return this.context=
this[0]=a,this.length=1,this;if("string"==typeof a){"<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&3<=a.length?e=[null,a,null]:e=Ma.exec(a);if(e&&(e[1]||!c)){if(e[1])return c=c instanceof p?c[0]:c,f=c&&c.nodeType?c.ownerDocument||c:G,a=p.parseHTML(e[1],f,!0),jb.test(e[1])&&p.isPlainObject(c)&&this.attr.call(a,c,!0),p.merge(this,a);if((c=G.getElementById(e[2]))&&c.parentNode){if(c.id!==e[2])return d.find(a);this.length=1;this[0]=c}return this.context=G,this.selector=a,this}return!c||c.jquery?(c||d).find(a):
this.constructor(c).find(a)}return p.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),p.makeArray(a,this))},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return S.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a,b,c){a=p.merge(this.constructor(),a);return a.prevObject=this,a.context=this.context,"find"===b?a.selector=this.selector+(this.selector?" ":
"")+c:b&&(a.selector=this.selector+"."+b+"("+c+")"),a},each:function(a,b){return p.each(this,a,b)},ready:function(a){return p.ready.promise().done(a),this},eq:function(a){return a=+a,-1===a?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(S.apply(this,arguments),"slice",S.call(arguments).join(","))},map:function(a){return this.pushStack(p.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||
this.constructor(null)},push:J,sort:[].sort,splice:[].splice};p.fn.init.prototype=p.fn;p.extend=p.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},k=1,l=arguments.length,m=!1;for("boolean"==typeof h&&(m=h,h=arguments[1]||{},k=2),"object"!=typeof h&&!p.isFunction(h)&&(h={}),l===k&&(h=this,--k);k<l;k++)if(null!=(a=arguments[k]))for(c in a)d=h[c],e=a[c],h!==e&&(m&&e&&(p.isPlainObject(e)||(f=p.isArray(e)))?(f?(f=!1,g=d&&p.isArray(d)?d:[]):g=d&&p.isPlainObject(d)?d:{},h[c]=p.extend(m,g,e)):e!==
b&&(h[c]=e));return h};p.extend({noConflict:function(b){return a.$===p&&(a.$=U),b&&a.jQuery===p&&(a.jQuery=P),p},isReady:!1,readyWait:1,holdReady:function(a){a?p.readyWait++:p.ready(!0)},ready:function(a){if(!(!0===a?--p.readyWait:p.isReady)){if(!G.body)return setTimeout(p.ready,1);p.isReady=!0;!0!==a&&0<--p.readyWait||(R.resolveWith(G,[p]),p.fn.trigger&&p(G).trigger("ready").off("ready"))}},isFunction:function(a){return"function"===p.type(a)},isArray:Array.isArray||function(a){return"array"===p.type(a)},
isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?""+a:xa[ea.call(a)]||"object"},isPlainObject:function(a){if(!a||"object"!==p.type(a)||a.nodeType||p.isWindow(a))return!1;try{if(a.constructor&&!ua.call(a,"constructor")&&!ua.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}for(var d in a);return d===b||ua.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw Error(a);
},parseHTML:function(a,b,c){var d;return!a||"string"!=typeof a?null:("boolean"==typeof b&&(c=b,b=0),b=b||G,(d=jb.exec(a))?[b.createElement(d[1])]:(d=p.buildFragment([a],b,c?null:[]),p.merge([],(d.cacheable?p.clone(d.fragment):d.fragment).childNodes)))},parseJSON:function(b){if(!b||"string"!=typeof b)return null;b=p.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(xb.test(b.replace(Aa,"@").replace(V,"]").replace(wb,"")))return(new Function("return "+b))();p.error("Invalid JSON: "+b)},parseXML:function(c){var d,
e;if(!c||"string"!=typeof c)return null;try{a.DOMParser?(e=new DOMParser,d=e.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(f){d=b}return(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+c),d},noop:function(){},globalEval:function(b){b&&La.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(ya,"ms-").replace(Ga,W)},nodeName:function(a,b){return a.nodeName&&
a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var e,f=0,g=a.length,h=g===b||p.isFunction(a);if(d)if(h)for(e in a){if(!1===c.apply(a[e],d))break}else for(;f<g&&!(!1===c.apply(a[f++],d)););else if(h)for(e in a){if(!1===c.call(a[e],e,a[e]))break}else for(;f<g&&!(!1===c.call(a[f],f,a[f++])););return a},trim:va?function(a){return null==a?"":va.call(a)}:function(a){return null==a?"":a.toString().replace(ib,"")},makeArray:function(a,b){var c,d=b||[];return null!=a&&(c=p.type(a),null==
a.length||"string"===c||"function"===c||"regexp"===c||p.isWindow(a)?J.call(d,a):p.merge(d,a)),d},inArray:function(a,b,c){var d;if(b){if(ra)return ra.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;f<d;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,c=!!c;f<g;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);
return e},map:function(a,c,d){var e,f,g=[],h=0,k=a.length;if(a instanceof p||k!==b&&"number"==typeof k&&(0<k&&a[0]&&a[k-1]||0===k||p.isArray(a)))for(;h<k;h++)e=c(a[h],h,d),null!=e&&(g[g.length]=e);else for(f in a)e=c(a[f],f,d),null!=e&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),p.isFunction(a)?(e=S.call(arguments,2),f=function(){return a.apply(c,e.concat(S.call(arguments)))},f.guid=a.guid=a.guid||f.guid||p.guid++,f):
b},access:function(a,c,d,e,f,g,h){var k,l=null==d,m=0,n=a.length;if(d&&"object"==typeof d){for(m in d)p.access(a,c,m,d[m],1,g,e);f=1}else if(e!==b){k=h===b&&p.isFunction(e);l&&(k?(k=c,c=function(a,b,c){return k.call(p(a),c)}):(c.call(a,e),c=null));if(c)for(;m<n;m++)c(a[m],d,k?e.call(a[m],m,c(a[m],d)):e,h);f=1}return f?a:l?c.call(a):n?c(a[0],d):g},now:function(){return(new Date).getTime()}});p.ready.promise=function(b){if(!R)if(R=p.Deferred(),"complete"===G.readyState||"loading"!==G.readyState&&G.addEventListener)setTimeout(p.ready,
1);else if(G.addEventListener)G.addEventListener("DOMContentLoaded",ca,!1),a.addEventListener("load",p.ready,!1);else{G.attachEvent("onreadystatechange",ca);a.attachEvent("onload",p.ready);var c=!1;try{c=null==a.frameElement&&G.documentElement}catch(d){}c&&c.doScroll&&function Nb(){if(!p.isReady){try{c.doScroll("left")}catch(a){return setTimeout(Nb,50)}p.ready()}}()}return R.promise(b)};p.each("Boolean,Number,String,Function,Array,Date,RegExp,Object".split(","),function(a,b){xa["[object "+b+"]"]=
b.toLowerCase()});T=p(G);var Ha={};p.Callbacks=function(a){var a="string"==typeof a?Ha[a]||c(a):p.extend({},a),d,e,f,g,h,k,l=[],m=!a.once&&[],n=function(b){for(d=a.memory&&b,e=!0,k=g||0,g=0,h=l.length,f=!0;l&&k<h;k++)if(!1===l[k].apply(b[0],b[1])&&a.stopOnFalse){d=!1;break}f=!1;l&&(m?m.length&&n(m.shift()):d?l=[]:o.disable())},o={add:function(){if(l){var b=l.length;(function Ob(b){p.each(b,function(b,c){p.isFunction(c)&&(!a.unique||!o.has(c))?l.push(c):c&&c.length&&Ob(c)})})(arguments);f?h=l.length:
d&&(g=b,n(d))}return this},remove:function(){return l&&p.each(arguments,function(a,b){for(var c;-1<(c=p.inArray(b,l,c));)l.splice(c,1),f&&(c<=h&&h--,c<=k&&k--)}),this},has:function(a){return-1<p.inArray(a,l)},empty:function(){return l=[],this},disable:function(){return l=m=d=b,this},disabled:function(){return!l},lock:function(){return m=b,d||o.disable(),this},locked:function(){return!m},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],l&&(!e||m)&&(f?m.push(b):n(b)),this},fire:function(){return o.fireWith(this,
arguments),this},fired:function(){return!!e}};return o};p.extend({Deferred:function(a){var b=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return p.Deferred(function(c){p.each(b,function(b,d){var f=d[0],g=a[b];e[d[1]](p.isFunction(g)?function(){var a=
g.apply(this,arguments);a&&p.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f+"With"](this===e?c:this,[a])}:c[f])});a=null}).promise()},promise:function(a){return"object"==typeof a?p.extend(a,d):d}},e={};return d.pipe=d.then,p.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add;h&&g.add(function(){c=h},b[a^1][2].disable,b[2][2].lock);e[f[0]]=g.fire;e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=S.call(arguments),d=c.length,
e=1!==d||a&&p.isFunction(a.promise)?d:0,f=1===e?a:p.Deferred(),g=function(a,b,c){return function(d){b[a]=this;c[a]=1<arguments.length?S.call(arguments):d;c===h?f.notifyWith(b,c):--e||f.resolveWith(b,c)}},h,k,l;if(1<d)for(h=Array(d),k=Array(d),l=Array(d);b<d;b++)c[b]&&p.isFunction(c[b].promise)?c[b].promise().done(g(b,l,c)).fail(f.reject).progress(g(b,k,h)):--e;return e||f.resolveWith(l,c),f.promise()}});p.support=function(){var b,c,d,e,f,g,h,k,l,m,n,o=G.createElement("div");o.setAttribute("className",
"t");o.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";c=o.getElementsByTagName("*");d=o.getElementsByTagName("a")[0];d.style.cssText="top:1px;float:left;opacity:.5";if(!c||!c.length||!d)return{};e=G.createElement("select");f=e.appendChild(G.createElement("option"));g=o.getElementsByTagName("input")[0];b={leadingWhitespace:3===o.firstChild.nodeType,tbody:!o.getElementsByTagName("tbody").length,htmlSerialize:!!o.getElementsByTagName("link").length,style:/top/.test(d.getAttribute("style")),
hrefNormalized:"/a"===d.getAttribute("href"),opacity:/^0.5/.test(d.style.opacity),cssFloat:!!d.style.cssFloat,checkOn:"on"===g.value,optSelected:f.selected,getSetAttribute:"t"!==o.className,enctype:!!G.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==G.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===G.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,
pixelPosition:!1};g.checked=!0;b.noCloneChecked=g.cloneNode(!0).checked;e.disabled=!0;b.optDisabled=!f.disabled;try{delete o.test}catch(N){b.deleteExpando=!1}!o.addEventListener&&o.attachEvent&&o.fireEvent&&(o.attachEvent("onclick",n=function(){b.noCloneEvent=!1}),o.cloneNode(!0).fireEvent("onclick"),o.detachEvent("onclick",n));g=G.createElement("input");g.value="t";g.setAttribute("type","radio");b.radioValue="t"===g.value;g.setAttribute("checked","checked");g.setAttribute("name","t");o.appendChild(g);
h=G.createDocumentFragment();h.appendChild(o.lastChild);b.checkClone=h.cloneNode(!0).cloneNode(!0).lastChild.checked;b.appendChecked=g.checked;h.removeChild(g);h.appendChild(o);if(o.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})k="on"+l,m=k in o,m||(o.setAttribute(k,"return;"),m="function"==typeof o[k]),b[l+"Bubbles"]=m;return p(function(){var c,d,e,f,g=G.getElementsByTagName("body")[0];g&&(c=G.createElement("div"),c.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",
g.insertBefore(c,g.firstChild),d=G.createElement("div"),c.appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",e=d.getElementsByTagName("td"),e[0].style.cssText="padding:0;margin:0;border:0;display:none",m=0===e[0].offsetHeight,e[0].style.display="",e[1].style.display="none",b.reliableHiddenOffsets=m&&0===e[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",
b.boxSizing=4===d.offsetWidth,b.doesNotIncludeMarginInBodyOffset=1!==g.offsetTop,a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(d,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(d,null)||{width:"4px"}).width,f=G.createElement("div"),f.style.cssText=d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;",f.style.marginRight=f.style.width="0",d.style.width="1px",d.appendChild(f),b.reliableMarginRight=!parseFloat((a.getComputedStyle(f,null)||{}).marginRight)),
"undefined"!=typeof d.style.zoom&&(d.innerHTML="",d.style.cssText="padding:0;margin:0;border:0;display:block;overflow:hidden;width:1px;padding:1px;display:inline;zoom:1",b.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.style.overflow="visible",d.innerHTML="<div></div>",d.firstChild.style.width="5px",b.shrinkWrapBlocks=3!==d.offsetWidth,c.style.zoom=1),g.removeChild(c))}),h.removeChild(o),c=d=e=f=g=h=o=null,b}();var wa=/^(?:\{.*\}|\[.*\])$/,ga=/([A-Z])/g;p.extend({cache:{},deletedIds:[],
uuid:0,expando:"jQuery"+(p.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?p.cache[a[p.expando]]:a[p.expando],!!a&&!e(a)},data:function(a,c,d,e){if(p.acceptData(a)){var f,g,h=p.expando,k="string"==typeof c,l=a.nodeType,m=l?p.cache:a,n=l?a[h]:a[h]&&h;if(n&&m[n]&&(e||m[n].data)||!(k&&d===b)){n||(l?a[h]=n=p.deletedIds.pop()||++p.uuid:n=h);m[n]||(m[n]={},l||(m[n].toJSON=p.noop));if("object"==
typeof c||"function"==typeof c)e?m[n]=p.extend(m[n],c):m[n].data=p.extend(m[n].data,c);return f=m[n],e||(f.data||(f.data={}),f=f.data),d!==b&&(f[p.camelCase(c)]=d),k?(g=f[c],null==g&&(g=f[p.camelCase(c)])):g=f,g}}},removeData:function(a,b,c){if(p.acceptData(a)){var d,f,g,h=a.nodeType,k=h?p.cache:a,l=h?a[p.expando]:p.expando;if(k[l]){if(b&&(d=c?k[l]:k[l].data)){p.isArray(b)||(b in d?b=[b]:(b=p.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(f=0,g=b.length;f<g;f++)delete d[b[f]];if(!(c?e:p.isEmptyObject)(d))return}if(!c&&
(delete k[l].data,!e(k[l])))return;h?p.cleanData([a],!0):p.support.deleteExpando||k!=k.window?delete k[l]:k[l]=null}}},_data:function(a,b,c){return p.data(a,b,c,!0)},acceptData:function(a){var b=a.nodeName&&p.noData[a.nodeName.toLowerCase()];return!b||!0!==b&&a.getAttribute("classid")===b}});p.fn.extend({data:function(a,c){var e,f,g,h,k,l=this[0],m=0,n=null;if(a===b){if(this.length&&(n=p.data(l),1===l.nodeType&&!p._data(l,"parsedAttrs"))){g=l.attributes;for(k=g.length;m<k;m++)h=g[m].name,0===h.indexOf("data-")&&
(h=p.camelCase(h.substring(5)),d(l,h,n[h]));p._data(l,"parsedAttrs",!0)}return n}return"object"==typeof a?this.each(function(){p.data(this,a)}):(e=a.split(".",2),e[1]=e[1]?"."+e[1]:"",f=e[1]+"!",p.access(this,function(c){if(c===b)return n=this.triggerHandler("getData"+f,[e[0]]),n===b&&l&&(n=p.data(l,a),n=d(l,a,n)),n===b&&e[1]?this.data(e[0]):n;e[1]=c;this.each(function(){var b=p(this);b.triggerHandler("setData"+f,e);p.data(this,a,c);b.triggerHandler("changeData"+f,e)})},null,c,1<arguments.length,
null,!1))},removeData:function(a){return this.each(function(){p.removeData(this,a)})}});p.extend({queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=p._data(a,b),c&&(!d||p.isArray(c)?d=p._data(a,b,p.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){var b=b||"fx",c=p.queue(a,b),d=c.shift(),e=p._queueHooks(a,b),f=function(){p.dequeue(a,b)};"inprogress"===d&&(d=c.shift());d&&("fx"===b&&c.unshift("inprogress"),delete e.stop,d.call(a,f,e));!c.length&&e&&e.empty.fire()},_queueHooks:function(a,
b){var c=b+"queueHooks";return p._data(a,c)||p._data(a,c,{empty:p.Callbacks("once memory").add(function(){p.removeData(a,b+"queue",!0);p.removeData(a,c,!0)})})}});p.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?p.queue(this[0],a):c===b?this:this.each(function(){var b=p.queue(this,a,c);p._queueHooks(this,a);"fx"===a&&"inprogress"!==b[0]&&p.dequeue(this,a)})},dequeue:function(a){return this.each(function(){p.dequeue(this,a)})},delay:function(a,
b){return a=p.fx?p.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=p.Deferred(),g=this,h=this.length,k=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)(d=p._data(g[h],a+"queueHooks"))&&d.empty&&(e++,d.empty.add(k));return k(),f.promise(c)}});var oa,Ea,Fa,Da=/[\t\r\n]/g,tb=/\r/g,db=/^(?:button|input)$/i,eb=
/^(?:button|input|object|select|textarea)$/i,fb=/^a(?:rea|)$/i,Ia=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,gb=p.support.getSetAttribute;p.fn.extend({attr:function(a,b){return p.access(this,p.attr,a,b,1<arguments.length)},removeAttr:function(a){return this.each(function(){p.removeAttr(this,a)})},prop:function(a,b){return p.access(this,p.prop,a,b,1<arguments.length)},removeProp:function(a){return a=p.propFix[a]||a,
this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,f,g,h;if(p.isFunction(a))return this.each(function(b){p(this).addClass(a.call(this,b,this.className))});if(a&&"string"==typeof a){b=a.split(na);for(c=0,d=this.length;c<d;c++)if(e=this[c],1===e.nodeType)if(!e.className&&1===b.length)e.className=a;else{f=" "+e.className+" ";for(g=0,h=b.length;g<h;g++)~f.indexOf(" "+b[g]+" ")||(f+=b[g]+" ");e.className=p.trim(f)}}return this},removeClass:function(a){var c,
d,e,f,g,h,k;if(p.isFunction(a))return this.each(function(b){p(this).removeClass(a.call(this,b,this.className))});if(a&&"string"==typeof a||a===b){c=(a||"").split(na);for(h=0,k=this.length;h<k;h++)if(e=this[h],1===e.nodeType&&e.className){d=(" "+e.className+" ").replace(Da," ");for(f=0,g=c.length;f<g;f++)for(;-1<d.indexOf(" "+c[f]+" ");)d=d.replace(" "+c[f]+" "," ");e.className=a?p.trim(d):""}}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return p.isFunction(a)?this.each(function(c){p(this).toggleClass(a.call(this,
c,this.className,b),b)}):this.each(function(){if("string"===c)for(var e,f=0,g=p(this),h=b,k=a.split(na);e=k[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else if("undefined"===c||"boolean"===c)this.className&&p._data(this,"__className__",this.className),this.className=this.className||!1===a?"":p._data(this,"__className__")||""})},hasClass:function(a){for(var a=" "+a+" ",b=0,c=this.length;b<c;b++)if(1===this[b].nodeType&&-1<(" "+this[b].className+" ").replace(Da," ").indexOf(a))return!0;
return!1},val:function(a){var c,d,e,f=this[0];if(arguments.length)return e=p.isFunction(a),this.each(function(d){var f,g=p(this);if(1===this.nodeType&&(e?f=a.call(this,d,g.val()):f=a,null==f?f="":"number"==typeof f?f+="":p.isArray(f)&&(f=p.map(f,function(a){return null==a?"":a+""})),c=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()],!c||!("set"in c)||c.set(this,f,"value")===b))this.value=f});if(f)return c=p.valHooks[f.type]||p.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,
"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(tb,""):null==d?"":d)}});p.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d=a.selectedIndex,e=[],f=a.options,g="select-one"===a.type;if(0>d)return null;for(a=g?d:0,c=g?d+1:f.length;a<c;a++)if(b=f[a],b.selected&&(p.support.optDisabled?!b.disabled:null===b.getAttribute("disabled"))&&(!b.parentNode.disabled||!p.nodeName(b.parentNode,"optgroup"))){b=p(b).val();
if(g)return b;e.push(b)}return g&&!e.length&&f.length?p(f[d]).val():e},set:function(a,b){var c=p.makeArray(b);return p(a).find("option").each(function(){this.selected=0<=p.inArray(p(this).val(),c)}),c.length||(a.selectedIndex=-1),c}}},attrFn:{},attr:function(a,c,d,e){var f,g,h,k=a.nodeType;if(a&&!(3===k||8===k||2===k)){if(e&&p.isFunction(p.fn[c]))return p(a)[c](d);if("undefined"==typeof a.getAttribute)return p.prop(a,c,d);h=1!==k||!p.isXMLDoc(a);h&&(c=c.toLowerCase(),g=p.attrHooks[c]||(Ia.test(c)?
Ea:oa));if(d!==b){if(null===d){p.removeAttr(a,c);return}return g&&"set"in g&&h&&(f=g.set(a,d,c))!==b?f:(a.setAttribute(c,""+d),d)}return g&&"get"in g&&h&&null!==(f=g.get(a,c))?f:(f=a.getAttribute(c),null===f?b:f)}},removeAttr:function(a,b){var c,d,e,f,g=0;if(b&&1===a.nodeType)for(d=b.split(na);g<d.length;g++)e=d[g],e&&(c=p.propFix[e]||e,f=Ia.test(e),f||p.attr(a,e,""),a.removeAttribute(gb?e:c),f&&c in a&&(a[c]=!1))},attrHooks:{type:{set:function(a,b){if(db.test(a.nodeName)&&a.parentNode)p.error("type property can't be changed");
else if(!p.support.radioValue&&"radio"===b&&p.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return oa&&p.nodeName(a,"button")?oa.get(a,b):b in a?a.value:null},set:function(a,b,c){if(oa&&p.nodeName(a,"button"))return oa.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",
usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,f,g,h=a.nodeType;return!a||3===h||8===h||2===h?void 0:(g=1!==h||!p.isXMLDoc(a),g&&(c=p.propFix[c]||c,f=p.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c])},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):eb.test(a.nodeName)||fb.test(a.nodeName)&&a.href?0:b}}}});Ea={get:function(a,
c){var d,e=p.prop(a,c);return!0===e||"boolean"!=typeof e&&(d=a.getAttributeNode(c))&&!1!==d.nodeValue?c.toLowerCase():b},set:function(a,b,c){var d;return!1===b?p.removeAttr(a,c):(d=p.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}};gb||(Fa={name:!0,id:!0,coords:!0},oa=p.valHooks.button={get:function(a,c){var d;return d=a.getAttributeNode(c),d&&(Fa[c]?""!==d.value:d.specified)?d.value:b},set:function(a,b,c){var d=a.getAttributeNode(c);return d||(d=G.createAttribute(c),a.setAttributeNode(d)),
d.value=b+""}},p.each(["width","height"],function(a,b){p.attrHooks[b]=p.extend(p.attrHooks[b],{set:function(a,c){if(""===c)return a.setAttribute(b,"auto"),c}})}),p.attrHooks.contenteditable={get:oa.get,set:function(a,b,c){""===b&&(b="false");oa.set(a,b,c)}});p.support.hrefNormalized||p.each(["href","src","width","height"],function(a,c){p.attrHooks[c]=p.extend(p.attrHooks[c],{get:function(a){a=a.getAttribute(c,2);return null===a?b:a}})});p.support.style||(p.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||
b},set:function(a,b){return a.style.cssText=""+b}});p.support.optSelected||(p.propHooks.selected=p.extend(p.propHooks.selected,{get:function(a){a=a.parentNode;return a&&(a.selectedIndex,a.parentNode&&a.parentNode.selectedIndex),null}}));p.support.enctype||(p.propFix.enctype="encoding");p.support.checkOn||p.each(["radio","checkbox"],function(){p.valHooks[this]={get:function(a){return null===a.getAttribute("value")?"on":a.value}}});p.each(["radio","checkbox"],function(){p.valHooks[this]=p.extend(p.valHooks[this],
{set:function(a,b){if(p.isArray(b))return a.checked=0<=p.inArray(p(a).val(),b)}})});var za=/^(?:textarea|input|select)$/i,Ja=/^([^\.]*|)(?:\.(.+)|)$/,ub=/(?:^|\s)hover(\.\S+|)\b/,hb=/^key/,vb=/^(?:mouse|contextmenu)|click/,Ka=/^(?:focusinfocus|focusoutblur)$/,kb=function(a){return p.event.special.hover?a:a.replace(ub,"mouseenter$1 mouseleave$1")};p.event={add:function(a,c,d,e,f){var g,h,k,l,m,n,o,N,y,q;if(!(3===a.nodeType||8===a.nodeType||!c||!d||!(g=p._data(a)))){d.handler&&(N=d,d=N.handler,f=N.selector);
d.guid||(d.guid=p.guid++);k=g.events;k||(g.events=k={});h=g.handle;h||(g.handle=h=function(a){return"undefined"!=typeof p&&(!a||p.event.triggered!==a.type)?p.event.dispatch.apply(h.elem,arguments):b},h.elem=a);c=p.trim(kb(c)).split(" ");for(g=0;g<c.length;g++){l=Ja.exec(c[g])||[];m=l[1];n=(l[2]||"").split(".").sort();q=p.event.special[m]||{};m=(f?q.delegateType:q.bindType)||m;q=p.event.special[m]||{};o=p.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:f,namespace:n.join(".")},N);
y=k[m];if(!y&&(y=k[m]=[],y.delegateCount=0,!q.setup||!1===q.setup.call(a,e,n,h)))a.addEventListener?a.addEventListener(m,h,!1):a.attachEvent&&a.attachEvent("on"+m,h);q.add&&(q.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid));f?y.splice(y.delegateCount++,0,o):y.push(o);p.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var f,g,h,k,l,m,n,o,N,y,q,X=p.hasData(a)&&p._data(a);if(X&&(o=X.events)){b=p.trim(kb(b||"")).split(" ");for(f=0;f<b.length;f++)if(g=Ja.exec(b[f])||[],h=k=g[1],
l=g[2],h){N=p.event.special[h]||{};h=(d?N.delegateType:N.bindType)||h;y=o[h]||[];m=y.length;l=l?RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(n=0;n<y.length;n++)q=y[n],(e||k===q.origType)&&(!c||c.guid===q.guid)&&(!l||l.test(q.namespace))&&(!d||d===q.selector||"**"===d&&q.selector)&&(y.splice(n--,1),q.selector&&y.delegateCount--,N.remove&&N.remove.call(a,q));0===y.length&&m!==y.length&&((!N.teardown||!1===N.teardown.call(a,l,X.handle))&&p.removeEvent(a,h,X.handle),
delete o[h])}else for(h in o)p.event.remove(a,h+b[f],c,d,!0);p.isEmptyObject(o)&&(delete X.handle,p.removeData(a,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,f){if(!e||3!==e.nodeType&&8!==e.nodeType){var g,h,k,l,m,n,o,N,y=c.type||c;m=[];if(!Ka.test(y+p.event.triggered)&&(0<=y.indexOf("!")&&(y=y.slice(0,-1),g=!0),0<=y.indexOf(".")&&(m=y.split("."),y=m.shift(),m.sort()),e&&!p.event.customEvent[y]||p.event.global[y]))if(c="object"==typeof c?c[p.expando]?c:
new p.Event(y,c):new p.Event(y),c.type=y,c.isTrigger=!0,c.exclusive=g,c.namespace=m.join("."),c.namespace_re=c.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,g=0>y.indexOf(":")?"on"+y:"",e){if(c.result=b,c.target||(c.target=e),d=null!=d?p.makeArray(d):[],d.unshift(c),m=p.event.special[y]||{},!(m.trigger&&!1===m.trigger.apply(e,d))){o=[[e,m.bindType||y]];if(!f&&!m.noBubble&&!p.isWindow(e)){N=m.delegateType||y;k=Ka.test(N+y)?e:e.parentNode;for(l=e;k;k=k.parentNode)o.push([k,N]),
l=k;l===(e.ownerDocument||G)&&o.push([l.defaultView||l.parentWindow||a,N])}for(h=0;h<o.length&&!c.isPropagationStopped();h++)k=o[h][0],c.type=o[h][1],n=(p._data(k,"events")||{})[c.type]&&p._data(k,"handle"),n&&n.apply(k,d),n=g&&k[g],n&&p.acceptData(k)&&!1===n.apply(k,d)&&c.preventDefault();return c.type=y,!f&&!c.isDefaultPrevented()&&(!m._default||!1===m._default.apply(e.ownerDocument,d))&&("click"!==y||!p.nodeName(e,"a"))&&p.acceptData(e)&&g&&e[y]&&("focus"!==y&&"blur"!==y||0!==c.target.offsetWidth)&&
!p.isWindow(e)&&(l=e[g],l&&(e[g]=null),p.event.triggered=y,e[y](),p.event.triggered=b,l&&(e[g]=l)),c.result}}else for(h in e=p.cache,e)e[h].events&&e[h].events[y]&&p.event.trigger(c,d,e[h].handle.elem,!0)}},dispatch:function(c){var c=p.event.fix(c||a.event),d,e,f,g,h,k,l,m,n,o=(p._data(this,"events")||{})[c.type]||[],N=o.delegateCount,y=[].slice.call(arguments),q=!c.exclusive&&!c.namespace,X=p.event.special[c.type]||{},r=[];y[0]=c;c.delegateTarget=this;if(!(X.preDispatch&&!1===X.preDispatch.call(this,
c))){if(N&&(!c.button||"click"!==c.type)){f=p(this);f.context=this;for(e=c.target;e!=this;e=e.parentNode||this)if(!0!==e.disabled||"click"!==c.type){h={};l=[];f[0]=e;for(d=0;d<N;d++)m=o[d],n=m.selector,h[n]===b&&(h[n]=f.is(n)),h[n]&&l.push(m);l.length&&r.push({elem:e,matches:l})}}o.length>N&&r.push({elem:this,matches:o.slice(N)});for(d=0;d<r.length&&!c.isPropagationStopped();d++){k=r[d];c.currentTarget=k.elem;for(e=0;e<k.matches.length&&!c.isImmediatePropagationStopped();e++)if(m=k.matches[e],q||
!c.namespace&&!m.namespace||c.namespace_re&&c.namespace_re.test(m.namespace))c.data=m.data,c.handleObj=m,g=((p.event.special[m.origType]||{}).handle||m.handler).apply(k.elem,y),g!==b&&(c.result=g,!1===g&&(c.preventDefault(),c.stopPropagation()))}return X.postDispatch&&X.postDispatch.call(this,c),c.result}},props:"attrChange,attrName,relatedNode,srcElement,altKey,bubbles,cancelable,ctrlKey,currentTarget,eventPhase,metaKey,relatedTarget,shiftKey,target,timeStamp,view,which".split(","),fixHooks:{},keyHooks:{props:["char",
"charCode","key","keyCode"],filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button,buttons,clientX,clientY,fromElement,offsetX,offsetY,pageX,pageY,screenX,screenY,toElement".split(","),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||G,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=
c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==b&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[p.expando])return a;var b,c,d=a,e=p.event.fixHooks[a.type]||{},f=e.props?this.props.concat(e.props):this.props,a=p.Event(d);for(b=f.length;b;)c=f[--b],a[c]=d[c];return a.target||(a.target=d.srcElement||G),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,
e.filter?e.filter(a,d):a},special:{ready:{setup:p.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){p.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){a=p.extend(new p.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?p.event.trigger(a,null,b):p.event.dispatch.call(b,a);a.isDefaultPrevented()&&c.preventDefault()}};p.event.handle=
p.event.dispatch;p.removeEvent=G.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){b="on"+b;a.detachEvent&&("undefined"==typeof a[b]&&(a[b]=null),a.detachEvent(b,c))};p.Event=function(a,b){if(this instanceof p.Event)a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||!1===a.returnValue||a.getPreventDefault&&a.getPreventDefault()?g:f):this.type=a,b&&p.extend(this,b),this.timeStamp=a&&a.timeStamp||p.now(),
this[p.expando]=!0;else return new p.Event(a,b)};p.Event.prototype={preventDefault:function(){this.isDefaultPrevented=g;var a=this.originalEvent;a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=g;var a=this.originalEvent;a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g;this.stopPropagation()},isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f};
p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){p.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=a.relatedTarget,e=a.handleObj;if(!d||d!==this&&!p.contains(this,d))a.type=e.origType,c=e.handler.apply(this,arguments),a.type=b;return c}}});p.support.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form"))return!1;p.event.add(this,"click._submit keypress._submit",function(a){a=a.target;(a=p.nodeName(a,"input")||p.nodeName(a,"button")?
a.form:b)&&!p._data(a,"_submit_attached")&&(p.event.add(a,"submit._submit",function(a){a._submit_bubble=!0}),p._data(a,"_submit_attached",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&p.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){if(p.nodeName(this,"form"))return!1;p.event.remove(this,"._submit")}});p.support.changeBubbles||(p.event.special.change={setup:function(){if(za.test(this.nodeName)){if("checkbox"===this.type||
"radio"===this.type)p.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1);p.event.simulate("change",this,a,!0)});return!1}p.event.add(this,"beforeactivate._change",function(a){a=a.target;za.test(a.nodeName)&&!p._data(a,"_change_attached")&&(p.event.add(a,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&
p.event.simulate("change",this.parentNode,a,!0)}),p._data(a,"_change_attached",!0))})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type)return a.handleObj.handler.apply(this,arguments)},teardown:function(){return p.event.remove(this,"._change"),za.test(this.nodeName)}});p.support.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){p.event.simulate(b,a.target,p.event.fix(a),!0)};p.event.special[b]=
{setup:function(){0===c++&&G.addEventListener(a,d,!0)},teardown:function(){0===--c&&G.removeEventListener(a,d,!0)}}});p.fn.extend({on:function(a,c,d,e,g){var h,k;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(k in a)this.on(k,c,d,a[k],g);return this}null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b));if(!1===e)e=f;else if(!e)return this;return 1===g&&(h=e,e=function(a){return p().off(a),h.apply(this,arguments)},e.guid=h.guid||(h.guid=p.guid++)),this.each(function(){p.event.add(this,
a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,g;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,p(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(g in a)this.off(g,c,a[g]);return this}if(!1===c||"function"==typeof c)d=c,c=b;return!1===d&&(d=f),this.each(function(){p.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,
null,b)},live:function(a,b,c){return p(this.context).on(a,this.selector,b,c),this},die:function(a,b){return p(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1==arguments.length?this.off(a,"**"):this.off(b,a||"**",c)},trigger:function(a,b){return this.each(function(){p.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return p.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=
a.guid||p.guid++,d=0,e=function(c){var e=(p._data(this,"lastToggle"+a.guid)||0)%d;return p._data(this,"lastToggle"+a.guid,e+1),c.preventDefault(),b[e].apply(this,arguments)||!1};for(e.guid=c;d<b.length;)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});p.each("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error,contextmenu".split(","),
function(a,b){p.fn[b]=function(a,c){return null==c&&(c=a,a=null),0<arguments.length?this.on(b,null,a,c):this.trigger(b)};hb.test(b)&&(p.event.fixHooks[b]=p.event.keyHooks);vb.test(b)&&(p.event.fixHooks[b]=p.event.mouseHooks)});(function(a,b){function c(a,b,d,e){for(var f=0,g=b.length;f<g;f++)C(a,b[f],d,e)}function d(a,b,e,f,g,h){var k,l=S.setFilters[b.toLowerCase()];return l||C.error(b),(a||!(k=g))&&c(a||"*",f,k=[],g),0<k.length?l(k,e,h):[]}function e(a,f,g,h,k){for(var l,m,n,o,N,p,y,q=0,X=k.length,
r=J.POS,ia=RegExp("^"+r.source+"(?!"+B+")","i"),Mb=function(){for(var a=1,c=arguments.length-2;a<c;a++)arguments[a]===b&&(l[a]=b)};q<X;q++){for(r.exec(""),a=k[q],o=[],n=0,N=h;l=r.exec(a);)if(m=r.lastIndex=l.index+l[0].length,m>n){y=a.slice(n,l.index);n=m;p=[f];ja.test(y)&&(N&&(p=N),N=h);if(m=E.test(y))y=y.slice(0,-5).replace(ja,"$&*");1<l.length&&l[0].replace(ia,Mb);N=d(y,l[1],l[2],p,N,m)}N?(o=o.concat(N),(y=a.slice(n))&&")"!==y?ja.test(y)?c(y,o,g,h):C(y,f,g,h?h.concat(N):N):A.apply(g,o)):C(a,f,g,
h)}return 1===X?g:C.uniqueSort(g)}function f(a,b,c){var d=b.dir,e=r++;return a||(a=function(a){return a===c}),b.first?function(b,c){for(;b=b[d];)if(1===b.nodeType)return a(b,c)&&b}:function(b,c){for(var f,g=e+"."+l,h=g+"."+k;b=b[d];)if(1===b.nodeType){if((f=b[da])===h)return b.sizset;if("string"==typeof f&&0===f.indexOf(g)){if(b.sizset)return b}else{b[da]=h;if(a(b,c))return b.sizset=!0,b;b.sizset=!1}}}}function g(a,b){return a?function(c,d){var e=b(c,d);return e&&a(!0===e?c:e,d)}:b}function h(a){return function(b,
c){for(var d,e=0;d=a[e];e++)if(d(b,c))return!0;return!1}}var k,l,m,n,o,N=a.document,y=N.documentElement,q=!1,X=!0,r=0,ia=[].slice,A=[].push,da=("sizcache"+Math.random()).replace(".",""),B="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("w","w#"),F="\\["+B+"*((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",u=B+"*([\\x20\\t\\r\\n\\f>+~])"+B+"*",x="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+F+"|"+":((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)".replace(2,
7)+"|[^\\\\(),])+",qa=RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),ja=RegExp("^"+u),z=RegExp(x+"?(?="+B+"*,|$)","g"),w=RegExp("^(?:(?!,)(?:(?:^|,)"+B+"*"+x+")*?|"+B+"*(.*?))(\\)|$)"),v=RegExp(x.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+u,"g"),ta=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,I=/[\x20\t\r\n\f]*[+~]/,E=/:not\($/,fa=/h\d/i,L=/input|select|textarea|button/i,M=/\\(?!\\)/g,J={ID:/^#((?:\\.|[-\w]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[-\w]|[^\x00-\xa0])+)/,NAME:/^\[name=['"]?((?:\\.|[-\w]|[^\x00-\xa0])+)['"]?\]/,
TAG:RegExp("^("+"(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+".replace("[-","[-\\*")+")"),ATTR:RegExp("^"+F),PSEUDO:RegExp("^:((?:\\\\.|[-\\w]|[^\\x00-\\xa0])+)(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)"),CHILD:RegExp("^:(only|nth|last|first)-child(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),POS:RegExp(":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)","ig"),needsContext:RegExp("^"+B+"*[>+~]|:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",
"i")},bb={},U=[],D={},Na=[],F=function(a){return a.sizzleFilter=!0,a},u=function(a){return function(b){return"input"===b.nodeName.toLowerCase()&&b.type===a}},x=function(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}},K=function(a){var b=!1,c=N.createElement("div");try{b=a(c)}catch(d){}return b},Db=K(function(a){a.innerHTML="<select></select>";a=typeof a.lastChild.getAttribute("multiple");return"boolean"!==a&&"string"!==a}),Ba=K(function(a){a.id=
da+0;a.innerHTML="<a name='"+da+"'></a><div name='"+da+"'></div>";y.insertBefore(a,y.firstChild);var b=N.getElementsByName&&N.getElementsByName(da).length===2+N.getElementsByName(da+0).length;return o=!N.getElementById(da),y.removeChild(a),b}),G=K(function(a){return a.appendChild(N.createComment("")),0===a.getElementsByTagName("*").length}),O=K(function(a){return a.innerHTML="<a href='#'></a>",a.firstChild&&"undefined"!==typeof a.firstChild.getAttribute&&"#"===a.firstChild.getAttribute("href")}),
cb=K(function(a){return a.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!a.getElementsByClassName||0===a.getElementsByClassName("e").length?!1:(a.lastChild.className="e",1!==a.getElementsByClassName("e").length)}),C=function(a,b,c,d){c=c||[];b=b||N;var e,f,g,h,k=b.nodeType;if(1!==k&&9!==k)return[];if(!a||"string"!=typeof a)return c;g=Sa(b);if(!g&&!d&&(e=ta.exec(a)))if(h=e[1])if(9===k){f=b.getElementById(h);if(!f||!f.parentNode)return c;if(f.id===h)return c.push(f),c}else{if(b.ownerDocument&&
(f=b.ownerDocument.getElementById(h))&&H(b,f)&&f.id===h)return c.push(f),c}else{if(e[2])return A.apply(c,ia.call(b.getElementsByTagName(a),0)),c;if((h=e[3])&&cb&&b.getElementsByClassName)return A.apply(c,ia.call(b.getElementsByClassName(h),0)),c}return R(a,b,c,d,g)},S=C.selectors={cacheLength:50,match:J,order:["ID","TAG"],attrHandle:{},createPseudo:F,find:{ID:o?function(a,b,c){if("undefined"!==typeof b.getElementById&&!c)return(a=b.getElementById(a))&&a.parentNode?[a]:[]}:function(a,c,d){if("undefined"!==
typeof c.getElementById&&!d)return(c=c.getElementById(a))?c.id===a||"undefined"!==typeof c.getAttributeNode&&c.getAttributeNode("id").value===a?[c]:b:[]},TAG:G?function(a,b){if("undefined"!==typeof b.getElementsByTagName)return b.getElementsByTagName(a)}:function(a,b){var c=b.getElementsByTagName(a);if("*"===a){for(var d,e=[],f=0;d=c[f];f++)1===d.nodeType&&e.push(d);return e}return c}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},
preFilter:{ATTR:function(a){return a[1]=a[1].replace(M,""),a[3]=(a[4]||a[5]||"").replace(M,""),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1]?(a[2]||C.error(a[0]),a[3]=+(a[3]?a[4]+(a[5]||1):2*("even"===a[2]||"odd"===a[2])),a[4]=+(a[6]+a[7]||"odd"===a[2])):a[2]&&C.error(a[0]),a},PSEUDO:function(a){var b,c=a[4];return J.CHILD.test(a[0])?null:(c&&(b=w.exec(c))&&b.pop()&&(a[0]=a[0].slice(0,b[0].length-c.length-1),c=b[0].slice(0,-1)),a.splice(2,
3,c||a[3]),a)}},filter:{ID:o?function(a){return a=a.replace(M,""),function(b){return b.getAttribute("id")===a}}:function(a){return a=a.replace(M,""),function(b){return(b="undefined"!==typeof b.getAttributeNode&&b.getAttributeNode("id"))&&b.value===a}},TAG:function(a){return"*"===a?function(){return!0}:(a=a.replace(M,"").toLowerCase(),function(b){return b.nodeName&&b.nodeName.toLowerCase()===a})},CLASS:function(a){var b=bb[a];return b||(b=bb[a]=RegExp("(^|"+B+")"+a+"("+B+"|$)"),U.push(a),U.length>
S.cacheLength&&delete bb[U.shift()]),function(a){return b.test(a.className||"undefined"!==typeof a.getAttribute&&a.getAttribute("class")||"")}},ATTR:function(a,b,c){return b?function(d){var d=C.attr(d,a),e=d+"";if(null==d)return"!="===b;switch(b){case "=":return e===c;case "!=":return e!==c;case "^=":return c&&0===e.indexOf(c);case "*=":return c&&-1<e.indexOf(c);case "$=":return c&&e.substr(e.length-c.length)===c;case "~=":return-1<(" "+e+" ").indexOf(c);case "|=":return e===c||e.substr(0,c.length+
1)===c+"-"}}:function(b){return null!=C.attr(b,a)}},CHILD:function(a,b,c,d){if("nth"===a){var e=r++;return function(a){var b,f,g=0,h=a;if(1===c&&0===d)return!0;if((b=a.parentNode)&&(b[da]!==e||!a.sizset)){for(h=b.firstChild;h&&!(1===h.nodeType&&(h.sizset=++g,h===a));h=h.nextSibling);b[da]=e}return f=a.sizset-d,0===c?0===f:0===f%c&&0<=f/c}}return function(b){var c=b;switch(a){case "only":case "first":for(;c=c.previousSibling;)if(1===c.nodeType)return!1;if("first"===a)return!0;c=b;case "last":for(;c=
c.nextSibling;)if(1===c.nodeType)return!1;return!0}}},PSEUDO:function(a,b,c,d){var e=S.pseudos[a]||S.pseudos[a.toLowerCase()];return e||C.error("unsupported pseudo: "+a),e.sizzleFilter?e(b,c,d):e}},pseudos:{not:F(function(a,b,c){var d=Q(a.replace(qa,"$1"),b,c);return function(a){return!d(a)}}),enabled:function(a){return!1===a.disabled},disabled:function(a){return!0===a.disabled},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&
a.parentNode.selectedIndex,!0===a.selected},parent:function(a){return!S.pseudos.empty(a)},empty:function(a){for(var b,a=a.firstChild;a;){if("@"<a.nodeName||3===(b=a.nodeType)||4===b)return!1;a=a.nextSibling}return!0},contains:F(function(a){return function(b){return-1<(b.textContent||b.innerText||Wa(b)).indexOf(a)}}),has:F(function(a){return function(b){return 0<C(a,b).length}}),header:function(a){return fa.test(a.nodeName)},text:function(a){var b,c;return"input"===a.nodeName.toLowerCase()&&"text"===
(b=a.type)&&(null==(c=a.getAttribute("type"))||c.toLowerCase()===b)},radio:u("radio"),checkbox:u("checkbox"),file:u("file"),password:u("password"),image:u("image"),submit:x("submit"),reset:x("reset"),button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},input:function(a){return L.test(a.nodeName)},focus:function(a){var b=a.ownerDocument;return a===b.activeElement&&(!b.hasFocus||b.hasFocus())&&(!!a.type||!!a.href)},active:function(a){return a===a.ownerDocument.activeElement}},
setFilters:{first:function(a,b,c){return c?a.slice(1):[a[0]]},last:function(a,b,c){b=a.pop();return c?a:[b]},even:function(a,b,c){for(var b=[],c=c?1:0,d=a.length;c<d;c+=2)b.push(a[c]);return b},odd:function(a,b,c){for(var b=[],c=c?0:1,d=a.length;c<d;c+=2)b.push(a[c]);return b},lt:function(a,b,c){return c?a.slice(+b):a.slice(0,+b)},gt:function(a,b,c){return c?a.slice(0,+b+1):a.slice(+b+1)},eq:function(a,b,c){b=a.splice(+b,1);return c?a:b}}};S.setFilters.nth=S.setFilters.eq;S.filters=S.pseudos;O||(S.attrHandle=
{href:function(a){return a.getAttribute("href",2)},type:function(a){return a.getAttribute("type")}});Ba&&(S.order.push("NAME"),S.find.NAME=function(a,b){if("undefined"!==typeof b.getElementsByName)return b.getElementsByName(a)});cb&&(S.order.splice(1,0,"CLASS"),S.find.CLASS=function(a,b,c){if("undefined"!==typeof b.getElementsByClassName&&!c)return b.getElementsByClassName(a)});try{ia.call(y.childNodes,0)[0].nodeType}catch(Cb){ia=function(a){for(var b,c=[];b=this[a];a++)c.push(b);return c}}var Sa=
C.isXML=function(a){return(a=a&&(a.ownerDocument||a).documentElement)?"HTML"!==a.nodeName:!1},H=C.contains=y.compareDocumentPosition?function(a,b){return!!(a.compareDocumentPosition(b)&16)}:y.contains?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b.parentNode;return a===d||!(!d||!(1===d.nodeType&&c.contains&&c.contains(d)))}:function(a,b){for(;b=b.parentNode;)if(b===a)return!0;return!1},Wa=C.getText=function(a){var b,c="",d=0;if(b=a.nodeType)if(1===b||9===b||11===b){if("string"==typeof a.textContent)return a.textContent;
for(a=a.firstChild;a;a=a.nextSibling)c+=Wa(a)}else{if(3===b||4===b)return a.nodeValue}else for(;b=a[d];d++)c+=Wa(b);return c};C.attr=function(a,b){var c,d=Sa(a);return d||(b=b.toLowerCase()),S.attrHandle[b]?S.attrHandle[b](a):Db||d?a.getAttribute(b):(c=a.getAttributeNode(b),c?"boolean"==typeof a[b]?a[b]?b:null:c.specified?c.value:null:null)};C.error=function(a){throw Error("Syntax error, unrecognized expression: "+a);};[0,0].sort(function(){return X=0});y.compareDocumentPosition?m=function(a,b){return a===
b?(q=!0,0):(!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition:a.compareDocumentPosition(b)&4)?-1:1}:(m=function(a,b){if(a===b)return q=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[];c=a.parentNode;d=b.parentNode;var g=c;if(c===d)return n(a,b);if(!c)return-1;if(!d)return 1;for(;g;)e.unshift(g),g=g.parentNode;for(g=d;g;)f.unshift(g),g=g.parentNode;c=e.length;d=f.length;for(g=0;g<c&&g<d;g++)if(e[g]!==f[g])return n(e[g],f[g]);return g===
c?n(a,f[g],-1):n(e[g],b,1)},n=function(a,b,c){if(a===b)return c;for(a=a.nextSibling;a;){if(a===b)return-1;a=a.nextSibling}return 1});C.uniqueSort=function(a){var b,c=1;if(m&&(q=X,a.sort(m),q))for(;b=a[c];c++)b===a[c-1]&&a.splice(c--,1);return a};var Q=C.compile=function(a,b,c){var d,e,k,l=D[a];if(l&&l.context===b)return l;var m,n=[];d=0;for(var o=w.exec(a),p=!o.pop()&&!o.pop(),y=p&&a.match(z)||[""],q=S.preFilter,X=S.filter,r=!c&&b!==N;null!=(k=y[d])&&p;d++)for(n.push(e=[]),r&&(k=" "+k);k;){p=!1;if(o=
ja.exec(k))k=k.slice(o[0].length),p=e.push({part:o.pop().replace(qa," "),captures:o});for(m in X)(o=J[m].exec(k))&&(!q[m]||(o=q[m](o,b,c)))&&(k=k.slice(o.shift().length),p=e.push({part:m,captures:o}));if(!p)break}e=(p||C.error(a),n);for(k=0;d=e[k];k++){m=e;n=k;o=b;p=c;q=y=void 0;for(X=0;y=d[X];X++)S.relative[y.part]?q=f(q,S.relative[y.part],o):(y.captures.push(o,p),q=g(q,S.filter[y.part].apply(null,y.captures)));m[n]=q}return l=D[a]=h(e),l.context=b,l.runs=l.dirruns=0,Na.push(a),Na.length>S.cacheLength&&
delete D[Na.shift()],l};C.matches=function(a,b){return C(a,null,null,b)};C.matchesSelector=function(a,b){return 0<C(b,null,null,[a]).length};var R=function(a,b,c,d,f){var a=a.replace(qa,"$1"),g,h,m,n,o,N,p,y=a.match(z);m=a.match(v);n=b.nodeType;if(J.POS.test(a))return e(a,b,c,d,y);if(d)g=ia.call(d,0);else if(y&&1===y.length){if(1<m.length&&9===n&&!f&&(y=J.ID.exec(m[0]))){b=S.find.ID(y[1],b,f)[0];if(!b)return c;a=a.slice(m.shift().length)}d=(y=I.exec(m[0]))&&!y.index&&b.parentNode||b;p=m.pop();o=p.split(":not")[0];
for(m=0,n=S.order.length;m<n;m++)if(N=S.order[m],y=J[N].exec(o))if(g=S.find[N]((y[1]||"").replace(M,""),d,f),null!=g){o===p&&(a=a.slice(0,a.length-p.length)+o.replace(J[N],""),a||A.apply(c,ia.call(g,0)));break}}if(a){h=Q(a,b,f);l=h.dirruns++;null==g&&(g=S.find.TAG("*",I.test(a)&&b.parentNode||b));for(m=0;a=g[m];m++)k=h.runs++,h(a,b)&&c.push(a)}return c};N.querySelectorAll&&function(){var a,b=R,c=/'|\\/g,d=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,e=[],f=[":active"],g=y.matchesSelector||y.mozMatchesSelector||
y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(a){a.innerHTML="<select><option selected></option></select>";a.querySelectorAll("[selected]").length||e.push("\\["+B+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");a.querySelectorAll(":checked").length||e.push(":checked")});K(function(a){a.innerHTML="<p test=''></p>";a.querySelectorAll("[test^='']").length&&e.push("[*^$]="+B+"*(?:\"\"|'')");a.innerHTML="<input type='hidden'>";a.querySelectorAll(":enabled").length||
e.push(":enabled",":disabled")});e=e.length&&RegExp(e.join("|"));R=function(a,d,f,g,h){if(!g&&!h&&(!e||!e.test(a)))if(9===d.nodeType)try{return A.apply(f,ia.call(d.querySelectorAll(a),0)),f}catch(k){}else if(1===d.nodeType&&"object"!==d.nodeName.toLowerCase()){var l=d.getAttribute("id"),m=l||da,n=I.test(a)&&d.parentNode||d;l?m=m.replace(c,"\\$&"):d.setAttribute("id",m);try{return A.apply(f,ia.call(n.querySelectorAll(a.replace(z,"[id='"+m+"'] $&")),0)),f}catch(o){}finally{l||d.removeAttribute("id")}}return b(a,
d,f,g,h)};g&&(K(function(b){a=g.call(b,"div");try{g.call(b,"[test!='']:sizzle"),f.push(S.match.PSEUDO)}catch(c){}}),f=RegExp(f.join("|")),C.matchesSelector=function(b,c){c=c.replace(d,"='$1']");if(!Sa(b)&&!f.test(c)&&(!e||!e.test(c)))try{var h=g.call(b,c);if(h||a||b.document&&11!==b.document.nodeType)return h}catch(k){}return 0<C(c,null,null,[b]).length})}();C.attr=p.attr;p.find=C;p.expr=C.selectors;p.expr[":"]=p.expr.pseudos;p.unique=C.uniqueSort;p.text=C.getText;p.isXMLDoc=C.isXML;p.contains=C.contains})(a);
var Ab=/Until$/,Bb=/^(?:parents|prev(?:Until|All))/,yb=/^.[^:#\[\.,]*$/,nb=p.expr.match.needsContext,sa={children:!0,contents:!0,next:!0,prev:!0};p.fn.extend({find:function(a){var b,c,d,e,f,g,h=this;if("string"!=typeof a)return p(a).filter(function(){for(b=0,c=h.length;b<c;b++)if(p.contains(h[b],this))return!0});g=this.pushStack("","find",a);for(b=0,c=this.length;b<c;b++)if(d=g.length,p.find(a,this[b],g),0<b)for(e=d;e<g.length;e++)for(f=0;f<d;f++)if(g[f]===g[e]){g.splice(e--,1);break}return g},has:function(a){var b,
c=p(a,this),d=c.length;return this.filter(function(){for(b=0;b<d;b++)if(p.contains(this,c[b]))return!0})},not:function(a){return this.pushStack(l(this,a,!1),"not",a)},filter:function(a){return this.pushStack(l(this,a,!0),"filter",a)},is:function(a){return!!a&&("string"==typeof a?nb.test(a)?0<=p(a,this.context).index(this[0]):0<p.filter(a,this).length:0<this.filter(a).length)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=nb.test(a)||"string"!=typeof a?p(a,b||this.context):0;d<e;d++)for(c=
this[d];c&&c.ownerDocument&&c!==b&&11!==c.nodeType;){if(g?-1<g.index(c):p.find.matchesSelector(c,a)){f.push(c);break}c=c.parentNode}return f=1<f.length?p.unique(f):f,this.pushStack(f,"closest",a)},index:function(a){return a?"string"==typeof a?p.inArray(this[0],p(a)):p.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c="string"==typeof a?p(a,b):p.makeArray(a&&a.nodeType?[a]:a),d=p.merge(this.get(),c);return this.pushStack(h(c[0])||h(d[0])?d:
p.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});p.fn.andSelf=p.fn.addBack;p.each({parent:function(a){return(a=a.parentNode)&&11!==a.nodeType?a:null},parents:function(a){return p.dir(a,"parentNode")},parentsUntil:function(a,b,c){return p.dir(a,"parentNode",c)},next:function(a){return k(a,"nextSibling")},prev:function(a){return k(a,"previousSibling")},nextAll:function(a){return p.dir(a,"nextSibling")},prevAll:function(a){return p.dir(a,"previousSibling")},
nextUntil:function(a,b,c){return p.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return p.dir(a,"previousSibling",c)},siblings:function(a){return p.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return p.sibling(a.firstChild)},contents:function(a){return p.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:p.merge([],a.childNodes)}},function(a,b){p.fn[a]=function(c,d){var e=p.map(this,b,c);return Ab.test(a)||(d=c),d&&"string"==typeof d&&(e=p.filter(d,e)),e=1<this.length&&
!sa[a]?p.unique(e):e,1<this.length&&Bb.test(a)&&(e=e.reverse()),this.pushStack(e,a,S.call(arguments).join(","))}});p.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),1===b.length?p.find.matchesSelector(b[0],a)?[b[0]]:[]:p.find.matches(a,b)},dir:function(a,c,d){for(var e=[],a=a[c];a&&9!==a.nodeType&&(d===b||1!==a.nodeType||!p(a).is(d));)1===a.nodeType&&e.push(a),a=a[c];return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Ra="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",
Ya=/ jQuery\d+="(?:null|\d+)"/g,Y=/^\s+/,Za=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ta=/<([\w:]+)/,Ua=/<tbody/i,$a=/<|&#?\w+;/,ob=/<(?:script|style|link)/i,pb=/<(?:script|object|embed|option|style)/i,Oa=RegExp("<(?:"+Ra+")[\\s/>]","i"),pa=/^(?:checkbox|radio)$/,aa=/checked\s*(?:[^=]|=\s*.checked.)/i,qb=/\/(java|ecma)script/i,ab=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,la={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],
thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ca=m(G),ka=Ca.appendChild(G.createElement("div"));la.optgroup=la.option;la.tbody=la.tfoot=la.colgroup=la.caption=la.thead;la.th=la.td;p.support.htmlSerialize||(la._default=[1,"X<div>","</div>"]);p.fn.extend({text:function(a){return p.access(this,function(a){return a===
b?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||G).createTextNode(a))},null,a,arguments.length)},wrapAll:function(a){if(p.isFunction(a))return this.each(function(b){p(this).wrapAll(a.call(this,b))});if(this[0]){var b=p(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]);b.map(function(){for(var a=this;a.firstChild&&1===a.firstChild.nodeType;)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return p.isFunction(a)?this.each(function(b){p(this).wrapInner(a.call(this,
b))}):this.each(function(){var b=p(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=p.isFunction(a);return this.each(function(c){p(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,
!0,function(a){(1===this.nodeType||11===this.nodeType)&&this.insertBefore(a,this.firstChild)})},before:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(a,this),"before",this.selector)}},after:function(){if(!h(this[0]))return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=p.clean(arguments);return this.pushStack(p.merge(this,
a),"after",this.selector)}},remove:function(a,b){for(var c,d=0;null!=(c=this[d]);d++)if(!a||p.filter(a,[c]).length)!b&&1===c.nodeType&&(p.cleanData(c.getElementsByTagName("*")),p.cleanData([c])),c.parentNode&&c.parentNode.removeChild(c);return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)for(1===a.nodeType&&p.cleanData(a.getElementsByTagName("*"));a.firstChild;)a.removeChild(a.firstChild);return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return p.clone(this,
a,b)})},html:function(a){return p.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b)return 1===c.nodeType?c.innerHTML.replace(Ya,""):b;if("string"==typeof a&&!ob.test(a)&&(p.support.htmlSerialize||!Oa.test(a))&&(p.support.leadingWhitespace||!Y.test(a))&&!la[(Ta.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Za,"<$1></$2>");try{for(;d<e;d++)c=this[d]||{},1===c.nodeType&&(p.cleanData(c.getElementsByTagName("*")),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},
replaceWith:function(a){return h(this[0])?this.length?this.pushStack(p(p.isFunction(a)?a():a),"replaceWith",a):this:p.isFunction(a)?this.each(function(b){var c=p(this),d=c.html();c.replaceWith(a.call(this,b,d))}):("string"!=typeof a&&(a=p(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;p(this).remove();b?p(b).before(a):p(c).append(a)}))},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var a=[].concat.apply([],a),e,f,g,h=0,k=a[0],l=[],m=this.length;
if(!p.support.checkClone&&1<m&&"string"==typeof k&&aa.test(k))return this.each(function(){p(this).domManip(a,c,d)});if(p.isFunction(k))return this.each(function(e){var f=p(this);a[0]=k.call(this,e,c?f.html():b);f.domManip(a,c,d)});if(this[0]){e=p.buildFragment(a,this,l);g=e.fragment;f=g.firstChild;1===g.childNodes.length&&(g=f);if(f){c=c&&p.nodeName(f,"tr");for(e=e.cacheable||m-1;h<m;h++)d.call(c&&p.nodeName(this[h],"table")?this[h].getElementsByTagName("tbody")[0]||this[h].appendChild(this[h].ownerDocument.createElement("tbody")):
this[h],h===e?g:p.clone(g,!0,!0))}g=f=null;l.length&&p.each(l,function(a,b){b.src?p.ajax?p.ajax({url:b.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):p.error("no ajax"):p.globalEval((b.text||b.textContent||b.innerHTML||"").replace(ab,""));b.parentNode&&b.parentNode.removeChild(b)})}return this}});p.buildFragment=function(a,c,d){var e,f,g,h=a[0];return c=c||G,c=(c[0]||c).ownerDocument||c[0]||c,"undefined"==typeof c.createDocumentFragment&&(c=G),1===a.length&&"string"==typeof h&&
512>h.length&&c===G&&"<"===h.charAt(0)&&!pb.test(h)&&(p.support.checkClone||!aa.test(h))&&(p.support.html5Clone||!Oa.test(h))&&(f=!0,e=p.fragments[h],g=e!==b),e||(e=c.createDocumentFragment(),p.clean(a,c,e,d),f&&(p.fragments[h]=g&&e)),{fragment:e,cacheable:f}};p.fragments={};p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){p.fn[a]=function(c){var d,e=0,f=[],c=p(c),g=c.length,h=1===this.length&&this[0].parentNode;if((null==
h||h&&11===h.nodeType&&1===h.childNodes.length)&&1===g)return c[b](this[0]),this;for(;e<g;e++)d=(0<e?this.clone(!0):this).get(),p(c[e])[b](d),f=f.concat(d);return this.pushStack(f,a,c.selector)}});p.extend({clone:function(a,b,c){var d,e,f,g;p.support.html5Clone||p.isXMLDoc(a)||!Oa.test("<"+a.nodeName+">")?g=a.cloneNode(!0):(ka.innerHTML=a.outerHTML,ka.removeChild(g=ka.firstChild));if((!p.support.noCloneEvent||!p.support.noCloneChecked)&&(1===a.nodeType||11===a.nodeType)&&!p.isXMLDoc(a)){o(a,g);d=
q(a);e=q(g);for(f=0;d[f];++f)e[f]&&o(d[f],e[f])}if(b&&(n(a,g),c)){d=q(a);e=q(g);for(f=0;d[f];++f)n(d[f],e[f])}return g},clean:function(a,b,c,d){var e,f,g,h,k,l,n,o,N,y=0,q=[];if(!b||"undefined"==typeof b.createDocumentFragment)b=G;for(f=b===G&&Ca;null!=(g=a[y]);y++)if("number"==typeof g&&(g+=""),g){if("string"==typeof g)if($a.test(g)){for(f=f||m(b),l=l||f.appendChild(b.createElement("div")),g=g.replace(Za,"<$1></$2>"),h=(Ta.exec(g)||["",""])[1].toLowerCase(),k=la[h]||la._default,e=k[0],l.innerHTML=
k[1]+g+k[2];e--;)l=l.lastChild;if(!p.support.tbody){n=Ua.test(g);o="table"===h&&!n?l.firstChild&&l.firstChild.childNodes:"<table>"===k[1]&&!n?l.childNodes:[];for(e=o.length-1;0<=e;--e)p.nodeName(o[e],"tbody")&&!o[e].childNodes.length&&o[e].parentNode.removeChild(o[e])}!p.support.leadingWhitespace&&Y.test(g)&&l.insertBefore(b.createTextNode(Y.exec(g)[0]),l.firstChild);g=l.childNodes;l=f.lastChild}else g=b.createTextNode(g);g.nodeType?q.push(g):q=p.merge(q,g)}l&&(f.removeChild(l),g=l=f=null);if(!p.support.appendChecked)for(y=
0;null!=(g=q[y]);y++)p.nodeName(g,"input")?r(g):"undefined"!=typeof g.getElementsByTagName&&p.grep(g.getElementsByTagName("input"),r);if(c){a=function(a){if(!a.type||qb.test(a.type))return d?d.push(a.parentNode?a.parentNode.removeChild(a):a):c.appendChild(a)};for(y=0;null!=(g=q[y]);y++)if(!p.nodeName(g,"script")||!a(g))c.appendChild(g),"undefined"!=typeof g.getElementsByTagName&&(N=p.grep(p.merge([],g.getElementsByTagName("script")),a),q.splice.apply(q,[y+1,0].concat(N)),y+=N.length)}return q},cleanData:function(a,
b){for(var c,d,e,f,g=0,h=p.expando,k=p.cache,l=p.support.deleteExpando,m=p.event.special;null!=(e=a[g]);g++)if(b||p.acceptData(e))if(d=e[h],c=d&&k[d],c){if(c.events)for(f in c.events)m[f]?p.event.remove(e,f):p.removeEvent(e,f,c.handle);k[d]&&(delete k[d],l?delete e[h]:e.removeAttribute?e.removeAttribute(h):e[h]=null,p.deletedIds.push(d))}}});(function(){var a,b;p.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||
/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}};a=p.uaMatch(Z.userAgent);b={};a.browser&&(b[a.browser]=!0,b.version=a.version);b.webkit&&(b.safari=!0);p.browser=b;p.sub=function(){function a(b,c){return new a.fn.init(b,c)}p.extend(!0,a,this);a.superclass=this;a.fn=a.prototype=this();a.fn.constructor=a;a.sub=this.sub;a.fn.init=function(c,d){return d&&d instanceof p&&!(d instanceof a)&&(d=a(d)),p.fn.init.call(this,
c,d,b)};a.fn.init.prototype=a.fn;var b=a(G);return a}})();var ha,N,X,ia=/alpha\([^)]*\)/i,da=/opacity=([^)]*)/,qa=/^(top|right|bottom|left)$/,ta=/^margin/,ja=RegExp("^("+ma+")(.*)$","i"),fa=RegExp("^("+ma+")(?!px)[a-z%]+$","i"),bb=RegExp("^([-+])=("+ma+")","i"),Na={},Pb={position:"absolute",visibility:"hidden",display:"block"},Cb={letterSpacing:0,fontWeight:400,lineHeight:1},Ba=["Top","Right","Bottom","Left"],Sa=["Webkit","O","Moz","ms"],Qb=p.fn.toggle;p.fn.extend({css:function(a,c){return p.access(this,
function(a,c,d){return d!==b?p.style(a,c,d):p.css(a,c)},a,c,1<arguments.length)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a,b){var c="boolean"==typeof a;return p.isFunction(a)&&p.isFunction(b)?Qb.apply(this,arguments):this.each(function(){(c?a:w(this))?p(this).show():p(this).hide()})}});p.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=ha(a,"opacity");return""===c?"1":c}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,
widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":p.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(a&&!(3===a.nodeType||8===a.nodeType||!a.style)){var f,g,h,k=p.camelCase(c),l=a.style;c=p.cssProps[k]||(p.cssProps[k]=u(l,k));h=p.cssHooks[c]||p.cssHooks[k];if(d===b)return h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:l[c];g=typeof d;"string"===g&&(f=bb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(p.css(a,c)),g="number");if(!(null==d||"number"===g&&isNaN(d)))if("number"===g&&!p.cssNumber[k]&&(d+=
"px"),!h||!("set"in h)||(d=h.set(a,d,e))!==b)try{l[c]=d}catch(m){}}},css:function(a,c,d,e){var f,g,h,k=p.camelCase(c);return c=p.cssProps[k]||(p.cssProps[k]=u(a.style,k)),h=p.cssHooks[c]||p.cssHooks[k],h&&"get"in h&&(f=h.get(a,!0,e)),f===b&&(f=ha(a,c)),"normal"===f&&c in Cb&&(f=Cb[c]),d||e!==b?(g=parseFloat(f),d||p.isNumeric(g)?g||0:f):f},swap:function(a,b,c){var d,e={};for(d in b)e[d]=a.style[d],a.style[d]=b[d];c=c.call(a);for(d in b)a.style[d]=e[d];return c}});a.getComputedStyle?ha=function(a,b){var c,
d,e,f,g=getComputedStyle(a,null),h=a.style;return g&&(c=g[b],""===c&&!p.contains(a.ownerDocument.documentElement,a)&&(c=p.style(a,b)),fa.test(c)&&ta.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=c,c=g.width,h.width=d,h.minWidth=e,h.maxWidth=f)),c}:G.documentElement.currentStyle&&(ha=function(a,b){var c,d,e=a.currentStyle&&a.currentStyle[b],f=a.style;return null==e&&f&&f[b]&&(e=f[b]),fa.test(e)&&!qa.test(b)&&(c=f.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=
a.currentStyle.left),f.left="fontSize"===b?"1em":e,e=f.pixelLeft+"px",f.left=c,d&&(a.runtimeStyle.left=d)),""===e?"auto":e});p.each(["height","width"],function(a,b){p.cssHooks[b]={get:function(a,c,d){if(c)return 0!==a.offsetWidth||"none"!==ha(a,"display")?D(a,b,d):p.swap(a,Pb,function(){return D(a,b,d)})},set:function(a,c,d){return x(a,c,d?z(a,b,d,p.support.boxSizing&&"border-box"===p.css(a,"boxSizing")):0)}}});p.support.opacity||(p.cssHooks.opacity={get:function(a,b){return da.test((b&&a.currentStyle?
a.currentStyle.filter:a.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=p.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1;if(1<=b&&""===p.trim(f.replace(ia,""))&&c.removeAttribute&&(c.removeAttribute("filter"),d&&!d.filter))return;c.filter=ia.test(f)?f.replace(ia,e):f+" "+e}});p(function(){p.support.reliableMarginRight||(p.cssHooks.marginRight={get:function(a,b){return p.swap(a,{display:"inline-block"},function(){if(b)return ha(a,
"marginRight")})}});!p.support.pixelPosition&&p.fn.position&&p.each(["top","left"],function(a,b){p.cssHooks[b]={get:function(a,c){if(c){var d=ha(a,b);return fa.test(d)?p(a).position()[b]+"px":d}}}})});p.expr&&p.expr.filters&&(p.expr.filters.hidden=function(a){return 0===a.offsetWidth&&0===a.offsetHeight||!p.support.reliableHiddenOffsets&&"none"===(a.style&&a.style.display||ha(a,"display"))},p.expr.filters.visible=function(a){return!p.expr.filters.hidden(a)});p.each({margin:"",padding:"",border:"Width"},
function(a,b){p.cssHooks[a+b]={expand:function(c){for(var d="string"==typeof c?c.split(" "):[c],e={},c=0;4>c;c++)e[a+Ba[c]+b]=d[c]||d[c-2]||d[0];return e}};ta.test(a)||(p.cssHooks[a+b].set=x)});var Db=/%20/g,Wa=/\[\]$/,cb=/\r?\n/g,Rb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Sb=/^(?:select|textarea)/i;p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?
p.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Sb.test(this.nodeName)||Rb.test(this.type))}).map(function(a,b){var c=p(this).val();return null==c?null:p.isArray(c)?p.map(c,function(a){return{name:b.name,value:a.replace(cb,"\r\n")}}):{name:b.name,value:c.replace(cb,"\r\n")}}).get()}});p.param=function(a,c){var d,e=[],f=function(a,b){b=p.isFunction(b)?b():null==b?"":b;e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=p.ajaxSettings&&
p.ajaxSettings.traditional);if(p.isArray(a)||a.jquery&&!p.isPlainObject(a))p.each(a,function(){f(this.name,this.value)});else for(d in a)C(d,a[d],c,f);return e.join("&").replace(Db,"+")};var Pa,Qa,Tb=/#.*$/,Ub=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Vb=/^(?:GET|HEAD)$/,Wb=/^\/\//,Fb=/\?/,Xb=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Yb=/([?&])_=[^&]*/,Gb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Hb=p.fn.load,zb={},Ib={},Jb=["*/"]+["*"];try{Pa=ba.href}catch(ec){Pa=G.createElement("a"),Pa.href=
"",Pa=Pa.href}Qa=Gb.exec(Pa.toLowerCase())||[];p.fn.load=function(a,c,d){if("string"!=typeof a&&Hb)return Hb.apply(this,arguments);if(!this.length)return this;var e,f,g,h=this,k=a.indexOf(" ");return 0<=k&&(e=a.slice(k,a.length),a=a.slice(0,k)),p.isFunction(c)?(d=c,c=b):"object"==typeof c&&(f="POST"),p.ajax({url:a,type:f,dataType:"html",data:c,complete:function(a,b){d&&h.each(d,g||[a.responseText,b,a])}}).done(function(a){g=arguments;h.html(e?p("<div>").append(a.replace(Xb,"")).find(e):a)}),this};
p.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(a,b){p.fn[b]=function(a){return this.on(b,a)}});p.each(["get","post"],function(a,c){p[c]=function(a,d,e,f){return p.isFunction(d)&&(f=f||e,e=d,d=b),p.ajax({type:c,url:a,data:d,success:e,dataType:f})}});p.extend({getScript:function(a,c){return p.get(a,b,c,"script")},getJSON:function(a,b,c){return p.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?F(a,p.ajaxSettings):(b=a,a=p.ajaxSettings),F(a,b),a},ajaxSettings:{url:Pa,
isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(Qa[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Jb},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},
flatOptions:{context:!0,url:!0}},ajaxPrefilter:A(zb),ajaxTransport:A(Ib),ajax:function(a,c){function d(a,c,g,l){var n,y,A,da,F,x=c;if(2!==B){B=2;k&&clearTimeout(k);h=b;f=l||"";u.readyState=0<a?4:0;if(g){var qa;da=o;var l=u,ja,z,w,v,I=da.contents,ta=da.dataTypes,E=da.responseFields;for(z in E)z in g&&(l[E[z]]=g[z]);for(;"*"===ta[0];)ta.shift(),ja===b&&(ja=da.mimeType||l.getResponseHeader("content-type"));if(ja)for(z in I)if(I[z]&&I[z].test(ja)){ta.unshift(z);break}if(ta[0]in g)w=ta[0];else{for(z in g){if(!ta[0]||
da.converters[z+" "+ta[0]]){w=z;break}v||(v=z)}w=w||v}w&&(qa=(w!==ta[0]&&ta.unshift(w),g[w]));da=qa}if(200<=a&&300>a||304===a)if(o.ifModified&&(F=u.getResponseHeader("Last-Modified"),F&&(p.lastModified[e]=F),F=u.getResponseHeader("Etag"),F&&(p.etag[e]=F)),304===a)x="notmodified",n=!0;else{var fa;a:{g=o;y=da;var L;qa=g.dataTypes.slice();ja=qa[0];z={};w=0;g.dataFilter&&(y=g.dataFilter(y,g.dataType));if(qa[1])for(fa in g.converters)z[fa.toLowerCase()]=g.converters[fa];for(;F=qa[++w];)if("*"!==F){if("*"!==
ja&&ja!==F){fa=z[ja+" "+F]||z["* "+F];if(!fa)for(L in z)if(x=L.split(" "),x[1]===F&&(fa=z[ja+" "+x[0]]||z["* "+x[0]])){!0===fa?fa=z[L]:!0!==z[L]&&(F=x[0],qa.splice(w--,0,F));break}if(!0!==fa)if(fa&&g["throws"])y=fa(y);else try{y=fa(y)}catch(M){fa={state:"parsererror",error:fa?M:"No conversion from "+ja+" to "+F};break a}}ja=F}fa={state:"success",data:y}}n=fa;x=n.state;y=n.data;A=n.error;n=!A}else if(A=x,!x||a)x="error",0>a&&(a=0);u.status=a;u.statusText=""+(c||x);n?X.resolveWith(N,[y,x,u]):X.rejectWith(N,
[u,x,A]);u.statusCode(ia);ia=b;m&&q.trigger("ajax"+(n?"Success":"Error"),[u,o,n?y:A]);r.fireWith(N,[u,x]);m&&(q.trigger("ajaxComplete",[u,o]),--p.active||p.event.trigger("ajaxStop"))}}"object"==typeof a&&(c=a,a=b);c=c||{};var e,f,g,h,k,l,m,n,o=p.ajaxSetup({},c),N=o.context||o,q=N!==o&&(N.nodeType||N instanceof p)?p(N):p.event,X=p.Deferred(),r=p.Callbacks("once memory"),ia=o.statusCode||{},A={},da={},B=0,F="canceled",u={readyState:0,setRequestHeader:function(a,b){if(!B){var c=a.toLowerCase();a=da[c]=
da[c]||a;A[a]=b}return this},getAllResponseHeaders:function(){return 2===B?f:null},getResponseHeader:function(a){var c;if(2===B){if(!g)for(g={};c=Ub.exec(f);)g[c[1].toLowerCase()]=c[2];c=g[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){return B||(o.mimeType=a),this},abort:function(a){return a=a||F,h&&h.abort(a),d(0,a),this}};X.promise(u);u.success=u.done;u.error=u.fail;u.complete=r.add;u.statusCode=function(a){if(a){var b;if(2>B)for(b in a)ia[b]=[ia[b],a[b]];else b=a[u.status],
u.always(b)}return this};o.url=((a||o.url)+"").replace(Tb,"").replace(Wb,Qa[1]+"//");o.dataTypes=p.trim(o.dataType||"*").toLowerCase().split(na);null==o.crossDomain&&(l=Gb.exec(o.url.toLowerCase()),o.crossDomain=!(!l||l[1]==Qa[1]&&l[2]==Qa[2]&&(l[3]||("http:"===l[1]?80:443))==(Qa[3]||("http:"===Qa[1]?80:443))));o.data&&o.processData&&"string"!=typeof o.data&&(o.data=p.param(o.data,o.traditional));y(zb,o,c,u);if(2===B)return u;m=o.global;o.type=o.type.toUpperCase();o.hasContent=!Vb.test(o.type);m&&
0===p.active++&&p.event.trigger("ajaxStart");if(!o.hasContent&&(o.data&&(o.url+=(Fb.test(o.url)?"&":"?")+o.data,delete o.data),e=o.url,!1===o.cache)){l=p.now();var x=o.url.replace(Yb,"$1_="+l);o.url=x+(x===o.url?(Fb.test(o.url)?"&":"?")+"_="+l:"")}(o.data&&o.hasContent&&!1!==o.contentType||c.contentType)&&u.setRequestHeader("Content-Type",o.contentType);o.ifModified&&(e=e||o.url,p.lastModified[e]&&u.setRequestHeader("If-Modified-Since",p.lastModified[e]),p.etag[e]&&u.setRequestHeader("If-None-Match",
p.etag[e]));u.setRequestHeader("Accept",o.dataTypes[0]&&o.accepts[o.dataTypes[0]]?o.accepts[o.dataTypes[0]]+("*"!==o.dataTypes[0]?", "+Jb+"; q=0.01":""):o.accepts["*"]);for(n in o.headers)u.setRequestHeader(n,o.headers[n]);if(!o.beforeSend||!1!==o.beforeSend.call(N,u,o)&&2!==B){F="abort";for(n in{success:1,error:1,complete:1})u[n](o[n]);if(h=y(Ib,o,c,u)){u.readyState=1;m&&q.trigger("ajaxSend",[u,o]);o.async&&0<o.timeout&&(k=setTimeout(function(){u.abort("timeout")},o.timeout));try{B=1,h.send(A,d)}catch(qa){if(2>
B)d(-1,qa);else throw qa;}}else d(-1,"No Transport");return u}return u.abort()},active:0,lastModified:{},etag:{}});var Kb=[],Zb=/\?/,rb=/(=)\?(?=&|$)|\?\?/,$b=p.now();p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Kb.pop()||p.expando+"_"+$b++;return this[a]=!0,a}});p.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,k=c.data,l=c.url,m=!1!==c.jsonp,n=m&&rb.test(l),o=m&&!n&&"string"==typeof k&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&rb.test(k);if("jsonp"===
c.dataTypes[0]||n||o)return f=c.jsonpCallback=p.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,g=a[f],n?c.url=l.replace(rb,"$1"+f):o?c.data=k.replace(rb,"$1"+f):m&&(c.url+=(Zb.test(l)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||p.error(f+" was not called"),h[0]},c.dataTypes[0]="json",a[f]=function(){h=arguments},e.always(function(){a[f]=g;c[f]&&(c.jsonpCallback=d.jsonpCallback,Kb.push(f));h&&p.isFunction(g)&&g(h[0]);h=g=b}),"script"});p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},
contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return p.globalEval(a),a}}});p.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1);a.crossDomain&&(a.type="GET",a.global=!1)});p.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=G.head||G.getElementsByTagName("head")[0]||G.documentElement;return{send:function(e,f){c=G.createElement("script");c.async="async";a.scriptCharset&&(c.charset=a.scriptCharset);c.src=a.url;c.onload=c.onreadystatechange=function(a,
e){if(e||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=b,e||f(200,"success")};d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var Va,Eb=a.ActiveXObject?function(){for(var a in Va)Va[a](0,1)}:!1,ac=0;p.ajaxSettings.xhr=a.ActiveXObject?function(){var b;if(!(b=!this.isLocal&&B()))a:{try{b=new a.ActiveXObject("Microsoft.XMLHTTP");break a}catch(c){}b=void 0}return b}:B;(function(a){p.extend(p.support,{ajax:!!a,
cors:!!a&&"withCredentials"in a})})(p.ajaxSettings.xhr());p.support.ajax&&p.ajaxTransport(function(c){if(!c.crossDomain||p.support.cors){var d;return{send:function(e,f){var g,h,k=c.xhr();c.username?k.open(c.type,c.url,c.async,c.username,c.password):k.open(c.type,c.url,c.async);if(c.xhrFields)for(h in c.xhrFields)k[h]=c.xhrFields[h];c.mimeType&&k.overrideMimeType&&k.overrideMimeType(c.mimeType);!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(h in e)k.setRequestHeader(h,
e[h])}catch(l){}k.send(c.hasContent&&c.data||null);d=function(a,e){var h,l,m,n,o;try{if(d&&(e||4===k.readyState))if(d=b,g&&(k.onreadystatechange=p.noop,Eb&&delete Va[g]),e)4!==k.readyState&&k.abort();else{h=k.status;m=k.getAllResponseHeaders();n={};o=k.responseXML;o&&o.documentElement&&(n.xml=o);try{n.text=k.responseText}catch(N){}try{l=k.statusText}catch(y){l=""}!h&&c.isLocal&&!c.crossDomain?h=n.text?200:404:1223===h&&(h=204)}}catch(q){e||f(-1,q)}n&&f(h,l,n,m)};c.async?4===k.readyState?setTimeout(d,
0):(g=++ac,Eb&&(Va||(Va={},p(a).unload(Eb)),Va[g]=d),k.onreadystatechange=d):d()},abort:function(){d&&d(0,1)}}}});var lb,sb,bc=/^(?:toggle|show|hide)$/,cc=RegExp("^(?:([-+])=|)("+ma+")([a-z%]*)$","i"),dc=/queueHooks$/,mb=[function(a,b,c){var d,e,f,g,h,k,l=this,m=a.style,n={},o=[],N=a.nodeType&&w(a);c.queue||(h=p._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,k=h.empty.fire,h.empty.fire=function(){h.unqueued||k()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--;p.queue(a,"fx").length||
h.empty.fire()})}));1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===p.css(a,"display")&&"none"===p.css(a,"float")&&(!p.support.inlineBlockNeedsLayout||"inline"===H(a.nodeName)?m.display="inline-block":m.zoom=1));c.overflow&&(m.overflow="hidden",p.support.shrinkWrapBlocks||l.done(function(){m.overflow=c.overflow[0];m.overflowX=c.overflow[1];m.overflowY=c.overflow[2]}));for(d in b)f=b[d],bc.exec(f)&&(delete b[d],f!==(N?"hide":"show")&&o.push(d));
if(b=o.length){f=p._data(a,"fxshow")||p._data(a,"fxshow",{});N?p(a).show():l.done(function(){p(a).hide()});l.done(function(){var b;p.removeData(a,"fxshow",!0);for(b in n)p.style(a,b,n[b])});for(d=0;d<b;d++)e=o[d],g=l.createTween(e,N?f[e]:0),n[e]=f[e]||p.style(a,e),e in f||(f[e]=g.start,N&&(g.end=g.start,g.start="width"===e||"height"===e?1:0))}}],Xa={"*":[function(a,b){var c,d,e,f=this.createTween(a,b),g=cc.exec(b),h=f.cur(),k=+h||0,l=1;if(g){c=+g[2];d=g[3]||(p.cssNumber[a]?"":"px");if("px"!==d&&k){k=
p.css(f.elem,a,!0)||c||1;do e=l=l||".5",k/=l,p.style(f.elem,a,k+d),l=f.cur()/h;while(1!==l&&l!==e)}f.unit=d;f.start=k;f.end=g[1]?k+(g[1]+1)*c:c}return f}]};p.Animation=p.extend(M,{tweener:function(a,b){p.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;d<e;d++)c=a[d],Xa[c]=Xa[c]||[],Xa[c].unshift(b)},prefilter:function(a,b){b?mb.unshift(a):mb.push(a)}});p.Tween=K;K.prototype={constructor:K,init:function(a,b,c,d,e,f){this.elem=a;this.prop=c;this.easing=e||"swing";this.options=b;
this.start=this.now=this.cur();this.end=d;this.unit=f||(p.cssNumber[c]?"":"px")},cur:function(){var a=K.propHooks[this.prop];return a&&a.get?a.get(this):K.propHooks._default.get(this)},run:function(a){var b,c=K.propHooks[this.prop];return this.pos=b=p.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration),this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):K.propHooks._default.set(this),this}};K.prototype.init.prototype=
K.prototype;K.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=p.css(a.elem,a.prop,!1,""),!b||"auto"===b?0:b):a.elem[a.prop]},set:function(a){p.fx.step[a.prop]?p.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[p.cssProps[a.prop]]||p.cssHooks[a.prop])?p.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}};K.propHooks.scrollTop=K.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}};
p.each(["toggle","show","hide"],function(a,b){var c=p.fn[b];p.fn[b]=function(d,e,f){return null==d||"boolean"==typeof d||!a&&p.isFunction(d)&&p.isFunction(e)?c.apply(this,arguments):this.animate(O(b,!0),d,e,f)}});p.fn.extend({fadeTo:function(a,b,c,d){return this.filter(w).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=p.isEmptyObject(a),f=p.speed(b,c,d),b=function(){var b=M(this,p.extend({},a),f);e&&b.stop(!0)};return e||!1===f.queue?this.each(b):this.queue(f.queue,
b)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop;b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&!1!==a&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=p.timers,g=p._data(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&dc.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem===this&&(null==a||f[c].queue===a)&&(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&p.dequeue(this,a)})}});p.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),
fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){p.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}});p.speed=function(a,b,c){var d=a&&"object"==typeof a?p.extend({},a):{complete:c||!c&&b||p.isFunction(a)&&a,duration:a,easing:c&&b||b&&!p.isFunction(b)&&b};d.duration=p.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in p.fx.speeds?p.fx.speeds[d.duration]:p.fx.speeds._default;if(null==d.queue||!0===d.queue)d.queue="fx";return d.old=d.complete,
d.complete=function(){p.isFunction(d.old)&&d.old.call(this);d.queue&&p.dequeue(this,d.queue)},d};p.easing={linear:function(a){return a},swing:function(a){return 0.5-Math.cos(a*Math.PI)/2}};p.timers=[];p.fx=K.prototype.init;p.fx.tick=function(){for(var a,b=p.timers,c=0;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||p.fx.stop()};p.fx.timer=function(a){a()&&p.timers.push(a)&&!sb&&(sb=setInterval(p.fx.tick,p.fx.interval))};p.fx.interval=13;p.fx.stop=function(){clearInterval(sb);sb=null};
p.fx.speeds={slow:600,fast:200,_default:400};p.fx.step={};p.expr&&p.expr.filters&&(p.expr.filters.animated=function(a){return p.grep(p.timers,function(b){return a===b.elem}).length});var Lb=/^(?:body|html)$/i;p.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){p.offset.setOffset(this,a,b)});var c,d,e,f,g,h,k,l,m,n,o=this[0],N=o&&o.ownerDocument;return!N?void 0:(e=N.body)===o?p.offset.bodyOffset(o):(d=N.documentElement,p.contains(d,o)?(c=o.getBoundingClientRect(),f=
Q(N),g=d.clientTop||e.clientTop||0,h=d.clientLeft||e.clientLeft||0,k=f.pageYOffset||d.scrollTop,l=f.pageXOffset||d.scrollLeft,m=c.top+k-g,n=c.left+l-h,{top:m,left:n}):{top:0,left:0})};p.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return p.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(p.css(a,"marginTop"))||0,c+=parseFloat(p.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=p.css(a,"position");"static"===d&&(a.style.position="relative");var e=p(a),
f=e.offset(),g=p.css(a,"top"),h=p.css(a,"left"),k={},l={},m,n;("absolute"===d||"fixed"===d)&&-1<p.inArray("auto",[g,h])?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(g)||0,n=parseFloat(h)||0);p.isFunction(b)&&(b=b.call(a,c,f));null!=b.top&&(k.top=b.top-f.top+m);null!=b.left&&(k.left=b.left-f.left+n);"using"in b?b.using.call(a,k):e.css(k)}};p.fn.extend({position:function(){if(this[0]){var a=this[0],b=this.offsetParent(),c=this.offset(),d=Lb.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=
parseFloat(p.css(a,"marginTop"))||0,c.left-=parseFloat(p.css(a,"marginLeft"))||0,d.top+=parseFloat(p.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(p.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||G.body;a&&!Lb.test(a.nodeName)&&"static"===p.css(a,"position");)a=a.offsetParent;return a||G.body})}});p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,c){var d=/Y/.test(c);p.fn[a]=
function(e){return p.access(this,function(a,e,f){var g=Q(a);if(f===b)return g?c in g?g[c]:g.document.documentElement[e]:a[e];g?g.scrollTo(d?p(g).scrollLeft():f,d?f:p(g).scrollTop()):a[e]=f},a,e,arguments.length,null)}});p.each({Height:"height",Width:"width"},function(a,c){p.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){p.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(!0===e||!0===f?"margin":"border");return p.access(this,function(c,d,e){var f;return p.isWindow(c)?
c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?p.css(c,d,e,h):p.style(c,d,e,h)},c,g?e:b,g)}})});a.jQuery=a.$=p;"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return p})})(window);(function(a){var b=/[\.\/]/,c=function(){},d=function(a,b){return a-b},e,f,g={n:{}},h=function(a,b){var c=f,g=Array.prototype.slice.call(arguments,2),o=h.listeners(a),q=0,r,u=[],w={},v=[];e=a;f=0;for(var x=0,z=o.length;x<z;x++)"zIndex"in o[x]&&(u.push(o[x].zIndex),0>o[x].zIndex&&(w[o[x].zIndex]=o[x]));for(u.sort(d);0>u[q];)if(r=w[u[q++]],v.push(r.apply(b,g)),f)return f=c,v;for(x=0;x<z;x++)if(r=o[x],"zIndex"in r)if(r.zIndex==u[q]){v.push(r.apply(b,g));if(f)return f=c,v;do if(q++,r=w[u[q]],r&&v.push(r.apply(b,
g)),f)return f=c,v;while(r)}else w[r.zIndex]=r;else if(v.push(r.apply(b,g)),f)return f=c,v;f=c;return v.length?v:null};h.listeners=function(a){var a=a.split(b),c=g,d,e,f,h,r,u,w,v,x=[c],z=[];for(h=0,r=a.length;h<r;h++){v=[];for(u=0,w=x.length;u<w;u++)for(c=x[u].n,e=[c[a[h]],c["*"]],f=2;f--;)d=e[f],d&&(v.push(d),z=z.concat(d.f||[]));x=v}return z};h.on=function(a,d){for(var e=a.split(b),f=g,h=0,q=e.length;h<q;h++)f=f.n,!f[e[h]]&&(f[e[h]]={n:{}}),f=f[e[h]];f.f=f.f||[];for(h=0,q=f.f.length;h<q;h++)if(f.f[h]==
d)return c;f.f.push(d);return function(a){+a==+a&&(d.zIndex=+a)}};h.stop=function(){f=1};h.nt=function(a){return a?RegExp("(?:\\.|\\/|^)"+a+"(?:\\.|\\/|$)").test(e):e};h.unbind=function(a,c){for(var d=a.split(b),e,f,h,r=[g],u=0,w=d.length;u<w;u++)for(var v=0;v<r.length;v+=h.length-2){h=[v,1];e=r[v].n;if("*"!=d[u])e[d[u]]&&h.push(e[d[u]]);else for(f in e)e.hasOwnProperty(f)&&h.push(e[f]);r.splice.apply(r,h)}for(u=0,w=r.length;u<w;u++)for(e=r[u];e.n;){if(c){if(e.f){for(v=0,jj=e.f.length;v<jj;v++)if(e.f[v]==
c){e.f.splice(v,1);break}!e.f.length&&delete e.f}for(f in e.n)if(e.n.hasOwnProperty(f)&&e.n[f].f){d=e.n[f].f;for(v=0,jj=d.length;v<jj;v++)if(d[v]==c){d.splice(v,1);break}!d.length&&delete e.n[f].f}}else for(f in delete e.f,e.n)e.n.hasOwnProperty(f)&&e.n[f].f&&delete e.n[f].f;e=e.n}};h.version="0.3.2";h.toString=function(){return"You are running Eve 0.3.2"};"undefined"!=typeof module&&module.exports?module.exports=h:a.eve=h})(this);
(function(){function a(a,b,d,f,g,h){var d=J(d),l,n,o,p,r,B,F=a.ms,u={},x={},z={};if(f)for(v=0,I=aa.length;v<I;v++){var w=aa[v];if(w.el.id==b.id&&w.anim==a){w.percent!=d?(aa.splice(v,1),o=1):n=w;b.attr(w.totalOrigin);break}}else f=+x;for(var v=0,I=a.percents.length;v<I;v++){if(a.percents[v]==d||a.percents[v]>f*a.top){d=a.percents[v];r=a.percents[v-1]||0;F=F/a.top*(d-r);p=a.percents[v+1];l=a.anim[d];break}f&&b.attr(a.anim[a.percents[v]])}if(l){if(n)n.initstatus=f,n.start=new Date-n.ms*f;else{for(attr in l)if(l[q](attr)&&
(ua[q](attr)||b.paper.customAttributes[q](attr)))switch(u[attr]=b.attr(attr),null==u[attr]&&(u[attr]=ea[attr]),x[attr]=l[attr],ua[attr]){case T:z[attr]=(x[attr]-u[attr])/F;break;case "colour":u[attr]=k.getRGB(u[attr]);v=k.getRGB(x[attr]);z[attr]={r:(v.r-u[attr].r)/F,g:(v.g-u[attr].g)/F,b:(v.b-u[attr].b)/F};break;case "path":var v=za(u[attr],x[attr]),E=v[1];u[attr]=v[0];z[attr]=[];for(v=0,I=u[attr].length;v<I;v++){z[attr][v]=[0];for(var L=1,M=u[attr][v].length;L<M;L++)z[attr][v][L]=(E[v][L]-u[attr][v][L])/
F}break;case "transform":v=b._;if(E=vb(v[attr],x[attr])){u[attr]=E.from;x[attr]=E.to;z[attr]=[];z[attr].real=!0;for(v=0,I=u[attr].length;v<I;v++){z[attr][v]=[u[attr][v][0]];for(L=1,M=u[attr][v].length;L<M;L++)z[attr][v][L]=(x[attr][v][L]-u[attr][v][L])/F}}else E=b.matrix||new e,v={_:{transform:v.transform},getBBox:function(){return b.getBBox(1)}},u[attr]=[E.a,E.b,E.c,E.d,E.e,E.f],ub(v,x[attr]),x[attr]=v._.transform,z[attr]=[(v.matrix.a-E.a)/F,(v.matrix.b-E.b)/F,(v.matrix.c-E.c)/F,(v.matrix.d-E.d)/
F,(v.matrix.e-E.e)/F,(v.matrix.e-E.f)/F];break;case "csv":E=A(l[attr])[y](m);I=A(u[attr])[y](m);if("clip-rect"==attr)for(u[attr]=I,z[attr]=[],v=I.length;v--;)z[attr][v]=(E[v]-u[attr][v])/F;x[attr]=E;break;default:for(E=[][D](l[attr]),I=[][D](u[attr]),z[attr]=[],v=b.paper.customAttributes[attr].length;v--;)z[attr][v]=((E[v]||0)-(I[v]||0))/F}v=l.easing;E=k.easing_formulas[v];if(!E)if((E=A(v).match(P))&&5==E.length)var U=E,E=function(a){return c(a,+U[1],+U[2],+U[3],+U[4],F)};else E=wb;B=l.start||a.start||
+new Date;w={anim:a,percent:d,timestamp:B,start:B+(a.del||0),status:0,initstatus:f||0,stop:!1,ms:F,easing:E,from:u,diff:z,to:x,el:b,callback:l.callback,prev:r,next:p,repeat:h||a.times,origin:b.attr(),totalOrigin:g};aa.push(w);if(f&&!n&&!o&&(w.stop=!0,w.start=new Date-F*f,1==aa.length))return ab();o&&(w.start=new Date-w.ms*f);1==aa.length&&qb(ab)}eve("anim.start."+b.id,b,a)}}function b(a,b){var c=[],d={};this.ms=b;this.times=1;if(a){for(var e in a)a[q](e)&&(d[J(e)]=a[e],c.push(J(e)));c.sort(jb)}this.anim=
d;this.top=c[c.length-1];this.percents=c}function c(a,b,c,d,e,f){function g(a,b){var c,d,e,f;for(e=a,d=0;8>d;d++){f=((l*e+k)*e+h)*e-a;if(K(f)<b)return e;c=(3*l*e+2*k)*e+h;if(1.0E-6>K(c))break;e-=f/c}c=0;d=1;e=a;if(e<c)return c;if(e>d)return d;for(;c<d;){f=((l*e+k)*e+h)*e;if(K(f-a)<b)break;a>f?c=e:d=e;e=(d-c)/2+c}return e}var h=3*b,k=3*(d-b)-h,l=1-h-k,m=3*c,n=3*(e-c)-m,o=1-m-n;return function(a,b){var c=g(a,b);return((o*c+n)*c+m)*c}(a,1/(200*f))}function d(){return this.x+C+this.y+C+this.width+" \u00d7 "+
this.height}function e(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function f(a){for(var b=[],c=0,d=a.length;d-2>c;c+=2){var e=[{x:+a[c],y:+a[c+1]},{x:+a[c],y:+a[c+1]},{x:+a[c+2],y:+a[c+3]},{x:+a[c+4],y:+a[c+5]}];d-4==c?(e[0]={x:+a[c-2],y:+a[c-1]},e[3]=e[2]):c&&(e[0]={x:+a[c-2],y:+a[c-1]});b.push(["C",(-e[0].x+6*e[1].x+e[2].x)/6,(-e[0].y+6*e[1].y+e[2].y)/6,(e[1].x+6*e[2].x-e[3].x)/6,(e[1].y+6*e[2].y-e[3].y)/
6,e[2].x,e[2].y])}return b}function g(){return this.hex}function h(a,b,c){function d(){var e=Array.prototype.slice.call(arguments,0),f=e.join("\u2400"),g=d.cache=d.cache||{},h=d.count=d.count||[];if(g[q](f)){a:for(var e=h,h=f,k=0,l=e.length;k<l;k++)if(e[k]===h){e.push(e.splice(k,1)[0]);break a}return c?c(g[f]):g[f]}1E3<=h.length&&delete g[h.shift()];h.push(f);g[f]=a[z](b,e);return c?c(g[f]):g[f]}return d}function k(a){if(k.is(a,"function"))return l?a():eve.on("DOMload",a);if(k.is(a,R)){for(var b=
a,c=k._engine.create[z](k,b.splice(0,3+k.is(b[0],T))),d=c.set(),e=0,f=b.length,g;e<f;e++)g=b[e]||{},n[q](g.type)&&d.push(c[g.type]().attr(g));return d}var h=Array.prototype.slice.call(arguments,0);if(k.is(h[h.length-1],"function")){var m=h.pop();return l?m.call(k._engine.create[z](k,h)):eve.on("DOMload",function(){m.call(k._engine.create[z](k,h))})}return k._engine.create[z](k,arguments)}k.version="2.0.0";k.eve=eve;var l,m=/[, ]+/,n={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},o=/\{(\d+)\}/g,
q="hasOwnProperty",r={doc:document,win:window},u=Object.prototype[q].call(r.win,"Raphael"),w=r.win.Raphael,v=function(){this.ca=this.customAttributes={}},x,z="apply",D="concat",H="createTouch"in r.doc,C=" ",A=String,y="split",F="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[y](C),B={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},I=A.prototype.toLowerCase,E=Math,M=E.max,L=E.min,K=E.abs,O=E.pow,Q=E.PI,T="number",R="array",
G=Object.prototype.toString;k._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i;var ba=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i,Z={NaN:1,Infinity:1,"-Infinity":1},P=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,U=E.round,J=parseFloat,S=
parseInt,ra=A.prototype.toUpperCase,ea=k._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/",opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,
"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},ua=k._availableAnimAttrs={blur:T,"clip-rect":"csv",cx:T,cy:T,fill:"colour","fill-opacity":T,"font-size":T,height:T,opacity:T,path:"path",r:T,rx:T,ry:T,stroke:"colour","stroke-opacity":T,"stroke-width":T,transform:"transform",width:T,x:T,y:T},va=/\s*,\s*/,p={hs:1,rg:1},ma=/,?([achlmqrstvxz]),?/gi,La=/([achlmrqstvz])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,na=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?\s*,?\s*)+)/ig,
ib=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)\s*,?\s*/ig;k._radial_gradient=/^r(?:\(([^,]+?)\s*,\s*([^\)]+?)\))?/;var Ma={},jb=function(a,b){return J(a)-J(b)},xb=function(){},wb=function(a){return a},Aa=k._rectPath=function(a,b,c,d,e){return e?[["M",a+e,b],["l",c-2*e,0],["a",e,e,0,0,1,e,e],["l",0,d-2*e],["a",e,e,0,0,1,-e,e],["l",2*e-c,0],["a",e,e,0,0,1,-e,-e],["l",0,2*e-d],["a",e,e,0,0,1,e,-e],["z"]]:[["M",a,b],["l",c,0],["l",0,d],["l",-c,0],["z"]]},V=function(a,b,c,d){null==d&&(d=c);return[["M",a,b],["m",0,-d],
["a",c,d,0,1,1,0,2*d],["a",c,d,0,1,1,0,-2*d],["z"]]},ya=k._getPath={path:function(a){return a.attr("path")},circle:function(a){a=a.attrs;return V(a.cx,a.cy,a.r)},ellipse:function(a){a=a.attrs;return V(a.cx,a.cy,a.rx,a.ry)},rect:function(a){a=a.attrs;return Aa(a.x,a.y,a.width,a.height,a.r)},image:function(a){a=a.attrs;return Aa(a.x,a.y,a.width,a.height)},text:function(a){a=a._getBBox();return Aa(a.x,a.y,a.width,a.height)}},Ga=k.mapPath=function(a,b){if(!b)return a;var c,d,e,f,g,a=za(a);for(e=0,ii=
a.length;e<ii;e++){g=a[e];for(f=1,jj=g.length;f<jj;f+=2)c=b.x(g[f],g[f+1]),d=b.y(g[f],g[f+1]),g[f]=c,g[f+1]=d}return a};k._g=r;k.type=r.win.SVGAngle||r.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML";if("VML"==k.type){var W=r.doc.createElement("div"),ca;W.innerHTML='<v:shape adj="1"/>';ca=W.firstChild;ca.style.behavior="url(#default#VML)";if(!ca||"object"!=typeof ca.adj)return k.type="";W=null}k.svg=!(k.vml="VML"==k.type);k._Paper=v;k.fn=x=v.prototype=
k.prototype;k._id=0;k._oid=0;k.is=function(a,b){b=I.call(b);return"finite"==b?!Z[q](+a):"array"==b?a instanceof Array:"null"==b&&null===a||b==typeof a&&null!==a||"object"==b&&a===Object(a)||"array"==b&&Array.isArray&&Array.isArray(a)||G.call(a).slice(8,-1).toLowerCase()==b};k.angle=function(a,b,c,d,e,f){return null==e?(a-=c,b-=d,!a&&!b?0:(180*E.atan2(-b,-a)/Q+540)%360):k.angle(a,b,e,f)-k.angle(c,d,e,f)};k.rad=function(a){return a%360*Q/180};k.deg=function(a){return 180*a/Q%360};k.snapTo=function(a,
b,c){c=k.is(c,"finite")?c:10;if(k.is(a,R))for(var d=a.length;d--;){if(K(a[d]-b)<=c)return a[d]}else{a=+a;d=b%a;if(d<c)return b-d;if(d>a-c)return b-d+a}return b};k.createUUID=function(a,b){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(a,b).toUpperCase()}}(/[xy]/g,function(a){var b=16*E.random()|0;return("x"==a?b:b&3|8).toString(16)});k.setWindow=function(a){eve("setWindow",k,r.win,a);r.win=a;r.doc=r.win.document;initWin&&initWin(r.win)};var xa=function(a){if(k.vml){var b=/^\s+|\s+$/g,
c;try{var d=new ActiveXObject("htmlfile");d.write("<body>");d.close();c=d.body}catch(e){c=createPopup().document.body}var f=c.createTextRange();xa=h(function(a){try{c.style.color=A(a).replace(b,"");var d=f.queryCommandValue("ForeColor");return"#"+("000000"+((d&255)<<16|d&65280|(d&16711680)>>>16).toString(16)).slice(-6)}catch(e){return"none"}})}else{var g=r.doc.createElement("i");g.title="Rapha\u00ebl Colour Picker";g.style.display="none";r.doc.body.appendChild(g);xa=h(function(a){g.style.color=a;
return r.doc.defaultView.getComputedStyle(g,"").getPropertyValue("color")})}return xa(a)},Ha=function(){return"hsb("+[this.h,this.s,this.b]+")"},wa=function(){return"hsl("+[this.h,this.s,this.l]+")"},ga=function(){return this.hex},oa=function(a,b,c){null==b&&k.is(a,"object")&&"r"in a&&"g"in a&&"b"in a&&(c=a.b,b=a.g,a=a.r);null==b&&k.is(a,"string")&&(c=k.getRGB(a),a=c.r,b=c.g,c=c.b);if(1<a||1<b||1<c)a/=255,b/=255,c/=255;return[a,b,c]},Ea=function(a,b,c,d){a*=255;b*=255;c*=255;a={r:a,g:b,b:c,hex:k.rgb(a,
b,c),toString:ga};k.is(d,"finite")&&(a.opacity=d);return a};k.color=function(a){var b;k.is(a,"object")&&"h"in a&&"s"in a&&"b"in a?(b=k.hsb2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):k.is(a,"object")&&"h"in a&&"s"in a&&"l"in a?(b=k.hsl2rgb(a),a.r=b.r,a.g=b.g,a.b=b.b,a.hex=b.hex):(k.is(a,"string")&&(a=k.getRGB(a)),k.is(a,"object")&&"r"in a&&"g"in a&&"b"in a?(b=k.rgb2hsl(a),a.h=b.h,a.s=b.s,a.l=b.l,b=k.rgb2hsb(a),a.v=b.b):(a={hex:"none"},crl.r=a.g=a.b=a.h=a.s=a.v=a.l=-1));a.toString=ga;return a};k.hsb2rgb=
function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"b"in a&&(c=a.b,b=a.s,a=a.h,d=a.o);a*=360;var e,f,g,h,k;a=a%360/60;k=c*b;h=k*(1-K(a%2-1));e=f=g=c-k;a=~~a;e+=[k,h,0,0,h,k][a];f+=[h,k,k,h,0,0][a];g+=[0,0,h,k,k,h][a];return Ea(e,f,g,d)};k.hsl2rgb=function(a,b,c,d){this.is(a,"object")&&"h"in a&&"s"in a&&"l"in a&&(c=a.l,b=a.s,a=a.h);if(1<a||1<b||1<c)a/=360,b/=100,c/=100;var a=360*a,e,f,g,h,k;a=a%360/60;k=2*b*(0.5>c?c:1-c);h=k*(1-K(a%2-1));e=f=g=c-k/2;a=~~a;e+=[k,h,0,0,h,k][a];f+=[h,k,k,h,0,0][a];
g+=[0,0,h,k,k,h][a];return Ea(e,f,g,d)};k.rgb2hsb=function(a,b,c){c=oa(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f;e=M(a,b,c);f=e-L(a,b,c);d=0==f?null:e==a?(b-c)/f:e==b?(c-a)/f+2:(a-b)/f+4;d=60*((d+360)%6)/360;a=0==f?0:f/e;return{h:d,s:a,b:e,toString:Ha}};k.rgb2hsl=function(a,b,c){c=oa(a,b,c);a=c[0];b=c[1];c=c[2];var d,e,f,g,h;f=M(a,b,c);g=L(a,b,c);h=f-g;d=0==h?null:f==a?(b-c)/h:f==b?(c-a)/h+2:(a-b)/h+4;d=60*((d+360)%6)/360;e=(f+g)/2;a=0==h?0:0.5>e?h/(2*e):h/(2-2*e);return{h:d,s:a,l:e,toString:wa}};k._path2string=
function(){return this.join(",").replace(ma,"$1")};k._preload=function(a,b){var c=r.doc.createElement("img");c.style.cssText="position:absolute;left:-9999em;top-9999em";c.onload=function(){b.call(this);this.onload=null;r.doc.body.removeChild(this)};c.onerror=function(){r.doc.body.removeChild(this)};r.doc.body.appendChild(c);c.src=a};k.getRGB=h(function(a){if(!a||(a=A(a)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g};if("none"==a)return{r:-1,g:-1,b:-1,hex:"none",toString:g};!p[q](a.toLowerCase().substring(0,
2))&&"#"!=a.charAt()&&(a=xa(a));var b,c,d,e,f,h;if(a=a.match(ba)){a[2]&&(d=S(a[2].substring(5),16),c=S(a[2].substring(3,5),16),b=S(a[2].substring(1,3),16));a[3]&&(d=S((f=a[3].charAt(3))+f,16),c=S((f=a[3].charAt(2))+f,16),b=S((f=a[3].charAt(1))+f,16));a[4]&&(h=a[4][y](va),b=J(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=J(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=J(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),"rgba"==a[1].toLowerCase().slice(0,4)&&(e=J(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100));if(a[5])return h=a[5][y](va),
b=J(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=J(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=J(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),("deg"==h[0].slice(-3)||"\u00b0"==h[0].slice(-1))&&(b/=360),"hsba"==a[1].toLowerCase().slice(0,4)&&(e=J(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100),k.hsb2rgb(b,c,d,e);if(a[6])return h=a[6][y](va),b=J(h[0]),"%"==h[0].slice(-1)&&(b*=2.55),c=J(h[1]),"%"==h[1].slice(-1)&&(c*=2.55),d=J(h[2]),"%"==h[2].slice(-1)&&(d*=2.55),("deg"==h[0].slice(-3)||"\u00b0"==h[0].slice(-1))&&(b/=360),
"hsla"==a[1].toLowerCase().slice(0,4)&&(e=J(h[3])),h[3]&&"%"==h[3].slice(-1)&&(e/=100),k.hsl2rgb(b,c,d,e);a={r:b,g:c,b:d,toString:g};a.hex="#"+(16777216|d|c<<8|b<<16).toString(16).slice(1);k.is(e,"finite")&&(a.opacity=e);return a}return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:g}},k);k.hsb=h(function(a,b,c){return k.hsb2rgb(a,b,c).hex});k.hsl=h(function(a,b,c){return k.hsl2rgb(a,b,c).hex});k.rgb=h(function(a,b,c){return"#"+(16777216|c|b<<8|a<<16).toString(16).slice(1)});k.getColor=function(a){var a=
this.getColor.start=this.getColor.start||{h:0,s:1,b:a||0.75},b=this.hsb2rgb(a.h,a.s,a.b);a.h+=0.075;1<a.h&&(a.h=0,a.s-=0.2,0>=a.s&&(this.getColor.start={h:0,s:1,b:a.b}));return b.hex};k.getColor.reset=function(){delete this.start};k.parsePathString=h(function(a){if(!a)return null;var b={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},c=[];k.is(a,R)&&k.is(a[0],R)&&(c=Da(a));c.length||A(a).replace(La,function(a,d,e){var f=[],a=d.toLowerCase();e.replace(ib,function(a,b){b&&f.push(+b)});"m"==a&&2<f.length&&
(c.push([d][D](f.splice(0,2))),a="l",d="m"==d?"l":"L");if("r"==a)c.push([d][D](f));else for(;f.length>=b[a]&&!(c.push([d][D](f.splice(0,b[a]))),!b[a]););});c.toString=k._path2string;return c});k.parseTransformString=h(function(a){if(!a)return null;var b=[];k.is(a,R)&&k.is(a[0],R)&&(b=Da(a));b.length||A(a).replace(na,function(a,c,d){var e=[];I.call(c);d.replace(ib,function(a,b){b&&e.push(+b)});b.push([c][D](e))});b.toString=k._path2string;return b});k.findDotsAtSegment=function(a,b,c,d,e,f,g,h,k){var l=
1-k,m=O(l,3),n=O(l,2),o=k*k,p=o*k,y=m*a+3*n*k*c+3*l*k*k*e+p*g,m=m*b+3*n*k*d+3*l*k*k*f+p*h,n=a+2*k*(c-a)+o*(e-2*c+a),p=b+2*k*(d-b)+o*(f-2*d+b),q=c+2*k*(e-c)+o*(g-2*e+c),o=d+2*k*(f-d)+o*(h-2*f+d),a=l*a+k*c,b=l*b+k*d,e=l*e+k*g,f=l*f+k*h,h=90-180*E.atan2(n-q,p-o)/Q;(n>q||p<o)&&(h+=180);return{x:y,y:m,m:{x:n,y:p},n:{x:q,y:o},start:{x:a,y:b},end:{x:e,y:f},alpha:h}};var Fa=h(function(a){if(!a)return{x:0,y:0,width:0,height:0};for(var a=za(a),b=0,c=0,d=[],e=[],f,g=0,h=a.length;g<h;g++)f=a[g],"M"==f[0]?(b=
f[1],c=f[2],d.push(b),e.push(c)):(b=gb(b,c,f[1],f[2],f[3],f[4],f[5],f[6]),d=d[D](b.min.x,b.max.x),e=e[D](b.min.y,b.max.y),b=f[5],c=f[6]);a=L[z](0,d);f=L[z](0,e);return{x:a,y:f,width:M[z](0,d)-a,height:M[z](0,e)-f}},null,function(a){return{x:a.x,y:a.y,width:a.width,height:a.height}}),Da=function(a){var b=[];if(!k.is(a,R)||!k.is(a&&a[0],R))a=k.parsePathString(a);for(var c=0,d=a.length;c<d;c++){b[c]=[];for(var e=0,f=a[c].length;e<f;e++)b[c][e]=a[c][e]}b.toString=k._path2string;return b},tb=k._pathToRelative=
h(function(a){if(!k.is(a,R)||!k.is(a&&a[0],R))a=k.parsePathString(a);var b=[],c=0,d=0,e=0,f=0,g=0;"M"==a[0][0]&&(c=a[0][1],d=a[0][2],e=c,f=d,g++,b.push(["M",c,d]));for(var h=a.length;g<h;g++){var l=b[g]=[],m=a[g];if(m[0]!=I.call(m[0]))switch(l[0]=I.call(m[0]),l[0]){case "a":l[1]=m[1];l[2]=m[2];l[3]=m[3];l[4]=m[4];l[5]=m[5];l[6]=+(m[6]-c).toFixed(3);l[7]=+(m[7]-d).toFixed(3);break;case "v":l[1]=+(m[1]-d).toFixed(3);break;case "m":e=m[1],f=m[2];default:for(var n=1,o=m.length;n<o;n++)l[n]=+(m[n]-(n%
2?c:d)).toFixed(3)}else{b[g]=[];"m"==m[0]&&(e=m[1]+c,f=m[2]+d);l=0;for(n=m.length;l<n;l++)b[g][l]=m[l]}m=b[g].length;switch(b[g][0]){case "z":c=e;d=f;break;case "h":c+=+b[g][m-1];break;case "v":d+=+b[g][m-1];break;default:c+=+b[g][m-2],d+=+b[g][m-1]}}b.toString=k._path2string;return b},0,Da),db=k._pathToAbsolute=h(function(a){if(!k.is(a,R)||!k.is(a&&a[0],R))a=k.parsePathString(a);if(!a||!a.length)return[["M",0,0]];var b=[],c=0,d=0,e=0,g=0,h=0;"M"==a[0][0]&&(c=+a[0][1],d=+a[0][2],e=c,g=d,h++,b[0]=
["M",c,d]);for(var l,m=h,n=a.length;m<n;m++){b.push(h=[]);l=a[m];if(l[0]!=ra.call(l[0]))switch(h[0]=ra.call(l[0]),h[0]){case "A":h[1]=l[1];h[2]=l[2];h[3]=l[3];h[4]=l[4];h[5]=l[5];h[6]=+(l[6]+c);h[7]=+(l[7]+d);break;case "V":h[1]=+l[1]+d;break;case "H":h[1]=+l[1]+c;break;case "R":for(var o=[c,d][D](l.slice(1)),p=2,y=o.length;p<y;p++)o[p]=+o[p]+c,o[++p]=+o[p]+d;b.pop();b=b[D](f(o));break;case "M":e=+l[1]+c,g=+l[2]+d;default:for(p=1,y=l.length;p<y;p++)h[p]=+l[p]+(p%2?c:d)}else if("R"==l[0])o=[c,d][D](l.slice(1)),
b.pop(),b=b[D](f(o)),h=["R"][D](l.slice(-2));else{p=0;for(y=l.length;p<y;p++)h[p]=l[p]}switch(h[0]){case "Z":c=e;d=g;break;case "H":c=h[1];break;case "V":d=h[1];break;case "M":e=h[h.length-2],g=h[h.length-1];default:c=h[h.length-2],d=h[h.length-1]}}b.toString=k._path2string;return b},null,Da),eb=function(a,b,c,d,e,f){var g=1/3,h=2/3;return[g*a+h*c,g*b+h*d,g*e+h*c,g*f+h*d,e,f]},fb=function(a,b,c,d,e,f,g,k,l,m){var n=120*Q/180,o=Q/180*(+e||0),p=[],q,r=h(function(a,b,c){var d=a*E.cos(c)-b*E.sin(c),a=
a*E.sin(c)+b*E.cos(c);return{x:d,y:a}});if(m)F=m[0],q=m[1],f=m[2],A=m[3];else{q=r(a,b,-o);a=q.x;b=q.y;q=r(k,l,-o);k=q.x;l=q.y;E.cos(Q/180*e);E.sin(Q/180*e);q=(a-k)/2;F=(b-l)/2;A=q*q/(c*c)+F*F/(d*d);1<A&&(A=E.sqrt(A),c*=A,d*=A);var A=c*c,B=d*d,A=(f==g?-1:1)*E.sqrt(K((A*B-A*F*F-B*q*q)/(A*F*F+B*q*q))),f=A*c*F/d+(a+k)/2,A=A*-d*q/c+(b+l)/2,F=E.asin(((b-A)/d).toFixed(9));q=E.asin(((l-A)/d).toFixed(9));F=a<f?Q-F:F;q=k<f?Q-q:q;0>F&&(F=2*Q+F);0>q&&(q=2*Q+q);g&&F>q&&(F-=2*Q);!g&&q>F&&(q-=2*Q)}if(K(q-F)>n){var p=
q,B=k,u=l;q=F+n*(g&&q>F?1:-1);k=f+c*E.cos(q);l=A+d*E.sin(q);p=fb(k,l,c,d,e,0,g,B,u,[q,p,f,A])}f=q-F;e=E.cos(F);n=E.sin(F);g=E.cos(q);q=E.sin(q);f=E.tan(f/4);c=4/3*c*f;f*=4/3*d;d=[a,b];a=[a+c*n,b-f*e];b=[k+c*q,l-f*g];k=[k,l];a[0]=2*d[0]-a[0];a[1]=2*d[1]-a[1];if(m)return[a,b,k][D](p);p=[a,b,k][D](p).join()[y](",");m=[];k=0;for(l=p.length;k<l;k++)m[k]=k%2?r(p[k-1],p[k],o).y:r(p[k],p[k+1],o).x;return m},Ia=function(a,b,c,d,e,f,g,h,k){var l=1-k;return{x:O(l,3)*a+3*O(l,2)*k*c+3*l*k*k*e+O(k,3)*g,y:O(l,3)*
b+3*O(l,2)*k*d+3*l*k*k*f+O(k,3)*h}},gb=h(function(a,b,c,d,e,f,g,h){var k=e-2*c+a-(g-2*e+c),l=2*(c-a)-2*(e-c),m=a-c,n=(-l+E.sqrt(l*l-4*k*m))/2/k,o=(-l-E.sqrt(l*l-4*k*m))/2/k,p=[b,h],y=[a,g],q;"1e12"<K(n)&&(n=0.5);"1e12"<K(o)&&(o=0.5);0<n&&1>n&&(q=Ia(a,b,c,d,e,f,g,h,n),y.push(q.x),p.push(q.y));0<o&&1>o&&(q=Ia(a,b,c,d,e,f,g,h,o),y.push(q.x),p.push(q.y));k=f-2*d+b-(h-2*f+d);l=2*(d-b)-2*(f-d);m=b-d;n=(-l+E.sqrt(l*l-4*k*m))/2/k;o=(-l-E.sqrt(l*l-4*k*m))/2/k;"1e12"<K(n)&&(n=0.5);"1e12"<K(o)&&(o=0.5);0<n&&
1>n&&(q=Ia(a,b,c,d,e,f,g,h,n),y.push(q.x),p.push(q.y));0<o&&1>o&&(q=Ia(a,b,c,d,e,f,g,h,o),y.push(q.x),p.push(q.y));return{min:{x:L[z](0,y),y:L[z](0,p)},max:{x:M[z](0,y),y:M[z](0,p)}}}),za=k._path2curve=h(function(a,b){var c=db(a),d=b&&db(b),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},f={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},g=function(a,b){var c,d;if(!a)return["C",b.x,b.y,b.x,b.y,b.x,b.y];!(a[0]in{T:1,Q:1})&&(b.qx=b.qy=null);switch(a[0]){case "M":b.X=a[1];b.Y=a[2];break;case "A":a=["C"][D](fb[z](0,
[b.x,b.y][D](a.slice(1))));break;case "S":c=b.x+(b.x-(b.bx||b.x));d=b.y+(b.y-(b.by||b.y));a=["C",c,d][D](a.slice(1));break;case "T":b.qx=b.x+(b.x-(b.qx||b.x));b.qy=b.y+(b.y-(b.qy||b.y));a=["C"][D](eb(b.x,b.y,b.qx,b.qy,a[1],a[2]));break;case "Q":b.qx=a[1];b.qy=a[2];a=["C"][D](eb(b.x,b.y,a[1],a[2],a[3],a[4]));break;case "L":a=["C"][D]([b.x,b.y,a[1],a[2],a[1],a[2]]);break;case "H":a=["C"][D]([b.x,b.y,a[1],b.y,a[1],b.y]);break;case "V":a=["C"][D]([b.x,b.y,b.x,a[1],b.x,a[1]]);break;case "Z":a=["C"][D]([b.x,
b.y,b.X,b.Y,b.X,b.Y])}return a},h=function(a,b){if(7<a[b].length){a[b].shift();for(var e=a[b];e.length;)a.splice(b++,0,["C"][D](e.splice(0,6)));a.splice(b,1);m=M(c.length,d&&d.length||0)}},k=function(a,b,e,f,g){a&&b&&"M"==a[g][0]&&"M"!=b[g][0]&&(b.splice(g,0,["M",f.x,f.y]),e.bx=0,e.by=0,e.x=a[g][1],e.y=a[g][2],m=M(c.length,d&&d.length||0))},l=0,m=M(c.length,d&&d.length||0);for(;l<m;l++){c[l]=g(c[l],e);h(c,l);d&&(d[l]=g(d[l],f));d&&h(d,l);k(c,d,e,f,l);k(d,c,f,e,l);var n=c[l],o=d&&d[l],p=n.length,y=
d&&o.length;e.x=n[p-2];e.y=n[p-1];e.bx=J(n[p-4])||e.x;e.by=J(n[p-3])||e.y;f.bx=d&&(J(o[y-4])||f.x);f.by=d&&(J(o[y-3])||f.y);f.x=d&&o[y-2];f.y=d&&o[y-1]}return d?[c,d]:c},null,Da);k._parseDots=h(function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e={},f=a[c].match(/^([^:]*):?([\d\.]*)/);e.color=k.getRGB(f[1]);if(e.color.error)return null;e.color=e.color.hex;f[2]&&(e.offset=f[2]+"%");b.push(e)}for(c=1,d=b.length-1;c<d;c++)if(!b[c].offset){a=J(b[c-1].offset||0);f=0;for(e=c+1;e<d;e++)if(b[e].offset){f=
b[e].offset;break}f||(f=100,e=d);f=J(f);for(f=(f-a)/(e-c+1);c<e;c++)a+=f,b[c].offset=a+"%"}return b});var Ja=k._tear=function(a,b){a==b.top&&(b.top=a.prev);a==b.bottom&&(b.bottom=a.next);a.next&&(a.next.prev=a.prev);a.prev&&(a.prev.next=a.next)};k._tofront=function(a,b){b.top!==a&&(Ja(a,b),a.next=null,a.prev=b.top,b.top.next=a,b.top=a)};k._toback=function(a,b){b.bottom!==a&&(Ja(a,b),a.next=b.bottom,a.prev=null,b.bottom.prev=a,b.bottom=a)};k._insertafter=function(a,b,c){Ja(a,c);b==c.top&&(c.top=a);
b.next&&(b.next.prev=a);a.next=b.next;a.prev=b;b.next=a};k._insertbefore=function(a,b,c){Ja(a,c);b==c.bottom&&(c.bottom=a);b.prev&&(b.prev.next=a);a.prev=b.prev;b.prev=a;a.next=b};var ub=k._extractTransform=function(a,b){if(null==b)return a._.transform;var b=A(b).replace(/\.{3}|\u2026/g,a._.transform||""),c=k.parseTransformString(b),d=0,f=0,g=0,h=1,l=1,m=a._,n=new e;m.transform=c||[];if(c)for(var o=0,p=c.length;o<p;o++){var y=c[o],q=y.length,r=A(y[0]).toLowerCase(),F=y[0]!=r,B=F?n.invert():0,u,v,
x,z,w;"t"==r&&3==q?F?(u=B.x(0,0),v=B.y(0,0),x=B.x(y[1],y[2]),z=B.y(y[1],y[2]),n.translate(x-u,z-v)):n.translate(y[1],y[2]):"r"==r?2==q?(w=w||a.getBBox(1),n.rotate(y[1],w.x+w.width/2,w.y+w.height/2),d+=y[1]):4==q&&(F?(x=B.x(y[2],y[3]),z=B.y(y[2],y[3]),n.rotate(y[1],x,z)):n.rotate(y[1],y[2],y[3]),d+=y[1]):"s"==r?2==q||3==q?(w=w||a.getBBox(1),n.scale(y[1],y[q-1],w.x+w.width/2,w.y+w.height/2),h*=y[1],l*=y[q-1]):5==q&&(F?(x=B.x(y[3],y[4]),z=B.y(y[3],y[4]),n.scale(y[1],y[2],x,z)):n.scale(y[1],y[2],y[3],
y[4]),h*=y[1],l*=y[2]):"m"==r&&7==q&&n.add(y[1],y[2],y[3],y[4],y[5],y[6]);m.dirtyT=1;a.matrix=n}a.matrix=n;m.sx=h;m.sy=l;m.deg=d;m.dx=f=n.e;m.dy=g=n.f;1==h&&1==l&&!d&&m.bbox?(m.bbox.x+=+f,m.bbox.y+=+g):m.dirtyT=1},hb=function(a){var b=a[0];switch(b.toLowerCase()){case "t":return[b,0,0];case "m":return[b,1,0,0,1,0,0];case "r":return 4==a.length?[b,0,a[2],a[3]]:[b,0];case "s":return 5==a.length?[b,1,1,a[3],a[4]]:3==a.length?[b,1,1]:[b,1]}},vb=k._equaliseTransform=function(a,b){b=A(b).replace(/\.{3}|\u2026/g,
a);a=k.parseTransformString(a)||[];b=k.parseTransformString(b)||[];for(var c=M(a.length,b.length),d=[],e=[],f=0,g,h,l,m;f<c;f++){l=a[f]||hb(b[f]);m=b[f]||hb(l);if(l[0]!=m[0]||"r"==l[0].toLowerCase()&&(l[2]!=m[2]||l[3]!=m[3])||"s"==l[0].toLowerCase()&&(l[3]!=m[3]||l[4]!=m[4]))return;d[f]=[];e[f]=[];for(g=0,h=M(l.length,m.length);g<h;g++)g in l&&(d[f][g]=l[g]),g in m&&(e[f][g]=m[g])}return{from:d,to:e}};k._getContainer=function(a,b,c,d){var e;e=null==d&&!k.is(a,"object")?r.doc.getElementById(a):a;if(null!=
e)return e.tagName?null==b?{container:e,width:e.style.pixelWidth||e.offsetWidth,height:e.style.pixelHeight||e.offsetHeight}:{container:e,width:b,height:c}:{container:1,x:a,y:b,width:c,height:d}};k.pathToRelative=tb;k._engine={};k.path2curve=za;k.matrix=function(a,b,c,d,f,g){return new e(a,b,c,d,f,g)};(function(a){function b(a){var d=E.sqrt(c(a));a[0]&&(a[0]/=d);a[1]&&(a[1]/=d)}function c(a){return a[0]*a[0]+a[1]*a[1]}a.add=function(a,b,c,d,f,g){var h=[[],[],[]],k=[[this.a,this.c,this.e],[this.b,this.d,
this.f],[0,0,1]],b=[[a,c,f],[b,d,g],[0,0,1]];a&&a instanceof e&&(b=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]);for(a=0;3>a;a++)for(c=0;3>c;c++){for(d=f=0;3>d;d++)f+=k[a][d]*b[d][c];h[a][c]=f}this.a=h[0][0];this.b=h[1][0];this.c=h[0][1];this.d=h[1][1];this.e=h[0][2];this.f=h[1][2]};a.invert=function(){var a=this.a*this.d-this.b*this.c;return new e(this.d/a,-this.b/a,-this.c/a,this.a/a,(this.c*this.f-this.d*this.e)/a,(this.b*this.e-this.a*this.f)/a)};a.clone=function(){return new e(this.a,this.b,this.c,
this.d,this.e,this.f)};a.translate=function(a,b){this.add(1,0,0,1,a,b)};a.scale=function(a,b,c,d){null==b&&(b=a);(c||d)&&this.add(1,0,0,1,c,d);this.add(a,0,0,b,0,0);(c||d)&&this.add(1,0,0,1,-c,-d)};a.rotate=function(a,b,c){a=k.rad(a);b=b||0;c=c||0;var d=+E.cos(a).toFixed(9),a=+E.sin(a).toFixed(9);this.add(d,a,-a,d,b,c);this.add(1,0,0,1,-b,-c)};a.x=function(a,b){return a*this.a+b*this.c+this.e};a.y=function(a,b){return a*this.b+b*this.d+this.f};a.get=function(a){return+this[A.fromCharCode(97+a)].toFixed(4)};
a.toString=function(){return k.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()};a.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"};a.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};a.split=function(){var a=
{};a.dx=this.e;a.dy=this.f;var d=[[this.a,this.c],[this.b,this.d]];a.scalex=E.sqrt(c(d[0]));b(d[0]);a.shear=d[0][0]*d[1][0]+d[0][1]*d[1][1];d[1]=[d[1][0]-d[0][0]*a.shear,d[1][1]-d[0][1]*a.shear];a.scaley=E.sqrt(c(d[1]));b(d[1]);a.shear/=a.scaley;var e=-d[0][1],d=d[1][1];0>d?(a.rotate=k.deg(E.acos(d)),0>e&&(a.rotate=360-a.rotate)):a.rotate=k.deg(E.asin(e));a.isSimple=!+a.shear.toFixed(9)&&(a.scalex.toFixed(9)==a.scaley.toFixed(9)||!a.rotate);a.isSuperSimple=!+a.shear.toFixed(9)&&a.scalex.toFixed(9)==
a.scaley.toFixed(9)&&!a.rotate;a.noRotation=!+a.shear.toFixed(9)&&!a.rotate;return a};a.toTransformString=function(a){a=a||this[y]();return a.isSimple?"t"+[a.dx,a.dy]+"s"+[a.scalex,a.scaley,0,0]+"r"+[a.rotate,0,0]:"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}})(e.prototype);var Ka=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);"Apple Computer, Inc."==navigator.vendor&&(Ka&&4>Ka[1]||"iP"==navigator.platform.slice(0,2))||"Google Inc."==
navigator.vendor&&Ka&&8>Ka[1]?x.safari=function(){var a=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){a.remove()})}:x.safari=xb;for(var kb=function(){this.returnValue=!1},Ab=function(){return this.originalEvent.preventDefault()},Bb=function(){this.cancelBubble=!0},yb=function(){return this.originalEvent.stopPropagation()},nb=function(){if(r.doc.addEventListener)return function(a,b,c,d){var e=H&&B[b]?B[b]:b,f=function(e){var f=e.clientX+(r.doc.documentElement.scrollLeft||
r.doc.body.scrollLeft),g=e.clientY+(r.doc.documentElement.scrollTop||r.doc.body.scrollTop);if(H&&B[q](b))for(var h=0,k=e.targetTouches&&e.targetTouches.length;h<k;h++)if(e.targetTouches[h].target==a){k=e;e=e.targetTouches[h];e.originalEvent=k;e.preventDefault=Ab;e.stopPropagation=yb;break}return c.call(d,e,f,g)};a.addEventListener(e,f,!1);return function(){a.removeEventListener(e,f,!1);return!0}};if(r.doc.attachEvent)return function(a,b,c,d){var e=function(a){var a=a||r.win.event,b=a.clientX+(r.doc.documentElement.scrollLeft||
r.doc.body.scrollLeft),e=a.clientY+(r.doc.documentElement.scrollTop||r.doc.body.scrollTop);a.preventDefault=a.preventDefault||kb;a.stopPropagation=a.stopPropagation||Bb;return c.call(d,a,b,e)};a.attachEvent("on"+b,e);return function(){a.detachEvent("on"+b,e);return!0}}}(),sa=[],Ra=function(a){for(var b=a.clientX,c=a.clientY,d=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,e=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft,f,g=sa.length;g--;){f=sa[g];if(H)for(var h=a.touches.length,k;h--;){if(k=
a.touches[h],k.identifier==f.el._drag.id){b=k.clientX;c=k.clientY;(a.originalEvent?a.originalEvent:a).preventDefault();break}}else a.preventDefault();var h=f.el.node,l;k=h.nextSibling;var m=h.parentNode,n=h.style.display;r.win.opera&&m.removeChild(h);h.style.display="none";l=f.el.paper.getElementByPoint(b,c);h.style.display=n;r.win.opera&&(k?m.insertBefore(h,k):m.appendChild(h));l&&eve("drag.over."+f.el.id,f.el,l);b+=e;c+=d;eve("drag.move."+f.el.id,f.move_scope||f.el,b-f.el._drag.x,c-f.el._drag.y,
b,c,a)}},Ya=function(a){k.unmousemove(Ra).unmouseup(Ya);for(var b=sa.length,c;b--;)c=sa[b],c.el._drag={},eve("drag.end."+c.el.id,c.end_scope||c.start_scope||c.move_scope||c.el,a);sa=[]},Y=k.el={},Za=F.length;Za--;)(function(a){k[a]=Y[a]=function(b,c){k.is(b,"function")&&(this.events=this.events||[],this.events.push({name:a,f:b,unbind:nb(this.shape||this.node||r.doc,a,b,c||this)}));return this};k["un"+a]=Y["un"+a]=function(b){for(var c=this.events,d=c.length;d--;)if(c[d].name==a&&c[d].f==b){c[d].unbind();
c.splice(d,1);!c.length&&delete this.events;break}return this}})(F[Za]);Y.data=function(a,b){var c=Ma[this.id]=Ma[this.id]||{};if(1==arguments.length){if(k.is(a,"object")){for(var d in a)a[q](d)&&this.data(d,a[d]);return this}eve("data.get."+this.id,this,c[a],a);return c[a]}c[a]=b;eve("data.set."+this.id,this,b,a);return this};Y.removeData=function(a){null==a?Ma[this.id]={}:Ma[this.id]&&delete Ma[this.id][a];return this};Y.hover=function(a,b,c,d){return this.mouseover(a,c).mouseout(b,d||c)};Y.unhover=
function(a,b){return this.unmouseover(a).unmouseout(b)};Y.drag=function(a,b,c,d,e,f){this._drag={};this.mousedown(function(g){(g.originalEvent||g).preventDefault();var h=r.doc.documentElement.scrollTop||r.doc.body.scrollTop,l=r.doc.documentElement.scrollLeft||r.doc.body.scrollLeft;this._drag.x=g.clientX+l;this._drag.y=g.clientY+h;this._drag.id=g.identifier;!sa.length&&k.mousemove(Ra).mouseup(Ya);sa.push({el:this,move_scope:d,start_scope:e,end_scope:f});b&&eve.on("drag.start."+this.id,b);a&&eve.on("drag.move."+
this.id,a);c&&eve.on("drag.end."+this.id,c);eve("drag.start."+this.id,e||d||this,g.clientX+l,g.clientY+h,g)});return this};Y.onDragOver=function(a){a?eve.on("drag.over."+this.id,a):eve.unbind("drag.over."+this.id)};Y.undrag=function(){for(var a=sa.length;a--;)sa[a].el==this&&(k.unmousedown(sa[a].start),sa.splice(a++,1),eve.unbind("drag.*."+this.id));!sa.length&&k.unmousemove(Ra).unmouseup(Ya)};x.circle=function(a,b,c){a=k._engine.circle(this,a||0,b||0,c||0);this.__set__&&this.__set__.push(a);return a};
x.rect=function(a,b,c,d,e){a=k._engine.rect(this,a||0,b||0,c||0,d||0,e||0);this.__set__&&this.__set__.push(a);return a};x.ellipse=function(a,b,c,d){a=k._engine.ellipse(this,a||0,b||0,c||0,d||0);this.__set__&&this.__set__.push(a);return a};x.path=function(a){a&&!k.is(a,"string")&&!k.is(a[0],R)&&(a+="");var b=k._engine.path(k.format[z](k,arguments),this);this.__set__&&this.__set__.push(b);return b};x.image=function(a,b,c,d,e){a=k._engine.image(this,a||"about:blank",b||0,c||0,d||0,e||0);this.__set__&&
this.__set__.push(a);return a};x.text=function(a,b,c){a=k._engine.text(this,a||0,b||0,A(c));this.__set__&&this.__set__.push(a);return a};x.set=function(a){!k.is(a,"array")&&(a=Array.prototype.splice.call(arguments,0,arguments.length));var b=new Ca(a);this.__set__&&this.__set__.push(b);return b};x.setStart=function(a){this.__set__=a||this.set()};x.setFinish=function(){var a=this.__set__;delete this.__set__;return a};x.setSize=function(a,b){return k._engine.setSize.call(this,a,b)};x.setViewBox=function(a,
b,c,d,e){return k._engine.setViewBox.call(this,a,b,c,d,e)};x.top=x.bottom=null;x.raphael=k;x.getElementByPoint=function(a,b){var c,d,e=this.canvas,f=r.doc.elementFromPoint(a,b);if(r.win.opera&&"svg"==f.tagName){d=e.getBoundingClientRect();c=e.ownerDocument;var g=c.body,h=c.documentElement;c=d.top+(r.win.pageYOffset||h.scrollTop||g.scrollTop)-(h.clientTop||g.clientTop||0);d=d.left+(r.win.pageXOffset||h.scrollLeft||g.scrollLeft)-(h.clientLeft||g.clientLeft||0);g=e.createSVGRect();g.x=a-d;g.y=b-c;g.width=
g.height=1;c=e.getIntersectionList(g,null);c.length&&(f=c[c.length-1])}if(!f)return null;for(;f.parentNode&&f!=e.parentNode&&!f.raphael;)f=f.parentNode;f==this.canvas.parentNode&&(f=e);f=f&&f.raphael?this.getById(f.raphaelid):null;return f};x.getById=function(a){for(var b=this.bottom;b;){if(b.id==a)return b;b=b.next}return null};x.forEach=function(a,b){for(var c=this.bottom;c&&!(!1===a.call(b,c));)c=c.next;return this};Y.getBBox=function(a){if(this.removed)return{};var b=this._;if(a){if(b.dirty||
!b.bboxwt)this.realPath=ya[this.type](this),b.bboxwt=Fa(this.realPath),b.bboxwt.toString=d,b.dirty=0;return b.bboxwt}if(b.dirty||b.dirtyT||!b.bbox){if(b.dirty||!this.realPath)b.bboxwt=0,this.realPath=ya[this.type](this);b.bbox=Fa(Ga(this.realPath,this.matrix));b.bbox.toString=d;b.dirty=b.dirtyT=0}return b.bbox};Y.clone=function(){if(this.removed)return null;var a=this.paper[this.type]().attr(this.attr());this.__set__&&this.__set__.push(a);return a};Y.glow=function(a){if("text"==this.type)return null;
for(var a=a||{},b=(a.width||10)+(+this.attr("stroke-width")||1),c=a.fill||!1,d=a.opacity||0.5,e=a.offsetx||0,f=a.offsety||0,a=a.color||"#000",g=b/2,h=this.paper,k=h.set(),l=this.realPath||ya[this.type](this),l=this.matrix?Ga(l,this.matrix):l,m=1;m<g+1;m++)k.push(h.path(l).attr({stroke:a,fill:c?a:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(b/g*m).toFixed(3),opacity:+(d/g).toFixed(3)}));return k.insertBefore(this).translate(e,f)};var Ta={},Ua=function(a,b,c,d,e,f,g,h,
l){var m=0,n=100,o=[a,b,c,d,e,f,g,h].join(),p=Ta[o],y,q;!p&&(Ta[o]=p={data:[]});p.timer&&clearTimeout(p.timer);p.timer=setTimeout(function(){delete Ta[o]},2E3);if(null!=l&&!p.precision){var r=Ua(a,b,c,d,e,f,g,h);p.precision=10*~~r;p.data=[]}n=p.precision||n;for(r=0;r<n+1;r++){p.data[r*n]?q=p.data[r*n]:(q=k.findDotsAtSegment(a,b,c,d,e,f,g,h,r/n),p.data[r*n]=q);r&&(m+=O(O(y.x-q.x,2)+O(y.y-q.y,2),0.5));if(null!=l&&m>=l)return q;y=q}if(null==l)return m},$a=function(a,b){return function(c,d,e){for(var c=
za(c),f,g,h,l,m="",n={},o,p=0,y=0,q=c.length;y<q;y++){h=c[y];if("M"==h[0])f=+h[1],g=+h[2];else{l=Ua(f,g,h[1],h[2],h[3],h[4],h[5],h[6]);if(p+l>d){if(b&&!n.start){o=Ua(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-p);m+=["C"+o.start.x,o.start.y,o.m.x,o.m.y,o.x,o.y];if(e)return m;n.start=m;m=["M"+o.x,o.y+"C"+o.n.x,o.n.y,o.end.x,o.end.y,h[5],h[6]].join();p+=l;f=+h[5];g=+h[6];continue}if(!a&&!b)return o=Ua(f,g,h[1],h[2],h[3],h[4],h[5],h[6],d-p),{x:o.x,y:o.y,alpha:o.alpha}}p+=l;f=+h[5];g=+h[6]}m+=h.shift()+h}n.end=
m;o=a?p:b?n:k.findDotsAtSegment(f,g,h[0],h[1],h[2],h[3],h[4],h[5],1);o.alpha&&(o={x:o.x,y:o.y,alpha:o.alpha});return o}},ob=$a(1),pb=$a(),Oa=$a(0,1);k.getTotalLength=ob;k.getPointAtLength=pb;k.getSubpath=function(a,b,c){if(1.0E-6>this.getTotalLength(a)-c)return Oa(a,b).end;a=Oa(a,c,1);return b?Oa(a,b).end:a};Y.getTotalLength=function(){if("path"==this.type)return this.node.getTotalLength?this.node.getTotalLength():ob(this.attrs.path)};Y.getPointAtLength=function(a){if("path"==this.type)return pb(this.attrs.path,
a)};Y.getSubpath=function(a,b){if("path"==this.type)return k.getSubpath(this.attrs.path,a,b)};var pa=k.easing_formulas={linear:function(a){return a},"<":function(a){return O(a,1.7)},">":function(a){return O(a,0.48)},"<>":function(a){var b=0.48-a/1.04,c=E.sqrt(0.1734+b*b),a=c-b,a=O(K(a),1/3)*(0>a?-1:1),b=-c-b,b=O(K(b),1/3)*(0>b?-1:1),a=a+b+0.5;return 3*(1-a)*a*a+a*a*a},backIn:function(a){return a*a*(2.70158*a-1.70158)},backOut:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},elastic:function(a){return a==
!!a?a:O(2,-10*a)*E.sin(2*(a-0.075)*Q/0.3)+1},bounce:function(a){var b;a<1/2.75?b=7.5625*a*a:a<2/2.75?(a-=1.5/2.75,b=7.5625*a*a+0.75):a<2.5/2.75?(a-=2.25/2.75,b=7.5625*a*a+0.9375):(a-=2.625/2.75,b=7.5625*a*a+0.984375);return b}};pa.easeIn=pa["ease-in"]=pa["<"];pa.easeOut=pa["ease-out"]=pa[">"];pa.easeInOut=pa["ease-in-out"]=pa["<>"];pa["back-in"]=pa.backIn;pa["back-out"]=pa.backOut;var aa=[],qb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(a){setTimeout(a,16)},ab=function(){for(var b=+new Date,c=0;c<aa.length;c++){var d=aa[c];if(!d.el.removed&&!d.paused){var e=b-d.start,f=d.ms,g=d.easing,h=d.from,l=d.diff,m=d.to,n=d.el,o={},p,y={},r;d.initstatus?(e=(d.initstatus*d.anim.top-d.prev)/(d.percent-d.prev)*f,d.status=d.initstatus,delete d.initstatus,d.stop&&aa.splice(c--,1)):d.status=(d.prev+(d.percent-d.prev)*(e/f))/d.anim.top;if(!(0>e))if(e<f){var A=g(e/f),B;for(B in h)if(h[q](B)){switch(ua[B]){case T:p=
+h[B]+A*f*l[B];break;case "colour":p="rgb("+[la(U(h[B].r+A*f*l[B].r)),la(U(h[B].g+A*f*l[B].g)),la(U(h[B].b+A*f*l[B].b))].join()+")";break;case "path":p=[];e=0;for(g=h[B].length;e<g;e++){p[e]=[h[B][e][0]];m=1;for(y=h[B][e].length;m<y;m++)p[e][m]=+h[B][e][m]+A*f*l[B][e][m];p[e]=p[e].join(C)}p=p.join(C);break;case "transform":if(l[B].real){p=[];for(e=0,g=h[B].length;e<g;e++){p[e]=[h[B][e][0]];for(m=1,y=h[B][e].length;m<y;m++)p[e][m]=h[B][e][m]+A*f*l[B][e][m]}}else p=function(a){return+h[B][a]+A*f*l[B][a]},
p=[["m",p(0),p(1),p(2),p(3),p(4),p(5)]];break;case "csv":if("clip-rect"==B)for(p=[],e=4;e--;)p[e]=+h[B][e]+A*f*l[B][e];break;default:g=[][D](h[B]);for(p=[],e=n.paper.customAttributes[B].length;e--;)p[e]=+g[e]+A*f*l[B][e]}o[B]=p}n.attr(o);(function(a,b,c){setTimeout(function(){eve("anim.frame."+a,b,c)})})(n.id,n,d.anim)}else{(function(a,b,c){setTimeout(function(){eve("anim.frame."+b.id,b,c);eve("anim.finish."+b.id,b,c);k.is(a,"function")&&a.call(b)})})(d.callback,n,d.anim);n.attr(m);aa.splice(c--,
1);if(1<d.repeat&&!d.next){for(r in m)m[q](r)&&(y[r]=d.totalOrigin[r]);d.el.attr(y);a(d.anim,d.el,d.anim.percents[0],null,d.totalOrigin,d.repeat-1)}d.next&&!d.stop&&a(d.anim,d.el,d.next,null,d.totalOrigin,d.repeat)}}}k.svg&&n&&n.paper&&n.paper.safari();aa.length&&qb(ab)},la=function(a){return 255<a?255:0>a?0:a};Y.animateWith=function(a,b,c,d,e,f){c=c?k.animation(c,d,e,f):b;status=a.status(b);return this.animate(c).status(c,status*b.ms/c.ms)};Y.onAnimation=function(a){a?eve.on("anim.frame."+this.id,
a):eve.unbind("anim.frame."+this.id);return this};b.prototype.delay=function(a){var c=new b(this.anim,this.ms);c.times=this.times;c.del=+a||0;return c};b.prototype.repeat=function(a){var c=new b(this.anim,this.ms);c.del=this.del;c.times=E.floor(M(a,0))||1;return c};k.animation=function(a,c,d,e){if(a instanceof b)return a;if(k.is(d,"function")||!d)e=e||d||null,d=null;a=Object(a);c=+c||0;var f={},g,h;for(h in a)a[q](h)&&J(h)!=h&&J(h)+"%"!=h&&(g=!0,f[h]=a[h]);if(!g)return new b(a,c);d&&(f.easing=d);
e&&(f.callback=e);return new b({100:f},c)};Y.animate=function(c,d,e,f){if(this.removed)return f&&f.call(this),this;c=c instanceof b?c:k.animation(c,d,e,f);a(c,this,c.percents[0],null,this.attr());return this};Y.setTime=function(a,b){a&&null!=b&&this.status(a,L(b,a.ms)/a.ms);return this};Y.status=function(b,c){var d=[],e=0,f,g;if(null!=c)return a(b,this,-1,L(c,1)),this;for(f=aa.length;e<f;e++)if(g=aa[e],g.el.id==this.id&&(!b||g.anim==b)){if(b)return g.status;d.push({anim:g.anim,status:g.status})}return b?
0:d};Y.pause=function(a){for(var b=0;b<aa.length;b++)aa[b].el.id==this.id&&(!a||aa[b].anim==a)&&!1!==eve("anim.pause."+this.id,this,aa[b].anim)&&(aa[b].paused=!0);return this};Y.resume=function(a){for(var b=0;b<aa.length;b++)if(aa[b].el.id==this.id&&(!a||aa[b].anim==a)){var c=aa[b];!1!==eve("anim.resume."+this.id,this,c.anim)&&(delete c.paused,this.status(c.anim,c.status))}return this};Y.stop=function(a){for(var b=0;b<aa.length;b++)aa[b].el.id==this.id&&(!a||aa[b].anim==a)&&!1!==eve("anim.stop."+
this.id,this,aa[b].anim)&&aa.splice(b--,1);return this};Y.toString=function(){return"Rapha\u00ebl\u2019s object"};var Ca=function(a){this.items=[];this.length=0;this.type="set";if(a)for(var b=0,c=a.length;b<c;b++)a[b]&&(a[b].constructor==Y.constructor||a[b].constructor==Ca)&&(this[this.items.length]=this.items[this.items.length]=a[b],this.length++)},ka=Ca.prototype;ka.push=function(){for(var a,b,c=0,d=arguments.length;c<d;c++)a=arguments[c],a&&(a.constructor==Y.constructor||a.constructor==Ca)&&(b=
this.items.length,this[b]=this.items[b]=a,this.length++);return this};ka.pop=function(){this.length&&delete this[this.length--];return this.items.pop()};ka.forEach=function(a,b){for(var c=0,d=this.items.length;c<d&&!(!1===a.call(b,this.items[c],c));c++);return this};for(var ha in Y)Y[q](ha)&&(ka[ha]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a][z](c,b)})}}(ha));ka.attr=function(a,b){if(a&&k.is(a,R)&&k.is(a[0],"object"))for(var c=0,d=a.length;c<d;c++)this.items[c].attr(a[c]);
else{c=0;for(d=this.items.length;c<d;c++)this.items[c].attr(a,b)}return this};ka.clear=function(){for(;this.length;)this.pop()};ka.splice=function(a,b,c){a=0>a?M(this.length+a,0):a;b=M(0,L(this.length-a,b));var d=[],e=[],f=[],g;for(g=2;g<arguments.length;g++)f.push(arguments[g]);for(g=0;g<b;g++)e.push(this[a+g]);for(;g<this.length-a;g++)d.push(this[a+g]);var h=f.length;for(g=0;g<h+d.length;g++)this.items[a+g]=this[a+g]=g<h?f[g]:d[g-h];for(g=this.items.length=this.length-=b-h;this[g];)delete this[g++];
return new Ca(e)};ka.exclude=function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]==a)return this.splice(b,1),!0};ka.animate=function(a,b,c,d){(k.is(c,"function")||!c)&&(d=c||null);var e=this.items.length,f=e,g=this,h;if(!e)return this;d&&(h=function(){!--e&&d.call(g)});c=k.is(c,"string")?c:h;b=k.animation(a,b,c,h);for(a=this.items[--f].animate(b);f--;)this.items[f]&&!this.items[f].removed&&this.items[f].animateWith(a,b);return this};ka.insertAfter=function(a){for(var b=this.items.length;b--;)this.items[b].insertAfter(a);
return this};ka.getBBox=function(){for(var a=[],b=[],c=[],d=[],e=this.items.length;e--;)if(!this.items[e].removed){var f=this.items[e].getBBox();a.push(f.x);b.push(f.y);c.push(f.x+f.width);d.push(f.y+f.height)}a=L[z](0,a);b=L[z](0,b);return{x:a,y:b,width:M[z](0,c)-a,height:M[z](0,d)-b}};ka.clone=function(a){for(var a=new Ca,b=0,c=this.items.length;b<c;b++)a.push(this.items[b].clone());return a};ka.toString=function(){return"Rapha\u00ebl\u2018s set"};k.registerFont=function(a){if(!a.face)return a;
this.fonts=this.fonts||{};var b={w:a.w,face:{},glyphs:{}},c=a.face["font-family"],d;for(d in a.face)a.face[q](d)&&(b.face[d]=a.face[d]);this.fonts[c]?this.fonts[c].push(b):this.fonts[c]=[b];if(!a.svg){b.face["units-per-em"]=S(a.face["units-per-em"],10);for(var e in a.glyphs)if(a.glyphs[q](e)&&(c=a.glyphs[e],b.glyphs[e]={w:c.w,k:{},d:c.d&&"M"+c.d.replace(/[mlcxtrv]/g,function(a){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[a]||"M"})+"z"},c.k))for(var f in c.k)c[q](f)&&(b.glyphs[e].k[f]=c.k[f])}return a};
x.getFont=function(a,b,c,d){d=d||"normal";c=c||"normal";b=+b||{normal:400,bold:700,lighter:300,bolder:800}[b]||400;if(k.fonts){var e=k.fonts[a];if(!e){var a=RegExp("(^|\\s)"+a.replace(/[^\w\d\s+!~.:_-]/g,"")+"(\\s|$)","i"),f;for(f in k.fonts)if(k.fonts[q](f)&&a.test(f)){e=k.fonts[f];break}}var g;if(e){f=0;for(a=e.length;f<a&&!(g=e[f],g.face["font-weight"]==b&&(g.face["font-style"]==c||!g.face["font-style"])&&g.face["font-stretch"]==d);f++);}return g}};x.print=function(a,b,c,d,e,f,g){f=f||"middle";
g=M(L(g||0,1),-1);var h=this.set(),l=A(c)[y](""),n=0;k.is(d,c)&&(d=this.getFont(d));if(d){for(var c=(e||16)/d.face["units-per-em"],o=d.face.bbox[y](m),e=+o[0],f=+o[1]+("baseline"==f?o[3]-o[1]+ +d.face.descent:(o[3]-o[1])/2),o=0,p=l.length;o<p;o++){var q=o&&d.glyphs[l[o-1]]||{},r=d.glyphs[l[o]];n+=o?(q.w||d.w)+(q.k&&q.k[l[o]]||0)+d.w*g:0;r&&r.d&&h.push(this.path(r.d).attr({fill:"#000",stroke:"none",transform:[["t",n*c,0]]}))}h.transform(["...s",c,c,e,f,"t",(a-e)/c,(b-f)/c])}return h};k.format=function(a,
b){var c=k.is(b,R)?[0][D](b):arguments;a&&k.is(a,"string")&&c.length-1&&(a=a.replace(o,function(a,b){return null==c[++b]?"":c[b]}));return a||""};k.fullfill=function(){var a=/\{([^\}]+)\}/g,b=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,c=function(a,c,d){var e=d;c.replace(b,function(a,b,c,d,f){b=b||d;e&&(b in e&&(e=e[b]),"function"==typeof e&&f&&(e=e()))});e=(null==e||e==d?a:e)+"";return e};return function(b,d){return(""+b).replace(a,function(a,b){return c(a,b,d)})}}();k.ninja=function(){u?
r.win.Raphael=w:delete Raphael;return k};k.st=ka;(function(a,b,c){function d(){/in/.test(a.readyState)?setTimeout(d,9):k.eve("DOMload")}null==a.readyState&&a.addEventListener&&(a.addEventListener(b,c=function(){a.removeEventListener(b,c,!1);a.readyState="complete"},!1),a.readyState="loading");d()})(document,"DOMContentLoaded");u?r.win.Raphael=k:Raphael=k;eve.on("DOMload",function(){l=!0})})();
window.Raphael.svg&&function(a){var b=String,c=parseFloat,d=parseInt,e=Math,f=e.max,g=e.abs,h=e.pow,k=/[, ]+/,l=a.eve,m={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},n={};a.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\u00ebl "+this.version};var o=function(c,d){if(d){"string"==typeof c&&(c=o(c));for(var e in d)d.hasOwnProperty(e)&&("xlink:"==
e.substring(0,6)?c.setAttributeNS("http://www.w3.org/1999/xlink",e.substring(6),b(d[e])):c.setAttribute(e,b(d[e])))}else c=a._g.doc.createElementNS("http://www.w3.org/2000/svg",c),c.style&&(c.style.webkitTapHighlightColor="rgba(0,0,0,0)");return c},q=function(d,k){var l="linear",m=d.id+k,n=0.5,q=0.5,r=d.node,A=d.paper,u=r.style,x=a._g.doc.getElementById(m);if(!x){k=b(k).replace(a._radial_gradient,function(a,b,d){l="radial";b&&d&&(n=c(b),q=c(d),a=2*(0.5<q)-1,0.25<h(n-0.5,2)+h(q-0.5,2)&&(q=e.sqrt(0.25-
h(n-0.5,2))*a+0.5)&&0.5!=q&&(q=q.toFixed(5)-1.0E-5*a));return""});k=k.split(/\s*\-\s*/);if("linear"==l){var v=k.shift(),v=-c(v);if(isNaN(v))return null;var z=[0,0,e.cos(a.rad(v)),e.sin(a.rad(v))],v=1/(f(g(z[2]),g(z[3]))||1);z[2]*=v;z[3]*=v;0>z[2]&&(z[0]=-z[2],z[2]=0);0>z[3]&&(z[1]=-z[3],z[3]=0)}v=a._parseDots(k);if(!v)return null;d.gradient&&(A.defs.removeChild(d.gradient),delete d.gradient);m=m.replace(/[\(\)\s,\xb0#]/g,"-");x=o(l+"Gradient",{id:m});d.gradient=x;o(x,"radial"==l?{fx:n,fy:q}:{x1:z[0],
y1:z[1],x2:z[2],y2:z[3],gradientTransform:d.matrix.invert()});A.defs.appendChild(x);A=0;for(z=v.length;A<z;A++)x.appendChild(o("stop",{offset:v[A].offset?v[A].offset:A?"100%":"0%","stop-color":v[A].color||"#fff"}))}o(r,{fill:"url(#"+m+")",opacity:1,"fill-opacity":1});u.fill="";u.opacity=1;u.fillOpacity=1;return 1},r=function(a){var b=a.getBBox(1);o(a.pattern,{patternTransform:a.matrix.invert()+" translate("+b.x+","+b.y+")"})},u=function(c,d,e){if("path"==c.type){for(var f=b(d).toLowerCase().split("-"),
g=c.paper,h=e?"end":"start",k=c.node,l=c.attrs,q=l["stroke-width"],r=f.length,A="classic",u,v,x,z,w,U=3,J=3,D=5;r--;)switch(f[r]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":A=f[r];break;case "wide":J=5;break;case "narrow":J=2;break;case "long":U=5;break;case "short":U=2}"open"==A?(U+=2,J+=2,D+=2,x=1,z=e?4:1,w={fill:"none",stroke:l.stroke}):(z=x=U/2,w={fill:l.stroke,stroke:"none"});c._.arrows?e?(c._.arrows.endPath&&n[c._.arrows.endPath]--,c._.arrows.endMarker&&n[c._.arrows.endMarker]--):
(c._.arrows.startPath&&n[c._.arrows.startPath]--,c._.arrows.startMarker&&n[c._.arrows.startMarker]--):c._.arrows={};if("none"!=A){f="raphael-marker-"+A;r="raphael-marker-"+h+A+U+J;a._g.doc.getElementById(f)?n[f]++:(g.defs.appendChild(o(o("path"),{"stroke-linecap":"round",d:m[A],id:f})),n[f]=1);var C=a._g.doc.getElementById(r),H;C?(n[r]++,H=C.getElementsByTagName("use")[0]):(C=o(o("marker"),{id:r,markerHeight:J,markerWidth:U,orient:"auto",refX:z,refY:J/2}),H=o(o("use"),{"xlink:href":"#"+f,transform:(e?
" rotate(180 "+U/2+" "+J/2+") ":" ")+"scale("+U/D+","+J/D+")","stroke-width":1/((U/D+J/D)/2)}),C.appendChild(H),g.defs.appendChild(C),n[r]=1);o(H,w);g=x*("diamond"!=A&&"oval"!=A);e?(u=c._.arrows.startdx*q||0,v=a.getTotalLength(l.path)-g*q):(u=g*q,v=a.getTotalLength(l.path)-(c._.arrows.enddx*q||0));w={};w["marker-"+h]="url(#"+r+")";if(v||u)w.d=Raphael.getSubpath(l.path,u,v);o(k,w);c._.arrows[h+"Path"]=f;c._.arrows[h+"Marker"]=r;c._.arrows[h+"dx"]=g;c._.arrows[h+"Type"]=A;c._.arrows[h+"String"]=d}else e?
(u=c._.arrows.startdx*q||0,v=a.getTotalLength(l.path)-u):(u=0,v=a.getTotalLength(l.path)-(c._.arrows.enddx*q||0)),c._.arrows[h+"Path"]&&o(k,{d:Raphael.getSubpath(l.path,u,v)}),delete c._.arrows[h+"Path"],delete c._.arrows[h+"Marker"],delete c._.arrows[h+"dx"],delete c._.arrows[h+"Type"],delete c._.arrows[h+"String"];for(w in n)n.hasOwnProperty(w)&&!n[w]&&(c=a._g.doc.getElementById(w))&&c.parentNode.removeChild(c)}},w={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,
3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},v=function(a,c,d){if(c=w[b(c).toLowerCase()]){for(var e=a.attrs["stroke-width"]||"1",d={round:e,square:e,butt:0}[a.attrs["stroke-linecap"]||d["stroke-linecap"]]||0,f=[],g=c.length;g--;)f[g]=c[g]*e+(g%2?1:-1)*d;o(a.node,{"stroke-dasharray":f.join(",")})}},x=function(c,e){var h=c.node,l=c.attrs,m=h.style.visibility;h.style.visibility="hidden";for(var n in e)if(e.hasOwnProperty(n)&&a._availableAttrs.hasOwnProperty(n)){var A=
e[n];l[n]=A;switch(n){case "blur":c.blur(A);break;case "href":case "title":case "target":var x=h.parentNode;if("a"!=x.tagName.toLowerCase()){var w=o("a");x.insertBefore(w,h);w.appendChild(h);x=w}"target"==n&&"blank"==A?x.setAttributeNS("http://www.w3.org/1999/xlink","show","new"):x.setAttributeNS("http://www.w3.org/1999/xlink",n,A);break;case "cursor":h.style.cursor=A;break;case "transform":c.transform(A);break;case "arrow-start":u(c,A);break;case "arrow-end":u(c,A,1);break;case "clip-rect":x=b(A).split(k);
if(4==x.length){c.clip&&c.clip.parentNode.parentNode.removeChild(c.clip.parentNode);var w=o("clipPath"),D=o("rect");w.id=a.createUUID();o(D,{x:x[0],y:x[1],width:x[2],height:x[3]});w.appendChild(D);c.paper.defs.appendChild(w);o(h,{"clip-path":"url(#"+w.id+")"});c.clip=D}A||(A=a._g.doc.getElementById(h.getAttribute("clip-path").replace(/(^url\(#|\)$)/g,"")),A&&A.parentNode.removeChild(A),o(h,{"clip-path":""}),delete c.clip);break;case "path":"path"==c.type&&(o(h,{d:A?l.path=a._pathToAbsolute(A):"M0,0"}),
c._.dirty=1,c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),"endString"in c._.arrows&&u(c,c._.arrows.endString,1)));break;case "width":if(h.setAttribute(n,A),c._.dirty=1,l.fx)n="x",A=l.x;else break;case "x":l.fx&&(A=-l.x-(l.width||0));case "rx":if("rx"==n&&"rect"==c.type)break;case "cx":h.setAttribute(n,A);c.pattern&&r(c);c._.dirty=1;break;case "height":if(h.setAttribute(n,A),c._.dirty=1,l.fy)n="y",A=l.y;else break;case "y":l.fy&&(A=-l.y-(l.height||0));case "ry":if("ry"==n&&"rect"==
c.type)break;case "cy":h.setAttribute(n,A);c.pattern&&r(c);c._.dirty=1;break;case "r":"rect"==c.type?o(h,{rx:A,ry:A}):h.setAttribute(n,A);c._.dirty=1;break;case "src":"image"==c.type&&h.setAttributeNS("http://www.w3.org/1999/xlink","href",A);break;case "stroke-width":if(1!=c._.sx||1!=c._.sy)A/=f(g(c._.sx),g(c._.sy))||1;c.paper._vbSize&&(A*=c.paper._vbSize);h.setAttribute(n,A);l["stroke-dasharray"]&&v(c,l["stroke-dasharray"],e);c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),"endString"in
c._.arrows&&u(c,c._.arrows.endString,1));break;case "stroke-dasharray":v(c,A,e);break;case "fill":var C=b(A).match(a._ISURL);if(C){var w=o("pattern"),H=o("image");w.id=a.createUUID();o(w,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1});o(H,{x:0,y:0,"xlink:href":C[1]});w.appendChild(H);(function(b){a._preload(C[1],function(){var a=this.offsetWidth,d=this.offsetHeight;o(b,{width:a,height:d});o(H,{width:a,height:d});c.paper.safari()})})(w);c.paper.defs.appendChild(w);h.style.fill="url(#"+w.id+
")";o(h,{fill:"url(#"+w.id+")"});c.pattern=w;c.pattern&&r(c);break}var G=a.getRGB(A);if(G.error){if(("circle"==c.type||"ellipse"==c.type||"r"!=b(A).charAt())&&q(c,A)){if("opacity"in l||"fill-opacity"in l){var ba=a._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,""));if(ba){var Z=ba.getElementsByTagName("stop");o(Z[Z.length-1],{"stop-opacity":("opacity"in l?l.opacity:1)*("fill-opacity"in l?l["fill-opacity"]:1)})}}l.gradient=A;l.fill="none";break}}else delete e.gradient,delete l.gradient,
!a.is(l.opacity,"undefined")&&a.is(e.opacity,"undefined")&&o(h,{opacity:l.opacity}),!a.is(l["fill-opacity"],"undefined")&&a.is(e["fill-opacity"],"undefined")&&o(h,{"fill-opacity":l["fill-opacity"]});G.hasOwnProperty("opacity")&&o(h,{"fill-opacity":1<G.opacity?G.opacity/100:G.opacity});case "stroke":G=a.getRGB(A);h.setAttribute(n,G.hex);"stroke"==n&&G.hasOwnProperty("opacity")&&o(h,{"stroke-opacity":1<G.opacity?G.opacity/100:G.opacity});"stroke"==n&&c._.arrows&&("startString"in c._.arrows&&u(c,c._.arrows.startString),
"endString"in c._.arrows&&u(c,c._.arrows.endString,1));break;case "gradient":("circle"==c.type||"ellipse"==c.type||"r"!=b(A).charAt())&&q(c,A);break;case "opacity":l.gradient&&!l.hasOwnProperty("stroke-opacity")&&o(h,{"stroke-opacity":1<A?A/100:A});case "fill-opacity":if(l.gradient){ba=a._g.doc.getElementById(h.getAttribute("fill").replace(/^url\(#|\)$/g,""));ba&&(Z=ba.getElementsByTagName("stop"),o(Z[Z.length-1],{"stop-opacity":A}));break}default:"font-size"==n&&(A=d(A,10)+"px"),x=n.replace(/(\-.)/g,
function(a){return a.substring(1).toUpperCase()}),h.style[x]=A,c._.dirty=1,h.setAttribute(n,A)}}z(c,e);h.style.visibility=m},z=function(c,e){if("text"==c.type&&(e.hasOwnProperty("text")||e.hasOwnProperty("font")||e.hasOwnProperty("font-size")||e.hasOwnProperty("x")||e.hasOwnProperty("y"))){var f=c.attrs,g=c.node,h=g.firstChild?d(a._g.doc.defaultView.getComputedStyle(g.firstChild,"").getPropertyValue("font-size"),10):10;if(e.hasOwnProperty("text")){for(f.text=e.text;g.firstChild;)g.removeChild(g.firstChild);
for(var k=b(e.text).split("\n"),l=[],m,n=0,q=k.length;n<q;n++)m=o("tspan"),n&&o(m,{dy:1.2*h,x:f.x}),m.appendChild(a._g.doc.createTextNode(k[n])),g.appendChild(m),l[n]=m}else{l=g.getElementsByTagName("tspan");for(n=0,q=l.length;n<q;n++)n?o(l[n],{dy:1.2*h,x:f.x}):o(l[0],{dy:0})}o(g,{x:f.x,y:f.y});c._.dirty=1;g=c._getBBox();(f=f.y-(g.y+g.height/2))&&a.is(f,"finite")&&o(l[0],{dy:f})}},D=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.matrix=a.matrix();this.realPath=
null;this.paper=c;this.attrs=this.attrs||{};this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1};!c.bottom&&(c.bottom=this);this.prev=c.top;c.top&&(c.top.next=this);c.top=this;this.next=null},H=a.el;D.prototype=H;H.constructor=D;a._engine.path=function(a,b){var c=o("path");b.canvas&&b.canvas.appendChild(c);c=new D(c,b);c.type="path";x(c,{fill:"none",stroke:"#000",path:a});return c};H.rotate=function(a,d,e){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);
null==e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this.transform(this._.transform.concat([["r",a,d,e]]));return this};H.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]),f=c(a[3]));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));return this};H.translate=function(a,d){if(this.removed)return this;
a=b(a).split(k);a.length-1&&(d=c(a[1]));a=c(a[0])||0;d=+d||0;this.transform(this._.transform.concat([["t",a,d]]));return this};H.transform=function(b){var c=this._;if(null==b)return c.transform;a._extractTransform(this,b);this.clip&&o(this.clip,{transform:this.matrix.invert()});this.pattern&&r(this);this.node&&o(this.node,{transform:this.matrix});if(1!=c.sx||1!=c.sy)this.attr({"stroke-width":this.attrs.hasOwnProperty("stroke-width")?this.attrs["stroke-width"]:1});return this};H.hide=function(){!this.removed&&
this.paper.safari(this.node.style.display="none");return this};H.show=function(){!this.removed&&this.paper.safari(this.node.style.display="");return this};H.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);l.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);for(var b in this)delete this[b];this.removed=!0}};H._getBBox=function(){if("none"==this.node.style.display){this.show();var a=!0}var b={};try{b=this.node.getBBox()}catch(c){}finally{b=
b||{}}a&&this.hide();return b};H.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==b)return this._.transform;e=b.split(k);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?
d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(null==c&&a.is(b,"array")){d={};for(f=0,g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c?(d={},d[b]=c):null!=b&&a.is(b,"object")&&(d=b);for(f in d)l("attr."+f+"."+this.id,this,d[f]);for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=
this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);x(this,d);return this};H.toFront=function(){if(this.removed)return this;this.node.parentNode.appendChild(this.node);var b=this.paper;b.top!=this&&a._tofront(this,b);return this};H.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};
H.insertAfter=function(b){if(this.removed)return this;var c=b.node||b[b.length-1].node;c.nextSibling?c.parentNode.insertBefore(this.node,c.nextSibling):c.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};H.insertBefore=function(b){if(this.removed)return this;var c=b.node||b[0].node;c.parentNode.insertBefore(this.node,c);a._insertbefore(this,b,this.paper);return this};H.blur=function(b){if(0!==+b){var c=o("filter"),d=o("feGaussianBlur");this.attrs.blur=b;c.id=a.createUUID();
o(d,{stdDeviation:+b||1.5});c.appendChild(d);this.paper.defs.appendChild(c);this._blur=c;o(this.node,{filter:"url(#"+c.id+")"})}else this._blur&&(this._blur.parentNode.removeChild(this._blur),delete this._blur,delete this.attrs.blur),this.node.removeAttribute("filter")};a._engine.circle=function(a,b,c,d){var e=o("circle");a.canvas&&a.canvas.appendChild(e);a=new D(e,a);a.attrs={cx:b,cy:c,r:d,fill:"none",stroke:"#000"};a.type="circle";o(e,a.attrs);return a};a._engine.rect=function(a,b,c,d,e,f){var g=
o("rect");a.canvas&&a.canvas.appendChild(g);a=new D(g,a);a.attrs={x:b,y:c,width:d,height:e,r:f||0,rx:f||0,ry:f||0,fill:"none",stroke:"#000"};a.type="rect";o(g,a.attrs);return a};a._engine.ellipse=function(a,b,c,d,e){var f=o("ellipse");a.canvas&&a.canvas.appendChild(f);a=new D(f,a);a.attrs={cx:b,cy:c,rx:d,ry:e,fill:"none",stroke:"#000"};a.type="ellipse";o(f,a.attrs);return a};a._engine.image=function(a,b,c,d,e,f){var g=o("image");o(g,{x:c,y:d,width:e,height:f,preserveAspectRatio:"none"});g.setAttributeNS("http://www.w3.org/1999/xlink",
"href",b);a.canvas&&a.canvas.appendChild(g);a=new D(g,a);a.attrs={x:c,y:d,width:e,height:f,src:b};a.type="image";return a};a._engine.text=function(b,c,d,e){var f=o("text");b.canvas&&b.canvas.appendChild(f);b=new D(f,b);b.attrs={x:c,y:d,"text-anchor":"middle",text:e,font:a._availableAttrs.font,stroke:"none",fill:"#000"};b.type="text";x(b,b.attrs);return b};a._engine.setSize=function(a,b){this.width=a||this.width;this.height=b||this.height;this.canvas.setAttribute("width",this.width);this.canvas.setAttribute("height",
this.height);this._viewBox&&this.setViewBox.apply(this,this._viewBox);return this};a._engine.create=function(){var b=a._getContainer.apply(0,arguments),c=b&&b.container,d=b.x,e=b.y,f=b.width,b=b.height;if(!c)throw Error("SVG container not found.");var g=o("svg"),h;d=d||0;e=e||0;f=f||512;b=b||342;o(g,{height:b,version:1.1,width:f,xmlns:"http://www.w3.org/2000/svg"});1==c?(g.style.cssText="overflow:hidden;position:absolute;left:"+d+"px;top:"+e+"px",a._g.doc.body.appendChild(g),h=1):(g.style.cssText=
"overflow:hidden;position:relative",c.firstChild?c.insertBefore(g,c.firstChild):c.appendChild(g));c=new a._Paper;c.width=f;c.height=b;c.canvas=g;c.clear();c._left=c._top=0;h&&(c.renderfix=function(){});c.renderfix();return c};a._engine.setViewBox=function(a,b,c,d,e){l("setViewBox",this,this._viewBox,[a,b,c,d,e]);var g=f(c/this.width,d/this.height),h=this.top,k,m;for(null==a?(this._vbSize&&(g=1),delete this._vbSize,k="0 0 "+this.width+" "+this.height):(this._vbSize=g,k=a+" "+b+" "+c+" "+d),o(this.canvas,
{viewBox:k,preserveAspectRatio:e?"meet":"xMinYMin"});g&&h;)m="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":m}),h._.dirty=1,h._.dirtyT=1,h=h.prev;this._viewBox=[a,b,c,d,!!e];return this};a.prototype.renderfix=function(){var a=this.canvas,b=a.style,c=a.getScreenCTM()||a.createSVGMatrix(),a=-c.e%1,c=-c.f%1;if(a||c)a&&(this._left=(this._left+a)%1,b.left=this._left+"px"),c&&(this._top=(this._top+c)%1,b.top=this._top+"px")};a.prototype.clear=function(){a.eve("clear",this);for(var b=
this.canvas;b.firstChild;)b.removeChild(b.firstChild);this.bottom=this.top=null;(this.desc=o("desc")).appendChild(a._g.doc.createTextNode("Created with Rapha\u00ebl "+a.version));b.appendChild(this.desc);b.appendChild(this.defs=o("defs"))};a.prototype.remove=function(){l("remove",this);this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var a in this)this[a]=removed(a)};var C=a.st,A;for(A in H)H.hasOwnProperty(A)&&!C.hasOwnProperty(A)&&(C[A]=function(a){return function(){var b=
arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(A))}(window.Raphael);
window.Raphael.vml&&function(a){var b=String,c=parseFloat,d=Math,e=d.round,f=d.max,g=d.min,h=d.abs,k=/[, ]+/,l=a.eve,m={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},n=/([clmz]),?([^clmz]*)/gi,o=/ progid:\S+Blur\([^\)]+\)/g,q=/-?[^,\s-]+/g,r={path:1,rect:1,image:1},u={circle:1,ellipse:1},w=function(c){var d=/[ahqstv]/ig,f=a._pathToAbsolute;b(c).match(d)&&(f=a._path2curve);d=/[clmz]/g;if(f==a._pathToAbsolute&&!b(c).match(d))return c=b(c).replace(n,function(a,b,c){var d=[],f="m"==b.toLowerCase(),
g=m[b];c.replace(q,function(a){f&&2==d.length&&(g+=d+m["m"==b?"l":"L"],d=[]);d.push(e(21600*a))});return g+d});for(var d=f(c),g,c=[],h=0,k=d.length;h<k;h++){f=d[h];g=d[h][0].toLowerCase();"z"==g&&(g="x");for(var l=1,o=f.length;l<o;l++)g+=e(21600*f[l])+(l!=o-1?",":"");c.push(g)}return c.join(" ")},v=function(b,c,d){var e=a.matrix();e.rotate(-b,0.5,0.5);return{dx:e.x(c,d),dy:e.y(c,d)}},x=function(a,b,c,d,e,f){var g=a._,k=a.matrix,l=g.fillpos,a=a.node,m=a.style,n=1,o="",q=21600/b,r=21600/c;m.visibility=
"hidden";if(b&&c){a.coordsize=h(q)+" "+h(r);m.rotation=f*(0>b*c?-1:1);if(f){var u=v(f,d,e);d=u.dx;e=u.dy}0>b&&(o+="x");0>c&&(o+=" y")&&(n=-1);m.flip=o;a.coordorigin=d*-q+" "+e*-r;if(l||g.fillsize)d=a.getElementsByTagName("fill"),d=d&&d[0],a.removeChild(d),l&&(u=v(f,k.x(l[0],l[1]),k.y(l[0],l[1])),d.position=u.dx*n+" "+u.dy*n),g.fillsize&&(d.size=g.fillsize[0]*h(b)+" "+g.fillsize[1]*h(c)),a.appendChild(d);m.visibility="visible"}};a.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\u00ebl "+
this.version};addArrow=function(a,c,d){for(var c=b(c).toLowerCase().split("-"),d=d?"end":"start",e=c.length,f="classic",g="medium",h="medium";e--;)switch(c[e]){case "block":case "classic":case "oval":case "diamond":case "open":case "none":f=c[e];break;case "wide":case "narrow":h=c[e];break;case "long":case "short":g=c[e]}a=a.node.getElementsByTagName("stroke")[0];a[d+"arrow"]=f;a[d+"arrowlength"]=g;a[d+"arrowwidth"]=h};setFillAndStroke=function(d,h){d.attrs=d.attrs||{};var l=d.node,m=d.attrs,n=l.style,
o=r[d.type]&&(h.x!=m.x||h.y!=m.y||h.width!=m.width||h.height!=m.height||h.cx!=m.cx||h.cy!=m.cy||h.rx!=m.rx||h.ry!=m.ry||h.r!=m.r),q=u[d.type]&&(m.cx!=h.cx||m.cy!=h.cy||m.r!=h.r||m.rx!=h.rx||m.ry!=h.ry),v;for(v in h)h.hasOwnProperty(v)&&(m[v]=h[v]);o&&(m.path=a._getPath[d.type](d),d._.dirty=1);h.href&&(l.href=h.href);h.title&&(l.title=h.title);h.target&&(l.target=h.target);h.cursor&&(n.cursor=h.cursor);"blur"in h&&d.blur(h.blur);if(h.path&&"path"==d.type||o)l.path=w(~b(m.path).toLowerCase().indexOf("r")?
a._pathToAbsolute(m.path):m.path),"image"==d.type&&(d._.fillpos=[m.x,m.y],d._.fillsize=[m.width,m.height],x(d,1,1,0,0,0));"transform"in h&&d.transform(h.transform);if(q){o=+m.cx;q=+m.cy;v=+m.rx||+m.r||0;var z=+m.ry||+m.r||0;l.path=a.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",e(21600*(o-v)),e(21600*(q-z)),e(21600*(o+v)),e(21600*(q+z)),e(21600*o))}"clip-rect"in h&&(o=b(h["clip-rect"]).split(k),4==o.length&&(o[2]=+o[2]+ +o[0],o[3]=+o[3]+ +o[1],q=l.clipRect||a._g.doc.createElement("div"),v=q.style,v.clip=
a.format("rect({1}px {2}px {3}px {0}px)",o),l.clipRect||(v.position="absolute",v.top=0,v.left=0,v.width=d.paper.width+"px",v.height=d.paper.height+"px",l.parentNode.insertBefore(q,l),q.appendChild(l),l.clipRect=q)),h["clip-rect"]||l.clipRect&&(l.clipRect.style.clip=""));d.textpath&&(o=d.textpath.style,h.font&&(o.font=h.font),h["font-family"]&&(o.fontFamily='"'+h["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,"")+'"'),h["font-size"]&&(o.fontSize=h["font-size"]),h["font-weight"]&&(o.fontWeight=
h["font-weight"]),h["font-style"]&&(o.fontStyle=h["font-style"]));"arrow-start"in h&&addArrow(d,h["arrow-start"]);"arrow-end"in h&&addArrow(d,h["arrow-end"],1);if(null!=h.opacity||null!=h["stroke-width"]||null!=h.fill||null!=h.src||null!=h.stroke||null!=h["stroke-width"]||null!=h["stroke-opacity"]||null!=h["fill-opacity"]||null!=h["stroke-dasharray"]||null!=h["stroke-miterlimit"]||null!=h["stroke-linejoin"]||null!=h["stroke-linecap"]){o=l.getElementsByTagName("fill");o=o&&o[0];!o&&(o=D("fill"));"image"==
d.type&&h.src&&(o.src=h.src);h.fill&&(o.on=!0);if(null==o.on||"none"==h.fill||null===h.fill)o.on=!1;o.on&&h.fill&&((q=b(h.fill).match(a._ISURL))?(o.parentNode==l&&l.removeChild(o),o.rotate=!0,o.src=q[1],o.type="tile",v=d.getBBox(1),o.position=v.x+" "+v.y,d._.fillpos=[v.x,v.y],a._preload(q[1],function(){d._.fillsize=[this.offsetWidth,this.offsetHeight]})):(o.color=a.getRGB(h.fill).hex,o.src="",o.type="solid",a.getRGB(h.fill).error&&(d.type in{circle:1,ellipse:1}||"r"!=b(h.fill).charAt())&&addGradientFill(d,
h.fill,o)&&(m.fill="none",m.gradient=h.fill,o.rotate=!1)));if("fill-opacity"in h||"opacity"in h)v=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+a.getRGB(h.fill).o+1||2)-1),v=g(f(v,0),1),o.opacity=v,o.src&&(o.color="none");l.appendChild(o);o=l.getElementsByTagName("stroke")&&l.getElementsByTagName("stroke")[0];q=!1;!o&&(q=o=D("stroke"));if(h.stroke&&"none"!=h.stroke||h["stroke-width"]||null!=h["stroke-opacity"]||h["stroke-dasharray"]||h["stroke-miterlimit"]||h["stroke-linejoin"]||h["stroke-linecap"])o.on=
!0;("none"==h.stroke||null===h.stroke||null==o.on||0==h.stroke||0==h["stroke-width"])&&(o.on=!1);v=a.getRGB(h.stroke);o.on&&h.stroke&&(o.color=v.hex);v=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+v.o+1||2)-1);z=0.75*(c(h["stroke-width"])||1);v=g(f(v,0),1);null==h["stroke-width"]&&(z=m["stroke-width"]);h["stroke-width"]&&(o.weight=z);z&&1>z&&(v*=z)&&(o.weight=1);o.opacity=v;h["stroke-linejoin"]&&(o.joinstyle=h["stroke-linejoin"]||"miter");o.miterlimit=h["stroke-miterlimit"]||8;h["stroke-linecap"]&&
(o.endcap="butt"==h["stroke-linecap"]?"flat":"square"==h["stroke-linecap"]?"square":"round");h["stroke-dasharray"]&&(v={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},o.dashstyle=v.hasOwnProperty(h["stroke-dasharray"])?v[h["stroke-dasharray"]]:"");q&&l.appendChild(o)}if("text"==d.type){d.paper.canvas.style.display="";l=d.paper.span;o=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);
n=l.style;m.font&&(n.font=m.font);m["font-family"]&&(n.fontFamily=m["font-family"]);m["font-weight"]&&(n.fontWeight=m["font-weight"]);m["font-style"]&&(n.fontStyle=m["font-style"]);o=c(o?o[0]:m["font-size"]);n.fontSize=100*o+"px";d.textpath.string&&(l.innerHTML=b(d.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));n=l.getBoundingClientRect();d.W=m.w=(n.right-n.left)/100;d.H=m.h=(n.bottom-n.top)/100;d.X=m.x;d.Y=m.y+d.H/2;("x"in h||"y"in h)&&(d.path.v=a.format("m{0},{1}l{2},{1}",
e(21600*m.x),e(21600*m.y),e(21600*m.x)+1));n="x,y,text,font,font-family,font-weight,font-style,font-size".split(",");l=0;for(o=n.length;l<o;l++)if(n[l]in h){d._.dirty=1;break}switch(m["text-anchor"]){case "start":d.textpath.style["v-text-align"]="left";d.bbx=d.W/2;break;case "end":d.textpath.style["v-text-align"]="right";d.bbx=-d.W/2;break;default:d.textpath.style["v-text-align"]="center",d.bbx=0}d.textpath.style["v-text-kern"]=!0}};addGradientFill=function(e,f,g){e.attrs=e.attrs||{};var h=Math.pow,
k="linear",l=".5 .5";e.attrs.gradient=f;f=b(f).replace(a._radial_gradient,function(a,b,e){k="radial";b&&e&&(b=c(b),e=c(e),0.25<h(b-0.5,2)+h(e-0.5,2)&&(e=d.sqrt(0.25-h(b-0.5,2))*(2*(0.5<e)-1)+0.5),l=b+" "+e);return""});f=f.split(/\s*\-\s*/);if("linear"==k){var m=f.shift(),m=-c(m);if(isNaN(m))return null}f=a._parseDots(f);if(!f)return null;e=e.shape||e.node;if(f.length){e.removeChild(g);g.on=!0;g.method="none";g.color=f[0].color;g.color2=f[f.length-1].color;for(var n=[],o=0,q=f.length;o<q;o++)f[o].offset&&
n.push(f[o].offset+" "+f[o].color);g.colors=n.length?n.join():"0% "+g.color;"radial"==k?(g.type="gradientTitle",g.focus="100%",g.focussize="0 0",g.focusposition=l,g.angle=0):(g.type="gradient",g.angle=(270-m)%360);e.appendChild(g)}return 1};Element=function(b,c){this[0]=this.node=b;b.raphael=!0;this.id=a._oid++;b.raphaelid=this.id;this.X=0;this.Y=0;this.attrs={};this.paper=c;this.matrix=a.matrix();this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1};!c.bottom&&(c.bottom=this);this.prev=
c.top;c.top&&(c.top.next=this);c.top=this;this.next=null};var z=a.el;Element.prototype=z;z.constructor=Element;z.transform=function(c){if(null==c)return this._.transform;var d=this.paper._viewBoxShift,e=d?"s"+[d.scale,d.scale]+"-1-1t"+[d.dx,d.dy]:"",f;d&&(f=c=b(c).replace(/\.{3}|\u2026/g,this._.transform||""));a._extractTransform(this,e+c);var d=this.matrix.clone(),g=this.skew,c=this.node,e=~b(this.attrs.fill).indexOf("-"),h=!b(this.attrs.fill).indexOf("url(");d.translate(-0.5,-0.5);h||e||"image"==
this.type?(g.matrix="1 0 0 1",g.offset="0 0",g=d.split(),e&&g.noRotation||!g.isSimple?(c.style.filter=d.toFilter(),e=this.getBBox(),g=this.getBBox(1),d=e.x-g.x,e=e.y-g.y,c.coordorigin=-21600*d+" "+-21600*e,x(this,1,1,d,e,0)):(c.style.filter="",x(this,g.scalex,g.scaley,g.dx,g.dy,g.rotate))):(c.style.filter="",g.matrix=b(d),g.offset=d.offset());f&&(this._.transform=f);return this};z.rotate=function(a,d,e){if(this.removed)return this;if(null!=a){a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]));a=c(a[0]);
null==e&&(d=e);if(null==d||null==e)e=this.getBBox(1),d=e.x+e.width/2,e=e.y+e.height/2;this._.dirtyT=1;this.transform(this._.transform.concat([["r",a,d,e]]));return this}};z.translate=function(a,d){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]));a=c(a[0])||0;d=+d||0;this._.bbox&&(this._.bbox.x+=a,this._.bbox.y+=d);this.transform(this._.transform.concat([["t",a,d]]));return this};z.scale=function(a,d,e,f){if(this.removed)return this;a=b(a).split(k);a.length-1&&(d=c(a[1]),e=c(a[2]),
f=c(a[3]),isNaN(e)&&(e=null),isNaN(f)&&(f=null));a=c(a[0]);null==d&&(d=a);null==f&&(e=f);if(null==e||null==f)var g=this.getBBox(1);e=null==e?g.x+g.width/2:e;f=null==f?g.y+g.height/2:f;this.transform(this._.transform.concat([["s",a,d,e,f]]));this._.dirtyT=1;return this};z.hide=function(){!this.removed&&(this.node.style.display="none");return this};z.show=function(){!this.removed&&(this.node.style.display="");return this};z._getBBox=function(){return this.removed?{}:"text"==this.type?{x:this.X+(this.bbx||
0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}:pathDimensions(this.attrs.path)};z.remove=function(){if(!this.removed){this.paper.__set__&&this.paper.__set__.exclude(this);a.eve.unbind("*.*."+this.id);a._tear(this,this.paper);this.node.parentNode.removeChild(this.node);this.shape&&this.shape.parentNode.removeChild(this.shape);for(var b in this)delete this[b];this.removed=!0}};z.attr=function(b,c){if(this.removed)return this;if(null==b){var d={},e;for(e in this.attrs)this.attrs.hasOwnProperty(e)&&
(d[e]=this.attrs[e]);d.gradient&&"none"==d.fill&&(d.fill=d.gradient)&&delete d.gradient;d.transform=this._.transform;return d}if(null==c&&a.is(b,"string")){if("fill"==b&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;e=b.split(k);for(var d={},f=0,g=e.length;f<g;f++)b=e[f],b in this.attrs?d[b]=this.attrs[b]:a.is(this.paper.customAttributes[b],"function")?d[b]=this.paper.customAttributes[b].def:d[b]=a._availableAttrs[b];return g-1?d:d[e[0]]}if(this.attrs&&null==c&&a.is(b,"array")){d=
{};for(f=0,g=b.length;f<g;f++)d[b[f]]=this.attr(b[f]);return d}null!=c&&(d={},d[b]=c);null==c&&a.is(b,"object")&&(d=b);for(f in d)l("attr."+f+"."+this.id,this,d[f]);if(d){for(f in this.paper.customAttributes)if(this.paper.customAttributes.hasOwnProperty(f)&&d.hasOwnProperty(f)&&a.is(this.paper.customAttributes[f],"function"))for(g in e=this.paper.customAttributes[f].apply(this,[].concat(d[f])),this.attrs[f]=d[f],e)e.hasOwnProperty(g)&&(d[g]=e[g]);d.text&&"text"==this.type&&(this.textpath.string=d.text);
setFillAndStroke(this,d)}return this};z.toFront=function(){!this.removed&&this.node.parentNode.appendChild(this.node);this.paper&&this.paper.top!=this&&a._tofront(this,this.paper);return this};z.toBack=function(){if(this.removed)return this;this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),a._toback(this,this.paper));return this};z.insertAfter=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[b.length-
1]);b.node.nextSibling?b.node.parentNode.insertBefore(this.node,b.node.nextSibling):b.node.parentNode.appendChild(this.node);a._insertafter(this,b,this.paper);return this};z.insertBefore=function(b){if(this.removed)return this;b.constructor==a.st.constructor&&(b=b[0]);b.node.parentNode.insertBefore(this.node,b.node);a._insertbefore(this,b,this.paper);return this};z.blur=function(b){var c=this.node.runtimeStyle,d=c.filter;d=d.replace(o,"");0!==+b?(this.attrs.blur=b,c.filter=d+"  progid:DXImageTransform.Microsoft.Blur(pixelradius="+
(+b||1.5)+")",c.margin=a.format("-{0}px 0 0 -{0}px",e(+b||1.5))):(c.filter=d,c.margin=0,delete this.attrs.blur)};a._engine.path=function(a,b){var c=D("shape");c.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";c.coordsize="21600 21600";c.coordorigin=b.coordorigin;var d=new Element(c,b),e={fill:"none",stroke:"#000"};a&&(e.path=a);d.type="path";d.path=[];d.Path="";setFillAndStroke(d,e);b.canvas.appendChild(c);e=D("skew");e.on=!0;c.appendChild(e);d.skew=e;d.transform("");return d};
a._engine.rect=function(b,c,d,e,f,g){var h=a._rectPath(c,d,e,f,g),b=b.path(h),k=b.attrs;b.X=k.x=c;b.Y=k.y=d;b.W=k.width=e;b.H=k.height=f;k.r=g;k.path=h;b.type="rect";return b};a._engine.ellipse=function(a,b,c,d,e){a=a.path();a.X=b-d;a.Y=c-e;a.W=2*d;a.H=2*e;a.type="ellipse";setFillAndStroke(a,{cx:b,cy:c,rx:d,ry:e});return a};a._engine.circle=function(a,b,c,d){a=a.path();a.X=b-d;a.Y=c-d;a.W=a.H=2*d;a.type="circle";setFillAndStroke(a,{cx:b,cy:c,r:d});return a};a._engine.image=function(b,c,d,e,f,g){var h=
a._rectPath(d,e,f,g),b=b.path(h).attr({stroke:"none"}),k=b.attrs,l=b.node,m=l.getElementsByTagName("fill")[0];k.src=c;b.X=k.x=d;b.Y=k.y=e;b.W=k.width=f;b.H=k.height=g;k.path=h;b.type="image";m.parentNode==l&&l.removeChild(m);m.rotate=!0;m.src=c;m.type="tile";b._.fillpos=[d,e];b._.fillsize=[f,g];l.appendChild(m);x(b,1,1,0,0,0);return b};a._engine.text=function(c,d,f,g){var h=D("shape"),k=D("path"),l=D("textpath");d=d||0;f=f||0;g=g||"";k.v=a.format("m{0},{1}l{2},{1}",e(21600*d),e(21600*f),e(21600*d)+
1);k.textpathok=!0;l.string=b(g);l.on=!0;h.style.cssText="position:absolute;left:0;top:0;width:1px;height:1px";h.coordsize="21600 21600";h.coordorigin="0 0";var m=new Element(h,c),n={fill:"#000",stroke:"none",font:a._availableAttrs.font,text:g};m.shape=h;m.path=k;m.textpath=l;m.type="text";m.attrs.text=b(g);m.attrs.x=d;m.attrs.y=f;m.attrs.w=1;m.attrs.h=1;setFillAndStroke(m,n);h.appendChild(l);h.appendChild(k);c.canvas.appendChild(h);c=D("skew");c.on=!0;h.appendChild(c);m.skew=c;m.transform("");return m};
a._engine.setSize=function(a,b){var c=this.canvas.style;this.width=a;this.height=b;a==+a&&(a+="px");b==+b&&(b+="px");c.width=a;c.height=b;c.clip="rect(0 "+a+" "+b+" 0)";this._viewBox&&setViewBox.apply(this,this._viewBox);return this};a._engine.setViewBox=function(b,c,d,e,g){a.eve("setViewBox",this,this._viewBox,[b,c,d,e,g]);var h=this.width,k=this.height,l=1/f(d/h,e/k),m,n;g&&(m=k/e,n=h/d,d*m<h&&(b-=(h-d*m)/2/m),e*n<k&&(c-=(k-e*n)/2/n));this._viewBox=[b,c,d,e,!!g];this._viewBoxShift={dx:-b,dy:-c,
scale:l};this.forEach(function(a){a.transform("...")});return this};var D;(function(a){var b=a.document;b.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!b.namespaces.rvml&&b.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),D=function(a){return b.createElement("<rvml:"+a+' class="rvml">')}}catch(c){D=function(a){return b.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}})(a._g.win);a._engine.create=function(){var b=a._getContainer.apply(0,arguments),
c=b.container,d=b.height,e=b.width,f=b.x,b=b.y;if(!c)throw Error("VML container not found.");var g=new a._Paper,h=g.canvas=a._g.doc.createElement("div"),k=h.style;f=f||0;b=b||0;e=e||512;d=d||342;g.width=e;g.height=d;e==+e&&(e+="px");d==+d&&(d+="px");g.coordsize="21600000 21600000";g.coordorigin="0 0";g.span=a._g.doc.createElement("span");g.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;";h.appendChild(g.span);k.cssText=a.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",
e,d);1==c?(a._g.doc.body.appendChild(h),k.left=f+"px",k.top=b+"px",k.position="absolute"):c.firstChild?c.insertBefore(h,c.firstChild):c.appendChild(h);g.renderfix=function(){};return g};a.prototype.clear=function(){a.eve("clear",this);this.canvas.innerHTML="";this.span=a._g.doc.createElement("span");this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;";this.canvas.appendChild(this.span);this.bottom=this.top=null};a.prototype.remove=function(){a.eve("remove",
this);this.canvas.parentNode.removeChild(this.canvas);for(var b in this)this[b]=removed(b);return!0};var H=a.st,C;for(C in z)z.hasOwnProperty(C)&&!H.hasOwnProperty(C)&&(H[C]=function(a){return function(){var b=arguments;return this.forEach(function(c){c[a].apply(c,b)})}}(C))}(window.Raphael);var scratchpadClear;
function Scratchpad(a){function b(){for(var a=0,b=[];a<v.length;a++)v[a].removed||"path"==v[a].type&&b.push({path:v[a].attr("path").toString(),stroke:v[a].attr("stroke"),type:"path"});x.push(b)}function c(){u.animate({y:2},100);z="draw"}function d(){u.animate({y:32},100);z="erase"}function e(){var a=x.pop();v.remove();for(var b=0;b<a.length;b++)"path"==a[b].type&&v.push(n.path(a[b].path).attr(w).attr("stroke",a[b].stroke))}function f(a,c,d){a&&c&&d&&(C&&(C.remove(),C=null),b(),d=v.length,40<a&&("draw"==
z?(D=n.path("M"+a+","+c).attr(w).attr({stroke:q}),H=D.attr("path"),v.push(D)):"erase"==z&&(C=n.rect(a,c,0,0).attr({"fill-opacity":0.15,"stroke-opacity":0.5,fill:"#ff0000",stroke:"#ff0000"}),C.sx=a,C.sy=c)),v.length==d&&x.pop())}function g(a,b){return b.x<a.x+a.width&&b.x+b.width>a.x&&b.y<a.y+a.height&&b.y+b.height>a.y}function h(a){for(var a=a.toString().split("L"),b=a[0].substr(1).split(","),c=+b[0],b=+b[1],d=a[0],e=0,f=1;f<a.length;f++){var g=a[f].split(","),h=Math.pow(+g[0]-c,2)+Math.pow(+g[1]-
b,2);if(10<h||h<e||f==a.length-1)d+="L"+a[f],b=g[1],c=g[0];e=h}return d}function k(){D&&D.attr("path",h(H));D=null;if("erase"==z&&C){b();for(var a=C.getBBox(),c=0;c<v.length;c++)g(a,v[c].getBBox())&&v[c].remove();C.animate({"fill-opacity":0},100,function(){C.remove();C=null})}}function l(a,b){if(!(40>=a))if(D&&"draw"==z)H+="L"+a+","+b,D.attr("path",H);else if("erase"==z&&C){var c=Math.min(a,C.sx),d=Math.min(b,C.sy),e=Math.max(a,C.sx),f=Math.max(b,C.sy);C.attr({x:c,y:d,width:e-c,height:f-d})}}/AppleWebKit.*Mobile/.test(navigator.userAgent);
var m=jQuery(a),n=Raphael(m[0],m.width(),m.height());m.bind("resize",function(){n.setSize(m.width(),m.height())});$("body").bind("selectstart",function(){return!1});for(var o=n.set(),q="#000000",a="#000000,#3f3f3f,#7f7f7f,#bfbfbf,#ff0000,#ff7f00,#ffff00,#00ff00,#00ffff,#007fff,#0000ff,#7f00ff".split(","),r=0;r<a.length;r++)(function(a){var b=function(){q=a;o.animate({x:7},100);this.animate({x:15},100);c()};o.push(n.rect(7,90+24*r,24,24).attr({fill:a,stroke:""}).touchstart(b).click(b))})(a[r]);o[0].attr({x:15});
var u=n.rect(2,2,30,30).attr({r:5,stroke:"",fill:"rgba(30, 157, 186, 0.5)"}),w={"stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},v=n.set(),x=[[]],a=n.set();a.push(n.path("M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z").scale(0.8).translate(0,0));a.push(n.path("M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248").translate(0,
30));a.push(n.path("M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z").scale(0.7).translate(1,60));var z="draw";n.rect(2,2,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(c).touchstart(c);n.rect(2,32,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(d).touchstart(d);n.rect(2,62,30,30).attr({stroke:"",fill:"black","fill-opacity":0}).click(e).touchstart(e);
a.attr({fill:"#000",stroke:"none"});var D=null,H="",C=null;m.mousemove(function(a){var b=jQuery(m).offset();l(a.pageX-b.left,a.pageY-b.top);a.preventDefault()});m.mousedown(function(a){var b=jQuery(m).offset();f(a.pageX-b.left,a.pageY-b.top,a);a.preventDefault();$(document).one("mouseup",function(a){k();a.preventDefault()})});m.bind("touchstart",function(a){var b=jQuery(m).offset();f(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top,a.originalEvent);a.preventDefault()});
m.bind("touchmove",function(a){var b=jQuery(m).offset();l(a.originalEvent.touches[0].pageX-b.left,a.originalEvent.touches[0].pageY-b.top);a.preventDefault()});m.bind("touchend",function(a){k();a.preventDefault()});scratchpadClear=function(){v.remove()}}
(function(a,b,c){function d(){g=b[h](function(){e.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,l);if(c!==e.w||d!==e.h)b.trigger(k,[e.w=c,e.h=d])});d()},f[m])}var e=a([]),f=a.resize=a.extend(a.resize,{}),g,h="setTimeout",k="resize",l=k+"-special-event",m="delay";f[m]=1E3;f.throttleWindow=!0;a.event.special[k]={setup:function(){if(!f.throttleWindow&&this[h])return!1;var b=a(this);e=e.add(b);a.data(this,l,{w:b.width(),h:b.height()});1===e.length&&d()},teardown:function(){if(!f.throttleWindow&&
this[h])return!1;var b=a(this);e=e.not(b);b.removeData(l);e.length||clearTimeout(g)},add:function(b){function d(b,f,g){var h=a(this),k=a.data(this,l);k.w=f!==c?f:h.width();k.h=g!==c?g:h.height();e.apply(this,arguments)}if(!f.throttleWindow&&this[h])return!1;var e;if(a.isFunction(b))return e=b,d;e=b.handler;b.handler=d}}})(jQuery,this);Ext.define("Ext.ux.form.field.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],multiSelect:!0,forceSelection:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,triggerOnClick:!0,stacked:!1,pinList:!0,filterPickList:!1,selectOnFocus:!0,grow:!0,growMin:!1,growMax:!1,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list">',
'<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",
{compiled:!0,disableFormats:!0}],childEls:["listWrapper","itemList","inputEl","inputElCt","emptyEl"],componentLayout:"boxselectfield",emptyInputCls:"x-boxselect-emptyinput",initComponent:function(){var a=this.typeAhead;a&&!this.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings.");Ext.apply(this,{typeAhead:!1});this.callParent();this.typeAhead=a;this.selectionModel=new Ext.selection.Model({store:this.valueStore,mode:"MULTI",lastFocused:null,
onSelectChange:function(a,c,d,e){e()}});!Ext.isEmpty(this.delimiter)&&this.multiSelect&&(this.delimiterRegexp=RegExp((""+this.delimiter).replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")))},initEvents:function(){var a=this;a.callParent(arguments);a.enableKeyEvents||a.mon(a.inputEl,"keydown",a.onKeyDown,a);a.mon(a.inputEl,"paste",a.onPaste,a);a.mon(a.listWrapper,"click",a.onItemListClick,a);a.mon(a.selectionModel,{selectionchange:function(b,c){a.applyMultiselectItemMarkup();a.fireEvent("valueselectionchange",
a,c)},focuschange:function(b,c,d){a.fireEvent("valuefocuschange",a,c,d)},scope:a})},onBindStore:function(a){a&&(this.valueStore=new Ext.data.Store({model:a.model,proxy:{type:"memory"}}),this.mon(this.valueStore,"datachanged",this.applyMultiselectItemMarkup,this),this.selectionModel&&this.selectionModel.bindStore(this.valueStore))},onUnbindStore:function(a){var b=this.valueStore;b&&(this.selectionModel&&(this.selectionModel.setLastFocused(null),this.selectionModel.deselectAll(),this.selectionModel.bindStore(null)),
this.mun(b,"datachanged",this.applyMultiselectItemMarkup,this),b.destroy(),this.valueStore=null);this.callParent(arguments)},createPicker:function(){var a=this.callParent(arguments);this.mon(a,{beforerefresh:this.onBeforeListRefresh,scope:this});this.filterPickList&&a.addCls("x-boxselect-hideselections");return a},onDestroy:function(){Ext.destroyMembers(this,"valueStore","selectionModel");this.callParent(arguments)},getSubTplData:function(){var a=this.callParent(),b=this.emptyText&&1>a.value.length;
a.value="";b?(a.emptyText=this.emptyText,a.emptyCls=this.emptyCls,a.inputElCls=this.emptyInputCls):(a.emptyText="",a.emptyCls=this.emptyInputCls,a.inputElCls="");return a},afterRender:function(){Ext.supports.Placeholder&&this.inputEl&&this.emptyText&&delete this.inputEl.dom.placeholder;this.bodyEl.applyStyles("vertical-align:top");this.grow&&(Ext.isNumber(this.growMin)&&0<this.growMin&&this.listWrapper.applyStyles("min-height:"+this.growMin+"px"),Ext.isNumber(this.growMax)&&0<this.growMax&&this.listWrapper.applyStyles("max-height:"+
this.growMax+"px"));!0===this.stacked&&this.itemList.addCls("x-boxselect-stacked");this.multiSelect||this.itemList.addCls("x-boxselect-singleselect");this.applyMultiselectItemMarkup();this.callParent(arguments)},findRecord:function(a,b){var c=this.store;if(!c)return!1;c=c.queryBy(function(c){return c.isEqual(c.get(a),b)});return 0<c.getCount()?c.first():!1},onLoad:function(){var a=this,b=a.valueField,c=a.valueStore,d=!1;c&&(!Ext.isEmpty(a.value)&&0==c.getCount()&&a.setValue(a.value,!1,!0),c.suspendEvents(),
c.each(function(e){var f=a.findRecord(b,e.get(b)),e=f?c.indexOf(e):-1;0<=e&&(c.removeAt(e),c.insert(e,f),d=!0)}),c.resumeEvents(),d&&c.fireEvent("datachanged",c));a.callParent(arguments)},isFilteredRecord:function(a){var b=this.valueField,a=a.get(b);return-1===this.store.findExact(b,a)&&-1!==this.valueStore.findExact(b,a)},doRawQuery:function(){var a=this.inputEl.dom.value;this.multiSelect&&(a=a.split(this.delimiter).pop());this.doQuery(a,!1,!0)},onBeforeListRefresh:function(){this.ignoreSelection++},
onListRefresh:function(){this.callParent(arguments);0<this.ignoreSelection&&--this.ignoreSelection},onListSelectionChange:function(a,b){var c=this,d=c.valueStore,e=[],f;if(0>=c.ignoreSelection&&c.isExpanded){d.each(function(a){(Ext.Array.contains(b,a)||c.isFilteredRecord(a))&&e.push(a)});e=Ext.Array.merge(e,b);f=Ext.Array.intersect(e,d.getRange()).length;if(f!=e.length||f!=c.valueStore.getCount())c.setValue(e,!1),(!c.multiSelect||!c.pinList)&&Ext.defer(c.collapse,1,c),0<d.getCount()&&c.fireEvent("select",
c,d.getRange());c.inputEl.focus();c.pinList||(c.inputEl.dom.value="");c.selectOnFocus&&c.inputEl.dom.select()}},syncSelection:function(){var a=this.picker,b=this.valueField,c,d;a&&(c=a.store,d=[],this.valueStore&&this.valueStore.each(function(a){a=c.findExact(b,a.get(b));0<=a&&d.push(c.getAt(a))}),this.ignoreSelection++,a=a.getSelectionModel(),a.deselectAll(),0<d.length&&a.select(d),0<this.ignoreSelection&&--this.ignoreSelection)},doAlign:function(){var a=this.picker,b;this.picker.alignTo(this.listWrapper,
this.pickerAlign,this.pickerOffset);b=a.el.getY()<this.inputEl.getY();this.bodyEl[b?"addCls":"removeCls"](this.openCls+"-above");a[b?"addCls":"removeCls"](a.baseCls+"-above")},alignPicker:function(){var a=this.picker,b=a.getTargetEl().dom.scrollTop;this.callParent(arguments);this.isExpanded&&(this.matchFieldWidth&&a.setWidth(this.listWrapper.getWidth()),a.getTargetEl().dom.scrollTop=b)},getCursorPosition:function(){var a;Ext.isIE?(a=document.selection.createRange(),a.collapse(!0),a.moveStart("character",
-this.inputEl.dom.value.length),a=a.text.length):a=this.inputEl.dom.selectionStart;return a},hasSelectedText:function(){var a;return Ext.isIE?(a=document.selection,a=a.createRange(),a.parentElement()==this.inputEl.dom):this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd},onKeyDown:function(a,b){var c=a.getKey(),d=this.inputEl.dom.value,e=this.valueStore,f=this.selectionModel,g=!1;if(!this.readOnly&&!this.disabled&&this.editable){if(this.isExpanded&&c==a.A&&a.ctrlKey)this.select(this.getStore().getRange()),
f.setLastFocused(null),f.deselectAll(),this.collapse(),this.inputEl.focus(),g=!0;else if(0<e.getCount()&&(""==d||0===this.getCursorPosition()&&!this.hasSelectedText()))d=0<f.getCount()?e.indexOf(f.getLastSelected()||f.getLastFocused()):-1,c==a.BACKSPACE||c==a.DELETE?(-1<d?(1<f.getCount()&&(d=-1),this.valueStore.remove(f.getSelection())):this.valueStore.remove(this.valueStore.last()),f.clearSelections(),this.setValue(this.valueStore.getRange()),0<d&&f.select(d-1),g=!0):c==a.RIGHT||c==a.LEFT?-1==d&&
c==a.LEFT?(f.select(e.last()),g=!0):-1<d&&(c==a.RIGHT?d<e.getCount()-1?(f.select(d+1,a.shiftKey),g=!0):a.shiftKey||(f.setLastFocused(null),f.deselectAll(),g=!0):c==a.LEFT&&0<d&&(f.select(d-1,a.shiftKey),g=!0)):c==a.A&&a.ctrlKey&&(f.selectAll(),g=a.A),this.inputEl.focus();g?(this.preventKeyUpEvent=g,a.stopEvent()):(this.isExpanded&&c==a.ENTER&&this.picker.highlightedItem&&(this.preventKeyUpEvent=!0),this.enableKeyEvents&&this.callParent(arguments),!a.isSpecialKey()&&!a.hasModifier()&&(this.selectionModel.setLastFocused(null),
this.selectionModel.deselectAll(),this.inputEl.focus()))}},onKeyUp:function(a,b){var c=this.inputEl.dom.value;if(this.preventKeyUpEvent)a.stopEvent(),(!0===this.preventKeyUpEvent||a.getKey()===this.preventKeyUpEvent)&&delete this.preventKeyUpEvent;else{if(this.multiSelect&&this.delimiterRegexp&&this.delimiterRegexp.test(c)||!0===this.createNewOnEnter&&a.getKey()==a.ENTER)c=Ext.Array.clean(c.split(this.delimiterRegexp)),this.inputEl.dom.value="",this.setValue(this.valueStore.getRange().concat(c)),
this.inputEl.focus();this.callParent([a,b])}},onPaste:function(a){var b=this.inputEl.dom.value,a=a&&a.browserEvent&&a.browserEvent.clipboardData?a.browserEvent.clipboardData:!1;this.multiSelect&&this.delimiterRegexp&&this.delimiterRegexp.test(b)&&(a&&a.getData&&(/text\/plain/.test(a.types)?b=a.getData("text/plain"):/text\/html/.test(a.types)&&(b=a.getData("text/html"))),b=Ext.Array.clean(b.split(this.delimiterRegexp)),this.inputEl.dom.value="",this.setValue(this.valueStore.getRange().concat(b)),this.inputEl.focus())},
onExpand:function(){var a=this.listKeyNav;this.callParent(arguments);!a&&this.filterPickList&&(a=this.listKeyNav,a.highlightAt=function(a){var c=this.boundList,d=c.all.item(a),e=c.all.getCount(),f;if(d&&d.hasCls("x-boundlist-selected")){f=0==a||!c.highlightedItem||c.indexOf(c.highlightedItem)<a?1:-1;do a+=f,d=c.all.item(a);while(0<a&&a<e&&d.hasCls("x-boundlist-selected"));if(d.hasCls("x-boundlist-selected"))return}d&&(d=d.dom,c.highlightItem(d),c.getTargetEl().scrollChildIntoView(d,!1))})},onTypeAhead:function(){var a=
this.displayField,b=this.inputEl.dom,c=this.valueStore,d=this.getPicker(),e,f,g;if(this.filterPickList){var h=this.createFilterFn(a,b.value);e=this.store.findBy(function(a){return-1===c.indexOfId(a.getId())&&h(a)});e=-1===e?!1:this.store.getAt(e)}else e=this.store.findRecord(a,b.value);e&&(a=e.get(a),f=a.length,g=b.value.length,d.highlightItem(d.getNode(e)),0!==g&&g!==f&&(b.value=a,this.selectText(g,a.length)))},onItemListClick:function(a){var b=a.getTarget(".x-boxselect-item"),c=b?a.getTarget(".x-boxselect-item-close"):
!1;if(!this.readOnly&&!this.disabled)if(a.stopPropagation(),b)c?(this.removeByListItemNode(b),0<this.valueStore.getCount()&&this.fireEvent("select",this,this.valueStore.getRange())):this.toggleSelectionByListItemNode(b,a.shiftKey),this.inputEl.focus();else if(0<this.selectionModel.getCount()&&(this.selectionModel.setLastFocused(null),this.selectionModel.deselectAll()),this.triggerOnClick)this.onTriggerClick()},getMultiSelectItemMarkup:function(){var a=this;if(!a.multiSelectItemTpl){if(a.labelTpl){if(Ext.isString(a.labelTpl)||
Ext.isArray(a.labelTpl))a.labelTpl=Ext.create("Ext.XTemplate",a.labelTpl)}else a.labelTpl=Ext.create("Ext.XTemplate","{[values."+a.displayField+"]}");a.multiSelectItemTpl=['<tpl for=".">','<li class="x-tab-default x-boxselect-item ','<tpl if="this.isSelected(values.'+a.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : values.'+a.displayField+']}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',
"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function(b){b=a.valueStore.findExact(a.valueField,b);return 0<=b?a.selectionModel.isSelected(a.valueStore.getAt(b)):!1},getItemLabel:function(b){return a.getTpl("labelTpl").apply(b)}}]}return this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function(){var a=this,b;if(a.itemList){for(;null!=(b=a.inputElCt.prev());)b.remove();a.inputElCt.insertHtml("beforeBegin",a.getMultiSelectItemMarkup())}Ext.Function.defer(function(){a.picker&&
a.isExpanded&&a.alignPicker();a.hasFocus&&a.inputElCt&&a.listWrapper&&a.inputElCt.scrollIntoView(a.listWrapper)},15)},getRecordByListItemNode:function(a){for(var b=0,c=this.itemList.dom.firstChild;c&&c.nextSibling&&!(c==a);){b++;c=c.nextSibling}b=c==a?b:!1;return!1===b?!1:this.valueStore.getAt(b)},toggleSelectionByListItemNode:function(a,b){var c=this.getRecordByListItemNode(a),d=this.selectionModel;c&&(d.isSelected(c)?(d.isFocused(c)&&d.setLastFocused(null),d.deselect(c)):d.select(c,b))},removeByListItemNode:function(a){if(a=
this.getRecordByListItemNode(a))this.valueStore.remove(a),this.setValue(this.valueStore.getRange())},getRawValue:function(){var a=this.inputEl,b;this.inputEl=!1;b=this.callParent(arguments);this.inputEl=a;return b},setRawValue:function(a){var b=this.inputEl;this.inputEl=!1;a=this.callParent([a]);this.inputEl=b;return a},addValue:function(a){a&&this.setValue(Ext.Array.merge(this.value,Ext.Array.from(a)))},removeValue:function(a){a&&this.setValue(Ext.Array.difference(this.value,Ext.Array.from(a)))},
setValue:function(a,b,c){var d=this,e=d.valueStore,f=d.valueField,g,h,k,l,m=[];Ext.isEmpty(a)&&(a=null);Ext.isString(a)&&d.multiSelect&&(a=a.split(d.delimiter));a=Ext.Array.from(a,!0);for(k=0,h=a.length;k<h;k++)if(g=a[k],!g||!g.isModel)l=e.findExact(f,g),0<=l?a[k]=e.getAt(l):(l=d.findRecord(f,g),l||(d.forceSelection?m.push(g):(l={},l[d.valueField]=g,l[d.displayField]=g,l=new d.valueStore.model(l))),l&&(a[k]=l));if(!0!==c&&0<m.length&&"remote"===d.queryMode)return c={},c[d.valueParam||d.valueField]=
m.join(d.delimiter),d.store.load({params:c,callback:function(){d.itemList&&d.itemList.unmask();d.setValue(a,b,!0);d.autoSize();d.lastQuery=!1}}),!1;if(!d.multiSelect&&0<a.length){for(k=a.length-1;0<=k;k--)if(a[k].isModel){a=a[k];break}Ext.isArray(a)&&(a=a[a.length-1])}return d.callParent([a,b])},getValueRecords:function(){return this.valueStore.getRange()},getSubmitData:function(){var a=this.callParent(arguments);this.multiSelect&&this.encodeSubmitValue&&a&&a[this.name]&&(a[this.name]=Ext.encode(a[this.name]));
return a},mimicBlur:function(){this.selectOnTab&&this.picker&&this.picker.highlightedItem&&(this.inputEl.dom.value="");this.callParent(arguments)},assertValue:function(){var a=this.inputEl.dom.value,b=!Ext.isEmpty(a)?this.findRecordByDisplay(a):!1,c=!1;!b&&!this.forceSelection&&this.createNewOnBlur&&!Ext.isEmpty(a)?c=a:b&&(c=b);c&&this.addValue(c);this.inputEl.dom.value="";this.collapse()},checkChange:function(){if(!this.suspendCheckChange&&!this.isDestroyed){var a=this.valueStore,b=this.lastValue||
"",c=this.valueField,d=Ext.Array.map(Ext.Array.from(this.value),function(a){return a.isModel?a.get(c):a},this).join(this.delimiter),e=this.isEqual(d,b);if(!e||0<d.length&&a.getCount()<d.length)a.suspendEvents(),a.removeAll(),Ext.isArray(this.valueModels)&&a.add(this.valueModels),a.resumeEvents(),a.fireEvent("datachanged",a),e||(this.lastValue=d,this.fireEvent("change",this,d,b),this.onChange(d,b))}},isEqual:function(a,b){var c=Ext.Array.from,d=this.valueField,e,f,g,a=c(a),b=c(b);e=a.length;if(e!==
b.length)return!1;for(c=0;c<e;c++)if(f=a[c].isModel?a[c].get(d):a[c],g=b[c].isModel?b[c].get(d):b[c],f!==g)return!1;return!0},applyEmptyText:function(){var a=this.emptyText,b,c;this.rendered&&a&&(c=Ext.isEmpty(this.value)&&!this.hasFocus,b=this.inputEl,c?(b.dom.value="",this.emptyEl.update(a),this.emptyEl.addCls(this.emptyCls),this.emptyEl.removeCls(this.emptyInputCls),this.listWrapper.addCls(this.emptyCls),this.inputEl.addCls(this.emptyInputCls)):(this.emptyEl.addCls(this.emptyInputCls),this.emptyEl.removeCls(this.emptyCls),
this.listWrapper.removeCls(this.emptyCls),this.inputEl.removeCls(this.emptyInputCls)),this.autoSize())},preFocus:function(){var a=this.inputEl,b=""==a.dom.value;this.emptyEl.addCls(this.emptyInputCls);this.emptyEl.removeCls(this.emptyCls);this.listWrapper.removeCls(this.emptyCls);this.inputEl.removeCls(this.emptyInputCls);(this.selectOnFocus||b)&&a.dom.select()},onFocus:function(){var a=this.focusCls,b=this.itemList;a&&b&&b.addCls(a);this.callParent(arguments)},onBlur:function(){var a=this.focusCls,
b=this.itemList;a&&b&&b.removeCls(a);this.callParent(arguments)},renderActiveError:function(){var a=this.invalidCls,b=this.itemList,c=this.hasActiveError();if(a&&b)b[c?"addCls":"removeCls"](this.invalidCls+"-field");this.callParent(arguments)},autoSize:function(){this.grow&&this.rendered&&(this.autoSizing=!0,this.updateLayout());return this},afterComponentLayout:function(){this.autoSizing&&(height=this.getHeight(),height!==this.lastInputHeight&&(this.isExpanded&&this.alignPicker(),this.fireEvent("autosize",
this,height),this.lastInputHeight=height,delete this.autoSizing))}});
Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",waitForOuterWidthInDom:!0,beginLayout:function(a){var b=this.owner;this.callParent(arguments);a.inputElCtContext=a.getEl("inputElCt");b.inputElCt.setStyle("width","");this.skipInputGrowth=!b.grow||!b.multiSelect},beginLayoutFixed:function(a,b,c){var d=a.target;d.triggerEl.setStyle("height","24px");this.callParent(arguments);a.heightModel.fixed&&
a.lastBox&&(d.listWrapper.setStyle("height",a.lastBox.height+"px"),d.itemList.setStyle("height","100%"))},publishInnerWidth:function(a){var b=this.owner,c=b.itemList.getWidth(!0)-10,d=b.inputElCt.prev(null,!0);d&&!b.stacked&&(d=Ext.fly(d),c=c-d.getOffsetsTo(d.up(""))[0]-d.getWidth());!this.skipInputGrowth&&35>c?c-=10:1>c&&(c=1);a.inputElCtContext.setWidth(c)}});function mxIconSet(a){this.images=[];var b=mxClient.IS_TOUCH?"touchstart":"mousedown",c=orig(a.cell);if(0!==getOpacity(c)){if(isValued(c)||"Action"==c.value.nodeName){var d=mxUtils.createImage(builder_path+"/images/equal.png");d.setAttribute("title","");d.style.position="absolute";d.style.cursor="pointer";d.style.width="16px";d.style.height="16px";d.style.left=a.x+2+"px";d.style.top=a.y+2+"px";2>a.width&&(d.style.left=a.x+a.width-20);mxEvent.addListener(d,b,mxUtils.bind(this,function(a){mxEvent.consume(a)}));
mxEvent.addListener(d,"click",mxUtils.bind(this,function(a){showEditor(c);mxEvent.consume(a)}));a.view.graph.container.appendChild(d);this.images.push(d)}null!=c.value.getAttribute("Note")&&""!=Ext.String.trim(c.value.getAttribute("Note"))&&(d=mxUtils.createImage(builder_path+"/images/note.png"),d.setAttribute("title",""),d.style.position="absolute",d.style.cursor="pointer",d.style.width="16px",d.style.height="16px",d.style.left=a.x+a.width-18+"px",d.style.top=a.y+2+"px",2>a.width&&(d.style.left=
a.x+2),mxEvent.addListener(d,b,mxUtils.bind(this,function(a){mxEvent.consume(a)})),mxEvent.addListener(d,"click",mxUtils.bind(this,function(a){var b=Ext.getCmp("note"+c.id);isUndefined(b)?((new Ext.ToolTip({html:"<big>"+clean(c.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:250,draggable:!0,id:"note"+c.id,title:clean(c.value.getAttribute("name")),closeAction:"destroy"})).showAt([a.clientX+17,a.clientY-8]),mxEvent.consume(a)):b.destroy()})),a.view.graph.container.appendChild(d),
this.images.push(d))}}mxIconSet.prototype.destroy=function(){if(null!=this.images)for(var a=0;a<this.images.length;a++){var b=this.images[a];b.parentNode.removeChild(b)}this.images=null};
function setupHoverIcons(){graph.addMouseListener({currentState:null,currentIconSet:null,mouseDown:function(a,b){null!=this.currentState&&(this.dragLeave(b.getEvent(),this.currentState),this.currentState=null)},mouseMove:function(a,b){if(null!=this.currentState&&(b.getState()==this.currentState||null==b.getState())){var c=new mxRectangle(b.getGraphX()-20,b.getGraphY()-20,40,40);if(mxUtils.intersects(c,this.currentState))return}c=graph.view.getState(b.getCell());if(graph.isMouseDown||null!=c&&!graph.getModel().isEdge(c.cell)&&
!graph.getModel().isVertex(c.cell))c=null;c!=this.currentState&&(null!=this.currentState&&this.dragLeave(b.getEvent(),this.currentState),this.currentState=c,null!=this.currentState&&this.dragEnter(b.getEvent(),this.currentState))},mouseUp:function(){},dragEnter:function(a,b){null==this.currentIconSet&&(this.currentIconSet=new mxIconSet(b))},dragLeave:function(){null!=this.currentIconSet&&(this.currentIconSet.destroy(),this.currentIconSet=null)}})};var findAndReplaceWin;
function showFindAndReplace(){if(!findAndReplaceWin){var a=new Ext.FormPanel({fieldDefaults:{labelWidth:100,width:375},autoScroll:!0,frame:!0,defaultType:"textfield",items:[{xtype:"textareafield",fieldLabel:getText("Search Text"),name:"frSearchData",id:"frSearchData",allowBlank:!1,selectOnFocus:!0,height:60,listeners:{change:function(){Ext.getCmp("findNextBut").setDisabled(!0)}}},{xtype:"textareafield",fieldLabel:getText("Replace Text"),name:"frReplaceData",id:"frReplaceData",allowBlank:!0,selectOnFocus:!0,
height:60},{xtype:"checkboxgroup",fieldLabel:getText("Search in"),items:[{boxLabel:getText("Names"),inputValue:"1",name:"frSearchNames",id:"frSearchNames",value:"1",checked:!0,width:90},{boxLabel:getText("Notes"),inputValue:"1",name:"frSearchNotes",id:"frSearchNotes",width:90},{boxLabel:getText("Equations"),inputValue:"1",name:"frSearchValues",id:"frSearchValues",width:90}]},{xtype:"checkboxfield",fieldLabel:getText("Case Sensitive"),inputValue:"1",name:"frCaseSensitive",id:"frCaseSensitive"}]});
findAndReplaceWin=new Ext.Window({title:getText("Find and Replace"),layout:"fit",closeAction:"hide",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"left",layoutConfig:{columns:1},width:404,height:275,items:[a],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){findAndReplaceWin.hide()}},"->",{scale:"large",iconCls:"replace-icon",text:getText("Replace All"),handler:function(){var a=primitives(),c=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&"),d=Ext.getCmp("frReplaceData").getValue(),e=Ext.getCmp("frSearchNames").getValue(),f=Ext.getCmp("frSearchValues").getValue(),g=Ext.getCmp("frSearchNotes").getValue(),c=Ext.getCmp("frCaseSensitive").getValue()?RegExp(c,"g"):RegExp(c,"ig");if(!e&&!f&&!g)mxUtils.alert(getText("You must search within at least one category."));else{graph.getModel().beginUpdate();for(var h=0;h<a.length;h++){var k=a[h];k.isVisible()&&(e&&getName(k)&&setName(k,getName(k).replace(c,d)),g&&getNote(k)&&setNote(k,getNote(k).replace(c,
d)),f&&getValue(k)&&setValue(k,getValue(k).replace(c,d)))}graph.getModel().endUpdate();findAndReplaceWin.hide()}}},{scale:"large",iconCls:"find-icon",text:getText("Find Next"),disabled:!0,id:"findNextBut",tooltip:cmd("G"),handler:function(){findNext()}},{scale:"large",iconCls:"find-icon",text:getText("Find"),handler:function(){findFirst()}}]})}findAndReplaceWin.show();Ext.getCmp("frSearchData").focus(!0,100)}var currentFindPrimitive;
function findNext(){var a=primitives(),b=Ext.getCmp("frSearchData").getValue().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c=Ext.getCmp("frSearchNames").getValue(),d=Ext.getCmp("frSearchValues").getValue(),e=Ext.getCmp("frSearchNotes").getValue(),b=Ext.getCmp("frCaseSensitive").getValue()?RegExp(b):RegExp(b,"i");if(!c&&!d&&!e)mxUtils.alert("You must search within at least one category.");else{var f=0;if(currentFindPrimitive)for(var g=0;g<a.length;g++)if(currentFindPrimitive.id==a[g].id){f=
g+1;break}f>=a.length&&(f=0);var h=2;for(0==f&&(h=1);0<h;){for(g=f;g<a.length;g++)if(currentFindPrimitive=f=a[g],f.isVisible()){if(c&&getName(f)&&-1!=getName(f).search(b)){highlight(f);findAndReplaceWin.hide();return}if(e&&getNote(f)&&-1!=getNote(f).search(b)){highlight(f);findAndReplaceWin.hide();showNote(f);return}if(d&&getValue(f)&&-1!=getValue(f).replace("/\\n/g","\n").search(b)){highlight(f);findAndReplaceWin.hide();showEditor(f);return}}h--;f=0}mxUtils.alert("Search text not found in model.")}}
function findFirst(){Ext.getCmp("findNextBut").setDisabled(!1);currentFindPrimitive=null;findNext()};var timeSettingsFn=function(){var a=getSetting();showTimeSettings({algorithm:a.getAttribute("SolutionAlgorithm"),timeStep:a.getAttribute("TimeStep"),timeStart:a.getAttribute("TimeStart"),timeUnits:a.getAttribute("TimeUnits"),timeLength:a.getAttribute("TimeLength"),timePause:a.getAttribute("TimePause")})};
function showTimeSettings(a){var b=new Ext.Window({layout:"fit",closeAction:"destroy",modal:!0,title:getText("Simulation Time Settings"),width:Math.min(Ext.getBody().getViewSize().width,370),height:Math.min(Ext.getBody().getViewSize().height,!a.cell?400:180),resizable:!1,plain:!0,items:[new Ext.FormPanel({fieldDefaults:{labelWidth:150},autoScroll:!1,frame:!0,bodyStyle:"padding:5px 5px 0",width:450,defaults:{width:330},id:"timeSettingsForm",defaultType:"textfield",items:[new Ext.form.field.Checkbox({hidden:!a.cell,
fieldLabel:getText("Custom Time Settings"),id:"sEnabled",checked:a.enabled,listeners:{change:function(a,b){Ext.getCmp("sSolutionAlgo").setDisabled(!b);Ext.getCmp("stimestep").setDisabled(!b)}}}),new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Simulation Start"),id:"stimestart",allowBlank:!1,minValue:0,decimalPrecision:12,value:a.timeStart}),new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Simulation Length"),id:"stimelength",allowBlank:!1,minValue:0,decimalPrecision:12,value:a.timeLength}),
{hidden:a.cell,xtype:"radiogroup",id:"tunits",fieldLabel:getText("Time Units"),columns:1,items:[{boxLabel:getText("Seconds"),name:"tunits",inputValue:"Seconds",checked:"Seconds"==a.timeUnits},{boxLabel:getText("Minutes"),name:"tunits",inputValue:"Minutes",checked:"Minutes"==a.timeUnits},{boxLabel:getText("Hours"),name:"tunits",inputValue:"Hours",checked:"Hours"==a.timeUnits},{boxLabel:getText("Days"),name:"tunits",inputValue:"Days",checked:"Days"==a.timeUnits},{boxLabel:getText("Weeks"),name:"tunits",
inputValue:"Weeks",checked:"Weeks"==a.timeUnits},{boxLabel:getText("Months"),name:"tunits",inputValue:"Months",checked:"Months"==a.timeUnits},{boxLabel:getText("Years"),name:"tunits",inputValue:"Years",checked:"Years"==a.timeUnits}]},new Ext.form.NumberField({hidden:a.cell,fieldLabel:getText("Pause Interval"),id:"stimepause",allowBlank:!0,minValue:0,decimalPrecision:12,value:a.timePause}),new Ext.form.ComboBox({fieldLabel:getText("Analysis Algorithm"),typeAhead:!0,triggerAction:"all",queryMode:"local",
selectOnFocus:!0,forceSelection:!0,store:[["RK1",getText("Fast (Euler)")],["RK4",getText("Accurate (RK4)")]],id:"sSolutionAlgo",editable:!1,value:a.algorithm,disabled:a.cell&&!a.enabled}),new Ext.form.NumberField({fieldLabel:getText("Simulation Time Step"),id:"stimestep",allowBlank:!1,minValue:1.0E-12,step:0.1,decimalPrecision:12,value:a.timeStep,disabled:a.cell&&!a.enabled})],buttons:[{xtype:"button",scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){b.close()}},{xtype:"button",
iconCls:"apply-icon",scale:"large",text:getText("Apply"),handler:function(){graph.getModel().beginUpdate();if(a.cell)d=new mxCellAttributeChange(a.cell,"Solver",JSON.stringify({enabled:Ext.getCmp("sEnabled").getValue(),timeStep:Ext.getCmp("stimestep").getValue().toString(),algorithm:Ext.getCmp("sSolutionAlgo").getValue()}));else{var c=getSetting(),d=new mxCellAttributeChange(c,"SolutionAlgorithm",Ext.getCmp("sSolutionAlgo").getValue());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeLength",
Ext.getCmp("stimelength").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeStart",Ext.getCmp("stimestart").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeStep",Ext.getCmp("stimestep").getValue().toString());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimePause",Ext.getCmp("stimepause").getValue());graph.getModel().execute(d);d=new mxCellAttributeChange(c,"TimeUnits",Ext.getCmp("timeSettingsForm").getValues().tunits)}graph.getModel().execute(d);
graph.getModel().endUpdate();b.close()}}]})]});b.show();return b};function textEquations(){function a(a){return isTrue(a)?getText("Yes"):getText("No")}function b(a){for(var b="",c=0;c<a.length;c++)b=b+"<li><b>"+a[c][0]+":</b> "+a[c][1]+"</li>";return"<ul style='list-style-type: none;'>"+b+"</ul>"}function c(a,b){h=h+"<tr class='textRow"+(k?"Odd":"Even")+"'><td class='textName'>"+a+"</td><td>"+b+"</td></tr>";k=!k}function d(a){h=h+"<tr class='textDivider'><td colspan=2>"+a+"</td></tr>";k=!0}function e(a){return a&&null!=a?clean(a.getAttribute("name")):"<i>"+getText("None")+
"</i>"}function f(a,b){b.getAttribute("Note")&&a.push([getText("Note"),clean(b.getAttribute("Note"))]);return a}function g(a){a=primitives(a);a.sort(function(a,b){return e(a).toUpperCase()>e(b).toUpperCase()?1:-1});return a}var h="<table style='width:100%'>",k=!0,l=getSetting();c("Simulation Settings",b([[getText("Time Start"),clean(l.getAttribute("TimeStart"))],[getText("Time Length"),clean(l.getAttribute("TimeLength"))],[getText("Time Step"),clean(l.getAttribute("TimeStep"))],[getText("Time Units"),
clean(l.getAttribute("TimeUnits"))],[getText("Algorithm"),clean(l.getAttribute("SolutionAlgorithm"))]]));m=g("Variable");if(0<m.length){d(getText("Model Variables"));for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Value"),equationRenderer(getValue(m[l]))],[getText("Units"),clean(m[l].getAttribute("Units"))]],m[l])))}var m=g("Stock");if(0<m.length){d(getText("Model Stocks"));for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Initial Value"),equationRenderer(getValue(m[l]))],[getText("Non-Negative"),a(m[l].getAttribute("NonNegative"))],
[getText("Units"),clean(m[l].getAttribute("Units"))]],m[l])))}m=g("Flow");if(0<m.length){d(getText("Model Flows"));for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Rate"),equationRenderer(getValue(m[l]))],[getText("Alpha"),clean(e(m[l].source))],[getText("Omega"),clean(e(m[l].target))],[getText("Positive Only"),a(m[l].getAttribute("OnlyPositive"))],[getText("Units"),clean(m[l].getAttribute("Units"))]],m[l])))}m=g("Converter");if(0<m.length){d(getText("Model Converters"));for(l=0;l<m.length;l++)c(e(m[l]),
b(f([[getText("Data"),clean(getValue(m[l]).replace(/\;/g,"; "))],[getText("Source"),clean("Time"==m[l].getAttribute("Source")?"Time":e(findID(m[l].getAttribute("Source"))))],[getText("Interpolation"),getText(clean(m[l].getAttribute("Interpolation")))],[getText("Units"),clean(m[l].getAttribute("Units"))]],m[l])))}m=g("State");if(0<m.length){d(getText("Model States"));for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Initial Active"),equationRenderer(getValue(m[l]))]],m[l])))}m=g("Transition");if(0<m.length){d(getText("Model Transitions"));
for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Trigger"),clean(m[l].getAttribute("Trigger"))],[getText("Value"),equationRenderer(getValue(m[l]))]],m[l])))}m=g("Action");if(0<m.length){d(getText("Model Actions"));for(l=0;l<m.length;l++)c(e(m[l]),b(f([[getText("Trigger"),clean(m[l].getAttribute("Trigger"))],[getText("Trigger Value"),equationRenderer(m[l].getAttribute("Value"))],[getText("Action"),equationRenderer(getValue(m[l]))]],m[l])))}var h=h+"</table>",l=Ext.create("Ext.tab.Panel",{xtype:"tabpanel",
layout:"fit",activeTab:0,plain:!0,flex:1,items:[{title:getText("Insight Equations"),xtype:"box",html:h,style:"background-color: white",autoScroll:!0},{padding:4,title:getText("Full Insight Specification"),xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:getText("Complete Insight specification including equations and styling. You may use this to fully backup the Insight to your computer.")},{flex:1,readOnly:!0,xtype:"textareafield",hideLabel:!0,
value:getGraphXml(graph).replace(/mxGraphModel/g,"InsightMakerModel")}]}]}),n=new Ext.Window({title:getText("Complete Model Equation List"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,maximizable:!0,resizable:!0,shadow:!0,buttonAlign:"right",layoutConfig:{columns:1},width:Math.min(Ext.getBody().getViewSize().width,500),height:Math.min(Ext.getBody().getViewSize().height,400),items:l,buttons:[{scale:"large",iconCls:"import-icon",text:getText("Import Equations"),handler:function(){importModel();
n.close()}},"->",{scale:"large",iconCls:"apply-icon",text:getText("Done"),handler:function(){n.close()}}]});n.show()};Ext.form.customFields.richText=Ext.extend(Ext.form.customFields.richText,{onTriggerClick:function(){this.suspendEvents(!1);this.editorWindow=new Ext.RichTextWindow({parent:this,html:this.getValue()});this.editorWindow.show()},listeners:{keydown:function(a){a.setEditable(!1)},beforerender:function(){void 0!=this.regex&&(this.validator=function(a){return this.regex.test(a)})}}});
Ext.RichTextWindow=function(a){var b=this;b.args=a;b.win=new Ext.Window({title:getText("Note Editor"),layout:{type:"fit"},closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,420),height:Math.min(Ext.getBody().getViewSize().height,350),items:[new Ext.form.field.HtmlEditor({enableColors:!1,enableSourceEdit:!0,enableFont:!1,enableLists:!0,enableFontSize:!1,fieldLabel:"",name:"richTextItem",id:"richTextItem",allowBlank:!0,
emptyText:getText("Enter a Note..."),value:b.args.html})],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){b.win.close();""!=b.args.parent&&b.args.parent.resumeEvents()}},{scale:"large",iconCls:"apply-icon",text:getText("Apply"),handler:function(){""!=b.args.parent?(b.args.parent.setValue(Ext.getCmp("richTextItem").getValue()),b.win.close(),b.args.parent.resumeEvents(),grid.plugins[0].completeEdit()):(graph.getModel().beginUpdate(),setNote(b.args.cell,Ext.getCmp("richTextItem").getValue()),
graph.getModel().endUpdate(),selectionChanged(!1),b.win.close())}}]});b.show=function(){b.win.show()}};function importModel(){var a=Ext.create("Ext.tab.Panel",{xtype:"tabpanel",layout:"fit",activeTab:0,plain:!0,flex:1,items:[{padding:4,title:"Insight Maker",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:getText('Enter an Insight Maker Insight specification. This specification should begin with "&lt;InsightMakerModel&gt;" and end with "&lt;/InsightMakerModel&gt;".')},{flex:1,xtype:"textareafield",hideLabel:!0,name:"impIM",id:"impIM",
selectOnFocus:!0}]},{padding:4,hidden:!0,title:"Simgua",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",height:40,fieldLabel:"",value:'Enter a Simgua export file created using <a href="#">this macro</a>.'},{flex:1,xtype:"textareafield",hideLabel:!0,name:"impSimgua",id:"impSimgua",selectOnFocus:!0}]},{padding:4,hidden:!0,title:"STELLA",xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{height:40,xtype:"displayfield",fieldLabel:"",value:'Copy and paste the STELLA equation list. Equations preferences should be set to "Order by execution".'},
{flex:1,xtype:"textareafield",hideLabel:!0,name:"impSTELLA",id:"impSTELLA",selectOnFocus:!0}]}]}),b={padding:8,xtype:"container",frame:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",fieldLabel:"",value:getText("Select the type of import. Warning: your current model will be cleared on import.")},a]},c=new Ext.Window({title:getText("Import Insight Equations"),layout:"fit",closeAction:"destroy",border:!1,modal:!0,resizable:!1,shadow:!0,buttonAlign:"right",width:480,height:420,items:[b],
buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){c.close()}},{scale:"large",iconCls:"apply-icon",text:getText("Import Equations"),handler:function(){if("Insight Maker"==a.getActiveTab().title){if(""==Ext.getCmp("impIM").getValue().trim()){alert(getText("No Insight Equations were entered."));return}try{importMXGraph(Ext.getCmp("impIM").getValue())}catch(b){isLocal()&&console.log(b);mxUtils.alert(getText("Import could not be completed as an error was encountered."));
return}}else if("Simgua"==a.getActiveTab().title)try{importSimgua(Ext.getCmp("impSimgua").getValue())}catch(e){isLocal()&&console.log(e);mxUtils.alert(getText("Import could not be completed as an error was encountered."));return}else if("STELLA"==a.getActiveTab().title)try{importSTELLA(Ext.getCmp("impSTELLA").getValue())}catch(f){isLocal()&&console.log(f);mxUtils.alert(getText("Import could not be completed as an error was encountered."));return}clearPrimitiveCache();setAllConnectable();c.close()}}]});
c.show()}function cellWithOldID(a){for(var b=primitives(),c=0;c<b.length;c++)if(b[c].getAttribute("oldId")==a)return b[c];throw"Cell not found: "+a;}
function showInsertModelWindow(a){Ext.Msg.prompt("Insert Insight Maker Model","Enter the URL for the Insight Maker model you wish to insert (e.g. <i>"+base_path+"/insight/1234</i>). This model will be inserted as a component into your current model.",function(b,c){if("ok"==b){var d=Ext.MessageBox.wait(getText("Inserting Model..."),void 0,{icon:"run-icon",width:300,closable:!1,modal:!0,progress:!0,progressText:" "});$.ajax({url:c,dataType:"html",success:function(b){var c=b.match(/var graph_source_data = "(.*?)";\n/);
if(!c||""==c[1].trim())mxUtils.alert("Model could not be inserted. Please ensure the model URL is correct.");else{var g=c[1],c=b.match(/var graph_title = "(.*?)";\n/)[1].replace(/\\\"/,'"').replace(/\\n/,"\n").replace(/\\\//,"/").replace(/\\\\/,"\\"),b=b.match(/var graph_description = "(.*?)";\n/)[1].replace(/\\\"/,'"').replace(/\\n/,"\n").replace(/\\\//,"/").replace(/\\\\/,"\\"),g=g.replace(/\\"/g,'"').replace(/\\\//g,"/").replace(/\\n/g,"\n"),g=mxUtils.parseXml(g),g=(new mxCodec(g)).decode(g.documentElement).cells,
h;for(h in g)g[h].setAttribute("oldId",h);graph.getModel().beginUpdate();h=createPrimitive(c,"Folder",[a.x,a.y],[100,100]);g=g[1].children;g=excludeType(g,"Settings");g=excludeType(g,"Display");graph.importCells(g,0,0,h);c=primitives();c.forEach(function(a){if(void 0!=a.getAttribute("oldId"))if("Converter"==a.value.nodeName){var b=a.getAttribute("Source");"*"!=b[0]&&"Time"!=b&&a.setAttribute("Source",cellWithOldID(b).id)}else"Agents"==a.value.nodeName?a.setAttribute("Agent",cellWithOldID(a.getAttribute("Agent")).id):
"Ghost"==a.value.nodeName&&a.setAttribute("Source",cellWithOldID(a.getAttribute("Source")).id)});c.map(function(a){a.setAttribute("oldId",void 0)});setImage(h,"Plugin");setNote(h,b);b=h.geometry;b.alternateBounds=new mxRectangle(0,0,128,128);graph.getModel().setGeometry(h,b);collapseFolder(h);h.setAttribute("LabelPosition","Bottom");setLabelPosition(h);graph.getModel().endUpdate();clearPrimitiveCache();setAllConnectable()}d.close()},error:function(){mxUtils.alert("Model could not be inserted. Please ensure the morel URL is correct.");
d.close()}})}})}function importMXGraph(a){graph_source_data=a.replace(/InsightMakerModel/g,"mxGraphModel");a=mxUtils.parseXml(graph_source_data);(new mxCodec(a)).decode(a.documentElement,graph.getModel());clearPrimitiveCache();setAllConnectable()}
function importSimgua(a){function b(a){return null==a?c:a}clearModel();graph.getModel().beginUpdate();for(var c=createPrimitive("temp stock xyzz","Stock",[200,200],[100,100]),a=a.split("\n"),d=0;d<a.length;d++){var e=a[d].split(" --- "),f=e[0];if("STOCK"==f){var g=createPrimitive(e[1],"Stock",[500*Math.random(),500*Math.random()],[100,40]);setValue(g,e[3]);setNonNegative(g,"true"==e[2])}else"VARIABLE"==f?(g=createPrimitive(e[1],"Variable",[500*Math.random(),500*Math.random()],[120,50]),setValue(g,
e[2])):"CONVERTER"==f?(g=createPrimitive(e[1],"Converter",[500*Math.random(),500*Math.random()],[120,50]),setData(g,e[4]),setInterpolation(g,1==e[2]?"Linear":"Discrete")):"SETTING"==f&&(setTimeStart(e[1]),setTimeLength(e[2]),setTimeStep(e[3]))}for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"FLOW"==f&&(g=createConnector(e[1],"Flow",b(findName(e[2])),b(findName(e[3]))),setValue(g,e[5]),setNonNegative(g,"true"==e[4]));for(d=0;d<a.length;d++)e=a[d].split(" --- "),f=e[0],"LINK"==f?g=createConnector(e[1],
"Link",findName(e[2]),findName(e[3])):"CONVERTER"==f&&setConverterInput(findName(e[1]),findName(e[3]));layoutModel("organic");graph.getModel().endUpdate()}
function importSTELLA(a){for(var b=a.split(/\r?\n/g),a=[],c,d,e,f=void 0,g=0;g<b.length;g++){var h=b[g],k=h.split(" ");if("{"==k[0])"INITIALIZATION"==k[1]?f="init":"RUNTIME"==k[1]?f="run":"TIME"==k[1]&&(f="config");else if("init"==f)if(":"==k[0])"s"==k[1]||"S"==k[1]?(h=!0,"S"==k[1]&&(h=!1),a.push({type:"stock",name:k[2],equation:k[4],nonNegative:h})):"c"==k[1]?a.push({type:"variable",name:k[2],equation:k.slice(4).join(" ")}):"f"==k[1]&&a.push({type:"flow",name:k[2],equation:k.slice(4).join(" ")});
else if("("==h[0]){var l=a[a.length-1];a.push({type:"converter",name:l.name,data:h,equation:l.name+"_Input"});l.name+="_Input"}else"DOCUMENT:"==k[0]&&(l=a[a.length-1],l.note=k.slice(1).join(" "));else if("run"==f){if(":"==k[0]&&("s"==k[1]||"S"==k[1])){l=k.slice(8,k.length-2);l[0]=l[0].substr(1);l[l.length-1]=l[l.length-1].substr(0,l[l.length-1].length-1);for(var m="in",n=0;n<l.length;n++)if("-"==l[n])m="out";else if("+"==l[n])m="in";else for(var h=l[n],o=0;o<a.length;o++)"flow"==a[o].type&&a[o].name==
h&&("in"==m?a[o].omega=k[2].split("(")[0]:a[o].alpha=k[2].split("(")[0])}}else"config"==f&&(k=h.split("="),"STARTTIME"==k[0]?c=k[1]:"STOPTIME"==k[0]?d=k[1]:"DT"==k[0]&&(e=k[1]))}clearModel();setTimeStart(c);setTimeLength(d-c);setTimeStep(e);c=a.map(function(){return null});for(g=0;g<a.length;g++)d=a[g],"stock"==d.type?(e=createPrimitive(fixStellaName(d.name),"Stock",[100,100],[140,40]),setValue(e,fixStellaEquation(d.equation)),setNonNegative(e,d.nonNegative),c[g]=e):"variable"==d.type?(e=createPrimitive(fixStellaName(d.name),
"Variable",[100,100],[140,40]),setValue(e,fixStellaEquation(d.equation)),c[g]=e):"converter"==d.type&&(e=createPrimitive(fixStellaName(d.name),"Converter",[100,100],[140,40]),setData(e,convertStellaConverter(d.data)),c[g]=e);for(g=0;g<a.length;g++)d=a[g],"flow"==d.type&&(h=fixStellaName(d.name),e=c[getStellaPrimitive(a,d.alpha)],b=c[getStellaPrimitive(a,d.omega)],e=createConnector(h,"Flow",e,b),setValue(e,fixStellaEquation(d.equation)),c[g]=e);for(g=0;g<a.length;g++)if(d=a[g],d.note&&setNote(c[g],
d.note),d.equation)if("converter"==d.type)d=c[getStellaPrimitive(a,d.equation)],createConnector("Link","Link",d,c[g]),setConverterInput(c[g],d);else{e=RegExp("([A-Za-z][A-Za-z0-9\\\\_]+)($|[^(A-Za-z])","g");for(h=e.exec(d.equation.replace(/ /g,""));null!=h;)createConnector("Link","Link",c[getStellaPrimitive(a,h[1])],c[g]),h=e.exec(d.equation.replace(/ /g,""))}setMacros("#STELLA Compatibility Functions\nGRAPH(x) <- x\nINIT(x) <- Delay(x, (timeLength/timeStep)*10)");layoutModel("organic")}
function getStellaPrimitive(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return c}function convertStellaConverter(a){a=a.split("), (");a[0]=a[0].substr(1);a[a.length-1]=a[a.length-1].substr(0,a[a.length-1].length-1);for(var b=0;b<a.length;b++)a[b]=a[b].replace(", ",",");return a.join(";")}function fixStellaName(a){return a.replace(/[\/\\\*\+\-_]/g," ")}
function fixStellaEquation(a){a=a.replace(/ /g,"").replace(/([A-Za-z][A-Za-z0-9\\_]+)($|\b[^(A-Za-z])/g,"[$1]$2");a=a.replace(/_/g," ");return a=a.replace(/\\/g," ")}
function cleanMXGraphSnippet(a){var b=""+Math.floor(1E4*Math.random()),a=a.replace(/parent=\"1\"/g,"XXXROOT PARENTXXX"),a=a.replace(/id=\"(\d+)\"/g,'id="'+b+'$1"'),a=a.replace(/source=\"(\d+)\"/g,'source="'+b+'$1"'),a=a.replace(/Source=\"(\d+)\"/g,'Source="'+b+'$1"'),a=a.replace(/target=\"(\d+)\"/g,'target="'+b+'$1"'),a=a.replace(/parent=\"(\d+)\"/g,'parent="'+b+'$1"'),a=a.replace(/Agent=\"(\d+)\"/g,'Agent="'+b+'$1"'),a=a.replace(/Primitives=\"([\d\,]+)\"/g,'Primitives="'+b+'$1"'),a=a.replace(/Primitives2=\"([\d\,]+)\"/g,
'Primitives2="'+b+'$1"');return a=a.replace(/XXXROOT PARENTXXX/g,'parent="1"')}function cleanMXGraph(){var a=prompt("Enter mxGraphXML:");console.log(cleanMXGraphSnippet(a))};var recordingRes;
function generateRecording(){recordingRes=[];for(var a=undoHistory.history.map(function(a){return a.changes}),b=[],c=0;c<a.length;c++)b=b.concat(a[c]);for(c=0;c<b.length;c++){console.log("Item: "+c);a=serializeChange(b[c]);if(capture&&null!==a&&(a.id!=capture.id||("attribute"!=a.type||"name"!=a.attribute)&&"geometry"!=a.type&&"terminal"!=a.type))console.log("Removing capture"),console.log(a.id),console.log(capture.id),console.log(a.type),capture=!1;console.log(a);capture&&null!==a?(console.log("Inserting into capture"),
"attribute"==a.type?capture[a.attribute]=a.value:"terminal"==a.type?(isDefined(a.alpha)&&(capture.alpha=a.alpha),isDefined(a.omega)&&(capture.omega=a.omega)):"geometry"==a.type&&(capture.geometry=a.geometry)):(console.log("Adding change"),null!==a&&recordingRes.push(a))}b=JSON.stringify(cleanIds(recordingRes)).replace(/\}\,\{(.[^x])/g,"}\n\n{$1");return b.substr(1,b.length-2)}
function cleanIds(a){for(var b=0;b<a.length;b++)a[b].id=void 0,"attribute"==a[b].type&&(a[b].type=void 0,"Agent"==a[b].attribute&&(a[b].value=getName(findID(a[b].value)))),"create"==a[b].type&&(a[b].create=a[b].primitive,a[b].primitive=void 0,a[b].type=void 0),"geometry"==a[b].type&&(a[b].type=void 0),"remove"==a[b].type&&(a[b].remove=a[b].target,a[b].target=void 0,a[b].type=void 0);return a}var capture=!1,folderItems=[];
function serializeChange(a){if(a instanceof mxCellAttributeChange){if(a.value==a.previous||""==a.value&&isUndefined(a.previous))return null;var b={type:"attribute",id:a.cell.id,attribute:a.attribute};b.target="name"==a.attribute?a.previous:"Display"==a.cell.value.nodeName?"DISPLAY":a.cell.getAttribute("name");b.value="Primitives"==a.attribute?getName(findID(a.value.split(","))):a.value;return b}if(a instanceof mxChildChange){if(isUndefined(a.index))return{type:"remove",target:a.child.getAttribute("name")};
if(a.parent.value)folderItems.push(a.child);else{b=a.child.geometry;capture={type:"create",id:a.child.id,primitive:a.child.value.nodeName,geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};if(b.sourcePoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))capture.geometry.sourcePoint={x:b.sourcePoint.x,y:b.sourcePoint.y};if(b.targetPoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))capture.geometry.targetPoint={x:b.targetPoint.x,
y:b.targetPoint.y};if("Folder"==a.child.value.nodeName){if(0==folderItems.length)return null;capture.items=getName(folderItems);folderItems=[]}recordingRes.push(capture)}return null}if(a instanceof mxGeometryChange){if(0<folderItems.length)return null;b=a.cell.geometry;a={type:"geometry",id:a.cell.id,target:a.cell.getAttribute("name"),geometry:{x:b.x,y:b.y,width:b.width,height:b.height}};if(b.sourcePoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))a.geometry.sourcePoint=
{x:b.sourcePoint.x,y:b.sourcePoint.y};if(b.targetPoint&&!(0==b.sourcePoint.x&&100==b.sourcePoint.y||100==b.sourcePoint.x&&0==b.sourcePoint.y))a.geometry.targetPoint={x:b.targetPoint.x,y:b.targetPoint.y};b.points&&(a.geometry.points=b.points.slice().map(function(a){return{x:a.x,y:a.y}}));return a}if(a instanceof mxTerminalChange){b={type:"terminal",id:a.cell.id,target:a.cell.getAttribute("name")};a.source&&(b.alpha=a.terminal?a.terminal.getAttribute("name"):null);a.source||(b.omega=a.terminal?a.terminal.getAttribute("name"):
null);return!1==capture||capture.id!=b.id?(capture=b,recordingRes.push(capture),null):b}return null};var unfoldingManager={unfolding:!1};function beginUnfolding(){unfoldingManager.unfolding=!0;unfoldingManager.init=getGraphXml(graph);initUnfolding()}function restartUnfolding(a){loadStoredUnfolding();a&&(saveUnfoldingStatus(a),unfoldingManager.init=getGraphXml(graph));initUnfolding()}
function saveUnfoldingStatus(a){var b=unfoldingManager.unfolding;unfoldingManager.unfolding=!1;graph.getModel().beginUpdate();var c=new mxCellAttributeChange(getSetting(),"unfolding",a.steps);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingStatus",a.enabled);graph.getModel().execute(c);c=new mxCellAttributeChange(getSetting(),"unfoldingAuto",a.auto);graph.getModel().execute(c);graph.getModel().endUpdate();unfoldingManager.unfolding=b}
function finishUnfolding(){unfoldingManager.unfolding=!1;loadStoredUnfolding();selectionChanged()}function loadStoredUnfolding(){unfoldingManager.init&&(importMXGraph(unfoldingManager.init),!is_editor&&is_embed&&1==is_zoom&&(graph.getView().setScale(0.25),graph.fit(),graph.fit()))}
function initUnfolding(){unfoldingManager.steps=JSON.parse(getSetting().getAttribute("unfolding"));unfoldingManager.step=0;Ext.getCmp("messageUnfoldBut").update("");Ext.getCmp("nextUnfoldBut").setDisabled(!1);doUnfoldStep()}
function doUnfoldStep(){unfoldingManager.steps.children.length>unfoldingManager.step&&(executeUnfoldAction(unfoldingManager.steps.children[unfoldingManager.step]),unfoldingManager.step++);unfoldingManager.steps.children.length<=unfoldingManager.step&&Ext.getCmp("nextUnfoldBut").setDisabled(!0)}
function executeUnfoldAction(a){if("group"==a.type)for(var b=0;b<a.children.length;b++)executeUnfoldAction(a.children[b]);else if("note"==a.type)Ext.getCmp("messageUnfoldBut").getEl().down(".message")?(Ext.getCmp("messageUnfoldBut").getEl().down(".message").fadeOut({duration:300}),setTimeout(function(){Ext.getCmp("messageUnfoldBut").update("<div class='message'>"+a.data+"</div>")},400)):Ext.getCmp("messageUnfoldBut").update("<div class='message'>"+a.data+"</div>");else if("visibility"==a.type)b=JSON.parse(a.data),
graph.getModel().beginUpdate(),setOpacity(findID(b.ids).filter(function(a){return null!==a}),b.opacity),graph.getModel().endUpdate();else if("action"==a.type)runAction(a.data);else if("folder"==a.type){var b=JSON.parse(a.data),c=findID(b.ids).filter(function(a){return null!==a});"expand"==b.mode?expandFolder(c):collapseFolder(c)}else alert("Unknown action!"),console.log(a)}
var handleUnfoldToolbar=function(a){var b="on"==getSetting().getAttribute("unfoldingStatus"),c=Ext.getCmp("unfoldToolbar");if(!a||b&&c.isHidden()||!b&&!c.isHidden())b?c.show():c.hide(),a=!1,c=getSetting().getAttribute("unfoldingAuto"),isUndefined(c)&&(c="non-editors"),"never"!=c&&("always"==c?a=!0:is_embed&&"editors"!=c?a=!0:"editors"==c&&is_editor?a=!0:"non-editors"==c&&!is_editor&&(a=!0)),revealUnfoldButtons(a),a&&b&&beginUnfolding()},revealUnfoldButtons=function(a){a?(Ext.getCmp("unfoldUnfoldBut").hide(),
Ext.getCmp("reloadUnfoldBut").show(),is_ebook||Ext.getCmp("exitUnfoldBut").show(),Ext.getCmp("messageUnfoldBut").show(),Ext.getCmp("nextUnfoldBut").show()):(Ext.getCmp("unfoldUnfoldBut").show(),Ext.getCmp("reloadUnfoldBut").hide(),Ext.getCmp("exitUnfoldBut").hide(),Ext.getCmp("messageUnfoldBut").hide(),Ext.getCmp("nextUnfoldBut").hide())};
function showUnfoldingWin(){function a(){if(Ext.getCmp("opacitySlider")){var a=Ext.getCmp("opacitySlider").getValue(),b=Ext.getCmp("unfoldingPrimitives").getValue();g.set("data",JSON.stringify({opacity:a,ids:b}))}}function b(){if(Ext.getCmp("modeCombo")){var a=Ext.getCmp("modeCombo").getValue(),b=Ext.getCmp("unfoldingFolders").getValue();g.set("data",JSON.stringify({mode:a,ids:b}))}}function c(a){var b=function(c){var d=c.data,e={text:d.text,data:d.data,type:d.type,leaf:d.leaf,expanded:d.expanded};
a&&(e.flag=d.flag);e.children=[];for(d=0;d<c.childNodes.length;d++)e.children.push(b(c.childNodes[d]));return e};return b(h.getRootNode())}function d(a){var b=k.getRootNode(),c=b.childNodes.length+1;g&&("group"==g.get("type")&&g.isExpanded()?(b=g,c=0):(b=g.parentNode,c=b.indexOf(g)+1));a=b.insertChild(c,a);k.getSelectionModel().select(a)}var e=!1,f=getSetting(),g,h=new Ext.data.TreeStore({fields:[{name:"text",type:"string"},{name:"type",type:"string"},{name:"data",type:"string"},{name:"flag",type:"string"}],
proxy:{type:"memory"}});f.getAttribute("unfolding")?h.setRootNode(JSON.parse(f.getAttribute("unfolding"))):h.setRootNode({text:"Root Node",type:"root",id:"src",expanded:!0});for(var k=Ext.create("Ext.tree.Panel",{title:getText("Story Steps"),disabled:"on"!=f.getAttribute("unfoldingStatus"),useArrows:!0,flex:1,rootVisible:!1,id:"stepsTree",store:h,viewConfig:{plugins:{ptype:"treeviewdragdrop",containerScroll:!0}},listeners:{select:{fn:function(a,b){e=!0;g&&g.set("flag","");g=b;var c=g.get("type");
g.set("flag","selected");"visibility"==c?(r.getLayout().setActiveItem(1),c=JSON.parse(g.get("data")),Ext.getCmp("opacitySlider").setValue(c.opacity),Ext.getCmp("unfoldingPrimitives").setValue(c.ids)):"note"==c?(Ext.getCmp("actionNote").setValue(g.get("data")),r.getLayout().setActiveItem(2)):"action"==c?(Ext.getCmp("actionCode").setValue(g.get("data")),r.getLayout().setActiveItem(3)):"group"==c?(Ext.getCmp("groupName").setValue(g.get("text")),r.getLayout().setActiveItem(4)):"folder"==c&&(r.getLayout().setActiveItem(5),
c=JSON.parse(g.get("data")),Ext.getCmp("modeCombo").setValue(c.mode),Ext.getCmp("unfoldingFolders").setValue(c.ids));e=!1}}},bbar:[{iconCls:"units-remove-icon",text:getText("Remove"),scope:this,handler:function(){function a(b){for(var c=0;c<b.children.length;c++)"selected"==b.children[c].flag?(b.children.splice(c,1),c--):a(b.children[c])}var b=c(!0);a(b);h.setRootNode(b);r.getLayout().setActiveItem(0);g=null}},"->",{iconCls:"units-add-icon",text:getText("Add Step"),scope:this,menu:{xtype:"menu",items:[{text:getText("Change Visibility"),
handler:function(){d({text:getText("Visibility Change"),data:'{"opacity": 100, "ids": []}',type:"visibility",leaf:!0})}},{text:getText("Show Message"),handler:function(){d({text:getText("Show Message"),data:getText("Enter your message..."),type:"note",leaf:!0})}},{text:getText("Toggle Folders"),handler:function(){d({text:getText("Toggle Folders"),data:'{"mode": "expand", "ids": []}',type:"folder",leaf:!0})}},"-",{text:getText("Run Action"),handler:function(){d({text:getText("Run Action"),data:"",
type:"action",leaf:!0})}},"-",{text:getText("Group Steps"),handler:function(){d({text:getText("New Group"),type:"group",leaf:!1,expanded:!0})}}]}}]}),l=[],m=findAll(),n=0;n<m.length;n++){var o=getName(m[n]);l.push({pid:getID(m[n]),pname:isDefined(o)?o:"--"})}l.sort(function(a,b){return a.pname.localeCompare(b.pname)});for(var q=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:l}),l=[],m=findType("Folder"),n=0;n<m.length;n++)o=getName(m[n]),l.push({pid:getID(m[n]),
pname:isDefined(o)?o:"--"});l.sort(function(a,b){return a.pname.localeCompare(b.pname)});var l=new Ext.data.JsonStore({fields:[{name:"pid",type:"string"},{name:"pname",type:"string"}],data:l}),r=Ext.create("Ext.container.Container",{flex:1,layout:"card",items:[{xtype:"form",padding:8,bodyStyle:"background:none",border:!1},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Opacity")+":"},{xtype:"slider",
id:"opacitySlider",value:100,increment:1,minValue:0,animate:!1,listeners:{change:a}},{xtype:"displayfield",value:getText("Primitives")+":"},Ext.create("Ext.ux.form.field.BoxSelect",{hideLabel:!0,name:"unfoldingPrimitives",id:"unfoldingPrimitives",displayField:"pname",valueField:"pid",queryMode:"local",store:q,emptyText:getText("Data"),listeners:{change:a}}),{xtype:"button",text:getText("Select from Diagram"),handler:function(){Ext.getCmp("unfoldingPrimitives").setValue(getSelected().map(function(a){return getID(a)}))}}]},
{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Message")+":"},{xtype:"htmleditor",enableColors:!1,enableSourceEdit:!0,enableFont:!1,enableLists:!0,enableFontSize:!1,id:"actionNote",hideLabel:!0,flex:1,listeners:{change:function(a,b){e||g.set("data",b)}}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Action Code")+
":"},{xtype:"textareafield",id:"actionCode",flex:1,hideLabel:!0,listeners:{change:function(a,b){g.set("data",b)}}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,plain:!0,items:[{xtype:"textfield",id:"groupName",fieldLabel:getText("Name"),labelWidth:60,allowBlank:!1,listeners:{change:function(a,b){g.set("text",b)}}}]},{xtype:"form",padding:8,bodyStyle:"background:none",border:!1,autoScroll:!0,layout:{type:"vbox",align:"stretch"},items:[{xtype:"displayfield",value:getText("Action")+
":"},{xtype:"combo",id:"modeCombo",hideLabel:!0,store:[["expand",getText("Expand")],["collapse",getText("Collapse")]],forceSelection:!0,listeners:{select:b}},{xtype:"displayfield",value:getText("Folders")+":"},Ext.create("Ext.ux.form.field.BoxSelect",{hideLabel:!0,name:"unfoldingFolders",id:"unfoldingFolders",displayField:"pname",valueField:"pid",queryMode:"local",store:l,emptyText:getText("Folders"),listeners:{change:b}})]}]}),q={padding:8,xtype:"container",frame:!1,layout:{type:"hbox",align:"stretch"},
items:[k,r]},u=new Ext.Window({title:getText("Story Designer"),layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,shadow:!0,buttonAlign:"right",width:Math.min(Ext.getBody().getViewSize().width,480),height:Math.min(Ext.getBody().getViewSize().height,420),items:[q],tbar:[{xtype:"checkbox",id:"enabledChk",labelWidth:70,hideLabel:!0,boxLabel:getText("Enabled"),checked:"on"==f.getAttribute("unfoldingStatus"),listeners:{change:function(a,b){b?Ext.getCmp("stepsTree").setDisabled(!1):(Ext.getCmp("stepsTree").setDisabled(!0),
r.getLayout().setActiveItem(0))}}},"->",{xtype:"combo",id:"autoCombo",fieldLabel:getText("Automatically View")+":",labelWidth:130,store:[["never",getText("Never")],["editors",getText("For Editors")],["non-editors",getText("For Non-Editors")],["always",getText("Always")]],forceSelection:!0,value:f.getAttribute("unfoldingAuto")||"non-editors",listeners:{select:function(){}}}],buttons:[{scale:"large",iconCls:"cancel-icon",text:getText("Cancel"),handler:function(){u.close()}},{scale:"large",iconCls:"apply-icon",
text:getText("Apply"),handler:function(){var a={steps:JSON.stringify(c()),enabled:Ext.getCmp("enabledChk").getValue()?"on":"off",auto:Ext.getCmp("autoCombo").getValue()};unfoldingManager.unfolding?restartUnfolding(a):saveUnfoldingStatus(a);handleUnfoldToolbar(!0);u.close()}}]});u.show()};Ext.Loader.setConfig({enabled:!0});Ext.Loader.setPath("Ext.ux.exporter","/builder/js/exporter");
Ext.define("Ext.ux.exporter.Exporter",{uses:["Ext.ux.exporter.Base64","Ext.ux.exporter.Button","Ext.ux.exporter.csvFormatter.CsvFormatter"],statics:{exportAny:function(a,b,c){var d="export";a.is?a.is("gridpanel")?d+="Grid":a.is("treepanel")?d+="Tree":(d+="Store",a=a.getStore()):d+="Store";return this[d](a,this.getFormatterByName(b),c)},exportGrid:function(a,b,c){var c=c||{},b=this.getFormatterByName(b),d=Ext.Array.filter(a.columns,function(a){return!a.hidden});Ext.applyIf(c,{title:a.title,columns:d});
return b.format(a.store,c)},exportStore:function(a,b,c){c=c||{};b=this.getFormatterByName(b);Ext.applyIf(c,{columns:a.fields?a.fields.items:a.model.prototype.fields.items});return b.format(a,c)},exportTree:function(a,b,c){var c=c||{},b=this.getFormatterByName(b),d=a.store||c.store;Ext.applyIf(c,{title:a.title});return b.format(d,c)},getFormatterByName:function(a){a=a?a:"csv";return a=!Ext.isString(a)?a:Ext.create("Ext.ux.exporter."+a+"Formatter."+Ext.String.capitalize(a)+"Formatter")}}});(function(){Downloadify=window.Downloadify={queue:{},uid:(new Date).getTime(),getTextForSave:function(a){return(a=Downloadify.queue[a])?a.getData():""},getFileNameForSave:function(a){return(a=Downloadify.queue[a])?a.getFilename():""},getDataTypeForSave:function(a){return(a=Downloadify.queue[a])?a.getDataType():""},saveComplete:function(a){(a=Downloadify.queue[a])&&a.complete();return!0},saveCancel:function(a){(a=Downloadify.queue[a])&&a.cancel();return!0},saveError:function(a){(a=Downloadify.queue[a])&&
a.error();return!0},addToQueue:function(a){Downloadify.queue[a.queue_name]=a},getUID:function(a){""==a.id&&(a.id="downloadify_"+Downloadify.uid++);return a.id}};Downloadify.create=function(a,b){var c="string"==typeof a?document.getElementById(a):a;return new Downloadify.Container(c,b)};Downloadify.Container=function(a,b){var c=this;c.el=a;c.enabled=!0;c.dataCallback=null;c.filenameCallback=null;c.data=null;c.filename=null;c.enable=function(){document.getElementById(c.flashContainer.id).setEnabled(!0);
c.enabled=!0};c.disable=function(){document.getElementById(c.flashContainer.id).setEnabled(!1);c.enabled=!1};c.getData=function(){return!c.enabled?"":c.dataCallback?c.dataCallback():c.data?c.data:""};c.getFilename=function(){return c.filenameCallback?c.filenameCallback():c.filename?c.filename:""};c.getDataType=function(){return c.options.dataType?c.options.dataType:"string"};c.complete=function(){if("function"===typeof c.options.onComplete)c.options.onComplete()};c.cancel=function(){if("function"===
typeof c.options.onCancel)c.options.onCancel()};c.error=function(){if("function"===typeof c.options.onError)c.options.onError()};(function(){c.options=b;c.options.append||(c.el.innerHTML="");c.flashContainer=document.createElement("span");c.el.appendChild(c.flashContainer);c.queue_name=Downloadify.getUID(c.flashContainer);"function"===typeof c.options.filename?c.filenameCallback=c.options.filename:c.options.filename&&(c.filename=c.options.filename);"function"===typeof c.options.data?c.dataCallback=
c.options.data:c.options.data&&(c.data=c.options.data);var a={queue_name:c.queue_name,width:c.options.width,height:c.options.height},e={allowScriptAccess:"always"},f={id:c.flashContainer.id,name:c.flashContainer.id};!1===c.options.enabled&&(c.enabled=!1);!0===c.options.transparent&&(e.wmode="transparent");c.options.downloadImage&&(a.downloadImage=c.options.downloadImage);swfobject.embedSWF(c.options.swf,c.flashContainer.id,c.options.width,c.options.height,"10",null,a,e,f);Downloadify.addToQueue(c)})()};
Downloadify.defaultOptions={swf:"media/downloadify.swf",downloadImage:"images/download.png",width:100,height:30,transparent:!0,append:!1,dataType:"string"}})();"undefined"!=typeof jQuery&&function(a){a.fn.downloadify=function(b){return this.each(function(){b=a.extend({},Downloadify.defaultOptions,b);var c=Downloadify.create(this,b);a(this).data("Downloadify",c)})}}(jQuery);
"undefined"!=typeof MooTools&&Element.implement({downloadify:function(a){a=$merge(Downloadify.defaultOptions,a);return this.store("Downloadify",Downloadify.create(this,a))}});var swfobject=function(){function a(){if(!T){try{var a=A.getElementsByTagName("body")[0].appendChild(A.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}T=!0;for(var a=B.length,c=0;c<a;c++)B[c]()}}function b(a){T?a():B[B.length]=a}function c(a){if(typeof C.addEventListener!=x)C.addEventListener("load",a,!1);else if(typeof A.addEventListener!=x)A.addEventListener("load",a,!1);else if(typeof C.attachEvent!=x)q(C,"onload",a);else if("function"==typeof C.onload){var b=C.onload;C.onload=
function(){b();a()}}else C.onload=a}function d(){var a=A.getElementsByTagName("body")[0],b=A.createElement(z);b.setAttribute("type",D);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=x){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),P.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}function e(){var a=I.length;if(0<a)for(var b=0;b<a;b++){var c=I[b].id,
d=I[b].callbackFn,e={success:!1,id:c};if(0<P.pv[0]){var l=o(c);if(l)if(r(I[b].swfVersion)&&!(P.wk&&312>P.wk))w(c,!0),d&&(e.success=!0,e.ref=f(c),d(e));else if(I[b].expressInstall&&g()){e={};e.data=I[b].expressInstall;e.width=l.getAttribute("width")||"0";e.height=l.getAttribute("height")||"0";l.getAttribute("class")&&(e.styleclass=l.getAttribute("class"));l.getAttribute("align")&&(e.align=l.getAttribute("align"));for(var m={},l=l.getElementsByTagName("param"),n=l.length,q=0;q<n;q++)"movie"!=l[q].getAttribute("name").toLowerCase()&&
(m[l[q].getAttribute("name")]=l[q].getAttribute("value"));h(e,m,c,d)}else k(l),d&&d(e)}else if(w(c,!0),d){if((c=f(c))&&typeof c.SetVariable!=x)e.success=!0,e.ref=c;d(e)}}}function f(a){var b=null;if((a=o(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=x?b=a:(a=a.getElementsByTagName(z)[0])&&(b=a);return b}function g(){return!R&&r("6.0.65")&&(P.win||P.mac)&&!(P.wk&&312>P.wk)}function h(a,b,c,d){R=!0;O=d||null;Q={success:!1,id:c};var e=o(c);if(e){"OBJECT"==e.nodeName?(L=l(e),K=null):(L=e,K=c);a.id=
H;if(typeof a.width==x||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==x||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";A.title=A.title.slice(0,47)+" - Flash Player Installation";d=P.ie&&P.win?"ActiveX":"PlugIn";d="MMredirectURL="+C.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+A.title;b.flashvars=typeof b.flashvars!=x?b.flashvars+("&"+d):d;P.ie&&P.win&&4!=e.readyState&&(d=A.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",
c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());m(a,b,c)}}function k(a){if(P.ie&&P.win&&4!=a.readyState){var b=A.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(l(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(l(a),a)}function l(a){var b=A.createElement("div");if(P.win&&
P.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(z)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function m(a,b,c){var d,e=o(c);if(P.wk&&312>P.wk)return d;if(e)if(typeof a.id==x&&(a.id=c),P.ie&&P.win){var f="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+
g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";E[E.length]=a.id;d=o(a.id)}else{h=A.createElement(z);h.setAttribute("type",D);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&
(a=h,g=f,k=b[f],c=A.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function n(a){var b=o(a);b&&"OBJECT"==b.nodeName&&(P.ie&&P.win?(b.style.display="none",function(){if(4==b.readyState){var c=o(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=null;try{b=A.getElementById(a)}catch(c){}return b}
function q(a,b,c){a.attachEvent(b,c);M[M.length]=[a,b,c]}function r(a){var b=P.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function u(a,b,c,d){if(!P.ie||!P.mac){var e=A.getElementsByTagName("head")[0];if(e){c=c&&"string"==typeof c?c:"screen";d&&(ba=G=null);if(!G||ba!=c)d=A.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),G=e.appendChild(d),
P.ie&&P.win&&typeof A.styleSheets!=x&&0<A.styleSheets.length&&(G=A.styleSheets[A.styleSheets.length-1]),ba=c;P.ie&&P.win?G&&typeof G.addRule==z&&G.addRule(a,b):G&&typeof A.createTextNode!=x&&G.appendChild(A.createTextNode(a+" {"+b+"}"))}}}function w(a,b){if(Z){var c=b?"visible":"hidden";T&&o(a)?o(a).style.visibility=c:u("#"+a,"visibility:"+c)}}function v(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=x?encodeURIComponent(a):a}var x="undefined",z="object",D="application/x-shockwave-flash",
H="SWFObjectExprInst",C=window,A=document,y=navigator,F=!1,B=[function(){F?d():e()}],I=[],E=[],M=[],L,K,O,Q,T=!1,R=!1,G,ba,Z=!0,P=function(){var a=typeof A.getElementById!=x&&typeof A.getElementsByTagName!=x&&typeof A.createElement!=x,b=y.userAgent.toLowerCase(),c=y.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",f=[0,0,0],g=null;if(typeof y.plugins!=x&&typeof y.plugins["Shockwave Flash"]==
z){if((g=y.plugins["Shockwave Flash"].description)&&!(typeof y.mimeTypes!=x&&y.mimeTypes[D]&&!y.mimeTypes[D].enabledPlugin))F=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof C.ActiveXObject!=x)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(h&&(g=h.GetVariable("$version")))e=!0,g=g.split(" ")[1].split(","),
f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){P.w3&&((typeof A.readyState!=x&&"complete"==A.readyState||typeof A.readyState==x&&(A.getElementsByTagName("body")[0]||A.body))&&a(),T||(typeof A.addEventListener!=x&&A.addEventListener("DOMContentLoaded",a,!1),P.ie&&P.win&&(A.attachEvent("onreadystatechange",function(){"complete"==A.readyState&&(A.detachEvent("onreadystatechange",arguments.callee),a())}),C==top&&function(){if(!T){try{A.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),P.wk&&function(){T||(/loaded|complete/.test(A.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))})();(function(){P.ie&&P.win&&window.attachEvent("onunload",function(){for(var a=M.length,b=0;b<a;b++)M[b][0].detachEvent(M[b][1],M[b][2]);a=E.length;for(b=0;b<a;b++)n(E[b]);for(var c in P)P[c]=null;P=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(P.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=
d;I[I.length]=e;w(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(P.w3)return f(a)},embedSWF:function(a,c,d,e,f,k,l,n,o,q){var u={success:!1,id:c};P.w3&&!(P.wk&&312>P.wk)&&a&&c&&d&&e&&f?(w(c,!1),b(function(){d+="";e+="";var b={};if(o&&typeof o===z)for(var v in o)b[v]=o[v];b.data=a;b.width=d;b.height=e;v={};if(n&&typeof n===z)for(var y in n)v[y]=n[y];if(l&&typeof l===z)for(var A in l)v.flashvars=typeof v.flashvars!=x?v.flashvars+("&"+A+"="+l[A]):A+"="+l[A];if(r(f))y=m(b,v,c),b.id==
c&&w(c,!0),u.success=!0,u.ref=y;else{if(k&&g()){b.data=k;h(b,v,c,q);return}w(c,!0)}q&&q(u)})):q&&q(u)},switchOffAutoHideShow:function(){Z=!1},ua:P,getFlashPlayerVersion:function(){return{major:P.pv[0],minor:P.pv[1],release:P.pv[2]}},hasFlashPlayerVersion:r,createSWF:function(a,b,c){if(P.w3)return m(a,b,c)},showExpressInstall:function(a,b,c,d){P.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){P.w3&&n(a)},createCSS:function(a,b,c,d){P.w3&&u(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=
A.location.search||A.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return v(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return v(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(R){var a=o(H);a&&L&&(a.parentNode.replaceChild(L,a),K&&(w(K,!0),P.ie&&P.win&&(L.style.display="block")),O&&O(Q));R=!1}}}}();Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function(a){a=a||{};Ext.applyIf(a,{})}});(function(){Ext.define("Ext.ux.exporter.Base64",{statics:{encode:function(a){var b="",c,d,e,f,g,h,k=0,a=a.replace(/\r\n/g,"\n");d="";for(e=0;e<a.length;e++)f=a.charCodeAt(e),128>f?d+=String.fromCharCode(f):(127<f&&2048>f?d+=String.fromCharCode(f>>6|192):(d+=String.fromCharCode(f>>12|224),d+=String.fromCharCode(f>>6&63|128)),d+=String.fromCharCode(f&63|128));for(a=d;k<a.length;)c=a.charCodeAt(k++),d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=c>>2,c=(c&3)<<4|d>>4,g=(d&15)<<2|e>>6,h=e&63,isNaN(d)?g=h=64:
isNaN(e)&&(h=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return b}}})})();Ext.define("Ext.ux.exporter.Button",{extend:"Ext.Component",alias:"widget.exporterbutton",html:"<div></div>",config:{swfPath:"/builder/resources/exporter/downloadify.swf",downloadImage:"/builder/resources/exporter/download.png",width:62,height:22,downloadName:"download"},constructor:function(a){a=a||{};this.initConfig();Ext.ux.exporter.Button.superclass.constructor.call(this,a);var b=this;this.on("afterrender",function(){b.setComponent(b.store||b.component||b.up("gridpanel")||b.up("treepanel"),a)})},
setComponent:function(a,b){this.component=a;this.store=!a.is?a:a.getStore();this.setDownloadify(b)},setDownloadify:function(a){var b=this;Downloadify.create(this.el.down("div").id,{filename:function(){return b.getDownloadName()+"."+Ext.ux.exporter.Exporter.getFormatterByName(b.formatter).extension},data:function(){return Ext.ux.exporter.Exporter.exportAny(b.component,b.formatter,a)},transparent:!1,swf:this.getSwfPath(),downloadImage:this.getDownloadImage(),width:this.getWidth(),height:this.getHeight(),
transparent:!0,append:!1})}});Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:",",extension:"csv",format:function(a,b){this.columns=b.columns||(a.fields?a.fields.items:a.model.prototype.fields.items);return this.getHeaders()+"\n"+this.getRows(a)},getHeaders:function(){var a=[];Ext.each(this.columns,function(b){var c;void 0!=b.text?c=b.text:b.name&&(c=b.name.replace(/_/g," "),c=Ext.String.capitalize(c));a.push(c)},this);return a.join(this.separator)},
getRows:function(a){var b=[];a.each(function(a,d){b.push(this.geCell(a,d))},this);return b.join("\n")},geCell:function(a){var b=[];Ext.each(this.columns,function(c){if(c=c.name||c.dataIndex)c=a.get(c),b.push(c)});return b.join(this.separator)}});function showMessage(a){alert(a)}function showPrompt(a,b){return prompt(a,b)}function showChoice(a){return confirm(a)}function showURL(a){window.open(a,"","scrollbars=yes,menubar=yes,height=500,width=700,resizable=yes,toolbar=yes,location=yes,status=yes")}
function showData(a,b,c){c||(c=[Math.min(Ext.getBody().getViewSize().width,640),Math.min(Ext.getBody().getViewSize().height,480)]);for(var d=[],e=0;e<b.length;e++){var f={layout:"fit"};f.title=b[e].name;if("text"==b[e].type.toLowerCase())f.items=[{xtype:"textareafield",value:b[e].data,readOnly:!0}];else if("html"==b[e].type.toLowerCase())f.items=[{title:"Insight Equations",xtype:"box",html:b[e].data,style:"background-color: white",autoScroll:!0}];else if("table"==b[e].type.toLowerCase()){for(var g=
{xtype:"grid"},h=[],k=[],l=[],m=0;m<b[e].data.length;m++){h.push({dataIndex:"a"+m,text:b[e].header?b[e].header[m]:""});for(var n="float",o=0;o<b[e].data[m].length;o++)"string"==typeof b[e].data[m][e]&&(n="string");k.push({name:"a"+m,type:n})}for(o=0;o<b[e].data[0].length;o++)l.push({});for(m=0;m<b[e].data.length;m++)for(o=0;o<b[e].data[0].length;o++)l[o]["a"+m]=b[e].data[m][o];g.columns=h;g.store=new Ext.data.JsonStore({fields:k,data:l});b[e].header||(g.hideHeaders=!0);g.dockedItems=[{xtype:"toolbar",
dock:"bottom",items:["->",{xtype:"exporterbutton",downloadName:b[e].name}]}];f.items=[g]}else if("chart"==b[e].type.toLowerCase()){for(var k="#94ae0a,#115fa6,#a61120,#ff8809,#ffd13e,#a61187,#24ad9a,#7c7474,#a66111".split(","),l=0,q=[],m=0;m<b[e].data.length;m++)b[e].data[m].color?q.push(b[e].data[m].color):(q.push(k[l]),l++,l%=k.length);m="theme"+Math.random();Ext.chart.theme[m]=Ext.extend(Ext.chart.theme.Base,{constructor:function(a){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({colors:q},
a))}});g=[];k=[{name:"x",type:"Numeric"==b[e].xType?"float":"string"}];h=[];l=[];for(m=0;m<b[e].xData.length;m++)l.push({x:b[e].xData[m]});for(m=0;m<b[e].data.length;m++){k.push({name:"a"+m,type:"float"});g.push({type:b[e].data[m].type,title:b[e].data[m].name,axis:"left",xField:"x",yField:"a"+m,showInLegend:b[e].data[m].hideLegend?!1:!0,fill:b[e].data[m].fill?b[e].data[m].fill:!1,showMarkers:b[e].data[m].hideMarkers?!1:!0,style:{opacity:1}});b[e].data[m].color&&(g[g.length-1].style={stroke:b[e].data[m].color,
fill:b[e].data[m].color,opacity:1});h.push("a"+m);for(o=0;o<b[e].data[m].data.length;o++)l[o]["a"+m]=b[e].data[m].data[o]}m={xtype:"chart",background:{fill:"#fff"},animate:!1,shadow:!1,legend:{position:b[e].legend,visible:b[e].legend&&"none"!=b[e].legend},store:new Ext.data.JsonStore({fields:k,data:l}),axes:[{position:"bottom",type:b[e].xType?b[e].xType:"Numeric",grid:b[e].verticalGrid?b[e].verticalGrid:!1,title:b[e].xLabel?b[e].xLabel:"",fields:["x"]},{position:"left",type:"Numeric",grid:b[e].horizontalGrid?
b[e].horizontalGrid:!1,title:b[e].yLabel?b[e].yLabel:"",fields:h}],series:g};f.items=[m]}else alert("Unknown tab type: "+b[e].type);d.push(f)}var r=new Ext.Window({title:a,layout:"fit",closeAction:"destroy",border:!1,modal:!1,resizable:!0,closable:!0,maximizable:!0,minimizable:!0,shadow:!0,width:c[0],height:c[1],items:[{xtype:"tabpanel",layout:"fit",items:d}]});r.on("minimize",function(a){a.expandedState?(a.expandedState=!1,a.collapse()):(a.expandedState=!0,r.expand())});r.show();return r}
function frontWindow(){return Ext.WindowMgr.getActive()}function closeAllWindows(){for(var a;a=Ext.WindowMgr.getActive();)a.close()}
function openFile(a){a=a||{multiple:!1,accept:null,onCompleted:null,onSelected:null,onError:null,read:!1};a.read&&(a.read=a.read.toLowerCase());"xlsx"==a.read&&!a.accept&&(a.accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");var b=document.createElement("input");b.setAttribute("type","file");a.multiple&&b.setAttribute("multiple",!0);a.accept&&b.setAttribute("accept",a.accept);var c=null,d=0,e=function(){document.body.removeChild(b);if(c.length){if(d++,d==c.length)a.onCompleted(c)}else a.onCompleted(c)},
f=function(b){var c={};c.file=b;c.size=b.size;c.name=b.name;c.type=b.type;var d=new FileReader;d.onloadend=function(){"xlsx"==a.read?require(["jszip"],function(){require(["xlsx"],function(){c.contents=XLSX.read(d.result,{type:"binary"});e()})}):(c.contents=d.result,e())};d.onerror=function(){if(a.onError)a.onError(d.error);else alert("FileReader error."),console.log("FileReader Error"),console.log(d.error)};d.onabort=function(){if(a.onError)a.onError(d.error);else alert("FileReader aborted."),console.log("FileReader Error"),
console.log(d.error)};if("binary"==a.read)d.readAsBinaryString(b);else if("text"==a.read)d.readAsText(b);else if("xlsx"==a.read)d.readAsBinaryString(b);else{if(a.read)throw"Unknown data read type: "+a.type;setTimeout(e,1)}return c};b.onchange=function(){var d=b.files;if(a.onSelected)a.onSelected(d);if(a.onCompleted){if("undefined"==typeof d[0])a.onCompleted(null);c=a.multiple?Array.prototype.slice.call(d).map(function(a){return f(a)}):f(d[0])}};document.body.appendChild(b);b.click()}
function runModel(a){if(simulationRunning())mxUtils.alert(getText("You have an existing simulation running that has not been completed. Either close the results window or press the windows 'Stop' button. You may then run a new simulation.")),simulate.resultsWindow.show();else return isUndefined(a)?a={}:"boolean"==typeof a&&(a={silent:a}),runSimulation(a)}function simulationRunning(){return simulate&&!simulate.completed()}function endRunningSimulation(){simulate&&simulate.terminate()}
function saveModel(a){a||""==graph_title?updateProperties():sendGraphtoServer(graph)}function clearModel(){graph.getModel().beginUpdate();graph.allowButtonSelect=!0;graph.selectAll();graph.allowButtonSelect=!1;graph.removeCells(graph.getSelectionCells(),!1);graph.getModel().endUpdate()}
function layoutModel(a){"organic"==a?(a=new mxFastOrganicLayout(graph),a.forceConstant=50,executeLayout(a,!0)):"circular"==a?executeLayout(new mxCircleLayout(graph),!0):"hierarchical"==a?(a=new mxCompactTreeLayout(graph),a.horizontal=!1,a.resizeParent=!1,a.moveTree=!1,executeLayout(a,!0)):alert("Unknown layout algorithm: "+a)}
var executeLayout=function(a,b,c){var d=graph.getSelectionCell();if(null==d||!c&&0==graph.getModel().getChildCount(d))d=graph.getDefaultParent();graph.getModel().beginUpdate();try{a.execute(d)}catch(e){throw e;}finally{b&&0>navigator.userAgent.indexOf("Camino")?(a=new mxMorphing(graph),a.addListener(mxEvent.DONE,function(){graph.getModel().endUpdate()}),a.startAnimation()):graph.getModel().endUpdate()}};
function setZoom(a){"fit"==a?graph.fit():"actual"==a?graph.zoomActual():"in"==a?graph.zoomIn():"out"==a?graph.zoomOut():graph.getView().setScale(a)}function getTimeStep(){return parseFloat(getSetting().getAttribute("TimeStep"))}function setTimeStep(a){a=new mxCellAttributeChange(getSetting(),"TimeStep",a);graph.getModel().execute(a)}function getTimeStart(){return parseFloat(getSetting().getAttribute("TimeStart"))}
function setTimeStart(a){a=new mxCellAttributeChange(getSetting(),"TimeStart",a);graph.getModel().execute(a)}function getTimeLength(){return parseFloat(getSetting().getAttribute("TimeLength"))}function setTimeLength(a){a=new mxCellAttributeChange(getSetting(),"TimeLength",a);graph.getModel().execute(a)}function getPauseInterval(){return parseFloat(getSetting().getAttribute("TimePause"))}
function setPauseInterval(a){a=new mxCellAttributeChange(getSetting(),"TimePause",a);graph.getModel().execute(a)}function getTimeUnits(){return getSetting().getAttribute("TimeUnits")}function setTimeUnits(a){a=new mxCellAttributeChange(getSetting(),"TimeUnits",a);graph.getModel().execute(a)}function getAlgorithm(){return getSetting().getAttribute("SolutionAlgorithm")}function setAlgorithm(a){a=new mxCellAttributeChange(getSetting(),"SolutionAlgorithm",a);graph.getModel().execute(a)}
function getMacros(){return getSetting().getAttribute("Macros")}function setMacros(a){a=new mxCellAttributeChange(getSetting(),"Macros",a);graph.getModel().execute(a)}
function findName(a){var b=map(a,function(a){for(var b=[],e=findAll(),f=0;f<e.length;f++)isDefined(e[f].getAttribute("name"))&&e[f].getAttribute("name").toLowerCase()==a.toLowerCase()&&b.push(e[f]);return b}),b=Ext.Array.flatten(b),b=Ext.Array.filter(b,function(a){return null!==a});return a instanceof Array?b:0==b.length?null:1==b.length?b[0]:b}function findAll(){for(var a=primitives(),b=[],c=0;c<a.length;c++)"Setting"==a[c].value.nodeName||"Display"==a[c].value.nodeName||b.push(a[c]);return b}
function findType(a){a=map(a,function(a){return primitives(a)});return a=Ext.Array.flatten(a)}function findID(a){var b=primitives(),c=map(a,function(a){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c];return null});return null===c?c:a instanceof Array?c:1==c.length?c[0]:c}
function findValue(a){var b=findAll(),a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getValue(b[e]))&&d.push(b[e]):getValue(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(Ext.Array.flatten(a))}function findNote(a){var b=findAll(),a=map(a,function(a){for(var d=[],e=0;e<b.length;e++)a instanceof RegExp?a.test(getNote(b[e]))&&d.push(b[e]):getNote(b[e])==a&&d.push(b[e]);return d});return uniquePrimitives(Ext.Array.flatten(a))}
function createPrimitive(a,b,c,d){var e=graph.getDefaultParent(),b=b.toLowerCase(),c=graph.insertVertex(e,null,primitiveBank[b].cloneNode(!0),c[0],c[1],d[0],d[1],b);setName(c,a);"Converter"==c.value.nodeName&&setConverterInit(c);if(isValued(c)||"Agents"==c.value.nodeName){a=primitives("Display");for(d=0;d<a.length;d++)if(e=a[d],isTrue(e.getAttribute("AutoAddPrimitives"))&&"Scatterplot"!=e.getAttribute("Type")&&("Map"!=e.getAttribute("Type")||"Agents"==c.value.nodeName))b=e.getAttribute("Primitives"),
"undefined"==typeof b?e.setAttribute("Primitives",c.id):(b=b.split(","),b.push(c.id),e.setAttribute("Primitives",b.join(",")))}return c}function createConnector(a,b,c,d){var e=graph.getDefaultParent(),f,g=!1;if(null==c||null==d)g=!0,f=createPrimitive("temp stock xyz","Stock",[300,300],[10,10]),null==c&&(c=f),null==d&&(d=f);b=b.toLowerCase();c=graph.insertEdge(e,null,primitiveBank[b].cloneNode(!0),c,d,b);setName(c,a);g&&removePrimitive(f);return c}
function removePrimitive(a){a instanceof Array?graph.removeCells(a,!1):graph.removeCells([a],!1)}function highlight(a){for(var b=getParent(a);b;)getCollapsed(b)&&expandFolder(b),b=getParent(b);setSelected(a);graph.scrollCellToVisible(a)}function getSelected(){return graph.getSelectionCells()}function setSelected(a){graph.allowButtonSelect=!0;a instanceof Array?graph.setSelectionCells(a):graph.setSelectionCells([a]);graph.allowButtonSelect=!1}
function isSelected(a){var b=getSelected();return map(a,function(a){return-1<primitiveIndex(b,a)})}function getID(a){return map(a,function(a){return a.id})}function getType(a){return map(a,function(a){return a.value.nodeName})}function getName(a){return map(a,function(a){return a.getAttribute("name")})}function setName(a,b){map(a,function(a){if(validPrimitiveName(""+b,a)){var d=new mxCellAttributeChange(a,"name",""+b);graph.getModel().execute(d);propogateGhosts(a)}})}
function getUnits(a){return map(a,function(a){return a.getAttribute("Units")})}function setUnits(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Units",""+b);graph.getModel().execute(a)})}function getConstraints(a){return map(a,function(a){return[a.getAttribute("MinConstraint"),isTrue(a.getAttribute("MinConstraintUsed")),a.getAttribute("MaxConstraint"),isTrue(a.getAttribute("MaxConstraintUsed"))]})}
function setConstraints(a,b){map(a,function(a){var d=new mxCellAttributeChange(a,"MinConstraint",b[0]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MinConstraintUsed",b[1]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MaxConstraint",b[2]);graph.getModel().execute(d);d=new mxCellAttributeChange(a,"MaxConstraintUsed",b[3]);graph.getModel().execute(d)})}function getNote(a){return map(a,function(a){return a.getAttribute("Note")})}
function setNote(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Note",""+b);graph.getModel().execute(a)})}
function showNote(a){return map(a,function(a){if(!(null===a.value.getAttribute("Note",null)||""==a.value.getAttribute("Note"))){var c=Ext.getCmp("note"+a.id);isUndefined(c)&&(c=graph.view.getState(a))&&(new Ext.ToolTip({html:"<big>"+clean(a.value.getAttribute("Note").replace(/\n/g,"<br/>"))+"</big>",autoHide:!1,closable:!0,width:250,draggable:!0,id:"note"+a.id,title:clean(a.value.getAttribute("name")),closeAction:"destroy"})).showAt([c.x+mxPanel.getEl().getLeft()+c.width+4-graph.container.scrollLeft,
c.y+mxPanel.getEl().getTop()-graph.container.scrollTop])}})}function hideNote(a){return map(a,function(a){a=Ext.getCmp("note"+a.id);isUndefined(a)||a.destroy()})}function showEditor(a){("Converter"==a.value.nodeName?new Ext.ConverterWindow({parent:"",cell:a,oldKeys:a.getAttribute("Data"),interpolation:a.getAttribute("Interpolation")}):new Ext.EquationWindow({parent:"",cell:a,code:getValue(a)})).show()}
function getValue(a){return map(a,function(a){var c=a.value.nodeName,d;"Stock"==c?d=a.getAttribute("InitialValue"):"Flow"==c?d=a.getAttribute("FlowRate"):"Transition"==c?d=a.getAttribute("Value"):"State"==c?d=a.getAttribute("Active"):"Variable"==c?d=a.getAttribute("Equation"):"Button"==c?d=a.getAttribute("Function"):"Converter"==c?d=a.getAttribute("Data"):"Action"==c?d=a.getAttribute("Action"):"Agents"==c&&(d=a.getAttribute("Size"));return isDefined(d)?d:""})}
function setValue(a,b){map(a,function(a){if(getValue(a)!=b){var d=a.value.nodeName,e;if("Stock"==d)e=new mxCellAttributeChange(a,"InitialValue",""+b);else if("Flow"==d)e=new mxCellAttributeChange(a,"FlowRate",""+b);else if("Transition"==d)e=new mxCellAttributeChange(a,"Value",""+b);else if("State"==d)e=new mxCellAttributeChange(a,"Active",""+b);else if("Variable"==d)e=new mxCellAttributeChange(a,"Equation",""+b);else if("Button"==d)e=new mxCellAttributeChange(a,"Function",""+b);else if("Converter"==
d)e=new mxCellAttributeChange(a,"Data",""+b);else if("Action"==d)e=new mxCellAttributeChange(a,"Action",""+b);else if("Agents"==d){if(0>b||Math.round(b)!=b){alert("The agent population size must be a non-negative integer.");return}e=new mxCellAttributeChange(a,"Size",parseFloat(b))}graph.getModel().execute(e)}})}function getPosition(a){return map(a,function(a){var a=graph.view.getState(a),c=graph.view.getScale();return[a.x/c,a.y/c]})}
function setPosition(a,b){map(a,function(a){var d=graph.view.getState(a),e=graph.view.getScale(),f=a.geometry,g=d.x/e-f.x,d=d.y/e-f.y,f=f.clone();f.x=b[0]-g;f.y=b[1]-d;graph.getModel().setGeometry(a,f)})}function getOpacity(a){return map(a,function(a){return graph.getCellStyle(a).opacity})}
function setOpacity(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"opacity",b),d=mxUtils.setStyle(d,mxConstants.STYLE_TEXT_OPACITY,b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getLineColor(a){return map(a,function(a){return graph.getCellStyle(a).strokeColor})}
function setLineColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"strokeColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getFontColor(a){return map(a,function(a){return graph.getCellStyle(a).fontColor})}function setFontColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fontColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}
function getFillColor(a){return map(a,function(a){return graph.getCellStyle(a).fillColor})}function setFillColor(a,b){map(a,function(a){var d=a.getStyle(),d=mxUtils.setStyle(d,"fillColor",b);graph.getModel().execute(new mxStyleChange(graph.getModel(),a,d));propogateGhosts(a)})}function getImage(a){return map(a,function(a){return a.getAttribute("Image")})}function setImage(a,b){map(a,function(a){a.setAttribute("Image",b);setPicture(a)})}
function getNonNegative(a){return map(a,function(a){return"Stock"==a.value.nodeName?isTrue(a.getAttribute("NonNegative")):isTrue(a.getAttribute("OnlyPositive"))})}function setNonNegative(a,b){map(a,function(a){a="Stock"==a.value.nodeName?new mxCellAttributeChange(a,"NonNegative",b):new mxCellAttributeChange(a,"OnlyPositive",b);graph.getModel().execute(a)})}function getStockType(a){return map(a,function(a){return a.getAttribute("StockMode")})}
function setStockType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"StockMode",b);graph.getModel().execute(a)})}function getDelay(a){return map(a,function(a){return a.getAttribute("Delay")})}function setDelay(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Delay",b);graph.getModel().execute(a)})}function getEnds(a){return map(a,function(a){return[a.getTerminal(!0),a.getTerminal(!1)]})}
function setEnds(a,b){map(a,function(a){var d=new mxTerminalChange(graph.model,a,b[0],!0);graph.getModel().execute(d);d=new mxTerminalChange(graph.model,a,b[1],!1);graph.getModel().execute(d)})}
function connected(a,b){if(a.isEdge&&(null!==a.source&&a.source.id===b.id||null!==a.target&&a.target.id===b.id)||b.isEdge&&(null!==b.source&&b.source.id===a.id||null!==b.target&&b.target.id===a.id))return!0;for(var c=findType(["Flow","Link","Transition"]),d=0;d<c.length;d++)if(null!==c[d].source&&null!==c[d].target&&(c[d].source.id===a.id&&c[d].target.id===b.id||c[d].target.id===a.id&&c[d].source.id===b.id))return!0;return!1}
function getResidency(a){return map(a,function(a){return a.getAttribute("Residency")})}function setResidency(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Residency",b);graph.getModel().execute(a)})}function getTriggerType(a){return map(a,function(a){return a.getAttribute("Trigger")})}function setTriggerType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Trigger",b);graph.getModel().execute(a)})}function getTriggerValue(a){return map(a,function(a){return a.getAttribute("Value")})}
function setTriggerValue(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Value",b);graph.getModel().execute(a)})}function getTriggerRepeat(a){return map(a,function(a){return isTrue(a.getAttribute("Repeat"))})}function setTriggerRepeat(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Repeat",b);graph.getModel().execute(a)})}function getTriggerRecalculate(a){return map(a,function(a){return isTrue(a.getAttribute("Recalculate"))})}
function setTriggerRecalculate(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Recalculate",b);graph.getModel().execute(a)})}function getData(a){return map(a,function(a){return a.getAttribute("Data")})}function setData(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Data",b);graph.getModel().execute(a)})}function getConverterInput(a){return map(a,function(a){a=a.getAttribute("Source");return"Time"==a?null:findID(a)})}
function setConverterInput(a,b){map(a,function(a){a=null==b?new mxCellAttributeChange(a,"Source","Time"):new mxCellAttributeChange(a,"Source",b.id);graph.getModel().execute(a)})}function getInterpolation(a){return map(a,function(a){return a.getAttribute("Interpolation")})}function setInterpolation(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Interpolation",b);graph.getModel().execute(a)})}
function pressButton(a){graph.getModel().beginUpdate();map(a,function(a){runAction(a.getAttribute("Function"),"<p>There was error with the Action for the button <i>"+a.getAttribute("name")+"</i>.</p><br/>")});graph.getModel().endUpdate()}function runAction(a,b){try{eval('"use strict;"\n\n'+a)}catch(c){b=b||"",Ext.Msg.show({title:getText("Action Error"),msg:b+"<p><tt>"+c+"</tt></p><p><b>Code:</b></p><p><tt><pre>"+a+"</pre></tt></p>",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}
function getPopulationSize(a){return map(a,function(a){return a.getAttribute("Size")})}function setPopulationSize(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Size",b);graph.getModel().execute(a)})}function getAgentBase(a){return map(a,function(a){return findID(a.getAttribute("Agent"))})}
function setAgentBase(a,b){map(a,function(a){connected(a,b)?(a=new mxCellAttributeChange(a,"Agent",b.id),graph.getModel().execute(a)):mxUtils.alert("Agent Population and Folder must be connected by a Link.")})}function getGeometryWrap(a){return map(a,function(a){return isTrue(a.getAttribute("GeoWrap"))})}function setGeometryWrap(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoWrap",b);graph.getModel().execute(a)})}
function getGeometryUnits(a){return map(a,function(a){return a.getAttribute("GeoDimUnits")})}function setGeometryUnits(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoDimUnits",b);graph.getModel().execute(a)})}function getGeometryWidth(a){return map(a,function(a){return a.getAttribute("GeoWidth")})}function setGeometryWidth(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoWidth",b);graph.getModel().execute(a)})}
function getGeometryHeight(a){return map(a,function(a){return a.getAttribute("GeoHeight")})}function setGeometryHeight(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"GeoHeight",b);graph.getModel().execute(a)})}function getAgentPlacement(a){return map(a,function(a){return a.getAttribute("Placement")})}function setAgentPlacement(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Placement",b);graph.getModel().execute(a)})}
function getAgentPlacementFunction(a){return map(a,function(a){return a.getAttribute("PlacementFunction")})}function setAgentPlacementFunction(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"PlacementFunction",b);graph.getModel().execute(a)})}function getAgentNetwork(a){return map(a,function(a){return a.getAttribute("Network")})}function setAgentNetwork(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Network",b);graph.getModel().execute(a)})}
function getAgentNetworkFunction(a){return map(a,function(a){return a.getAttribute("NetworkFunction")})}function setAgentNetworkFunction(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"NetworkFunction",b);graph.getModel().execute(a)})}function collapseFolder(a){map(a,function(a){graph.foldCells(!0,!1,[a])})}function expandFolder(a){map(a,function(a){graph.foldCells(!1,!1,[a])})}function getCollapsed(a){return map(a,function(a){return a.isCollapsed()})}
function getParent(a){var b=graph.getDefaultParent().id;return map(a,function(a){a=a.getParent();return a.id==b?null:a})}function setParent(a,b,c){var d=null==b?graph.getDefaultParent():b;map(a,function(a){var b=getPosition(a),g=new mxChildChange(graph.getModel(),d,a);graph.getModel().execute(g);c||setPosition(a,b)})}function getChildren(a,b){isUndefined(b)&&(b=!0);return b?Ext.Array.flatten(map(a.children,function(a){return"Folder"==a.value.nodeName?a.children.concat([a]):a})):a.children}
function getFolderType(a){return map(a,function(a){return a.getAttribute("Type")})}function setFolderType(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Type",b);graph.getModel().execute(a)})}function getFolderAgentParent(a){return map(a,function(a){return a.getAttribute("AgentBase")})}function setFolderAgentParent(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"AgentBase",b);graph.getModel().execute(a)})}
function getFolderSolver(a){return map(a,function(a){return JSON.parse(a.getAttribute("Solver"))})}function setFolderSolver(a,b){map(a,function(a){a=new mxCellAttributeChange(a,"Solver",JSON.stringify(b));graph.getModel().execute(a)})}function excludeType(a,b){if(a instanceof Array){for(var c=[],d=0;d<a.length;d++)a[d].value.nodeName!=b&&c.push(a[d]);return c}return null==a?a:a.value.nodeName==b?null:a}function primitiveIndex(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b.id)return c;return-1}
function uniquePrimitives(a){for(var b=[],c=0;c<a.length;c++){for(var d=!1,e=0;e<b.length;e++)if(b[e].id==a[c].id){d=!0;break}d||b.push(a[c])}return b}var globalVarBank={};function setGlobal(a,b){globalVarBank["_"+a]=b}function getGlobal(a){return globalVarBank["_"+a]}function topBarShown(){return ribbonPanel.getDockedItems()[0].isVisible()}
function toggleTopBar(){var a=ribbonPanel.getDockedItems()[0];if(a.isVisible()){a.hide();try{Ext.get("toolbarToggle").update("&darr;")}catch(b){}}else{a.show();try{Ext.get("toolbarToggle").update("&uarr;")}catch(c){}}}function sideBarShown(){return!configPanel.collapsed}function toggleSideBar(){sideBarShown()?configPanel.collapse(Ext.Component.DIRECTION_RIGHT,!1):configPanel.expand(!1)}function updateSideBar(){selectionChanged(!0)};var test,errorCount=0,testCount=0;function runTests(){errorCount=testCount=0;testUI();testCreate();testClearModel();testFolders();testPrimitiveGetSet();testFind();testUnitFunctions();testSimulationGetSet();testSimulation();testUnitsAndConstraints();testMacros();testTimeShift();testRunModel();clearModel();console.log("Tests complete!\n\n Errors: "+errorCount+"/"+testCount);alert("Tests complete! \n\n Errors: "+errorCount+"/"+testCount)}function testError(a){console.log(a);errorCount++}
function assertEqual(a,b,c){testCount++;console.log("- "+test+" - "+a);b!=c&&testError(" *** FAILED  ***  "+test+" "+a+". Found ("+b+") expected ("+c+")")}function assertUnequal(a,b,c){testCount++;console.log("- "+test+" - "+a);b==c&&testError(" *** FAILED ***  "+test+" "+a+". Found ("+b+") expected not ("+c+")")}function assertNull(a,b){testCount++;console.log("- "+test+" - "+a);null!==b&&testError(" *** FAILED *** "+test+" "+a+". Found ("+b+") expected null.")}
function assertNotNull(a,b){testCount++;console.log("- "+test+" - "+a);null===b&&testError(" *** FAILED *** "+test+" "+a+". Found null expected ("+b+").")}
function testRunModel(){test="RunModel";clearModel();var a=createPrimitive("Var","Variable",[100,100],[100,100]);setTimeUnits("Years");setTimeStep(1);setTimeLength(10);setValue(a,"Years()^2");var b=runModel(!0);assertEqual("Old Silent",b.value(a)[2],4);setPauseInterval(1);b=runModel(!0);assertEqual("Pause Interval",b.value(a)[2],4);setPauseInterval(0);runModel({silent:!0,onSuccess:function(b){assertEqual("Silent Callback",b.value(a)[2],4)}});setValue(a,"sds");b=runModel(!0);assertUnequal("Old Silent Error",
b.error,"none");runModel({silent:!0,onError:function(a){assertUnequal("Silent Callback Error",a.error,"none")}});runModel({silent:!1,onError:function(a){assertUnequal("Non-Silent Callback Error",a.error,"none")}});clearModel()}function testBothAgents(){setAlgorithm("RK1");console.log("---RK1---");testAgents();setAlgorithm("RK4");console.log("---RK4---");testAgents()}
function testSubscripting(){var a=test,b=getTimeLength(),c=getTimeUnits();setTimeUnits("Years");setTimeLength(20);test="Subscripting";getAlgorithm();clearModel();var d=runModel(!0);assertEqual("Blank Model",d.error,"none");var e=createPrimitive("Population","Stock",[100,100],[100,100]),f=createPrimitive("Rate","Variable",[100,100],[100,100]),g=createConnector("Growth","Flow",null,e);createConnector("Link","Link",f,g);var h=createPrimitive("Aggregate","Variable",[100,100],[100,100]),k=createPrimitive("Aggregate 2",
"Variable",[100,100],[100,100]);createConnector("Link","Link",e,h);createConnector("Link","Link",e,k);setValue(e,"\u00ab'a': 10, 'b': 5\u00bb");setValue(g,"[Rate]");setValue(f,"\u00aba: 2, b: 1\u00bb");setValue(h,'[Population]{"a"}');setValue(k,'[Population]\u00ab"b"\u00bb');d=runModel(!0);assertEqual("Subscripting 1",d.value(h)[10],30);assertEqual("Subscripting 2",d.value(k)[10],15);setValue(h,"[Population]\u00abmean\u00bb");setValue(k,"[Population]\u00abmax\u00bb");d=runModel(!0);assertEqual("Subscripting 3",
d.value(h)[10],22.5);assertEqual("Subscripting 4",d.value(k)[10],30);setValue(f,"2");runModel(!0);assertUnequal("Subscripting Error 1",runModel(!0).error,"none");setValue(f,"repeat(2, <<'a', 'b'>>)");d=runModel(!0);assertEqual("Subscripting 5",d.value(h)[10],27.5);assertEqual("Subscripting 6",d.value(k)[10],30);setValue(e,"\u00ab'males': \u00abcanada:1, usa:2,'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");setValue(h,'([Population]\u00ab"males", *\u00bb).usa');
setValue(k,'[Population]\u00ab"females", "mexico"\u00bb');runModel(!0);assertUnequal("Subscripting Error 2",runModel(!0).error,"none");setValue(f,"repeat(repeat(2, <<'canada', 'usa', 'mexico'>>), <<'males', 'females'>>)");d=runModel(!0);assertEqual("Subscripting 7",d.value(h)[10],22);assertEqual("Subscripting 8",d.value(k)[10],50);setValue(h,'[Population]\u00ab"males", max\u00bb');setValue(k,'[Population]\u00abmin, "canada"\u00bb');d=runModel(!0);assertEqual("Subscripting 9",d.value(h)[10],23);assertEqual("Subscripting 10",
d.value(k)[10],21);setValue(h,'([Population]\u00ab"males", *\u00bb)\u00ab"USA"\u00bb');setValue(k,'([Population]\u00ab* , "mexico"\u00bb)\u00ab"Females"\u00bb');d=runModel(!0);assertEqual("Subscripting 11",d.value(h)[10],22);assertEqual("Subscripting 12",d.value(k)[10],50);setValue(h,'([Population]{"males", *}){"USA"}');setValue(k,'([Population]{* , "mexico"}).Females');d=runModel(!0);assertEqual("Subscripting 13",d.value(h)[10],22);assertEqual("Subscripting 14",d.value(k)[10],50);setValue(f,"{males: repeat(3, {'canada', 'usa', 'mexico'}), females: repeat(1, {'canada', 'usa', 'mexico'})}");
d=runModel(!0);assertEqual("Subscripting 15",d.value(h)[10],32);assertEqual("Subscripting 16",d.value(k)[10],40);setNonNegative(e,!1);setNonNegative(g,!0);setValue(f,"\u00ab'males': repeat(3, <<'canada', 'usa', 'mexico'>>), 'females': repeat(-4, <<'canada', 'usa', 'mexico'>>)\u00bb");d=runModel(!0);assertEqual("Flow OnlyPositive 1",d.value(h)[10],32);assertEqual("Flow OnlyPositive  2",d.value(k)[10],30);setNonNegative(g,!1);d=runModel(!0);assertEqual("Flow OnlyPositive  3",d.value(h)[10],32);assertEqual("Flow OnlyPositive  4",
d.value(k)[10],-10);setNonNegative(e,!0);d=runModel(!0);assertEqual("Stock Non Negative 1",d.value(h)[10],32);assertEqual("Stock Non Negative 2",d.value(k)[10],0);setNonNegative(e,!1);setConstraints(e,[-100,!0,100,!0]);runModel(!0);assertEqual("Constraints 1",runModel(!0).error,"none");setConstraints(e,[-5,!0,100,!0]);runModel(!0);assertUnequal("Constraints 2",runModel(!0).error,"none");setConstraints(e,[-100,!0,31,!0]);runModel(!0);assertUnequal("Constraints 3",runModel(!0).error,"none");setConstraints(e,
[-100,!1,31,!1]);runModel(!0);assertEqual("Constraints 4",runModel(!0).error,"none");setUnits([e,h,k],"Widgets");setUnits([g,f],"Widgets/Year");runModel(!0);runModel(!0);assertEqual("Units 1",runModel(!0).error,"none");setValue(e,"\u00ab'males': \u00ab'canada':1,'usa':{2 cats},'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");runModel(!0);assertUnequal("Units 2",runModel(!0).error,"none");setValue(e,"\u00ab'males': \u00ab'canada':1,'usa':{2 widgets},'mexico':3\u00bb, 'females': \u00ab'usa':20, 'canada':10, 'mexico': 30\u00bb \u00bb");
runModel(!0);assertEqual("Units 3",runModel(!0).error,"none");setStockType(e,"Conveyor");setDelay(e,5);d=runModel(!0);assertEqual("Conveyor 1",d.value(h)[14],32);assertEqual("Conveyor 2",Math.round(1E5*d.value(k)[14]),-1E6);setValue(h,'([Population]\u00ab"males", *\u00bb)\u00ab"India"\u00bb');runModel(!0);assertUnequal("Errors 1",runModel(!0).error,"none");setValue(h,'([Population]\u00ab"foobar", *\u00bb)\u00ab"USA"\u00bb');runModel(!0);assertUnequal("Errors 2",runModel(!0).error,"none");clearModel();
var e=createPrimitive("Population","Stock",[100,100],[100,100]),l=createPrimitive("Population 2","Stock",[100,100],[100,100]),f=createPrimitive("Rate","Variable",[100,100],[100,100]),g=createConnector("Growth","Flow",e,l);createConnector("Link","Link",f,g);h=createPrimitive("Aggregate","Variable",[100,100],[100,100]);createConnector("Link","Link",l,h);k=createPrimitive("Aggregate 2","Variable",[100,100],[100,100]);createConnector("Link","Link",e,k);setValue(e,100);setValue(l,0);setValue(g,"[Rate]");
setValue(f,"<<'dogs':1, 'cats':2>>");d=runModel(!0);assertEqual("Collapsing 1",d.value(e)[10],70);assertEqual("Collapsing 2",d.value(l)[10],30);setValue(l,"<<'dogs':5, 'cats':4>>");setValue(h,"[population 2]<<'dogs'>>");d=runModel(!0);assertEqual("Collapsing 3",d.value(e)[10],70);assertEqual("Collapsing 4",d.value(h)[10],15);setValue(f,"<<'dogs': <<'x': 1, 'y':2>>, 'cats': <<'x':3, 'y':4>> >>");d=runModel(!0);assertEqual("Collapsing 5",d.value(e)[10],0);assertEqual("Collapsing 6",d.value(h)[10],35);
setValue(e,"<<x:40, y:60>>");setValue(k,"[Population]<<'x'>>");d=runModel(!0);assertEqual("Collapsing 7",d.value(k)[10],0);assertEqual("Collapsing 8",d.value(h)[10],35);setValue(l,"<<'dogs':5, 'cats':4, rats:6>>");setValue(f,"<<'dogs': <<'x': 1, 'y':2>>, 'cats': <<'x':3, 'y':4>>, 'rats': <<'x':9, 'y':10>> >>");d=runModel(!0);assertEqual("Collapsing 9",d.value(k)[10],-90);assertEqual("Collapsing 10",d.value(h)[10],35);setEnds(g,[l,e]);d=runModel(!0);assertEqual("Collapsing 11",d.value(k)[10],170);
assertEqual("Collapsing 12",d.value(h)[10],-25);clearModel();test=a;setTimeUnits(c);setTimeLength(b)}
function testAgents(){var a=test;test="Agents";getAlgorithm();clearModel();var b=createPrimitive("My State","State",[100,100],[100,100]),c=createPrimitive("My State 2","State",[100,100],[100,100]);setValue(b,"false || true");setValue(c,"false || 0");var d=runModel(!0);assertEqual("State Start 1",d.value(b)[0],1);assertEqual("State Start 2",d.value(c)[0],0);assertEqual("State Start 3",d.value(b)[10],1);assertEqual("State Start 4",d.value(c)[10],0);setValue(b,"true");setValue(c,"false");var e=createPrimitive("Action",
"Action",[100,100],[100,100]);setValue(e,"[My State] <- false");setTriggerType(e,"Timeout");setTriggerValue(e,5);var f=createPrimitive("Action","Action",[100,100],[100,100]);setTriggerType(f,"Timeout");setTriggerValue(f,100);setValue(f,"[My State 2] <- true");var g=createConnector("Link","Link",e,b),h=createConnector("Link","Link",f,c),d=runModel(!0);assertEqual("State Start 5",d.value(b)[0],1);assertEqual("State Start 6",d.value(c)[0],0);assertEqual("State Start 7",d.value(b)[10],0);assertEqual("State Start 8",
d.value(c)[10],0);removePrimitive(e);removePrimitive(f);removePrimitive(g);removePrimitive(h);setValue(b,"false || true");setValue(c,"false || 0");var k=createConnector("My Transition","Transition",null,c),l=createConnector("My Transition","Transition",c,null);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Timeout");setTriggerValue(l,"{3 years}");d=runModel(!0);assertEqual("Transition T Dangle 1",d.value(b)[0],1);assertEqual("Transition T Dangle 2",d.value(c)[0],0);assertEqual("Transition T Dangle 3",
d.value(b)[3],1);assertEqual("Transition T Dangle 4",d.value(c)[3],1);assertEqual("Transition T Dangle 5",d.value(c)[8],0);removePrimitive(k);removePrimitive(l);k=createConnector("My Transition","Transition",b,c);l=createConnector("My Transition","Transition",c,b);setTriggerType(k,"Timeout");setTriggerValue(k,"{10 Years} - Time()");setTriggerType(l,"Timeout");setTriggerValue(l,"{100 years}");d=runModel(!0);assertEqual("Recalculate 1",d.value(b)[0],1);assertEqual("Recalculate 2",d.value(c)[0],0);assertEqual("Recalculate 3",
d.value(b)[3],1);assertEqual("Recalculate 4",d.value(c)[3],0);assertEqual("Recalculate 5",d.value(b)[6],1);assertEqual("Recalculate 6",d.value(c)[6],0);setTriggerRecalculate(k,!0);d=runModel(!0);assertEqual("Recalculate 7",d.value(b)[0],1);assertEqual("Recalculate 8",d.value(c)[0],0);assertEqual("Recalculate 9",d.value(b)[3],1);assertEqual("Recalculate 10",d.value(c)[3],0);assertEqual("Recalculate 11",d.value(b)[6],0);assertEqual("Recalculate 12",d.value(c)[6],1);setTriggerRecalculate(k,!1);setTriggerType(k,
"Probability");setTriggerValue(k,"IfThenElse(years < 2, 0, 1)");d=runModel(!0);assertEqual("Recalculate 13",d.value(b)[0],1);assertEqual("Recalculate 14",d.value(c)[0],0);assertEqual("Recalculate 15",d.value(b)[3],1);assertEqual("Recalculate 16",d.value(c)[3],0);assertEqual("Recalculate 17",d.value(b)[6],1);assertEqual("Recalculate 18",d.value(c)[6],0);setTriggerRecalculate(k,!0);d=runModel(!0);assertEqual("Recalculate 19",d.value(b)[0],1);assertEqual("Recalculate 20",d.value(c)[0],0);assertEqual("Recalculate 21",
d.value(b)[3],0);assertEqual("Recalculate 22",d.value(c)[3],1);assertEqual("Recalculate 23",d.value(b)[6],0);assertEqual("Recalculate 24",d.value(c)[6],1);setTriggerRecalculate(k,!1);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Timeout");setTriggerValue(l,"{3 years}");d=runModel(!0);assertEqual("Transition T 1",d.value(b)[0],1);assertEqual("Transition T 2",d.value(c)[0],0);assertEqual("Transition T 3",d.value(b)[3],0);assertEqual("Transition T 4",d.value(c)[3],1);assertEqual("Transition T 5",
d.value(b)[6],1);assertEqual("Transition T 6",d.value(c)[6],0);setTriggerValue(k,"2");setTriggerValue(l,"3");d=runModel(!0);assertEqual("Transition T 1.2",d.value(b)[0],1);assertEqual("Transition T 2.2",d.value(c)[0],0);assertEqual("Transition T 3.2",d.value(b)[3],0);assertEqual("Transition T 4.2",d.value(c)[3],1);assertEqual("Transition T 5.2",d.value(b)[6],1);assertEqual("Transition T 6.2",d.value(c)[6],0);setResidency(b,"2");d=runModel(!0);assertEqual("Residency 1",d.value(b)[0],1);assertEqual("Residency 2",
d.value(c)[0],0);assertEqual("Residency 3",d.value(b)[3],1);assertEqual("Residency 4",d.value(c)[3],0);assertEqual("Residency 5",d.value(b)[6],0);assertEqual("Residency 6",d.value(c)[6],1);setResidency(b,"{2 years}");d=runModel(!0);assertEqual("Residency 7",d.value(b)[0],1);assertEqual("Residency 8",d.value(c)[0],0);assertEqual("Residency 9",d.value(b)[3],1);assertEqual("Residency 10",d.value(c)[3],0);assertEqual("Residency 11",d.value(b)[6],0);assertEqual("Residency 12",d.value(c)[6],1);setResidency(b,
"0");setTriggerType(k,"Probability");setTriggerValue(k,"1");setTriggerType(l,"Timeout");setTriggerValue(l,"{100 years}");d=runModel(!0);assertEqual("Transition P 1",d.value(b)[0],1);assertEqual("Transition P 2",d.value(c)[0],0);assertEqual("Transition P 3",d.value(b)[2],0);assertEqual("Transition P 4",d.value(c)[2],1);assertEqual("Transition P 5",d.value(b)[10],0);assertEqual("Transition P 6",d.value(c)[10],1);setTriggerValue(k,"2");d=runModel(!0);assertUnequal(d.error,"none");setTriggerValue(k,"-1");
d=runModel(!0);assertUnequal(d.error,"none");setTriggerValue(k,"0");d=runModel(!0);assertEqual("Transition P 1.3",d.value(b)[0],1);assertEqual("Transition P 2.3",d.value(c)[0],0);assertEqual("Transition P 3.3",d.value(b)[2],1);assertEqual("Transition P 4.3",d.value(c)[2],0);setTriggerType(k,"Condition");setTriggerValue(k,"years = 5");setTriggerType(l,"Condition");setTriggerValue(l,"years = 7");d=runModel(!0);assertEqual("Transition C 1",d.value(b)[0],1);assertEqual("Transition C 2",d.value(c)[0],
0);assertEqual("Transition C 3",d.value(b)[6],0);assertEqual("Transition C 4",d.value(c)[6],1);assertEqual("Transition C 5",d.value(b)[7],0);assertEqual("Transition C 6",d.value(c)[7],1);assertEqual("Transition C 7",d.value(b)[8],1);assertEqual("Transition C 8",d.value(c)[8],0);clearModel();b=createPrimitive("State","State",[100,100],[100,100]);c=createPrimitive("Variable","State",[300,100],[100,100]);createConnector("My Link","Link",b,c);setValue(b,"true");setValue(c,"ifThenElse([State], 1, 0)");
d=runModel(!0);assertEqual("State Values 1",d.value(b)[0],1);assertEqual("State Values 2",d.value(c)[0],1);setValue(b,"false");d=runModel(!0);assertEqual("State Values 3",d.value(b)[0],0);assertEqual("State Values 4",d.value(c)[0],0);setValue(c,"if [State] then\n 1\nelse\n 0\nend if");d=runModel(!0);assertEqual("State Values 5",d.value(b)[0],0);assertEqual("State Values 6",d.value(c)[0],0);setValue(b,"true");d=runModel(!0);assertEqual("State Values 7",d.value(b)[5],1);assertEqual("State Values 8",
d.value(c)[5],1);clearModel();b=createPrimitive("State 1","State",[100,100],[100,100]);c=createPrimitive("State 2","State",[100,100],[100,100]);g=createConnector("My Link","Link",b,c);k=createConnector("My Transition","Transition",b,c);l=createConnector("My Transition","Transition",c,b);setTriggerType(k,"Timeout");setTriggerValue(k,"{2 years}");setTriggerType(l,"Condition");setTriggerValue(l,"false");setValue(b,"1");setValue(c,"! [State 1]");f=createPrimitive("My Agent","Folder",[200,150],[400,400]);
setParent([b,c,g,k,l],f);setFolderType(f,"Agent");var m=createPrimitive("Population","Agents",[1210,0],[200,200]);createConnector("Link","Link",f,m);setAgentBase(m,f);setPopulationSize(m,10);var c=createPrimitive("My Variable","Variable",[1200,150],[150,100]),n=createPrimitive("My Variable 2","Variable",[1200,150],[150,100]);setValue(c,"Count(FindAll([Population]))");setValue(n,"PopulationSize([Population])+1");createConnector("My Link","Link",m,c);createConnector("My Link","Link",m,n);d=runModel(!0);
assertEqual("Pop 1",d.value(c)[0],10);assertEqual("Pop 2",d.value(c)[8],10);assertEqual("Pop 2.1",d.value(n)[0],11);assertEqual("Pop 2.2",d.value(n)[8],11);setValue(c,"[Population].FindAll().length()");setValue(n,"[Population].PopulationSize()+1");d=runModel(!0);assertEqual("Pop 1 (Obj)",d.value(c)[0],10);assertEqual("Pop 2 (Obj)",d.value(c)[8],10);assertEqual("Pop 2.1 (Obj)",d.value(n)[0],11);assertEqual("Pop 2.2 (Obj)",d.value(n)[8],11);setValue(c,"Count(FindState([Population], [State 1]))");setValue(n,
"Count(FindState([Population], [State 2]))");d=runModel(!0);assertEqual("Pop 3",d.value(c)[0],10);assertEqual("Pop 4",d.value(n)[0],0);assertEqual("Pop 5",d.value(c)[8],0);assertEqual("Pop 6",d.value(n)[8],10);setValue(c,"[Population].findState([State 1]).length()");setValue(n,"[Population].findState([State 2]).length()");d=runModel(!0);assertEqual("Pop 3 (Obj)",d.value(c)[0],10);assertEqual("Pop 4 (Obj)",d.value(n)[0],0);assertEqual("Pop 5 (Obj)",d.value(c)[8],0);assertEqual("Pop 6 (Obj)",d.value(n)[8],
10);var o=createPrimitive("My Variable 3","Variable",[1200,150],[150,100]);createConnector("My Link","Link",m,o);createConnector("My Link","Link",o,n);setValue(o,"FindState([Population], [State 2])");setValue(n,"Count([My Variable 3])");d=runModel(!0);assertEqual("Pop 6.1",d.value(c)[0],10);assertEqual("Pop 6.2",d.value(n)[0],0);assertEqual("Pop 6.3",d.value(c)[8],0);assertEqual("Pop 6.4",d.value(n)[8],10);assertEqual("Pop 6.5",d.error,"none");setValue(o,"[Population].findState([State 2])");setValue(n,
"[My Variable 3].length()");d=runModel(!0);assertEqual("Pop 6.1 (Obj)",d.value(c)[0],10);assertEqual("Pop 6.2 (Obj)",d.value(n)[0],0);assertEqual("Pop 6.3 (Obj)",d.value(c)[8],0);assertEqual("Pop 6.4 (Obj)",d.value(n)[8],10);assertEqual("Pop 6.5 (Obj)",d.error,"none");setValue(c,"Count(FindNotState([Population], [State 1]))");setValue(n,"Count(FindNotState([Population], [State 2]))");d=runModel(!0);assertEqual("Pop 6.6",d.error,"none");setValue(c,"Count([Population].FindNotState([State 1]))");setValue(n,
"Count([Population].FindNotState([State 2]))");d=runModel(!0);assertEqual("Pop 6.6 (Obj)",d.error,"none");setValue(o,"FindState([Population], [State 2])+1");d=runModel(!0);assertUnequal("Pop 6.7",d.error,"none");setValue(o,"[Population].FindState([State 2])+1");d=runModel(!0);assertUnequal("Pop 6.7 (Obj)",d.error,"none");setValue(o,"[Population]+1");d=runModel(!0);assertUnequal("Pop 6.8",d.error,"none");removePrimitive(o);setTriggerType(l,"Timeout");setTriggerValue(l,"5");setTriggerType(l,"Condition");
setTriggerValue(l,"index(self)=1 and years=7");d=runModel(!0);assertEqual("Pop 7",d.value(c)[0],0);assertEqual("Pop 8",d.value(n)[0],10);assertEqual("Pop 9",d.value(c)[8],9);assertEqual("Pop 10",d.value(n)[8],1);setTriggerValue(l,"self.index()=1 and years=7");d=runModel(!0);assertEqual("Pop 7 (obj)",d.value(c)[0],0);assertEqual("Pop 8 (obj)",d.value(n)[0],10);assertEqual("Pop 9 (obj)",d.value(c)[8],9);assertEqual("Pop 10 (obj)",d.value(n)[8],1);o=createPrimitive("Var","Variable",[200,150],[150,100]);
setParent(o,f);d=createPrimitive("Outside Var","Variable",[200,150],[150,100]);setParent(d,f);setValue(d,"IfThenElse(years<5, 1, 0)");createConnector("Link","Link",d,o);setValue(o,"[Outside Var]*2");setValue(c,"Min(Value([Population], [Var]))");setValue(n,"Max(Value([Population], [Var]))");d=runModel(!0);assertEqual("Pop 10.1",d.value(c)[0],2);assertEqual("Pop 10.2",d.value(c)[8],0);setValue(c,"[Population].value([Var]).min()");setValue(n,"Max([Population].Value([Var]))");d=runModel(!0);assertEqual("Pop 10.1 (obj)",
d.value(c)[0],2);assertEqual("Pop 10.2 (obj)",d.value(c)[8],0);setMacros("counter <- 0");e=createPrimitive("Action","Action",[200,150],[150,100]);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"Counter <- counter + 1");setValue(o,"counter*3");d=runModel(!0);assertEqual("Pop 10.3",d.value(c)[0],0);assertEqual("Pop 10.4",d.value(c)[8],24);setTriggerRepeat(e,!1);d=runModel(!0);assertEqual("Repeat Off 1",d.value(c)[0],0);assertEqual("Repeat Off 2",d.value(c)[8],3);setTriggerRepeat(e,
!0);setTriggerValue(e,"false");d=runModel(!0);assertEqual("Pop 10.5",d.value(c)[0],0);assertEqual("Pop 10.6",d.value(c)[8],0);setTriggerType(e,"Condition");setTriggerValue(e,"true");d=runModel(!0);assertEqual("Pop 10.7",d.value(c)[0],0);assertEqual("Pop 10.8",d.value(c)[8],24);setTriggerValue(e,"false");d=runModel(!0);assertEqual("Pop 10.9",d.value(c)[0],0);assertEqual("Pop 10.10",d.value(c)[8],0);setTriggerType(e,"Timeout");setTriggerValue(e,"100");d=runModel(!0);assertEqual("Pop 10.11",d.value(c)[0],
0);assertEqual("Pop 10.12",d.value(c)[8],0);setTriggerValue(e,"{100 years}");d=runModel(!0);assertEqual("Pop 10.13",d.value(c)[0],0);assertEqual("Pop 10.14",d.value(c)[8],0);setTriggerType(e,"Condition");setTriggerValue(e,"true");var q=createPrimitive("Count","Stock",[200,150],[150,100]);setParent([e,q],f);setValue(q,10);setValue(e,"[Count] <- [Count] + 2");g=createConnector("Link","Link",q,o);h=createConnector("Link","Link",q,e);setValue(o,"[Count]");d=runModel(!0);assertEqual("Pop 10.17",d.value(c)[0],
10);assertEqual("Pop 10.18",d.value(c)[8],26);removePrimitive(e);removePrimitive(q);removePrimitive(g);removePrimitive(h);setValue(o,"index(self)");d=runModel(!0);assertEqual("Pop 11",d.value(c)[0],1);assertEqual("Pop 12",d.value(n)[8],10);setValue(c,"PopulationSize([Population])");setValue(n,"Count(Value([Population], [Var]))");d=runModel(!0);assertEqual("Pop 12.1",d.value(c)[0],d.value(n)[0]);assertEqual("Pop 12.2",d.value(c)[8],d.value(n)[8]);setValue(c,"[Population].PopulationSize()");setValue(n,
"Count([Population].Value([Var]))");d=runModel(!0);assertEqual("Pop 12.1 (Obj)",d.value(c)[0],d.value(n)[0]);assertEqual("Pop 12.2 (Obj)",d.value(c)[8],d.value(n)[8]);setValue(c,"Count(Join(FindState([Population], [State 1]), FindState([Population], [State 2])))");setValue(n,"Min(Value(Join(FindState([Population], [State 1]), FindState([Population], [State 2])), [Var]))");d=runModel(!0);assertEqual("Pop 13",d.value(c)[0],10);assertEqual("Pop 14",d.value(n)[8],1);setValue(c,"Join([Population].FindState([State 1]), [Population].FindState([State 2])).Length()");
setValue(n,"Join([Population].FindState([State 1]), [Population].FindState([State 2])).Value([Var]).Min()");d=runModel(!0);assertEqual("Pop 13 (Obj)",d.value(c)[0],10);assertEqual("Pop 14 (Obj)",d.value(n)[8],1);setValue(c,"Count(Join(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");setValue(n,"Count(Union(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)))");d=runModel(!0);assertEqual("Pop 14.1",
d.value(c)[0],5);assertEqual("Pop 14.2",d.value(n)[8],5);setValue(c,"Join(Filter([Population].FindAll(), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var]) <=3)).Length()");setValue(n,"Union([Population].FindAll().Filter(x.value([Var])>8), [Population].FindAll().Filter(x.value([Var]) <=3)).Length()");d=runModel(!0);assertEqual("Pop 14.1 (Obj)",d.value(c)[0],5);assertEqual("Pop 14.2 (Obj)",d.value(n)[8],5);setValue(c,"Count(Intersection(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");
setValue(n,"Count(Difference(Filter(FindAll([Population]), value(x, [Var])>8), Filter(FindAll([Population]), value(x, [Var])<=3)))");d=runModel(!0);assertEqual("Pop 14.3",d.value(c)[0],0);assertEqual("Pop 14.4",d.value(n)[8],5);setValue(c,"Distance(FindNearest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(n,"Distance(FindFurthest([Population], FindIndex([population], 1)), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5",d.value(c)[0],1);assertEqual("Pop 14.6",d.value(n)[8],1);setValue(c,"Distance([Population].FindNearest([population].FindIndex(1)), [population].FindIndex(1)) = Min(map(Select([Population].FindAll(),join(false, repeat(true,9))), distance(x, [population].FindIndex(1))))");setValue(n,"Distance([Population].FindFurthest([population].FindIndex(1)), [population].FindIndex(1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, [population].FindIndex(1))))");
d=runModel(!0);assertEqual("Pop 14.5 (Obj)",d.value(c)[0],1);assertEqual("Pop 14.6 (Obj)",d.value(n)[8],1);setValue(c,"Distance(select(FindNearest([Population], FindIndex([population], 1),2),2), FindIndex([population], 1)) = Min(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");setValue(n,"Distance(select(FindFurthest([Population], FindIndex([population], 1),3),2), FindIndex([population], 1)) = Max(map(Select(FindAll([Population]),join(false, repeat(true,9))), distance(x, FindIndex([population],1))))");
d=runModel(!0);assertEqual("Pop 14.5.2",d.value(c)[0],0);assertEqual("Pop 14.6.2",d.value(n)[8],0);setValue(c,"Count(FindNearby([Population], FindIndex([Population], 1), 400))");setValue(n,"Count(FindNearby([Population], FindIndex([Population], 1), 0))");d=runModel(!0);assertEqual("Pop 14.7",d.value(c)[0],9);assertEqual("Pop 14.8",d.value(n)[8],0);setValue(c,"[Population].FindNearby([Population].FindIndex(1), 400).length()");setValue(n,"[Population].FindNearby([Population].FindIndex(1), 0).length()");
d=runModel(!0);assertEqual("Pop 14.7 (Obj)",d.value(c)[0],9);assertEqual("Pop 14.8 (Obj)",d.value(n)[8],0);setValue(c,"width([Population])");setValue(n,"height([Population])");d=runModel(!0);assertEqual("Pop 14.9",d.value(c)[0],200);assertEqual("Pop 14.10",d.value(n)[8],100);setValue(c,"[Population].FindIndex(2) == [Population].FindIndex(2)");setValue(n,"[Population].FindIndex(2) == [Population].FindIndex(3)");d=runModel(!0);assertEqual("Comparison 1",d.value(c)[0],!0);assertEqual("Comparison 2",
d.value(n)[8],!1);setValue(c,"[Population].FindIndex(2) != [Population].FindIndex(2)");setValue(n,"[Population].FindIndex(2) != [Population].FindIndex(3)");d=runModel(!0);assertEqual("Comparison 3",d.value(c)[0],!1);assertEqual("Comparison 4",d.value(n)[8],!0);setValue(c,"[Population].FindIndex(2) > [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 5",d.error,"none");setValue(c,"[Population].FindIndex(2) >= [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 6",
d.error,"none");setValue(c,"[Population].FindIndex(2) < [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 7",d.error,"none");setValue(c,"[Population].FindIndex(2) <= [Population].FindIndex(2)");d=runModel(!0);assertUnequal("Comparison 8",d.error,"none");setAgentPlacement(m,"Grid");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(n,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");
d=runModel(!0);assertEqual("Grid Loc 15",d.value(c)[0],0);assertEqual("Grid Loc 16",d.value(n)[8],1);setAgentPlacement(m,"Ellipse");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(n,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Grid Loc 16.1",d.value(c)[0],0);assertEqual("Grid Loc 16.2",d.value(n)[8],0);setAgentPlacement(m,
"Network");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");setValue(n,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Network Loc 17",d.value(c)[0],0);assertEqual("Network Loc 18",d.value(n)[8],0);setAgentPlacement(m,"Custom Function");setValue(c,"IfThenElse(Select(Location(FindIndex([Population], 1)),1)==Select(Location(FindIndex([Population], 2)),1), 1, 0)");
setValue(n,"IfThenElse(Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), 1, 0)");d=runModel(!0);assertEqual("Custom Loc 19",d.value(c)[0],0);assertEqual("Custom Loc 20",d.value(n)[8],0);setAgentPlacementFunction(m,"<<index(Self)*10,index(Self)*20>>");setValue(c,"Select(Location(FindIndex([Population], 1)),1)");setValue(n,"Select(Location(FindIndex([Population], 2)),2)");d=runModel(!0);assertEqual("Custom Loc 21",d.value(c)[0],10);assertEqual("Custom Loc 22",
d.value(n)[8],40);setAgentPlacementFunction(m,"{index(Self)*10, Self.index()*20}");d=runModel(!0);assertEqual("Custom Loc 21 (Self)",d.value(c)[0],10);assertEqual("Custom Loc 22 (Self)",d.value(n)[8],40);setAgentPlacementFunction(m,"<<Self.index()*10,Self.index()*20>>");setValue(c,"[Population].FindIndex(1).Location().x");setValue(n,"[Population].FindIndex(2).Location().y");d=runModel(!0);assertEqual("Custom Loc 21 (Obj)",d.value(c)[0],10);assertEqual("Custom Loc 22 (Obj)",d.value(n)[8],40);e=createPrimitive("Mover",
"Action",[200,150],[150,100]);setParent(e,f);setTriggerType(e,"Condition");setTriggerValue(e,"true");setValue(e,"move(Self, {10, 20})");d=runModel(!0);assertEqual("Custom Move 22",d.value(c)[2],30);assertEqual("Custom Move 23",d.value(n)[9],220);setValue(e,"Self.move({10, 20})");d=runModel(!0);assertEqual("Custom Move 22 (Obj)",d.value(c)[2],30);assertEqual("Custom Move 23 (Obj)",d.value(n)[9],220);setFolderAgentParent(f,"x <- new AgentBase\n x.doMove <- function() self.move({10, 20})\n x");setValue(e,
"Self.doMove()");d=runModel(!0);assertEqual("Custom Agent Parent 1",d.value(c)[2],30);assertEqual("Custom Agent Parent 2",d.value(n)[9],220);setMacros("mover <- new AgentBase\n mover.doMove <- function(dist) self.move(dist*{1, 2})");setFolderAgentParent(f,"mover");setValue(e,"Self.doMove(10)");d=runModel(!0);assertEqual("Custom Agent Parent 3",d.value(c)[2],30);assertEqual("Custom Agent Parent 4",d.value(n)[9],220);setGeometryWrap(m,!0);d=runModel(!0);assertEqual("Custom Move 24",d.value(c)[2],30);
assertEqual("Custom Move 25",d.value(n)[9],20);createConnector("Link","Link",m,e);setAgentPlacementFunction(m,"{index(Self)*10, 1}");setValue(e,"moveTowards(Self, findIndex([Population], 1), 1)");setValue(n,"Location(FindIndex([Population], 2)).x");d=runModel(!0);assertEqual("Custom Move 26",d.value(c)[2],10);assertEqual("Custom Move 27",d.value(c)[9],10);assertEqual("Custom Move 27.1",d.value(n)[2],18);assertEqual("Custom Move 27.2",d.value(n)[9],11);setValue(e,"Self.moveTowards([Population].findIndex(1), 1)");
setValue(n,"[Population].FindIndex(2).Location().x");d=runModel(!0);assertEqual("Custom Move 26 (Obj)",d.value(c)[2],10);assertEqual("Custom Move 27 (Obj)",d.value(c)[9],10);assertEqual("Custom Move 27.1 (Obj)",d.value(n)[2],18);assertEqual("Custom Move 27.2 (Obj)",d.value(n)[9],11);setValue(e,"1");setAgentNetwork(m,"Custom Function");setAgentNetworkFunction(m,"ifThenElse(index(a)=1 || index(b)=1, true, false)");setValue(c,"count(connected(findIndex([Population], 1)))");setValue(n,"count(connected(findIndex([Population], 3)))");
d=runModel(!0);assertEqual("Custom Network 28",d.value(c)[0],9);assertEqual("Custom Network 29",d.value(n)[8],1);setValue(c,"[Population].findIndex(1).connected().length()");setValue(n,"[Population].findIndex(3).connected().length()");d=runModel(!0);assertEqual("Custom Network 28 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 29 (Obj)",d.value(n)[8],1);setValue(e,"ifthenelse( index(self)==3, unconnect(self, findIndex([population], 1)), 0)");d=runModel(!0);assertEqual("Custom Network 30",d.value(c)[0],
9);assertEqual("Custom Network 31",d.value(n)[0],1);assertEqual("Custom Network 32",d.value(c)[8],8);assertEqual("Custom Network 33",d.value(n)[8],0);setValue(e,"ifthenelse( index(self)==3, self.unconnect([population].findIndex(1)), 0)");d=runModel(!0);assertEqual("Custom Network 30 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 31 (Obj)",d.value(n)[0],1);assertEqual("Custom Network 32 (Obj)",d.value(c)[8],8);assertEqual("Custom Network 33 (Obj)",d.value(n)[8],0);setValue(e,"ifthenelse(index(self)==3, connect(self, findIndex([population], 2)),0)");
d=runModel(!0);assertEqual("Custom Network 34",d.value(c)[0],9);assertEqual("Custom Network 35",d.value(n)[0],1);assertEqual("Custom Network 36",d.value(c)[8],9);assertEqual("Custom Network 37",d.value(n)[8],2);setValue(e,"IfThenElse(self.index()==3, self.connect([population].findIndex(2)),0)");d=runModel(!0);assertEqual("Custom Network 34 (Obj)",d.value(c)[0],9);assertEqual("Custom Network 35 (Obj)",d.value(n)[0],1);assertEqual("Custom Network 36 (Obj)",d.value(c)[8],9);assertEqual("Custom Network 37 (Obj)",
d.value(n)[8],2);setValue(e,"ifthenelse(index(self)==3, connect(self, true),0)");d=runModel(!0);assertUnequal("Custom Network 38",d.error,"none");setValue(e,"ifthenelse(index(self)==3, self.connect(true),0)");d=runModel(!0);assertUnequal("Custom Network 38 (Obj)",d.error,"none");setValue(e,"ifthenelse(index(self)==3, connect(self, 1),0)");d=runModel(!0);assertUnequal("Custom Network 39",d.error,"none");setTriggerType(e,"Condition");setTriggerValue(e,"((index(self)==3 && years>=2) || (index(self)==5 && years>=5))");
setValue(e,"remove(self)");setValue(c,"populationSize([Population])");setValue(n,"count(connected(findIndex([Population], 1)))");d=runModel(!0);assertEqual("Add/Remove 1",d.value(c)[0],10);assertEqual("Add/Remove 2",d.value(c)[4],9);assertEqual("Add/Remove 3",d.value(c)[8],8);setTriggerValue(e,"((self.index()==3 && years==2) || (self.index()==5 && years==5))");setValue(e,"self.remove()");setValue(c,"[Population].populationSize()");setValue(n,"[Population].findIndex(1).connected().length()");d=runModel(!0);
assertEqual("Add/Remove 1 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 2 (Obj)",d.value(c)[4],9);assertEqual("Add/Remove 3 (Obj)",d.value(c)[8],8);setTriggerValue(e,"((index(self)==3 && years==2) || (index(self)==5 && years==5))");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(n,"count(connected(findIndex([Population], 3)))");d=runModel(!0);assertEqual("Add/Remove 5",d.value(c)[0],10);assertEqual("Add/Remove 6",d.value(c)[4],11);assertEqual("Add/Remove 7",
d.value(c)[8],12);setValue(e,"[Population].add()");assertEqual("Add/Remove 5 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 6 (Obj)",d.value(c)[4],11);assertEqual("Add/Remove 7 (Obj)",d.value(c)[8],12);setTriggerValue(e,"((index(self)==3 && years==2) || (index(self)==5 && years==5))");setValue(e,"add([Population], Self)");setValue(c,"populationSize([Population])");d=runModel(!0);assertEqual("Add/Remove 8",d.value(c)[0],10);assertEqual("Add/Remove 9",d.value(c)[4],11);assertEqual("Add/Remove 10",
d.value(c)[8],12);setValue(e,"[Population].add(Self)");assertEqual("Add/Remove 8 (Obj)",d.value(c)[0],10);assertEqual("Add/Remove 9 (Obj)",d.value(c)[4],11);assertEqual("Add/Remove 10 (Obj)",d.value(c)[8],12);setAgentPlacement(m,"Random");setPopulationSize(m,1);setTriggerValue(e,"years == 5 ");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(n,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");
d=runModel(!0);assertEqual("Add/Remove 11",d.value(c)[0],1);assertEqual("Add/Remove 12",d.value(c)[8],2);assertEqual("Add/Remove 13",d.value(n)[0],-1);assertEqual("Add/Remove 14",d.value(n)[7],0);setPopulationSize(m,1);setValue(e,"add([Population], Self)");setValue(c,"populationSize([Population])");setValue(n,"ifthenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 15",
d.value(c)[0],1);assertEqual("Add/Remove 16",d.value(c)[8],2);assertEqual("Add/Remove 17",d.value(n)[0],-1);assertEqual("Add/Remove 18",d.value(n)[7],1);setPopulationSize(m,0);setParent(e);setTriggerValue(e,"years == 5 or years==3");setValue(e,"add([Population])");setValue(c,"populationSize([Population])");setValue(n,"IfThenElse(populationsize([Population])==2, Select(Location(FindIndex([Population], 1)),2)==Select(Location(FindIndex([Population], 2)),2), -1)");d=runModel(!0);assertEqual("Add/Remove 19",
d.value(c)[0],0);assertEqual("Add/Remove 20",d.value(c)[8],2);assertEqual("Add/Remove 21",d.value(n)[0],-1);assertEqual("Add/Remove 22",d.value(n)[7],0);setPopulationSize(m,3);createConnector("Link","Link",m,k);setValue(e,1);setTriggerType(k,"Condition");setTriggerValue(k,"Distance(self, [Population].findIndex(1)) > 1");setTriggerRepeat(k,!1);setTriggerRepeat(l,!1);d=runModel(!0);assertEqual("Init Position With State",d.error,"none");setPopulationSize(m,2);removePrimitive(k);removePrimitive(l);setParent(e);
setValue(b,"false");setTriggerValue(e,"years == 5 ");setValue(e,"SetValue([Population], [State 1], true)");setValue(c,"select(value([Population], [State 1]), 1)");setValue(n,"select(value([Population],[State 1]), 2)");d=runModel(!0);assertEqual("SetValue 1",d.value(c)[3],0);assertEqual("SetValue 2",d.value(c)[8],1);assertEqual("SetValue 3",d.value(n)[3],0);assertEqual("SetValue 4",d.value(n)[8],1);setValue(e,"[Population].SetValue([State 1], true)");setValue(c,"[Population].value([State 1]){1}");
setValue(n,"[Population].value([State 1]){2}");d=runModel(!0);assertEqual("SetValue 1 (Obj)",d.value(c)[3],0);assertEqual("SetValue 2 (Obj)",d.value(c)[8],1);assertEqual("SetValue 3 (Obj)",d.value(n)[3],0);assertEqual("SetValue 4 (Obj)",d.value(n)[8],1);setGeometryWidth(m,"{1 Meter}");d=runModel(!0);assertUnequal("Geo Units 1",d.error,"none");setGeometryWidth(m,"2");setGeometryHeight(m,"{2 Kilometers}");d=runModel(!0);assertUnequal("Geo Units 2",d.error,"none");setGeometryUnits(m,"Meters");d=runModel(!0);
assertEqual("Geo Units 3",d.error,"none");setGeometryWidth(m,"{1 Meter}");d=runModel(!0);assertEqual("Geo Units 4",d.error,"none");setGeometryWidth(m,"{1 Dog}");d=runModel(!0);assertUnequal("Geo Units 5",d.error,"none");clearModel();c=createPrimitive("Var","Variable",[350,350],[200,200]);n=createPrimitive("Var2","Variable",[0,300],[200,100]);f=createPrimitive("Agent","Folder",[300,300],[300,300]);setFolderType(f,"Agent");setParent(c,f);d=createPrimitive("Population","Agents",[0,0],[200,100]);b=createPrimitive("Action",
"Action",[300,0],[200,100]);createConnector("Link","Link",f,d);createConnector("Link","Link",d,c);createConnector("Link","Link",d,n);createConnector("Link","Link",d,b);setAgentBase(d,f);setPopulationSize(d,5);setValue(c,"PopulationSize([Population])");setTriggerType(b,"Condition");setTriggerValue(b,"years=5");setValue(b,"repeat(add([Population]),10)");setValue(n,"Count(unique(Value([Population],[Var])))");d=runModel(!0);assertEqual("Additional Add 1",d.value(n)[0],1);assertEqual("Additional Add 2",
d.value(n)[5],1);assertEqual("Additional Add 3",d.value(n)[6],1);assertEqual("Additional Add 4",d.value(n)[7],1);setValue(b,"repeat([Population].add(),10)");setValue(n,"[Population].Value([Var]).unique().length()");d=runModel(!0);assertEqual("Additional Add 1 (Obj)",d.value(n)[0],1);assertEqual("Additional Add 2 (Obj)",d.value(n)[5],1);assertEqual("Additional Add 3 (Obj)",d.value(n)[6],1);assertEqual("Additional Add 4 (Obj)",d.value(n)[7],1);setValue(n,"max(Value([Population],[Var]))");d=runModel(!0);
assertEqual("Additional Add 5",d.value(n)[0],5);assertEqual("Additional Add 6",d.value(n)[5],5);assertEqual("Additional Add 7",d.value(n)[6],15);assertEqual("Additional Add 8",d.value(n)[7],15);setValue(n,"[Population].value([Var]).max()");d=runModel(!0);assertEqual("Additional Add 5 (Obj)",d.value(n)[0],5);assertEqual("Additional Add 6 (Obj)",d.value(n)[5],5);assertEqual("Additional Add 7 (Obj)",d.value(n)[6],15);assertEqual("Additional Add 8 (Obj)",d.value(n)[7],15);clearModel();test=a}
function testUI(){test="UI";var a=topBarShown();toggleTopBar();assertEqual("Top bar 1",topBarShown(),!a);toggleTopBar();assertEqual("Top bar 2",topBarShown(),a);a=sideBarShown();toggleSideBar();assertEqual("Side bar 1",sideBarShown(),!a);toggleSideBar();assertEqual("Side bar 2",sideBarShown(),a)}
function testMacros(){test="Macros";clearModel();setMacros("a <- 52\nf(x)<-x^2");assertEqual("Get Macros",getMacros(),"a <- 52\nf(x)<-x^2");var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]);setValue(a,"a");setValue(b,"f(2)");var c=runModel(!0);assertEqual("Constant",c.value(a)[3],52);assertEqual("Function",c.value(b)[3],4)}
function testUnitFunctions(){test="Units Functions";clearModel();var a=createPrimitive("p1","Variable",[200,0],[100,100]),b=createPrimitive("p2","Variable",[0,0],[100,100]),c=createPrimitive("p3","Variable",[0,0],[100,100]),d=createPrimitive("p4","Variable",[0,0],[100,100]),e=createPrimitive("p5","Variable",[0,0],[100,100]),f=createPrimitive("p6","Variable",[0,0],[100,100]),g=createPrimitive("p7","Variable",[0,0],[100,100]);setValue(a,"Years");setValue(b,"Months");setValue(c,"Weeks");setValue(d,"Days");
setValue(e,"Hours");setValue(f,"Minutes");setValue(g,"Seconds");var h=runModel(!0);assertEqual("Y",h.value(a)[3],3);assertEqual("Mo",h.value(b)[3],36);assertEqual("W",Math.floor(h.value(c)[3]),156);assertEqual("D",h.value(d)[3],1095);assertEqual("H",h.value(e)[3],26280);assertEqual("Mi",h.value(f)[3],1576800);assertEqual("S",h.value(g)[3],94608E3);setValue(a,"Years(time*2)");setValue(b,"Months(time*2)");setValue(c,"Weeks(time*2)");setValue(d,"Days(time*2)");setValue(e,"Hours(time*2)");setValue(f,
"Minutes(time*2)");setValue(g,"Seconds(time*2)");h=runModel(!0);assertEqual("Y",h.value(a)[3],6);assertEqual("Mo",h.value(b)[3],72);assertEqual("W",Math.floor(h.value(c)[3]),312);assertEqual("D",h.value(d)[3],2190);assertEqual("H",h.value(e)[3],52560);assertEqual("Mi",h.value(f)[3],3153600);assertEqual("S",h.value(g)[3],189216E3);setValue(a,"unitless(TimeStart)");setValue(b,"unitless(TimeLength)");setValue(c,"unitless(TimeStep)");setValue(d,"unitless(TimeEnd)");h=runModel(!0);assertEqual("Time Start",
h.value(a)[3],getTimeStart());assertEqual("Time Length",h.value(b)[3],getTimeLength());assertEqual("Time Step",h.value(c)[3],getTimeStep());assertEqual("Time End",h.value(d)[3],getTimeStart()+getTimeLength())}
function testUnitsAndConstraints(){test="Units and Constraints";clearModel();var a=createPrimitive("tester","Variable",[0,0],[100,10]);setValue(a,"time");setUnits(a,"Seconds");assertEqual("No error",runModel(!0).error,"none");setUnits(a,"Qubits");assertUnequal("Units Error",runModel(!0).error,"none");setUnits(a,"Minutes");assertEqual("No error Units",runModel(!0).error,"none");setConstraints(a,[10,!0,5,!1]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);
assertEqual("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!0]);assertUnequal("Constraints Error",runModel(!0).error,"none");setConstraints(a,[10,!1,5,!1]);assertEqual("Constraints Error",runModel(!0).error,"none")}
function testPrimitiveGetSet(){test="Primitive Get Set";setupComplexDummy();var a=findName("x");setName(a,"xyz");assertEqual("Name",getName(a),"xyz");setNote(a,"abc");assertEqual("Note",getNote(a),"abc");setValue(a,"123");assertEqual("SetValue",getValue(a),"123");setValue(findName("My Flow"),"098");assertEqual("SetValue",getValue(findName("My Flow")),"098");setUnits(findName("My Flow"),"Qubits");assertEqual("SetUnits",getUnits(findName("My Flow")),"Qubits");setFillColor(a,"green");assertEqual("Fill Color",
getFillColor(a),"green");setFontColor(a,"red");assertEqual("Font Color",getFontColor(a),"red");setLineColor(a,"yellow");assertEqual("Line Color",getLineColor(a),"yellow");setOpacity(a,50);assertEqual("Opacity",getOpacity(a),50);setImage(a,"http://testimage.com/image.png");assertEqual("Image",getImage(a),"http://testimage.com/image.png");a=findName("My Flow");setConstraints(a,[-10,!0,10,!1]);assertEqual("SetConstraints",getConstraints(a)[0],-10);assertEqual("SetConstraints",getConstraints(a)[1],!0);
assertEqual("SetConstraints",getConstraints(a)[2],10);assertEqual("SetConstraints",getConstraints(a)[3],!1);setConstraints(findName("My Flow"),[-10,!1,10,!0]);assertEqual("SetConstraints",getConstraints(a)[1],!1);assertEqual("SetConstraints",getConstraints(a)[3],!0);setNonNegative(a,!0);assertEqual("Set Non Negative Flow",getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set Non Negative Flow",getNonNegative(a),!1);a=findName("My Stock");setNonNegative(a,!0);assertEqual("Set Non Negative Stock",
getNonNegative(a),!0);setNonNegative(a,!1);assertEqual("Set Non Negative Stock",getNonNegative(a),!1);setDelay(a,5);assertEqual("Set Delay",getDelay(a),5);setStockType(a,"Conveyor");assertEqual("Set Type",getStockType(a),"Conveyor");setStockType(a,"Store");assertEqual("Set Type",getStockType(a),"Store");var b=findName("My Converter");setData(b,"fdsgsdg");assertEqual("Set Data",getData(b),"fdsgsdg");setConverterInput(b,a);assertEqual("Set Source",getConverterInput(b).id,a.id);setConverterInput(b,null);
assertNull("Set Source 2",getConverterInput(b));setInterpolation(b,"fdsf");assertEqual("Set Interpolation",getInterpolation(b),"fdsf");a=createPrimitive("My State","State",[100,60],[100,100]);setValue(a,"abc");assertEqual("State Set Value",getValue(a),"abc");assertEqual("State Get Residency",getResidency(a),"0");setResidency(a,"xyz");assertEqual("State Set Residency",getResidency(a),"xyz");a=createConnector("My Transition","Transition",a,null);setValue(a,"abc1");assertEqual("Transition Set Value",
getValue(a),"abc1");setTriggerValue(a,"abc12");assertEqual("Transition Set Value 2",getTriggerValue(a),"abc12");assertEqual("Transition Get Trigger 1",getTriggerType(a),"Timeout");setTriggerType(a,"Condition");assertEqual("Transition Get Trigger 2",getTriggerType(a),"Condition");assertEqual("Transition Get Trigger Repeat 1",getTriggerRepeat(a),!1);setTriggerRepeat(a,!0);assertEqual("Transition Get Trigger Repeat 2",getTriggerRepeat(a),!0);assertEqual("Transition Get Trigger Recalculate 1",getTriggerRecalculate(a),
!1);setTriggerRecalculate(a,!0);assertEqual("Transition Get Trigger Recalculate 2",getTriggerRecalculate(a),!0);a=createPrimitive("My Action","Action",[100,60],[100,100]);setValue(a,"abc1");assertEqual("Action Set Value",getValue(a),"abc1");setTriggerValue(a,"abc123");assertEqual("Action Set Value 2",getTriggerValue(a),"abc123");assertEqual("Action Set Value 3",getValue(a),"abc1");assertEqual("Action Get Trigger 1",getTriggerType(a),"Probability");setTriggerType(a,"Timeout");assertEqual("Action Get Trigger 2",
getTriggerType(a),"Timeout");assertEqual("Action Get Trigger Repeat 1",getTriggerRepeat(a),!0);setTriggerRepeat(a,!1);assertEqual("Action Get Trigger Repeat 2",getTriggerRepeat(a),!1);assertEqual("Action Get Trigger Recalculate 1",getTriggerRecalculate(a),!1);setTriggerRecalculate(a,!0);assertEqual("Action Get Trigger Recalculate 2",getTriggerRecalculate(a),!0);b=createPrimitive("My Agents","Agents",[300,300],[200,100]);setPopulationSize(b,123);assertEqual("Agents Size",getPopulationSize(b),123);
setGeometryUnits(b,"foo bar");assertEqual("Agents Units",getGeometryUnits(b),"foo bar");setGeometryHeight(b,"foo bar 1");assertEqual("Agents Height",getGeometryHeight(b),"foo bar 1");setGeometryWidth(b,"foo bar 2");assertEqual("Agents Width",getGeometryWidth(b),"foo bar 2");setAgentPlacement(b,"foo bar 3");assertEqual("Agents Placement",getAgentPlacement(b),"foo bar 3");setAgentPlacementFunction(b,"foo bar 4");assertEqual("Agents Placement Function",getAgentPlacementFunction(b),"foo bar 4");setAgentNetwork(b,
"foo bar 5");assertEqual("Agents Network",getAgentNetwork(b),"foo bar 5");setAgentNetworkFunction(b,"foo bar 6");assertEqual("Agents Network Function",getAgentNetworkFunction(b),"foo bar 6");setGeometryWrap(b,!0);assertEqual("Agents Wrap 1",getGeometryWrap(b),!0);setGeometryWrap(b,!1);assertEqual("Agents Wrap 2",getGeometryWrap(b),!1);a=createPrimitive("f","Folder",[200,150],[150,100]);createConnector("Link","Link",a,b);setAgentBase(b,a);assertEqual("Agents Base",getAgentBase(b).id,a.id);setFolderSolver(a,
{a:1});assertEqual("Folder Solver",getFolderSolver(a).a,1)}
function testSimulationGetSet(){test="Simulation Get Set";setAlgorithm("x");assertEqual("Algorithm",getAlgorithm(),"x");setTimeStep(72);assertEqual("Time Step",getTimeStep(),72);setTimeLength(43);assertEqual("Time Length",getTimeLength(),43);setTimeStart(32);assertEqual("Time Start",getTimeStart(),32);setPauseInterval(1.2);assertEqual("Pause Interval",getPauseInterval(),1.2);setTimeUnits("foo");assertEqual("Time Units",getTimeUnits(),"foo")}
function testSimulation(){test="Simulation Test";setTimeUnits("Years");setTimeStep(1);setTimeStart(0);setTimeLength(10);for(var a=["RK1","RK4"],b=0;b<a.length;b++){console.log("--- Using Algorithm: "+a[b]);setAlgorithm(a[b]);setTimeLength(10);clearModel();var c=createPrimitive("My Stock","Stock",[10,10],[140,50]),d=createConnector("My Flow","Flow",c,null);setValue(c,"100");setValue(d,"0.1*[Alpha]");var e=runModel(!0);assertEqual("Length",e.Time.length,11);assertEqual("Time Start",e.Time[0],0);assertEqual("Time End",
e.Time[10],10);assertEqual("Stock Start",e.value(c)[0],100);clearModel();setTimeLength(100);clearModel();var f=createPrimitive("Y","Stock",[10,10],[140,50]),c=createConnector("My Flow","Flow",null,f);setValue(f,"100");setValue(c,"0.04*[Y]");e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica ExpGrow",Math.round(1E5*e.value(f)[100]),Math.round(5.05049481843E8)):"RK4"==a[b]&&assertEqual("Mathematica ExpGrow",Math.round(1E5*e.value(f)[100]),Math.round(5.45981455268E8));setValue(c,"0.02*[Y]*(1-[Y]/100)*Sin(Years/3)^2");
setValue(f,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(f)[100]),Math.round(522332.33648999996)):"RK4"==a[b]&&assertEqual("Mathematica LogGrow",Math.round(1E5*e.value(f)[100]),Math.round(530387.612074));setValue(c,"0.02*[Y]*(1-[Y]/100)*Sin({Years/3 Radians})^2");setValue(f,2);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LogGrow 2",Math.round(1E5*e.value(f)[100]),Math.round(522332.33648999996)):"RK4"==a[b]&&assertEqual("Mathematica LogGrow 2",Math.round(1E5*
e.value(f)[100]),Math.round(530387.612074));var e=createPrimitive("X","Stock",[10,10],[140,50]),g=createConnector("My Flow","Flow",null,e),d=createConnector("My Flow","Flow",e,null),h=createConnector("My Flow","Flow",f,null);createConnector("Link","Link",e,c);createConnector("Link","Link",f,d);setValue(c,"[Y]*0.001*[X]");setValue(h,"[Y]*0.1");setValue(g,"[X]*0.1");setValue(d,"[X]*0.0001*[Y]");setValue(e,200);setValue(f,100);e=runModel(!0);"RK1"==a[b]?assertEqual("Mathematica LV",Math.round(1E5*e.value(f)[100]),
Math.round(1525172.07902)):"RK4"==a[b]&&assertEqual("Mathematica LV",Math.round(1E5*e.value(f)[100]),Math.round(4.1183764750399995E8));setTimeLength(10);clearModel();e=createPrimitive("X","Stock",[10,10],[140,50]);f=createPrimitive("V","Variable",[10,10],[140,50]);g=createConnector("Flow","Flow",null,e);createConnector("Link","Link",g,f);setValue(g,"[X]*0.1");setValue(e,200);setValue(f,"[Flow]");e=runModel(!0);"RK1"==a[b]?(assertEqual("Flow Time Correct 1",Math.round(1E5*e.value(g)[0]),Math.round(2E6)),
assertEqual("Flow Time Correct 2",Math.round(1E5*e.value(f)[0]),Math.round(2E6))):"RK4"==a[b]&&(assertEqual("Flow Time Correct 1",Math.round(1E5*e.value(g)[0]),Math.round(2103416.666)),assertEqual("Flow Time Correct 2",Math.round(1E5*e.value(f)[0]),Math.round(2103416.666)));clearModel();f=createPrimitive("p","Variable",[0,0],[100,100]);setValue(f,"years");e=runModel(!0);assertEqual("Generic Units 1",e.value(f)[4],4);setValue(f,"months");e=runModel(!0);assertEqual("Generic Units 2",e.value(f)[4],48);
clearModel();setTimeLength(100);"RK1"==a[b]&&(f=createPrimitive("My Variable","Variable",[100,100],[140,50]),d=createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,f),setUnits(d,"euros/seconds"),setUnits(f,"euros"),setValue(d,"years*{1 euros/seconds}"),setValue(f,"[My Flow]*{1 seconds}"),e=runModel(!0),assertEqual("More Flow Scaling 1",e.value(f)[20],20),setUnits(d,"euros/years"),e=runModel(!0),assertEqual("More Flow Scaling 2",e.value(f)[20],20),setUnits(d,"euros per years"),
e=runModel(!0),assertEqual("More Flow Scaling 2",e.value(f)[20],20),setValue(d,"years"),setUnits(f,"euros/years"),setValue(f,"[My Flow]"),e=runModel(!0),assertEqual("More Flow Scaling 3",e.value(f)[20],20),clearModel(),f=createPrimitive("My Variable","Variable",[100,100],[140,50]),d=createConnector("My Flow","Flow",null,null),createConnector("link","Link",d,f),setUnits(d,"unitless"),setUnits(f,"unitless"),setNonNegative(d,!1),setValue(d,"10-years"),setValue(f,"[My Flow]"),e=runModel(!0),assertEqual("PositiveOnly with Units",
e.value(f)[20],-10),clearModel());testAgents();clearModel();testSubscripting();clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link","Link",d,f);setUnits(d,"euros/seconds");setUnits(f,"euros/seconds");setValue(d,"10-years");setValue(f,"[My Flow]");e=runModel(!0);assertEqual("PositiveOnly with Units",e.value(f)[20],0);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow",
"Flow",null,c);setUnits(d,"euros/year");setUnits(c,"euros");setValue(d,"10");setValue(c,"1");e=runModel(!0);assertEqual("Unit Flows 1",e.value(c)[10],101);setValue(d,"{10 Euros/years}");setValue(c,"{1 Euros}");e=runModel(!0);assertEqual("Unit Flows 2",e.value(c)[10],101);clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);setValue(f,"Fix(years+12)");e=runModel(!0);assertEqual("Fix 1",e.value(f)[15],12);setValue(f,"Fix(years+12, 5)");e=runModel(!0);assertEqual("Fix 2",e.value(f)[14],
22);setValue(f,"Fix(years+13, {5 years})");e=runModel(!0);assertEqual("Fix 3",e.value(f)[14],23);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);f=createPrimitive("My Variable","Variable",[100,100],[140,50]);createConnector("My Link","Link",c,f);setValue(d,"1");setValue(c,"0");setStockType(c,"Conveyor");setDelay(c,5);setValue(f,"[[My Stock]]");e=runModel(!0);assertEqual("Conveyor 1",e.value(c)[2],0);assertEqual("Conveyor 2",e.value(c)[4],
0);assertEqual("Conveyor 3",e.value(c)[12],8);assertEqual("Conveyor 4",e.value(f)[2],2);assertEqual("Conveyor 5",e.value(f)[12],12);setDelay(c,"{5 years}");e=runModel(!0);assertEqual("Conveyor Units 1",e.value(c)[2],0);assertEqual("Conveyor Units 2",e.value(c)[4],0);assertEqual("Conveyor Units 3",e.value(c)[12],8);assertEqual("Conveyor Units 4",e.value(f)[2],2);assertEqual("Conveyor Units 5",e.value(f)[12],12);setDelay(c,"{365 days}*5");e=runModel(!0);assertEqual("Conveyor Units 6",e.value(c)[2],
0);assertEqual("Conveyor Units 7",e.value(c)[4],0);assertEqual("Conveyor Units 8",e.value(c)[12],8);assertEqual("Conveyor Units 9",e.value(f)[2],2);assertEqual("Conveyor Units 10",e.value(f)[12],12);setValue(f,"[[My Stock]]-[My Stock]");g=createConnector("Outflow","Flow",c,null);setValue(g,"[Alpha]");setValue(d,"2");e=runModel(!0);assertEqual("FSF 1",Math.round(1E3*e.lastValue(c)),2E3);assertEqual("FSF 2",e.lastValue(f),8);assertEqual("FSF 3",e.value(f)[3],6);assertEqual("FSF 4",Math.round(1E3*e.lastValue(g)),
2E3);assertEqual("FSF 5",e.value(g)[3],0);assertEqual("FSF 6",e.lastValue(d),2);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);g=createConnector("My Flow","Flow",c,null);f=createPrimitive("My Variable","Variable",[100,100],[140,50]);createConnector("My Link","Link",c,f);setValue(d,"10");setValue(c,"50");setValue(g,"[My Stock]");setStockType(c,"Conveyor");setDelay(c,5);setValue(f,"[[My Stock]]");e=runModel(!0);assertEqual("Conveyor 11",
e.value(f)[0],50);assertEqual("Conveyor 12",e.value(f)[1],50);assertEqual("Conveyor 13",e.value(f)[2],50);assertEqual("Conveyor 14",e.value(f)[12],50);assertEqual("Conveyor 15",e.value(c)[0],10);assertEqual("Conveyor 16",e.value(c)[1],10);assertEqual("Conveyor 17",e.value(c)[2],10);assertEqual("Conveyor 18",e.value(c)[5],10);assertEqual("Conveyor 19",e.value(c)[12],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);f=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=
createConnector("My Flow","Flow",c,f);setValue(d,"1");setValue(c,"0");setValue(f,"0");e=runModel(!0);assertEqual("Same Name 1",e.value(c)[5],-5);assertEqual("Same Name 2",e.value(f)[5],5);assertEqual("Same Name 3",e.value(c)[10],-10);assertEqual("Same Name 4",e.value(f)[10],10);clearModel();f=createPrimitive("My Variable","Variable",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,null);createConnector("link","Link",d,f);setValue(d,10);setValue(f,"[My Flow]");e=runModel(!0);assertEqual("Flow Value Default",
e.value(f)[20],10);clearModel();var c=createPrimitive("Stock 1","Stock",[100,100],[140,50]),f=createPrimitive("Stock 2","Stock",[100,100],[140,50]),d=createPrimitive("Stock 3","Stock",[100,100],[140,50]),h=createPrimitive("Stock 4","Stock",[100,100],[140,50]),k=createPrimitive("Stock 5","Stock",[100,100],[140,50]),l=createConnector("Flow 1","Flow",null,c),g=createConnector("Flow 2","Flow",null,f),m=createConnector("Flow 3","Flow",null,d),n=createConnector("Flow 4","Flow",null,h),o=createConnector("Flow 5",
"Flow",null,k);setValue(l,1);setUnits(g,"unitless");setValue(g,7);setUnits(g,"1/years");setValue(m,3);setUnits(m,"dollars/years");setUnits(d,"dollars");setValue(n,"{200 centimeters/year}");setUnits(n,"meters/years");setUnits(h,"centimeters");setValue(o,5);setUnits(o,"1/days");e=runModel(!0);assertEqual("Flow Value 1",Math.round(1E3*e.value(l)[20]),1E3);assertEqual("Flow Value 2",Math.round(1E3*e.value(g)[20]),7E3);assertEqual("Flow Value 3",Math.round(1E3*e.value(m)[20]),3E3);assertEqual("Flow Value 4",
Math.round(1E3*e.value(n)[20]),2E3);assertEqual("Flow Value 5",Math.round(1E3*e.value(o)[20]),5E3);assertEqual("Flow Stock Value 1",e.value(c)[2],2);assertEqual("Flow Stock Value 2",Math.round(e.value(f)[2]),14);assertEqual("Flow Stock Value 3",e.value(d)[2],6);assertEqual("Flow Stock Value 4",e.value(h)[2],400);assertEqual("Flow Stock Value 5",Math.round(e.value(k)[2]),3650);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);f=createPrimitive("My Stock 2","Stock",[100,100],[140,
50]);d=createConnector("My Flow","Flow",c,f);setValue(c,10);setValue(f,0);setValue(d,1);e=runModel(!0);assertEqual("Non Negative Stock 1",e.value(c)[20],-10);assertEqual("Non Negative Stock 2",e.value(f)[20],20);setNonNegative(c,!0);e=runModel(!0);assertEqual("Non Negative Stock 3",e.value(c)[20],0);assertEqual("Non Negative Stock 4",e.value(f)[20],10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);setValue(c,"years+10");e=runModel(!0);assertEqual("Stock Function Value 1",e.value(c)[20],
10);clearModel();c=createPrimitive("My Stock","Stock",[100,100],[140,50]);d=createConnector("My Flow","Flow",null,c);setValue(c,10);setValue(d,"years-10");setNonNegative(d,!1);e=runModel(!0);"RK1"==a[b]&&(assertEqual("Non Negative Flow 1 - stock",e.value(c)[1],0),assertEqual("Non Negative Flow 2",Math.round(1E3*e.value(d)[0]),-1E4));setNonNegative(d,!0);e=runModel(!0);assertEqual("Non Negative Flow 3 -stock",e.value(c)[2],10);assertEqual("Non Negative Flow 4",e.value(d)[1],0);clearModel();g=createPrimitive("my converter",
"Converter",[0,0],[100,40]);setData(g,"1,1.1;1.5,4;2,4;3,9;4,16;100,200");f=createPrimitive("Param","Variable",[0,0],[100,40]);createConnector("link","Link",f,g);setValue(f,"years+40");setConverterInput(g,f);e=runModel(!0);assertEqual("Primitive Input Value",200,e.value(g)[60]);setConverterInput(g,null);e=runModel(!0);assertEqual("Time Input Value",1.1,e.value(g)[1]);setData(g,"0,2;20,4");e=runModel(!0);assertEqual("Interpolation",e.value(g)[10],3);setInterpolation(g,"Discrete");e=runModel(!0);assertEqual("No Interpolation",
e.value(g)[10],2);setInterpolation(g,"Linear");e=runModel(!0);assertEqual("Interpolation 2",e.value(g)[10],3);setValue(f,"[my converter]+[my converter]");e=runModel(!0);assertEqual("Converter Addition",e.value(f)[10],6);assertEqual("Converter Addition",e.value(f)[20],8);assertEqual("Converter Addition",e.value(f)[21],8);setUnits(f,"Years");setUnits(g,"Years");e=runModel(!0);assertEqual("Converter Addition",e.value(f)[10],6);assertEqual("Converter Addition",e.value(f)[20],8);assertEqual("Converter Addition",
e.value(f)[21],8);clearModel();f=createPrimitive("My Stock 1","Stock",[0,0],[100,100]);g=createPrimitive("My Stock 2","Stock",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"10");setValue(g,"[My Stock 1]");e=runModel(!0);assertEqual("Stock Init 1",e.value(f)[0],10);assertEqual("Stock Init 2",e.value(g)[0],10);setValue(f,"[My Stock 2]");setValue(g,"20");e=runModel(!0);assertEqual("Stock Init 3",e.value(f)[0],20);assertEqual("Stock Init 4",e.value(g)[0],20);clearModel();f=createPrimitive("My Variable 1",
"Variable",[0,0],[100,100]);g=createPrimitive("My Variable 2","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"10");setUnits(g,"Rabbits");setValue(g,"[My Variable 1]");e=runModel(!0);assertEqual("Unit Conversion Vars 1",e.value(f)[3],10);assertEqual("Unit Conversion Vars 2",e.value(g)[3],10);clearModel();f=createPrimitive("My Variable 1","Variable",[0,0],[100,100]);g=createPrimitive("My Variable 2","Variable",[0,0],[100,100]);c=createPrimitive("My Variable 3","Variable",
[0,0],[100,100]);createConnector("Link","Link",f,g);createConnector("Link","Link",g,c);setValue(f,"{a: 1.2, b:3.2}");setValue(g,"round([My Variable 1])");setValue(c,"[My Variable 2].b");e=runModel(!0);assertEqual("Recurse Function",e.value(c)[3],3);clearModel();f=createPrimitive("My Param","Variable",[0,0],[100,100]);g=createPrimitive("Delayed","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"Years");setValue(g,"Delay([My Param], 5, -3)");e=runModel(!0);assertEqual("Initial Value",
e.value(g)[3],-3);assertEqual("End Delay",e.value(f)[e.periods-6],e.lastValue(g));setValue(g,"Delay([My Param], 0)");e=runModel(!0);assertEqual("0 Delay",e.value(g)[3],e.value(f)[3]);setValue(f,"Years");setValue(g,"Delay([My Param], 5, -3)");e=runModel(!0);assertEqual("[ Initial Value",e.value(g)[3],-3);assertEqual("[ End Delay",e.value(f)[e.periods-6],e.lastValue(g));setValue(g,"Delay([My Param], 0)");e=runModel(!0);assertEqual("[ 0 Delay",e.value(g)[3],e.value(f)[3]);clearModel();f=createPrimitive("My Param",
"Variable",[0,0],[100,100]);setValue(f,"Pulse(10,2,5)");e=runModel(!0);assertEqual("Pulse 1",e.value(f)[5],0);assertEqual("Pulse 2",e.value(f)[12],2);assertEqual("Pulse 3",e.value(f)[16],0);setValue(f,"Pulse(20,.5,2,10)");e=runModel(!0);assertEqual("Pulse 4",e.value(f)[28],0);assertEqual("Pulse 5",e.value(f)[20],0.5);assertEqual("Pulse 6",e.value(f)[30],0.5);setValue(f,"IfThenElse(Years<20 and Years >= 10, 1, 0)");e=runModel(!0);assertEqual("IfThenElse 1",e.value(f)[5],0);assertEqual("IfThenElse 2",
e.value(f)[11],1);setValue(f,"Ramp(10, 15, 10)");e=runModel(!0);assertEqual("Ramp 1",e.value(f)[5],0);assertEqual("Ramp 2",e.value(f)[12],4);assertEqual("Ramp 3",e.value(f)[16],10);setValue(f,"Step(10,3)");e=runModel(!0);assertEqual("Step 1",e.value(f)[5],0);assertEqual("Step 2",e.value(f)[12],3);assertEqual("Step 3",e.value(f)[16],3);clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"(Years-60)^2");
setValue(g,"PastMean([x])");e=runModel(!0);assertEqual("Mean",e.lastValue(g),950);setValue(g,"[x].PastMean()");e=runModel(!0);assertEqual("Mean (Obj)",e.lastValue(g),950);setValue(g,"PastMedian([x])");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(g)),625);setValue(g,"[x].PastMedian()");e=runModel(!0);assertEqual("Median (Obj)",Math.round(e.lastValue(g)),625);setValue(g,"Median(PastValues([x]))");e=runModel(!0);assertEqual("Median 2",Math.round(e.lastValue(g)),625);setValue(g,"[x].PastValues().Median()");
e=runModel(!0);assertEqual("Median 2 (Obj)",Math.round(e.lastValue(g)),625);setValue(g,"PastStdDev([x])");e=runModel(!0);assertEqual("StdDev",Math.round(10*e.lastValue(g)),Math.round(9628));setValue(g,"[x].PastStdDev()");e=runModel(!0);assertEqual("StdDev (Obj)",Math.round(10*e.lastValue(g)),Math.round(9628));setValue(g,"PastMax([x])");e=runModel(!0);assertEqual("Max",Math.round(e.lastValue(g)),3600);setValue(g,"[x].PastMax()");e=runModel(!0);assertEqual("Max (Obj)",Math.round(e.lastValue(g)),3600);
setValue(g,"PastMin([x])");e=runModel(!0);assertEqual("Min",e.lastValue(g),0);setValue(g,"[x].PastMin()");e=runModel(!0);assertEqual("Min (Obj)",e.lastValue(g),0);setValue(f,"(Years-60)^2");setValue(g,"Mean(1,2,3)");e=runModel(!0);assertEqual("Mean",e.lastValue(g),2);setValue(g,"Median(1,2,4)");e=runModel(!0);assertEqual("Median",Math.round(e.lastValue(g)),2);setValue(g,"Max(1,5,7,6)");e=runModel(!0);assertEqual("Max",Math.round(e.lastValue(g)),7);setValue(g,"Min(1,0,7,6)");e=runModel(!0);assertEqual("Min",
e.lastValue(g),0);clearModel();f=createPrimitive("My Param","Variable",[0,0],[100,100]);g=createPrimitive("Smoothed","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"StairCase(40, 3)");setValue(g,"Smooth([My Param],20, 5)");e=runModel(!0);assertEqual("Smooth 1",e.value(g)[0],5);assertEqual("Smooth 2",Math.round(1E3*e.value(g)[40]),Math.round(0.64256*1E3));assertEqual("Smooth 3",Math.round(1E3*e.value(g)[59]),Math.round(2.110412*1E3));setValue(g,"[My Param].Smooth(20, 5)");
e=runModel(!0);assertEqual("Smooth 1 (Obj)",e.value(g)[0],5);assertEqual("Smooth 2 (Obj)",Math.round(1E3*e.value(g)[40]),Math.round(0.64256*1E3));assertEqual("Smooth 3 (obj)",Math.round(1E3*e.value(g)[59]),Math.round(2.110412*1E3));setValue(f,"years");setValue(g,"Smooth([My Param], 20, 5)");e=runModel(!0);assertEqual("Smooth 4",e.value(g)[0],5);assertEqual("Smooth 5",e.value(g)[1],4.75);assertEqual("Smooth 6",Math.round(1E3*e.value(g)[10]),Math.round(4968.42));setValue(g,"Smooth([My Param], 20)");
e=runModel(!0);assertEqual("Smooth 4",e.value(g)[0],0);assertEqual("Smooth 5",e.value(g)[1],0);assertEqual("Smooth 6",Math.round(1E3*e.value(g)[10]),Math.round(1974.74));clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("ExpValue","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"Staircase(20)");setValue(g,"Delay3([x],10,2)");e=runModel(!0);"RK1"==a[b]?(assertEqual("ExpDelay 1",Math.round(100*e.value(g)[3]),Math.round(194.6)),assertEqual("ExpDelay 0",
Math.round(100*e.value(g)[2]),Math.round(200)),assertEqual("ExpDelay 2",Math.round(100*e.value(g)[26]),Math.round(0.269*100))):"RK4"==a[b]&&assertEqual("ExpDelay 1",Math.floor(10*e.value(g)[3]),Math.floor(19.46));setValue(g,"[x].Delay3(10,2)");e=runModel(!0);"RK1"==a[b]?(assertEqual("ExpDelay 1 (Obj)",Math.round(100*e.value(g)[3]),Math.round(194.6)),assertEqual("ExpDelay 0 (Obj)",Math.round(100*e.value(g)[2]),Math.round(200)),assertEqual("ExpDelay 2 (Obj)",Math.round(100*e.value(g)[26]),Math.round(0.269*
100))):"RK4"==a[b]&&assertEqual("ExpDelay 1 (Obj)",Math.floor(10*e.value(g)[3]),Math.floor(19.46));clearModel();f=createPrimitive("RandParam","Variable",[0,0],[100,100]);g=createPrimitive("HalfRand","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"Rand");setValue(g,"[RandParam]/2");e=runModel(!0);assertEqual("RK1 Cached Value",Math.round(1E4*e.lastValue(f)),Math.round(2E4*e.lastValue(g)));e=runModel(!0);c=e.lastValue(f);e=runModel(!0);assertUnequal("Set Rand Seed 1",e.lastValue(f),
c);setMacros("SetRandSeed(1)");e=runModel(!0);c=e.lastValue(f);e=runModel(!0);assertEqual("Set Rand Seed 2",e.lastValue(f),c);setMacros("SetRandSeed(3)");e=runModel(!0);assertUnequal("Set Rand Seed 3",e.lastValue(g),c);setMacros("");clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("Link","Link",f,g);setValue(f,"Years");setValue(g,"Delay([x], {3 Years} )");e=runModel(!0);assertEqual("Time Units Delay 1",Math.round(1E4*
e.value(g)[6]),Math.round(3E4));setValue(g,"[x].Delay({3 Years} )");e=runModel(!0);assertEqual("Time Units Delay 1 (Obj)",Math.round(1E4*e.value(g)[6]),Math.round(3E4));setValue(g,"Delay([x], {48 Months})");e=runModel(!0);assertEqual("Time Units Delay 2",Math.round(1E4*e.value(g)[6]),Math.round(2E4));setValue(g,"PastMean([x], {48 Months})");e=runModel(!0);assertEqual("Time Units Mean 1",Math.round(1E4*e.value(g)[6]),Math.round(4E4));setValue(g,"Mean(PastValues([x], {48 Months}))");e=runModel(!0);
assertEqual("Time Units Mean 2",Math.round(1E4*e.value(g)[6]),Math.round(4E4));setValue(g,"PastMean([x], {3 Years})");e=runModel(!0);assertEqual("Time Units Mean 3",Math.round(1E4*e.value(g)[6]),Math.round(45E3));setValue(g,"PastCorrelation([x],[x])");e=runModel(!0);assertEqual("Correlation",Math.round(1E4*e.value(g)[6]),1E4);setValue(g,"PastCorrelation([x],[x], {3 Years})");e=runModel(!0);assertEqual("Correlation",Math.round(1E4*e.value(g)[6]),1E4);clearModel();f=createPrimitive("x1","Variable",
[0,0],[100,100]);g=createPrimitive("x2","Variable",[0,0],[100,100]);c=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",f,c);createConnector("l2","Link",g,c);setUnits(f,"Centimeters");setUnits(g,"Meters^2");setUnits(c,"Meters^3");setValue(f,"200");setValue(g,"3");setValue(c,"[x1]*[x2]");e=runModel(!0);assertEqual("Variable Units Conversion 1",e.value(c)[50],6);setUnits(f,"Seconds");e=runModel(!0);assertUnequal("Variable Units Conversion 2",e.error,"none");clearModel();f=createPrimitive("y1",
"Variable",[0,0],[100,100]);g=createPrimitive("y2","Variable",[0,0],[100,100]);c=createPrimitive("x","Variable",[0,0],[100,100]);createConnector("l","Link",c,f);createConnector("l2","Link",c,g);setUnits(g,"Centimeters");setValue(c,"years");setValue(f,"delay([x],3)");setValue(g,"delay([x],5)");e=runModel(!0);assertEqual("Past Values Clone Check 1",e.value(f)[10],7);assertEqual("Past Values Clone Check 2",e.value(g)[10],5);assertEqual("Past Values Clone Check 3",e.value(c)[10],10);setValue(f,"delay1([x],2)");
setValue(g,"delay1([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 4",e.error,"none");setValue(f,"delay3([x],2)");setValue(g,"delay3([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 5",e.error,"none");setValue(f,"smooth([x],2)");setValue(g,"smooth([x],2)");e=runModel(!0);assertEqual("Past Values Clone Check 6",e.error,"none");clearModel();f=createPrimitive("x","Variable",[0,0],[100,100]);g=createPrimitive("y","Variable",[0,0],[100,100]);createConnector("l","Link",f,g);setValue(f,
"{36 Meters}");setValue(g,"1");setUnits(g,"Qubits");e=runModel(!0);assertUnequal("Variable Units Scaling 1",e.error,"none");setUnits(f,"Meters");e=runModel(!0);assertEqual("Variable Units Scaling 2",e.error,"none");setValue(g,"[x]");e=runModel(!0);assertUnequal("Variable Units Scaling 3",e.error,"none")}}function testClearModel(){test="ClearModel";setupDummy();assertUnequal("Initial",findAll().length,0);clearModel();assertEqual("Final",findAll().length,0)}
function testTimeShift(){var a=test;test="Time Shift";clearModel();var b=createPrimitive("A","Stock",[200,200],[140,30]),c=createPrimitive("B","Stock",[400,200],[140,30]),d=createConnector("Flow A","Flow",null,b),e=createConnector("Flow B","Flow",null,c);setValue(b,10);setValue(c,10);setValue(d,"0.1*[A]");setValue(e,"0.1*[B]");var f=createPrimitive("f A","Folder",[200,150],[150,100]),g=createPrimitive("f B","Folder",[200,150],[150,100]);setParent([b,d],f);setParent([c,e],g);setTimeLength(10);setTimeStep(1);
setAlgorithm("RK1");d=runModel(!0);assertEqual("Base 1",d.value(b)[1],11);assertEqual("Base 2",d.value(c)[1],11);setFolderSolver(f,{enabled:!0,algorithm:"RK4",timeStep:1});d=runModel(!0);assertEqual("Switch 1",Math.round(1E3*d.value(b)[1]),Math.round(11051.708));assertEqual("Switch 2",d.value(c)[1],11);setFolderSolver(g,{enabled:!0,algorithm:"RK1",timeStep:2.5});d=runModel(!0);assertEqual("Switch 3",Math.round(1E3*d.value(b)[1]),Math.round(11051.708));assertEqual("Switch 4",isUndefined(d.value(c)[1]),
!0);assertEqual("Switch 5",d.value(c)[3],12.5);assertEqual("Switch 6",isUndefined(d.value(b)[3]),!0);setFolderSolver(f,{enabled:!0,algorithm:"RK4",timeStep:2.5});setFolderSolver(g,{enabled:!0,algorithm:"RK1",timeStep:1});d=runModel(!0);assertEqual("Switch 7",isUndefined(d.value(b)[1]),!0);assertEqual("Switch 8",d.value(c)[1],11);assertEqual("Switch 9",Math.round(1E3*d.value(b)[3]),Math.round(12.8401699*1E3));assertEqual("Switch 10",isUndefined(d.value(c)[3]),!0);test=a}
function testFolders(){test="Folders";var a=createPrimitive("s","Stock",[300,200],[140,30]),b=createPrimitive("f","Folder",[200,150],[150,100]);assertNull("Parent Null",getParent(a));setParent(a,b);assertEqual("Set Parent",getID(getParent(a)),getID(b));assertEqual("Default Folder",getCollapsed(b),!1);collapseFolder(b);assertEqual("Collapse Folder",getCollapsed(b),!0);expandFolder(b);assertEqual("Expand Folder",getCollapsed(b),!1);setParent(a,null);assertNull("Set Parent Null",getParent(a));assertEqual("Get Initial Type 1",
getFolderType(b),"None");setFolderType(b,"Agent");assertEqual("Get Initial Type 2",getFolderType(b),"Agent");setFolderAgentParent(b,"abc");assertEqual("Agent Parent",getFolderAgentParent(b),"abc");clearModel()}
function testCreate(){test="Create";var a=createPrimitive("Test Stock","Stock",[300,200],[140,30]);assertEqual("Name",getName(a),"Test Stock");assertEqual("Type",getType(a),"Stock");var b=getPosition(a);assertEqual("Position x",b[0],300);assertEqual("Position y",b[1],200);setPosition(a,[100,400]);b=getPosition(a);assertEqual("Position x 2",b[0],100);assertEqual("Position y 2",b[1],400);a=createPrimitive("Test Variable","Variable",[400,200],[140,30]);assertEqual("Type",getType(a),"Variable");a=createConnector("Test Link",
"Link",findName("Test Stock"),findName("Test Variable"));assertEqual("Type",getType(a),"Link")}
function testFind(){test="Find";setupComplexDummy();assertEqual("findType",findType("Stock").length,4);assertEqual("findNote",findNote("foo").length,0);setNote(findType("Stock"),"foo");assertEqual("findNote",findNote("foo").length,4);assertEqual("findType",findType(["Stock","Variable"]).length,6);assertEqual("findType",findType(["dsfsdf"]).length,0);assertEqual("findType",findType("dsfsdf").length,0);assertEqual("findAll",findAll().length,10);assertNull("findName",findName("fdfsdgfg"));assertNotNull("findName",
findName("y"));assertEqual("findName",findName("y").length,2);assertEqual("findName",findName(["x","y","fvdf"]).length,3);var a=getID(findName("x"));assertNotNull("findID",findID(a));assertNotNull("findID",findID([a]));assertNull("findID",findID("gfdgdfg"))}function setupDummy(){clearModel();createPrimitive("x","Stock",[200,200],[140,30])}
function setupComplexDummy(){clearModel();createPrimitive("My Converter","Converter",[200,200],[140,30]);createPrimitive("x","Stock",[200,200],[140,30]);createPrimitive("y","Stock",[100,200],[140,30]);createPrimitive("My Stock","Stock",[200,100],[140,30]);createPrimitive("y","Stock",[200,100],[140,30]);createPrimitive("a","Variable",[300,200],[140,30]);createPrimitive("b","Variable",[300,100],[140,30]);createConnector("Link","Link",findName("x"),findName("b"));createConnector("Link 2","Link",findName("x"),
findName("My Converter"));createConnector("My Flow","Flow",findName("x"),findName("My Stock"))};Function.prototype.method=function(a,b){this.prototype[a]=b;return this};Function.method("inherits",function(a){var b={},c=this.prototype=new a;this.method("uber",function(d){d in b||(b[d]=0);var e,f;e=b[d];f=a.prototype;if(e){for(;e;)f=f.constructor.prototype,e-=1;e=f[d]}else e=c[d],e==this[d]&&(e=f[d]);b[d]+=1;f=e.apply(this,Array.prototype.slice.apply(arguments,[1]));b[d]-=1;return f});return this});var unitsBank={};
function sortAndCollapseUnits(a,b){if(1>=a.length)1==a.length&&(a[0]=a[0].toLowerCase());else{for(var c=[],d=0;d<a.length;d++)c.push({name:a[d].toLowerCase(),exponent:b[d]});c.sort(function(a,b){return a.name.localeCompare(b.name)});a=[];b=[];for(d=0;d<c.length;d++)a.push(c[d].name),b.push(c[d].exponent);for(d=0;d<a.length;d++){for(c=d+1;c<a.length;c++)a[d]===a[c]&&(b[d]+=b[c],a.splice(c,1),b.splice(c,1),c--);0==b[d]&&(a.splice(d,1),b.splice(d,1),d--)}}return{names:a,exponents:b}}
function getUnitStore(a,b,c){c&&(b=sortAndCollapseUnits(a,b),a=b.names,b=b.exponents);if(0!=a.length)return c=getUnitsId(a,b),unitsBank[c]||(unitsBank[c]=new UnitStore(a,b)),unitsBank[c]}function getUnitsId(a,b){return a.join(",")+b.join(",")}function UnitStore(a,b){this.names=a;this.exponents=b;this.baseUnits=this.toBase=null;this.multiples={};this.id=getUnitsId(this.names,this.exponents)}
UnitStore.prototype.addBase=function(){if(!this.toBase){this.toBase=1;for(var a=this.names.slice(),b=this.exponents.slice(),c=!0;c;)for(var c=!1,d=a.length-1;0<=d;d--){var e=findSourceIndex(a[d]);if(-1!==e&&!(1==conUnitTargets[e].names.length&&conUnitTargets[e].names[0]==a[d])){this.toBase=fn["*"](this.toBase,fn.expt(conScalings[e],b[d]));a=a.concat(conUnitTargets[e].names);a.splice(d,1);b=b.concat(conUnitTargets[e].exponents.map(function(a){return a*b[d]}));b.splice(d,1);c=!0;break}}a=sortAndCollapseUnits(a,
b);this.baseUnits=getUnitStore(a.names,a.exponents)}};UnitStore.prototype.power=function(a){for(var b=this.names.slice(),c=this.exponents.slice(),d=0;d<c.length;d++)c[d]*=a;return getUnitStore(b,c)};UnitStore.prototype.toStringShort=function(){for(var a="",b=0;b<this.names.length;b++)""!=a&&(a+=","),a+=this.names[b],1!=this.exponents[b]&&(a=a+"^"+this.exponents[b]);return a};
UnitStore.prototype.multiply=function(a,b){var c=a.id+";"+b;if(!this.multiples[c]){this.toBase||this.addBase();a.toBase||a.addBase();if(this.baseUnits){var d=this.baseUnits.names.slice(),e=this.baseUnits.exponents.slice();if(a.baseUnits){for(var f=0;f<a.baseUnits.names.length;f++){var g=d.indexOf(a.baseUnits.names[f]);if(-1!=g)e[g]+=a.baseUnits.exponents[f]*b;else{for(var g=!1,h=0;h<d.length;h++)if(a.baseUnits.names[f]<d[h]){d.splice(h,0,a.baseUnits.names[f]);e.splice(h,0,a.baseUnits.exponents[f]*
b);g=!0;break}g||(d.push(a.baseUnits.names[f]),e.push(a.baseUnits.exponents[f]*b))}}for(f=e.length-1;0<=f;f--)0==e[f]&&(e.splice(f,1),d.splice(f,1))}}else d=a.baseUnits.names.slice(),e=a.baseUnits.exponents.slice();this.multiples[c]=getUnitStore(d,e)}return this.multiples[c]};function unitsFromString(a){var b=[],c=[];if(""!=a)for(var a=a.split(","),d=0;d<a.length;d++)b.push(a[d].split("^")[0]),-1!=a[d].indexOf("^")?c.push(parseFloat(a[d].split("^")[1])):c.push(1);return getUnitStore(b,c,!0)}
var titleCaseReg=/\w\S*/g,titleCaseFunc=function(a){return a.charAt(0).toUpperCase()+a.substr(1).toLowerCase()};function toTitleCase(a){return a.replace(titleCaseReg,titleCaseFunc)}
UnitStore.prototype.toString=function(){for(var a="",b="",c=0,d=0,e=0;e<this.names.length;e++)if(""!=this.names[e]){var f='<span class="unit">'+toTitleCase(this.names[e])+"</span>";1!=this.exponents[e]&&-1!=this.exponents[e]&&(f=f+"<span class='markup'>^</span><sup>"+Math.abs(this.exponents[e])+"</sup>");0<this.exponents[e]?(0<c&&(a+="<span class='markup'>*</span>"),a+=f,c+=1):(0<d&&(b+="<span class='markup'>*</span>"),b+=f,d+=1)}""==a&&(a="Unitless");if(""==b)return'<div class="units">'+a+"</div>";
"Unitless"==a&&(a="1");return'<span class="units">'+a+"<hr/><span class='markup'>/(</span>"+b+"<span class='markup'>)</span></span>"};function convertUnits(a,b,c){if(a===b)return 1;if(a&&!b||b&&!a)return c?1:0;a.toBase||a.addBase();b.toBase||b.addBase();return a.baseUnits!==b.baseUnits?0:fn["/"](a.toBase,b.toBase)};var baseSources="Degree,Radians?,Ampere,Gram,Second,Meter,(Meters? ?Squared?|Squared? ?Meters?),(Centimeters? ?Squared?|Squared? ?Centimeters?),(Centimeters? ?Cubed?|Cubic ?Centimeters?),(Meters? Cubed?|Cubic ?Meters?),(Kilometers? ?Cubed?|Cubic ?Kilometers?),(Inches? Squared?|Squared? ?Inches?),(Miles? ?Squared?|Squared? ?Miles?),(Kilometers? Squared?|Squared? ?Kilometers?),Acre? ?(Feet|Foot),Meters? ?per ?Seconds?,Meters? ?per ?Seconds? ?Squared?,(Foot|Feet) ?per ?Seconds?,(Foot|Feet) ?per ?Seconds? ?Squared?,Miles? ?per ?Hours?,Miles? ?per ?Hours? ?Squared?,Kilometers? ?per ?Hours?,Kilometers? ?per ?Hours? ?Squared?,Liters? ?per ?Seconds?,(Cubic ?Meters?|Meters? ?Cubed?) ?per ?Seconds?,(Squared? ?Yards?|Yards? ?Squared?),(Squared? ?(Feet|Foot)|(Feet|Foot) ?Squared?),(Squared? Millimeters?|Millimeters? ?Squared?),(Millimeters? ?Cubed?|Cubic ?Millimeters?),Gallons? ?per ?Seconds?,Gallons? ?per ?Minutes?,Pounds? ?per ?Seconds?,Kilograms? ?per ?Seconds?,Dollars? ?per ?Seconds?,Dollars? ?per ?Hours?,Dollars? ?per ?Days?,Dollars? ?per ?Weeks?,Dollars? ?per ?Months?,Dollars? ?per ?Quarters?,Dollars? ?per ?Years?,Euros? ?per ?Seconds?,Euros? ?per ?Hours?,Euros? ?per ?Days?,Euros? ?per ?Weeks?,Euros? ?per ?Months?,Euros? ?per ?Quarters?,Euros? ?per ?Years?,Centimeters?,Millimeters?,Kilometers?,Inch(es)?,(Foot|Feet),Yards?,Miles?,Acres?,Hectares?,Liters?,Gallons?,Quarts?,Fluid ?Ounces?,Years?,Quarters?,Months?,Weeks?,Days?,Hours?,Minutes?,Kilograms?,Milligrams?,Ounces?,Pounds?,Tonnes?,Tons?,Watts?,Kilowatts?,Megawatts?,Gigawatts?,Calories?,Kilocalories?,(BTUs?|British ?Thermal ?units?),Kilojoules?,Joules?,Coulombs?,Volts?,Millivolts?,Kilovolts?,Newtons?,Pounds? ?Force,Atoms?,Molecules?,Farads?,Pascals?,Kilopascals?,Bars?,Atmospheres?,Pounds? ?per ?Squared? ?Inch(es)?".split(","),
baseTargets="Degrees;Degrees;Amperes;Grams;Seconds;Meters;Meters^2;Centimeters^2;Centimeters^3;Meters^3;Kilometers^3;Inches^2;Miles^2;Kilometers^2;Acres,Feet;Meters,Seconds^-1;Meters,Seconds^-2;Feet,Seconds^-1;Feet,Seconds^-2;Miles,Hours^-1;Miles,Hours^-2;Kilometers,Hours^-1;Kilometers,Hours^-2;Liters,Seconds^-1;Meters^3,Seconds^-1;Yards^2;Feet^2;Millimeters^2;Millimeters^3;Gallons,Seconds^-1;Gallons,Minutes^-1;Pounds,Seconds^-1;Kilograms,Seconds^-1;Dollars,Seconds^-1;Dollars,Hours^-1;Dollars,Days^-1;Dollars,Weeks^-1;Dollars,Months^-1;Dollars,Quarters^-1;Dollars,Years^-1;Euros,Seconds^-1;Euros,Hours^-1;Euros,Days^-1;Euros,Weeks^-1;Euros,Months^-1;Euros,Quarters^-1;Euros,Years^-1;Meters;Meters;Meters;Meters;Meters;Meters;Meters;Meters^2;Meters^2;Meters^3;Meters^3;Meters^3;Meters^3;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Seconds;Grams;Grams;Grams;Grams;Grams;Grams;Joules,Seconds^-1;Watts;Watts;Watts;Joules;Joules;Joules;Joules;Newtons,Meters;Amperes,Seconds;Watts,Amperes^-1;Volts;Volts;Kilograms,Meters,Seconds^-1;Pounds,Feet per Second Squared;Moles;Moles;Joules,Volts^-2;Newton,Meters^-2;Pascals;Pascals;Pascals;Pascals".split(";"),
baseScalings=[1,180/Math.PI,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0.01,0.0010,1E3,0.0254,0.3048,0.9144,1609.344,4046.85642,1E4,0.0010,0.003785,9.46E-4,3.0E-5,31536E3,7884E3,2628E3,604800,86400,3600,60,1E3,0.0010,28.349523,453.59237,1E6,907184.74,1,1E3,1E6,1E9,4.184,4184,1055.05585,1E3,1,1,1,0.0010,1E3,1,32.17405,0,0,1,1,1E3,1E5,101325,6894],conScalings=[],conTargets=[],conSourceNames=[],conUnitTargets=[],conSourceRegEx=[];
function loadUnits(a,b,c){conScalings=c;conTargets=b;conSourceNames=a;for(a=0;a<baseSources.length;a++)conScalings.push(baseScalings[a]),conTargets.push(baseTargets[a]),conSourceNames.push(baseSources[a]);conSourceRegEx=[];conUnitTargets=[];for(a=0;a<conTargets.length;a++)conUnitTargets.push(unitsFromString(conTargets[a].toLowerCase())),conSourceRegEx.push(RegExp("^"+conSourceNames[a]+"$","i"))}loadUnits([],[],[]);
var findSourceIndex=function(a){if(a in findSourceIndex)return findSourceIndex[a];for(var b=conSourceNames.length-1;0<=b;b--)if(""!=conSourceNames[b]&&conSourceRegEx[b].test(a))return findSourceIndex[a]=b;return findSourceIndex[a]=-1};function Material(a,b){this.value=a;this.units=b}Material.prototype.toNum=function(){return this};
Material.prototype.toString=function(){return this.units?"<span class='markup'>{</span>"+this.value+"&nbsp"+this.units.toString()+"<span class='markup'>}</span>":this.value+""};Material.prototype.fullClone=function(){return new Material(this.value,this.units)};Material.prototype.forceUnits=function(a){if(this.units){var b=convertUnits(this.units,a);0==b?unitAlert(this.units,a,"forceUnits"):(this.value=fn["*"](this.value,b),this.units=a)}else this.units=a;return this};
function unitAlert(a,b,c){throw"MSG: Incompatible units for the "+c+" of "+(a?a.toString():"unitless")+" and "+(b?b.toString():"unitless")+".";};var notsupportedfn=function(){console.log("Not supported")},sn=function(a){return"#"==a[0]?parseFloat(a.substr(2)):parseFloat(a)},fn={"+":function(a,b){return a+b},"-":function(a,b){return isDefined(b)?a-b:-a},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"=":function(a,b){return a==b},"<":function(a,b){return a<b},"<=":function(a,b){return a<=b},">":function(a,b){return a>b},">=":function(a,b){return a>=b},mod:function(a,b){return a%b},expt:function(a,b){return Math.pow(a,b)},abs:Math.abs,
sin:Math.sin,asin:Math.asin,cos:Math.cos,acos:Math.acos,tan:Math.tan,atan:Math.atan,sqrt:Math.sqrt,log:function(a,b){return isDefined(b)?Math.log(a)/Math.log(b):Math.log(a)},exp:Math.exp,round:Math.round,floor:Math.floor,ceiling:Math.ceil,angle:notsupportedfn,magnitude:notsupportedfn,"real-part":function(a){return a}};if("undefined"==typeof org||!org)var org={};if("undefined"==typeof org.antlr||!org.antlr)org.antlr={};org.antlr.global=function(){return this}.call(null);org.antlr.namespace=function(){var a=arguments,b=null,c,d,e;for(c=0;c<a.length;c+=1){e=a[c].split(".");b=org.antlr.global;for(d=0;d<e.length;d+=1)b[e[d]]=b[e[d]]||{},b=b[e[d]]}return b};org.antlr.env=org.antlr.env||{};
org.antlr.env.ua=function(){var a={ie:0,opera:0,gecko:0,webkit:0,mobile:null,air:0,rhino:!1},b,c;try{b=navigator.userAgent;/KHTML/.test(b)&&(a.webkit=1);if((c=b.match(/AppleWebKit\/([^\s]*)/))&&c[1]){a.webkit=parseFloat(c[1]);if(/ Mobile\//.test(b))a.mobile="Apple";else if(c=b.match(/NokiaN[^\/]*/))a.mobile=c[0];if(c=b.match(/AdobeAIR\/([^\s]*)/))a.air=c[0]}if(!a.webkit)if((c=b.match(/Opera[\s\/]([^\s]*)/))&&c[1]){if(a.opera=parseFloat(c[1]),c=b.match(/Opera Mini[^;]*/))a.mobile=c[0]}else if((c=b.match(/MSIE\s([^;]*)/))&&
c[1])a.ie=parseFloat(c[1]);else if(c=b.match(/Gecko\/([^\s]*)/))if(a.gecko=1,(c=b.match(/rv:([^\s\)]*)/))&&c[1])a.gecko=parseFloat(c[1])}catch(d){}try{"undefined"==typeof window&&loadClass&&(a.rhino=!0)}catch(e){}return a}();org.antlr.namespace("org.antlr.runtime.tree");
org.antlr.lang=org.antlr.lang||{isArray:function(a){if(a){var b=org.antlr.lang;return b.isNumber(a.length)&&b.isFunction(a.splice)}return!1},isBoolean:function(a){return"boolean"===typeof a},isFunction:function(a){return"function"===typeof a},isNull:function(a){return null===a},isNumber:function(a){return"number"===typeof a&&isFinite(a)},isObject:function(a){return a&&("object"===typeof a||org.antlr.lang.isFunction(a))||!1},isString:function(a){return"string"===typeof a},isUndefined:function(a){return"undefined"===
typeof a},_IEEnumFix:function(a,b){if(org.antlr.env.ua.ie){var c=["toString","valueOf"],d;for(d=0;d<c.length;d+=1){var e=c[d],f=b[e];org.antlr.lang.isFunction(f)&&f!=Object.prototype[e]&&(a[e]=f)}}},extend:function(a,b,c){if(!b||!a)throw Error("org.antlr.lang.extend failed, please check that all dependencies are included.");var d=function(){};d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;a.superclass=b.prototype;b.prototype.constructor==Object.prototype.constructor&&(b.prototype.constructor=
b);if(c){for(var e in c)a.prototype[e]=c[e];org.antlr.lang._IEEnumFix(a.prototype,c)}},augmentObject:function(a,b){if(!b||!a)throw Error("Absorb failed, verify dependencies.");var c=arguments,d,e=c[2];if(e&&!0!==e)for(d=2;d<c.length;d+=1)a[c[d]]=b[c[d]];else{for(d in b)if(e||!a[d])a[d]=b[d];org.antlr.lang._IEEnumFix(a,b)}},augmentProto:function(a,b){if(!b||!a)throw Error("Augment failed, verify dependencies.");for(var c=[a.prototype,b.prototype],d=2;d<arguments.length;d+=1)c.push(arguments[d]);org.antlr.lang.augmentObject.apply(this,
c)},merge:function(){for(var a={},b=arguments,c=0,d=b.length;c<d;c+=1)org.antlr.lang.augmentObject(a,b[c],!0);return a},isValue:function(a){var b=org.antlr.lang;return b.isObject(a)||b.isString(a)||b.isNumber(a)||b.isBoolean(a)},array:{peek:function(a){if(!org.antlr.lang.isArray(a))throw Error("org.antlr.lang.array.peek: a is not an array.");var b=a.length;if(0>=b)throw Error("org.antlr.lang.array.peek: a is empty.");return a[b-1]}}};
org.antlr.runtime.RecognizerSharedState=function(){this.following=[];this._fsp=-1;this.errorRecovery=!1;this.lastErrorIndex=-1;this.failed=!1;this.backtracking=this.syntaxErrors=0;this.token=this.ruleMemo=null;this.tokenStartCharIndex=-1;this.text=null};org.antlr.runtime.IndexOutOfBoundsException=function(a){org.antlr.runtime.IndexOutOfBoundsException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.IndexOutOfBoundsException,Error,{name:"org.antlr.runtime.IndexOutOfBoundsException"});
org.antlr.runtime.RecognitionException=function(a){org.antlr.runtime.RecognitionException.superclass.constructor.call(this);this.input=a;this.index=a.index();a instanceof org.antlr.runtime.CommonTokenStream&&(this.token=a.LT(1),this.line=this.token.getLine(),this.charPositionInLine=this.token.getCharPositionInLine());a instanceof org.antlr.runtime.tree.TreeNodeStream?this.extractInformationFromTreeNodeStream(a):a instanceof org.antlr.runtime.ANTLRStringStream?(this.c=a.LA(1),this.line=a.getLine(),
this.charPositionInLine=a.getCharPositionInLine()):this.c=a.LA(1);this.message=this.toString()};
org.antlr.lang.extend(org.antlr.runtime.RecognitionException,Error,{input:null,index:null,token:null,node:null,c:null,line:null,name:"org.antlr.runtime.RecognitionException",charPositionInLine:null,approximateLineInfo:null,extractInformationFromTreeNodeStream:function(a){var b,c,d;this.node=a.LT(1);c=a.getTreeAdaptor();if(b=c.getToken(this.node))if(this.token=b,0>=b.getLine()){d=-1;for(b=a.LT(d);b;){if((priorPayload=c.getToken(b))&&0<priorPayload.getLine()){this.line=priorPayload.getLine();this.charPositionInLine=
priorPayload.getCharPositionInLine();this.approximateLineInfo=!0;break}--d;b=a.LT(d)}}else this.line=b.getLine(),this.charPositionInLine=b.getCharPositionInLine();else this.node instanceof org.antlr.runtime.tree.CommonTree?(this.line=this.node.getLine(),this.charPositionInLine=this.node.getCharPositionInLine(),this.node instanceof org.antlr.runtime.tree.CommonTree&&(this.token=this.node.token)):(a=c.getType(this.node),c=c.getText(this.node),this.token=new org.antlr.runtime.CommonToken(a,c))},getUnexpectedType:function(){return this.input instanceof
org.antlr.runtime.CommonTokenStream?this.token.getType():this.input instanceof org.antlr.runtime.tree.TreeNodeStream?this.input.getTreeAdaptor().getType(this.node):this.c}});org.antlr.runtime.MismatchedTokenException=function(a,b){0===arguments.length?this.expecting=org.antlr.runtime.Token.INVALID_TOKEN_TYPE:(org.antlr.runtime.MismatchedTokenException.superclass.constructor.call(this,b),this.expecting=a)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedTokenException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTokenException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTokenException"});org.antlr.runtime.UnwantedTokenException=function(a,b){0<arguments.length&&org.antlr.runtime.UnwantedTokenException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.UnwantedTokenException,org.antlr.runtime.MismatchedTokenException,{getUnexpectedToken:function(){return this.token},toString:function(){var a=", expected "+this.expecting;this.expecting===org.antlr.runtime.Token.INVALID_TOKEN_TYPE&&(a="");return!org.antlr.lang.isValue(this.token)?"UnwantedTokenException(found="+a+")":"UnwantedTokenException(found="+this.token.getText()+a+")"},name:"org.antlr.runtime.UnwantedTokenException"});
org.antlr.runtime.MissingTokenException=function(a,b,c){0<arguments.length&&(org.antlr.runtime.MissingTokenException.superclass.constructor.call(this,a,b),this.inserted=c)};
org.antlr.lang.extend(org.antlr.runtime.MissingTokenException,org.antlr.runtime.MismatchedTokenException,{getMissingType:function(){return this.expecting},toString:function(){return org.antlr.lang.isValue(this.inserted)&&org.antlr.lang.isValue(this.token)?"MissingTokenException(inserted "+this.inserted+" at "+this.token.getText()+")":org.antlr.lang.isValue(this.token)?"MissingTokenException(at "+this.token.getText()+")":"MissingTokenException"},name:"org.antlr.runtime.MissingTokenException"});
org.antlr.runtime.NoViableAltException=function(a,b,c,d){org.antlr.runtime.NoViableAltException.superclass.constructor.call(this,d);this.grammarDecisionDescription=a;this.decisionNumber=b;this.stateNumber=c};
org.antlr.lang.extend(org.antlr.runtime.NoViableAltException,org.antlr.runtime.RecognitionException,{toString:function(){return this.input instanceof org.antlr.runtime.ANTLRStringStream?"NoViableAltException('"+this.getUnexpectedType()+"'@["+this.grammarDecisionDescription+"])":"NoViableAltException("+this.getUnexpectedType()+"@["+this.grammarDecisionDescription+"])"},name:"org.antlr.runtime.NoViableAltException"});
org.antlr.runtime.EarlyExitException=function(a,b){org.antlr.runtime.EarlyExitException.superclass.constructor.call(this,b);this.decisionNumber=a};org.antlr.lang.extend(org.antlr.runtime.EarlyExitException,org.antlr.runtime.RecognitionException,{name:"org.antlr.runtime.EarlyExitException"});org.antlr.runtime.MismatchedSetException=function(a,b){org.antlr.runtime.MismatchedSetException.superclass.constructor.call(this,b);this.expecting=a};
org.antlr.lang.extend(org.antlr.runtime.MismatchedSetException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedSetException"});org.antlr.runtime.MismatchedNotSetException=function(a,b){org.antlr.runtime.MismatchedNotSetException.superclass.constructor.call(this,a,b)};
org.antlr.lang.extend(org.antlr.runtime.MismatchedNotSetException,org.antlr.runtime.MismatchedSetException,{toString:function(){return"MismatchedNotSetException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedNotSetException"});org.antlr.runtime.MismatchedRangeException=function(a,b,c){if(0===arguments.length)return this;org.antlr.runtime.MismatchedRangeException.superclass.constructor.call(this,c);this.a=a;this.b=b};
org.antlr.lang.extend(org.antlr.runtime.MismatchedRangeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedRangeException("+this.getUnexpectedType()+" not in ["+this.a+","+this.b+"])"},name:"org.antlr.runtime.MismatchedRangeException"});org.antlr.runtime.FailedPredicateException=function(a,b,c){org.antlr.runtime.FailedPredicateException.superclass.constructor.call(this,a);this.ruleName=b;this.predicateText=c};
org.antlr.lang.extend(org.antlr.runtime.FailedPredicateException,org.antlr.runtime.RecognitionException,{toString:function(){return"FailedPredicateException("+this.ruleName+",{"+this.predicateText+"}?)"},name:"org.antlr.runtime.FailedPredicateException"});org.antlr.runtime.BitSet=function(a){a||(a=org.antlr.runtime.BitSet.BITS);org.antlr.lang.isArray(a)?this.bits=a:org.antlr.lang.isNumber(a)&&(this.bits=[])};
org.antlr.lang.augmentObject(org.antlr.runtime.BitSet,{BITS:32,LOG_BITS:5,MOD_MASK:31,bitMask:function(a){return 1<<(a&org.antlr.runtime.BitSet.MOD_MASK)},numWordsToHold:function(a){return(a>>org.antlr.runtime.BitSet.LOG_BITS)+1},wordNumber:function(a){return a>>org.antlr.runtime.BitSet.LOG_BITS},of:function(a,b){var c,d,e;if(org.antlr.lang.isNumber(a)){if(org.antlr.lang.isNumber(b)){e=new org.antlr.runtime.BitSet(b+1);for(c=a;c<=b;c++)d=org.antlr.runtime.BitSet.wordNumber(c),e.bits[d]|=org.antlr.runtime.BitSet.bitMask(c)}else e=
new org.antlr.runtime.BitSet(a+1),e.add(a);return e}if(org.antlr.lang.isArray(a)){e=new org.antlr.runtime.BitSet;for(c=a.length-1;0<=c;c--)e.add(a[c]);return e}if(a instanceof org.antlr.runtime.BitSet)return!a?null:a;if(a instanceof org.antlr.runtime.IntervalSet){if(!a)return null;e=new org.antlr.runtime.BitSet;e.addAll(a);return e}if(org.antlr.lang.isObject(a)){d=[];for(c in a)org.antlr.lang.isNumber(c)&&d.push(c);return org.antlr.runtime.BitSet.of(d)}}});
org.antlr.runtime.BitSet.prototype={add:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]|=org.antlr.runtime.BitSet.bitMask(a)},addAll:function(a){var b,c;if(a instanceof org.antlr.runtime.BitSet)this.orInPlace(a);else if(!(a instanceof org.antlr.runtime.IntervalSet)&&org.antlr.lang.isArray(a))for(b=0;b<a.length;b++)c=a[b],this.add(c)},and:function(a){var b=this.clone();b.andInPlace(a);return b},andInPlace:function(a){var b=Math.min(this.bits.length,
a.bits.length),c;for(c=b-1;0<=c;c--)this.bits[c]&=a.bits[c];for(c=b;c<this.bits.length;c++)this.bits[c]=0},clear:function(a){if(0===arguments.length){var b;for(b=this.bits.length-1;0<=b;b--)this.bits[b]=0}else b=org.antlr.runtime.BitSet.wordNumber(a),b>=this.bits.length&&this.growToInclude(a),this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},clone:function(){var a,b,c=[];for(a=0,b=this.bits.length;a<b;a++)c[a]=this.bits[a];return new org.antlr.runtime.BitSet(c)},size:function(){var a=0,b,c,d;for(b=
this.bits.length-1;0<=b;b--)if(c=this.bits[b],0!==c)for(d=org.antlr.runtime.BitSet.BITS-1;0<=d;d--)0!==(c&1<<d)&&a++;return a},equals:function(a){if(!a||!(a instanceof org.antlr.runtime.BitSet))return!1;var b,c=Math.min(this.bits.length,a.bits.length);for(b=0;b<c;b++)if(this.bits[b]!=a.bits[b])return!1;if(this.bits.length>c)for(b=c+1;b<this.bits.length;b++){if(0!==this.bits[b])return!1}else if(a.bits.length>c)for(b=c+1;b<a.bits.length;b++)if(0!==a.bits[b])return!1;return!0},growToInclude:function(a){Math.max(this.bits.length<<
1,org.antlr.runtime.BitSet.numWordsToHold(a));var a=[],b;for(b=0,len=this.bits.length;b<len;b++)a[b]=this.bits[b];this.bits=a},member:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);return b>=this.bits.length?!1:0!==(this.bits[b]&org.antlr.runtime.BitSet.bitMask(a))},getSingleElement:function(){var a;for(a=0;a<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;a++)if(this.member(a))return a;return-1},isNil:function(){var a;for(a=this.bits.length-1;0<=a;a--)if(0!==this.bits[a])return!1;return!0},
complement:function(a){if(a)return a.subtract(this);a=this.clone();a.notInPlace();return a},notInPlace:function(){var a,b,c;if(0===arguments.length)for(a=this.bits.length-1;0<=a;a--)this.bits[a]=~this.bits[a];else{1===arguments.length?(a=0,b=arguments[0]):(a=arguments[0],b=arguments[1]);for(this.growToInclude(b);a<=b;a++)c=org.antlr.runtime.BitSet.wordNumber(a),this.bits[c]^=org.antlr.runtime.BitSet.bitMask(a)}},or:function(a){if(!a)return this;var b=this.clone();b.orInPlace(a);return b},orInPlace:function(a){if(a){a.bits.length>
this.bits.length&&this.setSize(a.bits.length);var b;for(b=Math.min(this.bits.length,a.bits.length)-1;0<=b;b--)this.bits[b]|=a.bits[b]}},remove:function(a){var b=org.antlr.runtime.BitSet.wordNumber(a);b>=this.bits.length&&this.growToInclude(a);this.bits[b]&=~org.antlr.runtime.BitSet.bitMask(a)},setSize:function(a){for(a-=this.bits.length;0<=a;)this.bits.push(0),a--},numBits:function(){return this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS},lengthInLongWords:function(){return this.bits.length},
subset:function(a){return!a?!1:this.and(a).equals(this)},subtractInPlace:function(a){if(a){var b;for(b=0;b<this.bits.length&&b<a.bits.length;b++)this.bits[b]&=~a.bits[b]}},subtract:function(a){if(!a||!(a instanceof org.antlr.runtime.BitSet))return null;var b=this.clone();b.subtractInPlace(a);return b},toArray:function(){var a=[],b,c=0;for(b=0;b<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;b++)this.member(b)&&(a[c++]=b);return a},toPackedArray:function(){return this.bits},toString:function(){return 0===
arguments.length?this.toString1(null):org.antlr.lang.isString(arguments[0])?org.antlr.lang.isValue(arguments[1])?this.toString2(arguments[0],arguments[1]):this.toString1(null):this.toString1(arguments[0])},toString1:function(a){var b="{",c,d=!1;for(c=0;c<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;c++)this.member(c)&&(0<c&&d&&(b+=","),b=a?b+a.getTokenDisplayName(c):b+c.toString(),d=!0);return b+"}"},toString2:function(a,b){var c="",d;for(d=0;d<this.bits.length<<org.antlr.runtime.BitSet.LOG_BITS;d++)this.member(d)&&
(0<c.length&&(c+=a),c=d>=b.size()?c+("'"+d+"'"):org.antlr.lang.isValue(b.get(d))?c+b.get(d):c+("'"+d+"'"));return c}};org.antlr.runtime.CharStream={EOF:-1};
org.antlr.runtime.CommonToken=function(){var a;this.charPositionInLine=-1;this.channel=0;this.index=-1;1==arguments.length?org.antlr.lang.isNumber(arguments[0])?this.type=arguments[0]:(a=arguments[0],this.text=a.getText(),this.type=a.getType(),this.line=a.getLine(),this.index=a.getTokenIndex(),this.charPositionInLine=a.getCharPositionInLine(),this.channel=a.getChannel(),a instanceof org.antlr.runtime.CommonToken&&(this.start=a.start,this.stop=a.stop)):2==arguments.length?(this.type=arguments[0],this.text=
arguments[1],this.channel=0):5==arguments.length&&(this.input=arguments[0],this.type=arguments[1],this.channel=arguments[2],this.start=arguments[3],this.stop=arguments[4])};
org.antlr.runtime.CommonToken.prototype={getType:function(){return this.type},setLine:function(a){this.line=a},getText:function(){if(org.antlr.lang.isString(this.text))return this.text;return!this.input?null:this.text=this.input.substring(this.start,this.stop)},setText:function(a){this.text=a},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setCharPositionInLine:function(a){this.charPositionInLine=a},getChannel:function(){return this.channel},
setChannel:function(a){this.channel=a},setType:function(a){this.type=a},getStartIndex:function(){return this.start},setStartIndex:function(a){this.start=a},getStopIndex:function(){return this.stop},setStopIndex:function(a){this.stop=a},getTokenIndex:function(){return this.index},setTokenIndex:function(a){this.index=a},getInputStream:function(){return this.input},setInputStream:function(a){this.input=a},toString:function(){var a="";0<this.channel&&(a=",channel="+this.channel);var b=this.getText();
org.antlr.lang.isNull(b)?b="<no text>":(b=b.replace(/\n/g,"\\\\n"),b=b.replace(/\r/g,"\\\\r"),b=b.replace(/\t/g,"\\\\t"));return"[@"+this.getTokenIndex()+","+this.start+":"+this.stop+"='"+b+"',<"+this.type+">"+a+","+this.line+":"+this.getCharPositionInLine()+"]"}};org.antlr.runtime.Token=function(){};
org.antlr.lang.augmentObject(org.antlr.runtime.Token,{EOR_TOKEN_TYPE:1,DOWN:2,UP:3,MIN_TOKEN_TYPE:4,EOF:org.antlr.runtime.CharStream.EOF,EOF_TOKEN:new org.antlr.runtime.CommonToken(org.antlr.runtime.CharStream.EOF),INVALID_TOKEN_TYPE:0,INVALID_TOKEN:new org.antlr.runtime.CommonToken(0),SKIP_TOKEN:new org.antlr.runtime.CommonToken(0),DEFAULT_CHANNEL:0,HIDDEN_CHANNEL:99});org.antlr.lang.augmentObject(org.antlr.runtime.CommonToken,org.antlr.runtime.Token);
org.antlr.runtime.tree.RewriteCardinalityException=function(a){this.elementDescription=a};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteCardinalityException,Error,{getMessage:function(){return org.antlr.lang.isString(this.elementDescription)?this.elementDescription:null},name:function(){return"org.antlr.runtime.tree.RewriteCardinalityException"}});
org.antlr.runtime.tree.RewriteEmptyStreamException=function(a){org.antlr.runtime.tree.RewriteEmptyStreamException.superclass.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEmptyStreamException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEmptyStreamException"}});
org.antlr.runtime.tree.RewriteEarlyExitException=function(a){var b=org.antlr.runtime.tree.RewriteEarlyExitException.superclass;org.antlr.lang.isUndefined(a)&&(a=null);b.constructor.call(this,a)};org.antlr.lang.extend(org.antlr.runtime.tree.RewriteEarlyExitException,org.antlr.runtime.tree.RewriteCardinalityException,{name:function(){return"org.antlr.runtime.tree.RewriteEarlyExitException"}});
org.antlr.runtime.MismatchedTreeNodeException=function(a,b){a&&b&&(org.antlr.runtime.MismatchedTreeNodeException.superclass.constructor.call(this,b),this.expecting=a)};org.antlr.lang.extend(org.antlr.runtime.MismatchedTreeNodeException,org.antlr.runtime.RecognitionException,{toString:function(){return"MismatchedTreeNodeException("+this.getUnexpectedType()+"!="+this.expecting+")"},name:"org.antlr.runtime.MismatchedTreeNodeException"});org.antlr.runtime.tree.BaseTree=function(){};
org.antlr.runtime.tree.BaseTree.prototype={getChild:function(a){return!this.children||a>=this.children.length?null:this.children[a]},getChildren:function(){return this.children},getFirstChildWithType:function(a){var b,c;for(b=0;this.children&&b<this.children.length;b++)if(c=this.children[b],c.getType()===a)return c;return null},getChildCount:function(){return!this.children?0:this.children.length},addChild:function(a){if(org.antlr.lang.isValue(a)){var b,c,d;if(a.isNil()){if(this.children&&this.children==
a.children)throw Error("attempt to add child list to itself");if(a.children)if(this.children){b=a.children.length;for(c=0;c<b;c++)d=a.children[c],this.children.push(d),d.setParent(this),d.setChildIndex(this.children.length-1)}else this.children=a.children,this.freshenParentAndChildIndexes()}else this.children||(this.children=this.createChildrenList()),this.children.push(a),a.setParent(this),a.setChildIndex(this.children.length-1)}},addChildren:function(a){var b,c;for(b=0;b<a.length;b++)c=a[b],this.addChild(c)},
setChild:function(a,b){if(b){if(b.isNil())throw Error("Can't set single child to a list");this.children||(this.children=this.createChildrenList());this.children[a]=b;b.setParent(this);b.setChildIndex(a)}},deleteChild:function(a){if(!this.children)return null;if(0>a||a>=this.children.length)throw Error("Index out of bounds.");var b=this.children.splice(a,1)[0];this.freshenParentAndChildIndexes(a);return b},replaceChildren:function(a,b,c){if(!this.children)throw Error("indexes invalid; no children in list");
var d=b-a+1,e,f=null;c.isNil()?f=c.children:(f=[],f.push(c));var g=e=f.length,c=d-e;if(0===c)for(c=0;a<=b;a++)d=f[c],this.children[a]=d,d.setParent(this),d.setChildIndex(a),c++;else{if(0<c){for(c=0;c<g;c++)this.children[a+c]=f[c];for(d=f=a+g;d<=b;d++)this.children.splice(f,1)}else{for(c=0;c<d;c++)this.children[a+c]=f[c];for(c=d;c<e;c++)this.children.splice(a+c,0,f[c])}this.freshenParentAndChildIndexes(a)}},createChildrenList:function(){return[]},isNil:function(){return!1},freshenParentAndChildIndexes:function(a){org.antlr.lang.isNumber(a)||
(a=0);for(var b=this.getChildCount(),c;a<b;a++)c=this.getChild(a),c.setChildIndex(a),c.setParent(this)},sanityCheckParentAndChildIndexes:function(a,b){0===arguments.length&&(a=null,b=-1);if(a!==this.getParent())throw Error("parents don't match; expected "+a+" found "+this.getParent());if(b!==this.getChildIndex())throw Error("child indexes don't match; expected "+b+" found "+this.getChildIndex());var c=this.getChildCount(),d,e;for(d=0;d<c;d++)e=this.getChild(d),e.sanityCheckParentAndChildIndexes(this,
d)},getChildIndex:function(){return 0},setChildIndex:function(){},getParent:function(){return null},setParent:function(){},getTree:function(){return this},toStringTree:function(){if(!this.children||0===this.children.length)return this.toString();var a="",b,c;this.isNil()||(a=a+"("+this.toString(),a+=" ");for(b=0;this.children&&b<this.children.length;b++)c=this.children[b],0<b&&(a+=" "),a+=c.toStringTree();this.isNil()||(a+=")");return a},getLine:function(){return 0},getCharPositionInLine:function(){return 0}};
org.antlr.runtime.tree.CommonTree=function(a){this.childIndex=this.stopIndex=this.startIndex=-1;this.token=this.parent=null;a instanceof org.antlr.runtime.tree.CommonTree?(org.antlr.runtime.tree.CommonTree.superclass.constructor.call(this,a),this.token=a.token,this.startIndex=a.startIndex,this.stopIndex=a.stopIndex):a instanceof org.antlr.runtime.CommonToken&&(this.token=a)};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTree,org.antlr.runtime.tree.BaseTree,{getToken:function(){return this.token},dupNode:function(){return new org.antlr.runtime.tree.CommonTree(this)},isNil:function(){return!this.token},getType:function(){return!this.token?org.antlr.runtime.Token.INVALID_TOKEN_TYPE:this.token.getType()},getText:function(){return!this.token?null:this.token.getText()},getLine:function(){return!this.token||0===this.token.getLine()?0<this.getChildCount()?this.getChild(0).getLine():
0:this.token.getLine()},getCharPositionInLine:function(){return!this.token||-1===this.token.getCharPositionInLine()?0<this.getChildCount()?this.getChild(0).getCharPositionInLine():0:this.token.getCharPositionInLine()},getTokenStartIndex:function(){return this.token?this.token.getTokenIndex():this.startIndex},setTokenStartIndex:function(a){this.startIndex=a},getTokenStopIndex:function(){return this.token?this.token.getTokenIndex():this.stopIndex},setTokenStopIndex:function(a){this.stopIndex=a},getChildIndex:function(){return this.childIndex},
getParent:function(){return this.parent},setParent:function(a){this.parent=a},setChildIndex:function(a){this.childIndex=a},toString:function(){return this.isNil()?"nil":this.getType()===org.antlr.runtime.Token.INVALID_TOKEN_TYPE?"<errornode>":!this.token?null:this.token.getText()}});org.antlr.runtime.tree.Tree={INVALID_NODE:new org.antlr.runtime.tree.CommonTree(org.antlr.runtime.Token.INVALID_TOKEN)};
org.antlr.runtime.tree.CommonErrorNode=function(a,b,c,d){if(!c||c.getTokenIndex()<b.getTokenIndex()&&c.getType()!=org.antlr.runtime.Token.EOF)c=b;this.input=a;this.start=b;this.stop=c;this.trappedException=d};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonErrorNode,org.antlr.runtime.tree.CommonTree,{isNil:function(){return!1},getType:function(){return org.antlr.runtime.Token.INVALID_TOKEN_TYPE},getText:function(){var a=null;if(this.start instanceof org.antlr.runtime.CommonToken){var a=this.start.getTokenIndex(),b=this.stop.getTokenIndex();this.stop.getType()===org.antlr.runtime.Token.EOF&&(b=this.input.size());a=this.input.toString(a,b)}else a=this.start instanceof org.antlr.runtime.tree.CommonTree?
this.input.toString(this.start,this.stop):"<unknown>";return a},toString:function(){return this.trappedException instanceof org.antlr.runtime.MissingTokenException?"<missing type: "+this.trappedException.getMissingType()+">":this.trappedException instanceof org.antlr.runtime.UnwantedTokenException?"<extraneous: "+this.trappedException.getUnexpectedToken()+", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.MismatchedTokenException?"<mismatched token: "+this.trappedException.token+
", resync="+this.getText()+">":this.trappedException instanceof org.antlr.runtime.NoViableAltException?"<unexpected: "+this.trappedException.token+", resync="+this.getText()+">":"<error: "+this.getText()+">"}});org.antlr.runtime.tree.BaseTreeAdaptor=function(){this.uniqueNodeID=1};
org.antlr.runtime.tree.BaseTreeAdaptor.prototype={nil:function(){return this.create(null)},errorNode:function(a,b,c,d){return new org.antlr.runtime.tree.CommonErrorNode(a,b,c,d)},isNil:function(a){return a.isNil()},dupTree:function(a,b){1===arguments.length&&(b=null);if(!a)return null;var c=this.dupNode(a);this.setChildIndex(c,this.getChildIndex(a));this.setParent(c,b);var d=this.getChildCount(a),e,f;for(e=0;e<d;e++)f=this.getChild(a,e),f=this.dupTree(f,a),this.addChild(c,f);return c},addChild:function(a,
b){a&&org.antlr.lang.isValue(b)&&a.addChild(b)},becomeRoot:function(a,b){if(a instanceof org.antlr.runtime.CommonToken||!a)a=this.create(a);var c=a;if(!b)return a;if(c.isNil()){if(1<c.getChildCount())throw Error("more than one node as root (TODO: make exception hierarchy)");c=c.getChild(0)}c.addChild(b);return c},rulePostProcessing:function(a){a&&a.isNil()&&(0===a.getChildCount()?a=null:1===a.getChildCount()&&(a=a.getChild(0),a.setParent(null),a.setChildIndex(-1)));return a},create:function(a,b){var c;
if(2===arguments.length)return org.antlr.lang.isString(arguments[1])?(c=arguments[1],b=this.createToken(a,c)):(b=this.createToken(b),b.setType(a)),c=this.create(b);if(3===arguments.length)return c=arguments[2],b=this.createToken(b),b.setType(a),b.setText(c),c=this.create(b)},getType:function(a){a.getType();return 0},setType:function(){throw Error("don't know enough about Tree node");},getText:function(a){return a.getText()},setText:function(){throw Error("don't know enough about Tree node");},getChild:function(a,
b){return a.getChild(b)},setChild:function(a,b,c){a.setChild(b,c)},deleteChild:function(a,b){return a.deleteChild(b)},getChildCount:function(a){return a.getChildCount()},getUniqueID:function(a){this.treeToUniqueIDMap||(this.treeToUniqueIDMap={});var b=this.treeToUniqueIDMap[a];if(org.antlr.lang.isValue(b))return b;b=this.uniqueNodeID;this.treeToUniqueIDMap[a]=b;this.uniqueNodeID++;return b}};org.antlr.runtime.tree.CommonTreeAdaptor=function(){};
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeAdaptor,org.antlr.runtime.tree.BaseTreeAdaptor,{dupNode:function(a){return!org.antlr.lang.isValue(a)?null:a.dupNode()},create:function(a){return 1<arguments.length?org.antlr.runtime.tree.CommonTreeAdaptor.superclass.create.apply(this,arguments):new org.antlr.runtime.tree.CommonTree(a)},createToken:function(a){return 2===arguments.length?new org.antlr.runtime.CommonToken(arguments[0],arguments[1]):new org.antlr.runtime.CommonToken(arguments[0])},
setTokenBoundaries:function(a,b,c){if(org.antlr.lang.isValue(a)){var d=0,e=0;org.antlr.lang.isValue(b)&&(d=b.getTokenIndex?b.getTokenIndex():b.getStartIndex?b.getStartIndex():b.getTokenStartIndex());org.antlr.lang.isValue(c)&&(e=e.getTokenIndex?c.getTokenIndex():c.getStopIndex?c.getStopIndex():c.getTokenStopIndex());a.setTokenStartIndex(d);a.setTokenStopIndex(e)}},getTokenStartIndex:function(a){return!a?-1:a.getTokenStartIndex()},getTokenStopIndex:function(a){return!a?-1:a.getTokenStopIndex()},getText:function(a){return!a?
null:a.getText()},getType:function(a){return!a?org.antlr.runtime.Token.INVALID_TOKEN_TYPE:a.getType()},getToken:function(a){return a instanceof org.antlr.runtime.tree.CommonTree?a.getToken():null},getChild:function(a,b){return!a?null:a.getChild(b)},getChildCount:function(a){return!a?0:a.getChildCount()},getParent:function(a){return a.getParent()},setParent:function(a,b){a.setParent(b)},getChildIndex:function(a){return a.getChildIndex()},setChildIndex:function(a,b){a.setChildIndex(b)},replaceChildren:function(a,
b,c,d){a&&a.replaceChildren(b,c,d)}});org.antlr.runtime.ANTLRStringStream=function(a){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0;this.lastMarker=this.markers=null;this.data=a;this.n=a.length};
org.antlr.runtime.ANTLRStringStream.prototype={reset:function(){this.p=0;this.line=1;this.markDepth=this.charPositionInLine=0},consume:function(){this.p<this.n&&(this.charPositionInLine++,"\n"===this.data.charAt(this.p)&&(this.line++,this.charPositionInLine=0),this.p++)},LA:function(a){0>a&&a++;a=this.p+a-1;return a>=this.n||0>a?org.antlr.runtime.CharStream.EOF:this.data.charAt(a)},index:function(){return this.p},size:function(){return this.n},mark:function(){this.markers||(this.markers=[],this.markers.push(null));
this.markDepth++;var a=null;this.markDepth>=this.markers.length?(a={},this.markers.push(a)):a=this.markers[this.markDepth];a.p=this.p;a.line=this.line;a.charPositionInLine=this.charPositionInLine;return this.lastMarker=this.markDepth},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);var b=this.markers[a];this.seek(b.p);this.line=b.line;this.charPositionInLine=b.charPositionInLine;this.release(a)},release:function(a){this.markDepth=a;this.markDepth--},seek:function(a){if(a<=this.p)this.p=
a;else for(;this.p<a;)this.consume()},substring:function(a,b){return this.data.substr(a,b-a+1)},getLine:function(){return this.line},getCharPositionInLine:function(){return this.charPositionInLine},setLine:function(a){this.line=a},setCharPositionInLine:function(a){this.charPositionInLine=a},getSourceName:function(){return null}};org.antlr.runtime.ANTLRStringStream.LT=org.antlr.runtime.ANTLRStringStream.LA;
org.antlr.runtime.CommonTokenStream=function(a,b){this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.v_discardOffChannelTokens=!1;this.tokens=[];2<=arguments.length?this.channel=b:1===arguments.length&&(this.tokenSource=a)};
org.antlr.runtime.CommonTokenStream.prototype={setTokenSource:function(a){this.tokenSource=a;this.tokens=[];this.p=-1;this.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL},fillBuffer:function(){for(var a=0,b=this.tokenSource.nextToken(),c,d;org.antlr.lang.isValue(b)&&b.getType()!=org.antlr.runtime.CharStream.EOF;)c=!1,this.channelOverrideMap&&(d=this.channelOverrideMap[b.getType()],org.antlr.lang.isValue(d)&&b.setChannel(d)),this.discardSet&&this.discardSet[b.getType()]?c=!0:this.v_discardOffChannelTokens&&
b.getChannel()!=this.channel&&(c=!0),c||(b.setTokenIndex(a),this.tokens.push(b),a++),b=this.tokenSource.nextToken();this.p=0;this.p=this.skipOffTokenChannels(this.p)},consume:function(){this.p<this.tokens.length&&(this.p++,this.p=this.skipOffTokenChannels(this.p))},skipOffTokenChannels:function(a){for(var b=this.tokens.length;a<b&&this.tokens[a].getChannel()!=this.channel;)a++;return a},skipOffTokenChannelsReverse:function(a){for(;0<=a&&this.tokens[a].getChannel()!=this.channel;)a--;return a},setTokenTypeChannel:function(a,
b){this.channelOverrideMap||(this.channelOverrideMap={});this.channelOverrideMap[a]=b},discardTokenType:function(a){this.discardSet||(this.discardSet={});this.discardSet[a]=!0},discardOffChannelTokens:function(a){this.v_discardOffChannelTokens=a},getTokens:function(a,b,c){-1===this.p&&this.fillBuffer();if(0===arguments.length)return this.tokens;org.antlr.lang.isArray(c)?c=new org.antlr.runtime.BitSet(c):org.antlr.lang.isNumber(c)&&(c=org.antlr.runtime.BitSet.of(c));b>=this.tokens.length&&(b=this.tokens.length-
1);0>a&&(a=0);if(a>b)return null;var d=[],e,f;for(e=a;e<=b;e++)f=this.tokens[e],(!this.types||c.member(f.getType()))&&d.push(f);0===d.length&&(d=null);return d},LT:function(a){-1===this.p&&this.fillBuffer();if(0===a)return null;if(0>a)return this.LB(-1*a);if(this.p+a-1>=this.tokens.length)return org.antlr.runtime.Token.EOF_TOKEN;for(var b=this.p,c=1;c<a;)b=this.skipOffTokenChannels(b+1),c++;return b>=this.tokens.length?org.antlr.runtime.Token.EOF_TOKEN:this.tokens[b]},LB:function(a){-1===this.p&&
this.fillBuffer();if(0===a||0>this.p-a)return null;for(var b=this.p,c=1;c<=a;)b=this.skipOffTokenChannelsReverse(b-1),c++;return 0>b?null:this.tokens[b]},get:function(a){return this.tokens[a]},LA:function(a){return this.LT(a).getType()},mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(){},size:function(){return this.tokens.length},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},reset:function(){this.p=
-1;this.lastMarker=0},seek:function(a){this.p=a},getTokenSource:function(){return this.tokenSource},getSourceName:function(){return this.getTokenSource().getSourceName()},toString:function(a,b){0===arguments.length&&(-1===this.p&&this.fillBuffer(),a=0,b=this.tokens.length-1);if(!org.antlr.lang.isNumber(a)&&!org.antlr.lang.isNumber(b))if(org.antlr.lang.isValue(a)&&org.antlr.lang.isValue(b))a=a.getTokenIndex(),b=b.getTokenIndex();else return null;var c="",d;if(0>a||0>b)return null;-1==this.p&&this.fillBuffer();
b>=this.tokens.length&&(b=this.tokens.length-1);for(d=a;d<=b;d++)t=this.tokens[d],c+=this.tokens[d].getText();return c}};org.antlr.runtime.TokenRewriteStream=function(){var a=org.antlr.runtime.TokenRewriteStream.superclass;this.lastRewriteTokenIndexes=this.programs=null;0!==arguments.length&&a.constructor.apply(this,arguments);this.init()};
(function(){var a=org.antlr.runtime.TokenRewriteStream;org.antlr.lang.augmentObject(a,{DEFAULT_PROGRAM_NAME:"default",PROGRAM_INIT_SIZE:100,MIN_TOKEN_INDEX:0});a.RewriteOperation=function(a,c){this.index=a;this.text=c};a.RewriteOperation.prototype={execute:function(){return this.index},toString:function(){return this.text}};a.InsertBeforeOp=function(b,c){a.InsertBeforeOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.InsertBeforeOp,a.RewriteOperation,{execute:function(a){a.push(this.text);
return this.index}});a.ReplaceOp=function(b,c,d){a.ReplaceOp.superclass.constructor.call(this,b,d);this.lastIndex=c};org.antlr.lang.extend(a.ReplaceOp,a.RewriteOperation,{execute:function(a){org.antlr.lang.isValue(this.text)&&a.push(this.text);return this.lastIndex+1}});a.DeleteOp=function(b,c){a.DeleteOp.superclass.constructor.call(this,b,c)};org.antlr.lang.extend(a.DeleteOp,a.ReplaceOp);org.antlr.lang.extend(a,org.antlr.runtime.CommonTokenStream,{init:function(){this.programs={};this.programs[a.DEFAULT_PROGRAM_NAME]=
[];this.lastRewriteTokenIndexes={}},rollback:function(){var b;1===arguments.length?b=a.DEFAULT_PROGRAM_NAME:2===arguments.length&&(b=arguments[0]);var c=this.programs[b];c&&(programs[b]=c.slice(a.MIN_TOKEN_INDEX,this.instructionIndex))},deleteProgram:function(b){b=b||a.DEFAULT_PROGRAM_NAME;this.rollback(b,a.MIN_TOKEN_INDEX)},addToSortedRewriteList:function(){var b,c;1===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0]):2===arguments.length&&(b=arguments[0],c=arguments[1]);b=this.getProgram(b);
var d,e,f,g,h;for(e=0,d=b.length;e<d;e++)if(f=b[e],f.index===c.index){if(c instanceof a.ReplaceOp){f=!1;for(h=e;h<b.length;h++){g=b[e];if(g.index!==c.index)break;if(g instanceof a.ReplaceOp){b[e]=c;f=!0;break}}f||b.splice(h,0,c)}else b.splice(e,0,c);break}else if(f.index>c.index){b.splice(e,0,c);break}e===d&&b.push(c)},insertAfter:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);
b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.insertBefore(c,b+1,d)},insertBefore:function(){var b,c,d;2===arguments.length?(c=a.DEFAULT_PROGRAM_NAME,b=arguments[0],d=arguments[1]):3===arguments.length&&(c=arguments[0],b=arguments[1],d=arguments[2]);b instanceof org.antlr.runtime.CommonToken&&(b=b.index);this.addToSortedRewriteList(c,new a.InsertBeforeOp(b,d))},replace:function(){var b,c,d,e;2===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[0],e=arguments[1]):
3===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1],e=arguments[2]);4===arguments.length&&(b=arguments[0],c=arguments[1],d=arguments[2],e=arguments[3]);c instanceof org.antlr.runtime.CommonToken&&(c=c.index);d instanceof org.antlr.runtime.CommonToken&&(d=d.index);c>d||0>d||0>c||this.addToSortedRewriteList(b,new a.ReplaceOp(c,d,e))},remove:function(){for(var a=[],c=arguments.length-1;0<=c;)a[c]=arguments[c],c--;a.push("");this.replace.apply(this,a)},getLastRewriteTokenIndex:function(b){b=
b||a.DEFAULT_PROGRAM_NAME;return this.lastRewriteTokenIndexes[b]||-1},setLastRewriteTokenIndex:function(a,c){this.lastRewriteTokenIndexes[a]=c},getProgram:function(a){var c=this.programs[a];c||(c=this.initializeProgram(a));return c},initializeProgram:function(a){var c=[];return this.programs[a]=c},toOriginalString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e).getText());
return d.join("")},toString:function(){var b,c,d;0===arguments.length?(b=a.DEFAULT_PROGRAM_NAME,c=a.MIN_TOKEN_INDEX,d=this.size()-1):1===arguments.length?(b=arguments[0],c=a.MIN_TOKEN_INDEX,d=this.size()-1):2===arguments.length&&(b=a.DEFAULT_PROGRAM_NAME,c=arguments[0],d=arguments[1]);b=this.programs[b];if(!b||0===b.length)return this.toOriginalString(c,d);var e=0,f=c;c=[];for(var g;f>=a.MIN_TOKEN_INDEX&&f<=d&&f<this.tokens.length;){if(e<b.length){for(g=b[e];g.index<f&&e<b.length;)e++,e<b.length&&
(g=b[e]);for(;f===g.index&&e<b.length;)f=g.execute(c),e++,e<b.length&&(g=b[e])}f<=d&&(c.push(this.get(f).getText()),f++)}for(d=e;d<b.length;d++)g=b[d],g.index>=this.size()&&g.execute(c);return c.join("")},toDebugString:function(b,c){org.antlr.lang.isNumber(b)||(b=a.MIN_TOKEN_INDEX);org.antlr.lang.isNumber(c)||(c=this.size()-1);var d=[],e;for(e=b;e>=a.MIN_TOKEN_INDEX&&e<=c&&e<this.tokens.length;e++)d.push(this.get(e));return d.join("")}})})();org.antlr.runtime.tree.TreeNodeStream=function(){};
org.antlr.runtime.tree.CommonTreeNodeStream=function(a,b,c){1===arguments.length&&(b=a,a=new org.antlr.runtime.tree.CommonTreeAdaptor);2>=arguments.length&&(c=org.antlr.runtime.tree.CommonTreeNodeStream.DEFAULT_INITIAL_BUFFER_SIZE);this.uniqueNavigationNodes=!1;this.p=-1;var d=org.antlr.runtime.Token;this.root=b;this.adaptor=a;this.nodes=[];this.down=this.adaptor.create(d.DOWN,"DOWN");this.up=this.adaptor.create(d.UP,"UP");this.eof=this.adaptor.create(d.EOF,"EOF")};
org.antlr.lang.augmentObject(org.antlr.runtime.tree.CommonTreeNodeStream,{DEFAULT_INITIAL_BUFFER_SIZE:100,INITIAL_CALL_STACK_SIZE:10});
org.antlr.lang.extend(org.antlr.runtime.tree.CommonTreeNodeStream,org.antlr.runtime.tree.TreeNodeStream,{StreamIterator:function(){var a=0,b=this.nodes,c=this.eof;return{hasNext:function(){return a<b.length},next:function(){var d=a;a++;return d<b.length?b[d]:c},remove:function(){throw Error("cannot remove nodes from stream");}}},fillBuffer:function(a){var b=!1;org.antlr.lang.isUndefined(a)&&(a=this.root,b=!0);var c=this.adaptor.isNil(a);c||this.nodes.push(a);var d=this.adaptor.getChildCount(a);!c&&
0<d&&this.addNavigationNode(org.antlr.runtime.Token.DOWN);var e,f;for(e=0;e<d;e++)f=this.adaptor.getChild(a,e),this.fillBuffer(f);!c&&0<d&&this.addNavigationNode(org.antlr.runtime.Token.UP);b&&(this.p=0)},getNodeIndex:function(a){-1==this.p&&this.fillBuffer();var b,c;for(b=0;b<this.nodes.length;b++)if(c=this.nodes[b],c===a)return b;return-1},addNavigationNode:function(a){var b=null,b=a===org.antlr.runtime.Token.DOWN?this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.DOWN,
"DOWN"):this.down:this.hasUniqueNavigationNodes()?this.adaptor.create(org.antlr.runtime.Token.UP,"UP"):this.up;this.nodes.push(b)},get:function(a){-1===this.p&&this.fillBuffer();return this.nodes[a]},LT:function(a){-1===this.p&&this.fillBuffer();return 0===a?null:0>a?this.LB(-1*a):this.p+a-1>=this.nodes.length?this.eof:this.nodes[this.p+a-1]},getCurrentSymbol:function(){return this.LT(1)},LB:function(a){return 0===a||0>this.p-a?null:this.nodes[this.p-a]},getTreeSource:function(){return this.root},
getSourceName:function(){return this.getTokenStream().getSourceName()},getTokenStream:function(){return this.tokens},setTokenStream:function(a){this.tokens=a},getTreeAdaptor:function(){return this.adaptor},setTreeAdaptor:function(a){this.adaptor=a},hasUniqueNavigationNodes:function(){return this.uniqueNavigationNodes},setUniqueNavigationNodes:function(a){this.uniqueNavigationNodes=a},consume:function(){-1===this.p&&this.fillBuffer();this.p++},LA:function(a){return this.adaptor.getType(this.LT(a))},
mark:function(){-1===this.p&&this.fillBuffer();return this.lastMarker=this.index()},release:function(){},index:function(){return this.p},rewind:function(a){org.antlr.lang.isNumber(a)||(a=this.lastMarker);this.seek(a)},seek:function(a){-1===this.p&&this.fillBuffer();this.p=a},push:function(a){this.calls||(this.calls=[]);this.calls.push(this.p);this.seek(a)},pop:function(){var a=this.calls.pop();this.seek(a);return a},reset:function(){this.p=-1;this.lastMarker=0;this.calls&&(this.calls=[])},size:function(){-1===
this.p&&this.fillBuffer();return this.nodes.length},iterator:function(){-1===this.p&&this.fillBuffer();return this.StreamIterator()},replaceChildren:function(a,b,c,d){a&&this.adaptor.replaceChildren(a,b,c,d)},toTokenString:function(a,b){-1===this.p&&this.fillBuffer();var c="",d,e;for(d=a;d<this.nodes.length&&d<=b;d++)e=this.nodes[d],c+=" "+this.adaptor.getToken(e);return c},toString:function(a,b){var c="",d,e,f;if(0===arguments.length){-1===this.p&&this.fillBuffer();for(f=0;f<this.nodes.length;f++)e=
this.nodes[f],c+=" ",c+=this.adaptor.getType(e)}else{if(!org.antlr.lang.isNumber(a)||!org.antlr.lang.isNumber(b))return null;-1===this.p&&this.fillBuffer();if(this.tokens)return c=this.adaptor.getTokenStartIndex(a),d=this.adaptor.getTokenStopIndex(b),this.adaptor.getType(b)===org.antlr.runtime.Token.UP?d=this.adaptor.getTokenStopIndex(a):this.adaptor.getType(b)==org.antlr.runtime.Token.EOF&&(d=this.size()-2),this.tokens.toString(c,d);for(f=0;f<this.nodes.length&&!(e=this.nodes[f],e===a);f++);c="";
for(e=this.nodes[f];e!==b;)d=this.adaptor.getText(e),org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(e).toString()),c+=d,f++,e=nodes[f];d=this.adaptor.getText(b);org.antlr.lang.isString(d)||(d=" "+this.adaptor.getType(b).toString());c+=d}return c}});org.antlr.runtime.tree.RewriteRuleElementStream=function(a,b,c){this.cursor=0;this.dirty=!1;this.elementDescription=b;this.adaptor=a;c&&(org.antlr.lang.isArray(c)?(this.singleElement=null,this.elements=c):this.add(c))};
org.antlr.runtime.tree.RewriteRuleElementStream.prototype={reset:function(){this.cursor=0;this.dirty=!0},add:function(a){org.antlr.lang.isValue(a)&&(this.elements?this.elements.push(a):org.antlr.lang.isValue(this.singleElement)?(this.elements=[],this.elements.push(this.singleElement),this.singleElement=null,this.elements.push(a)):this.singleElement=a)},nextTree:function(){var a=this.size();return this.dirty||this.cursor>=a&&1==a?(a=this._next(),this.dup(a)):a=this._next()},_next:function(){var a=
this.size();if(0===a)throw new org.antlr.runtime.tree.RewriteEmptyStreamException(this.elementDescription);if(this.cursor>=a){if(1===a)return this.toTree(this.singleElement);throw new org.antlr.runtime.tree.RewriteCardinalityException(this.elementDescription);}if(org.antlr.lang.isValue(this.singleElement))return this.cursor++,this.toTree(this.singleElement);a=this.toTree(this.elements[this.cursor]);this.cursor++;return a},toTree:function(a){return a&&a.getTree?a.getTree():a},hasNext:function(){return org.antlr.lang.isValue(this.singleElement)&&
1>this.cursor||this.elements&&this.cursor<this.elements.length},size:function(){var a=0;org.antlr.lang.isValue(this.singleElement)&&(a=1);return this.elements?this.elements.length:a},getDescription:function(){return this.elementDescription}};org.antlr.runtime.tree.RewriteRuleNodeStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleNodeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleNodeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this._next()},toTree:function(a){return this.adaptor.dupNode(a)},dup:function(){throw Error("dup can't be called for a node stream.");}});org.antlr.runtime.tree.RewriteRuleTokenStream=function(a,b,c){org.antlr.runtime.tree.RewriteRuleTokenStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleTokenStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){return this.adaptor.create(this._next())},nextToken:function(){return this._next()},toTree:function(a){return a},dup:function(){throw Error("dup can't be called for a token stream.");}});org.antlr.runtime.tree.RewriteRuleSubtreeStream=function(){org.antlr.runtime.tree.RewriteRuleSubtreeStream.superclass.constructor.apply(this,arguments)};
org.antlr.lang.extend(org.antlr.runtime.tree.RewriteRuleSubtreeStream,org.antlr.runtime.tree.RewriteRuleElementStream,{nextNode:function(){var a=this.size();return this.dirty||this.cursor>=a&&1===a?(a=this._next(),this.adaptor.dupNode(a)):a=this._next()},dup:function(a){return this.adaptor.dupTree(a)}});org.antlr.runtime.BaseRecognizer=function(a){this.state=a||new org.antlr.runtime.RecognizerSharedState};
org.antlr.lang.augmentObject(org.antlr.runtime.BaseRecognizer,{MEMO_RULE_FAILED:-2,MEMO_RULE_UNKNOWN:-1,INITIAL_FOLLOW_STACK_SIZE:100,MEMO_RULE_FAILED_I:-2,DEFAULT_TOKEN_CHANNEL:org.antlr.runtime.Token.DEFAULT_CHANNEL,HIDDEN:org.antlr.runtime.Token.HIDDEN_CHANNEL,NEXT_TOKEN_RULE_NAME:"nextToken"});
org.antlr.runtime.BaseRecognizer.prototype={reset:function(){var a,b;if(this.state&&(this.state._fsp=-1,this.state.errorRecovery=!1,this.state.lastErrorIndex=-1,this.state.failed=!1,this.state.syntaxErrors=0,this.state.backtracking=0,this.state.ruleMemo))for(a=0,b=this.state.ruleMemo.length;a<b;a++)this.state.ruleMemo[a]=null},match:function(a,b,c){var d=this.getCurrentInputSymbol(a);if(a.LA(1)===b)return a.consume(),this.state.errorRecovery=!1,this.state.failed=!1,d;return 0<this.state.backtracking?
(this.state.failed=!0,d):d=this.recoverFromMismatchedToken(a,b,c)},matchAny:function(a){this.state.errorRecovery=!1;this.state.failed=!1;a.consume()},mismatchIsUnwantedToken:function(a,b){return a.LA(2)===b},mismatchIsMissingToken:function(a,b){if(!b)return!1;b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)&&(0<=this.state._fsp&&b.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE),this.computeContextSensitiveRuleFOLLOW(),b=b.or(this.viableTokensFollowingThisRule));return b.member(a.LA(1))||b.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE)?
!0:!1},mismatch:function(a,b,c){if(this.mismatchIsUnwantedToken(a,b))throw new org.antlr.runtime.UnwantedTokenException(b,a);if(this.mismatchIsMissingToken(a,c))throw new org.antlr.runtime.MissingTokenException(b,a,null);throw new org.antlr.runtime.MismatchedTokenException(b,a);},reportError:function(a){this.state.errorRecovery||(this.state.syntaxErrors++,this.state.errorRecovery=!0,this.displayRecognitionError(this.getTokenNames(),a))},displayRecognitionError:function(a,b){var c=this.getErrorHeader(b),
d=this.getErrorMessage(b,a);this.emitErrorMessage(c+" "+d)},getErrorHeader:function(a){org.antlr.lang.isNumber(a.line)||(a.line=0);return"line "+a.line+":"+a.charPositionInLine},emitErrorMessage:function(a){if("undefined"!=typeof window&&window.alert)throw a;print(a)},getErrorMessage:function(a,b){var c=a&&a.getMessage?a.getMessage():null;a instanceof org.antlr.runtime.UnwantedTokenException?(c=a.expecting==org.antlr.runtime.Token.EOF?"EOF":b[a.expecting],c="extraneous input "+this.getTokenErrorDisplay(a.getUnexpectedToken())+
" expecting "+c):a instanceof org.antlr.runtime.MissingTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="missing "+c+" at "+this.getTokenErrorDisplay(a.token)):a instanceof org.antlr.runtime.MismatchedTokenException?(c=a,c=c.expecting==org.antlr.runtime.Token.EOF?"EOF":b[c.expecting],c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting "+c):a instanceof org.antlr.runtime.NoViableAltException?c="no viable alternative at input "+this.getTokenErrorDisplay(a.token):
a instanceof org.antlr.runtime.EarlyExitException?c="required (...)+ loop did not match anything at input "+this.getTokenErrorDisplay(a.token):a instanceof org.antlr.runtime.MismatchedSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedNotSetException?c="mismatched input "+this.getTokenErrorDisplay(a.token)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.FailedPredicateException&&(c="rule "+a.ruleName+
" failed predicate: {"+a.predicateText+"}?");return c},getNumberOfSyntaxErrors:function(){return this.state.syntaxErrors},getTokenErrorDisplay:function(a){var b=a.getText();org.antlr.lang.isValue(b)||(b=a.getType()==org.antlr.runtime.Token.EOF?"<EOF>":"<"+a.getType()+">");b=b.replace(/\n/g,"\\n");b=b.replace(/\r/g,"\\r");b=b.replace(/\t/g,"\\t");return"'"+b+"'"},recover:function(a){this.state.lastErrorIndex==a.index()&&a.consume();this.state.lastErrorIndex=a.index();var b=this.computeErrorRecoverySet();
this.beginResync();this.consumeUntil(a,b);this.endResync()},beginResync:function(){},endResync:function(){},computeErrorRecoverySet:function(){return this.combineFollows(!1)},computeContextSensitiveRuleFOLLOW:function(){return this.combineFollows(!0)},combineFollows:function(a){for(var b=this.state._fsp,c,d=new org.antlr.runtime.BitSet;0<=b;b--)if(c=this.state.following[b],d.orInPlace(c),a)if(c.member(org.antlr.runtime.Token.EOR_TOKEN_TYPE))0<b&&d.remove(org.antlr.runtime.Token.EOR_TOKEN_TYPE);else break;
return d},recoverFromMismatchedToken:function(a,b,c){var d=null;if(this.mismatchIsUnwantedToken(a,b))return d=new org.antlr.runtime.UnwantedTokenException(b,a),this.beginResync(),a.consume(),this.endResync(),this.reportError(d),b=this.getCurrentInputSymbol(a),a.consume(),b;if(this.mismatchIsMissingToken(a,c))return c=this.getMissingSymbol(a,d,b,c),d=new org.antlr.runtime.MissingTokenException(b,a,c),this.reportError(d),c;d=new org.antlr.runtime.MismatchedTokenException(b,a);throw d;},recoverFromMismatchedSet:function(a,
b,c){if(this.mismatchIsMissingToken(a,c))return this.reportError(b),this.getMissingSymbol(a,b,org.antlr.runtime.Token.INVALID_TOKEN_TYPE,c);throw b;},getCurrentInputSymbol:function(){return null},getMissingSymbol:function(){return null},consumeUntil:function(a,b){for(var c=a.LA(1);c!=org.antlr.runtime.Token.EOF&&!b.member(c);)a.consume(),c=a.LA(1)},pushFollow:function(a){if(this.state._fsp+1>=this.state.following.length){var b=[],c;for(c=this.state.following.length-1;0<=c;c--)b[c]=this.state.following[c];
this.state.following=b}this.state._fsp++;this.state.following[this.state._fsp]=a},getRuleInvocationStack:function(){throw Error("Not implemented.");},getBacktrackingLevel:function(){return this.state.backtracking},getTokenNames:function(){return null},getGrammarFileName:function(){return null},toStrings:function(a){if(!a)return null;var b=[],c;for(c=0;c<a.length;c++)b.push(a[c].getText());return b},getRuleMemoization:function(a,b){this.state.ruleMemo[a]||(this.state.ruleMemo[a]={});var c=this.state.ruleMemo[a][b];
return!org.antlr.lang.isNumber(c)?org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN:c},alreadyParsedRule:function(a,b){var c=this.getRuleMemoization(b,a.index());if(c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_UNKNOWN)return!1;c==org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED?this.state.failed=!0:a.seek(c+1);return!0},memoize:function(a,b,c){a=this.state.failed?org.antlr.runtime.BaseRecognizer.MEMO_RULE_FAILED:a.index()-1;if(!org.antlr.lang.isValue(this.state.ruleMemo))throw Error("!!!!!!!!! memo array is null for "+
this.getGrammarFileName());if(b>=this.state.ruleMemo.length)throw Error("!!!!!!!!! memo size is "+this.state.ruleMemo.length+", but rule index is "+b);org.antlr.lang.isValue(this.state.ruleMemo[b])&&(this.state.ruleMemo[b][c]=a)},getRuleMemoizationCacheSize:function(){var a=0,b;for(b=0;this.state.ruleMemo&&b<this.state.ruleMemo.length;b++){var c=this.state.ruleMemo[b];c&&(a+=c.length)}return a},traceIn:function(a,b,c){this.emitErrorMessage("enter "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+
this.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)},traceOut:function(a,b,c){this.emitErrorMessage("exit "+a+" "+c);this.state.failed&&this.emitErrorMessage(" failed="+this.state.failed);0<this.state.backtracking&&this.emitErrorMessage(" backtracking="+this.state.backtracking)}};org.antlr.runtime.Lexer=function(a,b){b&&org.antlr.runtime.Lexer.superclass.constructor.call(this,b);a&&(this.input=a)};
org.antlr.lang.extend(org.antlr.runtime.Lexer,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Lexer.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0);org.antlr.lang.isValue(this.state)&&(this.state.token=null,this.state.type=org.antlr.runtime.Token.INVALID_TOKEN_TYPE,this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL,this.state.tokenStartCharIndex=-1,this.state.tokenStartCharPositionInLine=-1,this.state.tokenStartLine=-1,this.state.text=
null)},nextToken:function(){for(;;){this.state.token=null;this.state.channel=org.antlr.runtime.Token.DEFAULT_CHANNEL;this.state.tokenStartCharIndex=this.input.index();this.state.tokenStartCharPositionInLine=this.input.getCharPositionInLine();this.state.tokenStartLine=this.input.getLine();this.state.text=null;if(this.input.LA(1)===org.antlr.runtime.CharStream.EOF)return org.antlr.runtime.Token.EOF_TOKEN;try{this.mTokens();if(org.antlr.lang.isValue(this.state.token)){if(this.state.token==org.antlr.runtime.Token.SKIP_TOKEN)continue}else this.emit();
return this.state.token}catch(a){if(a instanceof org.antlr.runtime.RecognitionException)this.reportError(a);else if(a instanceof org.antlr.runtime.NoViableAltException)this.reportError(a),this.recover(a);else throw a;}}},skip:function(){this.state.token=org.antlr.runtime.Token.SKIP_TOKEN},setCharStream:function(a){this.input=null;this.reset();this.input=a},getCharStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},emit:function(){if(0===arguments.length){var a=
new org.antlr.runtime.CommonToken(this.input,this.state.type,this.state.channel,this.state.tokenStartCharIndex,this.getCharIndex()-1);a.setLine(this.state.tokenStartLine);a.setText(this.state.text);a.setCharPositionInLine(this.state.tokenStartCharPositionInLine);return this.state.token=a}this.state.token=arguments[0]},match:function(a){var b=0;if(org.antlr.lang.isString(a))for(;b<a.length;){if(this.input.LA(1)!=a.charAt(b)){if(0<this.state.backtracking){this.state.failed=!0;break}a=new org.antlr.runtime.MismatchedTokenException(a.charAt(b),
this.input);this.recover(a);throw a;}b++;this.input.consume();this.state.failed=!1}else if(org.antlr.lang.isNumber(a)){if(this.input.LA(1)!=a){if(0<this.state.backtracking){this.state.failed=!0;return}a=new org.antlr.runtime.MismatchedTokenException(a,this.input);this.recover(a);throw a;}this.input.consume();this.state.failed=!1}},matchAny:function(){this.input.consume()},matchRange:function(a,b){if(this.input.LA(1)<a||this.input.LA(1)>b){if(0<this.state.backtracking){this.state.failed=!0;return}mre=
new org.antlr.runtime.MismatchedRangeException(a,b,this.input);this.recover(mre);throw mre;}this.input.consume();this.state.failed=!1},getLine:function(){return this.input.getLine()},getCharPositionInLine:function(){return this.input.getCharPositionInLine()},getCharIndex:function(){return this.input.index()},getText:function(){return org.antlr.lang.isString(this.state.text)?this.state.text:this.input.substring(this.state.tokenStartCharIndex,this.getCharIndex()-1)},setText:function(a){this.state.text=
a},reportError:function(a){this.displayRecognitionError(this.getTokenNames(),a)},getErrorMessage:function(a,b){var c=null;return c=a instanceof org.antlr.runtime.MismatchedTokenException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting "+this.getCharErrorDisplay(a.expecting):a instanceof org.antlr.runtime.NoViableAltException?"no viable alternative at character "+this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.EarlyExitException?"required (...)+ loop did not match anything at character "+
this.getCharErrorDisplay(a.c):a instanceof org.antlr.runtime.MismatchedNotSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedSetException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+a.expecting:a instanceof org.antlr.runtime.MismatchedRangeException?"mismatched character "+this.getCharErrorDisplay(a.c)+" expecting set "+this.getCharErrorDisplay(a.a)+".."+this.getCharErrorDisplay(a.b):
org.antlr.runtime.Lexer.superclass.getErrorMessage.call(this,a,b)},getCharErrorDisplay:function(a){switch(a){case org.antlr.runtime.Token.EOF:a="<EOF>";break;case "\n":a="\\n";break;case "\t":a="\\t";break;case "\r":a="\\r"}return"'"+a+"'"},recover:function(){this.input.consume()},traceIn:function(a,b){var c=String.fromCharCode(this.input.LT(1))+" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceIn.call(this,a,b,c)},traceOut:function(a,b){var c=String.fromCharCode(this.input.LT(1))+
" line="+this.getLine()+":"+this.getCharPositionInLine();org.antlr.runtime.Lexer.superclass.traceOut.call(this,a,b,c)}});org.antlr.runtime.ParserRuleReturnScope=function(){};org.antlr.runtime.ParserRuleReturnScope.prototype={getStart:function(){return this.start},getStop:function(){return this.stop}};org.antlr.runtime.tree.TreeRuleReturnScope=function(){};org.antlr.runtime.tree.TreeRuleReturnScope.prototype={getStart:function(){return this.start}};
org.antlr.runtime.Parser=function(a,b){org.antlr.runtime.Parser.superclass.constructor.call(this,b);this.setTokenStream(a)};
org.antlr.lang.extend(org.antlr.runtime.Parser,org.antlr.runtime.BaseRecognizer,{reset:function(){org.antlr.runtime.Parser.superclass.reset.call(this);org.antlr.lang.isValue(this.input)&&this.input.seek(0)},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,b,c){var b="<missing "+this.getTokenNames()[c]+">",c=new org.antlr.runtime.CommonToken(c,b),b=a.LT(1),d;b.getType()===org.antlr.runtime.Token.EOF&&(d=b,(b=a.LT(-1))||(b=d));c.line=b.getLine();c.charPositionInLine=b.getCharPositionInLine();
c.channel=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;return c},setTokenStream:function(a){this.input=null;this.reset();this.input=a},getTokenStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},traceIn:function(a,b){org.antlr.runtime.Parser.superclass.traceIn.call(this,a,b,this.input.LT(1))},traceOut:function(a,b){org.antlr.runtime.Parser.superclass.traceOut.call(this,a,b,this.input.LT(1))}});org.antlr.runtime.DFA=function(){};
org.antlr.runtime.DFA.prototype={predict:function(a){var b=a.mark(),c=0,d,e,f;try{for(;;)if(d=this.special[c],0<=d){c=this.specialStateTransition(d,a);if(-1===c)return this.noViableAlt(c,a),0;a.consume()}else{if(1<=this.accept[c])return this.accept[c];e=a.LA(1);e===org.antlr.runtime.Token.EOF?e=-1:org.antlr.lang.isString(e)&&(e=e.charCodeAt(0));if(e>=this.min[c]&&e<=this.max[c]){f=this.transition[c][e-this.min[c]];if(0>f){if(0<=this.eot[c]){c=this.eot[c];a.consume();continue}this.noViableAlt(c,a);
return 0}c=f;a.consume()}else if(0<=this.eot[c])c=this.eot[c],a.consume();else{if(e==org.antlr.runtime.Token.EOF&&0<=this.eof[c])return this.accept[this.eof[c]];this.noViableAlt(c,a);return 0}}}finally{a.rewind(b)}},noViableAlt:function(a,b){if(0<this.recognizer.state.backtracking)this.recognizer.state.failed=!0;else{var c=new org.antlr.runtime.NoViableAltException(this.getDescription(),this.decisionNumber,a,b);this.error(c);throw c;}},error:function(){},specialStateTransition:function(){return-1},
getDescription:function(){return"n/a"}};org.antlr.lang.augmentObject(org.antlr.runtime.DFA,{unpackEncodedString:function(a){var b,c=[],d=0,e,f,g;for(b=0;b<a.length;b+=2){e=a.charCodeAt(b);f=a.charCodeAt(b+1);65535===f&&(f=-1);for(g=1;g<=e;g++)c[d++]=f}return c},unpackEncodedStringToUnsignedChars:function(a){return org.antlr.runtime.DFA.unpackEncodedString(a)}});org.antlr.runtime.tree.TreeParser=function(a,b){org.antlr.runtime.tree.TreeParser.superclass.constructor.call(this,b);this.setTreeNodeStream(a)};
(function(){var a=org.antlr.runtime.tree.TreeParser;org.antlr.lang.augmentObject(a,{DOWN:org.antlr.runtime.Token.DOWN,UP:org.antlr.runtime.Token.UP});org.antlr.lang.extend(a,org.antlr.runtime.BaseRecognizer,{reset:function(){a.superclass.reset.call(this);this.input&&this.input.seek(0)},setTreeNodeStream:function(a){this.input=a},getTreeNodeStream:function(){return this.input},getSourceName:function(){return this.input.getSourceName()},getCurrentInputSymbol:function(a){return a.LT(1)},getMissingSymbol:function(a,
c,d){a="<missing "+this.getTokenNames()[d]+">";return new org.antlr.runtime.tree.CommonTree(new org.antlr.runtime.CommonToken(d,a))},matchAny:function(){this.state.errorRecovery=!1;this.state.failed=!1;var b=this.input.LT(1);if(0!==this.input.getTreeAdaptor().getChildCount(b))for(var c=0,b=this.input.getTreeAdaptor().getType(b);b!==org.antlr.runtime.Token.EOF&&!(b===a.UP&&0===c);)this.input.consume(),b=this.input.LT(1),b=this.input.getTreeAdaptor().getType(b),b===a.DOWN?c++:b===a.UP&&c--;this.input.consume()},
mismatch:function(a,c){throw new org.antlr.runtime.MismatchedTreeNodeException(c,a);},getErrorHeader:function(a){return this.getGrammarFileName()+": node from "+(a.approximateLineInfo?"after ":"")+"line "+a.line+":"+a.charPositionInLine},getErrorMessage:function(b,c){var d;this instanceof a&&(d=b.input.getTreeAdaptor(),b.token=d.getToken(b.node),org.antlr.lang.isValue(b.token)||(b.token=new org.antlr.runtime.CommonToken(d.getType(b.node),d.getText(b.node))));return a.superclass.getErrorMessage.call(this,
b,c)},traceIn:function(b,c){a.superclass.traceIn.call(this,b,c,this.input.LT(1))},traceOut:function(b,c){a.superclass.traceOut.call(this,b,c,this.input.LT(1))}})})();var FormulaLexer=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);this.dfa30=new FormulaLexer.DFA30(this);FormulaLexer.superclass.constructor.call(this,a,b)};
org.antlr.lang.augmentObject(FormulaLexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,
T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,
FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});
(function(){var a=org.antlr.runtime.Token.HIDDEN_CHANNEL;org.antlr.lang.extend(FormulaLexer,org.antlr.runtime.Lexer,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,
F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,
RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112,getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaLexer.prototype,{mT__113:function(){var a=this.T__113,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("(");this.state.type=a;this.state.channel=c},mT__114:function(){var a=
this.T__114,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(")");this.state.type=a;this.state.channel=c},mT__115:function(){var a=this.T__115,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<-");this.state.type=a;this.state.channel=c},mT__116:function(){var a=this.T__116,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(".");this.state.type=a;this.state.channel=c},mNEWLINE:function(){var a=this.NEWLINE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,
d=2;"\r"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("\r")}this.match("\n");this.state.type=a;this.state.channel=c},mWHILESTATEMENT:function(){var a=this.WHILESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mW();this.mH();this.mI();this.mL();this.mE();this.state.type=a;this.state.channel=c},mFORSTATEMENT:function(){var a=this.FORSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mO();this.mR();this.state.type=a;this.state.channel=c},
mFROMSTATEMENT:function(){var a=this.FROMSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mR();this.mO();this.mM();this.state.type=a;this.state.channel=c},mINSTATEMENT:function(){var a=this.INSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mN();this.state.type=a;this.state.channel=c},mTOSTATEMENT:function(){var a=this.TOSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mO();this.state.type=a;this.state.channel=
c},mBYSTATEMENT:function(){var a=this.BYSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mB();this.mY();this.state.type=a;this.state.channel=c},mLOOPSTATEMENT:function(){var a=this.LOOPSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mL();this.mO();this.mO();this.mP();this.state.type=a;this.state.channel=c},mIFSTATEMENT:function(){var a=this.IFSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mI();this.mF();this.state.type=a;this.state.channel=
c},mTHENSTATEMENT:function(){var a=this.THENSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mE();this.mN();this.state.type=a;this.state.channel=c},mELSESTATEMENT:function(){var a=this.ELSESTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},mFUNCTIONSTATEMENT:function(){var a=this.FUNCTIONSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();
this.mU();this.mN();this.mC();this.mT();this.mI();this.mO();this.mN();this.state.type=a;this.state.channel=c},mENDBLOCK:function(){var a=this.ENDBLOCK,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mE();this.mN();this.mD();this.state.type=a;this.state.channel=c},mRETURNSTATEMENT:function(){var a=this.RETURNSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mR();this.mE();this.mT();this.mU();this.mR();this.mN();this.state.type=a;this.state.channel=c},mNEWSTATEMENT:function(){var a=
this.NEWSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mN();this.mE();this.mW();this.state.type=a;this.state.channel=c},mTRYSTATEMENT:function(){var a=this.TRYSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mY();this.state.type=a;this.state.channel=c},mCATCHSTATEMENT:function(){var a=this.CATCHSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mA();this.mT();this.mC();this.mH();this.state.type=a;this.state.channel=
c},mTHROWSTATEMENT:function(){var a=this.THROWSTATEMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mH();this.mR();this.mO();this.mW();this.state.type=a;this.state.channel=c},mOR:function(){var a=this.OR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("|"==d)d=1;else if("O"==d||"o"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",2,0,this.input);switch(d){case 1:this.match("||");break;case 2:this.mO(),this.mR()}this.state.type=
a;this.state.channel=c},mXOR:function(){var a=this.XOR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mX();this.mO();this.mR();this.state.type=a;this.state.channel=c},mAND:function(){var a=this.AND,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("&"==d)d=1;else if("A"==d||"a"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",3,0,this.input);switch(d){case 1:this.match("&&");break;case 2:this.mA(),this.mN(),this.mD()}this.state.type=a;
this.state.channel=c},mEQUALS:function(){var a=this.EQUALS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2;if("="==this.input.LA(1))d="="==this.input.LA(2)?2:1;else throw new org.antlr.runtime.NoViableAltException("",4,0,this.input);switch(d){case 1:this.match("=");break;case 2:this.match("==")}this.state.type=a;this.state.channel=c},mNOTEQUALS:function(){var a=this.NOTEQUALS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("!"==d)d=1;else if("<"==d)d=
2;else throw new org.antlr.runtime.NoViableAltException("",5,0,this.input);switch(d){case 1:this.match("!=");break;case 2:this.match("<>")}this.state.type=a;this.state.channel=c},mLT:function(){var a=this.LT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<");this.state.type=a;this.state.channel=c},mLTEQ:function(){var a=this.LTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("<=");this.state.type=a;this.state.channel=c},mGT:function(){var a=this.GT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;
this.match(">");this.state.type=a;this.state.channel=c},mGTEQ:function(){var a=this.GTEQ,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(">=");this.state.type=a;this.state.channel=c},mPLUS:function(){var a=this.PLUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("+");this.state.type=a;this.state.channel=c},mMINUS:function(){var a=this.MINUS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("-");this.state.type=a;this.state.channel=c},mMULT:function(){var a=
this.MULT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("*");this.state.type=a;this.state.channel=c},mDIV:function(){var a=this.DIV,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/");this.state.type=a;this.state.channel=c},mMOD:function(){var a=this.MOD,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("%"==d)d=1;else if("M"==d||"m"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",6,0,this.input);switch(d){case 1:this.match("%");
break;case 2:this.mM(),this.mO(),this.mD()}this.state.type=a;this.state.channel=c},mPOW:function(){var a=this.POW,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("^");this.state.type=a;this.state.channel=c},mNOT:function(){var a=this.NOT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("!"==d)d=1;else if("N"==d||"n"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",7,0,this.input);switch(d){case 1:this.match("!");break;case 2:this.mN(),
this.mO(),this.mT()}this.state.type=a;this.state.channel=c},mLARR:function(){var a=this.LARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("\u00ab"==d)d=1;else if("<"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",8,0,this.input);switch(d){case 1:this.match("\u00ab");break;case 2:this.match("<<")}this.state.type=a;this.state.channel=c},mRARR:function(){var a=this.RARR,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);
if("\u00bb"==d)d=1;else if(">"==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",9,0,this.input);switch(d){case 1:this.match("\u00bb");break;case 2:this.match(">>")}this.state.type=a;this.state.channel=c},mLCURL:function(){var a=this.LCURL,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("{");this.state.type=a;this.state.channel=c},mRCURL:function(){var a=this.RCURL,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("}");this.state.type=a;this.state.channel=
c},mINTEGER:function(){var a=this.INTEGER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=0;a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();
else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=2,e=this.input.LA(1),"0"<=e&&"9">=e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mFLOAT:function(){var a=this.FLOAT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;a:do{var d=2,e=this.input.LA(1);"0"<=e&&"9">=e&&(d=1);switch(d){case 1:this.matchRange("0","9");break;default:break a}}while(1);this.match(".");d=0;
a:do{var e=2,f=this.input.LA(1);"0"<=f&&"9">=f&&(e=1);switch(e){case 1:this.matchRange("0","9");break;default:if(1<=d)break a;throw new org.antlr.runtime.EarlyExitException(15,this.input);}d++}while(1);d=2;"e"==this.input.LA(1)&&(d=1);switch(d){case 1:this.match("e");d=2;e=this.input.LA(1);if("+"==e||"-"==e)d=1;switch(d){case 1:if("+"==this.input.LA(1)||"-"==this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break}a:do switch(d=
2,e=this.input.LA(1),"0"<=e&&"9">=e&&(d=1),d){case 1:this.matchRange("0","9");break;default:break a}while(1)}this.state.type=a;this.state.channel=c},mTRUE:function(){var a=this.TRUE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mT();this.mR();this.mU();this.mE();this.state.type=a;this.state.channel=c},mFALSE:function(){var a=this.FALSE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mF();this.mA();this.mL();this.mS();this.mE();this.state.type=a;this.state.channel=c},
mPER:function(){var a=this.PER,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mP();this.mE();this.mR();this.state.type=a;this.state.channel=c},mSQUARED:function(){var a=this.SQUARED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mS();this.mQ();this.mU();this.mA();this.mR();this.mE();this.mD();this.state.type=a;this.state.channel=c},mCUBED:function(){var a=this.CUBED,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.mC();this.mU();this.mB();this.mE();this.mD();
this.state.type=a;this.state.channel=c},mIDENT:function(){var a=this.IDENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;if("A"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("0"<=e&&"9">=e||"A"<=e&&"Z">=e||"_"==e||"a"<=e&&"z">=e)d=1;switch(d){case 1:if("0"<=this.input.LA(1)&&"9">=this.input.LA(1)||"A"<=
this.input.LA(1)&&"Z">=this.input.LA(1)||"_"==this.input.LA(1)||"a"<=this.input.LA(1)&&"z">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break;default:break a}}while(1);this.state.type=a;this.state.channel=c},mPRIMITIVE:function(){var a=this.PRIMITIVE,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2;if("["==this.input.LA(1))if(d=this.input.LA(2),"\x00"<=d&&"Z">=d||"\\"<=d&&"\uffff">=d)d=1;else if("["==
d)d=2;else throw a=new org.antlr.runtime.NoViableAltException("",22,1,this.input),a;else throw a=new org.antlr.runtime.NoViableAltException("",22,0,this.input),a;switch(d){case 1:this.mLBRACKET();if("\x00"<=this.input.LA(1)&&"Z">=this.input.LA(1)||"\\"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;a:do{var d=2,e=this.input.LA(1);if("]"==e)d=2;else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=
e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.mRBRACKET();break;case 2:this.mLBRACKET();this.mLBRACKET();a:do{d=2;e=this.input.LA(1);if("]"==e)d=2;else if("\x00"<=e&&"\\">=e||"^"<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.mRBRACKET();this.mRBRACKET()}this.state.type=a;this.state.channel=c},mLBRACKET:function(){var a=this.LBRACKET,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("[");this.state.type=a;this.state.channel=
c},mRBRACKET:function(){var a=this.RBRACKET,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("]");this.state.type=a;this.state.channel=c},mCOMMENT:function(){var b=this.COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match("/*");a:do{var c=2,d=this.input.LA(1);if("*"==d)if(d=this.input.LA(2),"/"==d)c=2;else{if("\x00"<=d&&".">=d||"0"<=d&&"\uffff">=d)c=1}else if("\x00"<=d&&")">=d||"+"<=d&&"\uffff">=d)c=1;switch(c){case 1:this.matchAny();break;default:break a}}while(1);
this.match("*/");c=a;this.state.type=b;this.state.channel=c},mLINE_COMMENT:function(){var b=this.LINE_COMMENT,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,c=2,c=this.input.LA(1);if("/"==c)c=1;else if("#"==c)c=2;else throw new org.antlr.runtime.NoViableAltException("",24,0,this.input);switch(c){case 1:this.match("//");break;case 2:this.match("#");break}a:do{var c=2,d=this.input.LA(1);if("\x00"<=d&&"\t">=d||"\x0B"<=d&&"\u000c">=d||"\u000e"<=d&&"\uffff">=d)c=1;switch(c){case 1:if("\x00"<=
this.input.LA(1)&&"\t">=this.input.LA(1)||"\x0B"<=this.input.LA(1)&&"\u000c">=this.input.LA(1)||"\u000e"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:break a}}while(1);c=a;this.state.type=b;this.state.channel=c},mCOLON:function(){var a=this.COLON,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(":");this.state.type=a;this.state.channel=c},mWS:function(){var b=
this.WS,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,c=0;a:do{var d=2,e=this.input.LA(1);if("\t"==e||"\u000c"==e||" "==e)d=1;switch(d){case 1:if("\t"==this.input.LA(1)||"\u000c"==this.input.LA(1)||" "==this.input.LA(1))this.input.consume();else throw b=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(b),b;break;default:if(1<=c)break a;throw new org.antlr.runtime.EarlyExitException(26,this.input);}c++}while(1);c=a;this.state.type=b;this.state.channel=c},mA:function(){if("A"==
this.input.LA(1)||"a"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mB:function(){if("B"==this.input.LA(1)||"b"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mC:function(){if("C"==this.input.LA(1)||"c"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);
throw a;}},mD:function(){if("D"==this.input.LA(1)||"d"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mE:function(){if("E"==this.input.LA(1)||"e"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mF:function(){if("F"==this.input.LA(1)||"f"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mG:function(){if("G"==this.input.LA(1)||"g"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mH:function(){if("H"==this.input.LA(1)||"h"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mI:function(){if("I"==this.input.LA(1)||"i"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mJ:function(){if("J"==this.input.LA(1)||"j"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mK:function(){if("K"==this.input.LA(1)||"k"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mL:function(){if("L"==this.input.LA(1)||"l"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mM:function(){if("M"==this.input.LA(1)||"m"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mN:function(){if("N"==this.input.LA(1)||"n"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mO:function(){if("O"==this.input.LA(1)||"o"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mP:function(){if("P"==this.input.LA(1)||"p"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mQ:function(){if("Q"==this.input.LA(1)||"q"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mR:function(){if("R"==this.input.LA(1)||"r"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mS:function(){if("S"==this.input.LA(1)||"s"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mT:function(){if("T"==this.input.LA(1)||"t"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mU:function(){if("U"==this.input.LA(1)||"u"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mV:function(){if("V"==this.input.LA(1)||"v"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mW:function(){if("W"==this.input.LA(1)||"w"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mX:function(){if("X"==this.input.LA(1)||"x"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,
this.input);this.recover(a);throw a;}},mY:function(){if("Y"==this.input.LA(1)||"y"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mZ:function(){if("Z"==this.input.LA(1)||"z"==this.input.LA(1))this.input.consume();else{var a=new org.antlr.runtime.MismatchedSetException(null,this.input);this.recover(a);throw a;}},mCOMMA:function(){var a=this.COMMA,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL;this.match(",");
this.state.type=a;this.state.channel=c},mSTRING:function(){var a=this.STRING,c=org.antlr.runtime.BaseRecognizer.DEFAULT_TOKEN_CHANNEL,d=2,d=this.input.LA(1);if("'"==d)d=1;else if('"'==d)d=2;else throw new org.antlr.runtime.NoViableAltException("",29,0,this.input);switch(d){case 1:this.match("'");a:do{var d=2,e=this.input.LA(1);if("'"==e)d=2;else if("\x00"<=e&&"&">=e||"("<=e&&"\uffff">=e)d=1;switch(d){case 1:this.matchAny();break;default:break a}}while(1);this.match("'");break;case 2:this.match('"');
a:do{d=3;e=this.input.LA(1);if("\\"==e)if(e=this.input.LA(2),'"'==e)d=this.input.LA(3),d="\x00"<=d&&"\uffff">=d?1:2;else{if("\x00"<=e&&"!">=e||"#"<=e&&"\uffff">=e)d=2}else if("\x00"<=e&&"!">=e||"#"<=e&&"[">=e||"]"<=e&&"\uffff">=e)d=2;switch(d){case 1:this.match('\\"');break;case 2:if("\x00"<=this.input.LA(1)&&"!">=this.input.LA(1)||"#"<=this.input.LA(1)&&"\uffff">=this.input.LA(1))this.input.consume();else throw a=new org.antlr.runtime.MismatchedSetException(null,this.input),this.recover(a),a;break;
default:break a}}while(1);this.match('"')}this.state.type=a;this.state.channel=c},mTokens:function(){var a=59,a=this.dfa30.predict(this.input);switch(a){case 1:this.mT__113();break;case 2:this.mT__114();break;case 3:this.mT__115();break;case 4:this.mT__116();break;case 5:this.mNEWLINE();break;case 6:this.mWHILESTATEMENT();break;case 7:this.mFORSTATEMENT();break;case 8:this.mFROMSTATEMENT();break;case 9:this.mINSTATEMENT();break;case 10:this.mTOSTATEMENT();break;case 11:this.mBYSTATEMENT();break;case 12:this.mLOOPSTATEMENT();
break;case 13:this.mIFSTATEMENT();break;case 14:this.mTHENSTATEMENT();break;case 15:this.mELSESTATEMENT();break;case 16:this.mFUNCTIONSTATEMENT();break;case 17:this.mENDBLOCK();break;case 18:this.mRETURNSTATEMENT();break;case 19:this.mNEWSTATEMENT();break;case 20:this.mTRYSTATEMENT();break;case 21:this.mCATCHSTATEMENT();break;case 22:this.mTHROWSTATEMENT();break;case 23:this.mOR();break;case 24:this.mXOR();break;case 25:this.mAND();break;case 26:this.mEQUALS();break;case 27:this.mNOTEQUALS();break;
case 28:this.mLT();break;case 29:this.mLTEQ();break;case 30:this.mGT();break;case 31:this.mGTEQ();break;case 32:this.mPLUS();break;case 33:this.mMINUS();break;case 34:this.mMULT();break;case 35:this.mDIV();break;case 36:this.mMOD();break;case 37:this.mPOW();break;case 38:this.mNOT();break;case 39:this.mLARR();break;case 40:this.mRARR();break;case 41:this.mLCURL();break;case 42:this.mRCURL();break;case 43:this.mINTEGER();break;case 44:this.mFLOAT();break;case 45:this.mTRUE();break;case 46:this.mFALSE();
break;case 47:this.mPER();break;case 48:this.mSQUARED();break;case 49:this.mCUBED();break;case 50:this.mIDENT();break;case 51:this.mPRIMITIVE();break;case 52:this.mLBRACKET();break;case 53:this.mRBRACKET();break;case 54:this.mCOMMENT();break;case 55:this.mLINE_COMMENT();break;case 56:this.mCOLON();break;case 57:this.mWS();break;case 58:this.mCOMMA();break;case 59:this.mSTRING()}}},!0);org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eotS:"\u0003\uffff\u00011\u00012\u0001\uffff\n&\u0001\uffff\u0002&\u0001\uffff\u0001&\u0001\uffff\u0001J\u0001L\u0003\uffff\u0001N\u0001\uffff\u0001&\u0005\uffff\u0001P\u0002&\u0001\uffff\u0001S\u000c\uffff\u0005&\u0001Z\u0001[\u0001\\\u0002&\u0001a\u0008&\u0001\u0010\u0002&\u0005\uffff\u0001&\u0001\uffff\u0002&\u0002\uffff\u0001&\u0001p\u0003&\u0003\uffff\u0002&\u0001v\u0001&\u0001\uffff\u0002&\u0001z\u0001&\u0001|\u0001J\u0002&\u0001\u007f\u0001\u0013\u0001\u001c\u0001\u0080\u0002&\u0001\uffff\u0001\u0083\u0002&\u0001\u0086\u0001&\u0001\uffff\u0001\u0088\u0001\u0089\u0001\u008a\u0001\uffff\u0001&\u0001\uffff\u0002&\u0002\uffff\u0001&\u0001\u008f\u0001\uffff\u0001&\u0001\u0091\u0001\uffff\u0001\u0092\u0003\uffff\u0001&\u0001\u0094\u0001\u0095\u0001&\u0001\uffff\u0001&\u0002\uffff\u0001\u0098\u0002\uffff\u0002&\u0001\uffff\u0001\u009b\u0001\u009c\u0002\uffff",
DFA30_eofS:"\u009d\uffff",DFA30_minS:"\u0001\t\u0002\uffff\u0001-\u00010\u0001\uffff\u0001H\u0001A\u0001F\u0001H\u0001Y\u0001O\u0001L\u0002E\u0001A\u0001\uffff\u0001R\u0001O\u0001\uffff\u0001N\u0001\uffff\u0002=\u0003\uffff\u0001*\u0001\uffff\u0001O\u0005\uffff\u0001.\u0001E\u0001Q\u0001\uffff\u0001\x00\u000c\uffff\u0001I\u0001R\u0001O\u0001N\u0001L\u00030\u0001E\u0001U\u00010\u0001O\u0001S\u0001D\u0001T\u0001W\u0002T\u0001B\u00010\u0001R\u0001D\u0005\uffff\u0001D\u0001\uffff\u0001R\u0001U\u0002\uffff\u0001L\u00010\u0001M\u0001C\u0001S\u0003\uffff\u0001N\u0001O\u00010\u0001E\u0001\uffff\u0001P\u0001E\u00010\u0001U\u00020\u0001C\u0001E\u00040\u0001A\u0001E\u0001\uffff\u00010\u0001T\u0001E\u00010\u0001W\u0001\uffff\u00030\u0001\uffff\u0001R\u0001\uffff\u0001H\u0001D\u0002\uffff\u0001R\u00010\u0001\uffff\u0001I\u00010\u0001\uffff\u00010\u0003\uffff\u0001N\u00020\u0001E\u0001\uffff\u0001O\u0002\uffff\u00010\u0002\uffff\u0001D\u0001N\u0001\uffff\u00020\u0002\uffff",
DFA30_maxS:"\u0001\u00bb\u0002\uffff\u0001>\u00019\u0001\uffff\u0001h\u0001u\u0001n\u0001r\u0001y\u0001o\u0001n\u0001e\u0001o\u0001u\u0001\uffff\u0001r\u0001o\u0001\uffff\u0001n\u0001\uffff\u0001=\u0001>\u0003\uffff\u0001/\u0001\uffff\u0001o\u0005\uffff\u00019\u0001e\u0001q\u0001\uffff\u0001\uffff\u000c\uffff\u0001i\u0001r\u0001o\u0001n\u0001l\u0003z\u0001r\u0001y\u0001z\u0001o\u0001s\u0001d\u0001t\u0001w\u0002t\u0001b\u0001z\u0001r\u0001d\u0005\uffff\u0001d\u0001\uffff\u0001r\u0001u\u0002\uffff\u0001l\u0001z\u0001m\u0001c\u0001s\u0003\uffff\u0001n\u0001o\u0001z\u0001e\u0001\uffff\u0001p\u0001e\u0001z\u0001u\u0002z\u0001c\u0001e\u0004z\u0001a\u0001e\u0001\uffff\u0001z\u0001t\u0001e\u0001z\u0001w\u0001\uffff\u0003z\u0001\uffff\u0001r\u0001\uffff\u0001h\u0001d\u0002\uffff\u0001r\u0001z\u0001\uffff\u0001i\u0001z\u0001\uffff\u0001z\u0003\uffff\u0001n\u0002z\u0001e\u0001\uffff\u0001o\u0002\uffff\u0001z\u0002\uffff\u0001d\u0001n\u0001\uffff\u0002z\u0002\uffff",
DFA30_acceptS:"\u0001\uffff\u0001\u0001\u0001\u0002\u0002\uffff\u0001\u0005\n\uffff\u0001\u0017\u0002\uffff\u0001\u0019\u0001\uffff\u0001\u001a\u0002\uffff\u0001 \u0001!\u0001\"\u0001\uffff\u0001$\u0001\uffff\u0001%\u0001'\u0001(\u0001)\u0001*\u0003\uffff\u00012\u0001\uffff\u00015\u00017\u00018\u00019\u0001:\u0001;\u0001\u0003\u0001\u001b\u0001\u001d\u0001\u001c\u0001\u0004\u0001,\u0016\uffff\u0001&\u0001\u001f\u0001\u001e\u00016\u0001#\u0001\uffff\u0001+\u0002\uffff\u00014\u00013\u0005\uffff\u0001\t\u0001\r\u0001\n\u0004\uffff\u0001\x0B\u000e\uffff\u0001\u0007\u0005\uffff\u0001\u0014\u0003\uffff\u0001\u0011\u0001\uffff\u0001\u0013\u0002\uffff\u0001\u0018\u0001/\u0002\uffff\u0001\u0008\u0002\uffff\u0001\u000e\u0001\uffff\u0001-\u0001\u000c\u0001\u000f\u0004\uffff\u0001\u0006\u0001\uffff\u0001.\u0001\u0016\u0001\uffff\u0001\u0015\u00011\u0002\uffff\u0001\u0012\u0002\uffff\u00010\u0001\u0010",
DFA30_specialS:"'\uffff\u0001\x00u\uffff}>",DFA30_transitionS:["\u0001+\u0001\u0005\u0001\uffff\u0001+\u0001\u0005\u0012\uffff\u0001+\u0001\u0016\u0001-\u0001)\u0001\uffff\u0001\u001c\u0001\u0013\u0001-\u0001\u0001\u0001\u0002\u0001\u001a\u0001\u0018\u0001,\u0001\u0019\u0001\u0004\u0001\u001b\n#\u0001*\u0001\uffff\u0001\u0003\u0001\u0015\u0001\u0017\u0002\uffff\u0001\u0014\u0001\n\u0001\u000f\u0001&\u0001\u000c\u0001\u0007\u0002&\u0001\u0008\u0002&\u0001\x0B\u0001\u001d\u0001\u000e\u0001\u0011\u0001$\u0001&\u0001\r\u0001%\u0001\t\u0002&\u0001\u0006\u0001\u0012\u0002&\u0001'\u0001\uffff\u0001(\u0001\u001e\u0002\uffff\u0001\u0014\u0001\n\u0001\u000f\u0001&\u0001\u000c\u0001\u0007\u0002&\u0001\u0008\u0002&\u0001\x0B\u0001\u001d\u0001\u000e\u0001\u0011\u0001$\u0001&\u0001\r\u0001%\u0001\t\u0002&\u0001\u0006\u0001\u0012\u0002&\u0001!\u0001\u0010\u0001\"-\uffff\u0001\u001f\u000f\uffff\u0001 ",
"","","\u0001.\u000e\uffff\u0001\u001f\u00010\u0001/","\n3","","\u00014\u001f\uffff\u00014","\u00018\r\uffff\u00015\u0002\uffff\u00016\u0002\uffff\u00017\x0B\uffff\u00018\r\uffff\u00015\u0002\uffff\u00016\u0002\uffff\u00017","\u0001:\u0007\uffff\u00019\u0017\uffff\u0001:\u0007\uffff\u00019","\u0001<\u0006\uffff\u0001;\u0002\uffff\u0001=\u0015\uffff\u0001<\u0006\uffff\u0001;\u0002\uffff\u0001=","\u0001>\u001f\uffff\u0001>","\u0001?\u001f\uffff\u0001?","\u0001@\u0001\uffff\u0001A\u001d\uffff\u0001@\u0001\uffff\u0001A",
"\u0001B\u001f\uffff\u0001B","\u0001C\t\uffff\u0001D\u0015\uffff\u0001C\t\uffff\u0001D","\u0001E\u0013\uffff\u0001F\x0B\uffff\u0001E\u0013\uffff\u0001F","","\u0001G\u001f\uffff\u0001G","\u0001H\u001f\uffff\u0001H","","\u0001I\u001f\uffff\u0001I","","\u0001/","\u0001K\u0001 ","","","","\u0001M\u0004\uffff\u0001)","","\u0001O\u001f\uffff\u0001O","","","","","","\u00013\u0001\uffff\n#","\u0001Q\u001f\uffff\u0001Q","\u0001R\u001f\uffff\u0001R","","\x00T","","","","","","","","","","","","","\u0001U\u001f\uffff\u0001U",
"\u0001V\u001f\uffff\u0001V","\u0001W\u001f\uffff\u0001W","\u0001X\u001f\uffff\u0001X","\u0001Y\u001f\uffff\u0001Y","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001]\u000c\uffff\u0001^\u0012\uffff\u0001]\u000c\uffff\u0001^","\u0001`\u0003\uffff\u0001_\u001b\uffff\u0001`\u0003\uffff\u0001_","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"\u0001b\u001f\uffff\u0001b","\u0001c\u001f\uffff\u0001c","\u0001d\u001f\uffff\u0001d","\u0001e\u001f\uffff\u0001e","\u0001f\u001f\uffff\u0001f","\u0001g\u001f\uffff\u0001g","\u0001h\u001f\uffff\u0001h","\u0001i\u001f\uffff\u0001i","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001j\u001f\uffff\u0001j","\u0001k\u001f\uffff\u0001k","","","","","","\u0001l\u001f\uffff\u0001l","","\u0001m\u001f\uffff\u0001m","\u0001n\u001f\uffff\u0001n","","","\u0001o\u001f\uffff\u0001o","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"\u0001q\u001f\uffff\u0001q","\u0001r\u001f\uffff\u0001r","\u0001s\u001f\uffff\u0001s","","","","\u0001t\u001f\uffff\u0001t","\u0001u\u001f\uffff\u0001u","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001w\u001f\uffff\u0001w","","\u0001x\u001f\uffff\u0001x","\u0001y\u001f\uffff\u0001y","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001{\u001f\uffff\u0001{","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"\u0001}\u001f\uffff\u0001}","\u0001~\u001f\uffff\u0001~","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0081\u001f\uffff\u0001\u0081","\u0001\u0082\u001f\uffff\u0001\u0082","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0084\u001f\uffff\u0001\u0084","\u0001\u0085\u001f\uffff\u0001\u0085",
"\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0087\u001f\uffff\u0001\u0087","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","\u0001\u008b\u001f\uffff\u0001\u008b","","\u0001\u008c\u001f\uffff\u0001\u008c","\u0001\u008d\u001f\uffff\u0001\u008d","","","\u0001\u008e\u001f\uffff\u0001\u008e","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&",
"","\u0001\u0090\u001f\uffff\u0001\u0090","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","","","\u0001\u0093\u001f\uffff\u0001\u0093","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\u0001\u0096\u001f\uffff\u0001\u0096","","\u0001\u0097\u001f\uffff\u0001\u0097","","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","","",
"\u0001\u0099\u001f\uffff\u0001\u0099","\u0001\u009a\u001f\uffff\u0001\u009a","","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","\n&\u0007\uffff\u001a&\u0004\uffff\u0001&\u0001\uffff\u001a&","",""]});org.antlr.lang.augmentObject(FormulaLexer,{DFA30_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eotS),DFA30_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_eofS),DFA30_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_minS),
DFA30_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaLexer.DFA30_maxS),DFA30_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_acceptS),DFA30_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_specialS),DFA30_transition:function(){var a=[],c,d=FormulaLexer.DFA30_transitionS.length;for(c=0;c<d;c++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaLexer.DFA30_transitionS[c]));return a}()});FormulaLexer.DFA30=function(a){this.recognizer=
a;this.decisionNumber=30;this.eot=FormulaLexer.DFA30_eot;this.eof=FormulaLexer.DFA30_eof;this.min=FormulaLexer.DFA30_min;this.max=FormulaLexer.DFA30_max;this.accept=FormulaLexer.DFA30_accept;this.special=FormulaLexer.DFA30_special;this.transition=FormulaLexer.DFA30_transition};org.antlr.lang.extend(FormulaLexer.DFA30,org.antlr.runtime.DFA,{getDescription:function(){return"1:1: Tokens : ( T__113 | T__114 | T__115 | T__116 | NEWLINE | WHILESTATEMENT | FORSTATEMENT | FROMSTATEMENT | INSTATEMENT | TOSTATEMENT | BYSTATEMENT | LOOPSTATEMENT | IFSTATEMENT | THENSTATEMENT | ELSESTATEMENT | FUNCTIONSTATEMENT | ENDBLOCK | RETURNSTATEMENT | NEWSTATEMENT | TRYSTATEMENT | CATCHSTATEMENT | THROWSTATEMENT | OR | XOR | AND | EQUALS | NOTEQUALS | LT | LTEQ | GT | GTEQ | PLUS | MINUS | MULT | DIV | MOD | POW | NOT | LARR | RARR | LCURL | RCURL | INTEGER | FLOAT | TRUE | FALSE | PER | SQUARED | CUBED | IDENT | PRIMITIVE | LBRACKET | RBRACKET | COMMENT | LINE_COMMENT | COLON | WS | COMMA | STRING );"},
specialStateTransition:function(a,c){var d=function(a,b){switch(a){case 0:var c=b.LA(1),a="\x00"<=c&&"\uffff">=c?84:83;if(0<=a)return a}}.call(this.recognizer,a,c);if(!org.antlr.lang.isUndefined(d))return d;d=new org.antlr.runtime.NoViableAltException(this.getDescription(),30,a,c);this.error(d);throw d;},dummy:null})})();var FormulaParser=function(a,b){b||(b=new org.antlr.runtime.RecognizerSharedState);FormulaParser.superclass.constructor.call(this,a,b);this.dfa5=new FormulaParser.DFA5(this);this.dfa57=new FormulaParser.DFA57(this);this.dfa58=new FormulaParser.DFA58(this);this.dfa65=new FormulaParser.DFA65(this);this.dfa72=new FormulaParser.DFA72(this);this.dfa85=new FormulaParser.DFA85(this);this.adaptor=new org.antlr.runtime.tree.CommonTreeAdaptor};
org.antlr.lang.augmentObject(FormulaParser,{EOF:-1,T__113:113,T__114:114,T__115:115,T__116:116,NEGATE:4,ASSIGN:5,FUNCALL:6,MATERIAL:7,UNIT:8,POWER:9,DEFAULTS:10,PARAMS:11,UNITCLUMP:12,ARRAY:13,LINES:14,WHILE:15,IFTHENELSE:16,ELSE:17,FOR:18,FORIN:19,FUNCTION:20,ANONFUNCTION:21,NUMBER:22,LABEL:23,RANGE:24,INNER:25,ASSIGNED:26,SELECTOR:27,DOTSELECTOR:28,NEW:29,TRYCATCH:30,THROW:31,NEWLINE:32,W:33,H:34,I:35,L:36,E:37,WHILESTATEMENT:38,F:39,O:40,R:41,FORSTATEMENT:42,M:43,FROMSTATEMENT:44,N:45,INSTATEMENT:46,
T:47,TOSTATEMENT:48,B:49,Y:50,BYSTATEMENT:51,P:52,LOOPSTATEMENT:53,IFSTATEMENT:54,THENSTATEMENT:55,S:56,ELSESTATEMENT:57,U:58,C:59,FUNCTIONSTATEMENT:60,D:61,ENDBLOCK:62,RETURNSTATEMENT:63,NEWSTATEMENT:64,TRYSTATEMENT:65,A:66,CATCHSTATEMENT:67,THROWSTATEMENT:68,IDENT:69,EQUALS:70,PRIMITIVE:71,OR:72,XOR:73,X:74,AND:75,NOTEQUALS:76,LT:77,LTEQ:78,GT:79,GTEQ:80,PLUS:81,MINUS:82,MULT:83,DIV:84,MOD:85,COLON:86,POW:87,NOT:88,LARR:89,RARR:90,LCURL:91,RCURL:92,COMMA:93,STRING:94,INTEGER:95,FLOAT:96,TRUE:97,
FALSE:98,PER:99,CUBED:100,SQUARED:101,Q:102,LBRACKET:103,RBRACKET:104,COMMENT:105,LINE_COMMENT:106,WS:107,G:108,J:109,K:110,V:111,Z:112});
(function(){org.antlr.lang.extend(FormulaParser,org.antlr.runtime.Parser,{setTreeAdaptor:function(a){this.adaptor=a},getTreeAdaptor:function(){return this.adaptor},getTokenNames:function(){return FormulaParser.tokenNames},getGrammarFileName:function(){return"/Library/WebServer/Documents/calc/Formula.g"}});org.antlr.lang.augmentObject(FormulaParser.prototype,{lines_return:function(){FormulaParser.lines_return=function(){};org.antlr.lang.extend(FormulaParser.lines_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),lines:function(){var a=new FormulaParser.lines_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EOF"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var m=2;32==this.input.LA(1)&&(m=1);switch(m){case 1:c=this.match(this.input,32,
FormulaParser.FOLLOW_NEWLINE_in_lines160);if(this.state.failed)return a;0===this.state.backtracking&&h.add(c);break;default:break a}}while(1);a:do{var c=2,n=this.input.LA(1);if(38==n||42==n||54==n||60==n||63<=n&&65>=n||68<=n&&69>=n||71==n||82==n||88<=n&&89>=n||91==n||94<=n&&98>=n||113==n)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_lines164);g=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(g.getTree());var c=2,o=this.input.LA(1);
if(32==o)c=1;else if(-1==o)c=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",3,0,this.input);}switch(c){case 1:c=0;b:do{m=2;32==this.input.LA(1)&&(m=1);switch(m){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_lines168);if(this.state.failed)return a;0===this.state.backtracking&&h.add(d);break;default:if(1<=c)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(2,
this.input);}c++}while(1);break;case 2:e=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines171);if(this.state.failed)return a;0===this.state.backtracking&&k.add(e)}break;default:break a}}while(1);f=this.match(this.input,-1,FormulaParser.FOLLOW_EOF_in_lines176);if(this.state.failed)return a;0===this.state.backtracking&&k.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),
q=this.adaptor.nil(),q=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),q);l.hasNext();)this.adaptor.addChild(q,l.nextTree());l.reset();this.adaptor.addChild(b,q);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(r){if(r instanceof org.antlr.runtime.RecognitionException)this.reportError(r),this.recover(this.input,r),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),
r);else throw r;}finally{}return a},expression_return:function(){FormulaParser.expression_return=function(){};org.antlr.lang.extend(FormulaParser.expression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),expression:function(){var a=new FormulaParser.expression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null;try{var o=10,o=this.dfa5.predict(this.input);switch(o){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_assignment_in_expression508);
c=this.assignment();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_expression514);d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_whileLoop_in_expression520);e=this.whileLoop();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forLoop_in_expression526);f=this.forLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_expression532);g=this.forInLoop();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,g.getTree());break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_ifThenElse_in_expression538);h=this.ifThenElse();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,h.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_functionDef_in_expression544);k=this.functionDef();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());
break;case 8:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_returnExp_in_expression550);l=this.returnExp();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());break;case 9:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_tryCatch_in_expression556);m=this.tryCatch();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,m.getTree());break;case 10:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_throwExp_in_expression562);
n=this.throwExp();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,n.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(q){if(q instanceof org.antlr.runtime.RecognitionException)this.reportError(q),this.recover(this.input,q),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),q);else throw q;}finally{}return a},returnExp_return:function(){FormulaParser.returnExp_return=
function(){};org.antlr.lang.extend(FormulaParser.returnExp_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),returnExp:function(){var a=new FormulaParser.returnExp_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();c=this.match(this.input,63,FormulaParser.FOLLOW_RETURNSTATEMENT_in_returnExp574);if(this.state.failed)return a;0===this.state.backtracking&&(e=this.adaptor.create(c),b=this.adaptor.becomeRoot(e,b));this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_returnExp577);
d=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(f){if(f instanceof org.antlr.runtime.RecognitionException)this.reportError(f),this.recover(this.input,f),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),f);else throw f;}finally{}return a},
innerBlock_return:function(){FormulaParser.innerBlock_return=function(){};org.antlr.lang.extend(FormulaParser.innerBlock_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerBlock:function(){var a=new FormulaParser.innerBlock_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression");try{a:do{var g=
2,h=this.input.LA(1);if(38==h||42==h||54==h||60==h||63<=h&&65>=h||68<=h&&69>=h||71==h||82==h||88<=h&&89>=h||91==h||94<=h&&98>=h||113==h)g=1;switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_expression_in_innerBlock590);d=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());g=0;b:do{var k=2;32==this.input.LA(1)&&(k=1);switch(k){case 1:c=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_innerBlock594);if(this.state.failed)return a;
0===this.state.backtracking&&e.add(c);break;default:if(1<=g)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(6,this.input);}g++}while(1);break;default:break a}}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(14,"LINES"),l);if(!f.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;
for(;f.hasNext();)this.adaptor.addChild(l,f.nextTree());f.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},whileLoop_return:function(){FormulaParser.whileLoop_return=
function(){};org.antlr.lang.extend(FormulaParser.whileLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),whileLoop:function(){var a=new FormulaParser.whileLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token WHILESTATEMENT"),o=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),q=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,38,FormulaParser.FOLLOW_WHILESTATEMENT_in_whileLoop619);if(this.state.failed)return a;0===this.state.backtracking&&n.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_whileLoop621);
g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&q.add(g.getTree());c=0;a:do{g=2;32==this.input.LA(1)&&(g=1);switch(g){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_whileLoop623);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(8,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_whileLoop626);
h=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&o.add(h.getTree());e=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_whileLoop629);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e);f=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_whileLoop631);if(this.state.failed)return a;0===this.state.backtracking&&m.add(f);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),r=this.adaptor.nil(),r=this.adaptor.becomeRoot(this.adaptor.create(15,"WHILE"),r);this.adaptor.addChild(r,q.nextTree());this.adaptor.addChild(r,o.nextTree());this.adaptor.addChild(b,r);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(u){if(u instanceof org.antlr.runtime.RecognitionException)this.reportError(u),this.recover(this.input,
u),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),u);else throw u;}finally{}return a},forLoop_return:function(){FormulaParser.forLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forLoop:function(){var a=new FormulaParser.forLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token FORSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),w=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FROMSTATEMENT"),v=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TOSTATEMENT"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token BYSTATEMENT"),C=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),A=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forLoop652);if(this.state.failed)return a;0===this.state.backtracking&&r.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_forLoop654);
if(this.state.failed)return a;0===this.state.backtracking&&u.add(d);e=this.match(this.input,44,FormulaParser.FOLLOW_FROMSTATEMENT_in_forLoop656);if(this.state.failed)return a;0===this.state.backtracking&&w.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop658);m=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(m.getTree());f=this.match(this.input,48,FormulaParser.FOLLOW_TOSTATEMENT_in_forLoop660);if(this.state.failed)return a;
0===this.state.backtracking&&x.add(f);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop662);n=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(n.getTree());c=2;51==this.input.LA(1)&&(c=1);switch(c){case 1:g=this.match(this.input,51,FormulaParser.FOLLOW_BYSTATEMENT_in_forLoop665);if(this.state.failed)return a;0===this.state.backtracking&&H.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forLoop667);o=this.logicalExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(o.getTree())}g=0;a:do{o=2;32==this.input.LA(1)&&(o=1);switch(o){case 1:h=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_forLoop671);if(this.state.failed)return a;0===this.state.backtracking&&v.add(h);break;default:if(1<=g)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(10,this.input);}g++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forLoop674);
q=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&C.add(q.getTree());k=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_forLoop677);if(this.state.failed)return a;0===this.state.backtracking&&z.add(k);l=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forLoop679);if(this.state.failed)return a;0===this.state.backtracking&&D.add(l);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),y=this.adaptor.nil(),y=this.adaptor.becomeRoot(this.adaptor.create(18,"FOR"),y);this.adaptor.addChild(y,u.nextNode());for(var F=this.adaptor.nil(),F=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),F);A.hasNext();)this.adaptor.addChild(F,A.nextTree());A.reset();this.adaptor.addChild(y,F);this.adaptor.addChild(y,C.nextTree());this.adaptor.addChild(b,y);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(B){if(B instanceof org.antlr.runtime.RecognitionException)this.reportError(B),this.recover(this.input,B),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),B);else throw B;}finally{}return a},forInLoop_return:function(){FormulaParser.forInLoop_return=function(){};org.antlr.lang.extend(FormulaParser.forInLoop_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),forInLoop:function(){var a=
new FormulaParser.forInLoop_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FORSTATEMENT"),n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LOOPSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INSTATEMENT"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),v=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,42,FormulaParser.FOLLOW_FORSTATEMENT_in_forInLoop707);if(this.state.failed)return a;0===this.state.backtracking&&m.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_forInLoop709);
if(this.state.failed)return a;0===this.state.backtracking&&n.add(d);e=this.match(this.input,46,FormulaParser.FOLLOW_INSTATEMENT_in_forInLoop711);if(this.state.failed)return a;0===this.state.backtracking&&u.add(e);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_forInLoop713);k=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&v.add(k.getTree());c=0;a:do{d=2;32==this.input.LA(1)&&(d=1);switch(d){case 1:f=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_forInLoop715);
if(this.state.failed)return a;0===this.state.backtracking&&o.add(f);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(11,this.input);}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_forInLoop718);l=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&w.add(l.getTree());g=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_forInLoop721);if(this.state.failed)return a;
0===this.state.backtracking&&q.add(g);h=this.match(this.input,53,FormulaParser.FOLLOW_LOOPSTATEMENT_in_forInLoop723);if(this.state.failed)return a;0===this.state.backtracking&&r.add(h);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),x=this.adaptor.nil(),x=this.adaptor.becomeRoot(this.adaptor.create(19,"FORIN"),x);this.adaptor.addChild(x,n.nextNode());this.adaptor.addChild(x,v.nextTree());
this.adaptor.addChild(x,w.nextTree());this.adaptor.addChild(b,x);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(z){if(z instanceof org.antlr.runtime.RecognitionException)this.reportError(z),this.recover(this.input,z),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),z);else throw z;}finally{}return a},ifThenElse_return:function(){FormulaParser.ifThenElse_return=
function(){};org.antlr.lang.extend(FormulaParser.ifThenElse_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),ifThenElse:function(){var a=new FormulaParser.ifThenElse_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IFSTATEMENT"),z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token NEWLINE"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ELSESTATEMENT"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THENSTATEMENT"),A=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),y=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse748);
if(this.state.failed)return a;0===this.state.backtracking&&x.add(c);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse750);q=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(q.getTree());d=this.match(this.input,55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse752);if(this.state.failed)return a;0===this.state.backtracking&&C.add(d);c=0;a:do{d=2;32==this.input.LA(1)&&(d=1);switch(d){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse755);
if(this.state.failed)return a;0===this.state.backtracking&&z.add(e);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;var F=new org.antlr.runtime.EarlyExitException(12,this.input);throw F;}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse758);r=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(r.getTree());a:do switch(e=2,57==this.input.LA(1)&&54==this.input.LA(2)&&(e=1),e){case 1:f=
this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse762);if(this.state.failed)return a;0===this.state.backtracking&&H.add(f);g=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse764);if(this.state.failed)return a;0===this.state.backtracking&&x.add(g);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_ifThenElse766);u=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&y.add(u.getTree());h=this.match(this.input,
55,FormulaParser.FOLLOW_THENSTATEMENT_in_ifThenElse768);if(this.state.failed)return a;0===this.state.backtracking&&C.add(h);e=0;b:do{r=2;32==this.input.LA(1)&&(r=1);switch(r){case 1:k=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse770);if(this.state.failed)return a;0===this.state.backtracking&&z.add(k);break;default:if(1<=e)break b;if(0<this.state.backtracking)return this.state.failed=!0,a;F=new org.antlr.runtime.EarlyExitException(13,this.input);throw F;}e++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse773);
w=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(w.getTree());break;default:break a}while(1);f=2;57==this.input.LA(1)&&(f=1);switch(f){case 1:l=this.match(this.input,57,FormulaParser.FOLLOW_ELSESTATEMENT_in_ifThenElse778);if(this.state.failed)return a;0===this.state.backtracking&&H.add(l);l=0;a:do{H=2;32==this.input.LA(1)&&(H=1);switch(H){case 1:m=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_ifThenElse780);if(this.state.failed)return a;
0===this.state.backtracking&&z.add(m);break;default:if(1<=l)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;F=new org.antlr.runtime.EarlyExitException(15,this.input);throw F;}l++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_ifThenElse783);v=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&A.add(v.getTree())}n=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_ifThenElse787);if(this.state.failed)return a;0===this.state.backtracking&&
D.add(n);o=this.match(this.input,54,FormulaParser.FOLLOW_IFSTATEMENT_in_ifThenElse789);if(this.state.failed)return a;0===this.state.backtracking&&x.add(o);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),B=this.adaptor.nil(),B=this.adaptor.becomeRoot(this.adaptor.create(16,"IFTHENELSE"),B),I=this.adaptor.nil(),I=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),I);if(!y.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;
for(;y.hasNext();)this.adaptor.addChild(I,y.nextTree());y.reset();this.adaptor.addChild(B,I);I=this.adaptor.nil();I=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),I);if(!A.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;A.hasNext();)this.adaptor.addChild(I,A.nextTree());A.reset();this.adaptor.addChild(B,I);this.adaptor.addChild(b,B);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,
a.start,a.stop))}catch(E){if(E instanceof org.antlr.runtime.RecognitionException)this.reportError(E),this.recover(this.input,E),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),E);else throw E;}finally{}return a},functionDef_return:function(){FormulaParser.functionDef_return=function(){};org.antlr.lang.extend(FormulaParser.functionDef_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),functionDef:function(){var a=new FormulaParser.functionDef_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=null,z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 113"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),I=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),E=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef820);
if(this.state.failed)return a;0===this.state.backtracking&&z.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef822);if(this.state.failed)return a;0===this.state.backtracking&&H.add(d);e=this.match(this.input,113,FormulaParser.FOLLOW_113_in_functionDef824);if(this.state.failed)return a;0===this.state.backtracking&&A.add(e);c=2;69==this.input.LA(1)&&(c=1);switch(c){case 1:f=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef827);if(this.state.failed)return a;
0===this.state.backtracking&&H.add(f);var f=2,M=this.input.LA(1);if(70==M)f=1;else if(93==M||114==M)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",18,0,this.input);}switch(f){case 1:g=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_functionDef831);if(this.state.failed)return a;0===this.state.backtracking&&C.add(g);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef834);w=this.defaultValue();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&E.add(w.getTree());break;case 2:a:do{g=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var L=this.input.LA(3);if(93==L||114==L)g=1}switch(g){case 1:h=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_functionDef839);if(this.state.failed)return a;0===this.state.backtracking&&F.add(h);k=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef841);if(this.state.failed)return a;0===this.state.backtracking&&H.add(k);break;default:break a}}while(1);
break}a:do switch(h=2,93==this.input.LA(1)&&(h=1),h){case 1:l=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_functionDef848);if(this.state.failed)return a;0===this.state.backtracking&&F.add(l);m=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_functionDef850);if(this.state.failed)return a;0===this.state.backtracking&&H.add(m);n=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_functionDef852);if(this.state.failed)return a;0===this.state.backtracking&&C.add(n);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_functionDef854);
v=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(v.getTree());break;default:break a}while(1)}o=this.match(this.input,114,FormulaParser.FOLLOW_114_in_functionDef861);if(this.state.failed)return a;0===this.state.backtracking&&D.add(o);l=0;a:do{m=2;32==this.input.LA(1)&&(m=1);switch(m){case 1:q=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_functionDef863);if(this.state.failed)return a;0===this.state.backtracking&&y.add(q);break;default:if(1<=
l)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(21,this.input);}l++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_functionDef866);x=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&I.add(x.getTree());r=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_functionDef869);if(this.state.failed)return a;0===this.state.backtracking&&B.add(r);u=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_functionDef871);
if(this.state.failed)return a;0===this.state.backtracking&&z.add(u);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),K=this.adaptor.nil(),K=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),K),O=this.adaptor.nil(),O=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),O);H.hasNext();)this.adaptor.addChild(O,H.nextNode());H.reset();this.adaptor.addChild(K,O);O=this.adaptor.nil();
for(O=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),O);E.hasNext();)this.adaptor.addChild(O,E.nextTree());E.reset();this.adaptor.addChild(K,O);this.adaptor.addChild(K,I.nextTree());this.adaptor.addChild(b,K);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(Q){if(Q instanceof org.antlr.runtime.RecognitionException)this.reportError(Q),this.recover(this.input,Q),a.tree=
this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),Q);else throw Q;}finally{}return a},tryCatch_return:function(){FormulaParser.tryCatch_return=function(){};org.antlr.lang.extend(FormulaParser.tryCatch_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),tryCatch:function(){var a=new FormulaParser.tryCatch_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token TRYSTATEMENT"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),r=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CATCHSTATEMENT"),u=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),w=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock");try{c=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch904);
if(this.state.failed)return a;0===this.state.backtracking&&o.add(c);c=0;a:do{var v=2;32==this.input.LA(1)&&(v=1);switch(v){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_tryCatch906);if(this.state.failed)return a;0===this.state.backtracking&&q.add(d);break;default:if(1<=c)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;var x=new org.antlr.runtime.EarlyExitException(22,this.input);throw x;}c++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch909);
l=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&w.add(l.getTree());e=this.match(this.input,67,FormulaParser.FOLLOW_CATCHSTATEMENT_in_tryCatch911);if(this.state.failed)return a;0===this.state.backtracking&&r.add(e);f=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_tryCatch913);if(this.state.failed)return a;0===this.state.backtracking&&n.add(f);d=0;a:do{e=2;32==this.input.LA(1)&&(e=1);switch(e){case 1:g=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_tryCatch915);
if(this.state.failed)return a;0===this.state.backtracking&&q.add(g);break;default:if(1<=d)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;x=new org.antlr.runtime.EarlyExitException(23,this.input);throw x;}d++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_tryCatch919);m=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&w.add(m.getTree());h=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_tryCatch921);if(this.state.failed)return a;
0===this.state.backtracking&&u.add(h);k=this.match(this.input,65,FormulaParser.FOLLOW_TRYSTATEMENT_in_tryCatch923);if(this.state.failed)return a;0===this.state.backtracking&&o.add(k);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),z=this.adaptor.nil(),z=this.adaptor.becomeRoot(this.adaptor.create(30,"TRYCATCH"),z);w.hasNext();)this.adaptor.addChild(z,w.nextTree());w.reset();this.adaptor.addChild(z,
n.nextNode());this.adaptor.addChild(b,z);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(D){if(D instanceof org.antlr.runtime.RecognitionException)this.reportError(D),this.recover(this.input,D),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),D);else throw D;}finally{}return a},throwExp_return:function(){FormulaParser.throwExp_return=function(){};org.antlr.lang.extend(FormulaParser.throwExp_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),throwExp:function(){var a=new FormulaParser.throwExp_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token THROWSTATEMENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule primaryExpression");try{c=this.match(this.input,68,FormulaParser.FOLLOW_THROWSTATEMENT_in_throwExp945);if(this.state.failed)return a;0===this.state.backtracking&&
e.add(c);this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_throwExp947);d=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),g=this.adaptor.nil(),g=this.adaptor.becomeRoot(this.adaptor.create(31,"THROW"),g);this.adaptor.addChild(g,f.nextTree());this.adaptor.addChild(b,
g);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(h){if(h instanceof org.antlr.runtime.RecognitionException)this.reportError(h),this.recover(this.input,h),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),h);else throw h;}finally{}return a},anonFunctionDef_return:function(){FormulaParser.anonFunctionDef_return=function(){};org.antlr.lang.extend(FormulaParser.anonFunctionDef_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),anonFunctionDef:function(){var a=new FormulaParser.anonFunctionDef_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=null,z=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token FUNCTIONSTATEMENT"),D=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),H=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token ENDBLOCK"),I=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule expression"),
E=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule innerBlock"),M=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue");try{c=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967);if(this.state.failed)return a;0===this.state.backtracking&&z.add(c);d=this.match(this.input,113,FormulaParser.FOLLOW_113_in_anonFunctionDef970);if(this.state.failed)return a;0===this.state.backtracking&&A.add(d);c=2;69==this.input.LA(1)&&
(c=1);switch(c){case 1:e=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef973);if(this.state.failed)return a;0===this.state.backtracking&&H.add(e);var e=2,L=this.input.LA(1);if(70==L)e=1;else if(93==L||114==L)e=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;var K=new org.antlr.runtime.NoViableAltException("",25,0,this.input);throw K;}switch(e){case 1:f=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef977);if(this.state.failed)return a;
0===this.state.backtracking&&C.add(f);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef980);u=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&M.add(u.getTree());break;case 2:a:do{f=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var O=this.input.LA(3);if(93==O||114==O)f=1}switch(f){case 1:g=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef985);if(this.state.failed)return a;0===this.state.backtracking&&F.add(g);
h=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef987);if(this.state.failed)return a;0===this.state.backtracking&&H.add(h);break;default:break a}}while(1);break}a:do switch(g=2,93==this.input.LA(1)&&(g=1),g){case 1:k=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_anonFunctionDef994);if(this.state.failed)return a;0===this.state.backtracking&&F.add(k);l=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_anonFunctionDef996);if(this.state.failed)return a;0===this.state.backtracking&&
H.add(l);m=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_anonFunctionDef998);if(this.state.failed)return a;0===this.state.backtracking&&C.add(m);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_anonFunctionDef1000);w=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&M.add(w.getTree());break;default:break a}while(1)}n=this.match(this.input,114,FormulaParser.FOLLOW_114_in_anonFunctionDef1007);if(this.state.failed)return a;0===this.state.backtracking&&
D.add(n);var k=2,Q=this.input.LA(1);if(32==Q)k=1;else if(38==Q||42==Q||54==Q||60==Q||63<=Q&&65>=Q||68<=Q&&69>=Q||71==Q||82==Q||88<=Q&&89>=Q||91==Q||94<=Q&&98>=Q||113==Q)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;K=new org.antlr.runtime.NoViableAltException("",29,0,this.input);throw K;}switch(k){case 1:x=0;a:do{K=2;32==this.input.LA(1)&&(K=1);switch(K){case 1:o=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_anonFunctionDef1012);if(this.state.failed)return a;0===this.state.backtracking&&
y.add(o);break;default:if(1<=x)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(28,this.input);}x++}while(1);this.pushFollow(FormulaParser.FOLLOW_innerBlock_in_anonFunctionDef1015);v=this.innerBlock();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(v.getTree());q=this.match(this.input,62,FormulaParser.FOLLOW_ENDBLOCK_in_anonFunctionDef1018);if(this.state.failed)return a;0===this.state.backtracking&&
B.add(q);r=this.match(this.input,60,FormulaParser.FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020);if(this.state.failed)return a;0===this.state.backtracking&&z.add(r);break;case 2:this.pushFollow(FormulaParser.FOLLOW_expression_in_anonFunctionDef1025);x=this.expression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&I.add(x.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:
null);for(var b=this.adaptor.nil(),T=this.adaptor.nil(),T=this.adaptor.becomeRoot(this.adaptor.create(21,"ANONFUNCTION"),T),R=this.adaptor.nil(),R=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),R);H.hasNext();)this.adaptor.addChild(R,H.nextNode());H.reset();this.adaptor.addChild(T,R);R=this.adaptor.nil();for(R=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),R);M.hasNext();)this.adaptor.addChild(R,M.nextTree());M.reset();this.adaptor.addChild(T,R);E.hasNext()&&this.adaptor.addChild(T,
E.nextTree());E.reset();I.hasNext()&&this.adaptor.addChild(T,I.nextTree());I.reset();this.adaptor.addChild(b,T);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(G){if(G instanceof org.antlr.runtime.RecognitionException)this.reportError(G),this.recover(this.input,G),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),G);else throw G;}finally{}return a},assignment_return:function(){FormulaParser.assignment_return=
function(){};org.antlr.lang.extend(FormulaParser.assignment_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assignment:function(){var a=new FormulaParser.assignment_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=null,z=null,D=null,H=null,C=null,A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token IDENT"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 115"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token EQUALS"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),E=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),M=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token PRIMITIVE"),L=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule assigned"),K=
new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule defaultValue"),O=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var Q=2,T=this.input.LA(1);if(69==T){var R=this.input.LA(2);if(113==R)Q=1;else if(89==R||91==R||93==R||115<=R&&116>=R)Q=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;var G=new org.antlr.runtime.NoViableAltException("",37,1,this.input);throw G;}}else if(71==T)Q=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;G=new org.antlr.runtime.NoViableAltException("",37,0,this.input);throw G;}switch(Q){case 1:c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1067);if(this.state.failed)return a;0===this.state.backtracking&&y.add(c);d=this.match(this.input,113,FormulaParser.FOLLOW_113_in_assignment1069);if(this.state.failed)return a;0===this.state.backtracking&&I.add(d);r=2;69==this.input.LA(1)&&(r=1);switch(r){case 1:e=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1072);if(this.state.failed)return a;
0===this.state.backtracking&&y.add(e);var r=2,ba=this.input.LA(1);if(70==ba)r=1;else if(93==ba||114==ba)r=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;G=new org.antlr.runtime.NoViableAltException("",31,0,this.input);throw G;}switch(r){case 1:f=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_assignment1076);if(this.state.failed)return a;0===this.state.backtracking&&B.add(f);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1078);v=this.defaultValue();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&K.add(v.getTree());break;case 2:a:do{G=2;if(93==this.input.LA(1)&&69==this.input.LA(2)){var Z=this.input.LA(3);if(93==Z||114==Z)G=1}switch(G){case 1:g=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1083);if(this.state.failed)return a;0===this.state.backtracking&&E.add(g);h=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1085);if(this.state.failed)return a;0===this.state.backtracking&&y.add(h);break;default:break a}}while(1);
break}a:do switch(G=2,93==this.input.LA(1)&&(G=1),G){case 1:k=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1092);if(this.state.failed)return a;0===this.state.backtracking&&E.add(k);l=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assignment1094);if(this.state.failed)return a;0===this.state.backtracking&&y.add(l);m=this.match(this.input,70,FormulaParser.FOLLOW_EQUALS_in_assignment1096);if(this.state.failed)return a;0===this.state.backtracking&&B.add(m);this.pushFollow(FormulaParser.FOLLOW_defaultValue_in_assignment1098);
x=this.defaultValue();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&K.add(x.getTree());break;default:break a}while(1)}n=this.match(this.input,114,FormulaParser.FOLLOW_114_in_assignment1105);if(this.state.failed)return a;0===this.state.backtracking&&A.add(n);o=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1107);if(this.state.failed)return a;0===this.state.backtracking&&F.add(o);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1109);
z=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&O.add(z.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),P=this.adaptor.nil(),P=this.adaptor.becomeRoot(this.adaptor.create(20,"FUNCTION"),P),U=this.adaptor.nil(),U=this.adaptor.becomeRoot(this.adaptor.create(11,"PARAMS"),U);y.hasNext();)this.adaptor.addChild(U,y.nextNode());
y.reset();this.adaptor.addChild(P,U);U=this.adaptor.nil();for(U=this.adaptor.becomeRoot(this.adaptor.create(10,"DEFAULTS"),U);K.hasNext();)this.adaptor.addChild(U,K.nextTree());K.reset();this.adaptor.addChild(P,U);this.adaptor.addChild(P,O.nextTree());this.adaptor.addChild(b,P);a.tree=b}break;case 2:var k=2,J=this.input.LA(1);if(71==J)k=1;else if(69==J)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;G=new org.antlr.runtime.NoViableAltException("",34,0,this.input);throw G;}switch(k){case 1:q=
this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1137);if(this.state.failed)return a;0===this.state.backtracking&&M.add(q);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1141);D=this.assigned();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&L.add(D.getTree());break}a:do switch(k=2,93==this.input.LA(1)&&(k=1),k){case 1:r=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_assignment1145);if(this.state.failed)return a;0===
this.state.backtracking&&E.add(r);var k=2,S=this.input.LA(1);if(71==S)k=1;else if(69==S)k=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;G=new org.antlr.runtime.NoViableAltException("",35,0,this.input);throw G;}switch(k){case 1:u=this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_assignment1148);if(this.state.failed)return a;0===this.state.backtracking&&M.add(u);break;case 2:this.pushFollow(FormulaParser.FOLLOW_assigned_in_assignment1152);H=this.assigned();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&L.add(H.getTree())}break;default:break a}while(1);w=this.match(this.input,115,FormulaParser.FOLLOW_115_in_assignment1158);if(this.state.failed)return a;0===this.state.backtracking&&F.add(w);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_assignment1160);C=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&O.add(C.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);b=this.adaptor.nil();P=this.adaptor.nil();for(P=this.adaptor.becomeRoot(this.adaptor.create(5,"ASSIGN"),P);M.hasNext();)this.adaptor.addChild(P,M.nextNode());for(M.reset();L.hasNext();)this.adaptor.addChild(P,L.nextTree());L.reset();this.adaptor.addChild(P,O.nextTree());this.adaptor.addChild(b,P);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(ra){if(ra instanceof
org.antlr.runtime.RecognitionException)this.reportError(ra),this.recover(this.input,ra),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),ra);else throw ra;}finally{}return a},assigned_return:function(){FormulaParser.assigned_return=function(){};org.antlr.lang.extend(FormulaParser.assigned_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),assigned:function(){var a=new FormulaParser.assigned_return;a.start=this.input.LT(1);var b=null,c=null,
d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selector");try{c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_assigned1186);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);var c=2,g=this.input.LA(1);if(89==g||91==g||116==g)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_assigned1188);d=this.selector();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&f.add(d.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),h=this.adaptor.nil(),h=this.adaptor.becomeRoot(this.adaptor.create(26,"ASSIGNED"),h);this.adaptor.addChild(h,e.nextNode());f.hasNext()&&this.adaptor.addChild(h,f.nextTree());f.reset();this.adaptor.addChild(b,h);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},logicalExpression_return:function(){FormulaParser.logicalExpression_return=function(){};org.antlr.lang.extend(FormulaParser.logicalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
logicalExpression:function(){var a=new FormulaParser.logicalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1214);d=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,72==this.input.LA(1)&&(this.input.LA(2),this.synpred47_Formula()&&(d=1)),d){case 1:c=this.match(this.input,
72,FormulaParser.FOLLOW_OR_in_logicalExpression1217);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_logicalExpression1220);e=this.booleanXORExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},booleanXORExpression_return:function(){FormulaParser.booleanXORExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanXORExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
booleanXORExpression:function(){var a=new FormulaParser.booleanXORExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1250);d=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,73==this.input.LA(1)&&(this.input.LA(2),this.synpred48_Formula()&&(d=1)),d){case 1:c=
this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_booleanXORExpression1253);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_booleanXORExpression1256);e=this.booleanAndExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},booleanAndExpression_return:function(){FormulaParser.booleanAndExpression_return=function(){};org.antlr.lang.extend(FormulaParser.booleanAndExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),booleanAndExpression:function(){var a=new FormulaParser.booleanAndExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1285);d=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do switch(d=2,75==this.input.LA(1)&&(this.input.LA(2),this.synpred49_Formula()&&
(d=1)),d){case 1:c=this.match(this.input,75,FormulaParser.FOLLOW_AND_in_booleanAndExpression1288);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_booleanAndExpression1291);e=this.equalityExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===
this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},equalityExpression_return:function(){FormulaParser.equalityExpression_return=function(){};org.antlr.lang.extend(FormulaParser.equalityExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),equalityExpression:function(){var a=new FormulaParser.equalityExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1322);d=this.relationalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);if(70==f||76==f)this.input.LA(2),this.synpred51_Formula()&&
(d=1);switch(d){case 1:c=this.input.LT(1);if(70==this.input.LA(1)||76==this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_equalityExpression1332);e=this.relationalExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},relationalExpression_return:function(){FormulaParser.relationalExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.relationalExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),relationalExpression:function(){var a=new FormulaParser.relationalExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1374);d=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);77<=f&&80>=f&&(this.input.LA(2),this.synpred55_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(77<=this.input.LA(1)&&80>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);
}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_relationalExpression1389);e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,
g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},additiveExpression_return:function(){FormulaParser.additiveExpression_return=function(){};org.antlr.lang.extend(FormulaParser.additiveExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),additiveExpression:function(){var a=new FormulaParser.additiveExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1432);d=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);81<=f&&82>=f&&(this.input.LA(2),this.synpred57_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(81<=this.input.LA(1)&&82>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),
b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_additiveExpression1443);e=this.multiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},multiplicativeExpression_return:function(){FormulaParser.multiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.multiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,
{getTree:function(){return this.tree}})}(),multiplicativeExpression:function(){var a=new FormulaParser.multiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1473);d=this.arrayExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);83<=f&&85>=f&&(this.input.LA(2),
this.synpred60_Formula()&&(d=1));switch(d){case 1:c=this.input.LT(1);if(83<=this.input.LA(1)&&85>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_multiplicativeExpression1486);e=this.arrayExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},
arrayExpression_return:function(){FormulaParser.arrayExpression_return=function(){};org.antlr.lang.extend(FormulaParser.arrayExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayExpression:function(){var a=new FormulaParser.arrayExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"rule negationExpression");try{this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1532);e=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(e.getTree());e=2;86==this.input.LA(1)&&(this.input.LA(2),this.synpred61_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(e=1));switch(e){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,
"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}c=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_arrayExpression1538);if(this.state.failed)return a;0===this.state.backtracking&&h.add(c);if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1542);
f=this.negationExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(f.getTree())}c=2;86==this.input.LA(1)&&(this.input.LA(2),this.synpred62_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1));switch(c){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');
}d=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_arrayExpression1551);if(this.state.failed)return a;0===this.state.backtracking&&h.add(d);if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"arrayExpression",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_arrayExpression1555);g=this.negationExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(g.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(24,"RANGE"),l);k.hasNext();)this.adaptor.addChild(l,k.nextTree());k.reset();this.adaptor.addChild(b,l);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=
this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},negationExpression_return:function(){FormulaParser.negationExpression_return=function(){};org.antlr.lang.extend(FormulaParser.negationExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
negationExpression:function(){var a=new FormulaParser.negationExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule powerExpression");try{var h=2,k=this.input.LA(1);if(82==k)h=1;else if(60==k||64==k||69==k||71==k||88<=k&&89>=k||91==k||94<=k&&98>=k||113==k)h=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
48,0,this.input);}switch(h){case 1:c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_negationExpression1580);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1582);d=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",
null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),l);this.adaptor.addChild(l,g.nextTree());this.adaptor.addChild(b,l);a.tree=b}break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_powerExpression_in_negationExpression1596);e=this.powerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},powerExpression_return:function(){FormulaParser.powerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.powerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
powerExpression:function(){var a=new FormulaParser.powerExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token POW"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryOrNegate"),h=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_powerExpression1607);d=this.unaryExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&h.add(d.getTree());a:do switch(d=2,87==this.input.LA(1)&&(this.input.LA(2),this.synpred64_Formula()&&(d=1)),d){case 1:c=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_powerExpression1610);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_powerExpression1612);e=this.unaryOrNegate();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(e.getTree());
break;default:break a}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(9,"POWER"),k);for(this.adaptor.addChild(k,h.nextTree());g.hasNext();)this.adaptor.addChild(k,g.nextTree());g.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},unaryOrNegate_return:function(){FormulaParser.unaryOrNegate_return=function(){};org.antlr.lang.extend(FormulaParser.unaryOrNegate_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unaryOrNegate:function(){var a=
new FormulaParser.unaryOrNegate_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token MINUS"),g=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unaryExpression");try{var h=2,k=this.input.LA(1);if(60==k||64==k||69==k||71==k||88<=k&&89>=k||91==k||94<=k&&98>=k||113==k)h=1;else if(82==k)h=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
50,0,this.input);}switch(h){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1639);d=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_unaryOrNegate1645);if(this.state.failed)return a;0===this.state.backtracking&&f.add(c);this.pushFollow(FormulaParser.FOLLOW_unaryExpression_in_unaryOrNegate1647);
e=this.unaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&g.add(e.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),l=this.adaptor.nil(),l=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),l);this.adaptor.addChild(l,g.nextTree());this.adaptor.addChild(b,l);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=
this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(m){if(m instanceof org.antlr.runtime.RecognitionException)this.reportError(m),this.recover(this.input,m),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),m);else throw m;}finally{}return a},unaryExpression_return:function(){FormulaParser.unaryExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
unaryExpression:function(){var a=new FormulaParser.unaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{var g=2,h=this.input.LA(1);if(88==h)g=1;else if(60==h||64==h||69==h||71==h||89==h||91==h||94<=h&&98>=h||113==h)g=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",51,0,this.input);}switch(g){case 1:b=this.adaptor.nil();c=this.match(this.input,88,FormulaParser.FOLLOW_NOT_in_unaryExpression1675);
if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1678);d=this.innerPrimaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_innerPrimaryExpression_in_unaryExpression1687);e=this.innerPrimaryExpression();this.state._fsp--;
if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},innerPrimaryExpression_return:function(){FormulaParser.innerPrimaryExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.innerPrimaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),innerPrimaryExpression:function(){var a=new FormulaParser.innerPrimaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule selectionExpression");try{this.pushFollow(FormulaParser.FOLLOW_selectionExpression_in_innerPrimaryExpression1718);c=this.selectionExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&d.add(c.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),e=this.adaptor.nil(),e=this.adaptor.becomeRoot(this.adaptor.create(25,"INNER"),e);this.adaptor.addChild(e,d.nextTree());this.adaptor.addChild(b,e);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(f){if(f instanceof org.antlr.runtime.RecognitionException)this.reportError(f),this.recover(this.input,f),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),f);else throw f;}finally{}return a},selectionExpression_return:function(){FormulaParser.selectionExpression_return=function(){};org.antlr.lang.extend(FormulaParser.selectionExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
selectionExpression:function(){var a=new FormulaParser.selectionExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primaryExpression_in_selectionExpression1738);c=this.primaryExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());a:do{c=2;switch(this.input.LA(1)){case 89:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-
1).getText()&&(c=1);break;case 91:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1);break;case 116:this.input.LA(2);this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1);break;case 113:this.input.LA(2),this.synpred68_Formula()&&" "!=this.input.get(this.input.index()-1).getText()&&(c=1)}switch(c){case 1:if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;
throw new org.antlr.runtime.FailedPredicateException(this.input,"selectionExpression",' this.input.get(this.input.index()-1).getText()!=" "');}var c=2,f=this.input.LA(1);if(89==f||91==f||116==f)c=1;else if(113==f)c=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",52,0,this.input);}switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_selectionExpression1744);d=this.selector();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_selectionExpression1746);e=this.funCall();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree())}break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),
this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},funCall_return:function(){FormulaParser.funCall_return=function(){};org.antlr.lang.extend(FormulaParser.funCall_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),funCall:function(){var a=new FormulaParser.funCall_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token 114"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{c=this.match(this.input,113,FormulaParser.FOLLOW_113_in_funCall1761);if(this.state.failed)return a;0===this.state.backtracking&&k.add(c);var c=2,n=this.input.LA(1);if(60==n||64==n||69==n||71==n||82==n||88<=n&&89>=n||91==n||94<=n&&98>=
n||113==n)c=1;switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1765);f=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(f.getTree());a:do switch(f=2,93==this.input.LA(1)&&(f=1),f){case 1:d=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_funCall1768);if(this.state.failed)return a;0===this.state.backtracking&&l.add(d);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_funCall1770);g=this.logicalExpression();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(g.getTree());break;default:break a}while(1)}e=this.match(this.input,114,FormulaParser.FOLLOW_114_in_funCall1777);if(this.state.failed)return a;0===this.state.backtracking&&h.add(e);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),o=this.adaptor.nil(),o=this.adaptor.becomeRoot(this.adaptor.create(6,
"FUNCALL"),o);m.hasNext();)this.adaptor.addChild(o,m.nextTree());m.reset();this.adaptor.addChild(b,o);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(q){if(q instanceof org.antlr.runtime.RecognitionException)this.reportError(q),this.recover(this.input,q),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),q);else throw q;}finally{}return a},primaryExpression_return:function(){FormulaParser.primaryExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.primaryExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primaryExpression:function(){var a=new FormulaParser.primaryExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{var e=2,f=this.input.LA(1);if(113==f)e=1;else if(60==f||64==f||69==f||71==f||89==f||91==f||94<=f&&98>=f)e=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",
56,0,this.input);}switch(e){case 1:b=this.adaptor.nil();this.match(this.input,113,FormulaParser.FOLLOW_113_in_primaryExpression1798);if(this.state.failed)return a;this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_primaryExpression1801);c=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());this.match(this.input,114,FormulaParser.FOLLOW_114_in_primaryExpression1803);if(this.state.failed)return a;break;case 2:b=
this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_value_in_primaryExpression1809);d=this.value();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),g);else throw g;}finally{}return a},value_return:function(){FormulaParser.value_return=function(){};org.antlr.lang.extend(FormulaParser.value_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),value:function(){var a=new FormulaParser.value_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null;try{var o=9,o=this.dfa57.predict(this.input);switch(o){case 1:b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_number_in_value1823);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 2:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_value1829);e=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_value1835);f=this.string();
this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_material_in_value1841);g=this.material();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree());break;case 5:b=this.adaptor.nil();c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_value1846);if(this.state.failed)return a;0===this.state.backtracking&&
(n=this.adaptor.create(c),this.adaptor.addChild(b,n));break;case 6:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_primitive_in_value1851);h=this.primitive();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,h.getTree());break;case 7:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_value1856);k=this.array();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());
break;case 8:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_anonFunctionDef_in_value1861);l=this.anonFunctionDef();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());break;case 9:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_newObject_in_value1866);m=this.newObject();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,m.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(q){if(q instanceof org.antlr.runtime.RecognitionException)this.reportError(q),this.recover(this.input,q),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),q);else throw q;}finally{}return a},newObject_return:function(){FormulaParser.newObject_return=function(){};org.antlr.lang.extend(FormulaParser.newObject_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
newObject:function(){var a=new FormulaParser.newObject_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWSTATEMENT"),h=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule funCall");try{c=this.match(this.input,64,FormulaParser.FOLLOW_NEWSTATEMENT_in_newObject1876);if(this.state.failed)return a;0===this.state.backtracking&&
g.add(c);d=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_newObject1878);if(this.state.failed)return a;0===this.state.backtracking&&f.add(d);c=2;c=this.dfa58.predict(this.input);switch(c){case 1:this.pushFollow(FormulaParser.FOLLOW_funCall_in_newObject1880);e=this.funCall();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&h.add(e.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=
a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(29,"NEW"),k);this.adaptor.addChild(k,f.nextNode());h.hasNext()&&this.adaptor.addChild(k,h.nextTree());h.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,
l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},defaultValue_return:function(){FormulaParser.defaultValue_return=function(){};org.antlr.lang.extend(FormulaParser.defaultValue_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),defaultValue:function(){var a=new FormulaParser.defaultValue_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null;try{var h=5;switch(this.input.LA(1)){case 82:h=
1;break;case 95:case 96:h=2;break;case 97:case 98:h=3;break;case 94:h=4;break;case 89:case 91:h=5;break;default:if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",59,0,this.input);}switch(h){case 1:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_negnumber_in_defaultValue1906);c=this.negnumber();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,c.getTree());break;case 2:b=this.adaptor.nil();
this.pushFollow(FormulaParser.FOLLOW_number_in_defaultValue1912);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());break;case 3:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_bool_in_defaultValue1918);e=this.bool();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;case 4:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_string_in_defaultValue1924);
f=this.string();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());break;case 5:b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_array_in_defaultValue1930);g=this.array();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree())}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,
a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},array_return:function(){FormulaParser.array_return=function(){};org.antlr.lang.extend(FormulaParser.array_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),array:function(){var a=new FormulaParser.array_return;a.start=this.input.LT(1);var b=
null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null,r=null,u=null,w=null,v=null,x=null,z=null,D=null,H=null,C=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),A=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),y=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RARR"),F=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COMMA"),B=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token LARR"),I=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token RCURL"),E=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule label");try{var M=2,L=this.input.LA(1);if(89==L)M=1;else if(91==L)M=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",74,0,this.input);}switch(M){case 1:c=this.match(this.input,89,FormulaParser.FOLLOW_LARR_in_array1944);if(this.state.failed)return a;0===this.state.backtracking&&
B.add(c);a:do switch(w=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred85_Formula()&&(w=1)),w){case 1:d=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1946);if(this.state.failed)return a;0===this.state.backtracking&&A.add(d);break;default:break a}while(1);w=2;w=this.dfa65.predict(this.input);switch(w){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1950);x=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(x.getTree());a:do switch(w=
2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred86_Formula()&&(w=1)),w){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1952);if(this.state.failed)return a;0===this.state.backtracking&&A.add(e);break;default:break a}while(1);a:do switch(w=2,93==this.input.LA(1)&&(w=1),w){case 1:f=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_array1956);if(this.state.failed)return a;0===this.state.backtracking&&F.add(f);b:do switch(w=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred87_Formula()&&
(w=1)),w){case 1:g=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1958);if(this.state.failed)return a;0===this.state.backtracking&&A.add(g);break;default:break b}while(1);this.pushFollow(FormulaParser.FOLLOW_label_in_array1961);z=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(z.getTree());b:do switch(w=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred88_Formula()&&(w=1)),w){case 1:h=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1963);
if(this.state.failed)return a;0===this.state.backtracking&&A.add(h);break;default:break b}while(1);break;default:break a}while(1);break}a:do switch(F=2,32==this.input.LA(1)&&(F=1),F){case 1:k=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1970);if(this.state.failed)return a;0===this.state.backtracking&&A.add(k);break;default:break a}while(1);l=this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_array1973);if(this.state.failed)return a;0===this.state.backtracking&&y.add(l);if(0===
this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);for(var b=this.adaptor.nil(),K=this.adaptor.nil(),K=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),K);E.hasNext();)this.adaptor.addChild(K,E.nextTree());E.reset();this.adaptor.addChild(b,K);a.tree=b}break;case 2:m=this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_array1987);if(this.state.failed)return a;0===this.state.backtracking&&C.add(m);a:do switch(k=
2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred93_Formula()&&(k=1)),k){case 1:n=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1989);if(this.state.failed)return a;0===this.state.backtracking&&A.add(n);break;default:break a}while(1);k=2;k=this.dfa72.predict(this.input);switch(k){case 1:this.pushFollow(FormulaParser.FOLLOW_label_in_array1993);D=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(D.getTree());a:do switch(k=2,32==this.input.LA(1)&&
(this.input.LA(2),this.synpred94_Formula()&&(k=1)),k){case 1:o=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array1995);if(this.state.failed)return a;0===this.state.backtracking&&A.add(o);break;default:break a}while(1);a:do switch(k=2,93==this.input.LA(1)&&(k=1),k){case 1:q=this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_array1998);if(this.state.failed)return a;0===this.state.backtracking&&F.add(q);b:do switch(k=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred95_Formula()&&
(k=1)),k){case 1:r=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2000);if(this.state.failed)return a;0===this.state.backtracking&&A.add(r);break;default:break b}while(1);this.pushFollow(FormulaParser.FOLLOW_label_in_array2003);H=this.label();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&E.add(H.getTree());b:do switch(k=2,32==this.input.LA(1)&&(this.input.LA(2),this.synpred96_Formula()&&(k=1)),k){case 1:u=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2005);
if(this.state.failed)return a;0===this.state.backtracking&&A.add(u);break;default:break b}while(1);break;default:break a}while(1);break}a:do switch(F=2,32==this.input.LA(1)&&(F=1),F){case 1:w=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_array2012);if(this.state.failed)return a;0===this.state.backtracking&&A.add(w);break;default:break a}while(1);v=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_array2015);if(this.state.failed)return a;0===this.state.backtracking&&I.add(v);if(0===
this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);b=this.adaptor.nil();K=this.adaptor.nil();for(K=this.adaptor.becomeRoot(this.adaptor.create(13,"ARRAY"),K);E.hasNext();)this.adaptor.addChild(K,E.nextTree());E.reset();this.adaptor.addChild(b,K);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(O){if(O instanceof
org.antlr.runtime.RecognitionException)this.reportError(O),this.recover(this.input,O),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),O);else throw O;}finally{}return a},selector_return:function(){FormulaParser.selector_return=function(){};org.antlr.lang.extend(FormulaParser.selector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),selector:function(){var a=new FormulaParser.selector_return;a.start=this.input.LT(1);var b=null,c=null,d=null,
e=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule dotselector"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule minarray");try{var g=2,h=this.input.LA(1);if(89==h||91==h)g=1;else if(116==h)g=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",75,0,this.input);}switch(g){case 1:this.pushFollow(FormulaParser.FOLLOW_minarray_in_selector2036);c=this.minarray();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&f.add(c.getTree());break;case 2:this.pushFollow(FormulaParser.FOLLOW_dotselector_in_selector2040);d=this.dotselector();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&e.add(d.getTree())}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(27,"SELECTOR"),k);f.hasNext()&&
this.adaptor.addChild(k,f.nextTree());f.reset();e.hasNext()&&this.adaptor.addChild(k,e.nextTree());e.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},
minarray_return:function(){FormulaParser.minarray_return=function(){};org.antlr.lang.extend(FormulaParser.minarray_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),minarray:function(){var a=new FormulaParser.minarray_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=null,n=null,o=null,q=null;try{var r=2,u=this.input.LA(1);if(89==u)r=1;else if(91==u)r=2;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;var w=new org.antlr.runtime.NoViableAltException("",82,0,this.input);throw w;}switch(r){case 1:b=this.adaptor.nil();this.match(this.input,89,FormulaParser.FOLLOW_LARR_in_minarray2067);if(this.state.failed)return a;var f=2,v=this.input.LA(1);if(60==v||64==v||69==v||71==v||82==v||88<=v&&89>=v||91==v||94<=v&&98>=v||113==v)f=1;else if(83==v)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;w=new org.antlr.runtime.NoViableAltException("",76,0,this.input);throw w;}switch(f){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2072);
g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,g.getTree());break;case 2:c=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2074);if(this.state.failed)return a;0===this.state.backtracking&&(m=this.adaptor.create(c),this.adaptor.addChild(b,m));break}a:do switch(f=2,93==this.input.LA(1)&&(f=1),f){case 1:this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_minarray2078);if(this.state.failed)return a;var f=
2,x=this.input.LA(1);if(60==x||64==x||69==x||71==x||82==x||88<=x&&89>=x||91==x||94<=x&&98>=x||113==x)f=1;else if(83==x)f=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;w=new org.antlr.runtime.NoViableAltException("",77,0,this.input);throw w;}switch(f){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2082);h=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,h.getTree());break;case 2:d=
this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2084);if(this.state.failed)return a;0===this.state.backtracking&&(n=this.adaptor.create(d),this.adaptor.addChild(b,n))}break;default:break a}while(1);this.match(this.input,90,FormulaParser.FOLLOW_RARR_in_minarray2091);if(this.state.failed)return a;break;case 2:b=this.adaptor.nil();this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_minarray2097);if(this.state.failed)return a;var d=2,z=this.input.LA(1);if(60==z||64==z||69==z||71==z||
82==z||88<=z&&89>=z||91==z||94<=z&&98>=z||113==z)d=1;else if(83==z)d=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;w=new org.antlr.runtime.NoViableAltException("",79,0,this.input);throw w;}switch(d){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2102);k=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,k.getTree());break;case 2:e=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2104);
if(this.state.failed)return a;0===this.state.backtracking&&(o=this.adaptor.create(e),this.adaptor.addChild(b,o));break}a:do switch(d=2,93==this.input.LA(1)&&(d=1),d){case 1:this.match(this.input,93,FormulaParser.FOLLOW_COMMA_in_minarray2108);if(this.state.failed)return a;var d=2,D=this.input.LA(1);if(60==D||64==D||69==D||71==D||82==D||88<=D&&89>=D||91==D||94<=D&&98>=D||113==D)d=1;else if(83==D)d=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;w=new org.antlr.runtime.NoViableAltException("",
80,0,this.input);throw w;}switch(d){case 1:this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_minarray2112);l=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,l.getTree());break;case 2:f=this.match(this.input,83,FormulaParser.FOLLOW_MULT_in_minarray2114);if(this.state.failed)return a;0===this.state.backtracking&&(q=this.adaptor.create(f),this.adaptor.addChild(b,q))}break;default:break a}while(1);this.match(this.input,
92,FormulaParser.FOLLOW_RCURL_in_minarray2121);if(this.state.failed)return a}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(H){if(H instanceof org.antlr.runtime.RecognitionException)this.reportError(H),this.recover(this.input,H),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),H);else throw H;}finally{}return a},dotselector_return:function(){FormulaParser.dotselector_return=
function(){};org.antlr.lang.extend(FormulaParser.dotselector_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),dotselector:function(){var a=new FormulaParser.dotselector_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 116"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName");try{var g=0;a:do{var h=2;116==this.input.LA(1)&&(this.input.LA(2),this.synpred108_Formula()&&
(h=1));switch(h){case 1:c=this.match(this.input,116,FormulaParser.FOLLOW_116_in_dotselector2133);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);this.pushFollow(FormulaParser.FOLLOW_arrayName_in_dotselector2135);d=this.arrayName();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());break;default:if(1<=g)break a;if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.EarlyExitException(83,this.input);}g++}while(1);
if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),k=this.adaptor.nil(),k=this.adaptor.becomeRoot(this.adaptor.create(28,"DOTSELECTOR"),k);if(!f.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;f.hasNext();)this.adaptor.addChild(k,f.nextTree());f.reset();this.adaptor.addChild(b,k);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),
this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(l){if(l instanceof org.antlr.runtime.RecognitionException)this.reportError(l),this.recover(this.input,l),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),l);else throw l;}finally{}return a},arrayName_return:function(){FormulaParser.arrayName_return=function(){};org.antlr.lang.extend(FormulaParser.arrayName_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),arrayName:function(){var a=
new FormulaParser.arrayName_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(69==this.input.LA(1)||83==this.input.LA(1)||94==this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&
(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),d);else throw d;}finally{}return a},label_return:function(){FormulaParser.label_return=function(){};org.antlr.lang.extend(FormulaParser.label_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),
label:function(){var a=new FormulaParser.label_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token COLON"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token NEWLINE"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule arrayName"),m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule logicalExpression");try{var n=2,n=this.dfa85.predict(this.input);
switch(n){case 1:this.pushFollow(FormulaParser.FOLLOW_arrayName_in_label2173);f=this.arrayName();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&l.add(f.getTree());a:do switch(f=2,32==this.input.LA(1)&&(f=1),f){case 1:c=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_label2175);if(this.state.failed)return a;0===this.state.backtracking&&k.add(c);break;default:break a}while(1);d=this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_label2178);if(this.state.failed)return a;
0===this.state.backtracking&&h.add(d);break}a:do switch(c=2,32==this.input.LA(1)&&(c=1),c){case 1:e=this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_label2182);if(this.state.failed)return a;0===this.state.backtracking&&k.add(e);break;default:break a}while(1);this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_label2185);g=this.logicalExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(g.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),o=this.adaptor.nil(),o=this.adaptor.becomeRoot(this.adaptor.create(23,"LABEL"),o);this.adaptor.addChild(o,m.nextTree());l.hasNext()&&this.adaptor.addChild(o,l.nextTree());l.reset();this.adaptor.addChild(b,o);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(q){if(q instanceof org.antlr.runtime.RecognitionException)this.reportError(q),
this.recover(this.input,q),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),q);else throw q;}finally{}return a},number_return:function(){FormulaParser.number_return=function(){};org.antlr.lang.extend(FormulaParser.number_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),number:function(){var a=new FormulaParser.number_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(95<=this.input.LA(1)&&96>=
this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),
this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),d);else throw d;}finally{}return a},negnumber_return:function(){FormulaParser.negnumber_return=function(){};org.antlr.lang.extend(FormulaParser.negnumber_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),negnumber:function(){var a=new FormulaParser.negnumber_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token MINUS"),f=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule number");try{c=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_negnumber2261);if(this.state.failed)return a;0===this.state.backtracking&&e.add(c);this.pushFollow(FormulaParser.FOLLOW_number_in_negnumber2263);d=this.number();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&f.add(d.getTree());if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),g=this.adaptor.nil(),g=this.adaptor.becomeRoot(this.adaptor.create(4,"NEGATE"),g);this.adaptor.addChild(g,f.nextTree());this.adaptor.addChild(b,g);a.tree=b}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(h){if(h instanceof org.antlr.runtime.RecognitionException)this.reportError(h),this.recover(this.input,h),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),h);else throw h;}finally{}return a},bool_return:function(){FormulaParser.bool_return=function(){};org.antlr.lang.extend(FormulaParser.bool_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),bool:function(){var a=new FormulaParser.bool_return;a.start=this.input.LT(1);var b=null,c=null;try{b=this.adaptor.nil();c=this.input.LT(1);if(97<=this.input.LA(1)&&98>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,
this.adaptor.create(c)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(d){if(d instanceof org.antlr.runtime.RecognitionException)this.reportError(d),this.recover(this.input,d),a.tree=this.adaptor.errorNode(this.input,
a.start,this.input.LT(-1),d);else throw d;}finally{}return a},material_return:function(){FormulaParser.material_return=function(){};org.antlr.lang.extend(FormulaParser.material_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),material:function(){var a=new FormulaParser.material_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token LCURL"),h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token RCURL"),k=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression"),l=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule additiveExpression");try{c=this.match(this.input,91,FormulaParser.FOLLOW_LCURL_in_material2415);if(this.state.failed)return a;0===this.state.backtracking&&g.add(c);this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_material2417);e=this.additiveExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&l.add(e.getTree());if(" "!=this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.FailedPredicateException(this.input,"material",' this.input.get(this.input.index()-1).getText()==" "');}this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_material2421);f=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&k.add(f.getTree());
d=this.match(this.input,92,FormulaParser.FOLLOW_RCURL_in_material2423);if(this.state.failed)return a;0===this.state.backtracking&&h.add(d);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),m=this.adaptor.nil(),m=this.adaptor.becomeRoot(this.adaptor.create(7,"MATERIAL"),m);this.adaptor.addChild(m,k.nextTree());this.adaptor.addChild(m,l.nextTree());this.adaptor.addChild(b,m);a.tree=b}a.stop=
this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(n){if(n instanceof org.antlr.runtime.RecognitionException)this.reportError(n),this.recover(this.input,n),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),n);else throw n;}finally{}return a},unitMultiplicativeExpression_return:function(){FormulaParser.unitMultiplicativeExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitMultiplicativeExpression_return,
org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitMultiplicativeExpression:function(){var a=new FormulaParser.unitMultiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460);d=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,
d.getTree());a:do switch(d=2,99==this.input.LA(1)&&(d=1),d){case 1:c=this.match(this.input,99,FormulaParser.FOLLOW_PER_in_unitMultiplicativeExpression2464);if(this.state.failed)return a;0===this.state.backtracking&&(f=this.adaptor.create(c),b=this.adaptor.becomeRoot(f,b));this.pushFollow(FormulaParser.FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467);e=this.unitInnerMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&
this.adaptor.addChild(b,e.getTree());break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;}finally{}return a},unitInnerMultiplicativeExpression_return:function(){FormulaParser.unitInnerMultiplicativeExpression_return=
function(){};org.antlr.lang.extend(FormulaParser.unitInnerMultiplicativeExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitInnerMultiplicativeExpression:function(){var a=new FormulaParser.unitInnerMultiplicativeExpression_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483);d=this.unitClump();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&this.adaptor.addChild(b,d.getTree());a:do{var d=2,f=this.input.LA(1);83<=f&&84>=f&&(d=1);switch(d){case 1:c=this.input.LT(1);if(83<=this.input.LA(1)&&84>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&(b=this.adaptor.becomeRoot(this.adaptor.create(c),b)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494);
e=this.unitClump();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,e.getTree());break;default:break a}}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(g){if(g instanceof org.antlr.runtime.RecognitionException)this.reportError(g),this.recover(this.input,g),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),g);else throw g;
}finally{}return a},unitClump_return:function(){FormulaParser.unitClump_return=function(){};org.antlr.lang.extend(FormulaParser.unitClump_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitClump:function(){var a=new FormulaParser.unitClump_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null,k=null,l=null,m=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token INTEGER"),n=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,
"token SQUARED"),o=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token DIV"),q=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token CUBED"),r=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitPowerExpression");try{var u=2,w=this.input.LA(1);if(95==w)u=1;else if(69==w||113==w)u=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",93,0,this.input);}switch(u){case 1:c=this.match(this.input,
95,FormulaParser.FOLLOW_INTEGER_in_unitClump2510);if(this.state.failed)return a;0===this.state.backtracking&&m.add(c);d=this.match(this.input,84,FormulaParser.FOLLOW_DIV_in_unitClump2512);if(this.state.failed)return a;0===this.state.backtracking&&o.add(d);this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2515);k=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&r.add(k.getTree());h=2;100==this.input.LA(1)&&(h=1);switch(h){case 1:e=
this.match(this.input,100,FormulaParser.FOLLOW_CUBED_in_unitClump2517);if(this.state.failed)return a;0===this.state.backtracking&&q.add(e)}h=2;101==this.input.LA(1)&&(h=1);switch(h){case 1:f=this.match(this.input,101,FormulaParser.FOLLOW_SQUARED_in_unitClump2520);if(this.state.failed)return a;0===this.state.backtracking&&n.add(f)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),v=
this.adaptor.nil(),v=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),v);this.adaptor.addChild(v,r.nextTree());for(this.adaptor.addChild(v,this.adaptor.create(4,"NEGATE"));q.hasNext();)this.adaptor.addChild(v,q.nextNode());for(q.reset();n.hasNext();)this.adaptor.addChild(v,n.nextNode());n.reset();this.adaptor.addChild(b,v);a.tree=b}break;case 2:this.pushFollow(FormulaParser.FOLLOW_unitPowerExpression_in_unitClump2543);l=this.unitPowerExpression();this.state._fsp--;if(this.state.failed)return a;
0===this.state.backtracking&&r.add(l.getTree());f=2;100==this.input.LA(1)&&(f=1);switch(f){case 1:g=this.match(this.input,100,FormulaParser.FOLLOW_CUBED_in_unitClump2545);if(this.state.failed)return a;0===this.state.backtracking&&q.add(g)}f=2;101==this.input.LA(1)&&(f=1);switch(f){case 1:h=this.match(this.input,101,FormulaParser.FOLLOW_SQUARED_in_unitClump2548);if(this.state.failed)return a;0===this.state.backtracking&&n.add(h)}if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,
"token retval",null!=a?a.tree:null);b=this.adaptor.nil();v=this.adaptor.nil();v=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),v);for(this.adaptor.addChild(v,r.nextTree());q.hasNext();)this.adaptor.addChild(v,q.nextNode());for(q.reset();n.hasNext();)this.adaptor.addChild(v,n.nextNode());n.reset();this.adaptor.addChild(b,v);a.tree=b}}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(x){if(x instanceof
org.antlr.runtime.RecognitionException)this.reportError(x),this.recover(this.input,x),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),x);else throw x;}finally{}return a},unitPowerExpression_return:function(){FormulaParser.unitPowerExpression_return=function(){};org.antlr.lang.extend(FormulaParser.unitPowerExpression_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unitPowerExpression:function(){var a=new FormulaParser.unitPowerExpression_return;
a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=null;try{b=this.adaptor.nil();this.pushFollow(FormulaParser.FOLLOW_unit_in_unitPowerExpression2610);f=this.unit();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&this.adaptor.addChild(b,f.getTree());a:do switch(f=2,87==this.input.LA(1)&&(f=1),f){case 1:c=this.match(this.input,87,FormulaParser.FOLLOW_POW_in_unitPowerExpression2614);if(this.state.failed)return a;0===this.state.backtracking&&(g=this.adaptor.create(c),
b=this.adaptor.becomeRoot(g,b));f=2;82==this.input.LA(1)&&(f=1);switch(f){case 1:d=this.match(this.input,82,FormulaParser.FOLLOW_MINUS_in_unitPowerExpression2617);if(this.state.failed)return a;0===this.state.backtracking&&(h=this.adaptor.create(d),this.adaptor.addChild(b,h))}e=this.input.LT(1);if(95<=this.input.LA(1)&&96>=this.input.LA(1))this.input.consume(),0===this.state.backtracking&&this.adaptor.addChild(b,this.adaptor.create(e)),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking)return this.state.failed=
!0,a;throw new org.antlr.runtime.MismatchedSetException(null,this.input);}break;default:break a}while(1);a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(k){if(k instanceof org.antlr.runtime.RecognitionException)this.reportError(k),this.recover(this.input,k),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),k);else throw k;}finally{}return a},unit_return:function(){FormulaParser.unit_return=
function(){};org.antlr.lang.extend(FormulaParser.unit_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),unit:function(){var a=new FormulaParser.unit_return;a.start=this.input.LT(1);var b=null,c=null,d=null,e=null,f=null,g=null,h=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 114"),k=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token IDENT"),l=new org.antlr.runtime.tree.RewriteRuleTokenStream(this.adaptor,"token 113"),
m=new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"rule unitMultiplicativeExpression");try{var n=2,o=this.input.LA(1);if(69==o)n=1;else if(113==o)n=2;else{if(0<this.state.backtracking)return this.state.failed=!0,a;throw new org.antlr.runtime.NoViableAltException("",97,0,this.input);}switch(n){case 1:c=this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_unit2638);if(this.state.failed)return a;0===this.state.backtracking&&k.add(c);a:do switch(c=2,69==this.input.LA(1)&&(c=1),c){case 1:d=
this.match(this.input,69,FormulaParser.FOLLOW_IDENT_in_unit2641);if(this.state.failed)return a;0===this.state.backtracking&&k.add(d);break;default:break a}while(1);if(0===this.state.backtracking){a.tree=b;new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null);var b=this.adaptor.nil(),q=this.adaptor.nil(),q=this.adaptor.becomeRoot(this.adaptor.create(8,"UNIT"),q);if(!k.hasNext())throw new org.antlr.runtime.tree.RewriteEarlyExitException;for(;k.hasNext();)this.adaptor.addChild(q,
k.nextNode());k.reset();this.adaptor.addChild(b,q);a.tree=b}break;case 2:e=this.match(this.input,113,FormulaParser.FOLLOW_113_in_unit2658);if(this.state.failed)return a;0===this.state.backtracking&&l.add(e);this.pushFollow(FormulaParser.FOLLOW_unitMultiplicativeExpression_in_unit2660);g=this.unitMultiplicativeExpression();this.state._fsp--;if(this.state.failed)return a;0===this.state.backtracking&&m.add(g.getTree());f=this.match(this.input,114,FormulaParser.FOLLOW_114_in_unit2662);if(this.state.failed)return a;
0===this.state.backtracking&&h.add(f);0===this.state.backtracking&&(a.tree=b,new org.antlr.runtime.tree.RewriteRuleSubtreeStream(this.adaptor,"token retval",null!=a?a.tree:null),b=this.adaptor.nil(),q=this.adaptor.nil(),q=this.adaptor.becomeRoot(this.adaptor.create(12,"UNITCLUMP"),q),this.adaptor.addChild(q,m.nextTree()),this.adaptor.addChild(b,q),a.tree=b)}a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,
a.stop))}catch(r){if(r instanceof org.antlr.runtime.RecognitionException)this.reportError(r),this.recover(this.input,r),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),r);else throw r;}finally{}return a},primitive_return:function(){FormulaParser.primitive_return=function(){};org.antlr.lang.extend(FormulaParser.primitive_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),primitive:function(){var a=new FormulaParser.primitive_return;a.start=
this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,71,FormulaParser.FOLLOW_PRIMITIVE_in_primitive2731);if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),this.adaptor.addChild(b,d));a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),this.recover(this.input,
e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},string_return:function(){FormulaParser.string_return=function(){};org.antlr.lang.extend(FormulaParser.string_return,org.antlr.runtime.ParserRuleReturnScope,{getTree:function(){return this.tree}})}(),string:function(){var a=new FormulaParser.string_return;a.start=this.input.LT(1);var b=null,c=null,d=null;try{b=this.adaptor.nil();c=this.match(this.input,94,FormulaParser.FOLLOW_STRING_in_string3200);
if(this.state.failed)return a;0===this.state.backtracking&&(d=this.adaptor.create(c),b=this.adaptor.becomeRoot(d,b));a.stop=this.input.LT(-1);0===this.state.backtracking&&(a.tree=this.adaptor.rulePostProcessing(b),this.adaptor.setTokenBoundaries(a.tree,a.start,a.stop))}catch(e){if(e instanceof org.antlr.runtime.RecognitionException)this.reportError(e),this.recover(this.input,e),a.tree=this.adaptor.errorNode(this.input,a.start,this.input.LT(-1),e);else throw e;}finally{}return a},synpred5_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_assignment_in_synpred5_Formula508);
this.assignment();this.state._fsp--},synpred6_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_logicalExpression_in_synpred6_Formula514);this.logicalExpression();this.state._fsp--},synpred8_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forLoop_in_synpred8_Formula526);this.forLoop();this.state._fsp--},synpred9_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_forInLoop_in_synpred9_Formula532);this.forInLoop();this.state._fsp--},synpred11_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_functionDef_in_synpred11_Formula544);
this.functionDef();this.state._fsp--},synpred47_Formula_fragment:function(){this.match(this.input,72,FormulaParser.FOLLOW_OR_in_synpred47_Formula1217);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_booleanXORExpression_in_synpred47_Formula1220),this.booleanXORExpression(),this.state._fsp--)},synpred48_Formula_fragment:function(){this.match(this.input,73,FormulaParser.FOLLOW_XOR_in_synpred48_Formula1253);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_booleanAndExpression_in_synpred48_Formula1256),
this.booleanAndExpression(),this.state._fsp--)},synpred49_Formula_fragment:function(){this.match(this.input,75,FormulaParser.FOLLOW_AND_in_synpred49_Formula1288);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_equalityExpression_in_synpred49_Formula1291),this.equalityExpression(),this.state._fsp--)},synpred51_Formula_fragment:function(){if(70==this.input.LA(1)||76==this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_relationalExpression_in_synpred51_Formula1332);this.relationalExpression();this.state._fsp--},synpred55_Formula_fragment:function(){if(77<=this.input.LA(1)&&80>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_additiveExpression_in_synpred55_Formula1389);
this.additiveExpression();this.state._fsp--},synpred57_Formula_fragment:function(){if(81<=this.input.LA(1)&&82>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_multiplicativeExpression_in_synpred57_Formula1443);this.multiplicativeExpression();this.state._fsp--},synpred60_Formula_fragment:function(){if(83<=
this.input.LA(1)&&85>=this.input.LA(1))this.input.consume(),this.state.errorRecovery=!1,this.state.failed=!1;else{if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.MismatchedSetException(null,this.input);}this.pushFollow(FormulaParser.FOLLOW_arrayExpression_in_synpred60_Formula1486);this.arrayExpression();this.state._fsp--},synpred61_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred61_Formula1538);if(!this.state.failed){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred61_Formula",' this.input.get(this.input.index()-1).getText()!=" "');
}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred61_Formula1542);this.negationExpression();this.state._fsp--}},synpred62_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred62_Formula1551);if(!this.state.failed){if(" "==
this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred62_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}this.pushFollow(FormulaParser.FOLLOW_negationExpression_in_synpred62_Formula1555);this.negationExpression();this.state._fsp--}},synpred64_Formula_fragment:function(){this.match(this.input,87,FormulaParser.FOLLOW_POW_in_synpred64_Formula1610);this.state.failed||
(this.pushFollow(FormulaParser.FOLLOW_unaryOrNegate_in_synpred64_Formula1612),this.unaryOrNegate(),this.state._fsp--)},synpred68_Formula_fragment:function(){if(" "==this.input.get(this.input.index()-1).getText()){if(0<this.state.backtracking){this.state.failed=!0;return}throw new org.antlr.runtime.FailedPredicateException(this.input,"synpred68_Formula",' this.input.get(this.input.index()-1).getText()!=" "');}var a=2,a=this.input.LA(1);if(89==a||91==a||116==a)a=1;else if(113==a)a=2;else{if(0<this.state.backtracking){this.state.failed=
!0;return}throw new org.antlr.runtime.NoViableAltException("",119,0,this.input);}switch(a){case 1:this.pushFollow(FormulaParser.FOLLOW_selector_in_synpred68_Formula1744);this.selector();this.state._fsp--;if(this.state.failed)break;break;case 2:this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred68_Formula1746),this.funCall(),this.state._fsp--}},synpred75_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_material_in_synpred75_Formula1841);this.material();this.state._fsp--},synpred78_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_array_in_synpred78_Formula1856);
this.array();this.state._fsp--},synpred80_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_funCall_in_synpred80_Formula1880);this.funCall();this.state._fsp--},synpred85_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred85_Formula1946)},synpred86_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred86_Formula1952)},synpred87_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred87_Formula1958)},
synpred88_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred88_Formula1963)},synpred93_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred93_Formula1989)},synpred94_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred94_Formula1995)},synpred95_Formula_fragment:function(){this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred95_Formula2000)},synpred96_Formula_fragment:function(){this.match(this.input,
32,FormulaParser.FOLLOW_NEWLINE_in_synpred96_Formula2005)},synpred108_Formula_fragment:function(){this.match(this.input,116,FormulaParser.FOLLOW_116_in_synpred108_Formula2133);this.state.failed||(this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred108_Formula2135),this.arrayName(),this.state._fsp--)},synpred112_Formula_fragment:function(){this.pushFollow(FormulaParser.FOLLOW_arrayName_in_synpred112_Formula2173);this.arrayName();this.state._fsp--;if(!this.state.failed){a:do{var a=2;32==this.input.LA(1)&&
(a=1);switch(a){case 1:this.match(this.input,32,FormulaParser.FOLLOW_NEWLINE_in_synpred112_Formula2175);if(this.state.failed)return;break;default:break a}}while(1);this.match(this.input,86,FormulaParser.FOLLOW_COLON_in_synpred112_Formula2178)}},synpred95_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred95_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},
synpred94_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred94_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred80_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred80_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=
!1;return c},synpred49_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred49_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred57_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred57_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;
this.state.failed=!1;return c},synpred68_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred68_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred51_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred51_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);
this.state.backtracking--;this.state.failed=!1;return c},synpred62_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred62_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred64_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred64_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;
this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred93_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred93_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred55_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred55_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=
!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred85_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred85_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred87_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred87_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred48_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred48_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred86_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred86_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred9_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred9_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred75_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred75_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred96_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred96_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred47_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred47_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred8_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred8_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred112_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred112_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred6_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred6_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred5_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred5_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred60_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred60_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred61_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred61_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred108_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred108_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred11_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred11_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred78_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred78_Formula_fragment()}catch(b){alert("impossible: "+b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c},synpred88_Formula:function(){this.state.backtracking++;var a=this.input.mark();try{this.synpred88_Formula_fragment()}catch(b){alert("impossible: "+
b.toString())}var c=!this.state.failed;this.input.rewind(a);this.state.backtracking--;this.state.failed=!1;return c}},!0);org.antlr.lang.augmentObject(FormulaParser,{DFA5_eotS:"\u0017\uffff",DFA5_eofS:"\u0017\uffff",DFA5_minS:"\u0001&\u0002\x00\u0008\uffff\u0001\x00\u0002\uffff\u0001\x00\u0008\uffff",DFA5_maxS:"\u0001q\u0002\x00\u0008\uffff\u0001\x00\u0002\uffff\u0001\x00\u0008\uffff",DFA5_acceptS:"\u0003\uffff\u0001\u0002\t\uffff\u0001\u0003\u0001\uffff\u0001\u0006\u0001\u0008\u0001\t\u0001\n\u0001\u0001\u0001\u0007\u0001\u0004\u0001\u0005",
DFA5_specialS:"\u0001\uffff\u0001\x00\u0001\u0001\u0008\uffff\u0001\u0002\u0002\uffff\u0001\u0003\u0008\uffff}>",DFA5_transitionS:"\u0001\r\u0003\uffff\u0001\u000e\x0B\uffff\u0001\u000f\u0005\uffff\u0001\x0B\u0002\uffff\u0001\u0010\u0001\u0003\u0001\u0011\u0002\uffff\u0001\u0012\u0001\u0001\u0001\uffff\u0001\u0002\n\uffff\u0001\u0003\u0005\uffff\u0002\u0003\u0001\uffff\u0001\u0003\u0002\uffff\u0005\u0003\u000e\uffff\u0001\u0003,\u0001\uffff,\u0001\uffff,,,,,,,,,\u0001\uffff,,,\u0001\uffff,,,,,,,,".split(",")});
org.antlr.lang.augmentObject(FormulaParser,{DFA5_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eotS),DFA5_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_eofS),DFA5_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_minS),DFA5_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA5_maxS),DFA5_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_acceptS),DFA5_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_specialS),
DFA5_transition:function(){var a=[],b,c=FormulaParser.DFA5_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA5_transitionS[b]));return a}()});FormulaParser.DFA5=function(a){this.recognizer=a;this.decisionNumber=5;this.eot=FormulaParser.DFA5_eot;this.eof=FormulaParser.DFA5_eof;this.min=FormulaParser.DFA5_min;this.max=FormulaParser.DFA5_max;this.accept=FormulaParser.DFA5_accept;this.special=FormulaParser.DFA5_special;this.transition=FormulaParser.DFA5_transition};
org.antlr.lang.extend(FormulaParser.DFA5,org.antlr.runtime.DFA,{getDescription:function(){return"120:1: expression : ( assignment | logicalExpression | whileLoop | forLoop | forInLoop | ifThenElse | functionDef | returnExp | tryCatch | throwExp );"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;this.synpred5_Formula()?a=19:this.synpred6_Formula()&&(a=3);b.seek(c);if(0<=a)return a;break;case 1:b.LA(1);c=b.index();b.rewind();a=-1;this.synpred5_Formula()?
a=19:this.synpred6_Formula()&&(a=3);b.seek(c);if(0<=a)return a;break;case 2:b.LA(1);c=b.index();b.rewind();a=-1;this.synpred6_Formula()?a=3:this.synpred11_Formula()&&(a=20);b.seek(c);if(0<=a)return a;break;case 3:if(b.LA(1),c=b.index(),b.rewind(),a=-1,this.synpred8_Formula()?a=21:this.synpred9_Formula()&&(a=22),b.seek(c),0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),
5,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA57_eotS:"\x0B\uffff",DFA57_eofS:"\x0B\uffff",DFA57_minS:"\u0001<\u0003\uffff\u0001\x00\u0006\uffff",DFA57_maxS:"\u0001b\u0003\uffff\u0001\x00\u0006\uffff",DFA57_acceptS:"\u0001\uffff\u0001\u0001\u0001\u0002\u0001\u0003\u0001\uffff\u0001\u0005\u0001\u0006\u0001\u0007\u0001\u0008\u0001\t\u0001\u0004",DFA57_specialS:"\u0004\uffff\u0001\x00\u0006\uffff}>",DFA57_transitionS:"\u0001\u0008\u0003\uffff\u0001\t\u0004\uffff\u0001\u0005\u0001\uffff\u0001\u0006\u0011\uffff\u0001\u0007\u0001\uffff\u0001\u0004\u0002\uffff\u0001\u0003\u0002\u0001\u0002\u0002,,,,\u0001\uffff,,,,,,".split(",")});
org.antlr.lang.augmentObject(FormulaParser,{DFA57_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eotS),DFA57_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_eofS),DFA57_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_minS),DFA57_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA57_maxS),DFA57_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_acceptS),DFA57_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_specialS),
DFA57_transition:function(){var a=[],b,c=FormulaParser.DFA57_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA57_transitionS[b]));return a}()});FormulaParser.DFA57=function(a){this.recognizer=a;this.decisionNumber=57;this.eot=FormulaParser.DFA57_eot;this.eof=FormulaParser.DFA57_eof;this.min=FormulaParser.DFA57_min;this.max=FormulaParser.DFA57_max;this.accept=FormulaParser.DFA57_accept;this.special=FormulaParser.DFA57_special;this.transition=FormulaParser.DFA57_transition};
org.antlr.lang.extend(FormulaParser.DFA57,org.antlr.runtime.DFA,{getDescription:function(){return"283:1: value : ( number | bool | string | material | IDENT | primitive | array | anonFunctionDef | newObject );"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;this.synpred75_Formula()?a=10:this.synpred78_Formula()&&(a=7);b.seek(c);if(0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),57,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA58_eotS:"\u001a\uffff",DFA58_eofS:"\u0001\u0002\u0019\uffff",DFA58_minS:"\u0001 \u0001\x00\u0018\uffff",DFA58_maxS:"\u0001t\u0001\x00\u0018\uffff",DFA58_acceptS:"\u0002\uffff\u0001\u0002\u0016\uffff\u0001\u0001",DFA58_specialS:"\u0001\uffff\u0001\x00\u0018\uffff}>",DFA58_transitionS:"\u0001\u0002\u000f\uffff\u0001\u0002\u0002\uffff\u0001\u0002\u0003\uffff\u0001\u0002\r\uffff\u0002\u0002\u0001\uffff\u0002\u0002\u0001\uffff\r\u0002\u0001\uffff\u0005\u0002\u0001\uffff\u0001\u0002\u0011\uffff\u0001\u0001\u0001\u0002\u0001\uffff\u0001\u0002,\u0001\uffff,,,,,,,,,,,,,,,,,,,,,,,,".split(",")});
org.antlr.lang.augmentObject(FormulaParser,{DFA58_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eotS),DFA58_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_eofS),DFA58_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_minS),DFA58_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA58_maxS),DFA58_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_acceptS),DFA58_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_specialS),
DFA58_transition:function(){var a=[],b,c=FormulaParser.DFA58_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA58_transitionS[b]));return a}()});FormulaParser.DFA58=function(a){this.recognizer=a;this.decisionNumber=58;this.eot=FormulaParser.DFA58_eot;this.eof=FormulaParser.DFA58_eof;this.min=FormulaParser.DFA58_min;this.max=FormulaParser.DFA58_max;this.accept=FormulaParser.DFA58_accept;this.special=FormulaParser.DFA58_special;this.transition=FormulaParser.DFA58_transition};
org.antlr.lang.extend(FormulaParser.DFA58,org.antlr.runtime.DFA,{getDescription:function(){return"296:22: ( funCall )?"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=-1;if(this.synpred80_Formula())a=25;else if(" "==this.input.get(this.input.index()-1).getText()||" "!=this.input.get(this.input.index()-1).getText())a=2;b.seek(c);if(0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),58,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eotS:"\u0004\uffff",DFA65_eofS:"\u0004\uffff",DFA65_minS:"\u0001 \u0001\uffff\u0001 \u0001\uffff",DFA65_maxS:"\u0001q\u0001\uffff\u0001q\u0001\uffff",DFA65_acceptS:"\u0001\uffff\u0001\u0001\u0001\uffff\u0001\u0002",DFA65_specialS:"\u0004\uffff}>",DFA65_transitionS:["\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0002\u0001\u0004\uffff\u0002\u0001\u0001\u0003\u0001\u0001\u0002\uffff\u0005\u0001\u000e\uffff\u0001\u0001",
"","\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0001\u0001\u0005\uffff\u0002\u0001\u0001\u0003\u0001\u0001\u0002\uffff\u0005\u0001\u000e\uffff\u0001\u0001",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA65_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eotS),DFA65_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_eofS),DFA65_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_minS),
DFA65_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA65_maxS),DFA65_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_acceptS),DFA65_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_specialS),DFA65_transition:function(){var a=[],b,c=FormulaParser.DFA65_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA65_transitionS[b]));return a}()});FormulaParser.DFA65=function(a){this.recognizer=
a;this.decisionNumber=65;this.eot=FormulaParser.DFA65_eot;this.eof=FormulaParser.DFA65_eof;this.min=FormulaParser.DFA65_min;this.max=FormulaParser.DFA65_max;this.accept=FormulaParser.DFA65_accept;this.special=FormulaParser.DFA65_special;this.transition=FormulaParser.DFA65_transition};org.antlr.lang.extend(FormulaParser.DFA65,org.antlr.runtime.DFA,{getDescription:function(){return"309:16: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,
{DFA72_eotS:"\u0004\uffff",DFA72_eofS:"\u0004\uffff",DFA72_minS:"\u0001 \u0001\uffff\u0001 \u0001\uffff",DFA72_maxS:"\u0001q\u0001\uffff\u0001q\u0001\uffff",DFA72_acceptS:"\u0001\uffff\u0001\u0001\u0001\uffff\u0001\u0002",DFA72_specialS:"\u0004\uffff}>",DFA72_transitionS:["\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0002\u0001\u0004\uffff\u0002\u0001\u0001\uffff\u0001\u0001\u0001\u0003\u0001\uffff\u0005\u0001\u000e\uffff\u0001\u0001",
"","\u0001\u0002\u001b\uffff\u0001\u0001\u0003\uffff\u0001\u0001\u0004\uffff\u0001\u0001\u0001\uffff\u0001\u0001\n\uffff\u0001\u0001\u0005\uffff\u0002\u0001\u0001\uffff\u0001\u0001\u0001\u0003\u0001\uffff\u0005\u0001\u000e\uffff\u0001\u0001",""]});org.antlr.lang.augmentObject(FormulaParser,{DFA72_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eotS),DFA72_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_eofS),DFA72_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_minS),
DFA72_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA72_maxS),DFA72_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_acceptS),DFA72_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_specialS),DFA72_transition:function(){var a=[],b,c=FormulaParser.DFA72_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA72_transitionS[b]));return a}()});FormulaParser.DFA72=function(a){this.recognizer=
a;this.decisionNumber=72;this.eot=FormulaParser.DFA72_eot;this.eof=FormulaParser.DFA72_eof;this.min=FormulaParser.DFA72_min;this.max=FormulaParser.DFA72_max;this.accept=FormulaParser.DFA72_accept;this.special=FormulaParser.DFA72_special;this.transition=FormulaParser.DFA72_transition};org.antlr.lang.extend(FormulaParser.DFA72,org.antlr.runtime.DFA,{getDescription:function(){return"310:19: ( label ( NEWLINE )* ( ',' ( NEWLINE )* label ( NEWLINE )* )* )?"},dummy:null});org.antlr.lang.augmentObject(FormulaParser,
{DFA85_eotS:"\u000f\uffff",DFA85_eofS:"\u000f\uffff",DFA85_minS:"\u0001 \u0001\x00\u0006\uffff\u0001\x00\u0006\uffff",DFA85_maxS:"\u0001q\u0001\x00\u0006\uffff\u0001\x00\u0006\uffff",DFA85_acceptS:"\u0002\uffff\u0001\u0002\u0007\uffff\u0001\u0001\u0004\uffff",DFA85_specialS:"\u0001\uffff\u0001\x00\u0006\uffff\u0001\u0001\u0006\uffff}>",DFA85_transitionS:"\u0001\u0002\u001b\uffff\u0001\u0002\u0003\uffff\u0001\u0002\u0004\uffff\u0001\u0008\u0001\uffff\u0001\u0002\n\uffff\u0001\u0002\u0001\n\u0004\uffff\u0002\u0002\u0001\uffff\u0001\u0002\u0002\uffff\u0001\u0001\u0004\u0002\u000e\uffff\u0001\u0002,\u0001\uffff,,,,,,,\u0001\uffff,,,,,,".split(",")});
org.antlr.lang.augmentObject(FormulaParser,{DFA85_eot:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eotS),DFA85_eof:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_eofS),DFA85_min:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_minS),DFA85_max:org.antlr.runtime.DFA.unpackEncodedStringToUnsignedChars(FormulaParser.DFA85_maxS),DFA85_accept:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_acceptS),DFA85_special:org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_specialS),
DFA85_transition:function(){var a=[],b,c=FormulaParser.DFA85_transitionS.length;for(b=0;b<c;b++)a.push(org.antlr.runtime.DFA.unpackEncodedString(FormulaParser.DFA85_transitionS[b]));return a}()});FormulaParser.DFA85=function(a){this.recognizer=a;this.decisionNumber=85;this.eot=FormulaParser.DFA85_eot;this.eof=FormulaParser.DFA85_eof;this.min=FormulaParser.DFA85_min;this.max=FormulaParser.DFA85_max;this.accept=FormulaParser.DFA85_accept;this.special=FormulaParser.DFA85_special;this.transition=FormulaParser.DFA85_transition};
org.antlr.lang.extend(FormulaParser.DFA85,org.antlr.runtime.DFA,{getDescription:function(){return"331:2: ( arrayName ( NEWLINE )* COLON )?"},specialStateTransition:function(a,b){var c=function(a,b){switch(a){case 0:b.LA(1);var c=b.index();b.rewind();a=this.synpred112_Formula()?10:2;b.seek(c);if(0<=a)return a;break;case 1:if(b.LA(1),c=b.index(),b.rewind(),a=this.synpred112_Formula()?10:2,b.seek(c),0<=a)return a}}.call(this.recognizer,a,b);if(!org.antlr.lang.isUndefined(c))return c;if(0<this.recognizer.state.backtracking)return this.recognizer.state.failed=
!0,-1;c=new org.antlr.runtime.NoViableAltException(this.getDescription(),85,a,b);this.error(c);throw c;},dummy:null});org.antlr.lang.augmentObject(FormulaParser,{tokenNames:"<invalid>,<EOR>,<DOWN>,<UP>,NEGATE,ASSIGN,FUNCALL,MATERIAL,UNIT,POWER,DEFAULTS,PARAMS,UNITCLUMP,ARRAY,LINES,WHILE,IFTHENELSE,ELSE,FOR,FORIN,FUNCTION,ANONFUNCTION,NUMBER,LABEL,RANGE,INNER,ASSIGNED,SELECTOR,DOTSELECTOR,NEW,TRYCATCH,THROW,NEWLINE,W,H,I,L,E,WHILESTATEMENT,F,O,R,FORSTATEMENT,M,FROMSTATEMENT,N,INSTATEMENT,T,TOSTATEMENT,B,Y,BYSTATEMENT,P,LOOPSTATEMENT,IFSTATEMENT,THENSTATEMENT,S,ELSESTATEMENT,U,C,FUNCTIONSTATEMENT,D,ENDBLOCK,RETURNSTATEMENT,NEWSTATEMENT,TRYSTATEMENT,A,CATCHSTATEMENT,THROWSTATEMENT,IDENT,EQUALS,PRIMITIVE,OR,XOR,X,AND,NOTEQUALS,LT,LTEQ,GT,GTEQ,PLUS,MINUS,MULT,DIV,MOD,COLON,POW,NOT,LARR,RARR,LCURL,RCURL,COMMA,STRING,INTEGER,FLOAT,TRUE,FALSE,PER,CUBED,SQUARED,Q,LBRACKET,RBRACKET,COMMENT,LINE_COMMENT,WS,G,J,K,V,Z,'(',')','<-','.'".split(","),
FOLLOW_NEWLINE_in_lines160:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_expression_in_lines164:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_lines168:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_EOF_in_lines171:new org.antlr.runtime.BitSet([0,2420114496,3406037171,131079]),FOLLOW_EOF_in_lines176:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_expression508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_expression514:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_whileLoop_in_expression520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forLoop_in_expression526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_expression532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_ifThenElse_in_expression538:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_expression544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_returnExp_in_expression550:new org.antlr.runtime.BitSet([2,0]),FOLLOW_tryCatch_in_expression556:new org.antlr.runtime.BitSet([2,0]),FOLLOW_throwExp_in_expression562:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_RETURNSTATEMENT_in_returnExp574:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_returnExp577:new org.antlr.runtime.BitSet([2,0]),FOLLOW_expression_in_innerBlock590:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_innerBlock594:new org.antlr.runtime.BitSet([2,2420114497,3406037171,131079]),FOLLOW_WHILESTATEMENT_in_whileLoop619:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_whileLoop621:new org.antlr.runtime.BitSet([0,
1]),FOLLOW_NEWLINE_in_whileLoop623:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_whileLoop626:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_whileLoop629:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_whileLoop631:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forLoop652:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forLoop654:new org.antlr.runtime.BitSet([0,4096]),FOLLOW_FROMSTATEMENT_in_forLoop656:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop658:new org.antlr.runtime.BitSet([0,65536]),FOLLOW_TOSTATEMENT_in_forLoop660:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop662:new org.antlr.runtime.BitSet([0,524289]),FOLLOW_BYSTATEMENT_in_forLoop665:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forLoop667:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_forLoop671:new org.antlr.runtime.BitSet([0,
3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forLoop674:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forLoop677:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forLoop679:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FORSTATEMENT_in_forInLoop707:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_forInLoop709:new org.antlr.runtime.BitSet([0,16384]),FOLLOW_INSTATEMENT_in_forInLoop711:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_forInLoop713:new org.antlr.runtime.BitSet([0,
1]),FOLLOW_NEWLINE_in_forInLoop715:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_forInLoop718:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_forInLoop721:new org.antlr.runtime.BitSet([0,2097152]),FOLLOW_LOOPSTATEMENT_in_forInLoop723:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IFSTATEMENT_in_ifThenElse748:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse750:new org.antlr.runtime.BitSet([0,8388608]),
FOLLOW_THENSTATEMENT_in_ifThenElse752:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse755:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse758:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse762:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse764:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_ifThenElse766:new org.antlr.runtime.BitSet([0,
8388608]),FOLLOW_THENSTATEMENT_in_ifThenElse768:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse770:new org.antlr.runtime.BitSet([0,3527410753,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse773:new org.antlr.runtime.BitSet([0,1107296256]),FOLLOW_ELSESTATEMENT_in_ifThenElse778:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_ifThenElse780:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_ifThenElse783:new org.antlr.runtime.BitSet([0,1073741824]),
FOLLOW_ENDBLOCK_in_ifThenElse787:new org.antlr.runtime.BitSet([0,4194304]),FOLLOW_IFSTATEMENT_in_ifThenElse789:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef820:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef822:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_functionDef824:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_functionDef827:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_functionDef831:new org.antlr.runtime.BitSet([0,
0,3389259776,7]),FOLLOW_defaultValue_in_functionDef834:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef839:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef841:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_functionDef848:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_functionDef850:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_functionDef852:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_functionDef854:new org.antlr.runtime.BitSet([0,
0,536870912,262144]),FOLLOW_114_in_functionDef861:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_functionDef863:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_functionDef866:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_functionDef869:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_functionDef871:new org.antlr.runtime.BitSet([2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch904:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch906:new org.antlr.runtime.BitSet([0,
2420114497,3406037179,131079]),FOLLOW_innerBlock_in_tryCatch909:new org.antlr.runtime.BitSet([0,0,8,0]),FOLLOW_CATCHSTATEMENT_in_tryCatch911:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_tryCatch913:new org.antlr.runtime.BitSet([0,1]),FOLLOW_NEWLINE_in_tryCatch915:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_tryCatch919:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_tryCatch921:new org.antlr.runtime.BitSet([0,0,2,0]),FOLLOW_TRYSTATEMENT_in_tryCatch923:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_THROWSTATEMENT_in_throwExp945:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_primaryExpression_in_throwExp947:new org.antlr.runtime.BitSet([2,0]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef967:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_anonFunctionDef970:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_anonFunctionDef973:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_anonFunctionDef977:new org.antlr.runtime.BitSet([0,
0,3389259776,7]),FOLLOW_defaultValue_in_anonFunctionDef980:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef985:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef987:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_anonFunctionDef994:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_anonFunctionDef996:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_anonFunctionDef998:new org.antlr.runtime.BitSet([0,0,3389259776,
7]),FOLLOW_defaultValue_in_anonFunctionDef1000:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_anonFunctionDef1007:new org.antlr.runtime.BitSet([0,2420114497,3406037171,131079]),FOLLOW_NEWLINE_in_anonFunctionDef1012:new org.antlr.runtime.BitSet([0,3493856321,3406037171,131079]),FOLLOW_innerBlock_in_anonFunctionDef1015:new org.antlr.runtime.BitSet([0,1073741824]),FOLLOW_ENDBLOCK_in_anonFunctionDef1018:new org.antlr.runtime.BitSet([0,268435456]),FOLLOW_FUNCTIONSTATEMENT_in_anonFunctionDef1020:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_expression_in_anonFunctionDef1025:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assignment1067:new org.antlr.runtime.BitSet([0,0,0,131072]),FOLLOW_113_in_assignment1069:new org.antlr.runtime.BitSet([0,0,32,262144]),FOLLOW_IDENT_in_assignment1072:new org.antlr.runtime.BitSet([0,0,536870976,262144]),FOLLOW_EQUALS_in_assignment1076:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1078:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1083:new org.antlr.runtime.BitSet([0,
0,32,0]),FOLLOW_IDENT_in_assignment1085:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_assignment1092:new org.antlr.runtime.BitSet([0,0,32,0]),FOLLOW_IDENT_in_assignment1094:new org.antlr.runtime.BitSet([0,0,64,0]),FOLLOW_EQUALS_in_assignment1096:new org.antlr.runtime.BitSet([0,0,3389259776,7]),FOLLOW_defaultValue_in_assignment1098:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_114_in_assignment1105:new org.antlr.runtime.BitSet([0,0,0,524288]),FOLLOW_115_in_assignment1107:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1109:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_assignment1137:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1141:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_COMMA_in_assignment1145:new org.antlr.runtime.BitSet([0,0,160,0]),FOLLOW_PRIMITIVE_in_assignment1148:new org.antlr.runtime.BitSet([0,0,536870912,524288]),FOLLOW_assigned_in_assignment1152:new org.antlr.runtime.BitSet([0,
0,536870912,524288]),FOLLOW_115_in_assignment1158:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_assignment1160:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_assigned1186:new org.antlr.runtime.BitSet([2,0,167772160,1048576]),FOLLOW_selector_in_assigned1188:new org.antlr.runtime.BitSet([2,0]),FOLLOW_booleanXORExpression_in_logicalExpression1214:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_OR_in_logicalExpression1217:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_logicalExpression1220:new org.antlr.runtime.BitSet([2,0,256,0]),FOLLOW_booleanAndExpression_in_booleanXORExpression1250:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_XOR_in_booleanXORExpression1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanAndExpression_in_booleanXORExpression1256:new org.antlr.runtime.BitSet([2,0,512,0]),FOLLOW_equalityExpression_in_booleanAndExpression1285:new org.antlr.runtime.BitSet([2,
0,2048,0]),FOLLOW_AND_in_booleanAndExpression1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_booleanAndExpression1291:new org.antlr.runtime.BitSet([2,0,2048,0]),FOLLOW_relationalExpression_in_equalityExpression1322:new org.antlr.runtime.BitSet([2,0,4160,0]),FOLLOW_set_in_equalityExpression1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_equalityExpression1332:new org.antlr.runtime.BitSet([2,0,4160,0]),
FOLLOW_additiveExpression_in_relationalExpression1374:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_set_in_relationalExpression1378:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_relationalExpression1389:new org.antlr.runtime.BitSet([2,0,122880,0]),FOLLOW_multiplicativeExpression_in_additiveExpression1432:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_set_in_additiveExpression1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),
FOLLOW_multiplicativeExpression_in_additiveExpression1443:new org.antlr.runtime.BitSet([2,0,393216,0]),FOLLOW_arrayExpression_in_multiplicativeExpression1473:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_set_in_multiplicativeExpression1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_multiplicativeExpression1486:new org.antlr.runtime.BitSet([2,0,3670016,0]),FOLLOW_negationExpression_in_arrayExpression1532:new org.antlr.runtime.BitSet([2,0,4194304,
0]),FOLLOW_COLON_in_arrayExpression1538:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1542:new org.antlr.runtime.BitSet([2,0,4194304,0]),FOLLOW_COLON_in_arrayExpression1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_arrayExpression1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negationExpression1580:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_powerExpression_in_negationExpression1582:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_powerExpression_in_negationExpression1596:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unaryExpression_in_powerExpression1607:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_powerExpression1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_powerExpression1612:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_unaryExpression_in_unaryOrNegate1639:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_unaryOrNegate1645:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_unaryExpression_in_unaryOrNegate1647:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NOT_in_unaryExpression1675:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_innerPrimaryExpression_in_unaryExpression1678:new org.antlr.runtime.BitSet([2,0]),FOLLOW_innerPrimaryExpression_in_unaryExpression1687:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selectionExpression_in_innerPrimaryExpression1718:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primaryExpression_in_selectionExpression1738:new org.antlr.runtime.BitSet([2,
0,167772160,1179648]),FOLLOW_selector_in_selectionExpression1744:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_selectionExpression1746:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_113_in_funCall1761:new org.antlr.runtime.BitSet([0,268435456,3406037153,393223]),FOLLOW_logicalExpression_in_funCall1765:new org.antlr.runtime.BitSet([0,0,536870912,262144]),FOLLOW_COMMA_in_funCall1768:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_funCall1770:new org.antlr.runtime.BitSet([0,
0,536870912,262144]),FOLLOW_114_in_funCall1777:new org.antlr.runtime.BitSet([2,0]),FOLLOW_113_in_primaryExpression1798:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_logicalExpression_in_primaryExpression1801:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_primaryExpression1803:new org.antlr.runtime.BitSet([2,0]),FOLLOW_value_in_primaryExpression1809:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_value1823:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_value1829:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_string_in_value1835:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_value1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_IDENT_in_value1846:new org.antlr.runtime.BitSet([2,0]),FOLLOW_primitive_in_value1851:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_value1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_anonFunctionDef_in_value1861:new org.antlr.runtime.BitSet([2,0]),FOLLOW_newObject_in_value1866:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWSTATEMENT_in_newObject1876:new org.antlr.runtime.BitSet([0,
0,32,0]),FOLLOW_IDENT_in_newObject1878:new org.antlr.runtime.BitSet([2,0,167772160,1179648]),FOLLOW_funCall_in_newObject1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_negnumber_in_defaultValue1906:new org.antlr.runtime.BitSet([2,0]),FOLLOW_number_in_defaultValue1912:new org.antlr.runtime.BitSet([2,0]),FOLLOW_bool_in_defaultValue1918:new org.antlr.runtime.BitSet([2,0]),FOLLOW_string_in_defaultValue1924:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_defaultValue1930:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_LARR_in_array1944:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_NEWLINE_in_array1946:new org.antlr.runtime.BitSet([0,268435457,3473670305,131079]),FOLLOW_label_in_array1950:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1952:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_COMMA_in_array1956:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array1958:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),
FOLLOW_label_in_array1961:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1963:new org.antlr.runtime.BitSet([0,1,603979776,0]),FOLLOW_NEWLINE_in_array1970:new org.antlr.runtime.BitSet([0,1,67108864,0]),FOLLOW_RARR_in_array1973:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_array1987:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_NEWLINE_in_array1989:new org.antlr.runtime.BitSet([0,268435457,3674996897,131079]),FOLLOW_label_in_array1993:new org.antlr.runtime.BitSet([0,
1,805306368,0]),FOLLOW_NEWLINE_in_array1995:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_COMMA_in_array1998:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_NEWLINE_in_array2000:new org.antlr.runtime.BitSet([0,268435457,3406561441,131079]),FOLLOW_label_in_array2003:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2005:new org.antlr.runtime.BitSet([0,1,805306368,0]),FOLLOW_NEWLINE_in_array2012:new org.antlr.runtime.BitSet([0,1,268435456,0]),FOLLOW_RCURL_in_array2015:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_minarray_in_selector2036:new org.antlr.runtime.BitSet([2,0]),FOLLOW_dotselector_in_selector2040:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LARR_in_minarray2067:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2072:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_MULT_in_minarray2074:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_COMMA_in_minarray2078:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2082:new org.antlr.runtime.BitSet([0,
0,603979776,0]),FOLLOW_MULT_in_minarray2084:new org.antlr.runtime.BitSet([0,0,603979776,0]),FOLLOW_RARR_in_minarray2091:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_minarray2097:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),FOLLOW_logicalExpression_in_minarray2102:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2104:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_COMMA_in_minarray2108:new org.antlr.runtime.BitSet([0,268435456,3406561441,131079]),
FOLLOW_logicalExpression_in_minarray2112:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_MULT_in_minarray2114:new org.antlr.runtime.BitSet([0,0,805306368,0]),FOLLOW_RCURL_in_minarray2121:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_dotselector2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_dotselector2135:new org.antlr.runtime.BitSet([2,0,0,1048576]),FOLLOW_set_in_arrayName0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_arrayName_in_label2173:new org.antlr.runtime.BitSet([0,
1,4194304,0]),FOLLOW_NEWLINE_in_label2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_label2178:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_NEWLINE_in_label2182:new org.antlr.runtime.BitSet([0,268435457,3406037153,131079]),FOLLOW_logicalExpression_in_label2185:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_number0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_MINUS_in_negnumber2261:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_number_in_negnumber2263:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_set_in_bool0:new org.antlr.runtime.BitSet([2,0]),FOLLOW_LCURL_in_material2415:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_additiveExpression_in_material2417:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_material2421:new org.antlr.runtime.BitSet([0,0,268435456,0]),FOLLOW_RCURL_in_material2423:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2460:new org.antlr.runtime.BitSet([2,
0,0,8]),FOLLOW_PER_in_unitMultiplicativeExpression2464:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitInnerMultiplicativeExpression_in_unitMultiplicativeExpression2467:new org.antlr.runtime.BitSet([2,0,0,8]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2483:new org.antlr.runtime.BitSet([2,0,1572864,0]),FOLLOW_set_in_unitInnerMultiplicativeExpression2487:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitClump_in_unitInnerMultiplicativeExpression2494:new org.antlr.runtime.BitSet([2,
0,1572864,0]),FOLLOW_INTEGER_in_unitClump2510:new org.antlr.runtime.BitSet([0,0,1048576,0]),FOLLOW_DIV_in_unitClump2512:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitPowerExpression_in_unitClump2515:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2517:new org.antlr.runtime.BitSet([2,0,0,32]),FOLLOW_SQUARED_in_unitClump2520:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unitPowerExpression_in_unitClump2543:new org.antlr.runtime.BitSet([2,0,0,48]),FOLLOW_CUBED_in_unitClump2545:new org.antlr.runtime.BitSet([2,
0,0,32]),FOLLOW_SQUARED_in_unitClump2548:new org.antlr.runtime.BitSet([2,0]),FOLLOW_unit_in_unitPowerExpression2610:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_POW_in_unitPowerExpression2614:new org.antlr.runtime.BitSet([0,0,2147745792,1]),FOLLOW_MINUS_in_unitPowerExpression2617:new org.antlr.runtime.BitSet([0,0,2147483648,1]),FOLLOW_set_in_unitPowerExpression2620:new org.antlr.runtime.BitSet([2,0,8388608,0]),FOLLOW_IDENT_in_unit2638:new org.antlr.runtime.BitSet([2,0,32,0]),FOLLOW_IDENT_in_unit2641:new org.antlr.runtime.BitSet([2,
0,32,0]),FOLLOW_113_in_unit2658:new org.antlr.runtime.BitSet([0,0,2147483680,131072]),FOLLOW_unitMultiplicativeExpression_in_unit2660:new org.antlr.runtime.BitSet([0,0,0,262144]),FOLLOW_114_in_unit2662:new org.antlr.runtime.BitSet([2,0]),FOLLOW_PRIMITIVE_in_primitive2731:new org.antlr.runtime.BitSet([2,0]),FOLLOW_STRING_in_string3200:new org.antlr.runtime.BitSet([2,0]),FOLLOW_assignment_in_synpred5_Formula508:new org.antlr.runtime.BitSet([2,0]),FOLLOW_logicalExpression_in_synpred6_Formula514:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_forLoop_in_synpred8_Formula526:new org.antlr.runtime.BitSet([2,0]),FOLLOW_forInLoop_in_synpred9_Formula532:new org.antlr.runtime.BitSet([2,0]),FOLLOW_functionDef_in_synpred11_Formula544:new org.antlr.runtime.BitSet([2,0]),FOLLOW_OR_in_synpred47_Formula1217:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_booleanXORExpression_in_synpred47_Formula1220:new org.antlr.runtime.BitSet([2,0]),FOLLOW_XOR_in_synpred48_Formula1253:new org.antlr.runtime.BitSet([0,268435456,3406037153,
131079]),FOLLOW_booleanAndExpression_in_synpred48_Formula1256:new org.antlr.runtime.BitSet([2,0]),FOLLOW_AND_in_synpred49_Formula1288:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_equalityExpression_in_synpred49_Formula1291:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred51_Formula1325:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_relationalExpression_in_synpred51_Formula1332:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred55_Formula1378:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_additiveExpression_in_synpred55_Formula1389:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred57_Formula1436:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_multiplicativeExpression_in_synpred57_Formula1443:new org.antlr.runtime.BitSet([2,0]),FOLLOW_set_in_synpred60_Formula1477:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_arrayExpression_in_synpred60_Formula1486:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred61_Formula1538:new org.antlr.runtime.BitSet([0,
268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred61_Formula1542:new org.antlr.runtime.BitSet([2,0]),FOLLOW_COLON_in_synpred62_Formula1551:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_negationExpression_in_synpred62_Formula1555:new org.antlr.runtime.BitSet([2,0]),FOLLOW_POW_in_synpred64_Formula1610:new org.antlr.runtime.BitSet([0,268435456,3406037153,131079]),FOLLOW_unaryOrNegate_in_synpred64_Formula1612:new org.antlr.runtime.BitSet([2,0]),FOLLOW_selector_in_synpred68_Formula1744:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_funCall_in_synpred68_Formula1746:new org.antlr.runtime.BitSet([2,0]),FOLLOW_material_in_synpred75_Formula1841:new org.antlr.runtime.BitSet([2,0]),FOLLOW_array_in_synpred78_Formula1856:new org.antlr.runtime.BitSet([2,0]),FOLLOW_funCall_in_synpred80_Formula1880:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred85_Formula1946:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred86_Formula1952:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred87_Formula1958:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_NEWLINE_in_synpred88_Formula1963:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred93_Formula1989:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred94_Formula1995:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred95_Formula2000:new org.antlr.runtime.BitSet([2,0]),FOLLOW_NEWLINE_in_synpred96_Formula2005:new org.antlr.runtime.BitSet([2,0]),FOLLOW_116_in_synpred108_Formula2133:new org.antlr.runtime.BitSet([0,0,1074266144,0]),FOLLOW_arrayName_in_synpred108_Formula2135:new org.antlr.runtime.BitSet([2,
0]),FOLLOW_arrayName_in_synpred112_Formula2173:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_NEWLINE_in_synpred112_Formula2175:new org.antlr.runtime.BitSet([0,1,4194304,0]),FOLLOW_COLON_in_synpred112_Formula2178:new org.antlr.runtime.BitSet([2,0])})})();function RandList(){this.vals=[]}RandList.prototype.get=function(a){if(a>this.vals.length-1)for(var b=this.vals.length;b<=a;b++)this.vals.push(Math.random());return this.vals[a]};function getRandPos(){return void 0===window.timeStep?0:Math.floor(time.value/timeStep.value)}
function Rand(a,b){if(null!=a)return Rand()*(b-a)+(0+a);if(isUndefined(window.simulate)||1==simulate.RKOrder)return Math.random();var c=getRandPos();c!=simulate.lastRandPos&&(simulate.randLoc=-1,simulate.lastRandPos=c);for(;simulate.previousRandLists.length<=c;)simulate.previousRandLists.push(new RandList);simulate.randLoc+=1;return simulate.previousRandLists[c].get(simulate.randLoc)}
function RandNormal(a,b){null==a&&(a=0);null==b&&(b=1);return Math.sqrt(-2*Math.log(1-Rand()))*Math.cos(6.283186*Rand())*b+(0+a)}function RandExp(a){null==a&&(a=1);return-(1/a)*Math.log(Rand())}function RandLognormal(a,b){var c=Math.log(a)-0.5*Math.log(1+Math.pow(b/a,2)),d=Math.sqrt(Math.log(1+Math.pow(b/a,2)));return Math.exp(RandNormal(c,d))}function RandBinomial(a,b){for(var c=0,d=1;d<=a;d++)Rand()<=b&&(c+=1);return c}
function RandNegativeBinomial(a,b){for(var c=0,d=0;d<a;)Rand()<=b&&(d+=1),c+=1;return c}function RandPoisson(a){for(var a=Math.exp(-a),b=0,c=1;!(b+=1,c*=Rand(),!(c>a)););return b-1}function RandGamma(a,b){for(var c=1,d=1;d<=a;d++)c*=Rand();return-b*Math.log(c)}function RandBeta(a,b){var c=RandGamma(a,1),d=RandGamma(b,1);return c/(c+d)}
function RandTriangular(a,b,c){a=0+a;b=0+b;c=0+c;if(a==b)throw"MSG: Maximum can't equal the minimum for the triangular distribution.";if(c<a||c>b)throw"MSG: The peak must be within the maximum and minimum for the triangular distribution.";var d=(c-a)/(b-a),e=Rand();return e<d?a+Math.sqrt(e*(b-a)*(c-a)):b-Math.sqrt((1-e)*(b-a)*(b-c))}
function RandDist(a,b){if(a.length!=b.length)throw"MSG: The lengths of the 'x' and 'y' vectors must be the same.";if(2>a.length)throw"MSG: There must be at least 2 points in a distribution to generate a random number.";for(var c=0,d=0;d<a.length-1;d++)c+=(a[d+1]-a[d])*(b[d+1]+b[d])/2;if(0==c)throw"MSG: The area of the distribution cannot be 0.";for(var e=c*Rand(),d=c=0;d<a.length-1;d++){var f=(a[d+1]-a[d])*(b[d+1]+b[d])/2;if(e>c&&e<c+f)return c=e-c,e=(b[d+1]-b[d])/(a[d+1]-a[d]),c=0==e?c/b[d]:(-b[d]+
Math.sqrt(Math.pow(b[d],2)+2*e*c))/e,a[d]+c;c+=f}};(function(a,b,c,d,e,f,g){function h(a){var b,d,e=this,f=a.length,g=0,h=e.i=e.j=e.m=0;e.S=[];e.c=[];for(f||(a=[f++]);g<c;)e.S[g]=g++;for(g=0;g<c;g++)b=e.S[g],h=h+b+a[g%f]&c-1,d=e.S[h],e.S[g]=d,e.S[h]=b;e.g=function(a){var b=e.S,d=e.i+1&c-1,f=b[d],g=e.j+f&c-1,h=b[g];b[d]=h;b[g]=f;for(var k=b[f+h&c-1];--a;)d=d+1&c-1,f=b[d],g=g+f&c-1,h=b[g],b[d]=h,b[g]=f,k=k*c+b[f+h&c-1];e.i=d;e.j=g;return k};e.g(c)}function k(a,b,c,d,e){c=[];e=typeof a;if(b&&"object"==e)for(d in a)if(5>d.indexOf("S"))try{c.push(k(a[d],
b-1))}catch(f){}return c.length?c:a+("string"!=e?"\x00":"")}function l(a,b,d,e){a+="";for(e=d=0;e<a.length;e++){var f=b,g=e&c-1,h=(d^=19*b[e&c-1])+a.charCodeAt(e);f[g]=h&c-1}a="";for(e in b)a+=String.fromCharCode(b[e]);return a}b.seedrandom=function(m,n){var o=[],q,m=l(k(n?[m,a]:arguments.length?m:[(new Date).getTime(),a,window],3),o);q=new h(o);l(q.S,a);b.random=function(){for(var a=q.g(d),b=g,h=0;a<e;)a=(a+h)*c,b*=c,h=q.g(1);for(;a>=f;)a/=2,b/=2,h>>>=1;return(a+h)/b};return m};g=b.pow(c,d);e=b.pow(2,
e);f=2*e;l(b.random(),a)})([],Math,256,6,52);if(!sn){var sn=SchemeNumber,fn=sn.fn,ns=fn["number->string"];sn.raise=function(a,b){if("division by exact zero"==b)throw"MSG: You cannot divide by 0.";throw"BigNum Error: "+b;}}var varBank={},functionBank=varBank,functionLoaders=[];
function bootCalc(){functionBank=varBank={};varBank["-parent"]=null;varBank.e=new Material(2.718281828459045);varBank.pi=new Material(3.141592653589793);varBank.phi=new Material(1.61803399);for(var a=0;a<functionLoaders.length;a++)functionLoaders[a]();varBank.stringbase=StringBase;varBank.vectorbase=VectorBase;window.ObjectBase&&(varBank.objectbase=ObjectBase);window.AgentBase&&(varBank.agentbase=AgentBase)}Agent||(Agent=function(){});Agents||(Agents=function(){});
var PrimitiveStore=function(a,b){this.primitive=a;this.type=b};Boolean.prototype.toNum=function(){return this.valueOf()};String.prototype.toNum=function(){return this.valueOf()};Number.prototype.toNum=function(){return this.valueOf()};Function.prototype.toNum=function(){return this([])};function UserFunction(){}UserFunction.prototype.toNum=function(){return this.fn?this.fn([]):this([])};
var StringObject={},StringBase,VectorObject={},VectorBase={},Vector=function(a,b,c){this.parent=c?c:VectorBase;this.items=a;this.names=b;this.namesLC=void 0;if(b){this.namesLC=[];for(a=0;a<b.length;a++)b[a]?this.namesLC.push(b[a].toLowerCase()):this.namesLC.push(void 0)}};Vector.prototype.toNum=function(){if(this.isNum)return this;for(var a=this.fullClone(),b=0;b<a.items.length;b++)a.items[b]=a.items[b].toNum();a.isNum=!0;return a};
Vector.prototype.toString=function(){for(var a=[],b=0;b<this.items.length;b++){var c=prepareDisplay(this.items[b].toNum().toString());this.names&&this.names[b]&&(c=this.names[b]+": "+c);a.push(c)}return"{"+a.join(", ")+"}"};Vector.prototype.length=function(){return this.items.length};Vector.prototype.cloneCombine=function(a,b,c,d){return this.fullClone().combine(a,b,c,d)};
Vector.prototype.combine=function(a,b,c,d){if(a instanceof Vector&&this.length()!=a.length()&&!this.names&&!a.names)throw"MSG: Vectors must have equal length when combined.";if(a instanceof Vector&&this.names&&a.names){if(!d&&a.depth()>this.depth())return a.combine(this,b,!c);if(!this.keysMatch(a.namesLC)){if(this.items[0]instanceof Vector){for(d=0;d<this.items.length;d++)this.items[d].combine(a,b,c,!0);return this}throw"MSG: Keys do not match for vector operation.";}}for(d=0;d<this.length();d++){var e;
if(a instanceof Vector)if(this.names&&a.names){e=a.namesLC.indexOf(this.namesLC[d]);"*"==this.names&&(e=-2);if(isUndefined(e)||-1==e)e=a.names.indexOf("*");if(isUndefined(e)||-1==e)throw"MSG: Mismatched keys for vector operation.";e=-2==e?void 0:a.items[e]}else e=a.items[d];else e=a;isDefined(e)&&(this.items[d]=c?b(e,this.items[d]):b(this.items[d],e))}if(this.names&&-1<this.names.indexOf("*")&&a instanceof Vector&&a.names){e=this.items[this.names.indexOf("*")];for(d=0;d<a.names.length;d++)if(a.names[d]&&
(-1==this.namesLC.indexOf(a.namesLC[d])||"*"==a.names))c?this.items.push(b(a.items[d],e)):this.items.push(b(e,a.items[d])),this.names.push(a.names[d]),this.namesLC.push(a.namesLC[d])}return this};
Vector.prototype.collapseDimensions=function(a){if(a instanceof Vector){if(this.depth()==a.depth())return this;for(var b=[],c=this,d=0;d<this.depth();d++)a instanceof Vector?keysMatch(c.namesLC,a.namesLC)?(b.push("*"),c=c.items[0],a=a.items[0]):(b.push(function(a){return functionBank.sum(a[0].items)}),c=c.items[0]):(b.push(function(a){return functionBank.sum(a[0].items)}),c=c.items[0]);if(a.items)throw"MSG: Keys do not match for vector collapsing.";return selectFromMatrix(this,b)}return functionBank.sum([functionBank.flatten([this])])};
function keysMatch(a,b){if(-1==b.indexOf("*"))for(var c=0;c<a.length;c++)if("*"!=a[c]&&(isUndefined(a[c])||-1==b.indexOf(a[c])))return!1;if(-1==a.indexOf("*"))for(c=0;c<b.length;c++)if("*"!=b[c]&&(isUndefined(b[c])||-1==a.indexOf(b[c])))return!1;return!0}Vector.prototype.depth=function(){return 0==this.items.length||!(this.items[0]instanceof Vector)?1:this.items[0].depth()+1};Vector.prototype.keysMatch=function(a){return this.names?keysMatch(this.namesLC,a):!1};Vector.prototype.cloneApply=function(a){return this.fullClone().apply(a)};
Vector.prototype.apply=function(a){for(var b=0;b<this.items.length;b++)this.items[b]=a(this.items[b]);return this};Vector.prototype.stackApply=function(a){return 1==this.depth()?a(this):this.stack().recurseApply(a)};
Vector.prototype.stack=function(a){for(var b=[],a=a||[0],c=this.select(a),d=1;d<this.items.length;d++){a[0]=d;var e=this.select(a);if(c instanceof Vector&&e instanceof Vector){if(c.names&&!e.names||e.names&&!c.names)throw"MSG: Mismatched keys for vector collapsing.";if(c.items.length!=e.items.length)throw"MSG: Vectors of unequal size.";}else if(!(c instanceof Vector||e instanceof Vector))throw"MSG: Mismatched keys for vector collapsing.";}a[0]=0;a.push(0);for(d=0;d<c.items.length;d++)if(a[a.length-
1]=c.names?c.namesLC[d]:d,c.items[d]instanceof Vector)b.push(this.stack(a.slice()));else{for(var e=[],f=0;f<this.items.length;f++){var g=a.slice();g[0]=f;g=this.select(g);if(g instanceof Vector)throw"MSG: Number where vector expected in vector collapsing.";e.push(g)}e=new Vector(e);e.terminateApply=!0;b.push(e)}return new Vector(b,c.names?c.names.slice():void 0)};
Vector.prototype.select=function(a){for(var b=this,c=0;c<a.length;c++){if(!b.items)throw"MSG: Number where vector expected in vector collapsing.";if(a[c]instanceof String||"string"==typeof a[c]){var d=b.namesLC.indexOf(a[c].valueOf());if(-1==d)throw"MSG: Mismatched keys for vector collapsing.";b=b.items[d]}else b=b.items[a[c]]}return b};
Vector.prototype.recurseApply=function(a){for(var b=0;b<this.items.length;b++)this.items[b]=this.items[b]instanceof Vector&&!this.items[b].terminateApply?this.items[b].recurseApply(a):a(this.items[b]);return this};Vector.prototype.fullNames=function(){if(this.items[0]instanceof Vector)for(var a=this.items[0].fullNames(),b=[],c=0;c<this.names.length;c++)for(var d=0;d<a.length;d++)b.push([this.names[c]].concat(a[d]));else{b=[];for(c=0;c<this.names.length;c++)b.push([this.names[c]])}return b};
Vector.prototype.clone=function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b]instanceof Vector?a.push(this.items[b].clone()):a.push(this.items[b]);return new Vector(a,this.names?this.names.slice():void 0,this.parent)};Vector.prototype.fullClone=function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b].fullClone?a.push(this.items[b].fullClone()):a.push(this.items[b]);return new Vector(a,this.names?this.names.slice():void 0,this.parent)};
Vector.prototype.equals=function(a){if(this.length()!=a.length())return!1;for(var b=0;b<this.items.length;b++)if(!strictEquals(this.items[b],a.items[b]))return!1;return!0};Primitive||(Primitive=function(a){this.v=a;this.vector=new Vector([],[],VectorBase)},Primitive.prototype.value=function(){return this.v.fullClone()},Primitive.prototype.setValue=function(a){return this.v=a},Primitive.prototype.toNum=function(){return this.v.fullClone()},Primitive.prototype.toString=function(){return"Primitive Reference"});
function strictEquals(a,b){if(a instanceof Agent||b instanceof Agent){if(a instanceof Agent&&b instanceof Agent&&a.instanceId==b.instanceId)return!0}else if(a instanceof Vector||b instanceof Vector){if(a instanceof Vector&&b instanceof Vector&&a.equals(b))return!0}else if(eq(a,b))return!0;return!1}
function createTree(a){var a=new org.antlr.runtime.ANTLRStringStream(a.replace(/\\n/g,"\n")),a=new FormulaLexer(a),a=new org.antlr.runtime.CommonTokenStream(a),a=new FormulaParser(a),b=a.lines(),a=convertToObject(b.tree,a);isLocal();return a}function trimTree(a,b){return trimNode(a,b)}function evaluateTree(a,b){evaluatingLine=void 0;try{return evaluateNode(a,b)}catch(c){if(c.returnVal)return c.data;throw c;}}
var PB={test:new Primitive(new Material(3)),a:new Primitive(new Material(1)),b:new Primitive(new Material(2)),c:new Primitive(new Material(3))};
function evaluate(a,b){PB["test vector"]=new Primitive(new Vector([new Material(1),new Material(2),new Material(3)],[],VectorBase));PB["test vector 2"]=new Primitive(new Vector([new Material(1.2),new Material(2.9),new Material(3)],[],VectorBase));var c=trimTree(createTree(a),PB),d;try{d=evaluateTree(c,varBank),b||(d=d.toNum())}catch(e){if("PLOT"==e){d={isPlot:!0,data:[]};var f={};f["-parent"]=varBank;for(var g=-100;100>=g;g+=1)f.x=new Material(g/10),d.data.push([g/10,0+evaluateTree(c,f).value]);return d}throw e;
}d instanceof Material&&(d.value.toPrecision&&(d.value=0===d.value?"0":d.value.toPrecision(21)),"."==d.value.substr(d.value.length-1,1)&&(d.value=d.value.substring(0,d.value.length-1)),d.value=d.value.replace(/\.?\+\.?/g,"+"),d.value=d.value.replace(/\.?\-\.?/g,"-"),d.value=d.value.replace(/\.i/g,"i"),d.value=d.value.replace(/(\d)i/g,"$1*<i>i</i>"),d.value=d.value.replace(/\.e/g,"e"),d.value=d.value.replace(/e\+/g,"e"),"+inf.0"==d.value?d.value="Infinity":"-inf.0"==d.value&&(d.value="-Infinity"));
return d}var TreeNode=function(a,b,c){this.origText=a;this.text=a.toLowerCase();this.typeName=b;this.line=c;this.children=[]};function convertToObject(a,b){var c=a.getToken(),c=new TreeNode(c.getText(),b.getTokenNames()[c.getType()],c.line);if(0<a.getChildCount())for(var d=a.getChildren(),e=0;e<d.length;e++)c.children.push(convertToObject(d[e],b)),!c.line&&c.children[c.children.length-1].line&&(c.line=c.children[c.children.length-1].line);return c}var funcEvalMap={},evaluatingLine=null;
funcEvalMap.LINES=function(a,b){if(0==a.children.length)return new Material(0);for(var c,d=0;d<a.children.length;d++){if("return"==a.children[d].text)throw{returnVal:!0,data:evaluateNode(a.children[d].children[0],b)};c=evaluateNode(a.children[d],b)}return c};funcEvalMap.NEGATE=function(a,b){return negate(evaluateNode(a.children[0],b).toNum())};
function negate(a){if(a instanceof Vector)return a.cloneApply(negate);if("boolean"==typeof a)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";return new Material(fn["-"](a.value),a.units)}funcEvalMap.AND=function(a,b){return funAnd(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function funAnd(a,b){return a instanceof Vector?a.cloneCombine(b,funAnd,!1):b instanceof Vector?b.cloneCombine(a,funAnd,!0):trueValue(a)&&trueValue(b)}funcEvalMap.OR=function(a,b){return funOr(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function funOr(a,b){return a instanceof Vector?a.cloneCombine(b,funOr,!1):b instanceof Vector?b.cloneCombine(a,funOr,!0):trueValue(a)||trueValue(b)}
funcEvalMap.XOR=function(a,b){return funXor(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function funXor(a,b){return a instanceof Vector?a.cloneCombine(b,funXor,!1):b instanceof Vector?b.cloneCombine(a,funXor,!0):(trueValue(a)||trueValue(b))&&!(trueValue(a)&&trueValue(b))}funcEvalMap.NOT=function(a,b){return fNot(evaluateNode(a.children[0],b).toNum())};function fNot(a){return a instanceof Vector?a.cloneApply(fNot):!trueValue(a)}
funcEvalMap.NOTEQUALS=function(a,b){return neq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function neq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)!=trueValue(b);if((a instanceof String||"string"==typeof a)&&!(b instanceof Vector)||(b instanceof String||"string"==typeof b)&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)!=(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.cloneCombine(b,neq,!1);if(b instanceof Vector)return b.cloneCombine(a,neq,!0);if(!(a instanceof Material)||!(b instanceof
Material))return a!=b;if(a.units!==b.units){var c=convertUnits(b.units,a.units);if(0===c)return!0;b.value=fn["*"](b.value,c);b.units=a.units}return!fn["="](a.value,b.value)}funcEvalMap.EQUALS=function(a,b){return eq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function eq(a,b){if("boolean"==typeof a&&!(b instanceof Vector)||"boolean"==typeof b&&!(a instanceof Vector))return trueValue(a)==trueValue(b);if(("string"==typeof a||a instanceof String)&&!(b instanceof Vector)||("string"==typeof b||b instanceof String)&&!(a instanceof Vector))return(a.toLowerCase?a.toLowerCase():a)==(b.toLowerCase?b.toLowerCase():b);if(a instanceof Vector)return a.cloneCombine(b,eq,!1);if(b instanceof Vector)return b.cloneCombine(a,eq,!0);if(!(a instanceof Material)||!(b instanceof
Material))return a==b;if(a.units!==b.units){var c=convertUnits(b.units,a.units);if(0===c)return!1;b.value=fn["*"](b.value,c);b.units=a.units}return fn["="](a.value,b.value)}function comparisonValid(a,b){if(a instanceof String||"string"==typeof a||b instanceof String||"string"==typeof b)throw"MSG: Cannot use Strings in logical inequality comparisons.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot use Agents in logical inequality comparisons.";}
funcEvalMap.LT=function(a,b){return lessThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function lessThan(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,lessThan,!1);if(b instanceof Vector)return b.cloneCombine(a,lessThan,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn["<"](a.value,b.value)}
funcEvalMap.LTEQ=function(a,b){return lessThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function lessThanEq(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,lessThanEq,!1);if(b instanceof Vector)return b.cloneCombine(a,lessThanEq,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn["<="](a.value,b.value)}
funcEvalMap.GT=function(a,b){return greaterThan(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function greaterThan(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,greaterThan,!1);if(b instanceof Vector)return b.cloneCombine(a,greaterThan,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn[">"](a.value,b.value)}
funcEvalMap.GTEQ=function(a,b){return greaterThanEq(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};function greaterThanEq(a,b){comparisonValid(a,b);if(a instanceof Vector)return a.cloneCombine(b,greaterThanEq,!1);if(b instanceof Vector)return b.cloneCombine(a,greaterThanEq,!0);if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"comparison"):(b.value=fn["*"](b.value,c),b.units=a.units)}return fn[">="](a.value,b.value)}
funcEvalMap.PLUS=function(a,b){return plus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function plus(a,b){if(a instanceof Vector)return a.cloneCombine(b,plus,!1);if(b instanceof Vector)return b.cloneCombine(a,plus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if("string"==typeof a||a instanceof String||"string"==typeof b||b instanceof String){var c=new String(a.toString()+b.toString());c.parent=StringBase;return c}a.units!==b.units&&(c=convertUnits(b.units,
a.units),0===c?unitAlert(a.units,b.units,"addition"):(b.value=fn["*"](b.value,c),b.units=a.units));return new Material(fn["+"](a.value,b.value),b.units)}funcEvalMap.MINUS=function(a,b){return minus(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function minus(a,b){if(a instanceof Vector)return a.cloneCombine(b,minus,!1);if(b instanceof Vector)return b.cloneCombine(a,minus,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(a.units!==b.units){var c=convertUnits(b.units,a.units);0===c?unitAlert(a.units,b.units,"subtraction"):(b.value=fn["*"](b.value,c),b.units=a.units)}return new Material(fn["-"](a.value,b.value),
b.units)}funcEvalMap.MULT=function(a,b){return mult(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function mult(a,b){if(a instanceof Vector)return a.cloneCombine(b,mult,!1);if(b instanceof Vector)return b.cloneCombine(a,mult,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=fn["*"](a.value,b.value);return a.units&&b.units?(a.units.addBase(),b.units.addBase(),new Material(fn["*"](fn["*"](a.units.toBase,c),b.units.toBase),a.units.multiply(b.units,1))):a.units?
new Material(c,a.units):b.units?new Material(c,b.units):new Material(c)}funcEvalMap.DIV=function(a,b){return div(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function div(a,b){if(a instanceof Vector)return a.cloneCombine(b,div,!1);if(b instanceof Vector)return b.cloneCombine(a,div,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=fn["/"](a.value,b.value);return a.units&&b.units?(a.units.addBase(),b.units.addBase(),new Material(fn["/"](fn["*"](a.units.toBase,c),b.units.toBase),a.units.multiply(b.units,-1))):a.units?
new Material(c,a.units):b.units?new Material(c,b.units.power(-1)):new Material(c)}funcEvalMap.POWER=function(a,b){if(1==a.children.length)return evaluateNode(a.children[0],b);for(var c=evaluateNode(a.children[a.children.length-1],b).toNum(),d=a.children.length-1;0<d;d--){var e=evaluateNode(a.children[d-1],b).toNum();if(c instanceof Vector||!c.units)c=power(e,c);else throw"MSG: Exponents may not have units.";}return c};
function power(a,b){if(a instanceof Vector)return a.cloneCombine(b,power,!1);if(b instanceof Vector)return b.cloneCombine(a,power,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";var c=a.value;"number"==typeof c&&(c=sn("#e"+c));return new Material(fn.expt(c,b.value),a.units?a.units.power(b.value):void 0)}
funcEvalMap.MOD=function(a,b){return doMod(evaluateNode(a.children[0],b).toNum(),evaluateNode(a.children[1],b).toNum())};
function doMod(a,b){if(a instanceof Vector)return a.cloneCombine(b,doMod,!1);if(b instanceof Vector)return b.cloneCombine(a,doMod,!0);if("boolean"==typeof a||"boolean"==typeof b)throw"MSG: Cannot convert Booleans to Numbers.";if(a instanceof Agent||b instanceof Agent)throw"MSG: Cannot convert Agents to Numbers.";if(b.units)throw'MSG: The right hand side of "mod" may not have units.';return new Material(fn.mod(a.value,b.value),a.units)}
funcEvalMap.IDENT=function(a,b){for(var c=a.text;!(c in b);)if(b["-parent"])b=b["-parent"];else{if("x"==c&&window.isCalc)throw"PLOT";if("i"==c)return new Material(sn("i"));throw'MSG: The variable or function "'+a.origText+'" does not exist.';}c=b[c];return c.fullClone&&!(c instanceof Vector)?c.fullClone():c};
funcEvalMap.NEW=function(a,b){var c=evaluateNode(a.children[0],b);if(c instanceof Vector){var d=new Vector([],void 0,c),e,f;try{f=selectFromVector(c,"constructor"),e=f.data}catch(g){}if(e)2==a.children.length?callFunction(e,a.children[1],b,d,f.parent):callFunction(e,{children:[]},b,d,f.parent);else if(2==a.children.length&&0<a.children[1].children.length)throw"MSG: No constructor available for '"+a.children[0].text+"'.";return d}throw"MSG: 'New' can only be use to create instances of Vectors.";};
funcEvalMap.INNER=function(a,b){var c=evaluateNode(a.children[0],b);if(2==a.children.length&"FUNCALL"==a.children[1].typeName)return callFunction(c,a.children[1],b);var d,e;b.self&&"parent"==a.children[0].text?d=b.self:c instanceof Function||c instanceof UserFunction||(d=c);for(var f=1;f<a.children.length;f++)if("SELECTOR"==a.children[f].typeName)if("DOTSELECTOR"==a.children[f].children[0].typeName)for(var g=0;g<a.children[f].children[0].children.length;g++){var h=[];a.children[f].children[0].children[g].text?
h.push(a.children[f].children[0].children[g].text):h.push(a.children[f].children[0].children[g].valueOf());try{c=selectFromMatrix(c,h)}catch(k){if(c instanceof Primitive&&!(c instanceof Agent))c=c.toNum(),g--;else throw k;}c instanceof Function||c instanceof UserFunction||(e=d=c)}else{c instanceof Primitive&&(c=c.toNum(),c instanceof Function||c instanceof UserFunction||(e=d=c));try{c=selectFromMatrix(c,createMatrixSelector(a.children[f],b,0,!0))}catch(l){if(c instanceof Primitive)c=c.toNum(),f--;
else throw l;}c instanceof Function||c instanceof UserFunction||(e=d=c)}else c=callFunction(c,a.children[f],b,d,e),c instanceof Function||c instanceof UserFunction||(e=d=c);return c};
function callFunction(a,b,c,d,e){if("function"!=typeof a&&!(a instanceof UserFunction))throw"MSG: Trying to call a non-function.";var f=[],g="";if(b instanceof Array)f=b;else if(b.functionFingerprint||(b.functionFingerprint="FINGERPRINT-"+Math.random()),g=b.functionFingerprint,a.delayEvalParams)for(var h=0;h<b.children.length;h++)f.push({node:b.children[h],scope:c});else for(h=0;h<b.children.length;h++){var k=evaluateNode(b.children[h],c);k.fullClone&&!(k instanceof Vector)&&(k=k.fullClone());f.push(k)}a.fn?
a=a.fn:b.delayEvalParams=a.delayEvalParams;return a(f,g,d,e)}function createMatrixSelector(a,b,c){for(var d=[],c=c||0;c<a.children.length;c++)if("MULT"==a.children[c].typeName)d.push("*");else{var e=evaluateNode(a.children[c],b);"function"==typeof e||e instanceof UserFunction?function(a){d.push(function(b){return b[0].stackApply(function(b){return a([b])})})}("function"==typeof e?e:e.fn):d.push(e.toNum())}return d}
function selectFromMatrix(a,b,c){a instanceof Vector||(a.vector?a=a.vector:a.parent&&(a=new Vector([],[],a.parent)));isUndefined(c)&&a.fullClone&&(a=a.fullClone());for(var a=selectFromVector(a,b.shift(),0==b.length?c:void 0,isDefined(c)),d=[],d=a.collapsed?[a.data]:a.data.items;0<b.length;){for(var e=[],f=b.shift(),g=0;g<d.length;g++){if(!(d[g]instanceof Vector))throw"MSG: No element available for: "+f;var h=selectFromVector(d[g],f,0==b.length?c:void 0);h.collapsed?(c||(d[g].items=[h.data],d[g].names=
["!!BREAKOUT DATA"]),e=e.concat(h.data)):(e=e.concat(h.data.items),c||(d[g].items=h.data.items,d[g].names=h.data.names))}d=e}return doBreakouts(a.data)}function doBreakouts(a){if(!(a instanceof Vector))return a;if(1==a.items.length&&a.names&&"!!BREAKOUT DATA"==a.names[0])return doBreakouts(a.items[0]);for(var b=0;b<a.items.length;b++)a.items[b]=doBreakouts(a.items[b]);return a}
function selectFromVector(a,b,c,d){if("*"==b)return{data:a};if("function"==typeof b)return{data:b([a]),collapsed:!0};if("parent"==b){if(a.parent)return{data:d?a.parent:a.parent.fullClone(),collapsed:!0};throw"MSG: Vector does not have a parent.";}if(b instanceof Vector){for(var d=[],e=a.names?[]:void 0,f=0;f<b.items.length;f++){var g=b.items[f],h=!0;"boolean"==typeof g&&(g?g=new Material(f+1):h=!1);h&&(g=selectElementFromVector(a,g,c),d.push(g.value),e&&e.push(g.name))}return{collapsed:!1,parent:a,
data:new Vector(d,e,a.parent)}}return{collapsed:!0,parent:a,data:selectElementFromVector(a,b,c).value}}
function selectElementFromVector(a,b,c){var d=void 0,e=void 0,f;if(b instanceof String||"string"==typeof b)try{if(isUndefined(c)&&!a.names)throw"MSG: Key '"+b+"' not in vector.";if(a.names){f=-1;for(var g=b.toLowerCase(),e=0;e<a.names.length;e++)if(a.names[e].toLowerCase()===g){f=e;break}if(0>f||isUndefined(f))f=a.names.indexOf("*")}if(0>f||isUndefined(f)){if(isUndefined(c))throw"MSG: Key '"+b+"' not in vector.";f=b}}catch(h){if(a.parent)return selectElementFromVector(a.parent,b,c);throw h;}else f=
parseFloat(b.toNum())-1;if(f instanceof String||"string"==typeof f){if(!a.names){a.names=[];for(e=0;e<a.items.length;e++)a.names.push(void 0)}a.items.push(c);a.names.push(f.valueOf());e=c;d=f}else{if(0>f||f>=a.items.length||0!=f%1)throw"MSG: Index "+(1+f)+" is not in the vector.";isUndefined(c)||(a.items[f]=c);e=a.items[f];a.names&&(d=a.names[f])}return{name:d,value:e}}
funcEvalMap.ARRAY=function(a,b){for(var c=[],d=[],e=!1,f=0;f<a.children.length;f++)c.push(evaluateNode(a.children[f].children[0],b)),1<a.children[f].children.length?(a.children[f].children[1].text?d.push(a.children[f].children[1].origText):d.push(a.children[f].children[1].valueOf()),e=!0):d.push(void 0);return new Vector(c,e?d:void 0)};
funcEvalMap.RANGE=function(a,b){if(1==a.children.length)return evaluateNode(a.children[0],b);var c=[],d=evaluateNode(a.children[0],b).toNum(),e=evaluateNode(a.children[a.children.length-1],b).toNum();if(!(d instanceof Material)||!(e instanceof Material))throw"MSG: Range elements must be numbers.";c.push(d.fullClone());if(d.units!==e.units&&1!=convertUnits(d.units,e.units))throw"MSG: Units on both sides of ':' must be equal.";var f=2==a.children.length?new Material(1,d.units):evaluateNode(a.children[1],
b).toNum();if(!(f instanceof Material))throw"MSG: Range elements must be numbers.";if(!eq(d,e))if(lessThan(d,e))for(d=plus(d,f);lessThanEq(d,e);)c.push(d),d=plus(d,f);else if(greaterThan(d,e)){2==a.children.length&&(f=negate(f));for(d=plus(d,f);greaterThanEq(d,e);)c.push(d),d=plus(d,f)}return new Vector(c)};
function makeFunctionCall(a,b,c,d,e){var f=new UserFunction;f.localScope={};f.localScope.nVars=b.length;for(var g=0;g<b.length;g++)f.localScope[g+=""]=b[g];f.localScope["-parent"]=e;f.defaults=c;f.fn=function(b,c,g,m){for(var n=b.length,c=0;c<b.length;c++)b[c].optional&&n--;if(f.localScope.nVars-f.defaults.length>b.length||n>f.localScope.nVars){b=[];for(c=0;c<f.localScope.nVars;c++)-1<f.defaults.length-(f.localScope.nVars-c)?b.push(f.localScope[c+=""]+"="+f.defaults[f.defaults.length-(f.localScope.nVars-
c)]):b.push(f.localScope[c+=""]);throw"MSG: Wrong number of parameters for "+a+"("+b.join(", ")+").";}n={"-parent":e};for(c=0;c<b.length;c++)n[f.localScope[c+=""]]=b[c];for(c=b.length;c<f.localScope.nVars;c++)n[f.localScope[c+=""]]=f.defaults[f.defaults.length-(f.localScope.nVars-c)];g&&(n.self||(n.self=g));m&&m.parent&&(n.parent=m.parent);try{return evaluateNode(d,n)}catch(o){if(o.returnVal)return o.data;throw o;}};return f}
funcEvalMap.THROW=function(a,b){throw"MSG: "+evaluateNode(a.children[0],b);};funcEvalMap.TRYCATCH=function(a,b){try{return evaluateNode(a.children[0],b)}catch(c){var d={"-parent":b};d[a.children[2].text]="string"==typeof c||c instanceof String?s(c.substr(5)):s("An error has occurred.");return evaluateNode(a.children[1],d)}};funcEvalMap.WHILE=function(a,b){for(var c=new Material(0),d={"-parent":b};trueValue(evaluateNode(a.children[0],b).toNum());)c=evaluateNode(a.children[1],d);return c};
funcEvalMap.IFTHENELSE=function(a,b){for(var c={"-parent":b},d=0;d<a.children[0].children.length;d++)if(trueValue(evaluateNode(a.children[0].children[d],b).toNum()))return evaluateNode(a.children[1].children[d],c);return a.children[0].children.length!=a.children[1].children.length?evaluateNode(a.children[1].children[d],c):new Material(0)};
funcEvalMap.FORIN=function(a,b){var c=new Material(0),d=a.children[0].text,e={"-parent":b},f=evaluateNode(a.children[1],b);if(!(f instanceof Vector))throw"MSG: The in argument of a For-In loop mush be a a vector.";for(var g=0;g<f.items.length;g++)e[d]=f.items[g],c=evaluateNode(a.children[2],e);return c};
funcEvalMap.FOR=function(a,b){var c=new Material(0),d=a.children[0].text,e=evaluateNode(a.children[1].children[0],b).toNum(),f=new Material(1);3==a.children[1].children.length&&(f=evaluateNode(a.children[1].children[2],b).toNum());var g={"-parent":b};for(g[d]=e;fn[0<=f.value?"<=":">="](g[d].value,evaluateNode(a.children[1].children[1],b).toNum());)c=evaluateNode(a.children[2],g),g[d]=plus(g[d],f);return c};
funcEvalMap.FUNCTION=function(a,b){var c=a.children[0].children[0].text;functionGenerator(c,a.children[0],a.children[1],a.children[2],b);return'"'+c+'" defined'};funcEvalMap.ANONFUNCTION=function(a,b){return functionGenerator(null,a.children[0],a.children[1],a.children[2],b)};
funcEvalMap.ASSIGN=function(a,b){var c=a.children.length-1,d=evaluateNode(a.children[a.children.length-1],b);if(1<c&&(!(d instanceof Vector)||d.items.length<c))throw"MSG: Too few elements returned for assignment.";for(var e=0;e<c;e++)if(a.children[e]instanceof PrimitiveStore)1==c?a.children[e].primitive.setValue(d):a.children[e].primitive.setValue(d.items[e]);else{var f=a.children[e].children[0].text;if(1<a.children[e].children.length)var g=createSelector(a.children[e].children[1],b);for(var h=b;null!==
b["-parent"]&&!isDefined(b[f]);)b=b["-parent"];null===b["-parent"]&&isUndefined(b[f])&&(b=h);h=1==c?d:d.items[e];if(1==a.children[e].children.length)b[f]=h;else if(isDefined(b[f]))selectFromMatrix(b[f],g,h);else throw"MSG: The variable '"+a.children[e].children[0].origText+"' does not exist.";}return 1<c?new Vector(d.items.slice(0,c)):d};
function createSelector(a,b){if("DOTSELECTOR"==a.children[0].typeName){for(var c=[],d=0;d<a.children[0].children.length;d++)a.children[0].children[d].text?c.push(a.children[0].children[d].text):c.push(a.children[0].children[d].valueOf());return c}return createMatrixSelector(a,b,0,!0)}funcEvalMap.MATERIAL=function(a,b){var c=evaluateNode(a.children[0],b).toNum();if(c.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(c.value,a.children[1])};
function functionGenerator(a,b,c,d,e){for(var f=[],g=[],h=null===a?0:1;h<b.children.length;h++)f.push(b.children[h].text);for(h=0;h<c.children.length;h++)g.push(c.children[h]);if(null===a)return makeFunctionCall(null===a?"Function":a,f,g,d,e);e[a]=makeFunctionCall(a,f,g,d,e)}
var unitEvalMap={MULT:function(a){return evaluateUnits(a.children[0]).concat(evaluateUnits(a.children[1]))},POW:function(a){var b=1,c=1;3==a.children.length&&(b*=-1,c++);var d=evaluateUnits(a.children[0]),a=evaluateUnits(a.children[c])*b;if(d instanceof Array){for(b=0;b<d.length;b++)d[b].exponent*=a;return d}return Math.pow(d,a)},DIV:function(a){for(var b=evaluateUnits(a.children[0]),a=evaluateUnits(a.children[1]),c=0;c<a.length;c++)a[c].exponent*=-1;return b.concat(a)}};unitEvalMap.PER=unitEvalMap.DIV;
unitEvalMap.UNIT=function(a){for(var b="",c=0;c<a.children.length;c++)b+=a.children[c].text,c<a.children.length-1&&(b+=" ");return[{id:b,exponent:1}]};
unitEvalMap.UNITCLUMP=function(a){var b=evaluateUnits(a.children[0]);if(1<a.children.length)for(var c=1;c<a.children.length;c++)if("NEGATE"==a.children[c].typeName)for(var d=0;d<b.length;d++)b[d].exponent*=-1;else if("SQUARED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=2;else if("CUBED"==a.children[c].typeName)for(d=0;d<b.length;d++)b[d].exponent*=3;return b};unitEvalMap.INTEGER=function(a){return parseInt(a.text)};unitEvalMap.FLOAT=function(a){return parseFloat(a.text)};
function evaluateUnits(a){return a instanceof Material?a.value:unitEvalMap[a.typeName](a)}function evaluateNode(a,b){if(a instanceof TreeNode)return evaluatingLine=a.line||evaluatingLine,funcEvalMap[a.typeName](a,b);if(a instanceof PrimitiveStore){if("totalValue"==a.type)return a.primitive.totalContents();if("object"==a.type)return a.primitive}else return a}
var trimEvalMap={POWER:function(a,b){if(1==a.children.length)return trimNode(a.children[0],b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c},INNER:function(a,b){if(1==a.children.length)return trimNode(a.children[0],b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c}};trimEvalMap.RANGE=trimEvalMap.POWER;trimEvalMap.TRUE=function(){return!0};
trimEvalMap.FALSE=function(){return!1};trimEvalMap.STRING=function(a){var b=a.origText.substr(1,a.origText.length-2),a='"'==a.origText[0]?b.replace(/\\\\/g,"\\\\TEMPTXT\\\\").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\t/g,"\t").replace(/\\b/g,"\u0008").replace(/\\f/g,"\u000c").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\\\TEMPTXT\\\\/g,"\\"):b.replace(/\n/,"\\n"),a=new String(a);a.vector=new Vector([],[],StringBase);return a};
trimEvalMap.INTEGER=function(a){return new Material(sn("#e"+a.text))};
trimEvalMap.MATERIAL=function(a,b){for(var c=a.children[0],d=trimNode(a.children[1],b),c=evaluateUnits(c),e=[],f=[],g=0;g<c.length;g++){var h=f.indexOf(c[g].id);-1==h?(e.push(c[g].exponent),f.push(c[g].id)):e[h]+=c[g].exponent}if(d instanceof Material){if(d.units)throw"MSG: Cannot create material where numeric part itself has units.";return new Material(d.value,getUnitStore(f,e,!0))}c=new TreeNode(a.origText,"MATERIAL",a.line);c.children=[d,getUnitStore(f,e,!0)];return c};
trimEvalMap.MULT=function(a,b){if(0==a.children.length)return"*";var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return mult(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.DIV=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return div(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};
trimEvalMap.PLUS=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return plus(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.MINUS=function(a,b){var c=trimNode(a.children[0],b),d=trimNode(a.children[1],b);if(isConst(c)&&isConst(d))return minus(c,d);var e=new TreeNode(a.origText,a.typeName,a.line);e.children=[c,d];return e};trimEvalMap.FLOAT=trimEvalMap.INTEGER;
trimEvalMap.PRIMITIVE=function(a,b){var c;c="[["==a.text.substr(0,2)?new PrimitiveStore(b[a.text.substr(2,a.text.length-4)],"totalValue"):new PrimitiveStore(b[a.text.substr(1,a.text.length-2)],"object");if("undefined"===typeof c.primitive)throw"MSG: The primitive <i>"+a.origText+"</i> could not be found.";return c};
trimEvalMap.NEGATE=function(a,b){if(0==a.children.length)return new TreeNode(a.origText,a.typeName,a.line);var c=trimNode(a.children[0],b);if(isConst(c))return negate(c);var d=new TreeNode(a.origText,a.typeName,a.line);d.children=[c];return d};
trimEvalMap.ARRAY=function(a,b){for(var c=new TreeNode(a.origText,a.typeName,a.line),d=[],e=[],f=!1,g=0;g<a.children.length;g++)c.children.push(trimNode(a.children[g],b)),d.push(c.children[g].children[0]),1<c.children[g].children.length?(c.children[g].children[1].text?e.push(c.children[g].children[1].origText):e.push(c.children[g].children[1].valueOf()),f=!0):e.push(void 0);for(var h=!0,g=0;g<d.length;g++)if(!isConst(d[g])){h=!1;break}return h?new Vector(d,f?e:void 0):c};
function isConst(a){return a instanceof Material||"string"==typeof a||a instanceof String||"boolean"==typeof a||a instanceof Vector?!0:!1}function trimNode(a,b){if(trimEvalMap.hasOwnProperty(a.typeName))return trimEvalMap[a.typeName](a,b);for(var c=new TreeNode(a.origText,a.typeName,a.line),d=0;d<a.children.length;d++)c.children.push(trimNode(a.children[d],b));return c}
function trueValue(a){if("boolean"==typeof a)return a;if(a instanceof Material)return neq(a.value,0);throw"MSG: Only numbers can be used in place of booleans.";}function isLocal(){return"localhost"==document.location.hostname||"insightmaker.dev"==document.location.hostname||"calc.dev"==document.location.hostname}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}
function fireEvent(a,b,c){var d,e=a;if(a instanceof Vector)d=a.parent;else if(a.vector instanceof Vector)a=a.vector,d=a.parent;else if(a.parent instanceof Vector)d=a=a.parent;else return!1;try{var f=selectFromVector(a,b)}catch(g){return!1}c.optional=!0;return callFunction(f.data,[c],varBank,e,d)}function ObjToVec(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++)c.push(a[b[d]]);return new Vector(c,b)};functionLoaders.push(function(){function a(a,b){for(var c=0;c<b.length();c++)if(eq(a,b.items[c]))return new Material(c+1);return new Material(0)}function b(a,b,c){if(!b)for(b=0;b<a.length;b++)a[b]=a[b].toNum();if(1==a.length&&a[0]instanceof Vector)a=c?a[0]:functionBank.flatten([a[0]]);else{for(var c=Vector,b=!1,e,l=0;l<a.length;l++)if(a[l]instanceof Vector){e=a[l];b=!0;break}if(b)for(l=0;l<a.length;l++)a[l]instanceof Vector||(a[l]=d(e,a[l]));a=new c(a)}return a}function c(a){return 1==a.length&&a[0]instanceof
Vector?functionBank.flatten([a[0].toNum()]).items:b(a,void 0,!0).items}function d(a,b){for(var c=a.fullClone(),e=0;e<c.items.length;e++)c.items[e]=c.items[e]instanceof Vector?d(c.items[e],b):b;return c}function e(a){for(var b=[],c=[],d=void 0,l=0;l<a.length();l++)if(a.items[l]instanceof Vector)var m=e(a.items[l]),b=b.concat(m.items),c=c.concat(m.names),d=d||m.hasName;else b.push(a.items[l]),a.names?(c.push(a.names[l]),d=!0):c.push(void 0);return{items:b,names:c,hasName:d}}defineFunction("RandBeta",
{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},function(a){return new Material(RandBeta(a[0].value,a[1].value))});defineFunction("RandDist",{params:[{name:"Distribution",noUnits:!0,needVector:!0},{name:"Y (in which case Distribution is X)",noUnits:!0,needVector:!0,defaultVal:!1}]},function(a){var b;if(1==a.length||!1===a[1]){var c=a[0];b=[];for(var a=[],d=0;d<c.items.length;d++)b.push(c.items[d].items[0].toNum().value),a.push(c.items[d].items[1].toNum().value)}else b=
a[0].toNum().items.map(function(a){return a.value}),a=a[1].toNum().items.map(function(a){return a.value});return new Material(RandDist(b,a))});defineFunction("RandBoolean",{params:[{name:"Probability",defaultVal:0.5,noUnits:!0,noVector:!0}]},function(a){a=0!=a.length?a[0].toNum().value:0.5;return Rand()<a?!0:!1});defineFunction("Rand",{params:[{name:"Lower Bound",defaultVal:0,noUnits:!0,noVector:!0},{name:"Upper Bound",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(Rand(a[0].toNum().value,
a[1].toNum().value)):new Material(Rand())});defineFunction("RandNormal",{params:[{name:"Mean",defaultVal:0,noUnits:!0,noVector:!0},{name:"Standard Deviation",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandNormal(a[0].toNum().value,a[1].toNum().value)):new Material(RandNormal())});defineFunction("RandExp",{params:[{name:"Rate",defaultVal:1,noUnits:!0,noVector:!0}]},function(a){return 0!=a.length?new Material(RandExp(a[0].toNum().value)):new Material(RandExp())});
defineFunction("RandLognormal",{params:[{name:"Mean",noUnits:!0,noVector:!0},{name:"Standard Deviation",noUnits:!0,noVector:!0}]},function(a){return new Material(RandLognormal(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandBinomial",{params:[{name:"Count",noUnits:!0,noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandBinomial(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandNegativeBinomial",{params:[{name:"Successes",noUnits:!0,
noVector:!0},{name:"Probability",noUnits:!0,noVector:!0}]},function(a){return new Material(RandNegativeBinomial(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandGamma",{params:[{name:"Alpha",noUnits:!0,noVector:!0},{name:"Beta",noUnits:!0,noVector:!0}]},function(a){return new Material(RandGamma(a[0].toNum().value,a[1].toNum().value))});defineFunction("RandPoisson",{params:[{name:"Rate",noUnits:!0,noVector:!0}]},function(a){return new Material(RandPoisson(a[0].toNum().value))});defineFunction("RandTriangular",
{params:[{name:"Minimum",noUnits:!0,noVector:!0},{name:"Maximum",noUnits:!0,noVector:!0},{name:"Peak",noUnits:!0,noVector:!0}]},function(a){return new Material(RandTriangular(a[0].toNum().value,a[1].toNum().value,a[2].toNum().value))});defineFunction("Real",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["real-part"](a.value);return a});defineFunction("Imag",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["imag-part"](a.value);return a});defineFunction("Magnitude",
{params:[{name:"Number"}]},function(a){if(a[0].toNum()instanceof Vector)return functionBank.sqrt([functionBank.sum([mult(a[0],a[0])])]);a=a[0].toNum();a.value=fn.magnitude(a.value);return a});defineFunction("Angle",{params:[{name:"Number"}],recurse:!0},function(a){return new Material(fn.angle(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("Abs",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.abs(a.value);return a});defineFunction("sin",{params:[{name:"Number"}],
recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Sin().";return new Material(fn.sin(a.value))});defineFunction("cos",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Cos().";return new Material(fn.cos(a.value))});defineFunction("tan",{params:[{name:"Number"}],
recurse:!0},function(a){a=a[0].toNum();a.units&&(a=mult(a,new Material(1,getUnitStore(["radians"],[-1]))));if(a.units)throw"MSG: Non-angular units cannot be used in Tan().";return new Material(fn.tan(a.value))});defineFunction("asin",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.asin(a[0].toNum().value))});defineFunction("acos",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.acos(a[0].toNum().value))});defineFunction("atan",
{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.atan(a[0].toNum().value))});defineFunction("arcsin",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.asin(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("arccos",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.acos(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("arctan",{params:[{name:"Number",noUnits:!0}],
recurse:!0},function(a){return new Material(fn.atan(a[0].toNum().value),getUnitStore(["radians"],[1]))});defineFunction("Sqrt",{params:[{name:"Number"}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.sqrt(a.value);if(a.units)for(var b=0;b<a.units.exponents.length;b++)a.units.exponents[b]/=2;return a});defineFunction("Ln",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.log(a[0].toNum().value))});defineFunction("Log",{params:[{name:"Number",noUnits:!0}],recurse:!0},
function(a){return new Material(fn.log(a[0].toNum().value,10))});defineFunction("Logit",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["-"](fn.log(a.value),fn.log(fn["-"](1,a.value)));return a});defineFunction("Expit",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){a=a[0].toNum();a.value=fn["/"](1,fn["+"](1,fn.exp(fn["-"](a.value))));return a});defineFunction("Round",{params:[{name:"Number",noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=
fn.round(a.value);return a});defineFunction("Ceiling",{params:[{name:"Number",noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.ceiling(a.value);return a});defineFunction("Floor",{params:[{name:"Number",noUnits:!1}],recurse:!0},function(a){a=a[0].toNum();a.value=fn.floor(a.value);return a});defineFunction("Exp",{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(fn.exp(a[0].toNum().value))});functionBank.ifthenelse=function(a){testArgumentsSize(a,"IfThenElse",
3,3);var b=evaluateNode(a[0].node,a[0].scope).toNum();return trueValue(b)?evaluateNode(a[1].node,a[1].scope):evaluateNode(a[2].node,a[2].scope)};functionBank.ifthenelse.delayEvalParams=!0;functionBank.map=function(a){testArgumentsSize(a,"Map",2,2);var b;b=a[0].node instanceof Vector?a[0].node:a[0]instanceof Vector?a[0]:evaluateNode(a[0].node,a[1].scope);b instanceof Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Map() requires a vector as its first argument.";b=b.fullClone();var c,
d={x:null,"-parent":a[1].scope},e=a[1].node;try{c=evaluateNode(e,d)}catch(m){}c instanceof Function||c instanceof UserFunction?(c.fn&&(c=c.fn),a=function(a){return c([a])}):a=function(a){d.x=a;return evaluateNode(e,d)};return b.apply(a)};functionBank.map.delayEvalParams=!0;VectorObject.map=functionBank.map;defineFunction("Sample",{object:[functionBank,VectorObject],params:[{name:"Vector",needVector:!0},{name:"Sample Size"},{name:"Repeat",noVector:!0,allowBoolean:!0,defaultVal:!1}]},function(a){var b=
a[0].toNum(),c=a[1].toNum().value;if(0==c)return new Vector([]);var d=b.length(),e=a[2]&&trueValue(a[2].toNum());if(0==d)throw"MSG: Sample() requires a non-empty vector.";a=[];if(e)for(e=0;e<c;e++)a.push(b.items[Math.floor(Rand()*d)]);else{if(d<c)throw"MSG: Vector for Sample() is too small for the given sample size.";b=b.items.slice();for(e=0;e<c;e++)a.push(b.splice(Math.floor(Rand()*b.length),1)[0])}return new Vector(a)});defineFunction("IndexOf",{object:[functionBank,VectorObject],params:[{name:"Haystack",
needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0}]},function(b){var c=b[1];if(c instanceof Vector){for(var d=[],e=0;e<c.items.length;e++)d.push(a(c.items[e],b[0]));return new Vector(d)}return a(c,b[0])});defineFunction("Contains",{object:[functionBank,VectorObject],params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Needle",allowBoolean:!0,noVector:!0}]},function(a){return eq(new Material(0),functionBank.indexof(a))?!1:!0});defineFunction("Collapse",{params:[{name:"Source",needVector:!0,
noUnits:!1},{name:"Target",noVector:!1}]},function(a){return a[0].toNum().collapseDimensions(a[1].toNum())});functionBank.filter=function(a){testArgumentsSize(a,"Filter",2,2);var b;b=a[0].node instanceof Vector?a[0].node:a[0]instanceof Vector?a[0]:evaluateNode(a[0].node,a[0].scope);b instanceof Primitive&&(b=b.toNum());if(!(b instanceof Vector))throw"MSG: Filter() requires a vector as its first argument.";b=b.fullClone();a=functionBank.map(a);return functionBank.select([b,a])};functionBank.filter.delayEvalParams=
!0;VectorObject.filter=functionBank.filter;functionBank.join=function(a){for(var b=[],c=[],d=!1,e=0;e<a.length;e++){var m=a[e];m instanceof Primitive&&(m=m.toNum());if(m instanceof Vector)if(b=b.concat(m.items),m.names)c=c.concat(m.names),d=!0;else for(var n=0;n<m.items.length;n++)c.push(void 0);else b.push(m),c.push(void 0)}return new Vector(b,d?c:void 0)};functionBank.repeat=function(a){testArgumentsSize(a,"Repeat",2,2);var b=evaluateNode(a[1].node,a[1].scope).toNum(),c=b;b instanceof Vector&&(c=
b.items.length);for(var d=[],e={x:null,"-parent":a[1].scope,key:null},m=0;m<c;m++)b instanceof Vector&&(e.key=b.items[m]),e.x=new Material(m+1),d.push(evaluateNode(a[0].node,e));return new Vector(d,b instanceof Vector?b.items.slice():void 0)};functionBank.repeat.delayEvalParams=!0;defineFunction("Select",{params:[{name:"Haystack",needVector:!0,noUnits:!0},{name:"Indexes",noUnits:!0}]},function(a){a[1].toNum();if(a[1]instanceof Vector){for(var b=a[1].toNum(),c=!0,d=0;d<b.length();d++)if(b.items[d]instanceof
Material){c=!1;break}if(!0==c){var c=[],e=a[0].names?[]:void 0;if(b.length()!=a[0].length())throw"MSG: Length of vector must be equal for boolean selection.";for(d=0;d<b.length();d++)trueValue(b.items[d])&&(c.push(a[0].items[d]),a[0].names&&e.push(a[0].names[d]))}else{c=[];e=a[0].names?[]:void 0;for(d=0;d<b.length();d++){var m=b.items[d].value;if(0>=m||m>a[0].length())throw"MSG: Selected element out of range.";c.push(a[0].items[m-1]);a[0].names&&e.push(a[0].names[m-1])}}return new Vector(c,e)}if(0<
a[1].value&&a[1].value<=a[0].length())return a[0].items[a[1].value-1];throw"MSG: Selected element out of range.";});defineFunction("Reverse",{allowEmpty:!0,params:{name:"Items..."},prep:function(a){return functionBank.join(a)}},function(a){return new Vector(a.items.slice().reverse(),a.names?a.names.slice().reverse():void 0)});defineFunction("Reverse",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.reverse(a)});defineFunction("Sort",{allowEmpty:!0,params:{name:"Items..."},
prep:function(a){return functionBank.join(a).toNum()}},function(a){return a.stackApply(function(a){for(var b=[],c=0;c<a.items.length;c++)b.push({item:a.items[c],name:a.names?a.names[c]:void 0});for(var d=b.sort(function(a,b){return lessThan(a.item,b.item)?-1:greaterThan(a.item,b.item)?1:0}),a=a.names?[]:void 0,b=[],c=0;c<d.length;c++)b.push(d[c].item),a&&a.push(d[c].name);return new Vector(b,a)})});defineFunction("Sort",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.sort(a)});
defineFunction("Unique",{allowEmpty:!0,params:{name:"Items....",allowBoolean:!0},prep:function(a){return functionBank.join(a).toNum()}},function(a){if(0==a.items.length)return new Vector([]);for(var b=[],c=a.names?[]:void 0,d=0;d<a.items.length;d++){for(var e=!1,m=0;m<b.length;m++)if(strictEquals(a.items[d],b[m])){e=!0;break}e||(b.push(a.items[d]),c&&c.push(a.names[d]))}return new Vector(b,c)});defineFunction("Unique",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.unique(a)});
defineFunction("Union",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){return functionBank.unique(functionBank.join(a).items)});defineFunction("Intersection",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){for(var b=a[0],a=a[1],c=[],d=0;d<b.items.length;d++)for(var e=0;e<a.items.length;e++)if(strictEquals(b.items[d],a.items[e])){c.push(b.items[d]);break}return functionBank.unique(c)});
defineFunction("Difference",{object:[functionBank,VectorObject],params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){for(var b=a[0],a=a[1],c=[],d=0;d<b.items.length;d++){for(var e=!1,m=0;m<a.items.length;m++)if(strictEquals(b.items[d],a.items[m])){e=!0;break}e||c.push(b.items[d])}for(d=0;d<a.items.length;d++){e=!1;for(m=0;m<b.items.length;m++)if(strictEquals(a.items[d],b.items[m])){e=!0;break}e||c.push(a.items[d])}return functionBank.unique(c)});defineFunction("Factorial",
{params:[{name:"Number",noUnits:!0}],recurse:!0},function(a){return new Material(factorial(a[0].toNum().value))});defineFunction("Max",{params:{name:"Items..."},prep:b},function(a){return a.stackApply(function(a){for(var a=a.items,b=a[0],c=1;c<a.length;c++)greaterThan(a[c],b)&&(b=a[c]);return b})});defineFunction("Max",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.max(a)});defineFunction("Fill",{object:[functionBank,VectorObject],params:[{name:"Vector",
needVector:!0},{name:"Value",allowBoolean:!0}]},function(a){return d(a[0],a[1])});defineFunction("Min",{params:{name:"Items..."},prep:b},function(a){return a.stackApply(function(a){for(var a=a.items,b=a[0],c=1;c<a.length;c++)lessThan(a[c],b)&&(b=a[c]);return b})});defineFunction("Min",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.min(a)});defineFunction("Mean",{params:{name:"Items..."},prep:c},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);
return div(b,new Material(a.length))});defineFunction("Mean",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.mean(a)});defineFunction("Sum",{params:{name:"Items..."},prep:c},function(a){for(var b=a[0],c=1;c<a.length;c++)b=plus(b,a[c]);return b});defineFunction("Sum",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.sum(a)});defineFunction("Product",{params:{name:"Items..."},prep:c},function(a){for(var b=a[0],c=
1;c<a.length;c++)b=mult(b,a[c]);return b});defineFunction("Product",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.product(a)});defineFunction("Median",{params:{name:"Items..."},prep:b},function(a){return a.stackApply(function(a){a=functionBank.sort([a]).items;return Math.floor((a.length-1)/2)==(a.length-1)/2?a[(a.length-1)/2]:div(plus(a[Math.floor((a.length-1)/2)],a[Math.ceil((a.length-1)/2)]),new Material(2))})});defineFunction("Median",{object:VectorObject,
params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.median(a)});defineFunction("StdDev",{params:{name:"Items..."},prep:b},function(a){return a.stackApply(function(a){a=a.items;if(1<a.length){for(var b=functionBank.mean(a),c=power(minus(a[0],b),new Material(2)),d=1;d<a.length;d++)c=plus(c,power(minus(a[d],b),new Material(2)));a=power(div(c,new Material(a.length-1)),new Material(0.5));return functionBank.real([a])}throw"MSG: You must have at least two elements to calculate the standard deviation.";
})});defineFunction("StdDev",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.stddev(a)});defineFunction("Correlation",{params:[{name:"Vector 1",needVector:!0},{name:"Vector 2",needVector:!0}]},function(a){var b=a[0].toNum(),a=a[1].toNum();if(1>=b.length())throw"MSG: You must have at least two elements in your vectors to calculate their correlation.";if(b.length()!=a.length())throw"MSG: The vectors for Correlation() must be of the same size.";var c=functionBank.mean([b]),
d=functionBank.mean([a]),e=functionBank.stddev([b]),m=functionBank.stddev([a]);return 0==e.value||0==m.value?new Material(0):div(functionBank.sum([mult(minus(b.clone(),c),minus(a.clone(),d))]),mult(minus(functionBank.count([b]),new Material(1)),mult(e,m)))});functionBank.count=function(a){a=functionBank.join(a).items;return new Material(sn("#e"+a.length))};functionBank.flatten=function(a){a=e(functionBank.join(a));return new Vector(a.items,a.hasName?a.names:void 0)};defineFunction("Keys",{object:VectorObject,
params:[{name:"Vector",needVector:!0}]},function(a){return!a[0].names?new Vector([]):new Vector(a[0].names.filter(function(a){return isDefined(a)}).map(function(a){return s(a)}))});defineFunction("Values",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return new Vector(a[0].items)});defineFunction("Length",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return new Material(sn("#e"+a[0].items.length))});defineFunction("Count",{object:VectorObject,
params:[{name:"Vector",needVector:!0}]},function(a){return new Material(sn("#e"+a[0].items.length))});defineFunction("Flatten",{object:VectorObject,params:[{name:"Vector",needVector:!0}]},function(a){return functionBank.flatten(a)});defineFunction("SetRandSeed",{params:[{name:"Seed Number",noUnits:!0,noVector:!0}]},function(a){Math.seedrandom(a[0].toNum());return"Random Seed Set"});defineFunction("Alert",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){alert(a[0]);return 1});
defineFunction("Console",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},function(a){console.log(a[0]);return 1});defineFunction("Prompt",{params:[{name:"Message",allowString:!0,allowBoolean:!0},{name:"Default",defaultVal:"",allowString:!0,allowBoolean:!0}]},function(a){var b=a[1];b instanceof Material&&!b.units&&(b=b.value);a=prompt(a[0],b);return parseFloat(a).toString()==a?new Material(parseFloat(a)):a});defineFunction("Confirm",{params:[{name:"Message",allowString:!0,allowBoolean:!0}]},
function(a){return confirm(a[0])});defineFunction("Parse",{object:StringObject,params:[{name:"String",allowString:!0}]},function(a){return new Material(parseFloat(a[0],10))});defineFunction("Split",{object:StringObject,params:[{name:"String",needString:!0},{name:"Splitter",needString:!0}]},function(a){return s(new Vector(a[0].split(a[1])))});defineFunction("Join",{object:VectorObject,params:[{name:"String",needVector:!0},{name:"Joiner",needString:!0}]},function(a){return s(a[0].items.join(a[1]))});
defineFunction("Trim",{object:StringObject,params:[{name:"String",needString:!0}],recurse:!0},function(a){return s(a[0].trim())});defineFunction("Range",{object:StringObject,params:[{name:"String",needString:!0},{name:"Indexes",noUnits:!0,allowVector:!0}]},function(a){if(a[1]instanceof Vector){for(var b="",c=0;c<a[1].items.length;c++)b+=a[0].charAt(a[1].items[c].toNum().value-1);return s(b)}return s(a[0].charAt(a[1].toNum().value-1))});defineFunction("Length",{object:StringObject,params:[{name:"String",
needString:!0}]},function(a){return new Material(a[0].length)});defineFunction("IndexOf",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},function(a){return new Material(a[0].indexOf(a[1])+1)});defineFunction("Contains",{object:StringObject,params:[{name:"Haystack",needString:!0},{name:"Needle",needString:!0}]},function(a){return!eq(StringObject.indexof(a),new Material(0))});defineFunction("Lowercase",{object:StringObject,params:[{name:"String",needString:!0}]},
function(a){return s(a[0].toLowerCase())});defineFunction("Uppercase",{object:StringObject,params:[{name:"String",needString:!0}]},function(a){return s(a[0].toUpperCase())});StringBase=makeObjectBase(StringObject);VectorBase=makeObjectBase(VectorObject)});function s(a){if(a instanceof Vector)return a.recurseApply(s);a=new String(a);a.parent=StringBase;return a}
function makeObjectBase(a){for(var b=Object.keys(a),c=[],d=0;d<b.length;d++)c.push(objectizeFunction(a[b[d]]));a=new Vector(c,b);a.parent=void 0;return a}
function defineFunction(a,b,c){for(var d=b.params,e=$.isArray(d),f=d.length,g=0;g<d.length;g++)if(d[g].hasOwnProperty("defaultVal")){f=g;break}var h;h=e?b.object?a+"("+d.slice(1).map(function(a){return a.name+(a.hasOwnProperty("defaultVal")?"="+a.defaultVal.toString():"")}).join(", ")+")":a+"("+d.map(function(a){return a.name+(a.hasOwnProperty("defaultVal")?"="+a.defaultVal.toString():"")}).join(", ")+")":a+"(items...)";var k=function(g,m){b.prep&&(g=b.prep(g));if(e&&(g.length>d.length||g.length<
f))throw"MSG: Wrong number of parameters for "+h+".";if(!e&&0==g.length&&!b.allowEmpty)throw"MSG: At least one parameter required for "+a+"().";for(var n=0;n<g.length;n++){var o=e?d[n]:d;if(o.noUnits&&g[n].toNum()instanceof Material&&g[n].toNum().units)throw"MSG: "+h+" does not except units for the argument '"+o.name+"'.";if(o.noVector&&g[n]instanceof Vector)throw"MSG: "+h+" does not except vectors for the argument '"+o.name+"'.";if(o.needVector&&(g[n]instanceof Primitive&&(g[n]=g[n].toNum()),!(g[n]instanceof
Vector)))throw"MSG: "+h+" requires a vector for the argument '"+o.name+"'.";if(o.needPrimitive&&!(g[n]instanceof Primitive))throw"MSG: "+h+" requires a primitive for the argument '"+o.name+"'.";if(!o.allowBoolean&&"boolean"==typeof g[n])throw"MSG: "+h+" does not accept boolean values for the argument '"+o.name+"'.";o.needAgent&&!(g[n]instanceof Agent)&&(g[n]=agent(g[n],h,o.name));if(o.needString&&!("string"==typeof g[n]||g[n]instanceof String))throw"MSG: "+h+" requires a string for the argument '"+
o.name+"'.";if(!o.allowString&&!o.needString&&"string"==typeof g[n])throw"MSG: "+h+" does not accept string values for the argument '"+o.name+"'.";o.needAgents&&!(g[n]instanceof Agents)&&(g[n]=agents(g[n],h,o.name));o.needPopulation&&!(g[n]instanceof Vector)&&(g[n]=getPopulation(g[n],h,o.name));if(o.needFunction&&!(g[n]instanceof Function||g[n]instanceof UserFunction))throw"MSG: "+h+" requires a function for the argument '"+o.name+"'.";}if(b.recurse)var q=g[0].toNum();return b.recurse&&q instanceof
Vector?q.cloneApply(function(a){return k([a].concat(g.slice(1)),m)}):c(g,m)};if(b.object)if(b.object instanceof Array)for(g=0;g<b.object.length;g++)b.object[g][a.toLowerCase()]=k;else b.object[a.toLowerCase()]=k;else functionBank[a.toLowerCase()]=k;b.recurse&&(VectorObject[a.toLowerCase()]=k)}function objectizeFunction(a){var b=function(b,d,e){return a([e].concat(b),d,e)};b.delayEvalParams=a.delayEvalParams;return b}
function factorial(a){if(Math.round(a)!=a)throw"MSG: The factorial() function only accepts integers.";if(0>a)throw"MSG: The factorial() function is only defined for integers 0 or larger.";return 1<a?a*factorial(a-1):1}function testArgumentsSize(a,b,c,d){if(a.length<c||a.length>d)throw"MSG: Wrong number of parameters for "+b+"().";};var AgentBase,AgentObject={},PrimitiveBase,PrimitiveObject={};
functionLoaders.push(function(){defineFunction("Stop",{params:[]},function(){throw{msg:"STOP"};});defineFunction("Pause",{params:[]},function(){simulate.sleep(!0);return new Material(0)});defineFunction("Time",{params:[]},function(){return simulate.time().fullClone()});defineFunction("TimeStep",{params:[]},function(){return simulate.timeStep.fullClone()});defineFunction("TimeLength",{params:[]},function(){return simulate.timeLength.fullClone()});defineFunction("TimeStart",{params:[]},function(){return simulate.timeStart.fullClone()});
defineFunction("TimeEnd",{params:[]},function(){return simulate.timeEnd.fullClone()});defineFunction("Seconds",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["seconds"],[-1])))});defineFunction("Minutes",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["minutes"],[-1])))});
defineFunction("Hours",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["hours"],[-1])))});defineFunction("Days",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["days"],[-1])))});defineFunction("Weeks",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=
0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["weeks"],[-1])))});defineFunction("Months",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["months"],[-1])))});defineFunction("Years",{params:[{name:"Value",defaultVal:"time",noVector:!0}]},function(a){a=0==a.length?simulate.time().fullClone():a[0].toNum();return mult(a,new Material(1,getUnitStore(["years"],
[-1])))});defineFunction("Unitless",{params:[{name:"Value",noVector:!0}]},function(a){return new Material(a[0].toNum().value)});defineFunction("PastMean",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.mean(a[0].getPastValues()):functionBank.mean(a[0].getPastValues(a[1].toNum()))});defineFunction("PastMedian",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",
noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.median(a[0].getPastValues()):functionBank.median(a[0].getPastValues(a[1].toNum()))});defineFunction("PastValues",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){a=1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return new Vector(a)});defineFunction("PastStdDev",
{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){a=1==a.length?a[0].getPastValues():a[0].getPastValues(a[1].toNum());return 1<a.length?functionBank.stddev(a):new Material(0)});defineFunction("PastCorrelation",{params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"[Primitive]",noVector:!0,needPriobject:[functionBank,PrimitiveObject],mitive:!0},{name:"Past Range",noVector:!0,
defaultVal:"All Time"}]},function(a){var b;"All Time"!=a[2]?(b=a[0].getPastValues(),a=a[1].getPastValues()):(b=a[0].getPastValues(a[2].toNum()),a=a[1].getPastValues(a[2].toNum()));return 1<b.length?functionBank.correlation([new Vector(b),new Vector(a)]):new Material(0)});defineFunction("PastMax",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.max(a[0].getPastValues()):
functionBank.max(a[0].getPastValues(a[1].toNum()))});defineFunction("PastMin",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Past Range",defaultVal:"All Time",noVector:!0}]},function(a){return 1==a.length?functionBank.min(a[0].getPastValues()):functionBank.min(a[0].getPastValues(a[1].toNum()))});defineFunction("Pulse",{params:[{name:"Start Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1},{name:"Width",noVector:!0,defaultVal:0},{name:"Repeat Period",
noVector:!0,defaultVal:0}]},function(a){var b=a[0].toNum(),c=new Material(1),d=new Material(0),e=new Material(0);1<a.length&&(c=a[1].toNum(),2<a.length&&(d=a[2].toNum(),3<a.length&&(e=a[3].toNum())));b.units||(b.units=simulate.timeUnits);d.units||(d.units=simulate.timeUnits);e.units||(e.units=simulate.timeUnits);if(0>=e.value){if(eq(simulate.time(),b)||greaterThanEq(simulate.time(),b)&&lessThanEq(simulate.time(),plus(b,d)))return c}else if(greaterThanEq(simulate.time(),b)){var a=minus(simulate.time(),
mult(functionBank.floor([div(minus(simulate.time(),b),e)]),e)),f=minus(simulate.time(),b);if(0==minus(functionBank.round([div(f,e)]),div(f,e)).value||greaterThanEq(a,b)&&lessThanEq(a,plus(b,d)))return c}return new Material(0)});defineFunction("Ramp",{params:[{name:"Start Time",noVector:!0},{name:"Finish Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1}]},function(a){var b=a[0].toNum(),c=a[1].toNum(),d=new Material(1);3==a.length&&(d=a[2].toNum());b.units||(b.units=simulate.timeUnits);c.units||
(c.units=simulate.timeUnits);return greaterThanEq(simulate.time(),b)?div(mult(functionBank.min([minus(c,b),minus(simulate.time(),b)]),d),minus(c,b)):new Material(0)});defineFunction("Step",{params:[{name:"Start Time",noVector:!0},{name:"Height",noVector:!0,defaultVal:1}]},function(a){var b=a[0].toNum(),c=new Material(1);2==a.length&&(c=a[1].toNum());b.units||(b.units=simulate.timeUnits);return greaterThanEq(simulate.time(),b)?c:new Material(0)});functionBank.staircase=functionBank.step;defineFunction("Smooth",
{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The smoothing period must be greater than 0.";return 2==a.length?a[0].smoothF(a[1].toNum()):a[0].smoothF(a[1].toNum(),a[2].toNum())});defineFunction("Delay",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},
{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>a[1].toNum().value)throw"MSG: The delay must be greater than or equal to 0.";return 2==a.length?a[0].pastValue(a[1].toNum()):a[0].pastValue(a[1].toNum(),a[2].toNum())});defineFunction("Delay1",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The delay must be greater than 0.";
return 2==a.length?a[0].expDelayF(1,a[1].toNum()):a[0].expDelayF(1,a[1].toNum(),a[2].toNum())});defineFunction("Delay3",{object:[functionBank,PrimitiveObject],params:[{name:"[Primitive]",noVector:!0,needPrimitive:!0},{name:"Length",noVector:!0},{name:"Initial Value",noVector:!0,defaultVal:"None"}]},function(a){if(0>=a[1].toNum().value)throw"MSG: The delay must be greater than 0.";return 2==a.length?a[0].expDelayF(3,a[1].toNum()):a[0].expDelayF(3,a[1].toNum(),a[2].toNum())});defineFunction("Exp",{params:[{name:"Number",
noVector:!0,noUnits:!0}]},function(a){a=a[0].toNum();a.value=fn.exp(a.value);if(fn["imag-part"]&&0!=fn["imag-part"](a.value))throw"MSG: Exp() function resulted in an imaginary result.";a.value=fn["real-part"](a.value);return a});functionBank.fix=function(a,b){testArgumentsSize(a,"Fix",1,2);var c=-1;2==a.length&&(c=evaluateNode(a[1].node,a[1].scope).toNum());for(var d=null,e=0;e<simulate.oldAggregateSeries.length;e++)if(simulate.oldAggregateSeries[e].match(b)){d=simulate.oldAggregateSeries[e];break}null===
d&&(d=new AggregateSeries(b,c),simulate.oldAggregateSeries.push(d));return d.get(a[0])};functionBank.fix.delayEvalParams=!0;functionBank.populationsize=function(a){testArgumentsSize(a,"PopulationSize",1,1);if(a[0]instanceof Agents)return new Material(sn("#e"+a[0].agents.length));throw"MSG: PopulationSize must be passed an agent population as an argument.";};PrimitiveObject.populationsize=functionBank.populationsize;defineFunction("Remove",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},
function(a){if(a[0].dead)throw"MSG: Cannot remove an already removed agent.";simulate.tasks.add(new Task({time:simulate.time(),priority:10,expires:1,name:"Remove Agent",action:function(){a[0].die()}}));return new Material(1)});defineFunction("Add",{object:[functionBank,PrimitiveObject],params:[{name:"[Agent Population]"},{needAgent:!0,name:"[Base]",defaultVal:"Agent Base"}]},function(a){for(;!(a[0]instanceof Agents)&&null!=a[0].container;)a[0]=a[0].container;if(!(a[0]instanceof Agents))throw"MSG: You must pass an agent population as the first argument to Add().";
return 2==a.length?a[0].add(a[1]):a[0].add()});defineFunction("FindAll",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"}]},function(a){return a[0]});defineFunction("ResetTimer",{object:[functionBank,PrimitiveObject],params:[{needPrimitive:!0,name:"[Action]"}]},function(a){if(!(a[0]instanceof Action))throw"MSG: ResetTimer requires an Action primitive.";a[0].resetTimer();return new Material(0)});defineFunction("Transition",{object:[functionBank,
PrimitiveObject],params:[{needPrimitive:!0,name:"[Transition]"}]},function(a){if(!(a[0]instanceof Transition))throw"MSG: Transition requires an Transition primitive.";a[0].doTransition();return new Material(0)});defineFunction("Value",{object:[functionBank,VectorObject,AgentObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"}]},function(a){var b=a[1].id,c=null;a[0]instanceof Agents||a[0]instanceof Agent||a[0]instanceof Vector||!a[0]||(a[0]=a[0].toNum());a[0]instanceof Agents&&
(c=getPopulation(a[0]));a[0]instanceof Vector&&(c=a[0]);if(null!==c){for(var a=[],d=-1,e=0;e<c.items.length;e++)if(-1!=d)a.push(c.items[e].children[d]);else for(var f=0;f<c.items[e].children.length;f++)if(c.items[e].children[f].id==b){a.push(c.items[e].children[f]);d=f;break}return new Vector(a)}if(a[0]instanceof Agent){for(f=0;f<a[0].children.length;f++)if(a[0].children[f].id==b)return a[0].children[f];throw'MSG: Could not find referenced primitive for "Value()".';}throw'MSG: Invalid type for the first argument of "Value()".';
});defineFunction("SetValue",{object:[functionBank,VectorObject,PrimitiveObject],params:[{name:"[Population]"},{needPrimitive:!0,name:"[Primitive]"},{name:"Value",noVector:!0,allowBoolean:!0}]},function(a){var b=a[1].id,c=null;a[0]instanceof Agents&&(c=getPopulation(a[0]));a[0]instanceof Vector&&(c=a[0]);if(null!==c){for(var d=0;d<c.length();d++)for(var e=0;e<c.items[d].children.length;e++)c.items[d].children[e].id==b&&c.items[d].children[e].setValue(a[2]);return new Material(1)}if(a[0]instanceof
Agent){for(e=0;e<a[0].children.length;e++)if(a[0].children[e].id==b)return a[0].children[e].setValue(a[2]),new Material(1);throw'MSG: Could not find referenced primitive for "SetValue()".';}throw'MSG: Invalid type for the first argument of "SetValue()".';});defineFunction("FindIndex",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{name:"Index",noVector:!0,noUnits:!0}]},function(a){for(var b=a[0],c=0;c<b.length();c++)if(b.items[c].index+1==
a[1].value)return b.items[c];throw"MSG: Index not found in population.";});defineFunction("FindState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var b=a[0];if(!(a[1]instanceof State||"State"===a[1].dna.type))throw"MSG: FindState() requires a State primitive as its argument.";for(var a=a[1].id,c=[],d=0;d<b.items.length;d++)-1!==b.items[d].stateIDs.indexOf(a)&&c.push(b.items[d]);return new Vector(c)});
defineFunction("FindNotState",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needPrimitive:!0,name:"[State]"}]},function(a){var b=a[0];if(!(a[1]instanceof State||"State"===a[1].dna.type))throw"MSG: FindNotState() requires a State primitive as its argument.";for(var a=a[1].id,c=[],d=0;d<b.items.length;d++)-1===b.items[d].stateIDs.indexOf(a)&&c.push(b.items[d]);return new Vector(c)});defineFunction("FindNearby",{object:[functionBank,VectorObject,
PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{name:"Distance Limit",noVector:!0}]},function(a){for(var b=a[0],c=[],d=0;d<b.length();d++){var e=agent(b.items[d]);e!==a[1]&&lessThanEq(distance(a[1],e),a[2])&&c.push(e)}return new Vector(c)});defineFunction("FindNearest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},
function(a){var b=a[0],c=1;if(3==a.length&&(c=a[2].value,1>c))throw"MSG: You must select at least one agent in FindNearest().";for(var d=[],e=0;e<b.items.length;e++){var f=agent(b.items[e]);f!==a[1]&&d.push({distance:distance(a[1],f),item:f})}if(d.length<c)throw"MSG: Can't find nearest "+c+" agents of a population of size "+d.length+".";a=[d[0]];for(e=1;e<d.length;e++){b=!1;for(f=0;f<a.length;f++)if(lessThan(d[e].distance,a[f].distance)){a.splice(f,0,d[e]);b=!0;break}!b&&a.length<c?a.push(d[e]):a.length>
c&&(a.length=c)}return 1===a.length?a[0].item:new Vector(a.map(function(a){return a.item}))});defineFunction("FindFurthest",{object:[functionBank,VectorObject,PrimitiveObject],params:[{needPopulation:!0,name:"[Agent Population]"},{needAgent:!0,name:"[Agent]"},{noUnits:!0,noVector:!0,defaultVal:1,name:"Count"}]},function(a){var b=a[0],c=1;if(3===a.length&&(c=a[2].value,1>c))throw"MSG: You must select at least one agent in FindFurthest().";for(var d=[],e=0;e<b.items.length;e++){var f=agent(b.items[e]);
f!==a[1]&&d.push({distance:distance(a[1],f),item:f})}if(d.length<c)throw"MSG: Can't find furthest "+c+" agents of a population of size "+d.length+".";a=[d[0]];for(e=1;e<d.length;e++){b=!1;for(f=0;f<a.length;f++)if(greaterThan(d[e].distance,a[f].distance)){a.splice(f,0,d[e]);b=!0;break}!b&&a.length<c?a.push(d[e]):a.length>c&&(a.length=c)}return 1===a.length?a[0].item:new Vector(a.map(function(a){return a.item}))});defineFunction("Index",{object:[functionBank,AgentObject],params:[{noVector:!0,needAgent:!0,
name:"[Agent]"}]},function(a){return new Material(sn("#e"+(a[0].index+1)))});defineFunction("Connect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[1]instanceof Vector?a[1].items.map(function(b){a[0].connect(b)}):a[0].connect(a[1]);return new Material(1)});defineFunction("Unconnect",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[1]instanceof Vector?a[1].items.map(function(b){a[0].unconnect(b)}):
a[0].unconnect(a[1]);return new Material(1)});defineFunction("Connected",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Agent]"}]},function(a){return new Vector(a[0].connected.slice())});functionBank.die=function(a){console.log(a);throw'MSG: Terminated using "die".';};functionBank.print=function(a){if(2==a.length)return console.log(a[0].value.toString()),console.log(a[1]),a[1];console.log(a[0]);return a[0]};defineFunction("Width",{params:[{needAgents:!0,name:"[Agent Population]"}]},
function(a){return a[0].geoWidth});defineFunction("Height",{params:[{needAgents:!0,name:"[Agent Population]"}]},function(a){return a[0].geoHeight});defineFunction("Distance",{object:[functionBank,AgentObject],params:[{name:"[Agent 1]"},{name:"[Agent 2]"}]},function(a){a[0]instanceof Vector||(a[0]=agent(a[0]));a[1]instanceof Vector||(a[1]=agent(a[1]));return distance(a[0],a[1])});defineFunction("Location",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Primitive]"}]},function(a){return a[0].location});
defineFunction("Move",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{needVector:!0,name:"Direction"}]},function(a){var b=a[1].toNum();shiftLocation(a[0],plus(a[0].location,b));return new Material(0)});defineFunction("MoveTowards",{object:[functionBank,AgentObject],params:[{needAgent:!0,name:"[Mover]"},{name:"[Target]"},{name:"Distance",noVector:!0}]},function(a){var b=a[0],c=a[1]instanceof Vector?a[1]:agent(a[1]).location,d=b.location,e=minus(c.items[0],d.items[0]),c=minus(c.items[1],
d.items[1]);if(0==e.value&&0==c.value)return new Material(1);b.container.geoWrap&&(greaterThan(e,b.container.halfWidth)?e=minus(b.container.geoWidth,e):lessThan(e,negate(b.container.halfWidth))&&(e=minus(e,negate(b.container.geoWidth))),greaterThan(c,b.container.halfHeight)?c=minus(b.container.geoHeight,c):lessThan(c,negate(b.container.halfHeight))&&(c=minus(c,negate(b.container.geoHeight))));b=new Vector([e,c],["x","y"]);shiftLocation(a[0],plus(a[0].location,mult(b,div(a[2],distance(a[0],a[1]instanceof
Vector?a[1]:agent(a[1]))))));return new Material(1)});PrimitiveBase=makeObjectBase(PrimitiveObject);AgentBase=makeObjectBase(AgentObject);PrimitiveBase.parent=AgentBase;VectorBase=makeObjectBase(VectorObject)});
function distance(a,b){var c=a instanceof Vector?a:a.location,d=b instanceof Vector?b:b.location,e=c.items[0].toString()+","+c.items[1].toString(),f=d.items[0].toString()+","+d.items[1].toString();if(simulate.distanceCache[e+"-"+f])return simulate.distanceCache[e+"-"+f];if(simulate.distanceCache[f+"-"+e])return simulate.distanceCache[f+"-"+e];var g=minus(c.items[0],d.items[0]),c=minus(c.items[1],d.items[1]),d=null;a instanceof Vector?b instanceof Vector||(d=b.container):d=a.container;null!==d&&d.geoWrap&&
(greaterThan(g,d.halfWidth)?g=minus(d.geoWidth,g):lessThan(g,negate(d.halfWidth))&&(g=minus(g,negate(d.geoWidth))),greaterThan(c,d.halfHeight)?c=minus(d.geoHeight,c):lessThan(c,negate(d.halfHeight))&&(c=minus(c,negate(d.geoHeight))));var d=g.value,h=c.value;g.units!==c.units&&(h=fn["*"](h,convertUnits(g.units,c.units)));c=fn["real-part"](fn.sqrt(fn["+"](fn["*"](d,d),fn["*"](h,h))));c=new Material(c,g.units);return simulate.distanceCache[e+f]=c}
function agent(a,b,c){if(a instanceof Variable||a instanceof Stock)a=a.toNum();if(a instanceof Agent)return a;if(a instanceof Primitive)return agent(a.container,b,c);throw"MSG: An agent is required for '"+c+"' in the function "+b+".";}function agents(a){if(a instanceof Agents)return a;if(a instanceof Primitive||a instanceof Agent)return agents(a.container);throw"MSG: An agent population is required for '"+pName+"' in the function "+fnName+".";}
function getPopulation(a){return a.items?a:a instanceof Agents?new Vector(a.agents.slice()):a.toNum()instanceof Vector?a.toNum():new Vector([agent(a)])}
function shiftLocation(a,b){if(a.container.geoWrap){for(;lessThan(b.items[0],new Material(0));)b.items[0]=plus(b.items[0],a.container.geoWidth);for(;greaterThan(b.items[0],a.container.geoWidth);)b.items[0]=minus(b.items[0],a.container.geoWidth);for(;lessThan(b.items[1],new Material(0));)b.items[1]=plus(b.items[1],a.container.geoHeight);for(;greaterThan(b.items[1],a.container.geoHeight);)b.items[1]=minus(b.items[1],a.container.geoHeight)}a.location=b;a.location.names||(a.location.names=["x","y"],a.location.namesLC=
["x","y"])}function isUndefined(a){return"undefined"==typeof a}function isDefined(a){return!isUndefined(a)}function constraintAlert(a,b,c){b="The "+("max"==b?"maximum":"minimum")+" constraint on the primitive <b>"+clean(getName(findID(a.id)))+"</b> has been violated. The primitive's value attempted to become "+c.value+" when the "+("max"==b?"maximum":"minimum")+" allowed value is "+("max"==b?a.dna.maxConstraint:a.dna.minConstraint)+".";error(b,a,!1)}
function error(a,b,c){a={msg:a,primitive:b,showEditor:c};isLocal()&&(console.log("Error:"),console.log(a));throw a;}function testPrimitive(a,b,c){for(var d=0;d<c.length;d++)if(!(a[c[d]]instanceof Primitive))throw"MSG: "+b+"() requires a primitive reference to be passed to it as argument number "+(c[d]+1)+".";}function prepareDisplay(a){return a};function AggregateSeries(a,b){this.id=a;this.spacing=b;this.oldValues=[]}AggregateSeries.method("match",function(a){return this.id==a});
AggregateSeries.method("get",function(a){for(var b=0,b=0>this.spacing?0:0==this.spacing?Math.floor(div(minus(simulate.time(),simulate.timeStart),simulate.UserTimeStep).value):Math.floor(div(minus(simulate.time(),simulate.timeStart),this.spacing.forceUnits(simulate.timeUnits)).value);this.oldValues.length-1<b;)this.oldValues.push(evaluateNode(a.node,a.scope));return this.oldValues[b].fullClone?this.oldValues[b].fullClone():this.oldValues[b]});function DataBank(){this.dataSeries={}}
DataBank.method("series",function(){return Object.keys(this.dataSeries)});DataBank.method("clone",function(){for(var a=new DataBank,b=this.series(),c=0;c<b.length;c++)a.dataSeries[b[c]]=this.dataSeries[b[c]];return a});DataBank.method("getSeries",function(a){this.dataSeries[a]||(this.dataSeries[a]=[]);return this.dataSeries[a]});DataBank.method("trimValues",function(a){for(var b=this.series(),c=0;c<b.length;c++){var d=this.getSeries(b[c]);d.length-1>a&&d.splice(a+1,d.length-a+1)}});
function ExpGroup(a,b,c){this.stocks=[];this.k=b;for(b=1;b<=a;b++)this.stocks.push(c);this.out=c}ExpGroup.method("moveForward",function(a){var b=new ExpGroup(this.stocks.length,this.k,new Material(0));b.out=this.stocks[this.stocks.length-1];for(var c=this.stocks.length-1;0<c;c--)b.stocks[c]=plus(mult(this.stocks[c],new Material(1-this.k)),mult(this.stocks[c-1],new Material(this.k)));b.stocks[0]=plus(mult(this.stocks[0],new Material(1-this.k)),mult(a,new Material(this.k)));return b});function Primitive(){this.equation=this.dna=this.container=this.instanceId=this.index=this.agentId=this.id=null;this.cachedValue=void 0;this.pastValues=[];this.pastData=new DataBank;this.parent=PrimitiveBase}
Primitive.method("clone",function(){var a=new this.constructorFunction;a.dna=this.dna;a.container=this.container;a.agentId=this.agentId;a.index=this.index;a.id=this.id;a.createIds();a.pastValues=this.pastValues.slice(0);this.dna.slider&&(simulate.sliders[this.dna.id]?simulate.sliders[this.dna.id].push(a):simulate.sliders[this.dna.id]=[a]);a.cachedValue=this.cachedValue?this.cachedValue.fullClone():this.cachedValue;this.innerClone(a);return a});
Primitive.method("clearCached",function(){this.cachedValue=void 0});Primitive.method("storeValue",function(){isUndefined(this.cachedValue)&&this.value();this.pastValues.push(this.cachedValue)});Primitive.method("toNum",function(){return this.value()});Primitive.method("calculateValue",function(){throw"MSG: "+getText("[%s] does not have a value and can not be used as a value in an equation.",this.dna.name);});Primitive.method("createIds",function(){this.instanceId=simulate.getID(this.agentId+"-"+this.index)});
Primitive.method("getPastValues",function(a){if(isUndefined(a))b=this.pastValues.map(function(a){return a.fullClone()});else for(var a=Math.ceil(div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value),b=[],c=this.pastValues.length-1;c>=Math.max(0,this.pastValues.length-1-a);c--)b.push(this.pastValues[c].fullClone());return b});
Primitive.method("pastValue",function(a,b){var c;c=this.pastValues.length-1<Math.round((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value)?div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value:div(a.forceUnits(simulate.timeUnits),this.dna.solver.userTimeStep).value+1;if(0==c)return this.value();if(Math.ceil(c)>this.pastValues.length)return isUndefined(b)?0<this.pastValues.length?this.pastValues[0].fullClone():this.value():b;if(c==Math.round(c))return 0==
c?value:this.pastValues[this.pastValues.length-c].fullClone();var d=c-Math.floor(c),e=Math.floor(c);c=0==e?this.value():this.pastValues[this.pastValues.length-e];e=this.pastValues[this.pastValues.length-1-e];return plus(mult(c,new Material(1-d)),mult(e,new Material(d)))});
Primitive.method("smoothF",function(a,b){var c=div(this.dna.solver.userTimeStep,a.forceUnits(simulate.timeUnits)).value,d=this.pastData.getSeries("Smooth: "+c+","+b);0==d.length&&(isUndefined(b)?d.push(this.pastValues[0]?this.pastValues[0]:this.value()):d.push(b));for(var e=Math.floor((simulate.time().value-simulate.timeStart.value)/this.dna.solver.userTimeStep.value),f=d.length-1;f<e;f++){var g=this.pastValues[f]?this.pastValues[f]:this.cachedValue?this.cachedValue:this.pastValues[f-1];d.push(plus(mult(d[f],
new Material(1-c)),mult(new Material(c),g)))}return d[d.length-1].fullClone()});
Primitive.method("expDelayF",function(a,b,c){this.value();var d=div(this.dna.solver.userTimeStep,b.forceUnits(simulate.timeUnits)).value*a,b=this.pastData.getSeries("ExpDelay: "+a+","+b.value+","+c);0==b.length&&(isUndefined(c)?b.push(new ExpGroup(a,d,this.pastValues[0]?this.pastValues[0]:this.value())):(a=new ExpGroup(a,d,c),b.push(a.moveForward(this.pastValues[0]?this.pastValues[0]:this.value()))));for(a=b.length;a<this.pastValues.length;a++)b.push(b[a-1].moveForward(this.pastValues[a]));return b[b.length-
1].out.fullClone()});
Primitive.method("testUnits",function(a,b){if(a instanceof Vector){var c=this;a.recurseApply(function(a){c.testUnits(a,b);return a})}else{if(!this.dna.units&&a.units)error(getText("Wrong units generated for %s. Expected no units and got %s. Either specify units for the primitive or adjust the equation.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(a.units.toString())+"</i>"),this,!0);else if(this.dna.units!==a.units){var d=convertUnits(a.units,this.dna.units,!0);if(0==d){isLocal()&&(console.log(a.units),
console.log(this.dna.units));error(getText("Wrong units generated for %s. Expected %s, and got %s.","<i>"+clean(this.dna.name)+"</i>","<i>"+clean(this.dna.units.toString())+"</i>","<i>"+clean(a.units.toString())+"</i>"),this,!0);return}a.value*=d;a.units=this.dna.units}this instanceof Flow&&!0!=b&&this.dna.flowUnitless&&(d=mult(a,new Material(1,simulate.timeUnits)),a.value=d.value,a.units=d.units)}});
Primitive.method("setValue",function(){throw"MSG: "+getText("You cannot set the value for that primitive.");});Primitive.method("printPastValues",function(){console.log(this.pastValues.map(function(a){return a.value}))});
Primitive.method("value",function(){if(isUndefined(this.cachedValue)){if(-1<simulate.valuedPrimitives.indexOf(this))throw"MSG: "+getText("Circular equation loop identified including the primitives: %s",simulate.valuedPrimitives.slice(simulate.valuedPrimitives.indexOf(this)).map(function(a){return a.dna.name}).join(", "));simulate.valuedPrimitives.push(this);try{var a=this.calculateValue().toNum();if(a instanceof Material&&!isFinite(a.value)){isLocal()&&console.log(a);if(this instanceof Stock)throw"MSG: "+
getText("The stock has become infinite in size. Check the flows into it for rapid growth.");throw"MSG: "+getText("The result of this calculation is not a number (are you dividing by 0?).");}}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}this instanceof State||(this.testUnits(a),this.testConstraints(a));this.cachedValue=a}return this.cachedValue.fullClone?this.cachedValue.fullClone():this.cachedValue});
Primitive.method("testConstraints",function(a){var b=this,c=function(a){(1==b.dna.maxConstraintType&&a.value>b.dna.maxConstraint||2==b.dna.maxConstraintType&&a.value>=b.dna.maxConstraint)&&constraintAlert(b,"max",a);(1==b.dna.minConstraintType&&a.value<b.dna.minConstraint||2==b.dna.minConstraintType&&a.value<=b.dna.minConstraint)&&constraintAlert(b,"min",a);return a};a instanceof Vector?a.recurseApply(c):c(a)});
Primitive.method("setEquation",function(a,b){if(this instanceof Flow||this instanceof Transition)null!==this.omega&&(b.omega=this.omega),null!==this.alpha&&(b.alpha=this.alpha);try{this.equation=trimTree(a,b)}catch(c){isLocal()&&console.log(c),error(c.substr(4,c.length),this,!0)}});function Placeholder(a,b){this.dna=a;this.id=a.id;this.primitive=b}Placeholder.inherits(Primitive);
Placeholder.method("calculateValue",function(){error(getText("[%s] is a placeholder and cannot be used as a direct value in equations.",clean(this.dna.name)),this.primitive,!0)});function State(){Primitive.call(this);this.active=null;this.downStreamTransitions=[];this.constructorFunction=State}State.inherits(Primitive);State.method("innerClone",function(a){a.active=this.active});
State.method("setValue",function(a){this.setActive(trueValue(a));this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value();this.agentId&&this.container.updateStates()});State.method("calculateValue",function(){null===this.active&&this.setInitialActive();return this.active?new Material(1):new Material(0)});
State.method("setInitialActive",function(a){var b;try{b=evaluateTree(this.equation,globalVars(this)).toNum()}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}this.setActive(trueValue(b),a);this.agentId&&this.container.updateStates()});
State.method("setActive",function(a,b){this.active=a;if(!a||null===this.dna.residency){if(!b)for(var c=0;c<this.downStreamTransitions.length;c++)scheduleTrigger.call(this.downStreamTransitions[c])}else{var d=this;simulate.tasks.add(new Task({name:"State Residency",time:plus(simulate.time(),this.dna.residency),priority:5,expires:1,action:function(){for(var a=0;a<d.downStreamTransitions.length;a++)scheduleTrigger.call(d.downStreamTransitions[a])}}))}});
State.method("getActive",function(){null===this.active&&this.setInitialActive();return this.active});function Transition(){Primitive.call(this);this.scheduledTrigger=this.omega=this.alpha=null;this.constructorFunction=Transition}Transition.inherits(Primitive);Transition.method("innerClone",function(){});Transition.method("setEnds",function(a,b){this.alpha=a;this.omega=b;a&&a.downStreamTransitions.push(this)});
Transition.method("canTrigger",function(){return!this.alpha||this.alpha&&this.alpha.getActive()||this.dna.repeat});Transition.method("trigger",function(){this.scheduledTrigger=null;this.alpha&&this.alpha.setActive(!1);this.omega&&this.omega.setActive(!0);this.agentId&&this.container.updateStates();this.dna.repeat&&this.schedule()});function scheduleTrigger(){updateTrigger.call(this,!0)}
function updateTrigger(a){a&&this.scheduledTrigger&&!this.dna.repeat&&(this.scheduledTrigger.kill(),this.scheduledTrigger=null);if(this.canTrigger()){try{var b=evaluateTree(this.equation,globalVars(this)).toNum()}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}if("Condition"==this.dna.trigger)trueValue(b)&&this.trigger();else{b instanceof Material||error(getText("The value of this trigger must evaluate to a number."),
this,!0);var d;if("Timeout"==this.dna.trigger){b.units||(b.units=simulate.timeUnits);if(this.scheduledTrigger&&eq(b,this.scheduledTrigger.data.value))return;this.dna.repeat&&0==b.value&&error(getText("A trigger Timeout of 0 with 'Repeat' set to true results in an infinite loop."),this,!0);d=b}else if("Probability"==this.dna.trigger){b.units&&error(getText("The probability for the trigger had units of %s. Probabilities must be unitless.",this.value().units.toString()),this,!0);b=b.value;if(this.scheduledTrigger&&
eq(b,this.scheduledTrigger.data.value))return;if(1==b)this.dna.repeat&&error(getText("A trigger probability of 1 with 'Repeat' as true results in an infinite loop."),this,!0),d=new Material(0,simulate.timeUnits);else if(1<b)error(getText("The probability for the trigger must be less than or equal to 1."),this,!0);else if(0>b)error(getText("The probability for the trigger must be greater than or equal to 0."),this,!0);else if(0==b){if(!this.scheduledTrigger)return}else a=-Math.log(1-b),d=new Material(RandExp(a),
simulate.timeUnits)}a=simulate.time();if(this.scheduledTrigger)if(this.scheduledTrigger.kill(),"Timeout"==this.dna.trigger){if(lessThanEq(d,minus(simulate.time(),this.scheduledTrigger.data.start))){this.scheduledTrigger=null;this.trigger();return}a=this.scheduledTrigger.data.start;d=minus(d,minus(simulate.time(),a));this.scheduledTrigger=null}else if("Probability"==this.dna.trigger){if(0==b){this.scheduledTrigger=null;return}d=minus(this.scheduledTrigger.time,simulate.time());var e=-Math.log(1-this.scheduledTrigger.data.value),
a=-Math.log(1-b);d=mult(d,new Material(e/a));a=this.scheduledTrigger.data.start;this.scheduledTrigger=null}d=plus(d,simulate.time());var f=this;this.scheduledTrigger=new Task({name:"Trigger",time:d,priority:5,expires:1,action:function(){f.trigger()},data:{start:a,value:b}});simulate.tasks.add(this.scheduledTrigger)}}}function Action(){Primitive.call(this);this.scheduledTrigger=this.action=null;this.block=!1;this.constructorFunction=Action}Action.inherits(Primitive);Action.method("innerClone",function(){});
Action.method("canTrigger",function(){return!this.block});Action.method("resetTimer",function(){scheduleTrigger.call(this)});Action.method("trigger",function(){this.scheduledTrigger=null;try{evaluateTree(this.action,globalVars(this)),this.dna.repeat?"Condition"!==this.dna.trigger&&scheduleTrigger.call(this):this.block=!0}catch(a){if(!a.substr)throw a;isLocal()&&console.log(a);"MSG:"==a.substr(0,4)?error(a.substr(4,a.length),this,!0):error(a,this,!0)}});
function Agents(){Primitive.call(this);this.DNAs=this.geoWrap=this.geoDimUnitsObject=this.geoDimUnits=this.halfHeight=this.halfWidth=this.geoHeight=this.geoWidth=this.agents=this.size=null;this.stateIds=[];this.constructorFunction=Agents;this.vector=new Vector([],[],PrimitiveBase)}Agents.inherits(Primitive);
Agents.method("collectData",function(){for(var a=[],b=0;b<this.agents.length;b++){var c=this.agents[b];a.push({instanceId:c.instanceId,connected:c.connected.map(function(a){return a.instanceId}),location:simpleNum(c.location.clone(),this.geoDimUnitsObject),state:0<c.states.length?c.states.slice():null})}return a});Agents.method("states",function(){return this.stateIds.slice(0)});
Agents.method("toNum",function(){throw"MSG: "+getText("[%s] is a population of agents and cannot be used as a direct value in equations.",clean(this.dna.name));});
Agents.method("add",function(a){this.size=1+parseInt(this.size,10);if(a){var b=a.agentClone();b.setIndex(this.size-1);b.createAgentIds();for(var c=0;c<this.DNAs.length;c++)b.children[c].container=b,linkPrimitive(b.children[c],this.DNAs[c])}else{b=new Agent;b.container=this;b.children=[];b.childrenId={};b.agentId=this.agentId;for(c=0;c<this.DNAs.length;c++)decodeDNA(this.DNAs[c],b);b.setIndex(this.size-1);b.createAgentIds();for(c=0;c<this.DNAs.length;c++)linkPrimitive(b.children[c],this.DNAs[c]);setAgentInitialValues(b);
a=getPrimitiveNeighborhood(this,this.dna);"Custom Function"==this.placement?(a.self=b,b.location=simpleUnitsTest(simpleEquation(this.placementFunction,{"-parent":varBank,self:b},a),this.geoDimUnitsObject),b.location.names||(b.location.names=["x","y"],b.location.namesLC=["x","y"])):b.location=new Vector([mult(this.geoWidth,new Material(Rand())),mult(this.geoHeight,new Material(Rand()))],["x","y"]);if("Custom Function"==this.network)for(var d=trimTree(createTree(this.networkFunction),a),c=c+1;c<this.agents.length;c++)trueValue(simpleEquation(this.networkFunction,
{"-parent":varBank,a:b,b:this.agents[c]},a,d))&&b.connect(this.agents[c])}var e=this;simulate.tasks.add(new Task({priority:10,expires:1,name:"Add Agent",time:simulate.time(),action:function(){e.agents.push(b)}}))});function Agent(){this.location=this.children=this.index=this.instanceId=this.agentId=null;this.connected=[];this.dead=!1;this.constructorFunction=Agent;this.stateIDs=[];this.states=[];this.vector=new Vector([],[],AgentBase)}Agent.prototype.createIds=Primitive.prototype.createIds;
Agent.method("toString",function(){return"Agent "+(this.index+1)});Agent.method("toNum",function(){return this});Agent.method("updateStates",function(){this.states=[];this.stateIDs=[];for(var a=0;a<this.children.length;a++)this.children[a].active&&(this.states.push(this.children[a]),this.stateIDs.push(this.children[a].dna.id))});
Agent.method("agentClone",function(){var a=new Agent;a.dna=this.dna;a.children=[];a.childrenId={};for(var b=0;b<this.children.length;b++)a.children.push(this.children[b].clone()),a.childrenId[a.children[b].dna.id]=a.children[b];a.location=this.location.clone();a.connected=this.connected.slice(0);a.container=this.container;return a});Agent.method("setIndex",function(a){this.index=a;for(var b=0;b<this.children.length;b++)this.children[b].index=a});
Agent.method("createAgentIds",function(){this.createIds();for(var a=0;a<this.children.length;a++)this.children[a].createIds()});
Agent.method("die",function(){for(;0<this.connected.length;)this.unconnect(this.connected[0]);for(var a=0;a<this.container.agents.length;a++)if(this.container.agents[a]==this){this.container.agents.splice(a,1);break}for(a=0;a<this.children.length;a++){var b=this.children[a],c=b.dna.solver;b instanceof Action?c.actions.splice(c.actions.indexOf(b),1):b instanceof Transition?c.transitions.splice(c.transitions.indexOf(b),1):b instanceof Agents||(c.valued.splice(c.valued.indexOf(b),1),b instanceof Flow?
c.flows.splice(c.flows.indexOf(b),1):b instanceof Stock?c.stocks.splice(c.stocks.indexOf(b),1):b instanceof State&&c.states.splice(c.states.indexOf(b),1))}this.dead=!0});Agent.method("connect",function(a){if(a!==this&&-1==this.connected.indexOf(a))if(a instanceof Agent)this.connected.push(a),a.connected.push(this);else throw"MSG: Only agents may be connected.";});
Agent.method("unconnect",function(a){if(a!==this){var b=this.connected.indexOf(a);-1!=b&&(this.connected.splice(b,1),b=a.connected.indexOf(this),a.connected.splice(b,1))}});function Stock(){Primitive.call(this);this.level=null;this.constructorFunction=Stock;this.delay=void 0;this.tasks=[];this.initRate=null;this.oldLevel}Stock.inherits(Primitive);Stock.method("innerClone",function(a){a.level=this.level;a.oldLevel=this.oldLevel;a.tasks=this.tasks;a.delay=this.delay});
Stock.method("setValue",function(a){this.level=a;this.cachedValue=void 0;simulate.valuedPrimitives=[];this.value()});Stock.method("print",function(){console.log(this.level.map(function(a){return a.value}))});Stock.method("preserveLevel",function(){for(var a=this.tasks.length-1;0<=a;a--)this.tasks[a].data.tentative=!1;this.oldLevel=this.level});
Stock.method("restoreLevel",function(){for(var a=this.tasks.length-1;0<=a;a--)this.tasks[a].data.tentative&&(this.tasks[a].remove(),this.tasks.splice(a,1));this.level=this.oldLevel});Stock.method("setDelay",function(a){this.delay=a=a||this.dna.delay});
Stock.method("setInitialValue",function(){var a;try{a=evaluateTree(this.equation,globalVars(this)).toNum()}catch(b){if(!b.substr)throw b;isLocal()&&console.log(b);"MSG:"==b.substr(0,4)?error(b.substr(4,b.length),this,!0):error(b,this,!0)}"boolean"==typeof a&&(a=a?new Material(1):new Material(0));if(a instanceof Vector){var c=this.dna;a.recurseApply(function(a){c.nonNegative&&0>a.value&&(a=new Material(0,c.units));a.units||(a.units=c.units);return a})}else this.dna.nonNegative&&0>a.value&&(a=new Material(0,
this.dna.units)),a.units||(a.units=this.dna.units);if(isUndefined(this.delay))this.level=a;else{var d=mult(a,div(simulate.userTimeStep,this.delay));this.initRate=div(a,this.delay.forceUnits(simulate.timeUnits));this.level=d;var e=this;simulate.tasks.addEvent(function(a,b,c){0<a.value&&lessThanEq(c,minus(e.delay,simulate.userTimeStep))&&(a=functionBank.min([a,minus(e.delay,b)]),e.level=plus(e.level,mult(a,e.initRate)))})}});
Stock.method("subtract",function(a){this.level=minus(this.level,a);if(this.dna.nonNegative)if(this.level instanceof Vector){var b=this.dna;this.level.recurseApply(function(a){return 0>a.value?new Material(0,b.units):a})}else 0>this.level.value&&(this.level=new Material(0,this.dna.units))});
Stock.method("add",function(a,b){if(isUndefined(this.delay)){if(this.level=plus(this.level,a),this.dna.nonNegative)if(this.level instanceof Vector){var c=this.dna;this.level.recurseApply(function(a){return 0>a.value?new Material(0,c.units):a})}else 0>this.level.value&&(this.level=new Material(0,this.dna.units))}else this.scheduleAdd(a,b)});
Stock.method("scheduleAdd",function(a,b,c){var d=this,c=c||this.delay,e,b=new Task({time:plus(b,c),data:{amnt:a,tentative:!0},priority:-100,name:"Conveyor Add ("+this.dna.name+")",action:function(){e=d.level;d.level=plus(d.level,a);if(d.dna.nonNegative)if(d.level instanceof Vector){var b=d.dna;d.level.recurseApply(function(a){return 0>a.value?new Material(0,b.units):a})}else 0>d.level.value&&(d.level=new Material(0,d.dna.units))},rollback:function(){d.level=e}});this.tasks.push(b);simulate.tasks.add(b)});
Stock.method("totalContents",function(){if(isDefined(this.delay)){for(var a=this.level,b=0;b<this.tasks.length;b++)greaterThan(this.tasks[b].time,simulate.time())&&lessThanEq(this.tasks[b].time,plus(simulate.time(),this.delay))&&(a=plus(a,this.tasks[b].data.amnt));greaterThan(this.delay,simulate.time())&&(a=plus(a,mult(this.initRate,minus(minus(this.delay,simulate.userTimeStep),simulate.time()))));return a}return this.level});
Stock.method("calculateValue",function(){null===this.level&&this.setInitialValue();if(isDefined(this.delay)&&4==this.dna.solver.RKOrder){for(var a=this.level,b=0;b<this.tasks.length;b++)greaterThan(this.tasks[b].time,simulate.time())&&lessThanEq(this.tasks[b].time,plus(simulate.time(),this.dna.solver.timeStep))&&(a=plus(a,this.tasks[b].data.amnt));return a}return this.level});function Converter(){Primitive.call(this);this.source=null;this.constructorFunction=Converter}Converter.inherits(Primitive);
Converter.method("innerClone",function(){});Converter.method("setSource",function(a){this.source=a});Converter.method("getInputValue",function(){var a;"*time"==this.source?a=simulate.time():(a=this.source.value().toNum())||error(getText("Undefined input value."),this,!1);return a});Converter.method("calculateValue",function(){return new Material(this.getOutputValue().value,this.dna.units)});
Converter.method("getOutputValue",function(){var a=this.getInputValue();if(0==this.dna.inputs.length)return new Material(0);for(var b=0;b<this.dna.inputs.length;b++)if("discrete"==this.dna.interpolation){if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:this.dna.outputs[b-1]}else if("linear"==this.dna.interpolation){if(eq(this.dna.inputs[b],a))return this.dna.outputs[b];if(greaterThan(this.dna.inputs[b],a))return 0==b?this.dna.outputs[0]:div(plus(mult(minus(a,this.dna.inputs[b-
1]),this.dna.outputs[b]),mult(minus(this.dna.inputs[b],a),this.dna.outputs[b-1])),minus(this.dna.inputs[b],this.dna.inputs[b-1]))}return this.dna.outputs[this.dna.outputs.length-1]});function Variable(){Primitive.call(this);this.constructorFunction=Variable}Variable.inherits(Primitive);Variable.method("innerClone",function(){});
Variable.method("calculateValue",function(){var a=evaluateTree(this.equation,globalVars(this));if("boolean"==typeof a)a=a?new Material(1):new Material(0);else if(a instanceof Vector)return a;a.units||(a.units=this.dna.units);return a});function Flow(){Primitive.call(this);this.rate=this.omega=this.alpha=null;this.RKPrimary=[];this.constructorFunction=Flow}Flow.inherits(Primitive);Flow.method("innerClone",function(){});Flow.method("setEnds",function(a,b){this.alpha=a;this.omega=b});
Flow.method("calculateValue",function(){this.predict();return this.rate.fullClone()});Flow.method("clean",function(){this.rate=null;this.RKPrimary=[]});
Flow.method("predict",function(a){if(null===this.rate||a){try{var b=evaluateTree(this.equation,globalVars(this)).toNum();if(!(b instanceof Vector||isFinite(b.value)))throw"MSG: "+getText("The result of this calculation is not finite. Flows must have finite values. Are you dividing by 0?");}catch(c){if(!c.substr)throw c;isLocal()&&console.log(c);"MSG:"==c.substr(0,4)?error(c.substr(4,c.length),this,!0):error(c,this,!0)}"boolean"==typeof b&&(b=b?new Material(1):new Material(0));this.rate=b.fullClone();
if(this.rate instanceof Vector){var d=this.dna;this.rate.recurseApply(function(a){a.units||(a.units=d.units);return a})}else this.rate.units||(this.rate.units=this.dna.units);this.testUnits(this.rate,!0);this.rate=mult(this.rate,this.dna.solver.timeStep);if(a)if(0<this.RKPrimary.length)this.RKPrimary[this.RKPrimary.length-1]=this.rate;else return;else this.RKPrimary.push(this.rate);4==this.dna.solver.RKOrder&&(1==this.dna.solver.RKPosition?this.rate=this.RKPrimary[0]:2==this.dna.solver.RKPosition?
this.rate=this.RKPrimary[1]:3==this.dna.solver.RKPosition?this.rate=this.RKPrimary[2]:4==this.dna.solver.RKPosition&&(this.rate=div(plus(plus(plus(this.RKPrimary[0],mult(new Material(2),this.RKPrimary[1])),mult(new Material(2),this.RKPrimary[2])),this.RKPrimary[3]),new Material(6))));this.rate=div(this.rate,this.dna.solver.timeStep);this.dna.onlyPositive&&(this.rate instanceof Vector?this.rate.recurseApply(function(a){return 0<=a.value?a:new Material(0,a.units)}):0>=this.rate.value&&(this.rate=new Material(0,
this.rate.units)))}});
Flow.method("apply",function(a,b){try{if(null!==this.rate){var c=this.rate.fullClone(),d=c=mult(c,a),e=c,f=!1;if(null!==this.alpha){var g=this.alpha.value();c instanceof Vector&&(!(g instanceof Vector)||g.depth()<c.depth())?(d=c.fullClone().collapseDimensions(g),f=!0):g instanceof Vector&&(!(c instanceof Vector)||g.depth()>c.depth())&&error(getText("The alpha of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the alpha."),this,
!0)}null!==this.omega&&(g=this.omega.value(),c instanceof Vector&&(!(g instanceof Vector)||g.depth()<c.depth())?(e=c.fullClone().collapseDimensions(g),f=!0):g instanceof Vector&&(!(c instanceof Vector)||g.depth()>c.depth())&&error(getText("The omega of the flow is a vector with a higher order than the flow rate. There has to be at least one element in the flow rate for each element in the omega."),this,!0));if(f)null!==this.alpha&&this.alpha.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),
this.alpha,!1),null!==this.omega&&this.omega.dna.nonNegative&&error(getText("Cannot use non-negative stocks when the flow rate is a vector that needs to be collapsed."),this.omega,!1);else{if(null!==this.omega&&this.omega.dna.nonNegative){var h=plus(this.omega.value().toNum(),c);h instanceof Vector?(h.recurseApply(function(a){return 0>a.value?a:new Material(0,a.units)}),c=minus(c,h)):0>h.value&&(c=minus(c,h))}null!==this.alpha&&this.alpha.dna.nonNegative&&(h=minus(this.alpha.value().toNum(),c),h instanceof
Vector?(h.recurseApply(function(a){return 0>a.value?a:new Material(0,a.units)}),c=minus(c,h),c=minus(c,h)):0>h.value&&(c=plus(c,h)));if(null!==this.omega&&this.omega.dna.nonNegative)if(c instanceof Vector)for(var k=functionBank.flatten([plus(this.omega.value().toNum(),c)]),g=0;g<k.items.length;g++)0>k.items[g].value&&error(getText("Inconsistent non-negative constraints for flow."),this,!1);else 0>plus(this.omega.value().toNum(),c).value&&error(getText("Inconsistent non-negative constraints for flow."),
this,!1)}k=0;try{null!==this.omega&&(k=1,f?this.omega.add(e,b):this.omega.add(c,b)),null!==this.alpha&&(k=2,f?this.alpha.subtract(d,b):this.alpha.subtract(c,b))}catch(l){c="",1==k?c=this.omega:2==k&&(c=this.alpha),error(getText("Incompatible units for flow %s and connected stock %s. Stock has units of %s. The flow should have the equivalent units divided by some time unit such as Years.","<i>["+clean(this.dna.name)+"]</i>","<i>["+clean(c.dna.name)+"]</i>","<i>"+(c.dna.units?clean(c.dna.units.toString()):
"unitless")+"</i>"),this,!1)}}}catch(m){if(!m.substr)throw m;"MSG:"==m.substr(0,4)?error(m.substr(4,m.length),this,!0):error(m,this,!0)}});function globalVars(a){return a instanceof Agent?{"-parent":varBank,self:a}:a.container?{"-parent":varBank,self:a.container}:varBank};function TaskQueue(a){a=a||{};this.tasks=new RedBlackTree;this.onMoveEvents=[];this.setTime(a.start);this.debug=!1;this.end=a.end;this.states={}}
TaskQueue.prototype.print=function(){console.log("Current Time: "+this.time.value);for(this.tasks.goMin();null!==this.tasks.current();)console.log(this.tasks.current().name),console.log("    Time: "+this.tasks.current().time.value),console.log("    Priority: "+this.tasks.current().priority),isDefined(this.tasks.current().expires)&&console.log("    Expires: "+this.tasks.current().expires),isDefined(this.tasks.current().skip)&&console.log("    Skip: "+this.tasks.current().skip),this.tasks.next()};
TaskQueue.prototype.addEvent=function(a){this.onMoveEvents.push(a)};TaskQueue.prototype.fireEvents=function(a,b,c){this.debug&&console.log("Firing Events");for(var d=0;d<this.onMoveEvents.length;d++)this.onMoveEvents[d](a,b,c)};TaskQueue.prototype.setTime=function(a){if(isUndefined(this.time)||neq(a,this.time)){var b=this.time;this.time=a;isDefined(b)&&this.fireEvents(minus(a,b),b,a)}};
TaskQueue.prototype.moveTime=function(a){this.debug&&console.log("Shifting time by: "+a);this.moveTo(plus(this.time,a))};
TaskQueue.prototype.moveTo=function(a){if(!eq(this.time,a)){this.debug&&console.log("Shifting time to: "+a);if(null!==this.tasks.current()){for(var b=this.tasks.max().time,c=this.tasks.min().time;lessThan(this.time,a)&&!greaterThan(this.time,b);)this.step();for(;greaterThan(this.time,a)&&greaterThan(this.time,c);)this.stepBack()}this.setTime(a);this.debug&&console.log("Time shift to  "+a+" completed.")}};TaskQueue.prototype.add=function(a){a.queue=this;this.tasks.add(a)};
TaskQueue.prototype.step=function(){isUndefined(this.time)&&(this.tasks.goMin(),this.setTime(this.tasks.current().time));this.tasks.current();if(null!==this.tasks.current()){var a=this.tasks.current().deadAction;this.tasks.current().execute();if(!a&&this.tasks.current().timeShift){this.tasks.current().timeShift();return}this.tasks.next()}null!==this.tasks.current()?this.setTime(this.tasks.current().time):(this.tasks.next(),this.setTime(mult(this.tasks.max().time,new Material(10))))};
TaskQueue.prototype.stepBack=function(){if(isUndefined(this.time))this.tasks.goMin();else{null===this.tasks.current()?this.tasks.goMax():this.tasks.previous();for(var a=this.tasks.current().time;null!==this.tasks.current()&&eq(a,this.tasks.current().time);)this.tasks.current().rollback(),this.tasks.previous();null===this.tasks.current()?this.tasks.goMin():this.tasks.next()}this.setTime(this.tasks.current().time)};
TaskQueue.prototype.atStart=function(){return isUndefined(this.time)||this.tasks.current()===this.tasks.min()};TaskQueue.prototype.completed=function(){return isDefined(this.time)&&(greaterThan(this.time,this.end)||null===this.tasks.current())};TaskQueue.prototype.remove=function(a){a==this.tasks.current()&&this.tasks.next();this.tasks.remove(a)};var TaskId=0;
function Task(a){this.id=TaskId++;this.name=a.name;this.time=a.time;this.action=a.action;this.reverse=a.rollback;this.priority=a.priority||0;this.expires=a.expires;this.skip=a.skip;this.timeShift=a.timeShift;this.data=a.data;this.blocker=a.blocker;this.deadReverse=this.deadAction=!1;this.action&&(this.action.task=this);this.reverse&&(this.action.reverse=this)}
Task.prototype.execute=function(){if(this.action&&!this.deadAction&&(!this.blocker||!this.queue.states[this.blocker]))isDefined(this.skip)&&0<this.skip?(this.skip--,this.queue.debug&&console.log("Skipping: "+this.name)):(this.queue.debug&&console.log("%c Executing: "+this.name+" (Time: "+this.time+")","color:blue"),isDefined(this.expires)&&(this.expires--,this.queue.debug&&console.log("    Current count before expire: "+this.expires),0>=this.expires&&(this.queue.debug&&console.log("    Task expired."),
this.deadAction=!0))),this.action()};Task.prototype.rollback=function(){if(this.reverse&&!this.deadReverse&&(!this.blocker||!this.queue.states[this.blocker]))this.queue.debug&&console.log("Rolling back: "+this.name+" (Time: "+this.time+")"),isDefined(this.expires)&&0>=this.expires&&(this.queue.debug&&console.log("    Rollback expired."),this.deadReverse=!0),this.reverse()};Task.prototype.reschedule=function(a){this.queue.remove(this);this.time=a;this.queue.add(this)};Task.prototype.remove=function(){this.queue.remove(this)};
Task.prototype.kill=function(){this.deadReverse=this.deadAction=!0};Task.prototype.block=function(a){a=a||this.blocker;this.queue.states[a]=!0};Task.prototype.unblock=function(a){a=a||this.blocker;this.queue.states[a]=!1};Task.prototype.compare=function(a){return eq(a.time,this.time)?a.priority==this.priority?a.id==this.id?0:a.id<this.id?1:-1:a.priority<this.priority?1:-1:lessThan(a.time,this.time)?1:-1;throw"Comparison error";};Task.prototype.toString=function(){return this.name+" - "+this.id};
function scheduleRepeated(a,b,c,d,e){for(var e=div(minus(e,c),d),f=0;f<=e;f++)b.time=plus(c,mult(d,new Material(f))),a.add(new Task(b))};function Simulator(){this.lastRandPos=this.randLoc=-1;this.previousRandLists=[];this.valuedPrimitives=[];this.distanceCache={};this.sliders={};this.ids={};this.idCount=0}
Simulator.prototype.setup=function(a){this.model=a.model;this.solversCompletedFirstPass=0;this.timeStart=this.model.timeStart;this.timeLength=this.model.timeLength;this.timePause=this.model.timePause;this.timeEnd=plus(this.timeStart,this.timeLength);this.timeStep=this.model.solvers.base.timeStep;this.userTimeStep=this.model.solvers.base.userTimeStep;this.timeUnits=this.timeStart.units;this.timeUnits.addBase();this.oldAggregateSeries=[];this.distanceCache={};this.tasks=new TaskQueue({start:this.timeStart,
end:this.timeEnd})};Simulator.prototype.getID=function(a){this.ids[a]||(this.idCount++,this.ids[a]=this.idCount);return this.ids[a]};Simulator.prototype.time=function(){return this.tasks.time};Simulator.prototype.frame=function(a,b){for(var c=a.length,d=0;d<c;d++)a[d].storeValue();this.printStates(b)};
Simulator.prototype.step=function(a){if(!a.completedFirstPass&&(a.completedFirstPass=!0,this.solversCompletedFirstPass++,this.solversCompletedFirstPass==Object.keys(this.model.solvers).length&&this.config.onCompletedFirstPass))this.config.onCompletedFirstPass();if(0<a.displayed.length)for(var b=this.results[a.displayed[0].id].results.length;b<this.results.Time.length;b++)for(var c=0;c<a.displayed.length;c++)this.results[a.displayed[c].id].results.push(this.results.data[b][a.displayed[c].id]);if(this.config.onStep)this.config.onStep(a)};
Simulator.prototype.sleep=function(a){this.config&&!this.config.silent&&(this.shouldSleep=!0,this.shouldUpdateScripter=a)};Simulator.prototype.resume=function(){try{this.run()}catch(a){return checkErr(a,this.config)}};Simulator.prototype.completed=function(){return this.terminated||this.tasks.completed()};Simulator.prototype.terminate=function(){this.terminated||(clearTimeout(this.timer),this.sleep(),this.terminated=!0,this.resultsWindow&&this.resultsWindow.scripter.finished())};
Simulator.prototype.run=function(a){var b=this,c=function(a,d){b.tasks.add(new Task({time:a,expires:1,name:"Interval Pause",priority:1,action:function(){b.sleep(!0);d&&lessThan(plus(a,b.timePause),b.timeEnd)&&c(plus(a,b.timePause),d)}}));b.tasks.add(new Task({time:a,expires:1,name:"Interval Pause",priority:1,action:function(){if(b.valueChange){simulate.valuedPrimitives=[];for(var a in b.model.solvers){for(var c=b.model.solvers[a],d=0;d<c.valued.length;d++)c.valued[d].clearCached();for(d=0;d<c.flows.length;d++)c.flows[d].predict(!0)}b.valueChange=
!1}}}))};if(a){this.config=a;for(var a=Object.keys(this.model.solvers),d=0;d<a.length;d++)this.createSolver(this.model.solvers[a[d]]);this.timePause&&!this.config.silent&&c(plus(this.timeStart,this.timePause),!0);this.tasks.tasks.goMin()}this.wakeUpTime=(new Date).getTime();try{for(;!this.completed();)if(this.tasks.step(),this.shouldSleep){for(var e in this.model.solvers)updateDisplayed(this.model.solvers[e]);this.shouldUpdateScripter&&(this.resultsWindow.scripter.endMode="pause",this.shouldUpdateScripter=
!1);this.shouldSleep=!1;return}}catch(f){if("STOP"!=f.msg)throw f;}this.results=formatSimResults(this.results);if(this.config.onSuccess)this.config.onSuccess(this.results);this.terminate();if(this.resultsWindow)for(e in this.results.window=this.resultsWindow,this.model.solvers)updateDisplayed(this.model.solvers[e]);return this.results};Simulator.prototype.progress=function(){return div(minus(this.time(),this.timeStart),this.timeLength).value};
Simulator.prototype.printStates=function(a){var b=parseFloat(this.time().value.toPrecision(20));if(-1==this.results.Time.indexOf(b)){for(var c=this.results.Time.length;0<c;c--)if(this.results.Time[c-1]<b){this.results.Time.splice(c,0,b);this.results.data.splice(c,0,{});break}0==c&&(this.results.Time.splice(0,0,b),this.results.data.splice(0,0,{}))}b=this.results.data[this.results.Time.indexOf(b)];for(c=0;c<a.length;c++){var d=a[c];if(!(d instanceof State&&isDefined(b[d.id])))if(d instanceof Agents)this.results[d.id].dataMode=
"agents",b[d.id]={current:d.collectData()};else{var e=d.value();if(e instanceof Vector&&!e.names)b[d.id]=e,this.results[d.id].dataMode="auto";else if(e instanceof Vector){var f=this;e.recurseApply(function(a){return f.adjustNum(d,a)});b[d.id]=e}else b[d.id]=this.adjustNum(d,e)}}};
Simulator.prototype.unitsToBase=function(a,b,c){var d=a.id+"-"+(b?b.id:"");if(d in this.unitsToBase)return this.unitsToBase[d];var e=1;c&&(e=this.timeUnits.toBase);c=1;b&&(b.addBase(),c=b.toBase);this.unitsToBase[d]=fn["/"](fn["/"](sn("#e"+c),a.dna.toBase),sn("#e"+e));return this.unitsToBase[d]};
Simulator.prototype.adjustNum=function(a,b){a.unitless&&b.units&&error(getText("The result of the calculation has units %s, but the primitive is unitless. Please set the units for the primitive so we can determine the proper output.",b.units.toString()),findID(a.id),!0);a instanceof Flow&&!a.dna.flowUnitless&&(b=mult(b,new Material(1,this.timeUnits)));b=a instanceof State||!b.units&&!a instanceof Flow?b.value:fn["*"](b.value,this.unitsToBase(a,b.units,a instanceof Flow));return b+0};
Simulator.prototype.createSolver=function(a){function b(c,d){q.tasks.add(new Task({time:c,expires:1,name:"RK1 Solver - "+a.id,action:function(){for(var l=e.length,m=0;m<l;m++)e[m].clean();simulate.valuedPrimitives=[];l=h.length;for(m=0;m<l;m++)h[m].clearCached();q.frame(h,k);l=f.length;for(m=0;m<l;m++)f[m].dna.recalculate&&!f[m].block&&updateTrigger.call(f[m]);l=g.length;for(m=0;m<l;m++)g[m].dna.recalculate&&updateTrigger.call(g[m]);q.step(a);d&&lessThanEq(plus(c,n),q.timeEnd)&&b(plus(c,n),!0)}}))}
function c(b,o){q.tasks.add(new Task({time:b,name:"RK4 Solver (Init)  - "+a.id,priority:-10,expires:1,blocker:l+" init",action:function(){for(var b=e.length,c=0;c<b;c++)e[c].clean();simulate.valuedPrimitives=[];b=h.length;for(c=0;c<b;c++)h[c].clearCached();a.RKPosition=1;this.unblock(l+" start");this.block()}}));q.tasks.add(new Task({time:b,name:"RK4 Solver (step 1) - "+a.id,priority:-5,expires:4,blocker:l+" start",action:function(){if(1<a.RKPosition){simulate.valuedPrimitives=[];for(var e=h.length,
m=0;m<e;m++)h[m].clearCached(),h[m].pastValues.pop()}q.frame(h,k);if(4==a.RKPosition){e=f.length;for(m=0;m<e;m++)f[m].dna.recalculate&&!f[m].block&&updateTrigger.call(f[m]);e=g.length;for(m=0;m<e;m++)g[m].dna.recalculate&&updateTrigger.call(g[m]);this.unblock(l+" init");o&&lessThanEq(plus(b,n),q.timeEnd)&&c(plus(b,n),!0);q.step(a)}else if(eq(simulate.time(),simulate.timeEnd))q.step(a);else{e=d.length;for(m=0;m<e;m++)d[m].preserveLevel()}this.block();this.unblock(l+" mid")},rollback:function(){for(var a=
d.length,b=0;b<a;b++)d[b].restoreLevel()}}));q.tasks.add(new Task({time:plus(b,m),name:"RK4 Solver (step 2,3) - "+a.id,priority:-10,expires:2,blocker:l+" mid",action:function(){simulate.valuedPrimitives=[];for(var b=h.length,c=0;c<b;c++)h[c]instanceof State||h[c].clearCached();a.RKPosition++;b=e.length;for(c=0;c<b;c++)e[c].rate=null,e[c].predict();this.unblock(l+" start");this.block()},timeShift:function(){q.tasks.moveTime(negate(m))}}));q.tasks.add(new Task({time:plus(b,n),name:"RK4 Solver (step 4) - "+
a.id,priority:-30,expires:1,action:function(){simulate.valuedPrimitives=[];for(var b=h.length,c=0;c<b;c++)h[c]instanceof State||h[c].clearCached();a.RKPosition++;b=e.length;for(c=0;c<b;c++)e[c].rate=null,e[c].predict();this.unblock(l+" start")},timeShift:function(){q.tasks.moveTime(negate(n))}}))}var d=a.stocks,e=a.flows,f=a.actions,g=a.transitions,h=a.valued,k=a.displayed,l=a.id,m=a.timeStep,n=a.userTimeStep,o=a.RKOrder;a.RKPosition=1;for(var q=this,r=f.length,u=0;u<r;u++)"Condition"!==f[u].dna.trigger&&
updateTrigger.call(f[u]);r=g.length;for(u=0;u<r;u++)updateTrigger.call(g[u]);if(1==o)this.tasks.addEvent(function(a,b,c){for(var d=e.length,f=0;f<d;f++)e[f].apply(a,b,c)}),b(this.timeStart,!0);else if(4==o)this.tasks.addEvent(function(a,b,c){if(0<a.value)for(var d=e.length,f=0;f<d;f++)e[f].apply(a,b,c)}),c(this.timeStart,!0);else throw"Unknown solution algorithm.";};var simulate,model,strictUnits=null;function runSimulation(a){try{return innerRunSimulation(a)}catch(b){return checkErr(b,a)}}
function checkErr(a,b){simulate&&simulate.terminate();isLocal()&&console.log(a);var c;a.msg?c={error:a.msg,errorPrimitive:isDefined(a.primitive)?findID(a.primitive.id):null}:(c={error:getText("An unknown simulation error occurred"),errorPrimitive:null},"string"==typeof a?("MSG:"===a.substr(0,4)&&(c.error=a.substr(4)),a={msg:c.error}):a.msg=c.msg);simulate.results||(simulate.results={});simulate.results.error=a.msg;if(b.onError)b.onError(c);if(b.silent)return c;handleErrorObject(a)}var timeUnits=null;
function innerRunSimulation(a){simulate=new Simulator;bootCalc();allPlaceholders=[];model={submodels:{base:{id:"base",DNAs:[],agents:[{children:[],childrenId:{}}],size:1}}};var b=getSetting();strictUnits=isTrue(b.getAttribute("StrictUnits"));timeUnits=b.getAttribute("TimeUnits").toLowerCase();var c=getUnitStore([timeUnits],[1]);model.timeLength=new Material(sn("#i"+b.getAttribute("TimeLength")),c);model.timeStart=new Material(sn("#i"+b.getAttribute("TimeStart")),c);model.timeStep=new Material(sn("#i"+
b.getAttribute("TimeStep")),c);0<b.getAttribute("TimePause")&&(model.timePause=new Material(sn("#i"+b.getAttribute("TimePause")),c));simulate.timeUnits=c;var d=b.getAttribute("Units");if(isDefined(d)){for(var e=b.getAttribute("Units").split("\n"),f=[],g=[],h=[],d=0;d<e.length;d++){var k=e[d].split("<>");if(""!=Ext.String.trim(k[2])){f.push(k[0]);g.push(k[1]);k=createUnitStore(k[2]);if(isUndefined(k))throw{msg:'You cannot define a units synonym for "unitless".'};h.push(k.toStringShort())}}loadUnits(f,
h,g)}e={};e.base={timeStep:new Material(sn("#i"+b.getAttribute("TimeStep")),c),algorithm:b.getAttribute("SolutionAlgorithm"),id:"base",maxLoaded:-1};model.solvers=e;f=findType("Folder");for(d=0;d<f.length;d++)if(g=f[d].getAttribute("Solver"))g=JSON.parse(g),g.enabled&&(e[f[d].id]=g,e[f[d].id].timeStep=new Material(sn("#i"+e[f[d].id].timeStep),c),e[f[d].id].id=f[d].id,e[f[d].id].maxLoaded=-1);c=Object.keys(e);for(d=0;d<c.length;d++)g=e[c[d]],g.userTimeStep=g.timeStep,g.RKOrder="RK4"==g.algorithm?4:
1,g.timeStep=4==g.RKOrder?div(g.userTimeStep,new Material(2)):g.userTimeStep,g.stocks=[],g.flows=[],g.transitions=[],g.actions=[],g.states=[],g.valued=[],g.displayed=[];if(isDefined(b.getAttribute("Macros")))try{evaluateMacros(b.getAttribute("Macros"))}catch(l){throw showMacros(),a=getText("An error with the macros prevented the simulation from running."),l.msg?a=a+"<br/><br/>"+l.msg:"MSG:"==l.toString().substr(0,4)&&(a=a+"<br/><br/>"+l.toString().substr(4)),{msg:a};}b=primitives();for(d=0;d<b.length;d++)if("Agents"==
b[d].value.nodeName){var m=b[d],f=m.getAttribute("Agent"),c=parseInt(f,10);c==f&&(f=c);if(isUndefined(f))throw{msg:getText("You must select a base agent for %s.","<i>"+clean(m.getAttribute("name"))+"</i>"),primitive:m,showEditor:!1};c=new Agents;c.dna=new DNA(m,f);c.id=m.id;c.agentId=f;c.createIds();c.dna.solver=folderSolvers(m,e);c.dna.solver.displayed.push(c);c.geoDimUnits=m.getAttribute("GeoDimUnits");c.geoDimUnitsObject=createUnitStore(m.getAttribute("GeoDimUnits"));c.geoWidth=simpleUnitsTest(simpleEquation(m.getAttribute("GeoWidth")),
c.geoDimUnitsObject,m);c.geoHeight=simpleUnitsTest(simpleEquation(m.getAttribute("GeoHeight")),c.geoDimUnitsObject,m);c.halfWidth=div(c.geoWidth,new Material(2));c.halfHeight=div(c.geoHeight,new Material(2));c.geoWrap=isTrue(m.getAttribute("GeoWrap"));c.placement=m.getAttribute("Placement");c.placementFunction=m.getAttribute("PlacementFunction");c.network=m.getAttribute("Network");c.networkFunction=m.getAttribute("NetworkFunction");c.agentBase=findID(f).getAttribute("AgentBase")||"";""!=c.agentBase.trim()&&
(c.agentBase=simpleEquation(c.agentBase,varBank));g=getChildren(findID(f));c.DNAs=[];for(f=0;f<g.length;f++)modelType(g[f].value.nodeName)&&c.DNAs.push(getDNA(g[f],e)),"State"==g[f].value.nodeName&&c.stateIds.push(g[f].id);c.size=m.getAttribute("Size");c.agents=[];c.dna.agents=c;model.submodels[m.id]=c;model.submodels.base.DNAs.push(c.dna)}else inAgent(b[d])||modelType(b[d].value.nodeName)&&model.submodels.base.DNAs.push(getDNA(b[d],e));for(var n in model.submodels){n=model.submodels[n];for(f=0;f<
n.size;f++){"base"==n.id?b=n.agents[0]:(b=new Agent,b.container=n,b.index=f,b.children=[],b.childrenId={},b.agentId=m.id,b.createIds(),n.agentBase&&(b.vector.parent=n.agentBase),n.agents.push(b));for(d=0;d<n.DNAs.length;d++)decodeDNA(n.DNAs[d],b)}}simulate.setup({model:model});for(n in model.submodels){n=model.submodels[n];for(f=0;f<n.size;f++)for(d=0;d<n.DNAs.length;d++)linkPrimitive(n.agents[f].children[d],n.DNAs[d])}for(n in model.submodels){n=model.submodels[n];for(f=0;f<n.size;f++)setAgentInitialValues(n.agents[f])}for(n in model.submodels)if("base"!=
n){try{buildNetwork(model.submodels[n])}catch(o){throw isLocal()&&console.log(o),a=getText("An error with the custom network function prevented the simulation from running."),o.msg?a=a+"<br/><br/>"+o.msg:"MSG:"==o.toString().substr(0,4)&&(a=a+"<br/><br/>"+o.toString().substr(4)),{msg:a,primitive:model.submodels[n].cell,showEditor:!1};}try{buildPlacements(model.submodels[n])}catch(q){throw isLocal()&&console.log(q),a=getText("An error with the agent placement function prevented the simulation from running."),
q.msg?a=a+"<br/><br/>"+q.msg:"MSG:"==q.toString().substr(0,4)&&(a=a+"<br/><br/>"+q.toString().substr(4)),{msg:a,primitive:model.submodels[n].cell,showEditor:!1};}}simulate.results={Time:[],data:[]};simulate.displayInformation={ids:[],times:[],objects:[]};model.submodels.base.agents[0].children.forEach(function(a){if(!(a instanceof Action||a instanceof Transition)){simulate.displayInformation.objects.push(a);simulate.displayInformation.ids.push(a.id);var b={};a instanceof Agents?(b.width=a.geoWidth,
b.height=a.geoHeight,b.units=a.geoDimUnitsObject,b.states=a.states()):a.dna.solver.displayed.push(a);simulate.results[a.id]={data:b,results:[],dataMode:"float"}}});if(a.silent)return formatSimResults(simulate.run(a));n=div(model.timeLength,model.timeStep);for(d=0;d<=n;d++)simulate.displayInformation.times.push(plus(model.timeStart,mult(model.timeStep,new Material(d))).value);var r=a.onSuccess;a.onSuccess=function(a){updateDisplayed(null);r&&r(a)};a.onCompletedFirstPass=function(){simulate.displayInformation.colors=
[];simulate.displayInformation.headers=[];simulate.displayInformation.agents=[];simulate.displayInformation.displayedHeaders=[];simulate.displayInformation.displayedIds=[];simulate.displayInformation.renderers=[];simulate.displayInformation.elementIds=[];simulate.displayInformation.res=simulate.results;for(var a=[],b=0;b<simulate.displayInformation.ids.length;b++){var c=simulate.displayInformation.ids[b],d=simulate.displayInformation.objects[b],e=d.dna;simulate.displayInformation.displayedIds.push(c);
simulate.displayInformation.displayedHeaders.push(e.name);if("Agents"==e.type){var f=d.stateIds;simulate.results[c].states=f;for(d=0;d<f.length;d++){var g=findID(f[d]);a.push(c);simulate.displayInformation.elementIds.push("e"+c+"-"+f[d]);simulate.displayInformation.headers.push(getName(g));simulate.displayInformation.colors.push(getLineColor(g));"float"==simulate.results[c].dataMode?simulate.displayInformation.renderers.push(commaStr):"agents"==simulate.results[c].dataMode?simulate.displayInformation.renderers.push(function(a){return a}):
simulate.displayInformation.renderers.push(void 0)}simulate.displayInformation.agents[c.toString()]={id:c,item:e.cell,data:simulate.results[c].data,results:simulate.results[c].results}}else if(simulate.results.data[0][c]instanceof Vector&&simulate.results.data[0][c].names){f=getLineColor(e.cell);g=simulate.results.data[0][c].fullNames();simulate.results[c].indexedFullNames=g.slice();for(d=0;d<g.length;d++)g[d]=g[d].join(", ");simulate.results[c].indexedNames=g;for(d=0;d<g.length;d++)a.push(c),simulate.displayInformation.elementIds.push("e"+
c+"-"+d),simulate.displayInformation.headers.push(e.name+" ("+g[d]+")"),simulate.displayInformation.colors.push(f),simulate.displayInformation.renderers.push(commaStr)}else a.push(c),simulate.displayInformation.elementIds.push("e"+c),simulate.displayInformation.headers.push(e.name),simulate.displayInformation.colors.push(getLineColor(e.cell)),"float"==simulate.results[c].dataMode?simulate.displayInformation.renderers.push(commaStr):simulate.displayInformation.renderers.push(void 0)}c=[{type:"float",
name:"Time"},{type:"int",name:"id"}];for(b=0;b<simulate.displayInformation.elementIds.length;b++)c.push({type:"auto",name:simulate.displayInformation.elementIds[b],defaultValue:void 0});simulate.displayInformation.store=new Ext.data.Store({fields:c,data:void 0});simulate.displayInformation.store.maxLoaded=-1;simulate.displayInformation.ids=a};var u=a.onStep;a.onStep=function(a){var b=!1,c=simulate.progress();if(!simulate.shouldSleep){var d=(new Date).getTime()-simulate.wakeUpTime;if(!simulate.resultsWindow&&
100<d||600<d)updateDisplayed(a),b=!0,simulate.timer=setTimeout(function(){simulate.resume()},20),simulate.sleep()}1==c&&!b&&updateDisplayed(a);u&&u(a)};var w=a.onError;a.onError=function(a){try{for(var b in simulate.model.solvers)updateDisplayed(simulate.model.solvers[b])}catch(c){}simulate.resultsWindow&&(simulate.resultsWindow.scripter.pause(!1),simulate.resultsWindow.scripter.finished());w&&w(a)};simulate.run(a)}
function formatSimResults(a){isUndefined(a.error)&&(a.error="none",a.errorPrimitive=null);a.names={};for(var b=model.submodels.base.agents[0].children,c=0;c<b.length;c++)a.names[b[c].name]=b[c].id;a.value=function(a){return this[a.id].results};a.lastValue=function(a){return this[a.id].results[this[a.id].results.length-1]};a.Time&&(a.periods=a.Time.length,a.times=a.Time);return a}
function createUnitStore(a){return""==a.trim()||"unitless"==a.trim().toLowerCase()?void 0:simpleEquation("{1 "+a+"}").units}function simpleEquation(a,b,c,d){b||(b={});c||(c={});d||(d=trimTree(createTree(a),c));return evaluateTree(d,b)}
function simpleNum(a,b){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleNum(a,b)}));if(!b&&a.units)throw getText("The result of the calculation has units %s, but no units are specified for the calculation. Please set the units for the calculation so we can determine the proper output.",a.units.toString());return a.units?(a.units.addBase(),b.addBase(),0+fn["*"](a.value,fn["/"](sn("#e"+a.units.toBase),b.toBase))):0+a.value}
function simpleUnitsTest(a,b,c,d){if(a instanceof Vector)return new Vector(a.items.map(function(a){return simpleUnitsTest(a,b,c,d)}));if(!a.units&&!b)return a;if(a.units){if(a.units===b)return a;var e=convertUnits(a.units,b,!1);if(0==e)throw isLocal()&&(console.log(a.units),console.log(b)),{msg:getText("Wrong units generated. Expected %s, and got %s.","<i>"+clean(b?b.toString():"unitless")+"</i>","<i>"+clean(a.units?a.units.toString():"unitless")+"</i>"),primitive:c,showEditor:d};a.value*=e;a.units=
b;return a}a.units=b;return a}function handleErrorObject(a){isLocal()&&console.log(a);if(a.msg){if(isDefined(a.primitive)){var b=findID(a.primitive.id);highlight(b);a.showEditor&&showEditor(b)}mxUtils.alert(a.msg)}else a.error?mxUtils.alert(a):mxUtils.alert(getText("An unknown model simulation error occurred."))}function evaluateMacros(a){evaluateTree(trimTree(createTree(a),{}),varBank)}
function DNA(a,b){this.type=a.value.nodeName;this.cell=a;var b=b||a.id,c=parseInt(a.id,10);this.id=c==a.id?c:b;this.name=a.getAttribute("name");this.units=null}
function getDNA(a,b){var c=new DNA(a);c.solver=folderSolvers(a,b);"Variable"===c.type&&isTrue(a.getAttribute("ShowSlider"))&&(c.slider=!0);if("Flow"==c.type||"Transition"==c.type)null!==a.target&&(c.targetId=orig(a.target).id),null!==a.source&&(c.sourceId=orig(a.source).id);if("Converter"==c.type)c.value=getValue(a);else try{c.value=createTree(getValue(a))}catch(d){isLocal()&&console.log(d),error(getText("The primitive %s has an equation error that must be corrected before the model can be run.",
"<i>"+clean(c.name)+"</i>"),a,!0)}if("Action"==c.type){c.trigger=a.getAttribute("Trigger");c.repeat=isTrue(a.getAttribute("Repeat"));c.recalculate=isTrue(a.getAttribute("Recalculate"))||"Condition"==c.trigger;try{c.triggerValue=createTree(a.getAttribute("Value"))}catch(e){error(getText("The trigger for %s has an equation error that must be corrected before the model can be run.","<i>"+clean(c.name)+"</i>"),c.cell,!1)}}else if("Transition"==c.type)c.trigger=a.getAttribute("Trigger"),c.repeat=isTrue(a.getAttribute("Repeat")),
c.recalculate=isTrue(a.getAttribute("Recalculate"))||"Condition"==c.trigger;else if("State"==c.type)if(isUndefined(a.getAttribute("Residency"))||""==a.getAttribute("Residency").trim())c.residency=null;else try{c.residency=evaluateTree(trimTree(createTree(a.getAttribute("Residency")),{})),c.residency.units||(c.residency.units=simulate.timeUnits),eq(c.residency,new Material(0,simulate.timeUnits))&&(c.residency=null)}catch(f){throw isLocal()&&console.log(f),{msg:getText("Invalid state residency."),primitive:a,
showEditor:!1};}else if("Stock"==c.type){if(c.nonNegative=isTrue(a.getAttribute("NonNegative")),"Conveyor"==a.getAttribute("StockMode")){c.stockType="Conveyor";try{c.delay=evaluateTree(trimTree(createTree(a.getAttribute("Delay")),{})),c.delay.units||(c.delay.units=simulate.timeUnits)}catch(g){throw isLocal()&&console.log(g),{msg:getText("Invalid stock delay."),primitive:a,showEditor:!1};}}}else if("Flow"==c.type)c.onlyPositive=isTrue(a.getAttribute("OnlyPositive"));else if("Converter"==c.type){c.source=
a.getAttribute("Source");c.interpolation="Linear"==a.getAttribute("Interpolation")?"linear":"discrete";if(isUndefined(a.getAttribute("Data"))||""==a.getAttribute("Data").trim())throw{msg:getText("The converter %s does not have any data.","<i>"+clean(c.name)+"</i>"),primitive:a,showEditor:!0};var h=a.getAttribute("Data").split(";"),k=[],l=[],m;m="Time"==c.source?simulate.timeUnits:createUnitStore(orig(findID(c.source)).getAttribute("Units"));for(var n=0;n<h.length;n++){var o=h[n].split(",");k.push(new Material(sn(Ext.String.trim(o[0])),
m));l.push(new Material(sn(Ext.String.trim(o[1]))))}c.inputs=k;c.outputs=l}if("State"!=c.type){if("Transition"!=c.type&&"Action"!=c.type){h=a.getAttribute("Units");try{"Flow"!=c.type||""!=h.trim()&&"unitless"!=h.trim().toLowerCase()?c.units=createUnitStore(h):(c.units=getUnitStore([timeUnits],[-1]),c.flowUnitless=!0)}catch(q){throw isLocal()&&console.log(q),{msg:getText('Invalid units specified for primitive: "%s".',clean(h)),primitive:a,showEditor:!0};}}else"Timeout"==c.trigger&&(c.units=simulate.timeUnits);
c.maxConstraint=a.getAttribute("MaxConstraint");c.maxConstraintType=isTrue(a.getAttribute("MaxConstraintUsed"))?1:null;c.minConstraint=a.getAttribute("MinConstraint");c.minConstraintType=isTrue(a.getAttribute("MinConstraintUsed"))?1:null}c.units?(c.units.addBase(),c.toBase=c.units.toBase):c.toBase=1;c.unitless=!c.units;return c}
function folderSolvers(a,b){if(!a||null==a)return b.base;if("Agents"==a.value.nodeName){var c=a.getAttribute("Agent");if(b[c])return b[c]}return(c=getParent(a))&&b[c.id]?b[c.id]:folderSolvers(c,b)}
function decodeDNA(a,b){var c=a.type,d;"Variable"==c?d=new Variable:"State"==c?d=new State:"Transition"==c?d=new Transition:"Action"==c?d=new Action:"Stock"==c?d=new Stock:"Flow"==c?d=new Flow:"Converter"==c&&(d=new Converter);d?(d.dna=a,d.id=a.id,d.index=b.index,d.agentId=b.agentId,d.container=b,d.createIds(),b.children.push(d),b.childrenId[d.id]=d,a.slider&&(simulate.sliders[a.id]?simulate.sliders[a.id].push(d):simulate.sliders[a.id]=[d]),d instanceof Action?a.solver.actions.push(d):d instanceof
Transition?a.solver.transitions.push(d):d instanceof Agents||(a.solver.valued.push(d),d instanceof Flow?a.solver.flows.push(d):d instanceof Stock?a.solver.stocks.push(d):d instanceof State&&a.solver.states.push(d))):"Agents"==c&&(b.children.push(a.agents),b.childrenId[a.id]=a)}
function linkPrimitive(a,b){var c=b.type;if("Agents"!=c){var d=getPrimitiveNeighborhood(a,b);if("Flow"==c||"Transition"==c){var e=null,f=null;d.alpha&&(e=d.alpha);d.omega&&(f=d.omega);a.setEnds(e,f)}if("Action"==c){try{a.equation=trimTree(b.triggerValue,d)}catch(g){error(getText("The trigger for %s has an equation error that must be corrected before the model can be run.","<i>"+clean(b.name)+"</i>"),b.cell,!1)}try{a.action=trimTree(b.value,d)}catch(h){error(getText("The primitive $s has an equation error that must be corrected before the model can be run.",
"<i>"+clean(b.name)+"</i>"),b.cell,!0)}}else if("Converter"==c)if("Time"==b.source)a.setSource("*time");else{var c=orig(findID(b.source)).id,k;for(k in d)if(c==d[k].id){a.setSource(d[k]);break}}else a.setEquation(b.value,d)}}
function setAgentInitialValues(a){for(var b=0;b<a.children.length;b++)if(a.children[b]instanceof Stock){a.children[b].setDelay();try{a.children[b].setInitialValue()}catch(c){if(isLocal()&&console.log(c),c instanceof String)error(c.substr(4,c.length),a.children[b],!0);else throw c;}}else if(a.children[b]instanceof State)try{null===a.children[b].active&&a.children[b].setInitialActive(!0)}catch(d){if(isLocal()&&console.log(d),d instanceof String)error(d.substr(4,d.length),a.children[b],!0);else throw d;
}}function buildNetwork(a){if("Custom Function"==a.network)for(var b=getPrimitiveNeighborhood(a,a.dna),c=trimTree(createTree(a.networkFunction),b),d=0;d<a.agents.length-1;d++)for(var e=d+1;e<a.agents.length;e++)trueValue(simpleEquation(a.networkFunction,{"-parent":varBank,a:a.agents[d],b:a.agents[e]},b,c))&&a.agents[d].connect(a.agents[e]);else if("None"!=a.network)throw{msg:"Unknown network type: "+a.network+".",primitive:a.cell,showEditor:!1};}
function buildPlacements(a){var b,c,d;if("Random"==a.placement)a.agents.forEach(function(b){b.location=new Vector([mult(a.geoWidth,new Material(Rand())),mult(a.geoHeight,new Material(Rand()))],["x","y"])});else if("Custom Function"==a.placement)a.agents.forEach(function(b){var c=getPrimitiveNeighborhood(a,a.dna);c.self=b;b.location=simpleUnitsTest(simpleEquation(a.placementFunction,{"-parent":varBank,self:b},c),a.geoDimUnitsObject);b.location.names||(b.location.names=["x","y"],b.location.namesLC=
["x","y"])});else if("Grid"==a.placement){b=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var e=a.agents.length,f=simpleNum(simpleEquation("width(self)/height(self)",{"-parent":varBank,self:a},{}),a.geoDimUnitsObject);d=Math.sqrt(e/f);c=Math.floor(d*f);d=Math.ceil(d);!d*c>=e&&(c+=1);var g=0;a.agents.forEach(function(e){var f=(Math.floor(g/c)+0.5)/d;e.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:e,x:new Material((g%c+0.5)/c),y:new Material(f),
"-parent":varBank},{},b),a.geoDimUnitsObject);g++})}else if("Ellipse"==a.placement)b=trimTree(createTree("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), height(self)}/2"),{}),e=new Material(a.agents.length),a.agents.forEach(function(c){c.location=simpleUnitsTest(simpleEquation("{width(self), height(self)}/2+{sin(index(self)/size*2*3.14159), cos(index(self)/size*2*3.14159)}*{width(self), heigh(self)}/2",{self:c,size:e,"-parent":varBank},
{},b),a.geoDimUnitsObject)});else if("Network"==a.placement){b=trimTree(createTree("{x: x*width(self), y: y*height(self)}"),{});var h=new Graph,k=a.agents.map(function(a){return h.newNode({data:a})}),l=function(a){for(var b=0;b<k.length;b++)if(k[b].data.data===a)return k[b];return null};a.agents.forEach(function(a){a.connected.forEach(function(b){h.newEdge(l(a),l(b))})});for(var f=new Layout.ForceDirected(h,400,600,0.5),m=0;60>m;m++)f.applyCoulombsLaw(),f.applyHookesLaw(),f.attractToCentre(),f.updateVelocity(0.03),
f.updatePosition(0.03);var n=f.getBoundingBox();n.width=n.topright.x-n.bottomleft.x;n.height=n.topright.y-n.bottomleft.y;f.eachNode(function(c,d){var e=(d.p.y-n.bottomleft.y)/n.height;c.data.data.location=simpleUnitsTest(simpleEquation("{x: x*width(self), y: y*height(self)}",{self:a,x:new Material((d.p.x-n.bottomleft.x)/n.width),y:new Material(e),"-parent":varBank},{},b),a.geoDimUnitsObject)})}else throw{msg:"Unknown placement type: "+a.placement+".",primitive:a.cell,showEditor:!1};}
var allPlaceholders={};
function getPrimitiveNeighborhood(a,b){var c=neighborhood(b.cell),d=allPlaceholders[b.id]?allPlaceholders[b.id]:{},e={self:a};if(!c.placeholders&&"Agents"==b.type)for(var f=0;f<a.DNAs.length;f++)d[a.DNAs[f].name.toLowerCase()]=new Placeholder(a.DNAs[f],a);for(var g=0;g<c.length;g++){var h=c[g].item;if("Agents"==h.value.nodeName){if(e[model.submodels[h.id].dna.name.toLowerCase()]=model.submodels[h.id],!c.placeholders)for(f=0;f<model.submodels[h.id].DNAs.length;f++)e[model.submodels[h.id].DNAs[f].name.toLowerCase()]=new Placeholder(model.submodels[h.id].DNAs[f],
a)}else{f=!1;if(a.container&&a.container.childrenId[h.id]){var k=a.container.childrenId[h.id].dna.name.toLowerCase();e[k]=a.container.childrenId[h.id];f=!0}!f&&model.submodels.base.agents[0].childrenId[h.id]&&(k=model.submodels.base.agents[0].childrenId[h.id].dna.name.toLowerCase(),e[k]=model.submodels.base.agents[0].childrenId[h.id]);if("Flow"==b.type||"Transition"==b.type)e[k]&&(b.targetId==e[k].id?e.omega=e[k]:b.sourceId==e[k].id&&(e.alpha=e[k]))}}c=Object.keys(d);for(f=0;f<c.length;f++)e[c[f]]=
d[c[f]];allPlaceholders[b.id]=d;return e}function modelType(a){return!("Link"==a||"Picture"==a||"Text"==a||"Button"==a||"Folder"==a||"Setting"==a||"Display"==a||"Ghost"==a)}
function updateDisplayed(a){var b=a?a.displayed:[];if(simulate.displayInformation.store){if(0<b.length){for(var c=[],d=a.maxLoaded,d=isDefined(d)?d+1:0,e=a.maxLoaded;d<simulate.results.Time.length;d++){var f=simulate.displayInformation.store.getById(d),g={};f||(g.id=d,g.Time=simulate.results.Time[d]);if(!isUndefined(simulate.results.data[d][b[0].id]))for(var e=d,h=0;h<b.length;h++){var k=simulate.displayInformation.ids.indexOf(b[h].id);if(-1<k)if(simulate.results[simulate.displayInformation.ids[k]].states){var l=
simulate.results[simulate.displayInformation.ids[k]].states;if(simulate.results.data[d][b[h].id]){for(var m=simulate.results.data[d][b[h].id].current,n={},o=0;o<m.length;o++)if(m[h].state)for(var q=0;q<m[o].state.length;q++)n[m[o].state[q].id.toString()]=n[m[o].state[q].id.toString()]+1||1;for(o=0;o<l.length;o++)g[simulate.displayInformation.elementIds[k+o]]=n[l[o]]||0}}else if(simulate.results[simulate.displayInformation.ids[k]].indexedNames)for(l=0;k<simulate.displayInformation.ids.length&&simulate.displayInformation.ids[k]==
b[h].id;){try{g[simulate.displayInformation.elementIds[k]]=selectFromMatrix(simulate.results.data[d][b[h].id].fullClone(),simulate.results[simulate.displayInformation.ids[k]].indexedFullNames[l].slice())}catch(r){throw{msg:getText("Cannot change vector keys during a simulation."),primitive:b[h].dna.cell,showEditor:!0};}l++;k++}else g[simulate.displayInformation.elementIds[k]]=simulate.results.data[d][b[h].id]}f?(f.set(g),f.commit()):c.push(g)}a.maxLoaded=e;simulate.displayInformation.store.maxLoaded=
Math.max(simulate.displayInformation.store.maxLoaded,a.maxLoaded);simulate.displayInformation.store.suspendEvents();simulate.displayInformation.store.add(c);simulate.displayInformation.store.resumeEvents();simulate.displayInformation.store.filter()}simulate.resultsWindow||(simulate.resultsWindow=createResultsWindow(simulate.displayInformation),simulate.resultsWindow.scripter.loadTime(0),a=-1==simulate.resultsWindow.scripter.combo.getValue()?200:100/Math.min(0.5,simulate.resultsWindow.scripter.combo.getValue()),
q=simulate.resultsWindow.scripter,simulate.resultsWindow.scripter.animInter=setInterval(function(){q.advanceTimer()},a));d==simulate.displayInformation.times.length&&simulate.resultsWindow.scripter.finished()}};RedBlackNode.VERSION=1;function RedBlackNode(a,b){this._right=this._left=null;this._value=a;this._height=1;this.parent=b}RedBlackNode.prototype.add=function(a){var b=a.compare(this._value),c;0!=b?(0>b?null!=this._left?(a=this._left.add(a),this._left=a[0],this._left.parent=this,c=a[1]):c=this._left=new RedBlackNode(a,this):0<b&&(null!=this._right?(a=this._right.add(a),this._right=a[0],this._right.parent=this,c=a[1]):c=this._right=new RedBlackNode(a,this)),a=[this.balanceTree(),c]):a=[this,this];return a};
RedBlackNode.prototype.balanceTree=function(){var a=null!=this._left?this._left._height:0,b=null!=this._right?this._right._height:0;a>b+1?a=this.swingRight():b>a+1?a=this.swingLeft():(this.setHeight(),a=this);return a};RedBlackNode.prototype.join=function(a){if(null==a)a=this;else{var b;this._height>a._height?(b=this,b._right=a.join(b._right),b._right.parent=b):(b=a,b._left=this.join(b._left),b._left.parent=b);a=b.balanceTree()}return a};
RedBlackNode.prototype.moveLeft=function(){var a=this._right;if(this._right=a._left)this._right.parent=this;a._left=this;a._left.parent=a;this.setHeight();a.setHeight();return a};RedBlackNode.prototype.moveRight=function(){var a=this._left;if(this._left=a._right)this._left.parent=this;a._right=this;a._right.parent=a;this.setHeight();a.setHeight();return a};
RedBlackNode.prototype.remove=function(a){var b=a.compare(this._value);if(0!=b){if(0>b)if(null!=this._left){a=this._left.remove(a);if(this._left=a[0])this._left.parent=this;b=a[1]}else b=null;else if(null!=this._right){a=this._right.remove(a);if(this._right=a[0])this._right.parent=this;b=a[1]}else b=null;a=this}else b=this,null==this._left?a=this._right:null==this._right?a=this._left:(a=this._left.join(this._right),this._right=this._left=null);return null!=b?null!=a?[a.balanceTree(),b]:[a,b]:[this,
null]};RedBlackNode.prototype.setHeight=function(){var a=null!=this._left?this._left._height:0,b=null!=this._right?this._right._height:0;this._height=a<b?b+1:a+1};RedBlackNode.prototype.swingLeft=function(){var a=this._right,b=a._left,c=a._right;if((null!=b?b._height:0)>(null!=c?c._height:0))this._right=a.moveRight(),this._right.parent=this;return this.moveLeft()};
RedBlackNode.prototype.swingRight=function(){var a=this._left,b=a._right,c=a._left;if((null!=b?b._height:0)>(null!=c?c._height:0))this._left=a.moveLeft(),this._left.parent=this;return this.moveRight()};RedBlackNode.prototype.traverse=function(a){null!=this._left&&this._left.traverse(a);a(this);null!=this._right&&this._right.traverse(a)};RedBlackNode.prototype.toString=function(){return this._value.toString()};
RedBlackNode.prototype.validateParents=function(){this._right&&(this._right.parent!==this&&(console.log("Invalid right"),console.log(this)),this._right.validateParents());this._left&&(this._left.parent!==this&&(console.log("Invalid left"),console.log(this)),this._left.validateParents())};RedBlackTree.VERSION=1;function RedBlackTree(){this._cursor=this._root=null}RedBlackTree.prototype._findNode=function(a){for(var b=this._root;null!=b;){var c=a.compare(b._value);if(0!=c)b=0>c?b._left:b._right;else break}return b};RedBlackTree.prototype._maxNode=function(a){null==a&&(a=this._root);if(null!=a)for(;null!=a._right;)a=a._right;return a};RedBlackTree.prototype._minNode=function(a){null==a&&(a=this._root);if(null!=a)for(;null!=a._left;)a=a._left;return a};
RedBlackTree.prototype._nextNode=function(a){if(null!=a)if(null!=a._right)a=this._minNode(a._right);else{for(;null!=a.parent&&a.parent._right===a;)a=a.parent;a=a.parent}else a=this._minNode(this._root);return a};RedBlackTree.prototype._previousNode=function(a){if(null!=a)if(null!=a._left)a=this._maxNode(a._left);else{for(;null!=a.parent&&a.parent._left===a;)a=a.parent;a=a.parent}else a=this._maxNode(this._root);return a};
RedBlackTree.prototype.add=function(a){null==this._root?a=this._root=new RedBlackNode(a):(a=this._root.add(a),this._root=a[0],this._root.parent=null,a=a[1]);return a};RedBlackTree.prototype.find=function(a){a=this._findNode(a);return null!=a?a:null};RedBlackTree.prototype.findNext=function(a){a=this._findNode(a,!0);a=this._nextNode(a);return null!=a?a._value:null};RedBlackTree.prototype.findPrevious=function(a){a=this._findNode(a,!0);a=this._previousNode(a);return null!=a?a._value:null};
RedBlackTree.prototype.max=function(){var a=this._maxNode();return null!=a?a._value:null};RedBlackTree.prototype.min=function(){var a=this._minNode();return null!=a?a._value:null};RedBlackTree.prototype.next=function(){return(this._cursor=this._nextNode(this._cursor))?this._cursor._value:null};RedBlackTree.prototype.previous=function(){return(this._cursor=this._previousNode(this._cursor))?this._cursor._value:null};
RedBlackTree.prototype.remove=function(a){null!=this._root?(a=this._root.remove(a),this._root=a[0],a=a[1]):a=null;return a};RedBlackTree.prototype.goMin=function(){this._cursor=this._minNode(this._root)};RedBlackTree.prototype.goMax=function(){this._cursor=this._maxNode(this._root)};RedBlackTree.prototype.current=function(){return this._cursor?this._cursor._value:null};RedBlackTree.prototype.traverse=function(a){null!=this._root&&this._root.traverse(a)};
RedBlackTree.prototype.toString=function(){var a=[];if(null!=this._root)for(var b=[[this._root,0,"^"]];0<b.length;){for(var c=b.pop(),d=c[0],e=c[1],f="",g=0;g<e;g++)f+="  ";f+=c[2]+"("+d.toString()+")";a.push(f);null!=d._right&&b.push([d._right,e+1,"R"]);null!=d._left&&b.push([d._left,e+1,"L"])}return a.join("\n")};RedBlackTree.prototype.validateParents=function(){null!=this._root.parent&&(console.log("Invalid root node parent"),this._root.validateParents());console.log("done")};
