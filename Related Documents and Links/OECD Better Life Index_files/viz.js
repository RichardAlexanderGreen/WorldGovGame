(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=[].slice,H={}.hasOwnProperty,I=function(a,b){function c(){this.constructor=a}for(var d in b)H.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},J=function(a,b){return function(){return a.apply(b,arguments)}};n=function(){var a,b,c,d,e;for(b=1<=arguments.length?G.call(arguments,0):[],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push("undefined"!=typeof console&&null!==console?void 0:void 0);return e},m=window.app={},m.router={},m.models={},m.datasets={},m.datasets.indicators={},m.views={},m.ctrls={},m.utils={},m.welcomeMessageVisible=!1,m.doneTranslating=!1,m.util={},m.cfg={},m.cfg.ONLY_DIMENSIONS=!0,m.cfg.FLOWER_ORIGINAL_WIDTH=50,m.cfg.FLOWER_ORIGINAL_HEIGHT=50,m.cfg.FLOWER_SIZE_RATIO=1,m.cfg.FLOWER_SIZE_RATIO_CHANGE=0,m.cfg.FLOWER_SCALING_RATIO=1,m.cfg.FLOWER_WIDTH=50,m.cfg.FLOWER_HEIGHT=50,m.cfg.CURVATURE=.09,m.cfg.LENGTH=40,m.cfg.FLOWER_HEADROOM=350,m.cfg.FLOWER_FOOTROOM=500,m.cfg.VERTICAL_SCALING_RATIO=.95,m.cfg.VIS_HORIZONTAL_OFFSET=0,m.cfg.VIS_VERTICAL_OFFSET=0,m.cfg.VIS_HORIZONTAL_SCALE=1,m.cfg.VIS_VERTICAL_SCALE=1,m.cfg.SORTINGS={ALPHABETICALLY:"alphabetical country sorting",RANK:"countries sorted based on rank"},m.cfg.INEQUALITY_COMPARISONS={NONE:"no comparison",GENDER:"comparison between genders",PROFILE:"comparison with the average demographic profile"},m.cfg.ORIENTATIONS={BOTTOM_TO_TOP:"bottom to top layout",LEFT_TO_RIGHT:"left to right layout"},m.cfg.orientation=m.cfg.ORIENTATIONS.BOTTOM_TO_TOP,m.cfg.MODES={MIXER:"default home screen with mixer",COUNTRY:"country page visualization",DIMENSION:"dimension/topic page visualization",EMBED:"embeddable mode",RESPONSES:"responses"},m.cfg.mode=m.cfg.MODES.MIXER,m.cfg.selectedCountryID=void 0,m.cfg.selectedDimensionID=void 0,m.cfg.forceIncludedCountryID=void 0,m.cfg.touchdevice=!1,m.cfg.SMALL_SCREEN=!1,m.placeHereArrow=function(){var b,c,d,e,f,g,h,i,j,k,l;return l=a("#introblurb"),k=a("#introblurb .circlehighlightBlurb"),i=k.position(),j=k.outerWidth(),g=k.outerHeight(),i={left:i.left-.15*j,top:i.top-.15*g},j*=1.3,g*=1.3,h=k.offset(),f=a("#introblurb #hereCircle"),0===f.length&&(l.append("			<img src='"+m.cfg.settings.assetLocation+"/media/bli/theme/img/viz/sketched-circle.png' id='hereCircle'></img>		"),f=a("#introblurb #hereCircle")),f.css("position","absolute"),f.css("left",""+i.left+"px"),f.css("top",""+i.top+"px"),f.css("width",""+j+"px"),f.css("height",""+g+"px"),e=a("#introblurb #hereArrow"),0===e.length&&(l.append("			<img src='"+m.cfg.settings.assetLocation+"/media/bli/theme/img/viz/sketched-arrow.png' id='hereArrow'></img>		"),e=a("#introblurb #hereArrow")),d=m.cfg.width-(h.left+j)-50,b=d/551,c=20,m.cfg.SMALL_SCREEN?(e.css("position","absolute"),e.css("left",""+(i.left-5)+"px"),e.css("top",""+(i.top+45)+"px"),e.css("width","70px"),e.css("height","20px"),e.css("-webkit-transform","rotateZ(90deg)"),e.css("-moz-transform","rotateZ(90deg)"),e.css("transform","rotateZ(90deg)")):(e.css("position","absolute"),e.css("left",""+(i.left+j)+"px"),e.css("top",""+(i.top-c+10)+"px"),e.css("width",""+d+"px"),e.css("height",""+c+"px"),e.css("-webkit-transform",""),e.css("-moz-transform",""),e.css("transform",""))},m.showStartScreen=function(){var b,c;return c=a("#introblurb"),b=a("#introblurb .circlehighlightBlurb"),c.css({left:a("#logo").offset().left}),m.placeHereArrow(),2===m.ctrls.animationController.animationLevel?c.transition({opacity:1},1e3,function(){return m.welcomeMessageVisible=!0}):(c.css({opacity:1}),m.welcomeMessageVisible=!0),a("#introblurb #startButton").click(function(){return m.hideWelcomeMessage(),window.location.hash="11111111111"})},m.hideWelcomeMessage=function(){return 2===m.ctrls.animationController.animationLevel?a("#introblurb").transition({opacity:0},1e3,function(){return a("#introblurb").css("visibility","hidden"),a("#introblurb").css("display","none"),m.welcomeMessageVisible=!1}):(a("#introblurb").css({opacity:0,visibility:"hidden",display:"none"}),m.welcomeMessageVisible=!1)},m.addEmbedLogos=function(){var b,c;return a("#visContainer").append("		<div id='visEmbedLogos' style='opacity:0'>			<div style='position:absolute;top:0px;left:10px'>				<h1 data-i18n='[html]vis.embedlogos.headline'></h1>				<p data-i18n='[html]vis.embedlogos.copy'></p>			</div>			<div style='position:absolute;top:5px;right:5px' id='embed-big-logo'>				<img src='"+m.cfg.settings.assetLocation+"'theme/img/viz/logo-embed.png'' style='float:left'></img>			</div>			<div style='position:absolute;bottom:5px;left:5px' id='embed-small-logo'>				<img src='"+m.cfg.settings.assetLocation+"'theme/img/viz/logo-embed-small.png'' style='float:left'></img>			</div>		</div>	"),a("#visEmbedLogos").i18n(),2===m.ctrls.animationController.animationLevel?a("#visEmbedLogos").transition({opacity:1},1e3):a("#visEmbedLogos").css({opacity:1}),c=b="http://oecdbetterlifeindex.org/",null!=m.locale&&"en"!==m.locale&&(c+=m.locale+"/"),c+="#/"+m.models.weightProfiles.toString(),a("#visButtonsViewIndex").click(function(){return window.open(c,"_parent")}),a("#visButtonsCreateOwn").click(function(){return window.open(b,"_parent")}),m.updateEmbedLogos()},m.updateEmbedLogos=function(){var b,c,d;return a("#visEmbedLogos").css("opacity",1),m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(a("#embed-big-logo").css("opacity",1),a("#embed-small-logo").css("opacity",0)):(a("#embed-big-logo").css("opacity",0),a("#embed-small-logo").css("opacity",1)),d=h.determineNumberOfItems(m.models.countries,!1),a("#numberOfDisplayedCountries").html(d),m.cfg.forceIncludedCountryID?(b=m.models.countries.find(function(a){return a.get("id")===m.cfg.forceIncludedCountryID}),c=i18n.t("vis.countries."+m.cfg.forceIncludedCountryID),a("#forceIncludedCountry").html(""+i18n.t("vis.embedlogos.including")+c)):void 0},m.changedWeight=function(b){return""!==b?m.isReady?(m.cfg.mode===m.cfg.MODES.MIXER&&m.hideWelcomeMessage(),a("#visButtonsContainer").css("visibility","visible"),2===m.ctrls.animationController.animationLevel?a("#visButtonsContainer").transition({opacity:1},2e3,null):a("#visButtonsContainer").css({opacity:1}),m.models.weightProfiles.updateWeights(b)):m.cfg.embedProfileSetAside=b:void 0},m.toggleSorting=function(){return m.views.homeView._finishedUpdatingWeights()},m.toggleComparison=function(){return m.cfg.mode===m.cfg.MODES.MIXER&&m.welcomeMessageVisible&&(m.hideWelcomeMessage(),a("#visButtonsContainer").css("visibility","visible"),2===m.ctrls.animationController.animationLevel?a("#visButtonsContainer").transition({opacity:1},2e3,null):a("#visButtonsContainer").css({opacity:1})),m.views.homeView.toggleComparison()},m.setLanguageTo=function(b){return i18n.setLng(b,null),a("#introblurb").i18n()},m.windowResize=_.debounce(function(){var b,c,d;if(d=m.cfg.SMALL_SCREEN,c=[m.cfg.width,m.cfg.height],m.determineCanvasSize(),m.windowScroll(),m.cfg.SMALL_SCREEN===d&&(m.cfg.height=c[1]),(c[0]!==m.cfg.width||c[1]!==m.cfg.height)&&(a("#canvas").attr("width",m.cfg.width),a("#canvas").attr("height",m.cfg.height),m.views.homeView._layoutFlowersAndScale(m.views.homeView.currentLayout,!1)),m.cfg.mode===m.cfg.MODES.EMBED&&m.updateEmbedLogos(),m.welcomeMessageVisible)try{return a("#introblurb").css({left:a("#logo").offset().left}),m.placeHereArrow()}catch(e){b=e}},100),m.windowScroll=function(){var b;return b=a("#visContainer").offset(),m.cfg.visOffsetLeft=b.left,m.cfg.visOffsetTop=b.top},m.determineCanvasSize=function(){var b;return m.cfg.width=parseFloat(a(m.mainDiv).width()),m.cfg.height=parseFloat(a(m.mainDiv).height())*m.cfg.VERTICAL_SCALING_RATIO,m.cfg.SMALL_SCREEN=a(window).width()<768,b=m.cfg.FLOWER_SIZE_RATIO,m.cfg.FLOWER_SIZE_RATIO=m.cfg.width/1024,m.cfg.FLOWER_SIZE_RATIO>1&&(m.cfg.FLOWER_SIZE_RATIO=1),b!==m.cfg.FLOWER_SIZE_RATIO&&(m.cfg.FLOWER_SIZE_RATIO_CHANGE=m.cfg.FLOWER_SIZE_RATIO/b),m.cfg.mode===m.cfg.MODES.EMBED?(m.cfg.VIS_VERTICAL_OFFSET=80,m.cfg.VIS_VERTICAL_SCALE=(m.cfg.height-100)/m.cfg.height,m.cfg.width<m.cfg.height?(m.cfg.orientation=m.cfg.ORIENTATIONS.LEFT_TO_RIGHT,m.cfg.VIS_HORIZONTAL_OFFSET=30,m.cfg.VIS_VERTICAL_OFFSET=80+m.cfg.FLOWER_HEIGHT/2,m.cfg.VIS_VERTICAL_SCALE=(m.cfg.height-(100+m.cfg.FLOWER_HEIGHT/2))/m.cfg.height):(m.cfg.VIS_HORIZONTAL_OFFSET=0,m.cfg.orientation=m.cfg.ORIENTATIONS.BOTTOM_TO_TOP)):void 0},m.dataLoadedFinishSetup=function(){var b;return b={resGetPath:m.cfg.settings.dataLocation+"/media/bli/data/locales/translation.json",lng:m.cfg.settings.locale,fallbackLng:!1},i18n.init(b).done(function(){return m.doneTranslating?void 0:(m.doneTranslating=!0,a("#introblurb").i18n(),a("#loadingPanel").i18n(),a("#visButtonsContainer").i18n(),a("#bli-mixer-wrapper").i18n(),a("#bli-sharing").i18n(),a("#bli-carousel").i18n(),a("#viz-overlay").i18n(),a(".num-responses, .gender-vis, .age-vis, .weights-vis, .compare-to, .controls").i18n(),a("#viz-wrapper.responses").i18n(),a("#viz-wrapper.responses").siblings("#content").i18n(),m.translationMadeFinishSetup())})},m.translationMadeFinishSetup=function(){var b,c;switch(a("body").addClass("lang_"+i18n.lng()),m.cfg.mode){case m.cfg.MODES.MIXER:a("#visButtonsContainer").addClass("mixerPageMode");break;case m.cfg.MODES.COUNTRY:a("#visButtonsContainer").addClass("countryPageMode"),(new window.MiniCharts).init();break;case m.cfg.MODES.DIMENSION:a("#visButtonsContainer").addClass("dimensionPageMode"),m.ctrls.interactionController.sorting=m.cfg.SORTINGS.RANK,m.models.weightProfiles.muteAllExcept(m.cfg.selectedDimensionID),m.models.countries.each(function(a){return a.calculateScore()}),(new window.MiniCharts).init();break;case m.cfg.MODES.EMBED:a("#visButtonsContainer").addClass("embedMode"),m.addEmbedLogos(),c=window.location.href.indexOf("?weight="),-1!==c&&(b=window.location.href.substr(c+8,11),m.models.weightProfiles.updateWeights(b,!1),m.models.viewableModel.get("countries").each(function(a){return a.calculateScore()}));break;case m.cfg.MODES.RESPONSES:return void a(window).trigger("app-ready")}return a(".helpButton").click(function(){return m.ctrls.interactionController.showHelpPanel()}),m.views.homeView._initializeView(),m.cfg.mode===m.cfg.MODES.MIXER&&""===window.location.hash&&m.showStartScreen(),a(window).trigger("app-ready")},m.hideLoadingPanel=function(){return 2===m.ctrls.animationController.animationLevel?a("#loadingPanel").transition({opacity:0},1e3,function(){return a("#loadingPanel").css("visibility","hidden")}):a("#loadingPanel").css({opacity:0,visibility:"hidden"})},m.viewInitializedFinishSetup=function(){var b;return m.hideLoadingPanel(),a(window).resize(m.windowResize),a(window).scroll(m.windowScroll),Backbone.history.start(),m.views.homeView.off("view initialized"),m.isReady=!0,m.cfg.comparisonProfileSetAside&&(b=m.cfg.comparisonProfileSetAside,m.cfg.comparisonProfileSetAside=void 0,m.setCompareProfile(b)),m.cfg.embedProfileSetAside?m.changedWeight(m.cfg.embedProfileSetAside):void 0},m.setCompareProfile=function(a){var b;return a.length>0?m.isReady?(b=a.split(","),m.ctrls.interactionController.changeInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.PROFILE),m.models.weightProfiles.updateCompareWeightShares(b)):m.cfg.comparisonProfileSetAside=a:m.ctrls.interactionController.changeInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.NONE)},m.setInequalityComparison=function(a){return a===m.cfg.INEQUALITY_COMPARISONS.GENDER?m.ctrls.interactionController.changeInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.GENDER):a!==m.cfg.INEQUALITY_COMPARISONS.NONE&&a&&null!=a?void 0:m.ctrls.interactionController.changeInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.NONE)},m.setSortMode=function(){},m.showHelp=function(){return m.ctrls.interactionController.showHelpPanel()},m.hideHelp=function(){return m.ctrls.interactionController.removeHelpPanel()},m.reset=function(){return m.changedWeight("11111111111")},a=jQuery,a.fn.extend({flowerVis:function(b){var c,e,f;return e={mode:m.cfg.MODES.MIXER,locale:"en",selectedCountryID:void 0,selectedDimensionID:void 0,forceIncludedCountryID:void 0,sorting:m.cfg.SORTINGS.ALPHABETICALLY,dataLocation:"",assetLocation:""},e=a.extend(e,b),m.cfg.settings=e,m.isReady=!1,m.mainDiv=this,m.cfg.mode=m.cfg.settings.mode,m.cfg.locale=m.cfg.settings.locale,m.cfg.selectedCountryID=m.cfg.settings.selectedCountryID,m.cfg.selectedDimensionID=m.cfg.settings.selectedDimensionID,m.cfg.forceIncludedCountryID=m.cfg.settings.forceIncludedCountryID,c="<div id='visContainer'>\n	<div id='flowerContainer'></div>\n	<div id='visScaleContainer'></div>\n	<div id='visLabelContainer'></div>",m.cfg.mode===m.cfg.MODES.MIXER&&(c+="<div id='introblurb'>\n	<h1 data-i18n='[html]app.intro.headline'></h1>\n	<p data-i18n='[html]app.intro.maintext1'></p>\n	<div class='startButton' id='startButton' data-i18n='[html]app.intro.startbutton'></div>\n	<div class='setPreferencesHere' data-i18n='[html]app.intro.setpreferences'></div>\n</div>"),c+="	<div id='visButtonsContainer'>\n		<div id='visButtonsSorting'><span data-i18n='[html]vis.sortbuttons.sortBy'></span>Â <span id='visButtonAlphabetically' class='active' data-i18n='[html]vis.sortbuttons.alphabetic'></span> | <span id='visButtonByRank' data-i18n='[html]vis.sortbuttons.ascending'></span></div>\n		<div style='position:absolute;left:0px;top:0px' id='visButtonsScrollIndicatorLeft'></div>\n		<div style='position:absolute;right:0px;top:0px' id='visButtonsScrollIndicatorRight'></div>\n		<div style='position:absolute;right:5px;bottom:5px' id='visButtonsEmbed'>\n			<div id='visButtonsViewIndex' class='startButton' style='float:left' data-i18n='[html]vis.embedbuttons.viewIndex'></div>\n			<div id='visButtonsCreateOwn' class='startButton' style='float:left' data-i18n='[html]vis.embedbuttons.createOwn'></div>\n		</div>\n		<div id='hoverbox'></div>\n	</div>\n</div>",m.cfg.mode!==m.cfg.MODES.RESPONSES&&a(m.mainDiv).html(c),m.determineCanvasSize(),!m.cfg.SMALL_SCREEN&&window.devicePixelRatio>1&&(m.cfg.FLOWER_SCALING_RATIO=2),m.cfg.mode!==m.cfg.MODES.RESPONSES&&a("#visContainer").append("<canvas id='canvas' width='"+m.cfg.width+"' height='"+m.cfg.height+"'></canvas>"),d.initializeColors(),m.models.countries=new window.Countries,m.models.weightProfiles=new window.WeightProfiles,m.models.viewableModel=new window.ViewableModel({countries:m.models.countries,weightProfile:m.models.weightProfiles}),m.ctrls.animationController=new window.AnimationController,m.views.homeView=new window.HomeView({el:a("#canvas"),model:m.models.viewableModel}),m.ctrls.dataController=new window.DataController,m.ctrls.interactionController=new window.InteractionController,m.ctrls.interactionController.sorting=m.cfg.settings.sorting,m.ctrls.interactionController.on("toggleSorting",function(){return m.toggleSorting()}),m.ctrls.interactionController.on("toggleComparison",function(){return m.toggleComparison()}),m.router=new window.Router,m.cfg.mode===m.cfg.MODES.MIXER&&m.router.on("route:changedWeight",m.changedWeight),m.views.homeView.on("view initialized",m.viewInitializedFinishSetup),m.models.viewableModel.on("data loaded",m.dataLoadedFinishSetup),f=a("#visContainer"),a("#visContainer").length||(f=a(".overlay-container")),f.append("			<div id='loadingPanel' style='opacity:0.0;visibility:hidden'><p><img src='"+m.cfg.settings.assetLocation+"/media/bli/theme/img/viz/loading.gif'></img><span data-i18n='app.loading'></span></p>			</div>		"),a("#loadingPanel").css("visibility","visible"),2===m.ctrls.animationController.animationLevel?a("#loadingPanel").transition({opacity:1},1e3):a("#loadingPanel").css({opacity:1}),m.ctrls.dataController.loadData()}}),a.fn.flowerVis.setInequalityComparison=m.setInequalityComparison,a.fn.flowerVis.setCompareProfile=m.setCompareProfile,a.fn.flowerVis.setSortMode=m.setSortMode,a.fn.flowerVis.showHelp=m.showHelp,a.fn.flowerVis.hideHelp=m.hideHelp,a.fn.flowerVis.changedWeight=m.changedWeight,a.fn.flowerVis.reset=m.reset,window.Router=function(a){function b(){return p=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.routes={"*args":"changedWeight"},b.prototype.changedWeight=function(){},b}(Backbone.Router),m.cfg.animations={},m.cfg.animations.POSITION_DURATION=1e3,m.cfg.animations.WEIGHT_CHANGE_DURATION=700,m.cfg.animations.LEAF_SIZE_DURATION=1e3,m.cfg.animations.INEQUALITY_DURATION=1e3,m.cfg.animations.LABEL_POSITION_DURATION=1e3,m.cfg.animations.SCROLL_MAX_SPEED=15,m.cfg.animations.SCROLL_MODES={NONE:"scrolling is off",HOME:"moving back to the selected country node",ACC:"accelerating",DEC:"decelerating"},m.cfg.animations.SCROLL_DIRECTIONS={LEFT:1,RIGHT:-1},m.cfg.animations.FRAMES_PER_SECOND=24,m.cfg.animations.POSITION_STACK_DROP_DURATION=34e-6,window.AnimationController=function(){function a(){this.drawLoop=J(this.drawLoop,this),this._setupScaleAnimations=J(this._setupScaleAnimations,this),this.setupScaleAnimation=J(this.setupScaleAnimation,this),this._setupLeafSizeAnimations=J(this._setupLeafSizeAnimations,this),this.setupLeafSizeAnimation=J(this.setupLeafSizeAnimation,this),this._setupWeightAnimations=J(this._setupWeightAnimations,this),this.setupWeightAnimation=J(this.setupWeightAnimation,this),this.setupLabelPositionAnimation=J(this.setupLabelPositionAnimation,this),this.setupComparisonMarkerAnimation=J(this.setupComparisonMarkerAnimation,this),this.setupInequalityMarkerAnimation=J(this.setupInequalityMarkerAnimation,this),this.setupPositionAnimation=J(this.setupPositionAnimation,this),this._stopScrollAnimation=J(this._stopScrollAnimation,this),this._startScrolling=J(this._startScrolling,this),this.onScrollStop=J(this.onScrollStop,this),this.scrollHome=J(this.scrollHome,this),this.onScroll=J(this.onScroll,this);var a;null!=m.util.checkForMobileBrowser&&(a=m.util.checkForMobileBrowser(),a?(this.animationLevel=1,m.cfg.touchdevice=!0):m.cfg.touchdevice=!1),this.animationLevel>0&&this.drawLoop()}return a.prototype.animationLevel=2,a.prototype.weightTweenIsComplete=!1,a.prototype.finalWeightValues=void 0,a.prototype.scrollDirection=0,a.prototype.scrollSpeed=0,a.prototype.scrollMode=m.cfg.animations.SCROLL_MODES.NONE,a.prototype.currentScrollOffset=0,a.prototype.positionStack=[],a.prototype.lastPositionDrawn=0,a.prototype.onScroll=function(a){return this.scrollDirection=a,this._startScrolling()},a.prototype.scrollHome=function(){return this.scrollMode=m.cfg.animations.SCROLL_MODES.HOME},a.prototype.onScrollStop=function(){return this.scrollMode=m.cfg.animations.SCROLL_MODES.DEC},a.prototype._startScrolling=function(){return this.scrollSpeed=0,this.scrollMode=m.cfg.animations.SCROLL_MODES.ACC},a.prototype._stopScrollAnimation=function(){return this.scrollSpeed=0,this.scrollMode=m.cfg.animations.SCROLL_MODES.NONE},a.prototype.setupPositionAnimation=function(a,b){return a.model.setFinalPosition(new j(b.x,b.y)),a.model.animatePosition(this.animationLevel>0?new j(b.x,b.y):new j(b.x,b.y))},a.prototype._setupPositionAnimations=function(a,b){var c;return c=new TWEEN.Tween(a),c.to(b,m.cfg.animations.POSITION_DURATION),c.easing(TWEEN.Easing.Quadratic.InOut),c.onUpdate(function(){return this.model.animatePosition(new j(this.x,this.y))}),c.start()},a.prototype.setupInequalityMarkerAnimation=function(a,b,c){return this.animationLevel>0?this._setupInequalityMarkerAnimations(a,b,c):a.animateInequalityMarkers(c)},a.prototype._setupInequalityMarkerAnimations=function(a,b,c){var d;return d=new TWEEN.Tween(b),d.to(c,m.cfg.animations.INEQUALITY_DURATION),d.easing(TWEEN.Easing.Quadratic.InOut),d.onUpdate(function(){return a.animateInequalityMarkers(this)}),d.start()},a.prototype.setupComparisonMarkerAnimation=function(a,b,c){return this.animationLevel>0?this._setupComparisonMarkerAnimations(a,b,c):a.animateComparisonMarkers(c)},a.prototype._setupComparisonMarkerAnimations=function(a,b,c){var d;return d=new TWEEN.Tween(b),d.to(c,m.cfg.animations.INEQUALITY_DURATION),d.easing(TWEEN.Easing.Quadratic.InOut),d.onUpdate(function(){return a.animateComparisonMarkers(this)}),d.start()},a.prototype.setupLabelPositionAnimation=function(a,b,c){return a.animateLabelPosition(c)},a.prototype.setupWeightAnimation=function(a,b){return 2===this.animationLevel?this._setupWeightAnimations(a,b):(m.models.weightProfiles.updateWeightsWithArray(b),m.models.weightProfiles.finishedUpdatingWeights())},a.prototype._setupWeightAnimations=function(a,b){var c,d=this;return this.weightTweenIsComplete=!1,this.finalWeightValues=b,c=new TWEEN.Tween(a),c.to(b,m.cfg.animations.WEIGHT_CHANGE_DURATION),c.onUpdate(function(){return m.views.homeView.calculateFlowersFor(this)}),c.onComplete(function(){return d.weightTweenIsComplete=!0}),c.start()},a.prototype.setupLeafSizeAnimation=function(a,b){return 2===this.animationLevel?this._setupLeafSizeAnimations(a,b):a.model.animateLeafSize(b.value,!0)},a.prototype._setupLeafSizeAnimations=function(a,b){var c;return c=new TWEEN.Tween(a),c.to(b,m.cfg.animations.LEAF_SIZE_DURATION),c.easing(TWEEN.Easing.Quadratic.InOut),c.onUpdate(function(){return this.model.animateLeafSize(this.value,!1)}),c.onComplete(function(){return this.model.animateLeafSize(this.value,!0)}),c.start()},a.prototype.setupScaleAnimation=function(a,b){return this.animationLevel>0?this._setupScaleAnimations(a,b):m.views.homeView.scaleView.animateLabelPositions(b)},a.prototype._setupScaleAnimations=function(a,b){var c;return c=new TWEEN.Tween(a),c.to(b,m.cfg.animations.POSITION_DURATION),c.easing(TWEEN.Easing.Quadratic.InOut),c.onUpdate(function(){return m.views.homeView.scaleView.animateLabelPositions(this)}),c.start()},a.prototype.drawLoop=function(){var a;switch(null!=window.requestAnimationFrame?window.requestAnimationFrame(this.drawLoop):window.setTimeout(this.drawLoop,1e3/m.cfg.animations.FRAMES_PER_SECOND),TWEEN.update(),this.weightTweenIsComplete&&(this.weightTweenIsComplete=m.views.homeView.checkFlowerStacks(),this.weightTweenIsComplete||(m.models.weightProfiles.updateWeightsWithArray(this.finalWeightValues),m.models.weightProfiles.finishedUpdatingWeights())),this.scrollMode){case m.cfg.animations.SCROLL_MODES.ACC:return m.views.homeView.shiftAllFlowersHorizontallyBy(this.scrollSpeed*this.scrollDirection),this.currentScrollOffset+=this.scrollSpeed*this.scrollDirection,this.scrollSpeed+=.1*(m.cfg.animations.SCROLL_MAX_SPEED-this.scrollSpeed),e.checkPositionsForFlowers(m.views.homeView.flowerModels);case m.cfg.animations.SCROLL_MODES.DEC:return m.views.homeView.shiftAllFlowersHorizontallyBy(this.scrollSpeed*this.scrollDirection),this.currentScrollOffset+=this.scrollSpeed*this.scrollDirection,this.scrollSpeed+=.2*(0-this.scrollSpeed),this.scrollSpeed<.1&&this._stopScrollAnimation(),e.checkPositionsForFlowers(m.views.homeView.flowerModels);case m.cfg.animations.SCROLL_MODES.HOME:return a=this.currentScrollOffset,this.currentScrollOffset*=.9,m.views.homeView.shiftAllFlowersHorizontallyBy(this.currentScrollOffset-a),Math.abs(this.currentScrollOffset)<3&&this._stopScrollAnimation(),e.checkPositionsForFlowers(m.views.homeView.flowerModels)}},a}(),window.InteractionController=function(){function b(){this.generateFlowerHoverMap=J(this.generateFlowerHoverMap,this),this.removeHelpPanel=J(this.removeHelpPanel,this),this.showHelpPanel=J(this.showHelpPanel,this),this.changeInequalityComparison=J(this.changeInequalityComparison,this),this.changeSorting=J(this.changeSorting,this);var b=this;_.extend(this,Backbone.Events),a("#visButtonAlphabetically").click(function(){return b.sorting!==m.cfg.SORTINGS.ALPHABETICALLY?(a("#visButtonAlphabetically").addClass("active"),a("#visButtonByRank").removeClass("active"),b.changeSorting(m.cfg.SORTINGS.ALPHABETICALLY)):void 0}),a("#visButtonByRank").click(function(){return b.sorting!==m.cfg.SORTINGS.RANK?(a("#visButtonAlphabetically").removeClass("active"),a("#visButtonByRank").addClass("active"),b.changeSorting(m.cfg.SORTINGS.RANK)):void 0}),a("#comparegendersbutton").click(function(){return"compare men and women"===a("#comparegendersbutton").text()?(a("#comparegendersbutton").text("reset"),m.setInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.GENDER)):(a("#comparegendersbutton").text("compare men and women"),m.setInequalityComparison(m.cfg.INEQUALITY_COMPARISONS.NONE))}),a("#compareprofilesbutton").click(function(){return"compare to average profile"===a("#compareprofilesbutton").text()?(a("#compareprofilesbutton").text("reset"),m.setCompareProfile("3.01,2.98,3.17,3.07,3.63,3.48,2.41,3.77,3.91,3.22,3.61")):(a("#compareprofilesbutton").text("compare to average profile"),m.setCompareProfile(""))}),a("#visButtonsScrollIndicatorLeft").hover(function(b){return a(b.target).addClass("active"),m.ctrls.animationController.onScroll(m.cfg.animations.SCROLL_DIRECTIONS.LEFT)},function(b){return a(b.target).removeClass("active"),m.ctrls.animationController.onScrollStop()}),a("#visButtonsScrollIndicatorRight").hover(function(b){return a(b.target).addClass("active"),m.ctrls.animationController.onScroll(m.cfg.animations.SCROLL_DIRECTIONS.RIGHT)},function(b){return a(b.target).removeClass("active"),m.ctrls.animationController.onScrollStop()}),a("#visContainer").mouseleave(function(){var a;m.cfg.mode===m.cfg.MODES.COUNTRY&&m.ctrls.animationController.scrollHome();try{return m.views.homeView.hoverbox.hideHoverbox()}catch(b){a=b}})}return b.prototype.sorting=m.cfg.SORTINGS.ALPHABETICALLY,b.prototype.inequalityComparison=m.cfg.INEQUALITY_COMPARISONS.NONE,b.prototype.helpIsActive=!1,b.prototype.flowerMap=void 0,b.prototype.interactionGridStep=5,b.prototype.changeSorting=function(a){return a!==this.sorting?(this.sorting=a,this.trigger("toggleSorting")):void 0},b.prototype.changeInequalityComparison=function(a){return a!==this.inequalityComparison?(this.inequalityComparison=a,this.trigger("toggleComparison")):void 0},b.prototype.showHelpPanel=function(){var b,c,d,e,f,g;if(!this.helpIsActive){g=m.cfg.width,g>620&&(g=620),f=g/620,e=370*f,d='<div id="helpOverlayPanel" style=\'opacity: 0\'>\n	<div class="video-close-panel">\n	</div>\n\n	<div class="video-container">\n		<div class="close-button"></div>\n		<video width="'+g+'" height="'+e+'" controls autoplay loop>\n			'+i18n.t("app.helpvideos")+"\n		</video>\n	</div>\n</div>",c=a(d).appendTo("#visContainer"),this.helpIsActive=!0;try{m.views.homeView.hoverbox.hideHoverbox()}catch(h){b=h}return a("#helpOverlayPanel .video-close-panel").click(this.removeHelpPanel),a("#helpOverlayPanel .close-button").click(this.removeHelpPanel),a("#helpOverlayPanel").transition({opacity:1},1e3)}},b.prototype.removeHelpPanel=function(){var b=this;return a("#helpOverlayPanel").transition({opacity:0},1e3,function(){return a("#helpOverlayPanel").remove(),b.helpIsActive=!1})},b.prototype.generateFlowerHoverMap=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o;if(!m.cfg.touchdevice){for(g=[],e=h=0,j=m.cfg.width,k=this.interactionGridStep;k>0?j>h:h>j;e=h+=k){for(b=[],f=i=0,l=m.cfg.height,n=this.interactionGridStep;n>0?l>i:i>l;f=i+=n)o=this.checkForFlowerTouch(a,e,f),c=o[0],d=o[1],b.push(d);g.push(b)}return this.flowerMap=g}},b.prototype.checkForFlowerTouch=function(a,b,c){var d,e,f,g,h,i,j;for(f=1/0,g=-1,h=function(a,d){var e;if(a.get("country").get("visible"))return e=m.cfg.orientation===m.cfg.ORIENTATIONS.LEFT_TO_RIGHT?a._distance(a.get("anchor").x-m.cfg.FLOWER_WIDTH/2-b,a.get("anchor").y+m.cfg.FLOWER_HEIGHT/2-c):a._distance(a.get("anchor").x+m.cfg.FLOWER_WIDTH/2-b,a.get("anchor").y+m.cfg.FLOWER_HEIGHT/2-c),f>e&&e<a.get("maxDist")?(f=e,g=d):void 0},e=i=0,j=a.length;j>i;e=++i)d=a[e],h(d,e);return[f,g]},b}(),window.DataController=function(){function b(){this._calculateDimensionValues=J(this._calculateDimensionValues,this),this.loadData=J(this.loadData,this),this.loadStructure=J(this.loadStructure,this),_.extend(this,Backbone.Events),this.universalMapping=[]}var c,d,e,f;return f=[],e=[],c=[],d=void 0,b.prototype.universalMapping=void 0,b.prototype.loadCSVData=function(){var a=this;return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/indicators_normalised_2014.csv",function(b,c){return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/indicators_women_2014.csv",function(b,d){return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/indicators_men_2014.csv",function(b,e){return m.datasets.indicators.indicators_ds=c,m.datasets.indicators.indicators_women=d,m.datasets.indicators.indicators_men=e,a.loadStructure()})})})},b.prototype.loadStructure=function(){var b=this;return a.getJSON(m.cfg.settings.dataLocation+"/media/bli/data/structure.json",function(a){var c,e,f,g,h,i,j,k,l,n,o,p,q,r,s;for(b.countriesArray=a.countries,b.dimensionsArray=a.dimensions,q=b.countriesArray,g=function(a){var c,e,f,g,h,i;for(c=m.models.countries.create({id:a}),b.dimensions=d=new window.Dimensions,i=b.dimensionsArray,f=function(a){var e,f;return e=d.create({id:a.id,indexPosition:a.indexPosition,indicators:function(){var b,c,d,e;for(d=a.indicators,e=[],b=0,c=d.length;c>b;b++)f=d[b],e.push({id:f});return e}()}),b._calculateDimensionValues(c.id,e,m.datasets.indicators.indicators_ds,"normalized"),b._calculateDimensionValues(c.id,e,m.datasets.indicators.indicators_women,"women"),b._calculateDimensionValues(c.id,e,m.datasets.indicators.indicators_men,"men")},g=0,h=i.length;h>g;g++)e=i[g],f(e);return c.set("dimensions",d)},j=0,n=q.length;n>j;j++)c=q[j],g(c);for(r=b.dimensionsArray,h=function(a){return m.models.weightProfiles.create({id:a.id,weight:1})},k=0,o=r.length;o>k;k++)e=r[k],h(e);for(s=b.dimensionsArray,i=function(a,c){return b.universalMapping[a.id]=c},f=l=0,p=s.length;p>l;f=++l)e=s[f],i(e,f);return m.models.weightProfiles.calculateNormalizedWeights(),m.models.countries.each(function(a){return a.calculateScore()}),m.models.viewableModel.trigger("data loaded")})},b.prototype.loadData=function(){return this.loadCSVData()},b.prototype._parseCircaNumber=function(a){return"~"===a[0]?[parseFloat(a.slice(1)),!0]:[parseFloat(a),!1]},b.prototype._calculateDimensionValues=function(a,b,c,d){var e,f,g,h,i=this;return e=_.where(c,{ISO:a})[0],g=!1,h=_.reduce(b.get("indicators"),function(a,b){var c;return c=i._parseCircaNumber(e[b.id]),a+=c[0],g=g||c[1],a},0),f=h/b.get("indicators").length,g&&(f+="~"),b.set(d,f)},b}(),o=function(){function a(){}return a.round=function(a){return 0|a},a}(),b=function(){function a(b,c,d,e){this._calculateHSVL=J(this._calculateHSVL,this),this.toCss=J(this.toCss,this),this.red=a.bound(a.round(b),0,255),this.green=a.bound(a.round(c),0,255),this.blue=a.bound(a.round(d),0,255),this.alpha=a.bound(e,0,1),this._calculateHSVL()}return a.prototype.red=void 0,a.prototype.green=void 0,a.prototype.blue=void 0,a.prototype.alpha=void 0,a.prototype.hue=void 0,a.prototype.saturationHSL=void 0,a.prototype.saturationHSV=void 0,a.prototype.lightness=void 0,a.prototype.value=void 0,a.prototype.toCss=function(a){return null==a&&(a=!0),a?"rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")":"rgb("+this.red+", "+this.green+", "+this.blue+")"},a.prototype._calculateHSVL=function(){var b;return b=a.rgbToHsvl(this.red,this.green,this.blue),this.hue=b[0],this.saturationHSV=b[1],this.saturationHSL=b[2],this.value=b[3],this.lightness=b[4]},a.round=function(a){var b;return b=.5+a>>0},a.bound=function(a,b,c){return a},a.rgbToHsvl=function(a,b,c){var d,e,f,g,h,i,j;if(d=i=h=j=e=0,a/=255,b/=255,c/=255,f=Math.max(a,b,c),g=Math.min(a,b,c),g===f)d=i=h=0;else{switch(f){case a:d=60*(0+(b-c)/(f-g));break;case b:d=60*(2+(c-a)/(f-g));break;case c:d=60*(4+(a-b)/(f-g))}0>d&&(d+=360),i=(f-g)/f,h=(f-g)/(1-Math.abs(f+g-1))}return j=f,e=(f+g)/2,[d,i,h,j,e]},a.hsvToRgb=function(a,b,c){var d,e,f,g,h,i;switch(e=Math.floor(a/60),d=a/60-e,f=c*(1-b),g=c*(1-b*d),i=c*(1-b*(1-d)),h=[0,0,0],e){case 1:h=[g,c,f];break;case 2:h=[f,c,i];break;case 3:h=[f,g,c];break;case 4:h=[i,f,c];break;case 5:h=[c,f,g];break;default:h=[c,i,f]}return h=[255*h[0],255*h[1],255*h[2]]},a.hslToRgb=function(a,b,c){var d,e,f,g,h;switch(d=(1-Math.abs(2*c-1))*b,e=Math.floor(a/60),h=d*(1-Math.abs(e%2-1)),g=[0,0,0],e){case 0:g=[d,h,0];break;case 1:g=[h,d,0];break;case 2:g=[0,d,h];break;case 3:g=[0,h,d];break;case 4:g=[h,0,d];break;case 5:g=[d,0,h];break;default:g=[0,0,0]}return f=c-.5*d,g=[255*(g[0]+f),255*(g[1]+f),255*(g[2]+f)]},a.rgb=function(b,c,d){return new a(b,c,d,1)},a.rgba=function(b,c,d,e){return new a(b,c,d,e)
},a.hsl=function(b,c,d,e){var f;return null==e&&(e=1),c>1&&(c/=100),d>1&&(d/=100),f=a.hslToRgb(b,c,d),new a(f[0],f[1],f[2],e)},a.hsv=function(b,c,d,e){var f;return null==e&&(e=1),c>1&&(c/=100),d>1&&(d/=100),f=a.hsvToRgb(b,c,d),new a(f[0],f[1],f[2],e)},a.color=function(b){return new a(b.red,b.green,b.blue,b.alpha)},a.css=function(b){var c;return"#"===b[0]&&(b=b.substring(1)),c=void 0,3===b.length?c=new a(16*parseInt("0x"+b[0]),16*parseInt("0x"+b[1]),16*parseInt("0x"+b[2]),1):6===b.length?c=new a(parseInt("0x"+b.substr(0,2)),parseInt("0x"+b.substr(2,2)),parseInt("0x"+b.substr(4,2)),1):8===b.length&&(c=new a(parseInt("0x"+b.substr(0,2)),parseInt("0x"+b.substr(2,2)),parseInt("0x"+b.substr(4,2)),parseInt("0x"+b.substr(6,2))/255)),c},a}(),g=function(){function a(){}return a.distance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},a}(),l=function(){function a(a,b){this.length=J(this.length,this),this.p1=a,this.p2=new j(b.x,b.y),this.p2.subtract(this.p1)}return a.prototype.length=function(){return null==this._length?this._length=g.distance(j.origin,this.p2):void 0},a}(),j=function(){function a(a,b){null==a&&(a=0),null==b&&(b=0),this.clone=J(this.clone,this),this.cross=J(this.cross,this),this.dot=J(this.dot,this),this.polar=J(this.polar,this),this.angle=J(this.angle,this),this.rotateBy=J(this.rotateBy,this),this.scaleBy=J(this.scaleBy,this),this.divide=J(this.divide,this),this.multiply=J(this.multiply,this),this.subtract=J(this.subtract,this),this.add=J(this.add,this),this.normalize=J(this.normalize,this),this.length=J(this.length,this),this.x=a,this.y=b}return a.prototype.length=function(){return null==this._length?this._length=g.distance(a.origin,this):void 0},a.prototype.normalize=function(){var a;return a=this.length(),this.x/=a,this.y/=a,this},a.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.subtract=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.multiply=function(a){return this.x*=a.x,this.y*=a.y,this},a.prototype.divide=function(a){return this.x/=a.x,this.y/=a.y,this},a.prototype.scaleBy=function(a){return this.x*=a,this.y*=a,this},a.prototype.rotateBy=function(a){var b,c,d;return b=a*(Math.PI/180),c=this.x*Math.cos(b)-this.y*Math.sin(b),d=this.x*Math.sin(b)+this.y*Math.cos(b),this.x=c,this.y=d,this},a.prototype.angle=function(){var a,b;return b=Math.atan2(this.y,this.x),a=b*(180/Math.PI)},a.prototype.polar=function(){return[this.angle(),this.length()]},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y,this},a.prototype.cross=function(a){return this.x*a.y-this.y*a.x,this},a.prototype.clone=function(){return new a(this.x,this.y)},a.origin=function(){return new a(0,0)},a}(),h=function(){function a(){}return a.getPos=function(a,b,c){var d,e;return m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?e=m.cfg.SMALL_SCREEN?0+(parseFloat(m.cfg.height)*m.cfg.VIS_VERTICAL_SCALE-50)*(1-(a-b)/Math.max(1e-4,c-b)):20+(parseFloat(m.cfg.height)*m.cfg.VIS_VERTICAL_SCALE-150)*(1-(a-b)/Math.max(1e-4,c-b)):d=60+(parseFloat(m.cfg.width)*m.cfg.VIS_HORIZONTAL_SCALE-100)*((a-b)/Math.max(1e-4,c-b))},a.determineNumberOfItems=function(a,b){var c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s;if(null==b&&(b=!0),f=a.length,m.cfg.mode===m.cfg.MODES.EMBED){if(g=30,f=Math.floor(m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(m.cfg.width*m.cfg.VIS_HORIZONTAL_SCALE-110)/g:(m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-60)/g),f=Math.min(a.length,f),!b)return f;if(c=!1,null!=m.cfg.forceIncludedCountryID)for(h=function(a,b){return a.get("id")===m.cfg.forceIncludedCountryID&&b>=f?c=!0:void 0},d=k=0,p=a.length;p>k;d=++k)e=a[d],h(e,d);if(c)for(i=function(a,b){return f-1>b||a.get("id")===m.cfg.forceIncludedCountryID?a.set("visible",!0):a.set("visible",!1)},d=l=0,q=a.length;q>l;d=++l)e=a[d],i(e,d);else for(j=function(a,b){return f>b?a.set("visible",!0):a.set("visible",!1)},d=n=0,r=a.length;r>n;d=++n)e=a[d],j(e,d)}else if(b)for(o=0,s=a.length;s>o;o++)e=a[o],e.set("visible",!0);return f},a.determineNumberOfItemsLater=function(a){var b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r;if(e=a.length,m.cfg.mode===m.cfg.MODES.EMBED){if(f=30,e=Math.floor(m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(m.cfg.width*m.cfg.VIS_HORIZONTAL_SCALE-110)/f:(m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-60)/f),e=Math.min(a.length,e),b=!1,null!=m.cfg.forceIncludedCountryID)for(g=function(a,c){return a.get("country").get("id")===m.cfg.forceIncludedCountryID&&c>=e?b=!0:void 0},c=j=0,o=a.length;o>j;c=++j)d=a[c],g(d,c);if(b)for(h=function(a,b){return e-1>b||a.get("id")===m.cfg.forceIncludedCountryID?a.get("country").set("visible",!0):a.get("country").set("visible",!1)},c=k=0,p=a.length;p>k;c=++k)d=a[c],h(d,c);else for(i=function(a,b){return e>b?a.get("country").set("visible",!0):a.get("country").set("visible",!1)},c=l=0,q=a.length;q>l;c=++l)d=a[c],i(d,c)}else for(n=0,r=a.length;r>n;n++)d=a[n],d.get("country").set("visible",!0);return e},a.layout=function(a,b,c,d){var e,f,g,h,i,k,l,n,o,p,q,r,s,t,u=this;for(null==d&&(d=!0),m.cfg.mode===m.cfg.MODES.EMBED&&(a=_.sortBy(a,function(a){return-a.get("country").get("score")})),h=this.determineNumberOfItemsLater(a),c===m.cfg.SORTINGS.ALPHABETICALLY?a=_.sortBy(a,function(a){return i18n.t("vis.countries."+a.get("country").get("id"))}):c===m.cfg.SORTINGS.RANK&&(a=m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?_.sortBy(a,function(a){return a.get("country").get("inequalityScore")}):_.sortBy(a,function(a){return a.get("country").get("score")})),g=100,f=-100,l=function(a){return a.get("country").get("visible")?m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?(g=Math.min(g,a.get("country").get("womenscore")),f=Math.max(f,a.get("country").get("womenscore")),g=Math.min(g,a.get("country").get("menscore")),f=Math.max(f,a.get("country").get("menscore")),g=Math.min(g,a.get("country").get("inequalityScore")),f=Math.max(f,a.get("country").get("inequalityScore"))):(g=Math.min(g,a.get("country").get("score")),f=Math.max(f,a.get("country").get("score")),m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.PROFILE?(g=Math.min(g,a.get("country").get("compareScore")),f=Math.max(f,a.get("country").get("compareScore"))):void 0):void 0},p=0,s=a.length;s>p;p++)k=a[p],l(k);for(e=0,n=function(a){var b,c,i,k,l,n,o,p,q,r,s,t;if(a.get("country").get("visible"))return e++,s=t=0,q=k=b=i=n=0,r=l=o=1,p=0,m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?s=m.cfg.SMALL_SCREEN?-(m.cfg.FLOWER_WIDTH/2)+20+e*(parseFloat(m.cfg.width)*m.cfg.VIS_HORIZONTAL_SCALE-35)/h:-(m.cfg.FLOWER_WIDTH/2)+30+e*(parseFloat(m.cfg.width)*m.cfg.VIS_HORIZONTAL_SCALE-70)/h:t=-(m.cfg.FLOWER_WIDTH/2)+30+e*(parseFloat(m.cfg.height)*m.cfg.VIS_VERTICAL_SCALE-60)/h,m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.NONE?(m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?t=u.getPos(a.get("country").get("score"),g,f):s=u.getPos(a.get("country").get("score"),g,f),c=i18n.t("vis.countries."+a.get("country").get("id")),p=5.7*c.length):m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?(t=u.getPos(a.get("country").get("inequalityScore"),g,f),q=u.getPos(a.get("country").get("womenscore"),g,f)-t,r=Math.max(.75,Math.min(1.5,7*Math.sqrt(Math.abs(a.get("country").get("womenscore")-a.get("country").get("score"))))),k=u.getPos(a.get("country").get("menscore"),g,f)-t,l=Math.max(.75,Math.min(1.5,7*Math.sqrt(Math.abs(a.get("country").get("menscore")-a.get("country").get("score"))))),p=m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-m.cfg.FLOWER_HEIGHT-20-t,i=1):m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.PROFILE&&(t=u.getPos(a.get("country").get("score"),g,f),b=u.getPos(a.get("country").get("compareScore"),g,f)-t,o=Math.max(.75,Math.min(1.5,5*Math.sqrt(Math.abs(a.get("country").get("compareScore")-a.get("country").get("score"))))),p=m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-m.cfg.FLOWER_HEIGHT-20-t,n=1),a.updatePosition(new j(m.cfg.VIS_HORIZONTAL_OFFSET+s,m.cfg.VIS_VERTICAL_OFFSET+t),d),a.updateInequalityMarkers([r,l,q,k,i],d),a.updateCompareMarkers([o,b,n],d),a.updateLabelPosition(p,d)},q=0,t=a.length;t>q;q++)k=a[q],n(k);for(i=[],o=function(a){var b;return b=m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?m.cfg.VIS_VERTICAL_OFFSET+u.getPos(.1*a,g,f)+16:u.getPos(.1*a,g,f)+16,i.push(b)},e=r=0;11>r;e=++r)o(e);return b.updateLabelPositions(i,d)},a.calculateLayout=function(a,b){var c,d,e,f,g,h,i,j,k,l,n,o,p;for(m.cfg.mode===m.cfg.MODES.EMBED&&(a=_.sortBy(a,function(a){return-a.get("score")})),g=this.determineNumberOfItems(a),m.ctrls.interactionController.sorting===m.cfg.SORTINGS.ALPHABETICALLY?a=_.sortBy(a,function(a){return i18n.t("vis.countries."+a.get("id"))}):m.ctrls.interactionController.sorting===m.cfg.SORTINGS.RANK&&(a=m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?_.sortBy(a,function(a){return a.get("inequalityScore")}):_.sortBy(a,function(a){return a.get("score")})),f=100,e=-100,h=[],d=[],j=function(a){return a.get("visible")?void 0:(f=Math.min(f,a.get("score")),e=Math.max(e,a.get("score")))},l=0,o=a.length;o>l;l++)i=a[l],j(i);for(c=0,k=function(a,h){var i,j,k,l,n;return a.get("visible")?(c++,l=n=0,j=c,m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(l=-(m.cfg.FLOWER_WIDTH/2)+30+j*(parseFloat(m.cfg.width)*m.cfg.VIS_HORIZONTAL_SCALE-70)/g,n=b?b:this.getPos(a.get("score"),f,e)):(n=-(m.cfg.FLOWER_WIDTH/2)+30+j*(parseFloat(m.cfg.height)*m.cfg.VIS_VERTICAL_SCALE-60)/g,l=b?b:this.getPos(a.get("score"),f,e)),h.push({x:m.cfg.VIS_HORIZONTAL_OFFSET+l,y:m.cfg.VIS_VERTICAL_OFFSET+n}),k=0,m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.NONE?(i=i18n.t("vis.countries."+a.get("id")),k=5.7*i.length):m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?k=m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-m.cfg.FLOWER_HEIGHT-20-n:m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.PROFILE&&(k=m.cfg.height*m.cfg.VIS_VERTICAL_SCALE-m.cfg.FLOWER_HEIGHT-20-n),d.push(k)):(h.push({x:void 0,y:void 0}),void d.push(0))},n=0,p=a.length;p>n;n++)i=a[n],k(i,h);return[h,d]},a}(),i=function(){function a(){}return a.numCols=9,a.yOffset=200,a.rowHeight=53,a.layout=function(a,b,c,d){var e,f,g,h,i,k,l,n,o=this;for(null==d&&(d=!0),("ru"===(l=m.cfg.settings.locale)||"fr"===l)&&(this.yOffset=224,this.rowHeight=45),h=m.cfg.width,e=h/(1+this.numCols),n=[],f=i=0,k=a.length;k>i;f=++i)g=a[f],n.push(function(a,b){var c,f,g,h,i,k;return g=Math.floor(b/o.numCols),f=g%2,i=.5*e+b%o.numCols*e,f&&(i+=.5*e),k=g*o.rowHeight+o.yOffset,c=i18n.t("vis.countries."+a.get("country").get("id")),h=5.7*c.length,a.updateLabelPosition(h,d),a.updatePosition(new j(i,k),d)}(g,f));return n},a.calculateLayout=function(a,b){var c,d,e,f,g,h,i,j,k,l,n,o=this;for(("ru"===(l=m.cfg.settings.locale)||"fr"===l)&&(this.yOffset=224,this.rowHeight=45),h=m.cfg.width,c=h/(1+this.numCols),g=[],e=[],f=function(){n=[];for(var b=0,c=a.length;c>=0?c>b:b>c;c>=0?b++:b--)n.push(b);return n}.apply(this),i=function(d){var f,h,i,j,k,l;return i=Math.floor(d/o.numCols),h=i%2,k=.5*c+d%o.numCols*c,h&&(k+=.5*c),l=b?b:i*o.rowHeight+o.yOffset,g.push({x:k,y:l}),f=i18n.t("vis.countries."+a[d].get("id")),j=5.7*f.length,e.push(j)},j=0,k=f.length;k>j;j++)d=f[j],i(d);return[g,e]},a}(),e=function(){function a(){}return a.totalWidth=void 0,a.layout=function(b,c,d,e,f){var g,h,i,k,l,n,o,p,q,r,s,t,u,v,w,x,y;for(null==e&&(e=!0),null==f&&(f=!0),q=m.cfg.width,k=m.cfg.height,i=0,g=0,o=0,n=[],r=function(a){var b,c;return a.get("id")===m.cfg.selectedCountryID?(o=i+150,f&&(a.updateLeafSize(3*m.cfg.FLOWER_SIZE_RATIO,!1),a.updateLabelSize(1.5)),n.push(new j(i+150,k/2-m.cfg.FLOWER_HEIGHT/2)),i+=300):(b=i+30,c=k/2-m.cfg.FLOWER_HEIGHT/2,g%2?c-=30:c+=30,g++,n.push(new j(b,c)),i+=60)},l=t=0,w=b.length;w>t;l=++t)p=b[l],r(p,l);for(a.totalWidth=i+150,u=0,x=n.length;x>u;u++)h=n[u],h.x=h.x-o+q/2;if(this._checkPositions(n,a.totalWidth),f)for(s=function(a,b){return h=n[b],a.updatePosition(new j(h.x,h.y),e)},l=v=0,y=b.length;y>v;l=++v)p=b[l],s(p,l);return n},a._checkPositions=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(function(a){for(var c;a.x-m.cfg.FLOWER_WIDTH>m.cfg.width;)a.x-=b;for(c=[];a.x+m.cfg.FLOWER_WIDTH<0;)c.push(a.x+=b);return c}(c));return f},a.checkPositionsForFlowers=function(b){var c,d,e,f,g;for(g=[],c=e=0,f=b.length;f>e;c=++e)d=b[c],g.push(function(b){var c;for(c=new j(b.get("anchor").x,b.get("anchor").y);c.x-m.cfg.FLOWER_WIDTH>m.cfg.width;)c.x-=a.totalWidth;for(;c.x+m.cfg.FLOWER_WIDTH<0;)c.x+=a.totalWidth;return c.x!==b.get("anchor").x?b.updatePosition(c,!1):void 0}(d,c));return g},a.calculateLayout=function(a,b){var c,d,e,f,g,h,i,j;if(f=this.layout(a,null,null,!1,!1),b)for(g=0,i=f.length;i>g;g++)e=f[g],e.y=b;for(c=[],h=0,j=f.length;j>h;h++)d=f[h],c.push(0);return[f,c]},a}.call(this),c=function(){function a(){}return a.interpolate=function(a,c,d){var e;return e=b.rgba(a.red+d*(c.red-a.red),a.green+d*(c.green-a.green),a.blue+d*(c.blue-a.blue),a.alpha+d*(c.alpha-a.alpha))},a.darker=function(a,c){var d;return null==c&&(c=1),c=Math.pow(.7,c),d=b.rgba(Math.max(0,+(c*a.red)),Math.max(0,+(c*a.green)),Math.max(0,+(c*a.blue)),a.alpha)},a}(),d=function(){function a(){}return a.categoryColorCounter=0,a.categoryColorDict=void 0,a.darkBackgroundColor=void 0,a.lightBackgroundColor=void 0,a.womenMarkerColorCSS="#DB3A3A",a.menMarkerColorCSS="#2E3F5B",a.womenStrokeMarkerColorCSS="#D8D9DA",a.menStrokeMarkerColorCSS="#E5E8E9",a.initializeColors=function(){return this.darkBackgroundColorCSS="#6F7F9A",this.darkBackgroundColor=b.css(this.darkBackgroundColorCSS),this.lightBackgroundColor=b.css("#B3BCCD"),this.backgroundLineColor=b.css("#A4CAAE"),this.womenMarkerColor=b.css(this.womenMarkerColorCSS),this.menMarkerColor=b.css(this.menMarkerColorCSS),this.womenStrokeMarkerColor=b.css(this.womenStrokeMarkerColorCSS),this.menStrokeMarkerColor=b.css(this.menStrokeMarkerColorCSS),this.initCategoryColorDict()},a.getCategoryColor=function(b){var c;return c=a.categoryColorDict[b]},a.initCategoryColorDict=function(){return a.categoryColorDict=[],a.categoryColorDict.push(b.css("#3DA594"),b.css("#2CA3E0"),b.css("#237FBD"),b.css("#CE485D"),b.css("#7EA943"),b.css("#30A457"),b.css("#DCA922"),b.css("#7C3A73"),b.css("#E26237"),b.css("#606060"),b.css("#962828"))},a.getColorForIndex=function(a){return FlareHelpers.hsv(.4*a-Math.floor(.4*a),.8,.6)},a}.call(this),window.Country=function(a){function b(){return q=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){return{id:void 0,label:void 0,url:void 0,dimensions:void 0,score:void 0,womenscore:void 0,menscore:void 0,inequalityScore:void 0,visible:!0}},b.prototype.url="",b.prototype.sync=function(){return this},b.prototype.calculateScore=function(){var a,b,c,d;return c=d=b=a=0,this.get("dimensions").each(function(e){return c+=parseFloat(e.get("normalized"))*m.models.weightProfiles.weightById(e.id).get("weightShare"),d+=parseFloat(e.get("women"))*m.models.weightProfiles.weightById(e.id).get("weightShare"),b+=parseFloat(e.get("men"))*m.models.weightProfiles.weightById(e.id).get("weightShare"),a+=parseFloat(e.get("normalized"))*m.models.weightProfiles.weightById(e.id).get("compareWeightShare")}),this.set("score",c),this.set("womenscore",d),this.set("menscore",b),this.set("inequalityScore",(d+b)/2),this.set("compareScore",a)},b}(Backbone.Model),window.Countries=function(a){function b(){return y=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.model=window.Country,b}(Backbone.Collection),window.Indicator=function(a){function b(){return z=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){},b.prototype.url="",b.prototype.sync=function(){return this},b}(Backbone.Model),window.Indicators=function(a){function b(){return A=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.model=window.Indicator,b}(Backbone.Collection),window.Dimension=function(a){function b(){return B=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){return{id:void 0,label:void 0,oneSentence:void 0,indexPosition:void 0,indicators:void 0,normalized:void 0,women:void 0,men:void 0}},b.prototype.url="",b.prototype.sync=function(){return this},b}(Backbone.Model),window.Dimensions=function(a){function b(){return C=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.model=window.Dimension,b}(Backbone.Collection),window.WeightProfile=function(a){function b(){return D=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){return{weight:1,weightShare:void 0,compareWeight:void 0,compareWeightShare:void 0}},b.prototype.url="",b.prototype.sync=function(){return this},b}(Backbone.Model),window.WeightProfiles=function(a){function b(){return this.updateCompareWeightShares=J(this.updateCompareWeightShares,this),this.finishedUpdatingWeights=J(this.finishedUpdatingWeights,this),this.updateWeightsWithArray=J(this.updateWeightsWithArray,this),this.updateWeights=J(this.updateWeights,this),this.muteAllExcept=J(this.muteAllExcept,this),this.toString=J(this.toString,this),this.calculateNormalizedWeights=J(this.calculateNormalizedWeights,this),this.weightById=J(this.weightById,this),E=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.model=window.WeightProfile,b.prototype.maxDimensionWeight=0,b.prototype.weightById=function(a){return this.find(function(b){return b.id===a})},b.prototype.calculateNormalizedWeights=function(){var a=this;return this.numberOfDimensions=this.length,this.each(function(b){return b.set("weightShare",b.get("weight")/a.numberOfDimensions)}),this.maxDimensionWeight=1/this.length},b.prototype.toString=function(){var a;return a="",this.each(function(b){return a+=b.get("weight")}),a},b.prototype.muteAllExcept=function(a){var b;return b="",this.each(function(c){return b+=c.id===a?"1":"0"}),this.updateWeights(b,!1)},b.prototype.updateWeights=function(a,b){var c,d,e,f,g,h,i;for(null==b&&(b=!0),null==a&&(a="11111111111"),a.length<11&&(a="11111111111"),a.length>11&&(a=a.substr(0,11)),/^\d+$/.test(a)||(a="11111111111"),"00000000000"===a&&(a="11111111111"),e=[],this.each(function(a,b){return e[b]=a.get("weightShare")}),e.maxDimensionWeight=this.maxDimensionWeight,f=[],d=h=0,i=a.length;i>h;d=++h)c=a[d],f[d]=parseInt(c);return this.updateWeightsWithArray(f,!1),b?(g=[],this.each(function(a,b){return g[b]=a.get("weightShare")}),g.maxDimensionWeight=this.maxDimensionWeight,e.model=this,m.ctrls.animationController.setupWeightAnimation(e,g)):void 0},b.prototype.updateWeightsWithArray=function(a,b){var c,d,e,f,g=this;for(null==b&&(b=!0),this.numberOfDimensions=a.length,d=0,e=0,f=a.length;f>e;e++)c=a[e],d+=c;return this.maxDimensionWeight=0,this.each(function(b,c){return b.set("weight",a[c]),b.set("weightShare",b.get("weight")/d),b.get("weightShare")>g.maxDimensionWeight?g.maxDimensionWeight=b.get("weightShare"):void 0}),b?this.trigger("updatedWeights"):void 0},b.prototype.finishedUpdatingWeights=function(){return this.trigger("finishedUpdatingWeights")},b.prototype.updateCompareWeightShares=function(a){var b,c,d,e,f=this;for(c=0,d=0,e=a.length;e>d;d++)b=a[d],c+=parseFloat(b);return this.maxCompareDimensionWeight=0,this.each(function(b,d){return b.set("compareWeight",parseFloat(a[d])),b.set("compareWeightShare",b.get("compareWeight")/c),b.get("compareWeightShare")>f.maxCompareDimensionWeight?f.maxCompareDimensionWeight=b.get("compareWeightShare"):void 0}),this.trigger("updatedCompareWeights")},b}(Backbone.Collection),window.HoverboxModel=function(a){function b(){return F=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){return{country:void 0,position:new j,event:void 0}},b}(Backbone.Model),window.FlowerModel=function(a){function e(){return this._layoutLeaves=J(this._layoutLeaves,this),this.pointIsWithinFlower=J(this.pointIsWithinFlower,this),this._calculateLeafColor=J(this._calculateLeafColor,this),this._calculateLeafColors=J(this._calculateLeafColors,this),this.generateValuesForWeightShares=J(this.generateValuesForWeightShares,this),this.animateLabelPosition=J(this.animateLabelPosition,this),this.updateLabelPosition=J(this.updateLabelPosition,this),this.animateComparisonMarkers=J(this.animateComparisonMarkers,this),this.updateCompareMarkers=J(this.updateCompareMarkers,this),this.animateInequalityMarkers=J(this.animateInequalityMarkers,this),this.updateInequalityMarkers=J(this.updateInequalityMarkers,this),this.updateLabelSize=J(this.updateLabelSize,this),this.animateLeafSize=J(this.animateLeafSize,this),this.updateLeafSize=J(this.updateLeafSize,this),this.setFinalPosition=J(this.setFinalPosition,this),this.animatePosition=J(this.animatePosition,this),this.updatePosition=J(this.updatePosition,this),this.refresh=J(this.refresh,this),r=e.__super__.constructor.apply(this,arguments)}return I(e,a),e.prototype.stack=void 0,e.prototype.defaults=function(){return{country:void 0,values:void 0,previousValues:void 0,anchor:void 0,finalAnchor:void 0,verticalAnchorPosition:void 0,previousleafsize:void 0,leafsize:void 0,labelsize:void 0,inequalityValues:void 0,compareValues:void 0,glowing:void 0,maxDist:void 0}},e.prototype.initialize=function(a,b,c){return this.stack=[],this.set("values",{}),this.set("colorValues",{}),this.set("anchor",new j(b.x,b.y)),this.set("finalAnchor",new j(b.x,b.y)),this.set("verticalAnchorPosition",c),m.cfg.mode===m.cfg.MODES.COUNTRY&&m.cfg.selectedCountryID===this.get("id")?(this.set("previousleafsize",3),this.set("leafsize",3)):(this.set("previousleafsize",1),this.set("leafsize",1)),this.set("labelsize",1),this.set("country",a),this.set("inequalityValues",[1,1,0,0,0]),this.set("compareValues",[1,0,0]),this.set("glowing",!1),this.set("maxDist",0),this.refresh()},e.prototype.refresh=function(a){return null==a&&(a=!1),this.set("previousValues",this.get("values")),this._layoutLeaves(a),this.set("previousColorValues",this.get("colorValues")),this._calculateLeafColors(),this.trigger("updateRefresh")},e.prototype.updatePosition=function(a,b){var c;return null==b&&(b=!0),b?(c=this.get("anchor"),void 0===c&&(c=new j),m.ctrls.animationController.setupPositionAnimation({model:this,x:c.x,y:c.y},{x:a.x,y:a.y})):this.animatePosition(a)},e.prototype.animatePosition=function(a){return this.set("previousAnchor",this.get("anchor")),this.set("anchor",new j(a.x,a.y))},e.prototype.setFinalPosition=function(a){return this.set("finalAnchor",a)},e.prototype.updateLeafSize=function(a,b){var c;return null==b&&(b=!0),b?(c=this.get("leafsize"),void 0===c&&(c=1),m.ctrls.animationController.setupLeafSizeAnimation({model:this,value:c},{value:a})):this.animateLeafSize(a,!0)},e.prototype.animateLeafSize=function(a){return this.set("previousleafsize",this.get("leafsize")),this.set("leafsize",a)},e.prototype.updateLabelSize=function(a){return this.set("labelsize",a)},e.prototype.updateInequalityMarkers=function(a,b){var c;return null==b&&(b=!0),c=this.get("inequalityValues"),void 0===c&&(c=[1,1,0,0,0]),0===c[4]&&0===a[4]&&this.animateInequalityMarkers(a),b?m.ctrls.animationController.setupInequalityMarkerAnimation(this,c,a):this.animateInequalityMarkers(a)},e.prototype.animateInequalityMarkers=function(a){return this.set("inequalityValues",a.slice(0))},e.prototype.updateCompareMarkers=function(a,b){var c;return null==b&&(b=!0),c=this.get("compareValues"),void 0===c&&(c=[1,0,0]),0===c[2]&&0===a[2]&&this.animateComparisonMarkers(a),b?m.ctrls.animationController.setupComparisonMarkerAnimation(this,c,a):this.animateComparisonMarkers(a)},e.prototype.animateComparisonMarkers=function(a){return this.set("compareValues",a.slice(0))},e.prototype.updateLabelPosition=function(a,b){return null==b&&(b=!0),b?m.ctrls.animationController.setupLabelPositionAnimation(this,this.get("verticalAnchorPosition"),a):this.animateLabelPosition(a)},e.prototype.animateLabelPosition=function(a){return this.set("verticalAnchorPosition",a)},e.prototype.generateValuesForWeightShares=function(a){var b,c,d=this;return c=this._layoutLeavesHypothetically(a),b={},this.get("country").get("dimensions").each(function(e){return b[e.id]=d._calculateLeafColor(a[e.get("indexPosition")],a.maxDimensionWeight,e,c[e.id])}),this.stack.push({leaves:c,colors:b,weightShares:a})},e.prototype._calculateLeafColors=function(){var a,b=this;return a={},this.get("country").get("dimensions").each(function(c){var d;return d=m.models.weightProfiles.weightById(c.id).get("weightShare"),a[c.id]=b._calculateLeafColor(d,m.models.weightProfiles.maxDimensionWeight,c,b.get("values")[c.id])}),this.set("colorValues",a)},e.prototype._calculateLeafColor=function(a,e,f,g){var h,i,j,k,l,m,n,o;return n={},k=a+.66*a/e,k=Math.min(.999,k),k=Math.sqrt(k)+.001,o=d.getCategoryColor(f.get("indexPosition")),i=c.interpolate(b.rgba(255,255,255,.86),o,k),h=b.hsv(i.hue,i.saturationHSV*k,i.value),l=b.color(h),j=c.darker(h,1),n.gradientPositions=[0,0,g.rEndPoint.x,g.rEndPoint.y],n.gradientStops=[[0,j.toCss(!0)],[.5,l.toCss(!0)]],h=c.darker(l,2),m=b.hsv(h.hue,h.saturationHSV,h.value,.8),n.lighterColor=l,n.darkerColor=j,n.lineColor=m,n},e.prototype._rotatePoint=function(a,b,c){return{x:a*Math.cos(c)-b*Math.sin(c),y:a*Math.sin(c)+b*Math.cos(c)}},e.prototype._distance=function(a,b){return Math.sqrt(Math.pow(a,2)+Math.pow(b,2))},e.prototype.pointIsWithinFlower=function(a,b){return this._distance(this.get("anchor").x+m.cfg.FLOWER_WIDTH/2-a,this.get("anchor").y+m.cfg.FLOWER_HEIGHT/2-b)<this.get("maxDist")},e.prototype._layoutLeavesHypothetically=function(a,b){var c,d,e,f,g,h,i,k,l,n=this;return null==b&&(b=!1),c=0,h=.07,g=2*h*Math.PI,i=2*Math.PI-g*this.get("country").get("dimensions").length,k=0,l=m.cfg.FLOWER_WIDTH,b&&(l*=this.get("leafsize")),d=m.cfg.FLOWER_HEIGHT,b&&(d*=this.get("leafsize")),e={},this.get("country").get("dimensions").each(function(b){var c;return c=a[b.get("indexPosition")],c>h?k+=c-h:void 0}),f=-1/0,this.get("country").get("dimensions").each(function(b){var l,p,q,r,s,t,u,v,w;return q=new j(m.cfg.FLOWER_WIDTH/2,m.cfg.FLOWER_HEIGHT/2),t={},t.origin=q,t.lineAlpha=.4,l=void 0,w=void 0,v=a[b.get("indexPosition")],t.weightShare=v,w=h>v?g:g+(v-h)/k*i,u=.5*d*parseFloat(b.get("normalized")),l=c,c+=w,t.w=.1+3*w,t.h=Math.max(.05,.04*u),t.rotation=180-180*(l+.5*w)/Math.PI,r=t.w*m.cfg.CURVATURE*m.cfg.LENGTH*t.h,s=m.cfg.LENGTH*t.h,t.rLeafControl1=n._rotatePoint(r,.8*s,t.rotation*Math.PI/180),t.rLeafControl2=n._rotatePoint(-r,.8*s,t.rotation*Math.PI/180),t.rEndPoint=n._rotatePoint(0,s,t.rotation*Math.PI/180),t.curve1={cX:t.rLeafControl1.x,cY:t.rLeafControl1.y,x:o.round(t.rEndPoint.x),y:o.round(t.rEndPoint.y)},t.curve2={cX:t.rLeafControl2.x,cY:t.rLeafControl2.y,x:0,y:0},p=n._distance(t.rEndPoint.x,t.rEndPoint.y),p>f&&(f=p),e[b.id]=t}),this.set("maxDist",f),e},e.prototype._layoutLeaves=function(a){var b,c;return null==a&&(a=!1),c=[],m.models.weightProfiles.each(function(a,b){return c[b]=a.get("weightShare")}),b=this._layoutLeavesHypothetically(c,a),this.set("values",b)},e}(Backbone.Model),window.ViewableModel=function(a){function b(){return this._onContainedModelEvent=J(this._onContainedModelEvent,this),s=b.__super__.constructor.apply(this,arguments)}return I(b,a),b.prototype.defaults=function(){return{countries:void 0,weightProfiles:void 0}},b.prototype.url="",b.prototype.sync=function(){return this},b.prototype.initialize=function(){return this.get("countries").on("all",this._onContainedModelEvent,this),this.get("weightProfile").on("all",this._onContainedModelEvent,this)},b.prototype._onContainedModelEvent=function(a){return"updatedWeights"===a&&(this.get("countries").each(function(a){return a.calculateScore()}),this.trigger("updatedWeights")),"updatedCompareWeights"===a&&(this.get("countries").each(function(a){return a.calculateScore()}),this.trigger("finishedUpdatingWeights")),"finishedUpdatingWeights"===a?this.trigger("finishedUpdatingWeights"):void 0},b}(Backbone.Model),window.NativeFlowerView=function(b){function c(){return this._setupLeaves=J(this._setupLeaves,this),this.render=J(this.render,this),this._reposition=J(this._reposition,this),this._repositionAnimated=J(this._repositionAnimated,this),this._repositionDirectly=J(this._repositionDirectly,this),t=c.__super__.constructor.apply(this,arguments)}return I(c,b),c.prototype.leafPaths=void 0,c.prototype.leafGroup=void 0,c.prototype.womenInequalityMarker=void 0,c.prototype.menInequalityMarker=void 0,c.prototype.compareMarker=void 0,c.prototype.compareMarkerImg=void 0,c.prototype.comparisonLine=void 0,c.prototype.constantCircleSize=!0,c.prototype.constantCompareMarkerSize=!0,c.prototype.initialize=function(){return this.el.flowerViewModel=this.model,this.leafPaths=new Array,this.compareImg=new Image,this.compareImg.src=m.cfg.settings.assetLocation+"/media/bli/theme/img/viz/compareFlower.png",this._setupLeaves(),this.model.on("change:anchor",this._repositionDirectly),this.model.on("change:finalAnchor",this._repositionAnimated),this.model.on("minor change:leafsize",this.render),this.model.on("change:inequalityValues",this.render),this.model.on("change:compareValues",this.render),this.model.on("change:glowing",this.render),this.model.on("updateRefresh",this.render),this.model.get("country").on("change:visible",this.render)},c.prototype._repositionDirectly=function(){return this._reposition(!1)},c.prototype._repositionAnimated=function(){return this._reposition(!0)},c.prototype._reposition=function(b){var c,d;if(this.model.get("country").get("visible"))return c=this.model.get("leafsize"),1>c&&(c=1),m.cfg.orientation===m.cfg.ORIENTATIONS.LEFT_TO_RIGHT?(d="rotateZ(90deg) ",a(this.el).css("transform-origin","0% 0%"),a(this.el).css("transform",d),b?a(this.el).transition({left:this.model.get("finalAnchor").x+m.cfg.FLOWER_WIDTH/2/1.6+m.cfg.FLOWER_HEADROOM,top:this.model.get("finalAnchor").y-m.cfg.FLOWER_WIDTH/2/1.6},m.cfg.animations.POSITION_DURATION,"easeInOutQuad"):a(this.el).css({left:this.model.get("anchor").x+m.cfg.FLOWER_WIDTH/2/1.6+m.cfg.FLOWER_HEADROOM,top:this.model.get("anchor").y-m.cfg.FLOWER_WIDTH/2/1.6})):b&&0!==m.cfg.animations.POSITION_DURATION?a(this.el).transition({left:this.model.get("finalAnchor").x-1.6*c*m.cfg.FLOWER_WIDTH/2+m.cfg.FLOWER_WIDTH/2,top:this.model.get("finalAnchor").y-1.6*c*m.cfg.FLOWER_HEIGHT/2+m.cfg.FLOWER_HEIGHT/2-m.cfg.FLOWER_HEADROOM},m.cfg.animations.POSITION_DURATION,"easeInOutQuad"):a(this.el).css({left:this.model.get("anchor").x-1.6*c*m.cfg.FLOWER_WIDTH/2+m.cfg.FLOWER_WIDTH/2,top:this.model.get("anchor").y-1.6*c*m.cfg.FLOWER_HEIGHT/2+m.cfg.FLOWER_HEIGHT/2-m.cfg.FLOWER_HEADROOM})},c.prototype.render=function(){var b,c,e,f,g,h,i,j,k,l,n,p,q,r,s,t,u,v,w=this;if(this.model.get("country").get("visible")){r=this.model.get("leafsize"),1>r&&(r=1),this.el.width=1.6*m.cfg.FLOWER_WIDTH*r,this.el.height=3*m.cfg.FLOWER_HEIGHT*r+m.cfg.FLOWER_FOOTROOM+m.cfg.FLOWER_HEADROOM,e=this.el.getContext("2d"),t=m.cfg.FLOWER_SCALING_RATIO,a(this.el).css("width",this.el.width),a(this.el).css("height",this.el.height),this.el.width*=t,this.el.height*=t,e.scale(t,t),e.translate(0,m.cfg.FLOWER_HEADROOM),s={x:1.6*m.cfg.FLOWER_WIDTH*r/2,y:1.6*m.cfg.FLOWER_HEIGHT*r/2},k=this.model.get("leafsize"),e.translate(o.round(s.x),o.round(s.y)),b=d.backgroundLineColor.toCss(!1),e.beginPath(),e.moveTo(0,0),e.lineTo(0,Math.max(500,m.cfg.height)),e.strokeStyle=b,e.stroke(),l=this.model.get("values"),i=this.model.get("colorValues"),this.model.get("glowing")&&(e.beginPath(),e.arc(0,0,m.cfg.FLOWER_HEIGHT*k*1.6/2,0,2*Math.PI,!1),f=e.createRadialGradient(0,0,0,0,0,m.cfg.FLOWER_WIDTH*k*.8),f.addColorStop(.5,"rgba(255,255,255,0.6)"),f.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=f,e.fill()),e.save(),e.scale(k,k),k>1&&(e.lineWidth=1/k),v=function(a){var b,c,d,f;return c=l[a],d=i[a],f=w.leafPaths[a],e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(c.curve1.cX,c.curve1.cY,c.curve1.x,c.curve1.y),e.quadraticCurveTo(c.curve2.cX,c.curve2.cY,c.curve2.x,c.curve2.y),e.strokeStyle=d.lineColor.toCss(!0),e.stroke(),b=e.createLinearGradient(d.gradientPositions[0],d.gradientPositions[1],d.gradientPositions[2],d.gradientPositions[3]),b.addColorStop(d.gradientStops[0][0],d.gradientStops[0][1]),b.addColorStop(d.gradientStops[1][0],d.gradientStops[1][1]),e.fillStyle=b,e.fill()
};for(j in l)g=l[j],v(j,g);return e.restore(),c=this.model.get("compareValues"),c[2]>0&&(p={x:-14,y:o.round(c[1])-14},e.beginPath(),e.moveTo(0,0),e.lineTo(0,p.y+16),e.strokeStyle="rgba(0,0,0,0.8)",e.stroke(),e.globalAlpha=c[2],e.drawImage(this.compareImg,p.x,p.y)),h=this.model.get("inequalityValues"),h[4]>0?(u={x:0,y:o.round(h[2])},n={x:0,y:o.round(h[3])},e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(n.x,n.y),e.strokeStyle="rgba(0,0,0,0.8)",e.stroke(),e.strokeStyle="rgba(255,255,255,"+h[4]+")",q=5,e.beginPath(),e.arc(u.x,u.y,q,0,2*Math.PI,!1),e.fillStyle="rgba(229,59,53,"+h[4]+")",e.stroke(),e.fill(),e.beginPath(),e.arc(n.x,n.y,q,0,2*Math.PI,!1),e.fillStyle="rgba(45,62,92,"+h[4]+")",e.stroke(),e.fill()):void 0}},c.prototype._setupLeaves=function(){var b,c;return b=this.model.get("leafsize"),m.cfg.orientation===m.cfg.ORIENTATIONS.LEFT_TO_RIGHT?(c="rotateZ(90deg) ",a(this.el).css("transform-origin","0% 0%"),a(this.el).css("transform",c),a(this.el).css({left:this.model.get("finalAnchor").x+m.cfg.FLOWER_WIDTH/2/1.6+m.cfg.FLOWER_HEADROOM,top:this.model.get("finalAnchor").y-m.cfg.FLOWER_WIDTH/2/1.6})):a(this.el).css({left:this.model.get("finalAnchor").x-1.6*b*m.cfg.FLOWER_WIDTH/2+m.cfg.FLOWER_WIDTH/2,top:this.model.get("finalAnchor").y-1.6*b*m.cfg.FLOWER_HEIGHT/2+m.cfg.FLOWER_HEIGHT/2-m.cfg.FLOWER_HEADROOM})},c}(Backbone.View),window.FlowerLabelView=function(b){function c(){return this.render=J(this.render,this),this._moveLabelCSSAnims=J(this._moveLabelCSSAnims,this),this._moveLabelAnimated=J(this._moveLabelAnimated,this),this._moveLabelDirectly=J(this._moveLabelDirectly,this),this._showOrHideLabel=J(this._showOrHideLabel,this),this._changeGlowing=J(this._changeGlowing,this),u=c.__super__.constructor.apply(this,arguments)}return I(c,b),c.prototype.initialize=function(){return this.el.name=this.model.id,this.model.on("change:anchor",this._moveLabelDirectly),this.model.on("change:finalAnchor",this._moveLabelAnimated),this.model.on("change:verticalAnchorPosition",this._moveLabelAnimated),this.model.on("change:labelsize",this.render),this.model.on("change:glowing",this._changeGlowing),this.model.get("country").on("change:visible",this._showOrHideLabel),this.render()},c.prototype._changeGlowing=function(){return this.model.get("glowing")?a(this.el).addClass("active"):a(this.el).removeClass("active")},c.prototype._showOrHideLabel=function(){return this.model.get("country").get("visible")?a(this.el).css("visibility","visible"):a(this.el).css("visibility","hidden")},c.prototype._moveLabelDirectly=function(){return this._moveLabelCSSAnims(!1)},c.prototype._moveLabelAnimated=function(){return this._moveLabelCSSAnims(!0)},c.prototype._moveLabelCSSAnims=function(b){var c,d,e,f;return e=f=0,d=void 0,d=this.model.get(b?"finalAnchor":"anchor"),m.cfg.mode!==m.cfg.MODES.COUNTRY?m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(e=Math.round(d.x-m.cfg.FLOWER_WIDTH),f=Math.round(this.model.get("verticalAnchorPosition")+d.y-m.cfg.FLOWER_HEIGHT/2)):(e=Math.round(-this.model.get("verticalAnchorPosition")+d.x-m.cfg.FLOWER_WIDTH),f=Math.round(d.y+m.cfg.FLOWER_HEIGHT/2-5)):(c=d,e=c.x-75+m.cfg.FLOWER_WIDTH/2,f=c.y,f+=1===this.model.get("labelsize")?45:45+75*m.cfg.FLOWER_SIZE_RATIO),b&&m.ctrls.animationController.animationLevel>0&&m.cfg.animations.LABEL_POSITION_DURATION>0?a(this.el).transition({left:e+"px",top:f+"px"},m.cfg.animations.LABEL_POSITION_DURATION,"easeInOutQuad"):a(this.el).css({left:e+"px",top:f+"px"})},c.prototype.render=function(){var b,c,d,e,f;return a(this.el).text(i18n.t("vis.countries."+this.model.get("country").get("id"))),this._showOrHideLabel(),d=e=0,m.cfg.mode!==m.cfg.MODES.COUNTRY?(m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(d=Math.round(this.model.get("finalAnchor").x-m.cfg.FLOWER_WIDTH),e=Math.round(this.model.get("verticalAnchorPosition")+this.model.get("finalAnchor").y-m.cfg.FLOWER_HEIGHT/2)):(d=Math.round(-this.model.get("verticalAnchorPosition")+this.model.get("anchor").x-m.cfg.FLOWER_WIDTH),e=Math.round(this.model.get("anchor").y+m.cfg.FLOWER_HEIGHT/2-5)),m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP&&(c="rotateZ(-90deg)",a(this.el).css("-webkit-transform",c),a(this.el).css("-moz-transform",c),a(this.el).css("transform",c)),a(this.el).css("left",d+"px"),a(this.el).css("top",e+"px")):(a(this.el).css("left",this.model.get("anchor").x-75+m.cfg.FLOWER_WIDTH/2),f=this.model.get("anchor").y,1===this.model.get("labelsize")?f+=45:(f+=45+75*m.cfg.FLOWER_SIZE_RATIO,b=12,b*=this.model.get("labelsize"),a(this.el).css("font-size",b)),a(this.el).css("top",f),a(this.el).css("text-align","center"))},c}(Backbone.View),window.HoverboxView=function(b){function c(){return this.render=J(this.render,this),this.hideHoverbox=J(this.hideHoverbox,this),this._changeValues=J(this._changeValues,this),v=c.__super__.constructor.apply(this,arguments)}return I(c,b),c.prototype.qTipApi=void 0,c.prototype.ttVisible=void 0,c.prototype.initialized=!1,c.prototype.initialize=function(){return this.model.on("change",this._changeValues)},c.prototype._changeValues=function(){var b,c,e,f,g,h,i,j,k,l;if(this.model.get("country"))try{switch(f=i18n.t("vis.countries."+this.model.get("country").get("id")),c="",this.model.get("comparisonMode")){case m.cfg.INEQUALITY_COMPARISONS.NONE:e="",this.model.get("country").get("dimensions").each(function(a){var b,e,f;return f=i18n.t("vis.dimensions."+a.id),-1!==String(a.get("normalized")).indexOf("~")&&(f+="*"),e=72*parseFloat(a.get("normalized")),0===e&&(e=1),b=d.getCategoryColor(a.get("indexPosition")),c+='<div class="dimensionLabel">'+f+'</div>\n<div class="barChartBar" style="width:'+e+"px; background:"+b.toCss(!0)+'">Â </div>'});break;case m.cfg.INEQUALITY_COMPARISONS.GENDER:e="gender",k=parseFloat(10*this.model.get("country").get("womenscore")).toFixed(1),i=parseFloat(10*this.model.get("country").get("menscore")).toFixed(1),c+='<div>\n	<div class="dimensionLabel">'+i18n.t("vis.hoverbox.genderComparison.women")+'</div>\n	<div class="dimensionValue">'+k+'</div>\n</div>\n<div>\n	<div class="dimensionLabel">'+i18n.t("vis.hoverbox.genderComparison.men")+'</div>\n	<div class="dimensionValue">'+i+"</div>\n</div>";break;case m.cfg.INEQUALITY_COMPARISONS.PROFILE:e="profile",l=parseFloat(10*this.model.get("country").get("score")).toFixed(1),b=parseFloat(10*this.model.get("country").get("compareScore")).toFixed(1),c+='<div>\n	<div class="dimensionLabel">'+i18n.t("vis.hoverbox.profileComparison.your")+'</div>\n	<div class="dimensionValue">'+l+'</div>\n</div>\n<div>\n	<div class="dimensionLabel">'+i18n.t("vis.hoverbox.profileComparison.avg")+'</div>\n	<div class="dimensionValue">'+b+"</div>\n</div>"}if(h='<div class="header">\n	'+f+'\n</div>\n<div class="content clearfix '+e+'">\n	'+c+"\n</div>",this.model.get("comparisonMode")===m.cfg.INEQUALITY_COMPARISONS.NONE&&(h+='<div class="estimatedLabel">*'+i18n.t("vis.hoverbox.estimatedLabel")+"</div>"),this.$el.html(h),j=this.model.get("position"),this.initialized?(m.cfg.orientation===m.cfg.ORIENTATIONS.LEFT_TO_RIGHT&&(j.x-=m.cfg.FLOWER_WIDTH),this.qTipApi.set("position.target",[j.x,j.y])):(a(this.el).qtip({id:"hoverbox",content:{text:a(this.$el)},position:{target:[j.x,j.y],viewport:m.mainDiv,my:"bottom center",at:"top center",adjust:{x:0,y:-20,mouse:!1},container:m.mainDiv}}),a(this.el).qtip.zindex=22e3,this.qTipApi=a(this.$el).qtip("api"),this.ttVisible=!1,this.initialized=!0),this.model.get("country")&&!m.ctrls.interactionController.helpIsActive)return this.qTipApi.show(),this.ttVisible=!0}catch(o){return g=o,n(g)}},c.prototype.hideHoverbox=function(){return!this.model.get("country")&&this.ttVisible?(a("#qtip-hoverbox").css("display","none"),this.ttVisible=!1):void 0},c.prototype.render=function(){},c.prototype.moveTo=function(a){return this.$el.css({left:a.x-this.$el.width()/2,top:a.y-this.$el.height()-10})},c}(Backbone.View),window.HomeView=function(b){function c(){return this._finishedUpdatingWeights=J(this._finishedUpdatingWeights,this),this._updatedWeights=J(this._updatedWeights,this),this._layoutFlowersAndScale=J(this._layoutFlowersAndScale,this),this._generateScaleView=J(this._generateScaleView,this),this._generateHoverbox=J(this._generateHoverbox,this),this._generateFlowers=J(this._generateFlowers,this),this._checkForFlowerTouchUp=J(this._checkForFlowerTouchUp,this),this._checkForFlowerTouchDown=J(this._checkForFlowerTouchDown,this),this._checkForFlowerClick=J(this._checkForFlowerClick,this),this._checkForFlowerHover=J(this._checkForFlowerHover,this),this._noHovering=J(this._noHovering,this),this._hoverOverFlower=J(this._hoverOverFlower,this),this._initializeView=J(this._initializeView,this),this.shiftAllFlowersHorizontallyBy=J(this.shiftAllFlowersHorizontallyBy,this),this.toggleComparison=J(this.toggleComparison,this),this.checkFlowerStacks=J(this.checkFlowerStacks,this),this.calculateFlowersFor=J(this.calculateFlowersFor,this),this.render=J(this.render,this),w=c.__super__.constructor.apply(this,arguments)}return I(c,b),c.prototype.flowerViews=void 0,c.prototype.flowerModels=void 0,c.prototype.hoverbox=void 0,c.prototype.hoverboxModel=void 0,c.prototype.scaleView=void 0,c.prototype.backgroundColor=void 0,c.prototype.firstRun=!0,c.prototype.currentLayout=void 0,c.prototype.maxZIndex=10,c.prototype.initialize=function(){return this.model.on("updatedWeights",this._updatedWeights),this.model.on("finishedUpdatingWeights",this._finishedUpdatingWeights)},c.prototype.render=function(){var a,b,c,d,e,f,g,h,i;for(g=this.flowerViews,c=0,e=g.length;e>c;c++)a=g[c],a.render();for(h=this.flowerLabels,i=[],d=0,f=h.length;f>d;d++)b=h[d],i.push(b.render());return i},c.prototype.calculateFlowersFor=function(a){var b,c,d,e,f;for(e=this.flowerModels,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.generateValuesForWeightShares(a));return f},c.prototype.checkFlowerStacks=function(){var a,b,c,d,e,f,g;for(a=!1,g=this.flowerModels,d=function(b){var c;return b.stack.length>0?(c=b.stack.shift(),b.set("previousValues",b.get("values")),b.set("values",c.leaves),b.set("previousColorValues",b.get("colorValues")),b.set("colorValues",c.colors),b.trigger("updateRefresh"),a=!0):void 0},b=e=0,f=g.length;f>e;b=++e)c=g[b],d(c,b);return a},c.prototype.toggleComparison=function(){var a,b,c,d,e,f,g,h,i,j,k;if(m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.NONE){for(h=this.flowerModels,b=0,e=h.length;e>b;b++)a=h[b],a.updateLeafSize(1*m.cfg.FLOWER_SIZE_RATIO);return this._finishedUpdatingWeights()}if(m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER){for(i=this.flowerModels,c=0,f=i.length;f>c;c++)a=i[c],a.updateLeafSize(.3*m.cfg.FLOWER_SIZE_RATIO);return this._finishedUpdatingWeights()}if(m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.PROFILE){for(j=this.flowerModels,k=[],d=0,g=j.length;g>d;d++)a=j[d],k.push(a.updateLeafSize(.66*m.cfg.FLOWER_SIZE_RATIO));return k}},c.prototype.shiftAllFlowersHorizontallyBy=function(a){var b,c,d,e,f;for(m.cfg.animations.POSITION_DURATION=0,m.cfg.animations.LABEL_POSITION_DURATION=0,e=this.flowerModels,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(function(b){var c;return c=b.get("anchor"),b.updatePosition(new j(c.x+a,c.y),!0)}(b));return f},c.prototype._initializeView=function(){switch(this._generateHoverbox(),m.cfg.mode){case m.cfg.MODES.MIXER:this.currentLayout=window.location.hash?h:i;break;case m.cfg.MODES.DIMENSION:this.currentLayout=h;break;case m.cfg.MODES.COUNTRY:this.currentLayout=e;break;case m.cfg.MODES.EMBED:this.currentLayout=h}return this.flowerViews=new Array,this._generateFlowers(),this._generateScaleView(),this.model.off("data loaded"),this._updatedWeights(),this._layoutFlowersAndScale(this.currentLayout),this.firstRun?(this.trigger("view initialized"),this.firstRun=!1):void 0},c.prototype._hoverOverFlower=function(b,c){var d,e,f;return null==c&&(c=void 0),e=this.flowerModels[b],null==this.hoverboxModel||null==this.hoverboxModel.get("country")||e.get("country").get("id")!==this.hoverboxModel.get("country").get("id")?(f=this.flowerViews[b],d=this.flowerLabels[b],e.set("glowing",!0),this.hoverboxModel.set({country:e.get("country"),countryModel:e,position:e.get("anchor").clone().add(new j(m.cfg.FLOWER_WIDTH/2,m.cfg.FLOWER_HEIGHT/2)),event:c,comparisonMode:m.ctrls.interactionController.inequalityComparison}),a(f.el).css({"z-index":this.maxZIndex++}),a(d.el).css({"z-index":this.maxZIndex++}),this.hoveringFlower=e):void 0},c.prototype._noHovering=function(a){return null==a&&(a=void 0),null!=this.hoverboxModel.get("country")?(this.hoverboxModel.set({country:void 0,countryModel:void 0,position:void 0,event:a}),this.hoverbox.hideHoverbox(),this.hoveringFlower=void 0):void 0},c.prototype._checkForFlowerHover=function(b){var c,d,e,f,g,h,i,j,k,l,n,o,p,q,r;if(!m.ctrls.interactionController.helpIsActive){f=b.pageX-m.cfg.visOffsetLeft,g=b.pageY-m.cfg.visOffsetTop,f=Math.round(f/m.ctrls.interactionController.interactionGridStep),g=Math.round(g/m.ctrls.interactionController.interactionGridStep);try{if(h=m.ctrls.interactionController.flowerMap[f][g],h>-1){for(e=this.flowerModels[h],this._hoverOverFlower(h,b),p=this.flowerModels,i=0,l=p.length;l>i;i++)d=p[i],d!==e&&d.set("glowing",!1);return a("body").css("cursor","pointer")}for(this._noHovering(b),q=this.flowerModels,j=0,n=q.length;n>j;j++)d=q[j],d.set("glowing",!1);return a("body").css("cursor","auto")}catch(s){for(c=s,this._noHovering(b),r=this.flowerModels,k=0,o=r.length;o>k;k++)d=r[k],d.set("glowing",!1);return a("body").css("cursor","auto")}}},c.prototype._checkForFlowerClick=function(){return null==this.hoveringFlower||m.cfg.touchdevice||m.cfg.SMALL_SCREEN||m.ctrls.interactionController.helpIsActive?void 0:window.location.href=i18n.t("vis.countries_urls."+this.hoveringFlower.get("country").get("id"))},c.prototype._checkForFlowerTouchDown=function(a){var b,c,d,e,f,g,h,i,j,k,l,o,p,q,r,s,t;if(m.ctrls.animationController.scrollMode===m.cfg.animations.SCROLL_MODES.NONE){e=f=void 0;try{null!=a.pageX?(e=a.pageX-m.cfg.visOffsetLeft,f=a.pageY-m.cfg.visOffsetTop):(i=a.originalEvent.touches[0],e=i.pageX-m.cfg.visOffsetLeft,f=i.pageY-m.cfg.visOffsetTop)}catch(u){return b=u,void n(b)}if(p=m.ctrls.interactionController.checkForFlowerTouch(this.flowerModels,e,f),g=p[0],h=p[1],h>-1){for(d=this.flowerModels[h],this._hoverOverFlower(h),q=this.flowerModels,s=[],j=0,l=q.length;l>j;j++)c=q[j],c!==d&&s.push(c.set("glowing",!1));return s}for(this._noHovering(a),r=this.flowerModels,t=[],k=0,o=r.length;o>k;k++)c=r[k],t.push(c.set("glowing",!1));return t}},c.prototype._checkForFlowerTouchUp=function(){},c.prototype._generateFlowers=function(){var b,c,d,e,f,g,h,i,k,l;for(g=new Array,h=new Array,f=new Array,d=this.currentLayout.calculateLayout(this.model.get("countries").models,m.cfg.height+m.cfg.FLOWER_HEIGHT),e=_.filter(this.model.get("countries").models,function(){return!0}),m.ctrls.interactionController.sorting===m.cfg.SORTINGS.ALPHABETICALLY?e=_.sortBy(e,function(a){return i18n.t("vis.countries."+a.get("id"))}):m.ctrls.interactionController.sorting===m.cfg.SORTINGS.RANK&&(e=m.ctrls.interactionController.inequalityComparison===m.cfg.INEQUALITY_COMPARISONS.GENDER?_.sortBy(e,function(a){return a.get("inequalityScore")}):_.sortBy(e,function(a){return a.get("score")})),i=function(b,c){var e,i,k,l,n;return n=new FlowerModel(b,d[0][c],d[1][c]),n.get("leafsize")<=1&&n.updateLeafSize(1*m.cfg.FLOWER_SIZE_RATIO),a("#flowerContainer").append("						<canvas 						id='flowerCanvas"+b.get("id")+"' 						style='position:absolute;opacity:1;visibility:visible;top:-"+m.cfg.FLOWER_HEADROOM+"px'						width='"+1.6*m.cfg.FLOWER_WIDTH+"px'						height='"+(3*m.cfg.FLOWER_HEIGHT+m.cfg.FLOWER_FOOTROOM+m.cfg.FLOWER_HEADROOM)+"px'>					</canvas>				"),l=document.getElementById("flowerCanvas"+b.get("id")),l.position=new j,e=new NativeFlowerView({model:n,el:l}),k=a('<div class="flowerTextLabel"></div>').appendTo("#visLabelContainer"),i=new FlowerLabelView({model:n,el:k}),g.push(n),h.push(e),f.push(i)},c=k=0,l=e.length;l>k;c=++k)b=e[c],i(b,c);return this.flowerViews=h,this.flowerModels=g,this.flowerLabels=f,m.windowScroll(),m.cfg.touchdevice?(a("#visContainer").on("touchstart",this._checkForFlowerTouchDown),a("#visContainer").on("touchend",this._checkForFlowerTouchUp),a("#visContainer").on("touchcancel",this._checkForFlowerTouchUp)):(a("#visContainer").mousemove(m.cfg.mode===m.cfg.MODES.COUNTRY?this._checkForFlowerTouchDown:this._checkForFlowerHover),a("#visContainer").click(this._checkForFlowerClick))},c.prototype._generateHoverbox=function(){var b,c,d;return d=new window.HoverboxModel,b=a("#hoverbox"),c=new window.HoverboxView({model:d,el:b}),this.hoverboxModel=d,this.hoverbox=c},c.prototype._generateScaleView=function(){var b;return b=new window.ScaleView({model:this.model,el:a("#visScaleContainer")}),this.scaleView=b},c.prototype._layoutFlowersAndScale=function(a,b){var c,d,e,f,g;if(null==b&&(b=!0),m.ctrls.interactionController.flowerMap=void 0,m.windowScroll(),a.layout(this.flowerModels,this.scaleView,m.ctrls.interactionController.sorting,b),0!==m.cfg.FLOWER_SIZE_RATIO_CHANGE){for(g=this.flowerModels,d=function(a){return a.get("country").get("id")!==m.cfg.selectedCountryID?a.updateLeafSize(a.get("leafsize")*m.cfg.FLOWER_SIZE_RATIO_CHANGE):void 0},e=0,f=g.length;f>e;e++)c=g[e],d(c);m.cfg.FLOWER_SIZE_RATIO_CHANGE=0}return m.ctrls.interactionController.generateFlowerHoverMap(this.flowerModels)},c.prototype._updatedWeights=function(){var a,b,c,d,e;for(d=this.flowerModels,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.refresh());return e},c.prototype._finishedUpdatingWeights=function(a){return null==a&&(a=!0),this.currentLayout=h,this._layoutFlowersAndScale(this.currentLayout,a)},c}(Backbone.View),window.ScaleView=function(b){function c(){return this.render=J(this.render,this),this.animateLabelPositions=J(this.animateLabelPositions,this),this.updateLabelPositions=J(this.updateLabelPositions,this),this._setupScaleLabels=J(this._setupScaleLabels,this),x=c.__super__.constructor.apply(this,arguments)}return I(c,b),c.prototype.scaleLabels=void 0,c.prototype.initialize=function(){return this._setupScaleLabels()},c.prototype._setupScaleLabels=function(){var b,c,e,f,g=this;for(f=[],c=function(b){var c,e;return c="<p>",c+=10>b?"Â "+b+".0":""+b+".0",m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP&&(c+=b%5?"-":"â"),c+="</p>",e=a(c).appendTo(g.el),e.css("color",d.darkBackgroundColorCSS),e.addClass("scaleLabel"),b%5||e.addClass("highlighted"),m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(e.css("top","-100px"),e.css("left",parseInt(5+m.cfg.VIS_HORIZONTAL_OFFSET)+"px")):(e.css("left","-100px"),e.css("top",parseInt(5+m.cfg.VIS_VERTICAL_OFFSET)+"px")),f.push(e)},b=e=0;11>e;b=++e)c(b);return this.scaleLabels=f},c.prototype.updateLabelPositions=function(a,b){var c,d,e,f,g=this;if(null==b&&(b=!0),b){for(c=[],f=[],d=e=0;11>e;d=++e)f.push(function(b){var d;return d=g.scaleLabels[b].css(m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?"top":"left"),d=d.substring(0,d.length-2),c.push(d),a[b]<m.cfg.VIS_VERTICAL_OFFSET?g.scaleLabels[b].css("opacity","0"):(g.scaleLabels[b].css("opacity","1"),m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?2===m.ctrls.animationController.animationLevel?g.scaleLabels[b].transition({top:a[b]},m.cfg.animations.POSITION_DURATION):g.scaleLabels[b].css({top:a[b]}):2===m.ctrls.animationController.animationLevel?g.scaleLabels[b].transition({left:a[b]},m.cfg.animations.POSITION_DURATION):g.scaleLabels[b].css({top:a[b]}))}(d));return f}return this.animateLabelPositions(a)},c.prototype.animateLabelPositions=function(a){var b,c,d,e=this;for(d=[],b=c=0;11>c;b=++c)d.push(function(b){return m.cfg.orientation===m.cfg.ORIENTATIONS.BOTTOM_TO_TOP?(e.scaleLabels[b].css("top",a[b]),a[b]<m.cfg.VIS_VERTICAL_OFFSET?e.scaleLabels[b].css("visibility","hidden"):e.scaleLabels[b].css("visibility","visible")):e.scaleLabels[b].css("left",a[b])}(b));return d},c.prototype.render=function(){},c}(Backbone.View),m.util.browserStringMatch=function(a){return null==a?!1:/Android/i.test(a)?"Android":/BlackBerry/i.test(a)?"BlackBerry":/iPhone/i.test(a)?"iPhone":/iPad/i.test(a)?"iPad":/Palm/i.test(a)?"Palm":!1},m.util.checkForMobileBrowser=function(){return m.util.browserStringMatch(navigator.userAgent)},f="gender",k="social",window.MiniCharts=function(){function b(){}return b.prototype.scores={indicators:{},dimensions:{},trends:{}},b.prototype.isNumber=function(a){return isFinite(parseFloat(a))},b.prototype.inequalityScoreTransform=function(a){var b;return b=a,a=parseFloat(a),this.isNumber(a)?(a>=1?a-=1:a=-(1/a-1),a*=-1):void 0},b.prototype.trendValueToPx=function(a){return Math.round(5*a)},b.prototype.inequalityValueToPx=function(a){var b;return b=30,Math.round(a>0?Math.max(1,Math.min(30,a*b)):Math.max(-30,Math.min(-1,a*b)))},b.prototype.init=function(){return this.loadData()},b.prototype.loadData=function(){var a=this;return this.countryIDs=_.pluck(m.ctrls.dataController.countriesArray,"id"),d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/indicator_data.csv",function(b,c){return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/inequality_scores_gender_2014.csv",function(b,d){return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/inequality_scores_social.csv",function(b,e){return d3.tsv(m.cfg.settings.dataLocation+"/media/bli/data/csv/trends.csv",function(b,g){var h,i,j,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;for(a.scores.trends={},g.forEach(function(b){var c,d,e,f;return f={},e=function(){var a;a=[];for(c in b)"ISO"===c&&(this.scores.trends[b[c]]=f),"_id"!==c&&String(b[c]).match(/\d/g)&&(c.indexOf("_CHANGE")>-1&&(d=c.replace("_CHANGE",""),null==f[d]&&(f[d]={}),f[d].value=Number(String(b[c].replace("%","")))),c.indexOf("_YEAR")>-1?(d=c.replace("_YEAR",""),null==f[d]&&(f[d]={}),a.push(f[d].year=Number(b[c].replace("%","")))):a.push(void 0));return a}.call(a)}),D=m.datasets.indicators.indicators_ds,q=0,u=D.length;u>q;q++){l=D[q];for(h in l)null==(o=a.scores.indicators)[h]&&(o[h]={}),a.scores.indicators[h][l.ISO]={value:Number(null!=(E=l[h])?E.toString().replace("~",""):void 0)}}for(r=0,v=c.length;v>r;r++){l=c[r],i=l.ISO;for(h in l)null!=l[h]&&"ISO"!==h&&(a.scores.indicators[h][l.ISO].displayValue=l[h]+i18n.t("minicharts.units."+h))}for(s=0,w=d.length;w>s;s++){l=d[s],i=l.ISO;for(h in l)null!=l[h]&&"ISO"!==h&&(n=a.inequalityScoreTransform(l[h]),a.scores.indicators[h][l.ISO][f]=n)}for(t=0,x=e.length;x>t;t++){l=e[t],i=l.ISO;for(h in l)null!=l[h]&&"ISO"!==h&&(n=a.inequalityScoreTransform(l[h]),a.scores.indicators[h][l.ISO][k]=n)}for(a.countries=[],F=m.models.countries.models,A=0,y=F.length;y>A;A++)for(i=F[A],a.countries.push({id:i.id,label:i18n.t("vis.countries."+i.id)}),G=i.get("dimensions").models,B=0,z=G.length;z>B;B++)j=G[B],null==(p=a.scores.dimensions)[C=j.id]&&(p[C]={}),n=Number(j.get("normalized").toString().replace("~","")),a.scores.dimensions[j.id][i.id]=n;return _.sortBy(a.countries,function(a,b){return a.label>b.label,a.label<b.label,0}),a.renderCharts()})})})})},b.prototype.renderCharts=function(){var b=this;return a(".minichart").each(function(c,d){var e,g,h,i,j,l,m,n;return e=a(d),e.show(),h=e.attr("data-indicator-id"),g=e.attr("data-country"),null!=b.scores.dimensions[h]?b.renderDimension(e,h,g):null!=b.scores.indicators[h]&&(b.renderIndicator(e,h,g),null!=(null!=(i=b.scores.trends[g])?i[h]:void 0)&&b.renderTrend(e,b.scores.trends[g][h].value,b.scores.trends[g][h].year),null!=(null!=(j=b.scores.indicators[h])&&null!=(l=j[g])?l[f]:void 0)&&b.renderInequality(e,h,g,f),null!=(null!=(m=b.scores.indicators[h])&&null!=(n=m[g])?n[k]:void 0))?b.renderInequality(e,h,g,k):void 0}),this.addComparisonSelectBox(),a(".bar").qtip({id:"minicharttip",content:!0,style:{classes:"qtip-bli"}}),a(".info").qtip({id:"minicharttip",content:!0,style:{classes:"qtip-bli"},position:{my:"bottom center",at:"top center"}}),a(".tooltip").qtip({id:"minicharttip",content:!0,style:{classes:"qtip-bli"},position:{my:"bottom center",at:"top center"}})},b.prototype.addComparisonSelectBox=function(){var b;return a('<h3 class="line">'+i18n.t("minicharts.compareTo")+"</h3>").appendTo(a("#topics")),b=a("<select id='countryCompareBox' />").appendTo(a("#topics")),b.append("<option value='-1'>"+i18n.t("minicharts.pick_a_country")+"</option>"),a(this.countries).each(function(a,c){return b.append("<option value='"+c.id+"'>"+c.label+"</option>")}),b.change(function(){return a(".bar").removeClass("compareTo"),a(".bar[data-id="+b.val()+"]").addClass("compareTo")})},b.prototype.renderDimension=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o;for(a.addClass("dimension chartwrapper topic-"+b.toLowerCase()),k=i18n.t("vis.topic_urls."+b),h=i18n.t("vis.topic_descriptions."+b),i=i18n.t("vis.dimensions."+b),d=function(a,b){return a.value-b.value},f=this.scores.dimensions[b],g=function(){var a;a=[];for(e in f)l=f[e],a.push({country:e,value:l});return a}().sort(d),j="<div class='title '>\n	<h5>\n		<a 	class='info'\n			href='"+k+"'\n			title='"+h+"'\n		>"+i+'<i class="icon-icon-info"></i></a>\n	</h5>',null!=c&&(j+="<div class='value'>\n	"+(10*f[c]).toFixed(1)+"\n</div>"),j+="</div>\n<div class='chart-content '>",j+="<div class='chart '>",n=0,o=g.length;o>n;n++)m=g[n],j+=this.makeBar(m.country,i18n.t("vis.countries."+m.country),(10*f[m.country]).toFixed(1),f[m.country],m.country===c);return j+="</div></div>",a.html(j)},b.prototype.makeBar=function(a,b,c,d,e){var f,g;return g=35,f=Math.max(2,Math.floor(d*g)),'<a href="'+i18n.t("vis.countries_urls."+a)+'" >\n	<div\n		class="bar '+a+" "+(e?"selected":"")+"\"\n		title='"+b+"<br/>"+c+"'\n		data-id='"+a+"'\n		style='margin-top:"+(g-f)+"px; height:"+f+"px;'\n	></div>\n</a>"},b.prototype.renderIndicator=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;if(a.addClass("indicator chartwrapper "+b.toLowerCase()),h=i18n.t("vis.topic_descriptions."+b),j=i18n.t("vis.dimensions."+b),d=function(a,b){return a.value-b.value},f=this.scores.indicators[b],g=function(){var a;a=[];for(e in f)m=f[e],a.push({country:e,value:m.value,displayValue:m.displayValue});return a}().sort(d),c){for(l="<div class='title blockTitle '>\n	<h5>\n		<a 	class='info'\n			title='"+h+"'\n		>"+j+"<i class=\"icon-icon-info\"></i></a>\n	</h5>\n	<div class='value'>\n		"+f[c].displayValue+"\n	</div>\n</div>\n\n<div class='chart-content '>",i=o=0,q=g.length;q>o;i=++o)n=g[i],n.country===c&&(k=g.length-i);k&&(l+="<div class='countryRank'>\n	"+i18n.t("minicharts.rank")+":<br/>\n	<span class='rankIndex'>"+k+"</span>\n	/Â "+g.length+"\n</div>")}else l="<div class='title '>\n	<h5>\n		<a 	class='info'\n			title='"+h+"'\n		>"+j+"<i class=\"icon-icon-info\"></i></a>\n	</h5>\n</div>\n\n<div class='chart-content '>";for(l+='<div class="chart ">',p=0,r=g.length;r>p;p++)n=g[p],l+=this.makeBar(n.country,i18n.t("vis.countries."+n.country),f[n.country].displayValue,f[n.country].value,n.country===c);return l+="</div></div>",a.html(l)},b.prototype.renderTrend=function(b,c,d){var e,f,g;if(this.isNumber(c)&&this.isNumber(d))return e="",g=c>0?Math.max(-18,-this.trendValueToPx(c)):0,f=0>c?-18+Math.min(18,-this.trendValueToPx(c)):-18,e+='<div class="trend section ">\n	<div class="title ">\n		'+i18n.t("minicharts.trend")+'\n	</div>\n	<div class="trendchart ">\n		<div class="up" style="background-position:center '+g+'px;">Â </div>\n		<div class="down" style="background-position:center '+f+"px;\">Â </div>\n	</div>\n	<div>\n		<span class='value'>\n			Â "+(c>0?"+":"")+c.toFixed(1)+"%\n		</span>\n		<div class='trendAnnotation'>\n			"+i18n.t("minicharts.average-increase")+"<br/>"+i18n.t("minicharts.since")+" "+d+"\n		</div>\n	</div>\n</div>",a(e).appendTo(b)},b.prototype.renderInequality=function(b,c,d,e){var g,h,i,j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;l={},u=1e4,t=-1e4;for(j in this.scores.indicators[c])null!=(null!=(H=this.scores.indicators[c])&&null!=(I=H[j])?I[e]:void 0)&&(z=l[j]=this.scores.indicators[c][j][e],u=Math.min(u,Math.abs(z)),t=Math.max(t,Math.abs(z)));for(g=function(a,b){return a.value-b.value},h=function(a,b){return b.valueNormalized-a.valueNormalized},n=function(){var a;a=[];for(i in l)A=l[i],a.push({country:i,value:A,valueNormalized:(Math.abs(A)-u)/(t-u),displayValue:(1+Math.abs(A)).toFixed(2)});return a}(),n.sort(h),o=D=0,F=n.length;F>D;o=++D)C=n[o],C.country===d&&(v=n.length-o,q=C.value,p=C.displayValue);for(n.sort(g),e===f&&(m="gender",y=i18n.t("minicharts.gender-inequality"),r=i18n.t("minicharts.men"),w=i18n.t("minicharts.woman")),e===k&&(m="social",y=i18n.t("minicharts.social-inequality"),r=i18n.t("minicharts.rich"),w=i18n.t("minicharts.poor")),s=null,B=null,q>0?(s=35,B=this.inequalityValueToPx(q)):(s=36+this.inequalityValueToPx(q),B=-this.inequalityValueToPx(q)),x="<div class='"+m+" inequality section '>\n<div class='title tooltip' title=\""+i18n.t("minicharts.tooltip-comparing-"+m)+'">'+y+"<i class=\"icon-icon-info\"></i>\n	</div></div>\n\n<div class='inequalitysection '>\n	<div class='value'>"+p+"</div>\n\n	<div class='inequalitylabel left'>"+r+"</div>\n\n	<div class='inequalitychart'>\n		<div class='inequalitybar' style='margin-left:"+s+"px; width:"+B+"px;'></div>\n	</div>\n\n	<div class='inequalitylabel'>"+w+"</div>",v&&(x+="<div class='countryRank'>\n	"+i18n.t("minicharts.rank")+":<br/>\n	<span class='rankIndex'>"+v+"</span> / "+n.length+"\n</div>"),x+='<div class="chart ">',E=0,G=n.length;G>E;E++)C=n[E],x+=this.makeBar(C.country,i18n.t("vis.countries."+C.country),C.displayValue,C.valueNormalized,C.country===d);return x+="</div></div>",a(x).appendTo(b)},b}()}).call(this);